# Prompt: Implement Automatic Version Tracking and Display in Vite Project

## Objective
Implement an automatic version management system that:
- Automatically increments the patch version on every build
- Displays the current version in the application UI
- Stores version in both `package.json` and Vite environment variables

## Requirements

### 1. Create Version Update Script
Create `scripts/update-version.cjs` with the following functionality:
- Read the current version from `package.json`
- Increment the patch version (e.g., `0.1.0` â†’ `0.1.1`)
- Update `package.json` with the new version
- Create/update `.env.local` file with `VITE_APP_VERSION={newVersion}`
- Output success messages to console
- Handle errors gracefully

**File location:** `scripts/update-version.cjs`

**Template:**
```javascript
#!/usr/bin/env node

const { readFileSync, writeFileSync } = require('fs');
const { join } = require('path');

/**
 * Prebuild script to update version in package.json and create version file
 * This script increments the patch version and creates a version file for Vite
 */

function updateVersion() {
  const packageJsonPath = join(process.cwd(), 'package.json');
  
  try {
    // Read current package.json
    const packageJson = JSON.parse(readFileSync(packageJsonPath, 'utf8'));
    
    // Parse current version
    const [major, minor, patch] = packageJson.version.split('.').map(Number);
    
    // Increment patch version
    const newVersion = `${major}.${minor}.${patch + 1}`;
    
    // Update package.json
    packageJson.version = newVersion;
    writeFileSync(packageJsonPath, JSON.stringify(packageJson, null, 2) + '\n');
    
    // Create .env.local file for Vite environment variables
    const envContent = `VITE_APP_VERSION=${newVersion}\n`;
    writeFileSync(join(process.cwd(), '.env.local'), envContent);
    
    console.log(`âœ… Version updated to ${newVersion}`);
    console.log(`ðŸ“ Updated package.json`);
    console.log(`ðŸ“„ Created .env.local with VITE_APP_VERSION`);
    
    return newVersion;
  } catch (error) {
    console.error('âŒ Error updating version:', error);
    process.exit(1);
  }
}

// Run the update
updateVersion();
```

### 2. Create Setup Script (Optional but Recommended)
Create `scripts/setup-version-management.sh` to:
- Add `.env.local` to `.gitignore` if not already present
- Create initial `.env.local` file if it doesn't exist
- Set up git hooks (if desired)

**File location:** `scripts/setup-version-management.sh`

**Template:**
```bash
#!/bin/bash

# Setup script for version management
# This script sets up git hooks and gitignore entries

echo "ðŸ”§ Setting up version management..."

# Add .env.local to .gitignore if it's not already there
if ! grep -q ".env.local" .gitignore 2>/dev/null; then
    echo "" >> .gitignore
    echo "# Local environment variables (generated by version script)" >> .gitignore
    echo ".env.local" >> .gitignore
    echo "ðŸ“ Added .env.local to .gitignore"
fi

# Create initial .env.local if it doesn't exist
if [ ! -f .env.local ]; then
    echo "VITE_APP_VERSION=0.1.0" > .env.local
    echo "ðŸ“„ Created initial .env.local"
fi

echo "âœ… Version management setup complete!"
echo ""
echo "ðŸ“‹ What was set up:"
echo "  â€¢ .env.local added to .gitignore"
echo "  â€¢ Initial .env.local created"
echo ""
echo "ðŸš€ The version will now automatically increment on every build!"
```

### 3. Create Version Display Component
Create a React component that displays the version from Vite environment variables.

**File location:** `src/components/VersionDisplay.tsx` (or appropriate component directory)

**Template:**
```tsx
import React from 'react';

interface VersionDisplayProps {
  className?: string;
}

const VersionDisplay: React.FC<VersionDisplayProps> = ({ className = '' }) => {
  // Get version from Vite environment variable
  const version = import.meta.env.VITE_APP_VERSION || '0.1.0';
  
  return (
    <div className={`text-xs text-muted-foreground ${className}`}>
      v{version}
    </div>
  );
};

export default VersionDisplay;
```

**Note:** Adjust the className styling to match your project's design system (Tailwind, CSS modules, etc.)

### 4. Update package.json
Add the following scripts to `package.json`:

```json
{
  "scripts": {
    "prebuild": "node scripts/update-version.cjs",
    "build": "npm run prebuild && vite build",
    "setup-version": "bash scripts/setup-version-management.sh"
  }
}
```

**Important:** 
- The `prebuild` script must run before `build`
- If you have a custom build script, ensure `prebuild` runs first
- The `setup-version` script is optional but helpful for initial setup

### 5. Integrate Version Display in UI
Add the `VersionDisplay` component to your application. Common locations:
- Footer component
- About/Settings page
- Admin/Debug panel
- Header (if appropriate)

**Example integration in Footer:**
```tsx
import VersionDisplay from './VersionDisplay';

// In your footer component:
<footer>
  <div>
    <p>Â© 2025 Your App Name. <VersionDisplay /></p>
  </div>
</footer>
```

### 6. Update .gitignore
Ensure `.env.local` is in `.gitignore` (the setup script handles this, but verify):

```
.env.local
```

### 7. Configure Vite (if needed)
Vite automatically reads `.env.local` files. No additional configuration needed, but ensure:
- The file is named exactly `.env.local`
- The variable is prefixed with `VITE_` (e.g., `VITE_APP_VERSION`)
- Access it in code via `import.meta.env.VITE_APP_VERSION`

## Implementation Steps

1. **Create the scripts directory** (if it doesn't exist):
   ```bash
   mkdir -p scripts
   ```

2. **Create `scripts/update-version.cjs`** with the provided template

3. **Create `scripts/setup-version-management.sh`** with the provided template and make it executable:
   ```bash
   chmod +x scripts/setup-version-management.sh
   ```

4. **Create `src/components/VersionDisplay.tsx`** (or appropriate path) with the provided template

5. **Update `package.json`**:
   - Add `prebuild` script
   - Modify `build` script to run `prebuild` first
   - Add `setup-version` script (optional)

6. **Run setup script** (optional):
   ```bash
   npm run setup-version
   ```

7. **Integrate VersionDisplay component** in your UI (footer, admin page, etc.)

8. **Test the system**:
   - Run `npm run build` and verify version increments
   - Check that `.env.local` is created with `VITE_APP_VERSION`
   - Verify version displays correctly in the UI
   - Ensure `.env.local` is in `.gitignore`

## Testing Checklist

- [ ] Version increments when running `npm run build`
- [ ] `.env.local` file is created with correct `VITE_APP_VERSION`
- [ ] Version displays correctly in the UI component
- [ ] `.env.local` is in `.gitignore` and not committed
- [ ] Version persists across builds (doesn't reset)
- [ ] Fallback version (`0.1.0`) works if env var is missing

## Customization Options

1. **Version Format**: Modify the increment logic in `update-version.cjs` to change how versions increment (e.g., minor instead of patch)

2. **Display Style**: Customize `VersionDisplay.tsx` to match your design system

3. **Display Location**: Add version display to multiple locations (footer, header, about page, etc.)

4. **Git Hooks**: Optionally add a pre-commit hook to increment version on commits (requires additional setup)

## Notes

- The version is stored in both `package.json` (for npm) and `.env.local` (for Vite)
- `.env.local` is git-ignored to avoid conflicts between developers
- The version increments on every build, not every commit (unless you add git hooks)
- The fallback version (`0.1.0`) ensures the app works even if the env var is missing

## Troubleshooting

- **Version not updating**: Check that `prebuild` runs before `build` in package.json
- **Version not displaying**: Verify `.env.local` exists and contains `VITE_APP_VERSION`
- **Build errors**: Ensure `scripts/update-version.cjs` is executable and has correct permissions
- **Env var not accessible**: Verify variable name starts with `VITE_` and is accessed via `import.meta.env`

