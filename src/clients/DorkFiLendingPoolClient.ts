/* eslint-disable */
/**
 * This file was automatically generated by @algorandfoundation/algokit-client-generator.
 * DO NOT MODIFY IT BY HAND.
 * requires: @algorandfoundation/algokit-utils: ^2
 */
import * as algokit from '@algorandfoundation/algokit-utils'
import type {
  ABIAppCallArg,
  AppCallTransactionResult,
  AppCallTransactionResultOfType,
  AppCompilationResult,
  AppReference,
  AppState,
  CoreAppCallArgs,
  RawAppCallArgs,
  TealTemplateParams,
} from '@algorandfoundation/algokit-utils/types/app'
import type {
  AppClientCallCoreParams,
  AppClientCompilationParams,
  AppClientDeployCoreParams,
  AppDetails,
  ApplicationClient,
} from '@algorandfoundation/algokit-utils/types/app-client'
import type { AppSpec } from '@algorandfoundation/algokit-utils/types/app-spec'
import type { SendTransactionResult, TransactionToSign, SendTransactionFrom, SendTransactionParams } from '@algorandfoundation/algokit-utils/types/transaction'
import type { ABIResult, TransactionWithSigner } from 'algosdk'
import { Algodv2, OnApplicationComplete, Transaction, AtomicTransactionComposer, modelsv2 } from 'algosdk'
export const APP_SPEC: AppSpec = {
  "hints": {
    "post_update()void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_owner()address": {
      "read_only": true,
      "call_config": {
        "no_op": "CALL"
      }
    },
    "transfer_ownership(address)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "is_paused()bool": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "pause(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_stoken_app_id(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "UserData",
          "elements": [
            [
              "scaled_deposits",
              "uint256"
            ],
            [
              "scaled_borrows",
              "uint256"
            ],
            [
              "deposit_index",
              "uint256"
            ],
            [
              "borrow_index",
              "uint256"
            ],
            [
              "last_update_time",
              "uint64"
            ],
            [
              "last_price",
              "uint256"
            ]
          ]
        }
      }
    },
    "create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_storage_app_id(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)": {
      "read_only": true,
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "MarketData",
          "elements": [
            [
              "paused",
              "bool"
            ],
            [
              "max_total_deposits",
              "uint256"
            ],
            [
              "max_total_borrows",
              "uint256"
            ],
            [
              "liquidation_bonus",
              "uint64"
            ],
            [
              "collateral_factor",
              "uint64"
            ],
            [
              "liquidation_threshold",
              "uint64"
            ],
            [
              "reserve_factor",
              "uint64"
            ],
            [
              "borrow_rate",
              "uint64"
            ],
            [
              "slope",
              "uint64"
            ],
            [
              "total_scaled_deposits",
              "uint256"
            ],
            [
              "total_scaled_borrows",
              "uint256"
            ],
            [
              "deposit_index",
              "uint256"
            ],
            [
              "borrow_index",
              "uint256"
            ],
            [
              "last_update_time",
              "uint64"
            ],
            [
              "reserves",
              "uint256"
            ],
            [
              "price",
              "uint256"
            ],
            [
              "ntoken_id",
              "uint64"
            ],
            [
              "close_factor",
              "uint64"
            ]
          ]
        }
      }
    },
    "get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "MarketTransactionCap",
          "elements": [
            [
              "deposit",
              "uint256"
            ],
            [
              "withdraw",
              "uint256"
            ],
            [
              "borrow",
              "uint256"
            ],
            [
              "liquidate",
              "uint256"
            ]
          ]
        }
      }
    },
    "get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "UserCap",
          "elements": [
            [
              "total_deposits",
              "uint256"
            ],
            [
              "total_borrows",
              "uint256"
            ],
            [
              "total_liquidations",
              "uint256"
            ],
            [
              "total_withdrawals",
              "uint256"
            ],
            [
              "daily_liquidations",
              "uint256"
            ],
            [
              "daily_withdrawals",
              "uint256"
            ],
            [
              "daily_reset_time",
              "uint64"
            ]
          ]
        }
      }
    },
    "set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "user_cap": {
          "name": "UserCap",
          "elements": [
            [
              "total_deposits",
              "uint256"
            ],
            [
              "total_borrows",
              "uint256"
            ],
            [
              "total_liquidations",
              "uint256"
            ],
            [
              "total_withdrawals",
              "uint256"
            ],
            [
              "daily_liquidations",
              "uint256"
            ],
            [
              "daily_withdrawals",
              "uint256"
            ],
            [
              "daily_reset_time",
              "uint64"
            ]
          ]
        }
      }
    },
    "set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "transaction_cap": {
          "name": "MarketTransactionCap",
          "elements": [
            [
              "deposit",
              "uint256"
            ],
            [
              "withdraw",
              "uint256"
            ],
            [
              "borrow",
              "uint256"
            ],
            [
              "liquidate",
              "uint256"
            ]
          ]
        }
      }
    },
    "get_price_feed(uint64)(uint64,uint64,(uint256,uint64))": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "PriceFeed",
          "elements": [
            [
              "market_id",
              "uint64"
            ],
            [
              "provider_app_id",
              "uint64"
            ],
            [
              "price_with_timestamp",
              "(uint256,uint64)"
            ]
          ]
        }
      }
    },
    "set_authorized_price_operator(address)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "attach_price_feed(uint64,uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "detach_price_feed(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_market_price(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "fetch_price_feed(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_market_max_total_deposits(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "pause_market(uint64,uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "sync_market(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "withdraw_reserves(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "deposit(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "withdraw(uint64,uint256)uint256": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "borrow(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "repay(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "sync_user_market_for_price_change(address,uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_global_user(address)(uint256,uint256,uint64)": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "GlobalUserData",
          "elements": [
            [
              "total_collateral_value",
              "uint256"
            ],
            [
              "total_borrow_value",
              "uint256"
            ],
            [
              "last_update_time",
              "uint64"
            ]
          ]
        }
      }
    },
    "liquidate_cross_market(uint64,uint64,address,uint256,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_version(uint64,uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "grant_upgrader(address)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "approve_update(bool)void": {
      "call_config": {
        "no_op": "CALL"
      }
    }
  },
  "source": {
    "approval": "I3ByYWdtYSB2ZXJzaW9uIDEwCgpjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5hcHByb3ZhbF9wcm9ncmFtOgogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGJueiBtYWluX2VudHJ5cG9pbnRAMgogICAgY2FsbHN1YiBfX2luaXRfXwoKbWFpbl9lbnRyeXBvaW50QDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMxOTYKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSk6CiAgICB0eG4gTnVtQXBwQXJncwogICAgYnogbWFpbl9iYXJlX3JvdXRpbmdANDAKICAgIG1ldGhvZCAicG9zdF91cGRhdGUoKXZvaWQiCiAgICBtZXRob2QgImdldF9vd25lcigpYWRkcmVzcyIKICAgIG1ldGhvZCAidHJhbnNmZXJfb3duZXJzaGlwKGFkZHJlc3Mpdm9pZCIKICAgIG1ldGhvZCAiaXNfcGF1c2VkKClib29sIgogICAgbWV0aG9kICJwYXVzZSh1aW50NjQpdm9pZCIKICAgIG1ldGhvZCAic2V0X3N0b2tlbl9hcHBfaWQodWludDY0KXZvaWQiCiAgICBtZXRob2QgImdldF91c2VyKGFkZHJlc3MsdWludDY0KSh1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQ2NCx1aW50MjU2KSIKICAgIG1ldGhvZCAiY3JlYXRlX21hcmtldCh1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50MjU2LHVpbnQyNTYsdWludDY0LHVpbnQ2NCl1aW50NjQiCiAgICBtZXRob2QgInNldF9zdG9yYWdlX2FwcF9pZCh1aW50NjQpdm9pZCIKICAgIG1ldGhvZCAiZ2V0X21hcmtldCh1aW50NjQpKGJvb2wsdWludDI1Nix1aW50MjU2LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDY0LHVpbnQyNTYsdWludDI1Nix1aW50NjQsdWludDY0KSIKICAgIG1ldGhvZCAiZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodWludDY0KSh1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2KSIKICAgIG1ldGhvZCAiZ2V0X3VzZXJfY2FwKGFkZHJlc3MpKHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQ2NCkiCiAgICBtZXRob2QgInNldF91c2VyX2NhcChhZGRyZXNzLCh1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50NjQpKXZvaWQiCiAgICBtZXRob2QgInNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHVpbnQ2NCwodWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nikpdm9pZCIKICAgIG1ldGhvZCAiZ2V0X3ByaWNlX2ZlZWQodWludDY0KSh1aW50NjQsdWludDY0LCh1aW50MjU2LHVpbnQ2NCkpIgogICAgbWV0aG9kICJzZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihhZGRyZXNzKXZvaWQiCiAgICBtZXRob2QgImF0dGFjaF9wcmljZV9mZWVkKHVpbnQ2NCx1aW50NjQpdm9pZCIKICAgIG1ldGhvZCAiZGV0YWNoX3ByaWNlX2ZlZWQodWludDY0KXZvaWQiCiAgICBtZXRob2QgInNldF9tYXJrZXRfcHJpY2UodWludDY0LHVpbnQyNTYpdm9pZCIKICAgIG1ldGhvZCAiZmV0Y2hfcHJpY2VfZmVlZCh1aW50NjQpdm9pZCIKICAgIG1ldGhvZCAic2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHModWludDY0LHVpbnQyNTYpdm9pZCIKICAgIG1ldGhvZCAicGF1c2VfbWFya2V0KHVpbnQ2NCx1aW50NjQpdm9pZCIKICAgIG1ldGhvZCAic3luY19tYXJrZXQodWludDY0KXZvaWQiCiAgICBtZXRob2QgIndpdGhkcmF3X3Jlc2VydmVzKHVpbnQ2NCx1aW50MjU2KXZvaWQiCiAgICBtZXRob2QgImRlcG9zaXQodWludDY0LHVpbnQyNTYpdm9pZCIKICAgIG1ldGhvZCAid2l0aGRyYXcodWludDY0LHVpbnQyNTYpdWludDI1NiIKICAgIG1ldGhvZCAiYm9ycm93KHVpbnQ2NCx1aW50MjU2KXZvaWQiCiAgICBtZXRob2QgInJlcGF5KHVpbnQ2NCx1aW50MjU2KXZvaWQiCiAgICBtZXRob2QgInN5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZShhZGRyZXNzLHVpbnQ2NCl2b2lkIgogICAgbWV0aG9kICJnZXRfZ2xvYmFsX3VzZXIoYWRkcmVzcykodWludDI1Nix1aW50MjU2LHVpbnQ2NCkiCiAgICBtZXRob2QgImxpcXVpZGF0ZV9jcm9zc19tYXJrZXQodWludDY0LHVpbnQ2NCxhZGRyZXNzLHVpbnQyNTYsdWludDI1Nil2b2lkIgogICAgbWV0aG9kICJzZXRfdmVyc2lvbih1aW50NjQsdWludDY0KXZvaWQiCiAgICBtZXRob2QgImdyYW50X3VwZ3JhZGVyKGFkZHJlc3Mpdm9pZCIKICAgIG1ldGhvZCAiYXBwcm92ZV91cGRhdGUoYm9vbCl2b2lkIgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMAogICAgbWF0Y2ggbWFpbl9wb3N0X3VwZGF0ZV9yb3V0ZUA0IG1haW5fZ2V0X293bmVyX3JvdXRlQDUgbWFpbl90cmFuc2Zlcl9vd25lcnNoaXBfcm91dGVANiBtYWluX2lzX3BhdXNlZF9yb3V0ZUA3IG1haW5fcGF1c2Vfcm91dGVAOCBtYWluX3NldF9zdG9rZW5fYXBwX2lkX3JvdXRlQDkgbWFpbl9nZXRfdXNlcl9yb3V0ZUAxMCBtYWluX2NyZWF0ZV9tYXJrZXRfcm91dGVAMTEgbWFpbl9zZXRfc3RvcmFnZV9hcHBfaWRfcm91dGVAMTIgbWFpbl9nZXRfbWFya2V0X3JvdXRlQDEzIG1haW5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfcm91dGVAMTQgbWFpbl9nZXRfdXNlcl9jYXBfcm91dGVAMTUgbWFpbl9zZXRfdXNlcl9jYXBfcm91dGVAMTYgbWFpbl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9yb3V0ZUAxNyBtYWluX2dldF9wcmljZV9mZWVkX3JvdXRlQDE4IG1haW5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Jfcm91dGVAMTkgbWFpbl9hdHRhY2hfcHJpY2VfZmVlZF9yb3V0ZUAyMCBtYWluX2RldGFjaF9wcmljZV9mZWVkX3JvdXRlQDIxIG1haW5fc2V0X21hcmtldF9wcmljZV9yb3V0ZUAyMiBtYWluX2ZldGNoX3ByaWNlX2ZlZWRfcm91dGVAMjMgbWFpbl9zZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0c19yb3V0ZUAyNCBtYWluX3BhdXNlX21hcmtldF9yb3V0ZUAyNSBtYWluX3N5bmNfbWFya2V0X3JvdXRlQDI2IG1haW5fd2l0aGRyYXdfcmVzZXJ2ZXNfcm91dGVAMjcgbWFpbl9kZXBvc2l0X3JvdXRlQDI4IG1haW5fd2l0aGRyYXdfcm91dGVAMjkgbWFpbl9ib3Jyb3dfcm91dGVAMzAgbWFpbl9yZXBheV9yb3V0ZUAzMSBtYWluX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZV9yb3V0ZUAzMiBtYWluX2dldF9nbG9iYWxfdXNlcl9yb3V0ZUAzMyBtYWluX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfcm91dGVAMzQgbWFpbl9zZXRfdmVyc2lvbl9yb3V0ZUAzNSBtYWluX2dyYW50X3VwZ3JhZGVyX3JvdXRlQDM2IG1haW5fYXBwcm92ZV91cGRhdGVfcm91dGVAMzcKICAgIGVyciAvLyByZWplY3QgdHJhbnNhY3Rpb24KCm1haW5fcG9zdF91cGRhdGVfcm91dGVANDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIxMQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICBjYWxsc3ViIHBvc3RfdXBkYXRlCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2dldF9vd25lcl9yb3V0ZUA1OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5ODYKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgY2FsbHN1YiBnZXRfb3duZXIKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgc3dhcAogICAgY29uY2F0CiAgICBsb2cKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fdHJhbnNmZXJfb3duZXJzaGlwX3JvdXRlQDY6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk5MAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMxOTYKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk5MAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHRyYW5zZmVyX293bmVyc2hpcAogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9pc19wYXVzZWRfcm91dGVANzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAwNgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICBjYWxsc3ViIGlzX3BhdXNlZAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9wYXVzZV9yb3V0ZUA4OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDE0CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzE5NgogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAxNAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHBhdXNlCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX3NldF9zdG9rZW5fYXBwX2lkX3JvdXRlQDk6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjYKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDI2CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgc2V0X3N0b2tlbl9hcHBfaWQKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fZ2V0X3VzZXJfcm91dGVAMTA6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNTQKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDU0CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgZ2V0X3VzZXIKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgc3dhcAogICAgY29uY2F0CiAgICBsb2cKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fY3JlYXRlX21hcmtldF9yb3V0ZUAxMToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEyOQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMxOTYKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAzCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyA0CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyA1CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyA2CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyA3CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyA4CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyA5CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTI5CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgY3JlYXRlX21hcmtldAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9zZXRfc3RvcmFnZV9hcHBfaWRfcm91dGVAMTI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExOTgKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTk4CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgc2V0X3N0b3JhZ2VfYXBwX2lkCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2dldF9tYXJrZXRfcm91dGVAMTM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMDMKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjAzCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIGNhbGxzdWIgZ2V0X21hcmtldAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9yb3V0ZUAxNDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIxOQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMxOTYKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMTkKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9nZXRfdXNlcl9jYXBfcm91dGVAMTU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMzUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjM1CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgZ2V0X3VzZXJfY2FwCiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX3NldF91c2VyX2NhcF9yb3V0ZUAxNjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI1MQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMxOTYKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNTEKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBzZXRfdXNlcl9jYXAKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfcm91dGVAMTc6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNjEKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjYxCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fZ2V0X3ByaWNlX2ZlZWRfcm91dGVAMTg6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNzkKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjc5CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgZ2V0X3ByaWNlX2ZlZWQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgc3dhcAogICAgY29uY2F0CiAgICBsb2cKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Jfcm91dGVAMTk6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyOTUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjk1CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fYXR0YWNoX3ByaWNlX2ZlZWRfcm91dGVAMjA6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMjIKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzIyCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgYXR0YWNoX3ByaWNlX2ZlZWQKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fZGV0YWNoX3ByaWNlX2ZlZWRfcm91dGVAMjE6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNDkKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzQ5CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgZGV0YWNoX3ByaWNlX2ZlZWQKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fc2V0X21hcmtldF9wcmljZV9yb3V0ZUAyMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM2NQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMxOTYKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNjUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBzZXRfbWFya2V0X3ByaWNlCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2ZldGNoX3ByaWNlX2ZlZWRfcm91dGVAMjM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzOTAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzkwCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgZmV0Y2hfcHJpY2VfZmVlZAogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9zZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0c19yb3V0ZUAyNDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQzMwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMxOTYKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MzMKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBzZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0cwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9wYXVzZV9tYXJrZXRfcm91dGVAMjU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MDEKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTAxCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgcGF1c2VfbWFya2V0CiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX3N5bmNfbWFya2V0X3JvdXRlQDI2OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTExCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzE5NgogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUxMQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHN5bmNfbWFya2V0CiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX3dpdGhkcmF3X3Jlc2VydmVzX3JvdXRlQDI3OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTgyLTE1ODMKICAgIC8vICMgUkVNIGludGVudGlvbmFsbHkgc2tpcHBpbmcgc3Vicm91dGluZSB0byByZWR1Y2UgY29udHJhY3Qgc2l6ZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMxOTYKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1ODItMTU4MwogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBza2lwcGluZyBzdWJyb3V0aW5lIHRvIHJlZHVjZSBjb250cmFjdCBzaXplCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgd2l0aGRyYXdfcmVzZXJ2ZXMKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fZGVwb3NpdF9yb3V0ZUAyODoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYyMwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMxOTYKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MjMKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBkZXBvc2l0CiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX3dpdGhkcmF3X3JvdXRlQDI5OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODExCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzE5NgogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTgxMQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHdpdGhkcmF3CiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2JvcnJvd19yb3V0ZUAzMDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk0NgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMxOTYKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NDYKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBib3Jyb3cKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fcmVwYXlfcm91dGVAMzE6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwODYKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDg2CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgcmVwYXkKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlX3JvdXRlQDMyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjg2CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzE5NgogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjI4NgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHN5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZQogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9nZXRfZ2xvYmFsX3VzZXJfcm91dGVAMzM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNDIKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzQyCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgZ2V0X2dsb2JhbF91c2VyCiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfcm91dGVAMzQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzOTIKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMwogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgNAogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgNQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzkyCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgbGlxdWlkYXRlX2Nyb3NzX21hcmtldAogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9zZXRfdmVyc2lvbl9yb3V0ZUAzNToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzE5NgogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgc2V0X3ZlcnNpb24KICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fZ3JhbnRfdXBncmFkZXJfcm91dGVAMzY6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMxOTYKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGdyYW50X3VwZ3JhZGVyCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2FwcHJvdmVfdXBkYXRlX3JvdXRlQDM3OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo4MAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2JhcmVfcm91dGluZ0A0MDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzE5NgogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlKToKICAgIGludCAwCiAgICBpbnQgNAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgbWF0Y2ggbWFpbl9jcmVhdGVANDEgbWFpbl9vbl91cGRhdGVANDIKICAgIGVyciAvLyByZWplY3QgdHJhbnNhY3Rpb24KCm1haW5fY3JlYXRlQDQxOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgICEKICAgIGFzc2VydCAvLyBpcyBjcmVhdGluZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9vbl91cGRhdGVANDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMQogICAgLy8gQGFyYzQuYmFyZW1ldGhvZChhbGxvd19hY3Rpb25zPVsiVXBkYXRlQXBwbGljYXRpb24iXSkKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMS0xMTIKICAgIC8vIEBhcmM0LmJhcmVtZXRob2QoYWxsb3dfYWN0aW9ucz1bIlVwZGF0ZUFwcGxpY2F0aW9uIl0pCiAgICAvLyBkZWYgb25fdXBkYXRlKHNlbGYpIC0+IE5vbmU6CiAgICBjYWxsc3ViIG9uX3VwZGF0ZQogICAgaW50IDEKICAgIHJldHVybgoKCi8vIGNvbnRyYWN0LkRvcmtGaUxlbmRpbmdQb29sLnBvc3RfdXBkYXRlKCkgLT4gdm9pZDoKcG9zdF91cGRhdGU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMTEtMzIxMgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcG9zdF91cGRhdGUoc2VsZikgLT4gTm9uZToKICAgIHByb3RvIDAgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjEzCiAgICAvLyBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLnVwZ3JhZGVyLCAibXVzdCBiZSB1cGdyYWRlciIKICAgIHR4biBTZW5kZXIKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjYyCiAgICAvLyBzZWxmLnVwZ3JhZGVyID0gQWNjb3VudCgpCiAgICBieXRlICJ1cGdyYWRlciIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIxMwogICAgLy8gYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi51cGdyYWRlciwgIm11c3QgYmUgdXBncmFkZXIiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYudXBncmFkZXIgZXhpc3RzCiAgICA9PQogICAgYXNzZXJ0IC8vIG11c3QgYmUgdXBncmFkZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NTkKICAgIC8vIHNlbGYuY29udHJhY3RfdmVyc2lvbiA9IFVJbnQ2NCgpCiAgICBieXRlICJjb250cmFjdF92ZXJzaW9uIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjE0CiAgICAvLyBzZWxmLmNvbnRyYWN0X3ZlcnNpb24gPSBVSW50NjQoMCkKICAgIGludCAwCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo2MAogICAgLy8gc2VsZi5kZXBsb3ltZW50X3ZlcnNpb24gPSBVSW50NjQoKQogICAgYnl0ZSAiZGVwbG95bWVudF92ZXJzaW9uIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjE1CiAgICAvLyBzZWxmLmRlcGxveW1lbnRfdmVyc2lvbiA9IFVJbnQ2NCg0KQogICAgaW50IDQKICAgIGFwcF9nbG9iYWxfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5nZXRfb3duZXIoKSAtPiBieXRlczoKZ2V0X293bmVyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5ODYtOTg3CiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgcHJvdG8gMCAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk4OAogICAgLy8gcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY1CiAgICAvLyBzZWxmLm93bmVyID0gQWNjb3VudCgpCiAgICBieXRlICJvd25lciIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTg4CiAgICAvLyByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYub3duZXIgZXhpc3RzCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC50cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyOiBieXRlcykgLT4gdm9pZDoKdHJhbnNmZXJfb3duZXJzaGlwOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5OTAtOTkxCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTkyCiAgICAvLyBzZWxmLl9vbmx5X293bmVyKCkKICAgIGNhbGxzdWIgX29ubHlfb3duZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY1CiAgICAvLyBzZWxmLm93bmVyID0gQWNjb3VudCgpCiAgICBieXRlICJvd25lciIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTkzLTk5NAogICAgLy8gIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICBmcmFtZV9kaWcgLTEKICAgIGFwcF9nbG9iYWxfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fb25seV9vd25lcigpIC0+IHZvaWQ6Cl9vbmx5X293bmVyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5ODItOTgzCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICBwcm90byAwIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTg0CiAgICAvLyBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIHR4biBTZW5kZXIKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2NQogICAgLy8gc2VsZi5vd25lciA9IEFjY291bnQoKQogICAgYnl0ZSAib3duZXIiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk4NAogICAgLy8gYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYub3duZXIgZXhpc3RzCiAgICA9PQogICAgYXNzZXJ0IC8vIG9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24KICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLmlzX3BhdXNlZCgpIC0+IGJ5dGVzOgppc19wYXVzZWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMDYtMTAwNwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIHByb3RvIDAgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDA4CiAgICAvLyByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgY2FsbHN1YiBfaXNfcGF1c2VkCiAgICBieXRlIDB4MDAKICAgIGludCAwCiAgICB1bmNvdmVyIDIKICAgIHNldGJpdAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2lzX3BhdXNlZCgpIC0+IHVpbnQ2NDoKX2lzX3BhdXNlZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAxMC0xMDExCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIHByb3RvIDAgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDEyCiAgICAvLyByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjYKICAgIC8vIHNlbGYucGF1c2VkID0gVUludDY0KCkKICAgIGJ5dGUgInBhdXNlZCIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAxMgogICAgLy8gcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnBhdXNlZCBleGlzdHMKICAgIGludCAxCiAgICA9PQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wucGF1c2UocGF1c2U6IGJ5dGVzKSAtPiB2b2lkOgpwYXVzZToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAxNC0xMDE1CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAxNgogICAgLy8gc2VsZi5fb25seV9vd25lcigpCiAgICBjYWxsc3ViIF9vbmx5X293bmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMTctMTAxOAogICAgLy8gIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2NgogICAgLy8gc2VsZi5wYXVzZWQgPSBVSW50NjQoKQogICAgYnl0ZSAicGF1c2VkIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDE3LTEwMTgKICAgIC8vICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIHN3YXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkOiBieXRlcykgLT4gdm9pZDoKc2V0X3N0b2tlbl9hcHBfaWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjYtMTAyNwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyOAogICAgLy8gc2VsZi5fb25seV9vd25lcigpCiAgICBjYWxsc3ViIF9vbmx5X293bmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjktMTAzMAogICAgLy8gIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBjYWxsc3ViIF9zZXRfc3Rva2VuX2FwcF9pZAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQ6IHVpbnQ2NCkgLT4gdm9pZDoKX3NldF9zdG9rZW5fYXBwX2lkOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyLTEwMzMKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIHByb3RvIDEgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDM1CiAgICAvLyBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIGdsb2JhbCBDdXJyZW50QXBwbGljYXRpb25BZGRyZXNzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzYtMTAzOQogICAgLy8gIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgZnJhbWVfZGlnIC0xCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIG1ldGhvZCAiaXNfbWludGVyKGFkZHJlc3MpYm9vbCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZHVwCiAgICBleHRyYWN0IDQgMAogICAgc3dhcAogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDQyCiAgICAvLyBpc19hcHByb3ZlZF9taW50ZXIKICAgIGJ5dGUgMHgwMAogICAgIT0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA0MC0xMDQzCiAgICAvLyAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgYXNzZXJ0IC8vIExlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY3CiAgICAvLyBzZWxmLnN0b2tlbl9hcHBfaWQgPSBVSW50NjQoKSAgIyBzdGFibGUgbWFya2V0CiAgICBieXRlICJzdG9rZW5fYXBwX2lkIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDQ0CiAgICAvLyBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICBmcmFtZV9kaWcgLTEKICAgIGFwcF9nbG9iYWxfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5nZXRfdXNlcih1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiBieXRlcykgLT4gYnl0ZXM6CmdldF91c2VyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDU0LTEwNTUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICBwcm90byAyIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA1NgogICAgLy8gcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTIKICAgIHN3YXAKICAgIGNhbGxzdWIgX2dldF91c2VyCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZ2V0X3VzZXIodXNlcl9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0KSAtPiBieXRlczoKX2dldF91c2VyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDU4LTEwNTkKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDYwCiAgICAvLyB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X3VzZXJfa2V5CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk3MAogICAgLy8gc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICBieXRlICJ1c2VycyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTcwLTEwNjEKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNjEKICAgIC8vIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICBieiBfZ2V0X3VzZXJfZWxzZV9ib2R5QDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA2MgogICAgLy8gcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICBmcmFtZV9kaWcgMAogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYudXNlcnMgZW50cnkgZXhpc3RzCiAgICBzd2FwCiAgICByZXRzdWIKCl9nZXRfdXNlcl9lbHNlX2JvZHlAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA2NAogICAgLy8gYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICBieXRlIDB4NzM3NDZmNzI2MTY3NjU1ZjYxNzA3MDVmNjk2NAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDY1CiAgICAvLyBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIEJveCBleGlzdHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA2NgogICAgLy8gdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIGl0eG5fYmVnaW4KICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgbWV0aG9kICJnZXRfdXNlcl9kZWZhdWx0KCkodWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50NjQsdWludDI1NikiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZHVwCiAgICBleHRyYWN0IDQgMAogICAgc3dhcAogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDY3CiAgICAvLyByZXR1cm4gdXNlcgogICAgc3dhcAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2dldF91c2VyX2tleSh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQpIC0+IGJ5dGVzOgpfZ2V0X3VzZXJfa2V5OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDQ4LTEwNDkKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDUxCiAgICAvLyBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICBmcmFtZV9kaWcgLTEKICAgIGl0b2IKICAgIGZyYW1lX2RpZyAtMgogICAgc3dhcAogICAgY29uY2F0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNTAtMTA1MgogICAgLy8gcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyApCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5jcmVhdGVfbWFya2V0KHRva2VuX2lkOiBieXRlcywgY29sbGF0ZXJhbF9mYWN0b3I6IGJ5dGVzLCBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGJ5dGVzLCByZXNlcnZlX2ZhY3RvcjogYnl0ZXMsIGJvcnJvd19yYXRlOiBieXRlcywgc2xvcGU6IGJ5dGVzLCBtYXhfdG90YWxfZGVwb3NpdHM6IGJ5dGVzLCBtYXhfdG90YWxfYm9ycm93czogYnl0ZXMsIGxpcXVpZGF0aW9uX2JvbnVzOiBieXRlcywgY2xvc2VfZmFjdG9yOiBieXRlcykgLT4gYnl0ZXM6CmNyZWF0ZV9tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMjktMTE0MgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIHByb3RvIDEwIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE0MwogICAgLy8gc2VsZi5fb25seV9vd25lcigpCiAgICBjYWxsc3ViIF9vbmx5X293bmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNDQKICAgIC8vIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICBjYWxsc3ViIF9pc19wYXVzZWQKICAgICEKICAgIGFzc2VydCAvLyBQcm90b2NvbCBpcyBwYXVzZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE0OAogICAgLy8gbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIGZyYW1lX2RpZyAtOAogICAgYnRvaQogICAgZnJhbWVfZGlnIC05CiAgICBidG9pCiAgICA+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTQ2LTExNDkKICAgIC8vICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+PSBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID49IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID49IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgYXNzZXJ0IC8vIExpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID49IGNvbGxhdGVyYWwgZmFjdG9yCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNTIKICAgIC8vIHRva2VuX2lkLm5hdGl2ZSwKICAgIGZyYW1lX2RpZyAtMTAKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE2NwogICAgLy8gbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNTQKICAgIC8vIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIGJ5dGUgMHg4MAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTUzLTExNzQKICAgIC8vIE1hcmtldERhdGEoCiAgICAvLyAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgMAogICAgLy8gICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyApLAogICAgZnJhbWVfZGlnIC00CiAgICBjb25jYXQKICAgIGZyYW1lX2RpZyAtMwogICAgY29uY2F0CiAgICBmcmFtZV9kaWcgLTIKICAgIGNvbmNhdAogICAgZnJhbWVfZGlnIC05CiAgICBjb25jYXQKICAgIGZyYW1lX2RpZyAtOAogICAgY29uY2F0CiAgICBmcmFtZV9kaWcgLTcKICAgIGNvbmNhdAogICAgZnJhbWVfZGlnIC02CiAgICBjb25jYXQKICAgIGZyYW1lX2RpZyAtNQogICAgY29uY2F0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNjMKICAgIC8vIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTUzLTExNzQKICAgIC8vIE1hcmtldERhdGEoCiAgICAvLyAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgMAogICAgLy8gICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyApLAogICAgY29uY2F0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNjQKICAgIC8vIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNTMtMTE3NAogICAgLy8gTWFya2V0RGF0YSgKICAgIC8vICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAwCiAgICAvLyAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICksCiAgICBjb25jYXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE2NQogICAgLy8gZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE1My0xMTc0CiAgICAvLyBNYXJrZXREYXRhKAogICAgLy8gICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIDAKICAgIC8vICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gKSwKICAgIGNvbmNhdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTY2CiAgICAvLyBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNTMtMTE3NAogICAgLy8gTWFya2V0RGF0YSgKICAgIC8vICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAwCiAgICAvLyAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICksCiAgICBjb25jYXQKICAgIHN3YXAKICAgIGNvbmNhdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTY4CiAgICAvLyByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTUzLTExNzQKICAgIC8vIE1hcmtldERhdGEoCiAgICAvLyAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgMAogICAgLy8gICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyApLAogICAgY29uY2F0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNjktMTE3MQogICAgLy8gcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgIDAKICAgIC8vICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNTMtMTE3NAogICAgLy8gTWFya2V0RGF0YSgKICAgIC8vICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAwCiAgICAvLyAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICksCiAgICBjb25jYXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE3MgogICAgLy8gbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNTMtMTE3NAogICAgLy8gTWFya2V0RGF0YSgKICAgIC8vICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAwCiAgICAvLyAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICksCiAgICBjb25jYXQKICAgIGZyYW1lX2RpZyAtMQogICAgY29uY2F0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNTEtMTE3NQogICAgLy8gc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICksCiAgICAvLyApCiAgICBjYWxsc3ViIF9jcmVhdGVfbWFya2V0CiAgICBwb3AKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE1MC0xMTc2CiAgICAvLyByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyApCiAgICBpdG9iCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fY3JlYXRlX21hcmtldCh0b2tlbl9pZDogdWludDY0LCBtYXJrZXRfZGF0YTogYnl0ZXMpIC0+IHVpbnQ2NCwgYnl0ZXM6Cl9jcmVhdGVfbWFya2V0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTc4LTExNzkKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIHByb3RvIDIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjktMTE4MAogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+PSBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPj0gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID49IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICBmcmFtZV9kaWcgLTIKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY5CiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OS0xMTgwCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIGRpZyAxCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAhCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExODAKICAgIC8vIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgYXNzZXJ0IC8vIE1hcmtldCBhbHJlYWR5IGV4aXN0cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTgxCiAgICAvLyBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICB0eG4gU2VuZGVyCiAgICBjYWxsc3ViIHJlcXVpcmVfcGF5bWVudAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTgyCiAgICAvLyBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICBpbnQgMjAwMDAwMAogICAgPj0KICAgIGFzc2VydCAvLyBpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTg0CiAgICAvLyBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE4MwogICAgLy8gY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgaW50IDYKICAgIGl0eG5fZmllbGQgR2xvYmFsTnVtVWludAogICAgaW50IDYKICAgIGl0eG5fZmllbGQgR2xvYmFsTnVtQnl0ZVNsaWNlCiAgICBieXRlIGJhc2U2NCBDb0VCUXc9PQogICAgaXR4bl9maWVsZCBDbGVhclN0YXRlUHJvZ3JhbVBhZ2VzCiAgICBieXRlIGJhc2U2NCBDaUFFQUFFZ0JpWVRCQlVmZkhVTGRHOTBZV3hUZFhCd2JIa0ZiM2R1WlhJQUNHSmhiR0Z1WTJWekNIVndaM0poWkdWeUNIUnZhMlZ1WDJsa0JHNWhiV1VHYzNsdFltOXNDR1JsWTJsdFlXeHpCSG1EdzF3QkFBUmxmUlBzQkxhdUdpVUVoT3dUMVJCamIyNTBjbUZqZEY5MlpYSnphVzl1RW1SbGNHeHZlVzFsYm5SZmRtVnljMmx2Ymdsd1lYSmxiblJmYVdRSmRYQmtZWFJoWW14bE1SaEFBQU9JQkpJeEcwRUJ1SUlIQktheTAvc0V0WlhzRXdUeFVGVW5CUE40TndFRTJuQWx1UVJLbG8rUEJMVkNJU1VuRENjTkp3NkNDQVRzbVdCQkJJTGxjOFFFdTdNWjh3VC9LNlhGQklVbVRYNEVlTHlaMUFUVWxyOURCR3NMai9nMkdnQ09FZ0FCQUJBQUlnQXhBRU1BV1FCeUFJZ0FtQUNvQUxnQXlBRGJBUEVCQVFFUUFTSUJNUUF4R1JSRU1SaEVOaG9CaUFGSkkwTXhHUlJFTVJoRU5ob0JOaG9DaUFISkkwTXhHUlJFTVJoRU5ob0JpQUlWSTBNeEdSUkVNUmhFTmhvQk5ob0NpQUpVSTBNeEdSUkVNUmhFTmhvQk5ob0NpQUtpS0V4UXNDTkRNUmtVUkRFWVJEWWFBVFlhQWpZYUE0Z0NqeWhNVUxBalF6RVpGRVF4R0VRMkdnRTJHZ0tJQW44b1RGQ3dJME14R1JSRU1SaEVpQUoxS0V4UXNDTkRNUmtVUkRFWVJJZ0NiaWhNVUxBalF6RVpGRVF4R0VTSUFtY29URkN3STBNeEdSUkVNUmhFaUFKa0tFeFFzQ05ETVJrVVJERVlSRFlhQVlnQ1lTaE1VTEFqUXpFWkZFUXhHRVEyR2dFMkdnS0lBbHdvVEZDd0kwTXhHUlJFTVJoRWlBSjdLRXhRc0NORE1Sa1VSREVZUkRZYUFZZ0NjQ05ETVJrVVJERVlSRFlhQVRZYUFvZ0NqaU5ETVJrVVJERVlSRFlhQVlnQ255TkRNUmtVUkRFWVJDTkRJb0VFTVJtT0FnQUJBQW9BTVJnVVJJZ0NvU05ETVJoRWlBS2xJME9LQVFBaUp3WmxSQlJFaS84WGlBQUJpWW9CQUxHTC83SVlKdzZ5R2lXeUVDS3lBYk8wUGtsWEJBQk1Wd0FFS0JKRXNZdi9zaGduRExJYUpiSVFJcklCczdRK1NWY0VBRXhYQUFRb0VrU3hpLyt5R0NjTnNob2xzaEFpc2dHenRENUpWd1FBVEZjQUJDZ1NSSUFIUkc5eWEwWnBJRThDVUNjSFRHZUFBVzVNVUNjSVRHY1hKd2xNWnlrclp5Y0dpLzluaVlvQ0FERUFJaXBsUkJKRWkvNkwvNGdBQVltS0FnQWlLV1ZFaS8rZ0tVeG5pLzZJQUNnbkJJditVRXlMLzZCTVNieElUTDh5QTR2L0ZTUU9SQ1N2aS8rclRJditVRXhRSndwTVVMQ0ppZ0VCSndTTC8xQytLMDRDVFltS0FRQWlLbVZFTVFBU1JJdi9pQUFCaVlvQkFERUFpUC9aU1l2L3AwUW5CREVBVUV5TC82Rk1TYnhJVEw4aUtXVkVpLytoS1V4bk1RQXlBNHYvRlNRT1JDU3ZpLytyVGdKUVRGQW5Da3hRc0ltS0FnQWlLbVZFTVFBU1JJditpLytJQUFHSmlnSUFpLzZJLzRhTC95dWxSRW1MLzZkRUlpbGxSSXYvcDBRbkJJditVRXlMLzZGTVNieElUTDhpS1dWRWkvK2hLVXhuTWdPTC94VWtEa1FrcjR2L3E0ditUd0pRVEZBbkNreFFzSW1LQWdFbkM0bUtBd0VuQzRtS0FnRW5DNG1LQUFFaUp3ZGxSSW1LQUFFaUp3aGxSSW1LQUFFaUp3bGxSQlpYQndHSmlnQUJJaWxsUkVrVkpBNUVKSytyaVlvQkFZdi9pUDc0U1JVa0RrUWtyNnVKaWdJQmkvNkwvNGdBQ1VrVkpBNUVKSytyaVlvQ0FZditpLzlRQVlBSllYQndjbTkyWVd4elRGQytLMDRDVFltS0FBRWlLbVZFaVlvQkFJZ0FCb3YvaUFBTmlZb0FBREVBSWlwbFJCSkVpWW9CQUNJcVpVUXFpLzluaS85UWdBU2FJajc3VEZDd2lZb0NBSXYraS85UWdBU01qUG5OVEZDd2kvNFhKdzlNWjR2L0Z5Y1FUR2VKaWdFQU1RQXlDUkpFSWljRlpVU0wvMUNBQkszMTRyaE1VTEFuQll2L1o0bUtBQUF5RFVsRUp4Rk1aNG1LQUFBeEFDSW5CV1ZFRWtRaUp4SmxSQ01TUkltS0FBQW5CeXRuSndnclp5Y0pJbWNwSzJjbkVTSm5Kd1lpWnlveUNXY25EeUpuSnhBaVp5Y1NJMmNuQlRJSlo0az0KICAgIGl0eG5fZmllbGQgQXBwcm92YWxQcm9ncmFtUGFnZXMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE4NAogICAgLy8gYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgaXR4biBDcmVhdGVkQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTg1LTExODcKICAgIC8vIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyApLnN1Ym1pdCgpCiAgICBpdHhuX2JlZ2luCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExODYKICAgIC8vIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIGR1cAogICAgYXBwX3BhcmFtc19nZXQgQXBwQWRkcmVzcwogICAgYXNzZXJ0IC8vIGFwcGxpY2F0aW9uIGV4aXN0cwogICAgaW50IDEwMDAwMDAKICAgIGl0eG5fZmllbGQgQW1vdW50CiAgICBpdHhuX2ZpZWxkIFJlY2VpdmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExODUKICAgIC8vIGl0eG4uUGF5bWVudCgKICAgIGludCBwYXkKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE4NgogICAgLy8gcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExODUtMTE4NwogICAgLy8gaXR4bi5QYXltZW50KAogICAgLy8gICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICkuc3VibWl0KCkKICAgIGl0eG5fc3VibWl0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExODgtMTE5MgogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIGR1cAogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICBtZXRob2QgImJvb3RzdHJhcDY0KHVpbnQ2NCl2b2lkIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGRpZyAyCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE5MwogICAgLy8gbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICBkdXAKICAgIGl0b2IKICAgIGZyYW1lX2RpZyAtMQogICAgaW50IDMxMwogICAgdW5jb3ZlciAyCiAgICByZXBsYWNlMwogICAgZnJhbWVfYnVyeSAtMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTk0CiAgICAvLyBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICBzd2FwCiAgICBmcmFtZV9kaWcgLTEKICAgIGJveF9wdXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE5NQogICAgLy8gYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIG1ldGhvZCAiTWFya2V0Q3JlYXRlZCh1aW50NjQpIgogICAgdW5jb3ZlciAyCiAgICBjb25jYXQKICAgIGxvZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTk2CiAgICAvLyByZXR1cm4gYmFzZV9hcHAuaWQKICAgIGZyYW1lX2RpZyAtMQogICAgcmV0c3ViCgoKLy8gb3BlbnN1Ym1hcmluZS51dGlscy5hbGdvcmFuZC5yZXF1aXJlX3BheW1lbnQod2hvOiBieXRlcykgLT4gdWludDY0OgpyZXF1aXJlX3BheW1lbnQ6CiAgICAvLyB1c3IvbG9jYWwvbGliL3B5dGhvbjMuMTIvc2l0ZS1wYWNrYWdlcy9vcGVuc3VibWFyaW5lL3V0aWxzL2FsZ29yYW5kLnB5OjE1LTIzCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjIGZ1bmN0aW9uOiByZXF1aXJlX3BheW1lbnQgKGludGVybmFsKQogICAgLy8gIyBhcmd1bWVudHM6IE5vbmUKICAgIC8vICMgcHVycG9zZTogY2hlY2sgcGF5bWVudAogICAgLy8gIyBwcmUtY29uZGl0aW9uczogTm9uZQogICAgLy8gIyBwb3N0LWNvbmRpdGlvbnM6IE5vbmUKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgcmVxdWlyZV9wYXltZW50KHdobzogQWNjb3VudCkgLT4gVUludDY0OgogICAgcHJvdG8gMSAxCiAgICAvLyB1c3IvbG9jYWwvbGliL3B5dGhvbjMuMTIvc2l0ZS1wYWNrYWdlcy9vcGVuc3VibWFyaW5lL3V0aWxzL2FsZ29yYW5kLnB5OjI0CiAgICAvLyByZWZfZ3JvdXBfaW5kZXggPSBUeG4uZ3JvdXBfaW5kZXgKICAgIHR4biBHcm91cEluZGV4CiAgICAvLyB1c3IvbG9jYWwvbGliL3B5dGhvbjMuMTIvc2l0ZS1wYWNrYWdlcy9vcGVuc3VibWFyaW5lL3V0aWxzL2FsZ29yYW5kLnB5OjI1CiAgICAvLyBhc3NlcnQgcmVmX2dyb3VwX2luZGV4ID4gMCwgImdyb3VwIGluZGV4IGdyZWF0ZXIgdGhhbiB6ZXJvIgogICAgZHVwCiAgICBhc3NlcnQgLy8gZ3JvdXAgaW5kZXggZ3JlYXRlciB0aGFuIHplcm8KICAgIC8vIHVzci9sb2NhbC9saWIvcHl0aG9uMy4xMi9zaXRlLXBhY2thZ2VzL29wZW5zdWJtYXJpbmUvdXRpbHMvYWxnb3JhbmQucHk6MjYKICAgIC8vIHBheW1lbnRfZ3JvdXBfaW5kZXggPSByZWZfZ3JvdXBfaW5kZXggLSAxCiAgICBpbnQgMQogICAgLQogICAgLy8gdXNyL2xvY2FsL2xpYi9weXRob24zLjEyL3NpdGUtcGFja2FnZXMvb3BlbnN1Ym1hcmluZS91dGlscy9hbGdvcmFuZC5weToyOAogICAgLy8gZ3R4bi5QYXltZW50VHJhbnNhY3Rpb24ocGF5bWVudF9ncm91cF9pbmRleCkuc2VuZGVyID09IHdobwogICAgZHVwCiAgICBndHhucyBUeXBlRW51bQogICAgaW50IHBheQogICAgPT0KICAgIGFzc2VydCAvLyB0cmFuc2FjdGlvbiB0eXBlIGlzIHBheQogICAgZHVwCiAgICBndHhucyBTZW5kZXIKICAgIGZyYW1lX2RpZyAtMQogICAgPT0KICAgIC8vIHVzci9sb2NhbC9saWIvcHl0aG9uMy4xMi9zaXRlLXBhY2thZ2VzL29wZW5zdWJtYXJpbmUvdXRpbHMvYWxnb3JhbmQucHk6MjctMjkKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgZ3R4bi5QYXltZW50VHJhbnNhY3Rpb24ocGF5bWVudF9ncm91cF9pbmRleCkuc2VuZGVyID09IHdobwogICAgLy8gKSwgInBheW1lbnQgc2VuZGVyIGFjY3VyYXRlIgogICAgYXNzZXJ0IC8vIHBheW1lbnQgc2VuZGVyIGFjY3VyYXRlCiAgICAvLyB1c3IvbG9jYWwvbGliL3B5dGhvbjMuMTIvc2l0ZS1wYWNrYWdlcy9vcGVuc3VibWFyaW5lL3V0aWxzL2FsZ29yYW5kLnB5OjMxCiAgICAvLyBndHhuLlBheW1lbnRUcmFuc2FjdGlvbihwYXltZW50X2dyb3VwX2luZGV4KS5yZWNlaXZlcgogICAgZHVwCiAgICBndHhucyBSZWNlaXZlcgogICAgLy8gdXNyL2xvY2FsL2xpYi9weXRob24zLjEyL3NpdGUtcGFja2FnZXMvb3BlbnN1Ym1hcmluZS91dGlscy9hbGdvcmFuZC5weTozMgogICAgLy8gPT0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgZ2xvYmFsIEN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MKICAgIC8vIHVzci9sb2NhbC9saWIvcHl0aG9uMy4xMi9zaXRlLXBhY2thZ2VzL29wZW5zdWJtYXJpbmUvdXRpbHMvYWxnb3JhbmQucHk6MzEtMzIKICAgIC8vIGd0eG4uUGF5bWVudFRyYW5zYWN0aW9uKHBheW1lbnRfZ3JvdXBfaW5kZXgpLnJlY2VpdmVyCiAgICAvLyA9PSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICA9PQogICAgLy8gdXNyL2xvY2FsL2xpYi9weXRob24zLjEyL3NpdGUtcGFja2FnZXMvb3BlbnN1Ym1hcmluZS91dGlscy9hbGdvcmFuZC5weTozMC0zMwogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBndHhuLlBheW1lbnRUcmFuc2FjdGlvbihwYXltZW50X2dyb3VwX2luZGV4KS5yZWNlaXZlcgogICAgLy8gICAgID09IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICksICJwYXltZW50IHJlY2VpdmVyIGFjY3VyYXRlIgogICAgYXNzZXJ0IC8vIHBheW1lbnQgcmVjZWl2ZXIgYWNjdXJhdGUKICAgIC8vIHVzci9sb2NhbC9saWIvcHl0aG9uMy4xMi9zaXRlLXBhY2thZ2VzL29wZW5zdWJtYXJpbmUvdXRpbHMvYWxnb3JhbmQucHk6MzQKICAgIC8vIHJldHVybiBndHhuLlBheW1lbnRUcmFuc2FjdGlvbihwYXltZW50X2dyb3VwX2luZGV4KS5hbW91bnQKICAgIGd0eG5zIEFtb3VudAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkOiBieXRlcykgLT4gdm9pZDoKc2V0X3N0b3JhZ2VfYXBwX2lkOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTk4LTExOTkKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIwMAogICAgLy8gYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICBieXRlIDB4NzM3NDZmNzI2MTY3NjU1ZjYxNzA3MDVmNjk2NAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjAxCiAgICAvLyBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgZnJhbWVfZGlnIC0xCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5nZXRfbWFya2V0KHRva2VuX2lkOiBieXRlcykgLT4gYnl0ZXM6CmdldF9tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMDMtMTIwNAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICBwcm90byAxIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIwNQogICAgLy8gcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZ2V0X21hcmtldCh0b2tlbl9pZDogdWludDY0KSAtPiBieXRlczoKX2dldF9tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMDctMTIwOAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OS0xMjA5CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgZnJhbWVfZGlnIC0xCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OQogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjktMTIwOQogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+PSBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPj0gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID49IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIHN3YXAKICAgIGNvbmNhdAogICAgZHVwCiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIwOQogICAgLy8gaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgYnogX2dldF9tYXJrZXRfZWxzZV9ib2R5QDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIxMAogICAgLy8gcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIGZyYW1lX2RpZyAwCiAgICBib3hfZ2V0CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5tYXJrZXRzIGVudHJ5IGV4aXN0cwogICAgc3dhcAogICAgcmV0c3ViCgpfZ2V0X21hcmtldF9lbHNlX2JvZHlAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIxMgogICAgLy8gYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICBieXRlIDB4NzM3NDZmNzI2MTY3NjU1ZjYxNzA3MDVmNjk2NAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjEzCiAgICAvLyBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIEJveCBleGlzdHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIxNC0xMjE2CiAgICAvLyBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICBtZXRob2QgImdldF9tYXJrZXRfZGVmYXVsdCgpKGJvb2wsdWludDI1Nix1aW50MjU2LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDY0LHVpbnQyNTYsdWludDI1Nix1aW50NjQsdWludDY0KSIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgaXR4biBMYXN0TG9nCiAgICBkdXAKICAgIGV4dHJhY3QgNCAwCiAgICBzd2FwCiAgICBleHRyYWN0IDAgNAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICA9PQogICAgYXNzZXJ0IC8vIEFSQzQgcHJlZml4IGlzIHZhbGlkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMTcKICAgIC8vIHJldHVybiBtYXJrZXQKICAgIHN3YXAKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkOiBieXRlcykgLT4gYnl0ZXM6CmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjE5LTEyMjAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICBwcm90byAxIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIyMQogICAgLy8gcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgY2FsbHN1YiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZDogdWludDY0KSAtPiBieXRlczoKX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjIzLTEyMjQKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk3Mi0xMjI1CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICBmcmFtZV9kaWcgLTEKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTcyCiAgICAvLyBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgYnl0ZSAibWFya2V0X3RyYW5zYWN0aW9uX2NhcHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk3Mi0xMjI1CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMjUKICAgIC8vIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICBieiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZWxzZV9ib2R5QDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIyNgogICAgLy8gcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICBmcmFtZV9kaWcgMAogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgZW50cnkgZXhpc3RzCiAgICBzd2FwCiAgICByZXRzdWIKCl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9lbHNlX2JvZHlAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIyOAogICAgLy8gYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICBieXRlIDB4NzM3NDZmNzI2MTY3NjU1ZjYxNzA3MDVmNjk2NAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjI5CiAgICAvLyBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIEJveCBleGlzdHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIzMC0xMjMyCiAgICAvLyBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyApCiAgICBpdHhuX2JlZ2luCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIG1ldGhvZCAiZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCgpKHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYpIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGR1cAogICAgZXh0cmFjdCA0IDAKICAgIHN3YXAKICAgIGV4dHJhY3QgMCA0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgID09CiAgICBhc3NlcnQgLy8gQVJDNCBwcmVmaXggaXMgdmFsaWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIzMwogICAgLy8gcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIHN3YXAKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLmdldF91c2VyX2NhcCh1c2VyX2lkOiBieXRlcykgLT4gYnl0ZXM6CmdldF91c2VyX2NhcDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIzNS0xMjM2CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMzcKICAgIC8vIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2dldF91c2VyX2NhcAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2dldF91c2VyX2NhcCh1c2VyX2lkOiBieXRlcykgLT4gYnl0ZXM6Cl9nZXRfdXNlcl9jYXA6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMzktMTI0MAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICBwcm90byAxIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTc1CiAgICAvLyBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICBieXRlICJ1c2VyX2NhcHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk3NS0xMjQxCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+PSBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPj0gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID49IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgZnJhbWVfZGlnIC0xCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNDEKICAgIC8vIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICBieiBfZ2V0X3VzZXJfY2FwX2Vsc2VfYm9keUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNDIKICAgIC8vIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgZnJhbWVfZGlnIDAKICAgIGJveF9nZXQKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnVzZXJfY2FwcyBlbnRyeSBleGlzdHMKICAgIHN3YXAKICAgIHJldHN1YgoKX2dldF91c2VyX2NhcF9lbHNlX2JvZHlAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI0NAogICAgLy8gYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICBieXRlIDB4NzM3NDZmNzI2MTY3NjU1ZjYxNzA3MDVmNjk2NAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjQ1CiAgICAvLyBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIEJveCBleGlzdHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI0Ni0xMjQ4CiAgICAvLyB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgbWV0aG9kICJnZXRfdXNlcl9jYXBfZGVmYXVsdCgpKHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQ2NCkiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZHVwCiAgICBleHRyYWN0IDQgMAogICAgc3dhcAogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjQ5CiAgICAvLyByZXR1cm4gdXNlcl9jYXAKICAgIHN3YXAKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLnNldF91c2VyX2NhcCh1c2VyX2lkOiBieXRlcywgdXNlcl9jYXA6IGJ5dGVzKSAtPiB2b2lkOgpzZXRfdXNlcl9jYXA6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNTEtMTI1MgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI1MwogICAgLy8gc2VsZi5fb25seV9vd25lcigpCiAgICBjYWxsc3ViIF9vbmx5X293bmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNTQKICAgIC8vIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfc2V0X3VzZXJfY2FwCiAgICBmcmFtZV9idXJ5IC0xCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fc2V0X3VzZXJfY2FwKHVzZXJfaWQ6IGJ5dGVzLCB1c2VyX2NhcDogYnl0ZXMpIC0+IGJ5dGVzOgpfc2V0X3VzZXJfY2FwOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjU2LTEyNTcKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NzUKICAgIC8vIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIGJ5dGUgInVzZXJfY2FwcyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI1OAogICAgLy8gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIGZyYW1lX2RpZyAtMgogICAgY29uY2F0CiAgICBmcmFtZV9kaWcgLTEKICAgIGJveF9wdXQKICAgIGZyYW1lX2RpZyAtMQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQ6IGJ5dGVzLCB0cmFuc2FjdGlvbl9jYXA6IGJ5dGVzKSAtPiB2b2lkOgpzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI2MS0xMjY0CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjY1CiAgICAvLyBzZWxmLl9vbmx5X293bmVyKCkKICAgIGNhbGxzdWIgX29ubHlfb3duZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI2NgogICAgLy8gc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ0b2kKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIGZyYW1lX2J1cnkgLTEKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZDogdWludDY0LCB0cmFuc2FjdGlvbl9jYXA6IGJ5dGVzKSAtPiBieXRlczoKX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjY4LTEyNzEKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjcyCiAgICAvLyBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIGZyYW1lX2RpZyAtMgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NzIKICAgIC8vIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICBieXRlICJtYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI3MgogICAgLy8gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICBzd2FwCiAgICBjb25jYXQKICAgIGZyYW1lX2RpZyAtMQogICAgYm94X3B1dAogICAgZnJhbWVfZGlnIC0xCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZDogYnl0ZXMpIC0+IGJ5dGVzOgpnZXRfcHJpY2VfZmVlZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI3OS0xMjgwCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIHByb3RvIDEgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjgxCiAgICAvLyByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBjYWxsc3ViIF9nZXRfcHJpY2VfZmVlZAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkOiB1aW50NjQpIC0+IGJ5dGVzOgpfZ2V0X3ByaWNlX2ZlZWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyODMtMTI4NAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk3Ni0xMjg1CiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc29tZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIGZyYW1lX2RpZyAtMQogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NzYKICAgIC8vIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICBieXRlICJwcmljZV9mZWVkcyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTc2LTEyODUKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPj0gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID49IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+PSBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zb21lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgc3dhcAogICAgY29uY2F0CiAgICBkdXAKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjg1CiAgICAvLyBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgYnogX2dldF9wcmljZV9mZWVkX2Vsc2VfYm9keUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyODYKICAgIC8vIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgZnJhbWVfZGlnIDAKICAgIGJveF9nZXQKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnByaWNlX2ZlZWRzIGVudHJ5IGV4aXN0cwogICAgc3dhcAogICAgcmV0c3ViCgpfZ2V0X3ByaWNlX2ZlZWRfZWxzZV9ib2R5QDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyODgKICAgIC8vIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgYnl0ZSAweDczNzQ2ZjcyNjE2NzY1NWY2MTcwNzA1ZjY5NjQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI4OQogICAgLy8gYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIGJveF9nZXQKICAgIGFzc2VydCAvLyBjaGVjayBCb3ggZXhpc3RzCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyOTAtMTI5MgogICAgLy8gcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICBtZXRob2QgImdldF9wcmljZV9mZWVkX2RlZmF1bHQoKSh1aW50NjQsdWludDY0LCh1aW50MjU2LHVpbnQ2NCkpIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGR1cAogICAgZXh0cmFjdCA0IDAKICAgIHN3YXAKICAgIGV4dHJhY3QgMCA0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgID09CiAgICBhc3NlcnQgLy8gQVJDNCBwcmVmaXggaXMgdmFsaWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI5MwogICAgLy8gcmV0dXJuIHByaWNlX2ZlZWQKICAgIHN3YXAKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLnNldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKG9wZXJhdG9yX2lkOiBieXRlcykgLT4gdm9pZDoKc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyOTUtMTI5NgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZiwgb3BlcmF0b3JfaWQ6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIHByb3RvIDEgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjk3CiAgICAvLyBzZWxmLl9vbmx5X293bmVyKCkKICAgIGNhbGxzdWIgX29ubHlfb3duZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI5OAogICAgLy8gc2VsZi5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Iob3BlcmF0b3JfaWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcgogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3NldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKG9wZXJhdG9yX2lkOiBieXRlcykgLT4gdm9pZDoKX3NldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzAwLTEzMDEKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBBY2NvdW50KSAtPiBOb25lOgogICAgcHJvdG8gMSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMDIKICAgIC8vIG9wZXJhdG9yX2lkX2JveCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgYnl0ZSAweDYxNzU3NDY4NmY3MjY5N2E2NTY0NWY3MDcyNjk2MzY1NWY2ZjcwNjU3MjYxNzQ2ZjcyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMDMKICAgIC8vIG9wZXJhdG9yX2lkX2JveC52YWx1ZSA9IGFyYzQuQWRkcmVzcyhvcGVyYXRvcl9pZCkKICAgIGZyYW1lX2RpZyAtMQogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQ6IGJ5dGVzLCBwcm92aWRlcl9hcHBfaWQ6IGJ5dGVzKSAtPiB2b2lkOgphdHRhY2hfcHJpY2VfZmVlZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMyMi0xMzI1CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzI2CiAgICAvLyBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgY2FsbHN1YiBfb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMjcKICAgIC8vIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMgogICAgYnRvaQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBjYWxsc3ViIF9hdHRhY2hfcHJpY2VfZmVlZAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpIC0+IHZvaWQ6Cl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMTUtMTMxNgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYpIC0+IE5vbmU6CiAgICBwcm90byAwIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMxOAogICAgLy8gVHhuLnNlbmRlciA9PSBzZWxmLl9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICB0eG4gU2VuZGVyCiAgICBjYWxsc3ViIF9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcgogICAgPT0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMxOC0xMzE5CiAgICAvLyBUeG4uc2VuZGVyID09IHNlbGYuX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vIG9yIFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lcgogICAgYm56IF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3JfYm9vbF90cnVlQDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMxOQogICAgLy8gb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICB0eG4gU2VuZGVyCiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjUKICAgIC8vIHNlbGYub3duZXIgPSBBY2NvdW50KCkKICAgIGJ5dGUgIm93bmVyIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzE5CiAgICAvLyBvciBUeG4uc2VuZGVyID09IHNlbGYub3duZXIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5vd25lciBleGlzdHMKICAgID09CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMTgtMTMxOQogICAgLy8gVHhuLnNlbmRlciA9PSBzZWxmLl9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyBvciBUeG4uc2VuZGVyID09IHNlbGYub3duZXIKICAgIGJ6IF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3JfYm9vbF9mYWxzZUAzCgpfb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yX2Jvb2xfdHJ1ZUAyOgogICAgaW50IDEKICAgIGIgX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcl9ib29sX21lcmdlQDQKCl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3JfYm9vbF9mYWxzZUAzOgogICAgaW50IDAKCl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3JfYm9vbF9tZXJnZUA0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzE3LTEzMjAKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgVHhuLnNlbmRlciA9PSBzZWxmLl9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICAvLyApLCAib25seSBhdXRob3JpemVkIHByaWNlIG9wZXJhdG9yIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICBhc3NlcnQgLy8gb25seSBhdXRob3JpemVkIHByaWNlIG9wZXJhdG9yIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24KICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpIC0+IGJ5dGVzOgpfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMTAtMTMxMQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gQWNjb3VudDoKICAgIHByb3RvIDAgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzEzCiAgICAvLyByZXR1cm4gb3BlcmF0b3JfaWQuZ2V0KGRlZmF1bHQ9YXJjNC5BZGRyZXNzKHNlbGYub3duZXIpKS5uYXRpdmUKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2NQogICAgLy8gc2VsZi5vd25lciA9IEFjY291bnQoKQogICAgYnl0ZSAib3duZXIiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMTMKICAgIC8vIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLm93bmVyIGV4aXN0cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzEyCiAgICAvLyBvcGVyYXRvcl9pZCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgYnl0ZSAweDYxNzU3NDY4NmY3MjY5N2E2NTY0NWY3MDcyNjk2MzY1NWY2ZjcwNjU3MjYxNzQ2ZjcyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMTMKICAgIC8vIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgYm94X2dldAogICAgc2VsZWN0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQ6IHVpbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiB1aW50NjQpIC0+IHZvaWQ6Cl9hdHRhY2hfcHJpY2VfZmVlZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMyOS0xMzMwCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjktMTMzMQogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+PSBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPj0gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID49IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnNvbWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKG9wZXJhdG9yX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZiwgb3BlcmF0b3JfaWQ6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAgICAgb3BlcmF0b3JfaWRfYm94ID0gQm94KGFyYzQuQWRkcmVzcywga2V5PWIiYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvciIpCiAgICAvLyAgICAgb3BlcmF0b3JfaWRfYm94LnZhbHVlID0gYXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIEF1dGhvcml6ZWRQcmljZU9wZXJhdG9yU2V0KAogICAgLy8gICAgICMgICAgICAgICBhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yPWFyYzQuQWRkcmVzcyhvcGVyYXRvcl9pZCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYpIC0+IEFjY291bnQ6CiAgICAvLyAgICAgb3BlcmF0b3JfaWQgPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICByZXR1cm4gb3BlcmF0b3JfaWQuZ2V0KGRlZmF1bHQ9YXJjNC5BZGRyZXNzKHNlbGYub3duZXIpKS5uYXRpdmUKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgVHhuLnNlbmRlciA9PSBzZWxmLl9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgICAgIG9yIFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lcgogICAgLy8gICAgICksICJvbmx5IGF1dGhvcml6ZWQgcHJpY2Ugb3BlcmF0b3IgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgZnJhbWVfZGlnIC0yCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OQogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjktMTMzMQogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+PSBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPj0gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID49IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnNvbWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKG9wZXJhdG9yX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZiwgb3BlcmF0b3JfaWQ6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAgICAgb3BlcmF0b3JfaWRfYm94ID0gQm94KGFyYzQuQWRkcmVzcywga2V5PWIiYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvciIpCiAgICAvLyAgICAgb3BlcmF0b3JfaWRfYm94LnZhbHVlID0gYXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIEF1dGhvcml6ZWRQcmljZU9wZXJhdG9yU2V0KAogICAgLy8gICAgICMgICAgICAgICBhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yPWFyYzQuQWRkcmVzcyhvcGVyYXRvcl9pZCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYpIC0+IEFjY291bnQ6CiAgICAvLyAgICAgb3BlcmF0b3JfaWQgPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICByZXR1cm4gb3BlcmF0b3JfaWQuZ2V0KGRlZmF1bHQ9YXJjNC5BZGRyZXNzKHNlbGYub3duZXIpKS5uYXRpdmUKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgVHhuLnNlbmRlciA9PSBzZWxmLl9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgICAgIG9yIFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lcgogICAgLy8gICAgICksICJvbmx5IGF1dGhvcml6ZWQgcHJpY2Ugb3BlcmF0b3IgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgZGlnIDEKICAgIGNvbmNhdAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMzEKICAgIC8vIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgYXNzZXJ0IC8vIE1hcmtldCBleGlzdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTc2CiAgICAvLyBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgYnl0ZSAicHJpY2VfZmVlZHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk3Ni0xMzMyCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc29tZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Iob3BlcmF0b3JfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3ggPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3gudmFsdWUgPSBhcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgQXV0aG9yaXplZFByaWNlT3BlcmF0b3JTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I9YXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gQWNjb3VudDoKICAgIC8vICAgICBvcGVyYXRvcl9pZCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyID09IHNlbGYuX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICAgICAgb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICAvLyAgICAgKSwgIm9ubHkgYXV0aG9yaXplZCBwcmljZSBvcGVyYXRvciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgZGlnIDEKICAgIGNvbmNhdAogICAgZHVwCiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgICEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMzMgogICAgLy8gYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgYXNzZXJ0IC8vIFByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzMzCiAgICAvLyBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMzYKICAgIC8vIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgZnJhbWVfZGlnIC0xCiAgICBpdG9iCiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMzgKICAgIC8vIHByaWNlPW1hcmtldC5wcmljZSwKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMzkKICAgIC8vIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMzctMTM0MAogICAgLy8gcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gKSwKICAgIGNvbmNhdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzM0LTEzNDEKICAgIC8vIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgKSwKICAgIC8vICkKICAgIHVuY292ZXIgMwogICAgdW5jb3ZlciAyCiAgICBjb25jYXQKICAgIHN3YXAKICAgIGNvbmNhdAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQ6IGJ5dGVzKSAtPiB2b2lkOgpkZXRhY2hfcHJpY2VfZmVlZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM0OS0xMzUwCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM1MQogICAgLy8gc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIGNhbGxzdWIgX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzUyCiAgICAvLyBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ0b2kKICAgIGNhbGxzdWIgX2RldGFjaF9wcmljZV9mZWVkCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQ6IHVpbnQ2NCkgLT4gdm9pZDoKX2RldGFjaF9wcmljZV9mZWVkOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzU0LTEzNTUKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY5LTEzNTYKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPj0gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID49IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+PSBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zb21lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZiwgb3BlcmF0b3JfaWQ6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihvcGVyYXRvcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gICAgIG9wZXJhdG9yX2lkX2JveCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIG9wZXJhdG9yX2lkX2JveC52YWx1ZSA9IGFyYzQuQWRkcmVzcyhvcGVyYXRvcl9pZCkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBBdXRob3JpemVkUHJpY2VPcGVyYXRvclNldCgKICAgIC8vICAgICAjICAgICAgICAgYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcj1hcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmKSAtPiBBY2NvdW50OgogICAgLy8gICAgIG9wZXJhdG9yX2lkID0gQm94KGFyYzQuQWRkcmVzcywga2V5PWIiYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvciIpCiAgICAvLyAgICAgcmV0dXJuIG9wZXJhdG9yX2lkLmdldChkZWZhdWx0PWFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSkubmF0aXZlCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIFR4bi5zZW5kZXIgPT0gc2VsZi5fZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgICAgICBvciBUeG4uc2VuZGVyID09IHNlbGYub3duZXIKICAgIC8vICAgICApLCAib25seSBhdXRob3JpemVkIHByaWNlIG9wZXJhdG9yIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXSA9IFByaWNlRmVlZCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wPVByaWNlV2l0aFRpbWVzdGFtcCgKICAgIC8vICAgICAgICAgICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICksCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZEF0dGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgZnJhbWVfZGlnIC0xCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OQogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjktMTM1NgogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+PSBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPj0gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID49IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnNvbWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKG9wZXJhdG9yX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZiwgb3BlcmF0b3JfaWQ6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAgICAgb3BlcmF0b3JfaWRfYm94ID0gQm94KGFyYzQuQWRkcmVzcywga2V5PWIiYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvciIpCiAgICAvLyAgICAgb3BlcmF0b3JfaWRfYm94LnZhbHVlID0gYXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIEF1dGhvcml6ZWRQcmljZU9wZXJhdG9yU2V0KAogICAgLy8gICAgICMgICAgICAgICBhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yPWFyYzQuQWRkcmVzcyhvcGVyYXRvcl9pZCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYpIC0+IEFjY291bnQ6CiAgICAvLyAgICAgb3BlcmF0b3JfaWQgPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICByZXR1cm4gb3BlcmF0b3JfaWQuZ2V0KGRlZmF1bHQ9YXJjNC5BZGRyZXNzKHNlbGYub3duZXIpKS5uYXRpdmUKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgVHhuLnNlbmRlciA9PSBzZWxmLl9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgICAgIG9yIFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lcgogICAgLy8gICAgICksICJvbmx5IGF1dGhvcml6ZWQgcHJpY2Ugb3BlcmF0b3IgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBkaWcgMQogICAgY29uY2F0CiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM1NgogICAgLy8gYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGFzc2VydCAvLyBNYXJrZXQgZG9lcyBub3QgZXhpc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTc2CiAgICAvLyBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgYnl0ZSAicHJpY2VfZmVlZHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk3Ni0xMzU3CiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc29tZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Iob3BlcmF0b3JfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3ggPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3gudmFsdWUgPSBhcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgQXV0aG9yaXplZFByaWNlT3BlcmF0b3JTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I9YXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gQWNjb3VudDoKICAgIC8vICAgICBvcGVyYXRvcl9pZCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyID09IHNlbGYuX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICAgICAgb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICAvLyAgICAgKSwgIm9ubHkgYXV0aG9yaXplZCBwcmljZSBvcGVyYXRvciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgc3dhcAogICAgY29uY2F0CiAgICBkdXAKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzU3CiAgICAvLyBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgYXNzZXJ0IC8vIFByaWNlIGZlZWQgbm90IGF0dGFjaGVkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNTgKICAgIC8vIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgYm94X2RlbAogICAgcG9wCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkOiBieXRlcywgcHJpY2U6IGJ5dGVzKSAtPiB2b2lkOgpzZXRfbWFya2V0X3ByaWNlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzY1LTEzNjYKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNjcKICAgIC8vIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICBjYWxsc3ViIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM2OAogICAgLy8gYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIGNhbGxzdWIgX2lzX3BhdXNlZAogICAgIQogICAgYXNzZXJ0IC8vIFByb3RvY29sIGlzIHBhdXNlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzY5CiAgICAvLyBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX3NldF9tYXJrZXRfcHJpY2UKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkOiB1aW50NjQsIHByaWNlOiBieXRlcykgLT4gdm9pZDoKX3NldF9tYXJrZXRfcHJpY2U6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNzEtMTM3MgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcmljZTogQmlnVUludCkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjktMTM3MwogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+PSBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPj0gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID49IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnNvbWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKG9wZXJhdG9yX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZiwgb3BlcmF0b3JfaWQ6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAgICAgb3BlcmF0b3JfaWRfYm94ID0gQm94KGFyYzQuQWRkcmVzcywga2V5PWIiYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvciIpCiAgICAvLyAgICAgb3BlcmF0b3JfaWRfYm94LnZhbHVlID0gYXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIEF1dGhvcml6ZWRQcmljZU9wZXJhdG9yU2V0KAogICAgLy8gICAgICMgICAgICAgICBhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yPWFyYzQuQWRkcmVzcyhvcGVyYXRvcl9pZCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYpIC0+IEFjY291bnQ6CiAgICAvLyAgICAgb3BlcmF0b3JfaWQgPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICByZXR1cm4gb3BlcmF0b3JfaWQuZ2V0KGRlZmF1bHQ9YXJjNC5BZGRyZXNzKHNlbGYub3duZXIpKS5uYXRpdmUKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgVHhuLnNlbmRlciA9PSBzZWxmLl9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgICAgIG9yIFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lcgogICAgLy8gICAgICksICJvbmx5IGF1dGhvcml6ZWQgcHJpY2Ugb3BlcmF0b3IgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBkZWwgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWREZXRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBmcmFtZV9kaWcgLTIKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY5CiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OS0xMzczCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc29tZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Iob3BlcmF0b3JfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3ggPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3gudmFsdWUgPSBhcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgQXV0aG9yaXplZFByaWNlT3BlcmF0b3JTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I9YXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gQWNjb3VudDoKICAgIC8vICAgICBvcGVyYXRvcl9pZCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyID09IHNlbGYuX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICAgICAgb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICAvLyAgICAgKSwgIm9ubHkgYXV0aG9yaXplZCBwcmljZSBvcGVyYXRvciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGRpZyAxCiAgICBjb25jYXQKICAgIGR1cAogICAgY292ZXIgMgogICAgZHVwCiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM3MwogICAgLy8gYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGFzc2VydCAvLyBNYXJrZXQgZG9lcyBub3QgZXhpc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTc2CiAgICAvLyBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgYnl0ZSAicHJpY2VfZmVlZHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk3Ni0xMzc0CiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc29tZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Iob3BlcmF0b3JfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3ggPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3gudmFsdWUgPSBhcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgQXV0aG9yaXplZFByaWNlT3BlcmF0b3JTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I9YXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gQWNjb3VudDoKICAgIC8vICAgICBvcGVyYXRvcl9pZCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyID09IHNlbGYuX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICAgICAgb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICAvLyAgICAgKSwgIm9ubHkgYXV0aG9yaXplZCBwcmljZSBvcGVyYXRvciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICB1bmNvdmVyIDIKICAgIGNvbmNhdAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAhCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNzQKICAgIC8vIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIGFzc2VydCAvLyBQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM3NQogICAgLy8gYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ5dGUgMHgKICAgIGI+CiAgICBhc3NlcnQgLy8gUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzc3CiAgICAvLyBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgYm94X2dldAogICAgc3dhcAogICAgZHVwCiAgICB1bmNvdmVyIDIKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLm1hcmtldHMgZW50cnkgZXhpc3RzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNzktMTM4MAogICAgLy8gIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIGR1cAogICAgaW50IDAKICAgIGdldGJpdAogICAgYnl0ZSAweDAwCiAgICBpbnQgMAogICAgdW5jb3ZlciAyCiAgICBzZXRiaXQKICAgIGJ5dGUgMHgwMAogICAgIT0KICAgIGJ6IF9zZXRfbWFya2V0X3ByaWNlX2FmdGVyX2lmX2Vsc2VAMwogICAgZnJhbWVfZGlnIDEKICAgIGR1cAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICBiPT0KICAgIHN3YXAKICAgIGZyYW1lX2J1cnkgMgogICAgYnogX3NldF9tYXJrZXRfcHJpY2VfYWZ0ZXJfaWZfZWxzZUAzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzODEKICAgIC8vIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICBmcmFtZV9kaWcgMQogICAgaW50IDAKICAgIGR1cAogICAgc2V0Yml0CiAgICBmcmFtZV9idXJ5IDIKCl9zZXRfbWFya2V0X3ByaWNlX2FmdGVyX2lmX2Vsc2VAMzoKICAgIGZyYW1lX2RpZyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzODMtMTM4NAogICAgLy8gIyBTY2FsZSB0aGUgcHJpY2UgYnkgU0NBTEUgaW50ZXJuYWxseSBmb3Igc3RvcmFnZQogICAgLy8gbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiKgogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIGludCAyODEKICAgIHN3YXAKICAgIHJlcGxhY2UzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzODYKICAgIC8vIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBmcmFtZV9kaWcgMAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuZmV0Y2hfcHJpY2VfZmVlZCh0b2tlbl9pZDogYnl0ZXMpIC0+IHZvaWQ6CmZldGNoX3ByaWNlX2ZlZWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzOTAtMTM5MQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM5MgogICAgLy8gYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIGNhbGxzdWIgX2lzX3BhdXNlZAogICAgIQogICAgYXNzZXJ0IC8vIFByb3RvY29sIGlzIHBhdXNlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzkzCiAgICAvLyBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgY2FsbHN1YiBfZmV0Y2hfcHJpY2VfZmVlZAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQ6IHVpbnQ2NCkgLT4gdm9pZDoKX2ZldGNoX3ByaWNlX2ZlZWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzOTUtMTM5NgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgcHJvdG8gMSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OS0xMzk3CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc29tZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Iob3BlcmF0b3JfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3ggPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3gudmFsdWUgPSBhcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgQXV0aG9yaXplZFByaWNlT3BlcmF0b3JTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I9YXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gQWNjb3VudDoKICAgIC8vICAgICBvcGVyYXRvcl9pZCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyID09IHNlbGYuX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICAgICAgb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICAvLyAgICAgKSwgIm9ubHkgYXV0aG9yaXplZCBwcmljZSBvcGVyYXRvciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBmcmFtZV9kaWcgLTEKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY5CiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OS0xMzk3CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc29tZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Iob3BlcmF0b3JfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3ggPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3gudmFsdWUgPSBhcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgQXV0aG9yaXplZFByaWNlT3BlcmF0b3JTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I9YXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gQWNjb3VudDoKICAgIC8vICAgICBvcGVyYXRvcl9pZCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyID09IHNlbGYuX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICAgICAgb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICAvLyAgICAgKSwgIm9ubHkgYXV0aG9yaXplZCBwcmljZSBvcGVyYXRvciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBkaWcgMQogICAgY29uY2F0CiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM5NwogICAgLy8gYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGFzc2VydCAvLyBNYXJrZXQgZG9lcyBub3QgZXhpc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTc2CiAgICAvLyBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgYnl0ZSAicHJpY2VfZmVlZHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk3Ni0xMzk4CiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc29tZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Iob3BlcmF0b3JfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3ggPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3gudmFsdWUgPSBhcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgQXV0aG9yaXplZFByaWNlT3BlcmF0b3JTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I9YXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gQWNjb3VudDoKICAgIC8vICAgICBvcGVyYXRvcl9pZCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyID09IHNlbGYuX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICAgICAgb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICAvLyAgICAgKSwgIm9ubHkgYXV0aG9yaXplZCBwcmljZSBvcGVyYXRvciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIGRpZyAxCiAgICBjb25jYXQKICAgIGR1cAogICAgY292ZXIgMgogICAgZHVwCiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM5OAogICAgLy8gYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIGFzc2VydCAvLyBQcmljZSBmZWVkIG5vdCBhdHRhY2hlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzk5CiAgICAvLyBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICB0eG4gU2VuZGVyCiAgICBjYWxsc3ViIHJlcXVpcmVfcGF5bWVudAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDAwCiAgICAvLyBhc3NlcnQgcGF5bWVudCA+PSAxMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNQogICAgZHVwCiAgICBpbnQgMTAwMDAwCiAgICA+PQogICAgYXNzZXJ0IC8vIGluc3VmZmljaWVudCBwYXltZW50IGZvciBmZXRjaCBwcmljZSBmZWVkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MDIKICAgIC8vIHBheW1lbnQgPD0gMTAwMDAwMAogICAgZHVwCiAgICBpbnQgMTAwMDAwMAogICAgPD0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQwMS0xNDAzCiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIHBheW1lbnQgPD0gMTAwMDAwMAogICAgLy8gKSwgInBheW1lbnQgZXhjZWVkcyBtYXhpbXVtIGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS02CiAgICBhc3NlcnQgLy8gcGF5bWVudCBleGNlZWRzIG1heGltdW0gZm9yIGZldGNoIHByaWNlIGZlZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQwNAogICAgLy8gYXBwID0gQXBwbGljYXRpb24oc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIGRpZyAxCiAgICBib3hfZ2V0CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5wcmljZV9mZWVkcyBlbnRyeSBleGlzdHMKICAgIGV4dHJhY3QgOCA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDA1CiAgICAvLyBpdHhuLlBheW1lbnQocmVjZWl2ZXI9YXBwLmFkZHJlc3MsIGFtb3VudD1wYXltZW50LCBmZWU9MCkuc3VibWl0KCkKICAgIGl0eG5fYmVnaW4KICAgIGR1cAogICAgYXBwX3BhcmFtc19nZXQgQXBwQWRkcmVzcwogICAgYXNzZXJ0IC8vIGFwcGxpY2F0aW9uIGV4aXN0cwogICAgdW5jb3ZlciAyCiAgICBpdHhuX2ZpZWxkIEFtb3VudAogICAgaXR4bl9maWVsZCBSZWNlaXZlcgogICAgaW50IHBheQogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDA2LTE0MTAKICAgIC8vIHByaWNlX3dpdGhfdGltZXN0YW1wLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIFByaWNlRmVlZFByb3ZpZGVySW50ZXJmYWNlLmdldF9wcmljZV93aXRoX3RpbWVzdGFtcCwKICAgIC8vICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgYXBwX2lkPWFwcCwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgbWV0aG9kICJnZXRfcHJpY2Vfd2l0aF90aW1lc3RhbXAodWludDY0KSh1aW50MjU2LHVpbnQ2NCkiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgc3dhcAogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGR1cAogICAgZXh0cmFjdCA0IDAKICAgIGR1cAogICAgY292ZXIgMgogICAgY292ZXIgMwogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDEyCiAgICAvLyBwcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICBleHRyYWN0IDMyIDggLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MTMKICAgIC8vID4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgc3dhcAogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYucHJpY2VfZmVlZHMgZW50cnkgZXhpc3RzCiAgICBleHRyYWN0IDE2IDQwIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZXh0cmFjdCAzMiA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDEyLTE0MTMKICAgIC8vIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vID4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgPgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDExLTE0MTQKICAgIC8vIGlmICgKICAgIC8vICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyApOgogICAgYnogX2ZldGNoX3ByaWNlX2ZlZWRfYWZ0ZXJfaWZfZWxzZUA0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MTUKICAgIC8vIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wID0gKAogICAgZnJhbWVfZGlnIDAKICAgIGR1cAogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYucHJpY2VfZmVlZHMgZW50cnkgZXhpc3RzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MTUtMTQxNwogICAgLy8gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAuY29weSgpCiAgICAvLyApCiAgICBmcmFtZV9kaWcgMQogICAgZHVwCiAgICBjb3ZlciAyCiAgICByZXBsYWNlMiAxNgogICAgdW5jb3ZlciAyCiAgICBzd2FwCiAgICBib3hfcHV0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MTgKICAgIC8vIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQsIHByaWNlX3dpdGhfdGltZXN0YW1wLnByaWNlLm5hdGl2ZSkKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAtMQogICAgc3dhcAogICAgY2FsbHN1YiBfc2V0X21hcmtldF9wcmljZQoKX2ZldGNoX3ByaWNlX2ZlZWRfYWZ0ZXJfaWZfZWxzZUA0OgogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuc2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHModG9rZW5faWQ6IGJ5dGVzLCBtYXhfdG90YWxfZGVwb3NpdHM6IGJ5dGVzKSAtPiB2b2lkOgpzZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0czoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQzMy0xNDM2CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2CiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQzNwogICAgLy8gc2VsZi5fb25seV9vd25lcigpCiAgICBjYWxsc3ViIF9vbmx5X293bmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MzgKICAgIC8vIHNlbGYuX3NldF9tYXJrZXRfbWF4X3RvdGFsX2RlcG9zaXRzKHRva2VuX2lkLm5hdGl2ZSwgbWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMgogICAgYnRvaQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9zZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0cwogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3NldF9tYXJrZXRfbWF4X3RvdGFsX2RlcG9zaXRzKHRva2VuX2lkOiB1aW50NjQsIG1heF90b3RhbF9kZXBvc2l0czogYnl0ZXMpIC0+IHZvaWQ6Cl9zZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0czoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ0MC0xNDQzCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXhfdG90YWxfZGVwb3NpdHM6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDQ0CiAgICAvLyBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NDUKICAgIC8vIG1hcmtldC5tYXhfdG90YWxfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYobWF4X3RvdGFsX2RlcG9zaXRzKQogICAgZnJhbWVfZGlnIC0xCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgZnJhbWVfZGlnIC0xCiAgICBifAogICAgcmVwbGFjZTIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDQ2CiAgICAvLyBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgZnJhbWVfZGlnIC0yCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OQogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDQ2CiAgICAvLyBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgc3dhcAogICAgY29uY2F0CiAgICBzd2FwCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5wYXVzZV9tYXJrZXQodG9rZW5faWQ6IGJ5dGVzLCBwYXVzZTogYnl0ZXMpIC0+IHZvaWQ6CnBhdXNlX21hcmtldDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUwMS0xNTAyCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUwMwogICAgLy8gc2VsZi5fb25seV9vd25lcigpCiAgICBjYWxsc3ViIF9vbmx5X293bmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MDQKICAgIC8vIHNlbGYuX3BhdXNlX21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIHBhdXNlLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMgogICAgYnRvaQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBjYWxsc3ViIF9wYXVzZV9tYXJrZXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9wYXVzZV9tYXJrZXQodG9rZW5faWQ6IHVpbnQ2NCwgcGF1c2U6IHVpbnQ2NCkgLT4gdm9pZDoKX3BhdXNlX21hcmtldDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUwNi0xNTA3CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9wYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjktMTUwOAogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+PSBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPj0gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID49IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnNvbWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKG9wZXJhdG9yX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZiwgb3BlcmF0b3JfaWQ6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAgICAgb3BlcmF0b3JfaWRfYm94ID0gQm94KGFyYzQuQWRkcmVzcywga2V5PWIiYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvciIpCiAgICAvLyAgICAgb3BlcmF0b3JfaWRfYm94LnZhbHVlID0gYXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIEF1dGhvcml6ZWRQcmljZU9wZXJhdG9yU2V0KAogICAgLy8gICAgICMgICAgICAgICBhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yPWFyYzQuQWRkcmVzcyhvcGVyYXRvcl9pZCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYpIC0+IEFjY291bnQ6CiAgICAvLyAgICAgb3BlcmF0b3JfaWQgPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICByZXR1cm4gb3BlcmF0b3JfaWQuZ2V0KGRlZmF1bHQ9YXJjNC5BZGRyZXNzKHNlbGYub3duZXIpKS5uYXRpdmUKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgVHhuLnNlbmRlciA9PSBzZWxmLl9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgICAgIG9yIFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lcgogICAgLy8gICAgICksICJvbmx5IGF1dGhvcml6ZWQgcHJpY2Ugb3BlcmF0b3IgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBkZWwgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWREZXRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIGFzc2VydCBwcmljZSA+IDAsICJQcmljZSBtdXN0IGJlIHBvc2l0aXZlIgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgVW5wYXVzZSB0aGUgbWFya2V0IG9uIGZpcnN0IHByaWNlIHNldAogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQgYW5kIG1hcmtldC5wcmljZSA9PSAwOgogICAgLy8gICAgICAgICBtYXJrZXQucGF1c2VkID0gYXJjNC5Cb29sKEZhbHNlKQogICAgLy8gCiAgICAvLyAgICAgIyBTY2FsZSB0aGUgcHJpY2UgYnkgU0NBTEUgaW50ZXJuYWxseSBmb3Igc3RvcmFnZQogICAgLy8gICAgIG1hcmtldC5wcmljZSA9IGFyYzQuVUludDI1NihwcmljZSAqIFNDQUxFKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFByaWNlU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KHByaWNlKSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgc2VsZi5fZmV0Y2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2ZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDEwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS01CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgcGF5bWVudCA8PSAxMDAwMDAwCiAgICAvLyAgICAgKSwgInBheW1lbnQgZXhjZWVkcyBtYXhpbXVtIGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS02CiAgICAvLyAgICAgYXBwID0gQXBwbGljYXRpb24oc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vICAgICBpdHhuLlBheW1lbnQocmVjZWl2ZXI9YXBwLmFkZHJlc3MsIGFtb3VudD1wYXltZW50LCBmZWU9MCkuc3VibWl0KCkKICAgIC8vICAgICBwcmljZV93aXRoX3RpbWVzdGFtcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgUHJpY2VGZWVkUHJvdmlkZXJJbnRlcmZhY2UuZ2V0X3ByaWNlX3dpdGhfdGltZXN0YW1wLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIGlmICgKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICAgICA+IHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICApOgogICAgLy8gICAgICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcCA9ICgKICAgIC8vICAgICAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLmNvcHkoKQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQsIHByaWNlX3dpdGhfdGltZXN0YW1wLnByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vICMgUkVNIGludGVudGlvbmFsbHkgY29tbWVudGVkIG91dAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgYXNzZXJ0IHRva2VuX2lkLm5hdGl2ZSBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAjICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gIyAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfbWF4X3RvdGFsX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0cyh0b2tlbl9pZC5uYXRpdmUsIG1heF90b3RhbF9kZXBvc2l0cy5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfbWF4X3RvdGFsX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1heF90b3RhbF9kZXBvc2l0czogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgbWFya2V0Lm1heF90b3RhbF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NihtYXhfdG90YWxfZGVwb3NpdHMpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRNYXhUb3RhbERlcG9zaXRzU2V0KAogICAgLy8gICAgICMgICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihtYXhfdG90YWxfZGVwb3NpdHMpCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3BhdXNlX21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIHBhdXNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGZyYW1lX2RpZyAtMgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjkKICAgIC8vIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgYnl0ZSAibWFya2V0cyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY5LTE1MDgKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPj0gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID49IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+PSBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zb21lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZiwgb3BlcmF0b3JfaWQ6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihvcGVyYXRvcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gICAgIG9wZXJhdG9yX2lkX2JveCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIG9wZXJhdG9yX2lkX2JveC52YWx1ZSA9IGFyYzQuQWRkcmVzcyhvcGVyYXRvcl9pZCkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBBdXRob3JpemVkUHJpY2VPcGVyYXRvclNldCgKICAgIC8vICAgICAjICAgICAgICAgYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcj1hcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmKSAtPiBBY2NvdW50OgogICAgLy8gICAgIG9wZXJhdG9yX2lkID0gQm94KGFyYzQuQWRkcmVzcywga2V5PWIiYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvciIpCiAgICAvLyAgICAgcmV0dXJuIG9wZXJhdG9yX2lkLmdldChkZWZhdWx0PWFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSkubmF0aXZlCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIFR4bi5zZW5kZXIgPT0gc2VsZi5fZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgICAgICBvciBUeG4uc2VuZGVyID09IHNlbGYub3duZXIKICAgIC8vICAgICApLCAib25seSBhdXRob3JpemVkIHByaWNlIG9wZXJhdG9yIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXSA9IFByaWNlRmVlZCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wPVByaWNlV2l0aFRpbWVzdGFtcCgKICAgIC8vICAgICAgICAgICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICksCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZEF0dGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZC5uYXRpdmUsIHByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcmljZTogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIC8vICAgICAgICAgbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgU2NhbGUgdGhlIHByaWNlIGJ5IFNDQUxFIGludGVybmFsbHkgZm9yIHN0b3JhZ2UKICAgIC8vICAgICBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRQcmljZVNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihwcmljZSkpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBmZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9mZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAxMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHBheW1lbnQgPD0gMTAwMDAwMAogICAgLy8gICAgICksICJwYXltZW50IGV4Y2VlZHMgbWF4aW11bSBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNgogICAgLy8gICAgIGFwcCA9IEFwcGxpY2F0aW9uKHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAgICAgaXR4bi5QYXltZW50KHJlY2VpdmVyPWFwcC5hZGRyZXNzLCBhbW91bnQ9cGF5bWVudCwgZmVlPTApLnN1Ym1pdCgpCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFByaWNlRmVlZFByb3ZpZGVySW50ZXJmYWNlLmdldF9wcmljZV93aXRoX3RpbWVzdGFtcCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICAgICAgPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgKToKICAgIC8vICAgICAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICAvLyAgICAgICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC5jb3B5KCkKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLCBwcmljZV93aXRoX3RpbWVzdGFtcC5wcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyAjIFJFTSBpbnRlbnRpb25hbGx5IGNvbW1lbnRlZCBvdXQKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIGFzc2VydCB0b2tlbl9pZC5uYXRpdmUgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gIyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICMgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHModG9rZW5faWQubmF0aXZlLCBtYXhfdG90YWxfZGVwb3NpdHMubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXhfdG90YWxfZGVwb3NpdHM6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIG1hcmtldC5tYXhfdG90YWxfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYobWF4X3RvdGFsX2RlcG9zaXRzKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0TWF4VG90YWxEZXBvc2l0c1NldCgKICAgIC8vICAgICAjICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYobWF4X3RvdGFsX2RlcG9zaXRzKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlX21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9wYXVzZV9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBwYXVzZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3BhdXNlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBzd2FwCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MDgKICAgIC8vIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBhc3NlcnQgLy8gTWFya2V0IGRvZXMgbm90IGV4aXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MDkKICAgIC8vIHNlbGYubWFya2V0c1t0b2tlbl9pZF0ucGF1c2VkID0gYXJjNC5Cb29sKHBhdXNlID09IFVJbnQ2NCgxKSkKICAgIGZyYW1lX2RpZyAtMQogICAgaW50IDEKICAgID09CiAgICBieXRlIDB4MDAKICAgIGludCAwCiAgICB1bmNvdmVyIDIKICAgIHNldGJpdAogICAgZGlnIDEKICAgIGJveF9nZXQKICAgIHN3YXAKICAgIGNvdmVyIDIKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLm1hcmtldHMgZW50cnkgZXhpc3RzCiAgICBpbnQgMAogICAgZ2V0Yml0CiAgICBpbnQgMAogICAgc3dhcAogICAgc2V0Yml0CiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5zeW5jX21hcmtldChtYXJrZXRfaWQ6IGJ5dGVzKSAtPiB2b2lkOgpzeW5jX21hcmtldDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUxMS0xNTEyCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzeW5jX21hcmtldChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgcHJvdG8gMSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MTMKICAgIC8vIHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBjYWxsc3ViIF9hY2NydWVfaW50ZXJlc3QKICAgIHBvcAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQ6IHVpbnQ2NCkgLT4gYnl0ZXM6Cl9hY2NydWVfaW50ZXJlc3Q6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MTUtMTUxNgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYWNjcnVlX2ludGVyZXN0KHNlbGYsIG1hcmtldF9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgcHJvdG8gMSAxCiAgICBpbnQgMAogICAgZHVwbiA2CiAgICBieXRlICIiCiAgICBkdXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUxNwogICAgLy8gbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIGR1cAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTE4CiAgICAvLyBpZiBtYXJrZXQucGF1c2VkOgogICAgaW50IDAKICAgIGdldGJpdAogICAgYnl0ZSAweDAwCiAgICBpbnQgMAogICAgdW5jb3ZlciAyCiAgICBzZXRiaXQKICAgIGJ5dGUgMHgwMAogICAgIT0KICAgIGJ6IF9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MTkKICAgIC8vIHJldHVybiBtYXJrZXQKICAgIGZyYW1lX2RpZyA5CiAgICBmcmFtZV9idXJ5IDAKICAgIHJldHN1YgoKX2FjY3J1ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MjEKICAgIC8vIGN1cnJlbnRfdGltZSA9IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgNwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTIyCiAgICAvLyB0aW1lX2RlbHRhID0gY3VycmVudF90aW1lIC0gbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUubmF0aXZlCiAgICBmcmFtZV9kaWcgOQogICAgZXh0cmFjdCAyNDEgOCAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ0b2kKICAgIC0KICAgIGR1cAogICAgZnJhbWVfYnVyeSA4CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MjMKICAgIC8vIGlmIHRpbWVfZGVsdGEgPD0gMDoKICAgIGludCAwCiAgICA8PQogICAgYnogX2FjY3J1ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUyNAogICAgLy8gcmV0dXJuIG1hcmtldAogICAgZnJhbWVfZGlnIDkKICAgIGZyYW1lX2J1cnkgMAogICAgcmV0c3ViCgpfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VANDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUyNi0xNTI3CiAgICAvLyAjIEZvciBzdG9rZW4gbWFya2V0IChib3Jyb3ctb25seSksIHVzZSBhIGZpeGVkIHV0aWxpemF0aW9uIHJhdGUgc2luY2UgdGhlcmUgYXJlIG5vIGRlcG9zaXRzCiAgICAvLyBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY3CiAgICAvLyBzZWxmLnN0b2tlbl9hcHBfaWQgPSBVSW50NjQoKSAgIyBzdGFibGUgbWFya2V0CiAgICBieXRlICJzdG9rZW5fYXBwX2lkIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTI2LTE1MjcKICAgIC8vICMgRm9yIHN0b2tlbiBtYXJrZXQgKGJvcnJvdy1vbmx5KSwgdXNlIGEgZml4ZWQgdXRpbGl6YXRpb24gcmF0ZSBzaW5jZSB0aGVyZSBhcmUgbm8gZGVwb3NpdHMKICAgIC8vIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYuc3Rva2VuX2FwcF9pZCBleGlzdHMKICAgIGZyYW1lX2RpZyAtMQogICAgPT0KICAgIGJ6IF9hY2NydWVfaW50ZXJlc3RfZWxzZV9ib2R5QDYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUyOAogICAgLy8gdXRpbGl6YXRpb24gPSBCaWdVSW50KDEwMDAwKSAgIyAxMDAlIHV0aWxpemF0aW9uIGZvciBib3Jyb3ctb25seSBtYXJrZXQKICAgIGJ5dGUgMHgyNzEwCiAgICBiIF9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAxMAoKX2FjY3J1ZV9pbnRlcmVzdF9lbHNlX2JvZHlANjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUyOQogICAgLy8gZWxpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgZnJhbWVfZGlnIDkKICAgIGV4dHJhY3QgMTEzIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDYKICAgIGJ5dGUgMHgKICAgIGI9PQogICAgYnogX2FjY3J1ZV9pbnRlcmVzdF9lbHNlX2JvZHlAOAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTMwCiAgICAvLyByZXR1cm4gbWFya2V0CiAgICBmcmFtZV9kaWcgOQogICAgZnJhbWVfYnVyeSAwCiAgICByZXRzdWIKCl9hY2NydWVfaW50ZXJlc3RfZWxzZV9ib2R5QDg6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MzMKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiAxMDAwMAogICAgZnJhbWVfZGlnIDkKICAgIGV4dHJhY3QgMTQ1IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnl0ZSAweDI3MTAKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MzItMTUzNAogICAgLy8gdXRpbGl6YXRpb24gPSAoCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIDEwMDAwCiAgICAvLyApIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICBmcmFtZV9kaWcgNgogICAgYi8KCl9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAxMDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUzNQogICAgLy8gcmF0ZSA9IG1hcmtldC5ib3Jyb3dfcmF0ZS5uYXRpdmUgKyAobWFya2V0LnNsb3BlLm5hdGl2ZSAqIHV0aWxpemF0aW9uKSAvLyAxMDAwMAogICAgZnJhbWVfZGlnIDkKICAgIGR1cAogICAgZXh0cmFjdCA5NyA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgaXRvYgogICAgc3dhcAogICAgZHVwCiAgICBleHRyYWN0IDEwNSA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgaXRvYgogICAgdW5jb3ZlciAzCiAgICBiKgogICAgYnl0ZSAweDI3MTAKICAgIGIvCiAgICB1bmNvdmVyIDIKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MzYKICAgIC8vIGludGVyZXN0ID0gKHJhdGUgKiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdGltZV9kZWx0YSkgLy8gKAogICAgc3dhcAogICAgZXh0cmFjdCAxNDUgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBiKgogICAgZnJhbWVfZGlnIDgKICAgIGl0b2IKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MzcKICAgIC8vIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjgKICAgIC8vIHNlbGYuc2Vjb25kc19wZXJfeWVhciA9IFVJbnQ2NCgpICAjIHNlY29uZHMgcGVyIHllYXIKICAgIGJ5dGUgInNlY29uZHNfcGVyX3llYXIiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MzcKICAgIC8vIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYuc2Vjb25kc19wZXJfeWVhciBleGlzdHMKICAgIGludCAxMDAwMAogICAgKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTM2LTE1MzgKICAgIC8vIGludGVyZXN0ID0gKHJhdGUgKiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdGltZV9kZWx0YSkgLy8gKAogICAgLy8gICAgIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICAvLyApCiAgICBpdG9iCiAgICBiLwogICAgZnJhbWVfYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NDAtMTU0MQogICAgLy8gIyBTcGVjaWFsIGhhbmRsaW5nIGZvciBzdG9rZW4gbWFya2V0IC0gYWxsIGludGVyZXN0IGdvZXMgdG8gcmVzZXJ2ZXMKICAgIC8vIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjcKICAgIC8vIHNlbGYuc3Rva2VuX2FwcF9pZCA9IFVJbnQ2NCgpICAjIHN0YWJsZSBtYXJrZXQKICAgIGJ5dGUgInN0b2tlbl9hcHBfaWQiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NDAtMTU0MQogICAgLy8gIyBTcGVjaWFsIGhhbmRsaW5nIGZvciBzdG9rZW4gbWFya2V0IC0gYWxsIGludGVyZXN0IGdvZXMgdG8gcmVzZXJ2ZXMKICAgIC8vIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYuc3Rva2VuX2FwcF9pZCBleGlzdHMKICAgIGZyYW1lX2RpZyAtMQogICAgPT0KICAgIGJ6IF9hY2NydWVfaW50ZXJlc3RfZWxzZV9ib2R5QDEyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NDMKICAgIC8vIGRlcG9zaXRvcl9wb3J0aW9uID0gQmlnVUludCgwKQogICAgYnl0ZSAweAogICAgZnJhbWVfYnVyeSAwCiAgICBmcmFtZV9kaWcgMQogICAgZnJhbWVfYnVyeSAzCiAgICBiIF9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAxNQoKX2FjY3J1ZV9pbnRlcmVzdF9lbHNlX2JvZHlAMTI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NDYKICAgIC8vIGludGVyZXN0ICogYXJjNC5VSW50MjU2LmZyb21fYnl0ZXMobWFya2V0LnJlc2VydmVfZmFjdG9yLmJ5dGVzKS5uYXRpdmUKICAgIGZyYW1lX2RpZyA5CiAgICBleHRyYWN0IDg5IDggLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgMQogICAgZHVwCiAgICB1bmNvdmVyIDIKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NDcKICAgIC8vICkgLy8gMTAwMDAKICAgIGJ5dGUgMHgyNzEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NDUtMTU0NwogICAgLy8gcHJvdG9jb2xfcG9ydGlvbiA9ICgKICAgIC8vICAgICBpbnRlcmVzdCAqIGFyYzQuVUludDI1Ni5mcm9tX2J5dGVzKG1hcmtldC5yZXNlcnZlX2ZhY3Rvci5ieXRlcykubmF0aXZlCiAgICAvLyApIC8vIDEwMDAwCiAgICBiLwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU0OAogICAgLy8gaWYgcHJvdG9jb2xfcG9ydGlvbiA+IGludGVyZXN0OgogICAgYjwKICAgIGJ6IF9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAxNAogICAgZnJhbWVfZGlnIDEKICAgIGZyYW1lX2J1cnkgMwoKX2FjY3J1ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDE0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTUwCiAgICAvLyBkZXBvc2l0b3JfcG9ydGlvbiA9IGludGVyZXN0IC0gcHJvdG9jb2xfcG9ydGlvbgogICAgZnJhbWVfZGlnIDEKICAgIGZyYW1lX2RpZyAzCiAgICBiLQogICAgZnJhbWVfYnVyeSAwCgpfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMTU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NTIKICAgIC8vIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPiAwOgogICAgZnJhbWVfZGlnIDkKICAgIGR1cAogICAgZXh0cmFjdCAxMTMgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgNAogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAKICAgIGI+CiAgICBzd2FwCiAgICBmcmFtZV9idXJ5IDIKICAgIGJ6IF9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAxNwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTU0CiAgICAvLyBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyA5CiAgICBkdXAKICAgIGV4dHJhY3QgMTc3IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTU1CiAgICAvLyArIChkZXBvc2l0b3JfcG9ydGlvbiAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgZnJhbWVfZGlnIDAKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiKgogICAgZnJhbWVfZGlnIDQKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NTQtMTU1NQogICAgLy8gbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyArIChkZXBvc2l0b3JfcG9ydGlvbiAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU1My0xNTU2CiAgICAvLyBtYXJrZXQuZGVwb3NpdF9pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICArIChkZXBvc2l0b3JfcG9ydGlvbiAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gKQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDE3NwogICAgZnJhbWVfYnVyeSAyCgpfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMTc6CiAgICBmcmFtZV9kaWcgMgogICAgZHVwCiAgICBmcmFtZV9idXJ5IDkKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU1NwogICAgLy8gaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID4gMDoKICAgIGR1cAogICAgZXh0cmFjdCAxNDUgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgNQogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAKICAgIGI+CiAgICBzd2FwCiAgICBmcmFtZV9idXJ5IDIKICAgIGJ6IF9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAxOQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTU5CiAgICAvLyBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgZnJhbWVfZGlnIDkKICAgIGR1cAogICAgZXh0cmFjdCAyMDkgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NjAKICAgIC8vICsgKGludGVyZXN0ICogU0NBTEUpIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUKICAgIGZyYW1lX2RpZyAxCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYioKICAgIGZyYW1lX2RpZyA1CiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTU5LTE1NjAKICAgIC8vIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyArIChpbnRlcmVzdCAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTU4LTE1NjEKICAgIC8vIG1hcmtldC5ib3Jyb3dfaW5kZXggPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICArIChpbnRlcmVzdCAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyApCiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBifAogICAgcmVwbGFjZTIgMjA5CiAgICBmcmFtZV9idXJ5IDIKCl9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAxOToKICAgIGZyYW1lX2RpZyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NjQKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBpbnRlcmVzdAogICAgZHVwCiAgICBleHRyYWN0IDE0NSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAxCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTYzLTE1NjUKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgaW50ZXJlc3QKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGR1cAogICAgY292ZXIgMwogICAgYnwKICAgIHJlcGxhY2UyIDE0NQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTY3CiAgICAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGRlcG9zaXRvcl9wb3J0aW9uCiAgICBkdXAKICAgIGV4dHJhY3QgMTEzIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIDAKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NjYtMTU2OAogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGRlcG9zaXRvcl9wb3J0aW9uCiAgICAvLyApCiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBkaWcgMgogICAgYnwKICAgIHJlcGxhY2UyIDExMwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTY5CiAgICAvLyBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSArIHByb3RvY29sX3BvcnRpb24pCiAgICBkdXAKICAgIGV4dHJhY3QgMjQ5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIDMKICAgIGIrCiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICB1bmNvdmVyIDIKICAgIGJ8CiAgICByZXBsYWNlMiAyNDkKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU3MAogICAgLy8gbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChjdXJyZW50X3RpbWUpCiAgICBmcmFtZV9kaWcgNwogICAgaXRvYgogICAgcmVwbGFjZTIgMjQxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NzIKICAgIC8vIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgZnJhbWVfZGlnIC0xCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OQogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTcyCiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIHN3YXAKICAgIGNvbmNhdAogICAgZGlnIDEKICAgIGJveF9wdXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU3MwogICAgLy8gcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIGZyYW1lX2J1cnkgMAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wud2l0aGRyYXdfcmVzZXJ2ZXMobWFya2V0X2lkOiBieXRlcywgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKd2l0aGRyYXdfcmVzZXJ2ZXM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1ODItMTU4NAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBza2lwcGluZyBzdWJyb3V0aW5lIHRvIHJlZHVjZSBjb250cmFjdCBzaXplCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTg1CiAgICAvLyBzZWxmLl9vbmx5X293bmVyKCkKICAgIGNhbGxzdWIgX29ubHlfb3duZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU4NgogICAgLy8gc2VsZi5fd2l0aGRyYXdfcmVzZXJ2ZXMobWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMgogICAgYnRvaQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF93aXRoZHJhd19yZXNlcnZlcwogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3dpdGhkcmF3X3Jlc2VydmVzKG1hcmtldF9pZDogdWludDY0LCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpfd2l0aGRyYXdfcmVzZXJ2ZXM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1ODgtMTU4OQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTkwCiAgICAvLyBzZWxmLl9vbmx5X293bmVyKCkKICAgIGNhbGxzdWIgX29ubHlfb3duZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU5MQogICAgLy8gYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIGNhbGxzdWIgX2lzX3BhdXNlZAogICAgIQogICAgYXNzZXJ0IC8vIFByb3RvY29sIGlzIHBhdXNlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTkzLTE1OTQKICAgIC8vICMgQWNjcnVlIGludGVyZXN0IGZpcnN0IHRvIGdldCB1cC10by1kYXRlIHJlc2VydmVzCiAgICAvLyBtYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9hY2NydWVfaW50ZXJlc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU5NQogICAgLy8gYXNzZXJ0IG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgPj0gYW1vdW50LCAiSW5zdWZmaWNpZW50IHJlc2VydmVzIgogICAgZHVwCiAgICBleHRyYWN0IDI0OSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfZGlnIC0xCiAgICBiPj0KICAgIGFzc2VydCAvLyBJbnN1ZmZpY2llbnQgcmVzZXJ2ZXMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU5Ny0xNjAzCiAgICAvLyAjIFRyYW5zZmVyIHJlc2VydmVzIHRvIHRoZSBvd25lciAobm90IHRvIHRoZSBjb250cmFjdCBpdHNlbGYpCiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICBhcmM0LkFkZHJlc3Moc2VsZi5vd25lciksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyApCiAgICBpdHhuX2JlZ2luCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MDAKICAgIC8vIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSwKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2NQogICAgLy8gc2VsZi5vd25lciA9IEFjY291bnQoKQogICAgYnl0ZSAib3duZXIiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MDAKICAgIC8vIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSwKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5vd25lciBleGlzdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYwMQogICAgLy8gYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICBmcmFtZV9kaWcgLTEKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBmcmFtZV9kaWcgLTEKICAgIGRpZyAxCiAgICBifAogICAgZnJhbWVfZGlnIC0yCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU5Ny0xNjAzCiAgICAvLyAjIFRyYW5zZmVyIHJlc2VydmVzIHRvIHRoZSBvd25lciAobm90IHRvIHRoZSBjb250cmFjdCBpdHNlbGYpCiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICBhcmM0LkFkZHJlc3Moc2VsZi5vd25lciksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyApCiAgICBtZXRob2QgImFyYzIwMF90cmFuc2ZlcihhZGRyZXNzLHVpbnQyNTYpYm9vbCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICB1bmNvdmVyIDIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjA1LTE2MDYKICAgIC8vICMgVXBkYXRlIHJlc2VydmVzCiAgICAvLyBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIHN3YXAKICAgIGZyYW1lX2RpZyAtMQogICAgYi0KICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGJ8CiAgICByZXBsYWNlMiAyNDkKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYwNwogICAgLy8gc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBmcmFtZV9kaWcgLTIKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY5CiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MDcKICAgIC8vIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgc3dhcAogICAgY29uY2F0CiAgICBzd2FwCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5kZXBvc2l0KG1hcmtldF9pZDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6CmRlcG9zaXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MjMtMTYyNAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGVwb3NpdChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjI1CiAgICAvLyBzZWxmLl9kZXBvc2l0KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICB0eG4gU2VuZGVyCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ0b2kKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZGVwb3NpdAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2RlcG9zaXQodXNlcl9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0LCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpfZGVwb3NpdDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYzMS0xNjMyCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXBvc2l0KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICBwcm90byAzIDAKICAgIGludCAwCiAgICBkdXBuIDkKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY2MgogICAgLy8gc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBpbnQgMQogICAgY2FsbHN1YiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjY0LTE2NjcKICAgIC8vICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIGRlcG9zaXQgb3BlcmF0aW9uCiAgICAvLyBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgbWFya2V0X2lkCiAgICAvLyApLmRlcG9zaXQubmF0aXZlCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICBleHRyYWN0IDAgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY2OAogICAgLy8gaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICBieXRlIDB4CiAgICBiPgogICAgYnogX2RlcG9zaXRfYWZ0ZXJfaWZfZWxzZUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NjkKICAgIC8vIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIkRlcG9zaXQgY2FwIGV4Y2VlZGVkIgogICAgZnJhbWVfZGlnIC0xCiAgICBmcmFtZV9kaWcgMTAKICAgIGI8PQogICAgYXNzZXJ0IC8vIERlcG9zaXQgY2FwIGV4Y2VlZGVkCgpfZGVwb3NpdF9hZnRlcl9pZl9lbHNlQDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NzEtMTY3NwogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyApCiAgICBpdHhuX2JlZ2luCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NzQKICAgIC8vIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIGdsb2JhbCBDdXJyZW50QXBwbGljYXRpb25BZGRyZXNzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NzUKICAgIC8vIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgZnJhbWVfZGlnIC0xCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDAKICAgIGZyYW1lX2RpZyAtMQogICAgYnwKICAgIGZyYW1lX2RpZyAtMgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NzEtMTY3NwogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyApCiAgICBtZXRob2QgImFyYzIwMF90cmFuc2ZlckZyb20oYWRkcmVzcyxhZGRyZXNzLHVpbnQyNTYpYm9vbCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTMKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBzd2FwCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGV4dHJhY3QgMCA0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgID09CiAgICBhc3NlcnQgLy8gQVJDNCBwcmVmaXggaXMgdmFsaWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY3OQogICAgLy8gdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfdXNlcgogICAgZnJhbWVfYnVyeSA5CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2ODAtMTY4MgogICAgLy8gbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdCgKICAgIC8vICAgICBtYXJrZXRfaWQKICAgIC8vICkgICMgR2V0IHVwZGF0ZWQgbWFya2V0IHdpdGggYWNjcnVlZCBpbnRlcmVzdAogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9hY2NydWVfaW50ZXJlc3QKICAgIGZyYW1lX2J1cnkgNAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjg0CiAgICAvLyBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdAogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY4Ni0xNjg3CiAgICAvLyAjIEFkZCBlYXJuZWQgaW50ZXJlc3QgdG8gdXNlcidzIHBvc2l0aW9uIGFzIGFkZGl0aW9uYWwgc2NhbGVkIGRlcG9zaXRzCiAgICAvLyBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gQmlnVUludCgwKQogICAgYnl0ZSAweAogICAgZnJhbWVfYnVyeSAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2ODgKICAgIC8vIGlmIGludGVyZXN0ID4gMDoKICAgIGJ5dGUgMHgKICAgIGI+CiAgICBieiBfZGVwb3NpdF9hZnRlcl9pZl9lbHNlQDUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY5MAogICAgLy8gaW50ZXJlc3QgKiBTQ0FMRQogICAgZnJhbWVfZGlnIDEKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjkxCiAgICAvLyApIC8vIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyA0CiAgICBleHRyYWN0IDE3NyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY4OS0xNjkxCiAgICAvLyBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gKAogICAgLy8gICAgIGludGVyZXN0ICogU0NBTEUKICAgIC8vICkgLy8gbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgYi8KICAgIGZyYW1lX2J1cnkgMgoKX2RlcG9zaXRfYWZ0ZXJfaWZfZWxzZUA1OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjk0CiAgICAvLyBhbW91bnQgKiBTQ0FMRQogICAgZnJhbWVfZGlnIC0xCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY5NQogICAgLy8gKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgZnJhbWVfZGlnIDQKICAgIGR1cAogICAgY292ZXIgMgogICAgZXh0cmFjdCAxNzcgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2OTMtMTY5NQogICAgLy8gc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICAgICBhbW91bnQgKiBTQ0FMRQogICAgLy8gKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY5NwogICAgLy8gdG90YWxfc2NhbGVkX2Ftb3VudCA9IHNjYWxlZF9hbW91bnQgKyBpbnRlcmVzdF9zY2FsZWRfYW1vdW50CiAgICBmcmFtZV9kaWcgMgogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcwMAogICAgLy8gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgZnJhbWVfZGlnIDkKICAgIGR1cAogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgc3dhcAogICAgZHVwCiAgICBleHRyYWN0IDY0IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgdW5jb3ZlciAyCiAgICBiKgogICAgY292ZXIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzA0CiAgICAvLyBuZXdfbWFya2V0Lm1heF90b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIGRpZyAzCiAgICBleHRyYWN0IDEgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MDUKICAgIC8vID49IG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIHRvdGFsX3NjYWxlZF9hbW91bnQKICAgIGRpZyA0CiAgICBleHRyYWN0IDExMyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGRpZyAzCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzA0LTE3MDUKICAgIC8vIG5ld19tYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gPj0gbmV3X21hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgdG90YWxfc2NhbGVkX2Ftb3VudAogICAgdW5jb3ZlciAyCiAgICBiPD0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcwMy0xNzA2CiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIG5ld19tYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgID49IG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIHRvdGFsX3NjYWxlZF9hbW91bnQKICAgIC8vICksICJNYXJrZXQgZGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICBhc3NlcnQgLy8gTWFya2V0IGRlcG9zaXQgY2FwIGV4Y2VlZGVkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MDgtMTcxMAogICAgLy8gc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBtYXJrZXRfaWQsIHVzZXJfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0zCiAgICBkaWcgMwogICAgY2FsbHN1YiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzEyCiAgICAvLyBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQpCiAgICBmcmFtZV9kaWcgLTIKICAgIHVuY292ZXIgMgogICAgY2FsbHN1YiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcxNC0xNzE5CiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIE5Ub2tlbi5taW50LAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoYW1vdW50ICsgaW50ZXJlc3QpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzE3CiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50ICsgaW50ZXJlc3QpLAogICAgZnJhbWVfZGlnIC0xCiAgICBmcmFtZV9kaWcgMQogICAgZHVwCiAgICBjb3ZlciAzCiAgICBiKwogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgZnJhbWVfZGlnIDAKICAgIGJ8CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MTgKICAgIC8vIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgdW5jb3ZlciA0CiAgICBpbnQgMzEzCiAgICBpbnQgOAogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcxNC0xNzE5CiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIE5Ub2tlbi5taW50LAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoYW1vdW50ICsgaW50ZXJlc3QpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gKQogICAgbWV0aG9kICJtaW50KGFkZHJlc3MsdWludDI1Nil2b2lkIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGZyYW1lX2RpZyAtMwogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzIxLTE3MjMKICAgIC8vIG9sZF9kZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyApIC8vIFNDQUxFCiAgICB1bmNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcyMwogICAgLy8gKSAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcyMS0xNzIzCiAgICAvLyBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gKSAvLyBTQ0FMRQogICAgYi8KICAgIGR1cAogICAgY292ZXIgMwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzI0CiAgICAvLyBuZXdfZGVwb3NpdF9hbW91bnQgPSBvbGRfZGVwb3NpdF9hbW91bnQgKyBhbW91bnQgKyBpbnRlcmVzdAogICAgZnJhbWVfZGlnIC0xCiAgICBiKwogICAgdW5jb3ZlciAyCiAgICBiKwogICAgZnJhbWVfYnVyeSAzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MjYKICAgIC8vIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPT0gMDoKICAgIGV4dHJhY3QgMTM2IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDcKICAgIGJ5dGUgMHgKICAgIGI9PQogICAgYnogX2RlcG9zaXRfZWxzZV9ib2R5QDgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcyNy0xNzI4CiAgICAvLyAjIEZhbGxiYWNrOiBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgdG8gcHJldmVudCBuZWdhdGl2ZSBjb2xsYXRlcmFsCiAgICAvLyBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICBmcmFtZV9kaWcgNAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHN3YXAKICAgIGRpZyAxCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICBmcmFtZV9idXJ5IDYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcyOQogICAgLy8gbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDMKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIGZyYW1lX2J1cnkgNQogICAgYiBfZGVwb3NpdF9hZnRlcl9pZl9lbHNlQDkKCl9kZXBvc2l0X2Vsc2VfYm9keUA4OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzMxLTE3MzIKICAgIC8vICMgTm9ybWFsIGNhc2U6IFVzZSB1c2VyJ3MgbGFzdCByZWNvcmRlZCBwcmljZSBmb3IgYWNjdXJhdGUgY29sbGF0ZXJhbCByZWR1Y3Rpb24KICAgIC8vIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDcKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIGZyYW1lX2J1cnkgNgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzMzCiAgICAvLyBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICBmcmFtZV9kaWcgNAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAzCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICBmcmFtZV9idXJ5IDUKCl9kZXBvc2l0X2FmdGVyX2lmX2Vsc2VAOToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTczNS0xNzM2CiAgICAvLyAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIGRlcG9zaXQgb3BlcmF0aW9uCiAgICAvLyB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfdXNlcl9jYXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTczNwogICAgLy8gaWYgdXNlcl9jYXAudG90YWxfZGVwb3NpdHMubmF0aXZlID4gMDoKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA4CiAgICBieXRlIDB4CiAgICBiPgogICAgYnogX2RlcG9zaXRfYWZ0ZXJfaWZfZWxzZUAxMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzM5CiAgICAvLyBuZXdfdmFsdWUgPD0gdXNlcl9jYXAudG90YWxfZGVwb3NpdHMubmF0aXZlCiAgICBmcmFtZV9kaWcgNQogICAgZnJhbWVfZGlnIDgKICAgIGI8PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzM4LTE3NDAKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gKSwgIlVzZXIgZGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICBhc3NlcnQgLy8gVXNlciBkZXBvc2l0IGNhcCBleGNlZWRlZAoKX2RlcG9zaXRfYWZ0ZXJfaWZfZWxzZUAxMToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc0MgogICAgLy8gc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKHVzZXJfaWQsIG1hcmtldF9pZCwgb2xkX3ZhbHVlLCBuZXdfdmFsdWUpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIDYKICAgIGZyYW1lX2RpZyA1CiAgICBjYWxsc3ViIF91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZDogdWludDY0LCBhbW91bnQ6IGJ5dGVzLCBndWFyZF9zdG9rZW46IHVpbnQ2NCkgLT4gdm9pZDoKX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb246CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MDktMTYxMgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbigKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50LCBndWFyZF9zdG9rZW46IGJvb2wKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjEzCiAgICAvLyBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgY2FsbHN1YiBfaXNfcGF1c2VkCiAgICAhCiAgICBhc3NlcnQgLy8gUHJvdG9jb2wgaXMgcGF1c2VkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OS0xNjE0CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc29tZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Iob3BlcmF0b3JfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3ggPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3gudmFsdWUgPSBhcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgQXV0aG9yaXplZFByaWNlT3BlcmF0b3JTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I9YXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gQWNjb3VudDoKICAgIC8vICAgICBvcGVyYXRvcl9pZCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyID09IHNlbGYuX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICAgICAgb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICAvLyAgICAgKSwgIm9ubHkgYXV0aG9yaXplZCBwcmljZSBvcGVyYXRvciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMTAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTUKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBwYXltZW50IDw9IDEwMDAwMDAKICAgIC8vICAgICApLCAicGF5bWVudCBleGNlZWRzIG1heGltdW0gZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTYKICAgIC8vICAgICBhcHAgPSBBcHBsaWNhdGlvbihzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gICAgIGl0eG4uUGF5bWVudChyZWNlaXZlcj1hcHAuYWRkcmVzcywgYW1vdW50PXBheW1lbnQsIGZlZT0wKS5zdWJtaXQoKQogICAgLy8gICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBQcmljZUZlZWRQcm92aWRlckludGVyZmFjZS5nZXRfcHJpY2Vfd2l0aF90aW1lc3RhbXAsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWFwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgICAgID4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICk6CiAgICAvLyAgICAgICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wID0gKAogICAgLy8gICAgICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAuY29weSgpCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZCwgcHJpY2Vfd2l0aF90aW1lc3RhbXAucHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBjb21tZW50ZWQgb3V0CiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBhc3NlcnQgdG9rZW5faWQubmF0aXZlIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAjICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NgogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfbWF4X3RvdGFsX2RlcG9zaXRzKHRva2VuX2lkLm5hdGl2ZSwgbWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWF4X3RvdGFsX2RlcG9zaXRzOiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBtYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KG1heF90b3RhbF9kZXBvc2l0cykKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldE1heFRvdGFsRGVwb3NpdHNTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KG1heF90b3RhbF9kZXBvc2l0cykKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fcGF1c2VfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgcGF1c2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9wYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0ucGF1c2VkID0gYXJjNC5Cb29sKHBhdXNlID09IFVJbnQ2NCgxKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY19tYXJrZXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYWNjcnVlX2ludGVyZXN0KHNlbGYsIG1hcmtldF9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGN1cnJlbnRfdGltZSA9IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wCiAgICAvLyAgICAgdGltZV9kZWx0YSA9IGN1cnJlbnRfdGltZSAtIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lLm5hdGl2ZQogICAgLy8gICAgIGlmIHRpbWVfZGVsdGEgPD0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgIyBGb3Igc3Rva2VuIG1hcmtldCAoYm9ycm93LW9ubHkpLCB1c2UgYSBmaXhlZCB1dGlsaXphdGlvbiByYXRlIHNpbmNlIHRoZXJlIGFyZSBubyBkZXBvc2l0cwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHV0aWxpemF0aW9uID0gQmlnVUludCgxMDAwMCkgICMgMTAwJSB1dGlsaXphdGlvbiBmb3IgYm9ycm93LW9ubHkgbWFya2V0CiAgICAvLyAgICAgZWxpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgdXRpbGl6YXRpb24gPSAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDAKICAgIC8vICAgICAgICAgKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgIHJhdGUgPSBtYXJrZXQuYm9ycm93X3JhdGUubmF0aXZlICsgKG1hcmtldC5zbG9wZS5uYXRpdmUgKiB1dGlsaXphdGlvbikgLy8gMTAwMDAKICAgIC8vICAgICBpbnRlcmVzdCA9IChyYXRlICogbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHRpbWVfZGVsdGEpIC8vICgKICAgIC8vICAgICAgICAgc2VsZi5zZWNvbmRzX3Blcl95ZWFyICogMTAwMDAKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHN0b2tlbiBtYXJrZXQgLSBhbGwgaW50ZXJlc3QgZ29lcyB0byByZXNlcnZlcwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBhcmM0LlVJbnQyNTYuZnJvbV9ieXRlcyhtYXJrZXQucmVzZXJ2ZV9mYWN0b3IuYnl0ZXMpLm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIDEwMDAwCiAgICAvLyAgICAgICAgIGlmIHByb3RvY29sX3BvcnRpb24gPiBpbnRlcmVzdDoKICAgIC8vICAgICAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IGludGVyZXN0IC0gcHJvdG9jb2xfcG9ydGlvbgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChkZXBvc2l0b3JfcG9ydGlvbiAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID4gMDoKICAgIC8vICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChpbnRlcmVzdCAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGludGVyZXN0CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgZGVwb3NpdG9yX3BvcnRpb24KICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgKyBwcm90b2NvbF9wb3J0aW9uKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoY3VycmVudF90aW1lKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAgICAgcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gIyBUT0RPIGdvdmVybmFuY2U6IGNvbnNpZGVyIGlmIHJlc2VydmUgd2l0aGRyYXdhbCBzaG91bGQgcmVxdWlyZSBhZGRpdGlvbmFsCiAgICAvLyAjICAgICAgZ292ZXJuYW5jZSBtZWNoYW5pc21zCiAgICAvLyAjIFRPRE8gbWluaW11bSByZXNlcnZlIGxldmVsczogbWlnaHQgd2FudCB0byBlbmZvcmNlIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHMgZm9yCiAgICAvLyAjICAgICAgcHJvdG9jb2wgc2FmZXR5CiAgICAvLyAjIFRPRE8gZXZlbnQgZW1pc3Npb246IENvbnNpZGVyIGFkZGluZyBhbiBldmVudCB0byBsb2cgcmVzZXJ2ZSB3aXRoZHJhd2FscyBmb3IKICAgIC8vICMgICAgICB0cmFuc3BhcmVuY3kKICAgIC8vIAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBza2lwcGluZyBzdWJyb3V0aW5lIHRvIHJlZHVjZSBjb250cmFjdCBzaXplCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl93aXRoZHJhd19yZXNlcnZlcyhtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIEFjY3J1ZSBpbnRlcmVzdCBmaXJzdCB0byBnZXQgdXAtdG8tZGF0ZSByZXNlcnZlcwogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgPj0gYW1vdW50LCAiSW5zdWZmaWNpZW50IHJlc2VydmVzIgogICAgLy8gCiAgICAvLyAgICAgIyBUcmFuc2ZlciByZXNlcnZlcyB0byB0aGUgb3duZXIgKG5vdCB0byB0aGUgY29udHJhY3QgaXRzZWxmKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVcGRhdGUgcmVzZXJ2ZXMKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbigKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50LCBndWFyZF9zdG9rZW46IGJvb2wKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgZnJhbWVfZGlnIC0zCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OQogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjktMTYxNAogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+PSBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPj0gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID49IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnNvbWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKG9wZXJhdG9yX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZiwgb3BlcmF0b3JfaWQ6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAgICAgb3BlcmF0b3JfaWRfYm94ID0gQm94KGFyYzQuQWRkcmVzcywga2V5PWIiYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvciIpCiAgICAvLyAgICAgb3BlcmF0b3JfaWRfYm94LnZhbHVlID0gYXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIEF1dGhvcml6ZWRQcmljZU9wZXJhdG9yU2V0KAogICAgLy8gICAgICMgICAgICAgICBhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yPWFyYzQuQWRkcmVzcyhvcGVyYXRvcl9pZCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYpIC0+IEFjY291bnQ6CiAgICAvLyAgICAgb3BlcmF0b3JfaWQgPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICByZXR1cm4gb3BlcmF0b3JfaWQuZ2V0KGRlZmF1bHQ9YXJjNC5BZGRyZXNzKHNlbGYub3duZXIpKS5uYXRpdmUKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgVHhuLnNlbmRlciA9PSBzZWxmLl9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgICAgIG9yIFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lcgogICAgLy8gICAgICksICJvbmx5IGF1dGhvcml6ZWQgcHJpY2Ugb3BlcmF0b3IgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBkZWwgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWREZXRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIGFzc2VydCBwcmljZSA+IDAsICJQcmljZSBtdXN0IGJlIHBvc2l0aXZlIgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgVW5wYXVzZSB0aGUgbWFya2V0IG9uIGZpcnN0IHByaWNlIHNldAogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQgYW5kIG1hcmtldC5wcmljZSA9PSAwOgogICAgLy8gICAgICAgICBtYXJrZXQucGF1c2VkID0gYXJjNC5Cb29sKEZhbHNlKQogICAgLy8gCiAgICAvLyAgICAgIyBTY2FsZSB0aGUgcHJpY2UgYnkgU0NBTEUgaW50ZXJuYWxseSBmb3Igc3RvcmFnZQogICAgLy8gICAgIG1hcmtldC5wcmljZSA9IGFyYzQuVUludDI1NihwcmljZSAqIFNDQUxFKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFByaWNlU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KHByaWNlKSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgc2VsZi5fZmV0Y2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2ZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDEwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS01CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgcGF5bWVudCA8PSAxMDAwMDAwCiAgICAvLyAgICAgKSwgInBheW1lbnQgZXhjZWVkcyBtYXhpbXVtIGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS02CiAgICAvLyAgICAgYXBwID0gQXBwbGljYXRpb24oc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vICAgICBpdHhuLlBheW1lbnQocmVjZWl2ZXI9YXBwLmFkZHJlc3MsIGFtb3VudD1wYXltZW50LCBmZWU9MCkuc3VibWl0KCkKICAgIC8vICAgICBwcmljZV93aXRoX3RpbWVzdGFtcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgUHJpY2VGZWVkUHJvdmlkZXJJbnRlcmZhY2UuZ2V0X3ByaWNlX3dpdGhfdGltZXN0YW1wLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIGlmICgKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICAgICA+IHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICApOgogICAgLy8gICAgICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcCA9ICgKICAgIC8vICAgICAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLmNvcHkoKQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQsIHByaWNlX3dpdGhfdGltZXN0YW1wLnByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vICMgUkVNIGludGVudGlvbmFsbHkgY29tbWVudGVkIG91dAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgYXNzZXJ0IHRva2VuX2lkLm5hdGl2ZSBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAjICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gIyAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfbWF4X3RvdGFsX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0cyh0b2tlbl9pZC5uYXRpdmUsIG1heF90b3RhbF9kZXBvc2l0cy5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfbWF4X3RvdGFsX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1heF90b3RhbF9kZXBvc2l0czogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgbWFya2V0Lm1heF90b3RhbF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NihtYXhfdG90YWxfZGVwb3NpdHMpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRNYXhUb3RhbERlcG9zaXRzU2V0KAogICAgLy8gICAgICMgICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihtYXhfdG90YWxfZGVwb3NpdHMpCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3BhdXNlX21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIHBhdXNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdLnBhdXNlZCA9IGFyYzQuQm9vbChwYXVzZSA9PSBVSW50NjQoMSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfbWFya2V0KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2FjY3J1ZV9pbnRlcmVzdChzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICAgICBjdXJyZW50X3RpbWUgPSBHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcAogICAgLy8gICAgIHRpbWVfZGVsdGEgPSBjdXJyZW50X3RpbWUgLSBtYXJrZXQubGFzdF91cGRhdGVfdGltZS5uYXRpdmUKICAgIC8vICAgICBpZiB0aW1lX2RlbHRhIDw9IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgICMgRm9yIHN0b2tlbiBtYXJrZXQgKGJvcnJvdy1vbmx5KSwgdXNlIGEgZml4ZWQgdXRpbGl6YXRpb24gcmF0ZSBzaW5jZSB0aGVyZSBhcmUgbm8gZGVwb3NpdHMKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICB1dGlsaXphdGlvbiA9IEJpZ1VJbnQoMTAwMDApICAjIDEwMCUgdXRpbGl6YXRpb24gZm9yIGJvcnJvdy1vbmx5IG1hcmtldAogICAgLy8gICAgIGVsaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIHV0aWxpemF0aW9uID0gKAogICAgLy8gICAgICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIDEwMDAwCiAgICAvLyAgICAgICAgICkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICByYXRlID0gbWFya2V0LmJvcnJvd19yYXRlLm5hdGl2ZSArIChtYXJrZXQuc2xvcGUubmF0aXZlICogdXRpbGl6YXRpb24pIC8vIDEwMDAwCiAgICAvLyAgICAgaW50ZXJlc3QgPSAocmF0ZSAqIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB0aW1lX2RlbHRhKSAvLyAoCiAgICAvLyAgICAgICAgIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBTcGVjaWFsIGhhbmRsaW5nIGZvciBzdG9rZW4gbWFya2V0IC0gYWxsIGludGVyZXN0IGdvZXMgdG8gcmVzZXJ2ZXMKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gaW50ZXJlc3QKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBCaWdVSW50KDApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9ICgKICAgIC8vICAgICAgICAgICAgIGludGVyZXN0ICogYXJjNC5VSW50MjU2LmZyb21fYnl0ZXMobWFya2V0LnJlc2VydmVfZmFjdG9yLmJ5dGVzKS5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyAxMDAwMAogICAgLy8gICAgICAgICBpZiBwcm90b2NvbF9wb3J0aW9uID4gaW50ZXJlc3Q6CiAgICAvLyAgICAgICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gaW50ZXJlc3QKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBpbnRlcmVzdCAtIHByb3RvY29sX3BvcnRpb24KICAgIC8vIAogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPiAwOgogICAgLy8gICAgICAgICBtYXJrZXQuZGVwb3NpdF9pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgKyAoZGVwb3NpdG9yX3BvcnRpb24gKiBTQ0FMRSkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXggPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgKyAoaW50ZXJlc3QgKiBTQ0FMRSkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBpbnRlcmVzdAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGRlcG9zaXRvcl9wb3J0aW9uCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5yZXNlcnZlcyA9IGFyYzQuVUludDI1NihtYXJrZXQucmVzZXJ2ZXMubmF0aXZlICsgcHJvdG9jb2xfcG9ydGlvbikKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KGN1cnJlbnRfdGltZSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gICAgIHJldHVybiBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICMgVE9ETyBnb3Zlcm5hbmNlOiBjb25zaWRlciBpZiByZXNlcnZlIHdpdGhkcmF3YWwgc2hvdWxkIHJlcXVpcmUgYWRkaXRpb25hbAogICAgLy8gIyAgICAgIGdvdmVybmFuY2UgbWVjaGFuaXNtcwogICAgLy8gIyBUT0RPIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHM6IG1pZ2h0IHdhbnQgdG8gZW5mb3JjZSBtaW5pbXVtIHJlc2VydmUgbGV2ZWxzIGZvcgogICAgLy8gIyAgICAgIHByb3RvY29sIHNhZmV0eQogICAgLy8gIyBUT0RPIGV2ZW50IGVtaXNzaW9uOiBDb25zaWRlciBhZGRpbmcgYW4gZXZlbnQgdG8gbG9nIHJlc2VydmUgd2l0aGRyYXdhbHMgZm9yCiAgICAvLyAjICAgICAgdHJhbnNwYXJlbmN5CiAgICAvLyAKICAgIC8vICMgUkVNIGludGVudGlvbmFsbHkgc2tpcHBpbmcgc3Vicm91dGluZSB0byByZWR1Y2UgY29udHJhY3Qgc2l6ZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fd2l0aGRyYXdfcmVzZXJ2ZXMobWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBBY2NydWUgaW50ZXJlc3QgZmlyc3QgdG8gZ2V0IHVwLXRvLWRhdGUgcmVzZXJ2ZXMKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBtYXJrZXQucmVzZXJ2ZXMubmF0aXZlID49IGFtb3VudCwgIkluc3VmZmljaWVudCByZXNlcnZlcyIKICAgIC8vIAogICAgLy8gICAgICMgVHJhbnNmZXIgcmVzZXJ2ZXMgdG8gdGhlIG93bmVyIChub3QgdG8gdGhlIGNvbnRyYWN0IGl0c2VsZikKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgVXBkYXRlIHJlc2VydmVzCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24oCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCwgZ3VhcmRfc3Rva2VuOiBib29sCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIHN3YXAKICAgIGNvbmNhdAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MTQKICAgIC8vIGFzc2VydCBtYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgYXNzZXJ0IC8vIE1hcmtldCBkb2VzIG5vdCBleGlzdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjE1CiAgICAvLyBhc3NlcnQgYW1vdW50ID4gMCwgIkFtb3VudCBtdXN0IGJlID4gMCIKICAgIGZyYW1lX2RpZyAtMgogICAgYnl0ZSAweAogICAgYj4KICAgIGFzc2VydCAvLyBBbW91bnQgbXVzdCBiZSA+IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYxNgogICAgLy8gbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYxNwogICAgLy8gYXNzZXJ0IG5vdCBtYXJrZXQucGF1c2VkLCAiTWFya2V0IGlzIHBhdXNlZCIKICAgIGludCAwCiAgICBnZXRiaXQKICAgIGJ5dGUgMHgwMAogICAgaW50IDAKICAgIHVuY292ZXIgMgogICAgc2V0Yml0CiAgICBieXRlIDB4MDAKICAgID09CiAgICBhc3NlcnQgLy8gTWFya2V0IGlzIHBhdXNlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjE4CiAgICAvLyBpZiBndWFyZF9zdG9rZW46CiAgICBmcmFtZV9kaWcgLTEKICAgIGJ6IF92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uX2FmdGVyX2lmX2Vsc2VAMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjIwCiAgICAvLyBzZWxmLnN0b2tlbl9hcHBfaWQgIT0gbWFya2V0X2lkCiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjcKICAgIC8vIHNlbGYuc3Rva2VuX2FwcF9pZCA9IFVJbnQ2NCgpICAjIHN0YWJsZSBtYXJrZXQKICAgIGJ5dGUgInN0b2tlbl9hcHBfaWQiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MjAKICAgIC8vIHNlbGYuc3Rva2VuX2FwcF9pZCAhPSBtYXJrZXRfaWQKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5zdG9rZW5fYXBwX2lkIGV4aXN0cwogICAgZnJhbWVfZGlnIC0zCiAgICAhPQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjE5LTE2MjEKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgLy8gKSwgIkNhbm5vdCB1c2Ugc3Rva2VuIG1hcmtldCBmb3IgdGhpcyBvcGVyYXRpb24iCiAgICBhc3NlcnQgLy8gQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGZvciB0aGlzIG9wZXJhdGlvbgoKX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb25fYWZ0ZXJfaWZfZWxzZUAyOgogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCkgLT4gYnl0ZXM6Cl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc1OS0xNzYwCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQmlnVUludDoKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzYyCiAgICAvLyBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfYWNjcnVlX2ludGVyZXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3NjMKICAgIC8vIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc2NwogICAgLy8gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgc3dhcAogICAgZXh0cmFjdCAxNzcgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkaWcgMQogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc2OAogICAgLy8gKSAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc2NS0xNzY4CiAgICAvLyAjIENhbGN1bGF0ZSB0b3RhbCB1bmRlcmx5aW5nIGFtb3VudAogICAgLy8gdXNlcl90b3RhbF91bmRlcmx5aW5nID0gKAogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICkgLy8gU0NBTEUKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3NzAtMTc3MQogICAgLy8gIyBJbnRlcmVzdCBpcyB0aGUgZGlmZmVyZW5jZSBmcm9tIHRoZSBzY2FsZWQgZGVwb3NpdHMgKHdoaWNoIHJlcHJlc2VudCB0aGUgImJhc2UiIGFtb3VudCkKICAgIC8vIGludGVyZXN0ID0gdXNlcl90b3RhbF91bmRlcmx5aW5nIC0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICBzd2FwCiAgICBiLQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzczCiAgICAvLyByZXR1cm4gaW50ZXJlc3QKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZDogdWludDY0LCB1c2VyX2lkOiBieXRlcywgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNzEtMTA3NAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAzIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA3NQogICAgLy8gbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA3NgogICAgLy8gdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfdXNlcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDc3CiAgICAvLyB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X3VzZXJfa2V5CiAgICBjb3ZlciAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNzgKICAgIC8vIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIGR1cAogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIC0xCiAgICBiKwogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA3OQogICAgLy8gdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIGRpZyAxCiAgICBleHRyYWN0IDE3NyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHJlcGxhY2UyIDY0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwODAKICAgIC8vIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgaXRvYgogICAgcmVwbGFjZTIgMTI4CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwODEKICAgIC8vIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIHN3YXAKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICByZXBsYWNlMiAxMzYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTcwCiAgICAvLyBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIGJ5dGUgInVzZXJzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDgyCiAgICAvLyBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICB1bmNvdmVyIDIKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZDogdWludDY0LCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NTMtMTQ1NgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NTcKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NTkKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50CiAgICBkdXAKICAgIGV4dHJhY3QgMTEzIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIC0xCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDU4LTE0NjAKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXBsYWNlMiAxMTMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ2MQogICAgLy8gbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGl0b2IKICAgIHJlcGxhY2UyIDI0MQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDYyCiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIGZyYW1lX2RpZyAtMgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjkKICAgIC8vIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgYnl0ZSAibWFya2V0cyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ2MgogICAgLy8gc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBzd2FwCiAgICBjb25jYXQKICAgIHN3YXAKICAgIGJveF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwodXNlcl9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0LCBvbGRfdmFsdWU6IGJ5dGVzLCBuZXdfdmFsdWU6IGJ5dGVzKSAtPiB2b2lkOgpfdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzU4LTIzNjUKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzY2CiAgICAvLyBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgZnJhbWVfZGlnIC00CiAgICBjYWxsc3ViIF9nZXRfZ2xvYmFsX3VzZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM2OQogICAgLy8gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIGR1cAogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIC0yCiAgICBiLQogICAgZnJhbWVfZGlnIC0xCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzY4LTIzNzAKICAgIC8vIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXBsYWNlMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNzEKICAgIC8vIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGl0b2IKICAgIHJlcGxhY2UyIDY0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk3MQogICAgLy8gc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICBieXRlICJnbG9iYWxfdXNlcnMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNzMKICAgIC8vIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICBmcmFtZV9kaWcgLTQKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkOiBieXRlcykgLT4gYnl0ZXM6Cl9nZXRfZ2xvYmFsX3VzZXI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNDYtMjM0NwogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IEdsb2JhbFVzZXJEYXRhOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk3MQogICAgLy8gc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICBieXRlICJnbG9iYWxfdXNlcnMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk3MS0yMzQ4CiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc29tZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Iob3BlcmF0b3JfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3ggPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3gudmFsdWUgPSBhcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgQXV0aG9yaXplZFByaWNlT3BlcmF0b3JTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I9YXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gQWNjb3VudDoKICAgIC8vICAgICBvcGVyYXRvcl9pZCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyID09IHNlbGYuX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICAgICAgb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICAvLyAgICAgKSwgIm9ubHkgYXV0aG9yaXplZCBwcmljZSBvcGVyYXRvciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMTAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTUKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBwYXltZW50IDw9IDEwMDAwMDAKICAgIC8vICAgICApLCAicGF5bWVudCBleGNlZWRzIG1heGltdW0gZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTYKICAgIC8vICAgICBhcHAgPSBBcHBsaWNhdGlvbihzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gICAgIGl0eG4uUGF5bWVudChyZWNlaXZlcj1hcHAuYWRkcmVzcywgYW1vdW50PXBheW1lbnQsIGZlZT0wKS5zdWJtaXQoKQogICAgLy8gICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBQcmljZUZlZWRQcm92aWRlckludGVyZmFjZS5nZXRfcHJpY2Vfd2l0aF90aW1lc3RhbXAsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWFwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgICAgID4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICk6CiAgICAvLyAgICAgICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wID0gKAogICAgLy8gICAgICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAuY29weSgpCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZCwgcHJpY2Vfd2l0aF90aW1lc3RhbXAucHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBjb21tZW50ZWQgb3V0CiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBhc3NlcnQgdG9rZW5faWQubmF0aXZlIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAjICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NgogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfbWF4X3RvdGFsX2RlcG9zaXRzKHRva2VuX2lkLm5hdGl2ZSwgbWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWF4X3RvdGFsX2RlcG9zaXRzOiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBtYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KG1heF90b3RhbF9kZXBvc2l0cykKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldE1heFRvdGFsRGVwb3NpdHNTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KG1heF90b3RhbF9kZXBvc2l0cykKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fcGF1c2VfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgcGF1c2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9wYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0ucGF1c2VkID0gYXJjNC5Cb29sKHBhdXNlID09IFVJbnQ2NCgxKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY19tYXJrZXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYWNjcnVlX2ludGVyZXN0KHNlbGYsIG1hcmtldF9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGN1cnJlbnRfdGltZSA9IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wCiAgICAvLyAgICAgdGltZV9kZWx0YSA9IGN1cnJlbnRfdGltZSAtIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lLm5hdGl2ZQogICAgLy8gICAgIGlmIHRpbWVfZGVsdGEgPD0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgIyBGb3Igc3Rva2VuIG1hcmtldCAoYm9ycm93LW9ubHkpLCB1c2UgYSBmaXhlZCB1dGlsaXphdGlvbiByYXRlIHNpbmNlIHRoZXJlIGFyZSBubyBkZXBvc2l0cwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHV0aWxpemF0aW9uID0gQmlnVUludCgxMDAwMCkgICMgMTAwJSB1dGlsaXphdGlvbiBmb3IgYm9ycm93LW9ubHkgbWFya2V0CiAgICAvLyAgICAgZWxpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgdXRpbGl6YXRpb24gPSAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDAKICAgIC8vICAgICAgICAgKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgIHJhdGUgPSBtYXJrZXQuYm9ycm93X3JhdGUubmF0aXZlICsgKG1hcmtldC5zbG9wZS5uYXRpdmUgKiB1dGlsaXphdGlvbikgLy8gMTAwMDAKICAgIC8vICAgICBpbnRlcmVzdCA9IChyYXRlICogbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHRpbWVfZGVsdGEpIC8vICgKICAgIC8vICAgICAgICAgc2VsZi5zZWNvbmRzX3Blcl95ZWFyICogMTAwMDAKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHN0b2tlbiBtYXJrZXQgLSBhbGwgaW50ZXJlc3QgZ29lcyB0byByZXNlcnZlcwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBhcmM0LlVJbnQyNTYuZnJvbV9ieXRlcyhtYXJrZXQucmVzZXJ2ZV9mYWN0b3IuYnl0ZXMpLm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIDEwMDAwCiAgICAvLyAgICAgICAgIGlmIHByb3RvY29sX3BvcnRpb24gPiBpbnRlcmVzdDoKICAgIC8vICAgICAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IGludGVyZXN0IC0gcHJvdG9jb2xfcG9ydGlvbgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChkZXBvc2l0b3JfcG9ydGlvbiAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID4gMDoKICAgIC8vICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChpbnRlcmVzdCAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGludGVyZXN0CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgZGVwb3NpdG9yX3BvcnRpb24KICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgKyBwcm90b2NvbF9wb3J0aW9uKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoY3VycmVudF90aW1lKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAgICAgcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gIyBUT0RPIGdvdmVybmFuY2U6IGNvbnNpZGVyIGlmIHJlc2VydmUgd2l0aGRyYXdhbCBzaG91bGQgcmVxdWlyZSBhZGRpdGlvbmFsCiAgICAvLyAjICAgICAgZ292ZXJuYW5jZSBtZWNoYW5pc21zCiAgICAvLyAjIFRPRE8gbWluaW11bSByZXNlcnZlIGxldmVsczogbWlnaHQgd2FudCB0byBlbmZvcmNlIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHMgZm9yCiAgICAvLyAjICAgICAgcHJvdG9jb2wgc2FmZXR5CiAgICAvLyAjIFRPRE8gZXZlbnQgZW1pc3Npb246IENvbnNpZGVyIGFkZGluZyBhbiBldmVudCB0byBsb2cgcmVzZXJ2ZSB3aXRoZHJhd2FscyBmb3IKICAgIC8vICMgICAgICB0cmFuc3BhcmVuY3kKICAgIC8vIAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBza2lwcGluZyBzdWJyb3V0aW5lIHRvIHJlZHVjZSBjb250cmFjdCBzaXplCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl93aXRoZHJhd19yZXNlcnZlcyhtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIEFjY3J1ZSBpbnRlcmVzdCBmaXJzdCB0byBnZXQgdXAtdG8tZGF0ZSByZXNlcnZlcwogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgPj0gYW1vdW50LCAiSW5zdWZmaWNpZW50IHJlc2VydmVzIgogICAgLy8gCiAgICAvLyAgICAgIyBUcmFuc2ZlciByZXNlcnZlcyB0byB0aGUgb3duZXIgKG5vdCB0byB0aGUgY29udHJhY3QgaXRzZWxmKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVcGRhdGUgcmVzZXJ2ZXMKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbigKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50LCBndWFyZF9zdG9rZW46IGJvb2wKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCBhbW91bnQgPiAwLCAiQW1vdW50IG11c3QgYmUgPiAwIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBub3QgbWFya2V0LnBhdXNlZCwgIk1hcmtldCBpcyBwYXVzZWQiCiAgICAvLyAgICAgaWYgZ3VhcmRfc3Rva2VuOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgLy8gICAgICAgICApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGZvciB0aGlzIG9wZXJhdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGVwb3NpdChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9kZXBvc2l0KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgUkVNIG1heSBhZGQgcHJvdGVjdGlvbiBmb3IgbG93IHV0aWxpc2F0aW9uIGluIGZ1dHVyZQogICAgLy8gIyBSRU0gbG93ZXIgbWF4IGRlcG9zaXQgYW1vdW50IGZvciBsb3cgdXRpbGlzYXRpb24KICAgIC8vICMgUkVNIGhpZ2ggbWF4IGRlcG9zaXQgYW1vdW50IGZvciBoaWdoIHV0aWxpc2F0aW9uCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlcG9zaXQoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBJbnRlcm5hbCBkZXBvc2l0IG1ldGhvZCB0aGF0IGhhbmRsZXMgdXNlciBkZXBvc2l0cyBpbnRvIGEgbGVuZGluZyBtYXJrZXQuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBwZXJmb3JtcyBhIGNvbXBsZXRlIGRlcG9zaXQgb3BlcmF0aW9uIGluY2x1ZGluZzoKICAgIC8vICAgICAxLiBWYWxpZGF0aW5nIHRoZSBtYXJrZXQgb3BlcmF0aW9uIChwcm90b2NvbCBub3QgcGF1c2VkLCBtYXJrZXQgZXhpc3RzLCBhbW91bnQgPiAwLCBtYXJrZXQgbm90IHBhdXNlZCkKICAgIC8vICAgICAyLiBUcmFuc2ZlcnJpbmcgQVJDMjAwIHRva2VucyBmcm9tIHVzZXIgdG8gdGhlIGxlbmRpbmcgcG9vbCBjb250cmFjdAogICAgLy8gICAgIDMuIEFjY3J1aW5nIGludGVyZXN0IG9uIHRoZSBtYXJrZXQgdG8gZ2V0IHVwZGF0ZWQgZGVwb3NpdCBpbmRleAogICAgLy8gICAgIDQuIENhbGN1bGF0aW5nIGFuZCBhZGRpbmcgZWFybmVkIGludGVyZXN0IHRvIHRoZSB1c2VyJ3MgcG9zaXRpb24KICAgIC8vICAgICA1LiBDb252ZXJ0aW5nIGRlcG9zaXQgYW1vdW50IHRvIHNjYWxlZCBkZXBvc2l0cyB1c2luZyBjdXJyZW50IGRlcG9zaXQgaW5kZXgKICAgIC8vICAgICA2LiBDaGVja2luZyBkZXBvc2l0IGNhcCBjb25zdHJhaW50cwogICAgLy8gICAgIDcuIFVwZGF0aW5nIHVzZXIgYW5kIG1hcmtldCBzY2FsZWQgZGVwb3NpdCBiYWxhbmNlcwogICAgLy8gICAgIDguIE1pbnRpbmcgTlRva2VucyB0byByZXByZXNlbnQgdGhlIHVzZXIncyBkZXBvc2l0IHBvc2l0aW9uCiAgICAvLyAgICAgOS4gVXBkYXRpbmcgZ2xvYmFsIGNvbGxhdGVyYWwgY2FsY3VsYXRpb25zIGZvciB0aGUgdXNlcgogICAgLy8gICAgIDEwLiBFbWl0dGluZyBhIE1hcmtldERlcG9zaXQgZXZlbnQKICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQgKEFjY291bnQpOiBUaGUgYWNjb3VudCBJRCBvZiB0aGUgdXNlciBtYWtpbmcgdGhlIGRlcG9zaXQKICAgIC8vICAgICAgICAgbWFya2V0X2lkIChVSW50NjQpOiBUaGUgSUQgb2YgdGhlIG1hcmtldCB0byBkZXBvc2l0IGludG8KICAgIC8vICAgICAgICAgYW1vdW50IChCaWdVSW50KTogVGhlIGFtb3VudCBvZiB1bmRlcmx5aW5nIHRva2VucyB0byBkZXBvc2l0CiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiBtYXJrZXQgdmFsaWRhdGlvbiBmYWlscywgZGVwb3NpdCBjYXAgaXMgZXhjZWVkZWQsIG9yIG90aGVyIGNvbnN0cmFpbnRzIGFyZSB2aW9sYXRlZAogICAgLy8gCiAgICAvLyAgICAgTm90ZToKICAgIC8vICAgICAgICAgLSBJbnRlcmVzdCBlYXJuZWQgc2luY2UgbGFzdCBpbnRlcmFjdGlvbiBpcyBhdXRvbWF0aWNhbGx5IGFkZGVkIHRvIHRoZSBkZXBvc2l0CiAgICAvLyAgICAgICAgIC0gU2NhbGVkIGRlcG9zaXRzIGFyZSB1c2VkIHRvIHRyYWNrIHVzZXIgcG9zaXRpb25zIGFuZCBjYWxjdWxhdGUgaW50ZXJlc3QKICAgIC8vICAgICAgICAgLSBDb2xsYXRlcmFsIHZhbHVlIGlzIHVwZGF0ZWQgdXNpbmcgZWl0aGVyIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIG9yIGN1cnJlbnQgbWFya2V0IHByaWNlCiAgICAvLyAgICAgICAgIC0gTlRva2VucyBhcmUgbWludGVkIHRvIHJlcHJlc2VudCB0aGUgdXNlcidzIGRlcG9zaXQgcG9zaXRpb24gKGFtb3VudCArIGludGVyZXN0KQogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgKS5kZXBvc2l0Lm5hdGl2ZQogICAgLy8gICAgIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJEZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApICAjIEdldCB1cGRhdGVkIG1hcmtldCB3aXRoIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBBZGQgZWFybmVkIGludGVyZXN0IHRvIHVzZXIncyBwb3NpdGlvbiBhcyBhZGRpdGlvbmFsIHNjYWxlZCBkZXBvc2l0cwogICAgLy8gICAgIGludGVyZXN0X3NjYWxlZF9hbW91bnQgPSBCaWdVSW50KDApCiAgICAvLyAgICAgaWYgaW50ZXJlc3QgPiAwOgogICAgLy8gICAgICAgICBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBTQ0FMRQogICAgLy8gICAgICAgICApIC8vIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIGFtb3VudCAqIFNDQUxFCiAgICAvLyAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgLy8gCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2Ftb3VudCA9IHNjYWxlZF9hbW91bnQgKyBpbnRlcmVzdF9zY2FsZWRfYW1vdW50CiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0Lm1heF90b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgPj0gbmV3X21hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgdG90YWxfc2NhbGVkX2Ftb3VudAogICAgLy8gICAgICksICJNYXJrZXQgZGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIHVzZXJfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50ICsgaW50ZXJlc3QpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2RlcG9zaXRfYW1vdW50ID0gb2xkX2RlcG9zaXRfYW1vdW50ICsgYW1vdW50ICsgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgIyBGYWxsYmFjazogVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIHRvIHByZXZlbnQgbmVnYXRpdmUgY29sbGF0ZXJhbAogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSA9IChuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICAjIE5vcm1hbCBjYXNlOiBVc2UgdXNlcidzIGxhc3QgcmVjb3JkZWQgcHJpY2UgZm9yIGFjY3VyYXRlIGNvbGxhdGVyYWwgcmVkdWN0aW9uCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIGRlcG9zaXQgb3BlcmF0aW9uCiAgICAvLyAgICAgdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC50b3RhbF9kZXBvc2l0cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApLCAiVXNlciBkZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF92YWx1ZSwgbmV3X3ZhbHVlKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0RGVwb3NpdCgKICAgIC8vICAgICAjICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLCBhcmM0LlVJbnQyNTYoYW1vdW50KQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGNhbGN1bGF0ZV91c2VyX2ludGVyZXN0KAogICAgLy8gIyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyAjICkgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAjICAgICByZXR1cm4gYXJjNC5VSW50MjU2KAogICAgLy8gIyAgICAgICAgIHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgaW50ZXJlc3QiIiIKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgdW5kZXJseWluZyBhbW91bnQKICAgIC8vICAgICB1c2VyX3RvdGFsX3VuZGVybHlpbmcgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIEludGVyZXN0IGlzIHRoZSBkaWZmZXJlbmNlIGZyb20gdGhlIHNjYWxlZCBkZXBvc2l0cyAod2hpY2ggcmVwcmVzZW50IHRoZSAiYmFzZSIgYW1vdW50KQogICAgLy8gICAgIGludGVyZXN0ID0gdXNlcl90b3RhbF91bmRlcmx5aW5nIC0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gaW50ZXJlc3QKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGNhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAjICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICMgKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAjICAgICBlbnN1cmVfYnVkZ2V0KDcwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICMgICAgIHJldHVybiBhcmM0LlVJbnQyNTYoCiAgICAvLyAjICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBkZWJ0IGludGVyZXN0IiIiCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIHVuZGVybHlpbmcgZGVidCBhbW91bnQKICAgIC8vICAgICB1c2VyX3RvdGFsX2RlYnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgb3JpZ2luYWwgcHJpbmNpcGFsIGFtb3VudCB1c2luZyB1c2VyJ3MgYm9ycm93X2luZGV4CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIncyBib3Jyb3dfaW5kZXggaXMgMCwgdXNlIGN1cnJlbnQgbWFya2V0IGJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXJfYm9ycm93X2luZGV4ID0gKAogICAgLy8gICAgICAgICB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBvcmlnaW5hbF9wcmluY2lwYWwgPSAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyX2JvcnJvd19pbmRleCkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRvdGFsIGRlYnQgYW5kIG9yaWdpbmFsIHByaW5jaXBhbAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSB1c2VyX3RvdGFsX2RlYnQgLSBvcmlnaW5hbF9wcmluY2lwYWwKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHdpdGhkcmF3KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyMTAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gCiAgICAvLyAgICAgIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgd2l0aGRyYXduIGZyb20gdG8gdXBkYXRlIGdsb2JhbCB2YWx1ZXMgd2l0aCBpbnRlcmVzdAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDI1NihzZWxmLl93aXRoZHJhdyhUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXcoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFdpdGhkcmF3IHRva2VucyBmcm9tIGEgbGVuZGluZyBtYXJrZXQgYnkgYnVybmluZyBuVG9rZW5zLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgaGFuZGxlcyB0aGUgd2l0aGRyYXdhbCBwcm9jZXNzIGJ5OgogICAgLy8gICAgIDEuIFZhbGlkYXRpbmcgdGhlIG1hcmtldCBvcGVyYXRpb24gYW5kIHVzZXIgYmFsYW5jZQogICAgLy8gICAgIDIuIEFjY3J1aW5nIGludGVyZXN0IHRvIGdldCB0aGUgbGF0ZXN0IG1hcmtldCBzdGF0ZQogICAgLy8gICAgIDMuIENhbGN1bGF0aW5nIHVzZXIncyBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgNC4gUGVyZm9ybWluZyBoZWFsdGggY2hlY2tzIHRvIGVuc3VyZSB3aXRoZHJhd2FsIGRvZXNuJ3QgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgIDUuIEJ1cm5pbmcgblRva2VucyBhbmQgdHJhbnNmZXJyaW5nIHVuZGVybHlpbmcgdG9rZW5zIHRvIHVzZXIKICAgIC8vICAgICA2LiBVcGRhdGluZyBnbG9iYWwgY29sbGF0ZXJhbCB2YWx1ZXMKICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIHdpdGhkcmF3aW5nIHRva2VucwogICAgLy8gICAgICAgICBtYXJrZXRfaWQ6IFRoZSBJRCBvZiB0aGUgbWFya2V0IHRvIHdpdGhkcmF3IGZyb20KICAgIC8vICAgICAgICAgYW1vdW50OiBUaGUgYW1vdW50IG9mIG5Ub2tlbnMgdG8gYnVybiAobm90IHRoZSB1bmRlcmx5aW5nIHRva2VuIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAgIFJldHVybnM6CiAgICAvLyAgICAgICAgIEJpZ1VJbnQ6IFRoZSB0b3RhbCBhbW91bnQgb2YgdW5kZXJseWluZyB0b2tlbnMgdHJhbnNmZXJyZWQgdG8gdGhlIHVzZXIKICAgIC8vICAgICAgICAgICAgICAgICAoaW5jbHVkZXMgYm90aCB0aGUgd2l0aGRyYXduIGFtb3VudCBhbmQgYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIHVzZXIgaGFzIGluc3VmZmljaWVudCBiYWxhbmNlIG9yIHdpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciB3aXRoZHJhdyBvcGVyYXRpb24KICAgIC8vICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gICAgICkud2l0aGRyYXcubmF0aXZlCiAgICAvLyAgICAgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIldpdGhkcmF3IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgYW1vdW50IGlzIHRoZSBhbW91bnQgb2YgblRva2VucyBiZWluZyBidXJuZWQKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBhbW91bnQgPD0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgICMgaGVhbHRoIGNoZWNrOiBlbnN1cmUgd2l0aGRyYXcgd291bGQgbm90IHB1dCBib3Jyb3dzIGF0IHJpc2sKICAgIC8vICAgICBpZiBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPiAwOgogICAgLy8gICAgICAgICAjIHZhbHVlIG9mIHVuZGVybHlpbmcgYW1vdW50IHRvIHdpdGhkcmF3IHVzaW5nIG5ldyBtYXJrZXQgcHJpY2UKICAgIC8vICAgICAgICAgd2l0aGRyYXdfdmFsdWUgPSAoYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsID0gKAogICAgLy8gICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSB3aXRoZHJhd192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIGFzc2VydCBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIDw9ICgKICAgIC8vICAgICAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsICogQmlnVUludChuZXdfbWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICAgICAgICAgKSAvLyBCaWdVSW50KDEwMDAwKSwgIldpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzayIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCB1c2VyX2lkLCBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19kZXBvc2l0X2Ftb3VudCA9IG9sZF9kZXBvc2l0X2Ftb3VudCArIGludGVyZXN0IC0gYW1vdW50CiAgICAvLyAKICAgIC8vICAgICBhbW91bnRfdXNkX3ZhbHVlID0gKGFtb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHVzZXIgY2FwIGZvciB3aXRoZHJhdyBvcGVyYXRpb24KICAgIC8vICAgICB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgIGlmIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPT0gMDoKICAgIC8vICAgICAgICAgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wICsgODY0MDApCiAgICAvLyAgICAgZWxpZiB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lIDwgR2xvYmFsLmxhdGVzdF90aW1lc3RhbXA6CiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KDApCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX2xpcXVpZGF0aW9ucyA9IGFyYzQuVUludDI1NigwKQogICAgLy8gICAgICAgICB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC5kYWlseV93aXRoZHJhd2Fscy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBuZXdfdG90YWxfd2l0aGRyYXdhbHMgPSB1c2VyX2NhcC50b3RhbF93aXRoZHJhd2Fscy5uYXRpdmUgKyBhbW91bnRfdXNkX3ZhbHVlCiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICBuZXdfdG90YWxfd2l0aGRyYXdhbHMgPD0gdXNlcl9jYXAuZGFpbHlfd2l0aGRyYXdhbHMubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIHdpdGhkcmF3IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYobmV3X3RvdGFsX3dpdGhkcmF3YWxzKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZCwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgICMgRmFsbGJhY2s6IFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSB0byBwcmV2ZW50IG5lZ2F0aXZlIGNvbGxhdGVyYWwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgIyBOb3JtYWwgY2FzZTogVXNlIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIGZvciBhY2N1cmF0ZSBjb2xsYXRlcmFsIHJlZHVjdGlvbgogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIEVtaXQgZXZlbnRzCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0V2l0aGRyYXcoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgYXJjNC5VSW50NjQobWFya2V0X2lkKSwgYXJjNC5VSW50MjU2KGFtb3VudCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gYW1vdW50ICsgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gIyB3aXRoZHJhdyBjb3N0IDkwMDAwMAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBib3Jyb3coc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyODAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gCiAgICAvLyAgICAgIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgYm9ycm93ZWQgZnJvbSB0byB1cGRhdGUgZ2xvYmFsIHZhbHVlcyB3aXRoIGludGVyZXN0CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9ib3Jyb3coVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYm9ycm93KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBib3Jyb3cgb3BlcmF0aW9uCiAgICAvLyAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApLmJvcnJvdy5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KHVzZXJfaWQpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gVUludDY0KDEwMDAwMCksICJQYXltZW50IGFtb3VudCBtdXN0IGJlID49IDAuMSIKICAgIC8vIAogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGN1cnJlbnQgbWFya2V0IHRvdGFsIGJvcnJvd3MgKGluY2x1ZGluZyBpbnRlcmVzdCkKICAgIC8vICAgICBjdXJyZW50X21hcmtldF90b3RhbF9ib3Jyb3dzID0gKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIGFtb3VudCBiZWluZyBhZGRlZCAobmV3IGJvcnJvdyArIGRlYnQgaW50ZXJlc3QpCiAgICAvLyAgICAgIyBkZWJ0IGludGVyZXN0IGFkZGVkIGF0IHRoaXMgcG9pbnQgdG8gcHJldmVudCB1bm5lY2Vzc2FyeSBkZWJ0IHJlc2V0CiAgICAvLyAgICAgdG90YWxfYW1vdW50X3RvX2FkZCA9IGFtb3VudCArIGRlYnRfaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgICMgVmFsaWRhdGUgYWdhaW5zdCBtYXJrZXQtd2lkZSBib3Jyb3cgY2FwCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbmV3X21hcmtldC5tYXhfdG90YWxfYm9ycm93cy5uYXRpdmUKICAgIC8vICAgICAgICAgPj0gY3VycmVudF9tYXJrZXRfdG90YWxfYm9ycm93cyArIHRvdGFsX2Ftb3VudF90b19hZGQKICAgIC8vICAgICApLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgY29sbGF0ZXJhbCByZXF1aXJlbWVudHMgLSBleGNsdWRlIHNhbWUgbWFya2V0IGNvbGxhdGVyYWwgdG8gcHJldmVudAogICAgLy8gICAgICMgaW5lZmZpY2llbnQgc2FtZS1hc3NldCBib3Jyb3dpbmcKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgbmV3X2JvcnJvd192YWx1ZSA9ICh0b3RhbF9hbW91bnRfdG9fYWRkICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgdG90YWxfYm9ycm93X3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSArIG5ld19ib3Jyb3dfdmFsdWUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IEJpZ1VJbnQoMCk6CiAgICAvLyAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICAgICAjIFVzZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgZXhjbHVkZWRfdmFsdWUgPSAoZGVwb3NpdGVkX2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBpZiBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSA+IGV4Y2x1ZGVkX3ZhbHVlOgogICAgLy8gICAgICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSAoCiAgICAvLyAgICAgICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBleGNsdWRlZF92YWx1ZQogICAgLy8gICAgICAgICAgICAgKQogICAgLy8gICAgICAgICBlbHNlOgogICAgLy8gICAgICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSBCaWdVSW50KDApCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgdG90YWxfYm9ycm93X3ZhbHVlIDw9ICgKICAgIC8vICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgKiBCaWdVSW50KG5ld19tYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgLy8gICAgICkgLy8gQmlnVUludCgxMDAwMCksICJJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCBhY3Jvc3MgbWFya2V0cyIKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHNjYWxlZCBhbW91bnQgZm9yIHRoZSB0b3RhbAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAodG90YWxfYW1vdW50X3RvX2FkZCAqIFNDQUxFKSAvLyBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBvbGRfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgLy8gU0NBTEUKICAgIC8vICAgICApCiAgICAvLyAgICAgbmV3X2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgICAgICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgaWYgdXNlciBkb2Vzbid0IGhhdmUgYSBwcmV2aW91cyBwcmljZQogICAgLy8gICAgIHByaWNlX2Zvcl9vbGQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBwcmljZV9mb3JfbmV3ID0gbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIG9sZF92YWx1ZSA9IChvbGRfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X3ZhbHVlID0gKG5ld19ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX25ldykgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3IgYm9ycm93IG9wZXJhdGlvbgogICAgLy8gICAgIHVzZXJfY2FwID0gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9jYXAudG90YWxfYm9ycm93cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIGJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlLCAgIyBvbGQgVVNEIHZhbHVlCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSwgICMgbmV3IFVTRCB2YWx1ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgaWYgc3Rva2VuLCBtaW50IHN0b2tlbgogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBTVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICAgICAgcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgLy8gICAgICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgIyBpZiBhVG9rZW4sIHRyYW5zZmVyIGFUb2tlbgogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRCb3Jyb3coCiAgICAvLyAgICAgIyAgICAgICAgIHVzZXI9YXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICMgICAgICAgICB0b2tlbl9pZD1hcmM0LlVJbnQ2NChtYXJrZXRfaWQpLAogICAgLy8gICAgICMgICAgICAgICBhbW91bnQ9YXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiByZXBheShzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fcmVwYXkoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBSZXBheSBib3Jyb3dlZCB0b2tlbnMgZm9yIGEgc3BlY2lmaWMgbWFya2V0LgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgaGFuZGxlcyB0aGUgcmVwYXltZW50IG9mIGJvcnJvd2VkIHRva2VucyB3aXRoIGEgbWluaW11bSBpbnRlcmVzdAogICAgLy8gICAgIHJlcXVpcmVtZW50LiBJdCBzdXBwb3J0cyBib3RoIHNUb2tlbiAoYnVybikgYW5kIGFUb2tlbiAodHJhbnNmZXIpIG1hcmtldHMuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgdXNlciBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIG1hcmtldF9pZDogVGhlIG1hcmtldCBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIGFtb3VudDogVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gcmVwYXkgKG11c3QgYmUgPj0gYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIG1hcmtldCB2YWxpZGF0aW9uIGZhaWxzLCByZXBheSBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0LAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgIHJlcGF5IGFtb3VudCBpcyBsZXNzIHRoYW4gYWNjcnVlZCBpbnRlcmVzdCwgb3IgcHJpbmNpcGFsCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgcmVwYXltZW50IGV4Y2VlZHMgc2NhbGVkIGRlYnQKICAgIC8vIAogICAgLy8gICAgIFByb2Nlc3M6CiAgICAvLyAgICAgICAgIDEuIFZhbGlkYXRlcyBtYXJrZXQgb3BlcmF0aW9uIGFuZCBhY2NydWVzIGludGVyZXN0CiAgICAvLyAgICAgICAgIDIuIENhbGN1bGF0ZXMgdG90YWwgZGVidCBpbmNsdWRpbmcgYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gICAgICAgICAzLiBWYWxpZGF0ZXMgcmVwYXkgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vICAgICAgICAgNC4gUmVxdWlyZXMgbWluaW11bSByZXBheW1lbnQgb2YgYXQgbGVhc3QgdGhlIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICAgICAgICAgNS4gQ2FsY3VsYXRlcyBwcmluY2lwYWwgcmVwYXltZW50IChhbW91bnQgLSBpbnRlcmVzdCkKICAgIC8vICAgICAgICAgNi4gQnVybnMgc1Rva2VucyBvciB0cmFuc2ZlcnMgYVRva2VucyBmcm9tIHVzZXIKICAgIC8vICAgICAgICAgNy4gVXBkYXRlcyB1c2VyIGFuZCBtYXJrZXQgc2NhbGVkIGJvcnJvdyBhbW91bnRzIChwcmluY2lwYWwgb25seSkKICAgIC8vICAgICAgICAgOC4gVXBkYXRlcyBnbG9iYWwgYm9ycm93IHZhbHVlIHRyYWNraW5nIHdpdGggcHJvcGVyIHByaWNlIGhhbmRsaW5nCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIGRlYnQgaW5jbHVkaW5nIGludGVyZXN0CiAgICAvLyAgICAgdW5zY2FsZWRfYm9ycm93cyA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgdG90YWxfZGVidCA9IHVuc2NhbGVkX2JvcnJvd3MgKyBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIFZhbGlkYXRlIHJlcGF5IGFtb3VudCBkb2Vzbid0IGV4Y2VlZCB0b3RhbCBkZWJ0CiAgICAvLyAgICAgYXNzZXJ0IGFtb3VudCA8PSB0b3RhbF9kZWJ0LCAiUmVwYXkgYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidCIKICAgIC8vIAogICAgLy8gICAgICMgUmVxdWlyZSBtaW5pbXVtIHJlcGF5bWVudCBvZiBhdCBsZWFzdCB0aGUgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGFtb3VudCA+PSBkZWJ0X2ludGVyZXN0CiAgICAvLyAgICAgKSwgIlJlcGF5IGFtb3VudCBtdXN0IGJlIGF0IGxlYXN0IHRoZSBhY2NydWVkIGludGVyZXN0IgogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgaG93IG11Y2ggZ29lcyB0b3dhcmQgcHJpbmNpcGFsIHJlcGF5bWVudAogICAgLy8gICAgIHByaW5jaXBhbF9yZXBheW1lbnQgPSBhbW91bnQgLSBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBzY2FsZWQgYW1vdW50IGZvciBwcmluY2lwYWwgcmVwYXltZW50IG9ubHkKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gKHByaW5jaXBhbF9yZXBheW1lbnQgKiBTQ0FMRSkgLy8gbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgYXNzZXJ0IHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IHNjYWxlZF9hbW91bnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyBkZWJ0IgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCB1c2VyX2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gICAgIG5ld19ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgICAgICAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAvLyBTQ0FMRQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICBwcmljZV9mb3Jfb2xkID0gKAogICAgLy8gICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgcHJpY2VfZm9yX25ldyA9IG5ld19tYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICBvbGRfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld192YWx1ZSA9IChuZXdfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9uZXcpIC8vIFNDQUxFCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRSZXBheSgKICAgIC8vICAgICAjICAgICAgICAgdXNlcj1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NChtYXJrZXRfaWQpLAogICAgLy8gICAgICMgICAgICAgICBhbW91bnQ9YXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyAjIG1pbnQvcmVkZWVtIHJlbGF0ZWQgY29kZQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgcmVkZWVtKHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gIyAgICAgc2VsZi5fcmVkZWVtKG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9yZWRlZW0oc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICMgICAgIGFzc2VydCBub3Qgc2VsZi5faGFzX3Bvc2l0aW9uKAogICAgLy8gIyAgICAgICAgIFR4bi5zZW5kZXIsIG1hcmtldF9pZAogICAgLy8gIyAgICAgKSwgIkNhbm5vdCBtaW50L3JlZGVlbSB3aGVuIHVzZXIgaGFzIHRyYWNrZWQgZGVwb3NpdCBwb3NpdGlvbiIKICAgIC8vIAogICAgLy8gIyAgICAgbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBzY2FsZWRfYW1vdW50ID0gKGFtb3VudCAqIFNDQUxFKSAvLyBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICMgICAgIGFzc2VydCAoCiAgICAvLyAjICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gc2NhbGVkX2Ftb3VudAogICAgLy8gIyAgICAgKSwgIkluc3VmZmljaWVudCBtYXJrZXQgZGVwb3NpdHMgdG8gcmVkZWVtIgogICAgLy8gIyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksCiAgICAvLyAjICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAjICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBtaW50KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fbWludChtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfbWludChzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIC8vIAogICAgLy8gIyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9oYXNfcG9zaXRpb24oCiAgICAvLyAjICAgICAgICAgVHhuLnNlbmRlciwgbWFya2V0X2lkCiAgICAvLyAjICAgICApLCAiQ2Fubm90IG1pbnQvcmVkZWVtIHdoZW4gdXNlciBoYXMgdHJhY2tlZCBkZXBvc2l0IHBvc2l0aW9uIgogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gIyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdCgKICAgIC8vICMgICAgICAgICBtYXJrZXRfaWQKICAgIC8vICMgICAgICkgICMgR2V0IHVwZGF0ZWQgbWFya2V0IHdpdGggYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gIyAgICAgc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICMgICAgICAgICBhbW91bnQgKiBTQ0FMRQogICAgLy8gIyAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgLy8gCiAgICAvLyAjICAgICBhc3NlcnQgKAogICAgLy8gIyAgICAgICAgIG5ld19tYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gIyAgICAgICAgID49IG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQKICAgIC8vICMgICAgICksICJEZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gIyAgICAgIyBPbmx5IGluY3JlbWVudCBtYXJrZXQgdG90YWwgZGVwb3NpdHMsIG5vdCB1c2VyIGRlcG9zaXRzIHNpbmNlIHBvc2l0aW9uIGlzIG5vdCB0cmFja2VkCiAgICAvLyAjICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gIyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAgICAgTWludEV2ZW50KAogICAgLy8gIyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksIGFyYzQuVUludDI1NihhbW91bnQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICAgICAgdXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkuY29weSgpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMgPT0gMCBhbmQgdXNlci5zY2FsZWRfYm9ycm93cyA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBkZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgICAgICBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBvbGRfZGVwb3NpdF92YWx1ZSA9IChkZXBvc2l0X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld19kZXBvc2l0X3ZhbHVlID0gKGRlcG9zaXRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICAgICAgdXNlcl9pZCwgbWFya2V0X2lkLCBvbGRfZGVwb3NpdF92YWx1ZSwgbmV3X2RlcG9zaXRfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgICAgICBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBvbGRfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgICAgICB1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF9ib3Jyb3dfdmFsdWUsIG5ld19ib3Jyb3dfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gR2xvYmFsVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IEdsb2JhbFVzZXJEYXRhOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi5nbG9iYWxfdXNlcnM6CiAgICBmcmFtZV9kaWcgLTEKICAgIGNvbmNhdAogICAgZHVwCiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM0OAogICAgLy8gaWYgdXNlcl9pZCBpbiBzZWxmLmdsb2JhbF91c2VyczoKICAgIGJ6IF9nZXRfZ2xvYmFsX3VzZXJfZWxzZV9ib2R5QDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM0OQogICAgLy8gcmV0dXJuIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdCiAgICBmcmFtZV9kaWcgMAogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYuZ2xvYmFsX3VzZXJzIGVudHJ5IGV4aXN0cwogICAgc3dhcAogICAgcmV0c3ViCgpfZ2V0X2dsb2JhbF91c2VyX2Vsc2VfYm9keUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzUxCiAgICAvLyBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIGJ5dGUgMHg3Mzc0NmY3MjYxNjc2NTVmNjE3MDcwNWY2OTY0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNTIKICAgIC8vIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICBib3hfZ2V0CiAgICBhc3NlcnQgLy8gY2hlY2sgQm94IGV4aXN0cwogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzUzLTIzNTUKICAgIC8vIGdsb2JhbF91c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfZ2xvYmFsX3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICBtZXRob2QgImdldF9nbG9iYWxfdXNlcl9kZWZhdWx0KCkodWludDI1Nix1aW50MjU2LHVpbnQ2NCkiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZHVwCiAgICBleHRyYWN0IDQgMAogICAgc3dhcAogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzU2CiAgICAvLyByZXR1cm4gZ2xvYmFsX3VzZXIKICAgIHN3YXAKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLndpdGhkcmF3KG1hcmtldF9pZDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IGJ5dGVzOgp3aXRoZHJhdzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTgxMS0xODEyCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhdyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gYXJjNC5VSW50MjU2OgogICAgcHJvdG8gMiAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MTMKICAgIC8vIGVuc3VyZV9idWRnZXQoMjEwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIGludCAyMTAwCiAgICBpbnQgMAogICAgY2FsbHN1YiBlbnN1cmVfYnVkZ2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MTUtMTgxNgogICAgLy8gIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgd2l0aGRyYXduIGZyb20gdG8gdXBkYXRlIGdsb2JhbCB2YWx1ZXMgd2l0aCBpbnRlcmVzdAogICAgLy8gc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUpCiAgICB0eG4gU2VuZGVyCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ0b2kKICAgIGR1cAogICAgY292ZXIgMgogICAgY2FsbHN1YiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MTgKICAgIC8vIHJldHVybiBhcmM0LlVJbnQyNTYoc2VsZi5fd2l0aGRyYXcoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkpCiAgICB0eG4gU2VuZGVyCiAgICBzd2FwCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX3dpdGhkcmF3CiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBifAogICAgcmV0c3ViCgoKLy8gYWxnb3B5LmVuc3VyZV9idWRnZXQocmVxdWlyZWRfYnVkZ2V0OiB1aW50NjQsIGZlZV9zb3VyY2U6IHVpbnQ2NCkgLT4gdm9pZDoKZW5zdXJlX2J1ZGdldDoKICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weToxMS0xNwogICAgcHJvdG8gMiAwCiAgICAvLyA8YWxnb3B5Pi9hbGdvcHkucHk6MTgKICAgIGZyYW1lX2RpZyAtMgogICAgaW50IDEwCiAgICArCgplbnN1cmVfYnVkZ2V0X3doaWxlX3RvcEAxOgogICAgLy8gPGFsZ29weT4vYWxnb3B5LnB5OjE5CiAgICBmcmFtZV9kaWcgMAogICAgZ2xvYmFsIE9wY29kZUJ1ZGdldAogICAgPgogICAgYnogZW5zdXJlX2J1ZGdldF9hZnRlcl93aGlsZUA3CiAgICAvLyA8YWxnb3B5Pi9hbGdvcHkucHk6MjAKICAgIGl0eG5fYmVnaW4KICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weToyMQogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weToyMgogICAgaW50IERlbGV0ZUFwcGxpY2F0aW9uCiAgICBpdHhuX2ZpZWxkIE9uQ29tcGxldGlvbgogICAgLy8gPGFsZ29weT4vYWxnb3B5LnB5OjIzCiAgICBieXRlIDB4MDY4MTAxCiAgICBpdHhuX2ZpZWxkIEFwcHJvdmFsUHJvZ3JhbQogICAgLy8gPGFsZ29weT4vYWxnb3B5LnB5OjI0CiAgICBieXRlIDB4MDY4MTAxCiAgICBpdHhuX2ZpZWxkIENsZWFyU3RhdGVQcm9ncmFtCiAgICAvLyA8YWxnb3B5Pi9hbGdvcHkucHk6MjUtMjkKICAgIGZyYW1lX2RpZyAtMQogICAgc3dpdGNoIGVuc3VyZV9idWRnZXRfc3dpdGNoX2Nhc2VfMEAzIGVuc3VyZV9idWRnZXRfc3dpdGNoX2Nhc2VfMUA0CiAgICBiIGVuc3VyZV9idWRnZXRfc3dpdGNoX2Nhc2VfbmV4dEA2CgplbnN1cmVfYnVkZ2V0X3N3aXRjaF9jYXNlXzBAMzoKICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weToyNwogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBiIGVuc3VyZV9idWRnZXRfc3dpdGNoX2Nhc2VfbmV4dEA2CgplbnN1cmVfYnVkZ2V0X3N3aXRjaF9jYXNlXzFANDoKICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weToyOQogICAgZ2xvYmFsIE1pblR4bkZlZQogICAgaXR4bl9maWVsZCBGZWUKCmVuc3VyZV9idWRnZXRfc3dpdGNoX2Nhc2VfbmV4dEA2OgogICAgLy8gPGFsZ29weT4vYWxnb3B5LnB5OjMwCiAgICBpdHhuX3N1Ym1pdAogICAgYiBlbnN1cmVfYnVkZ2V0X3doaWxlX3RvcEAxCgplbnN1cmVfYnVkZ2V0X2FmdGVyX3doaWxlQDc6CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCkgLT4gdm9pZDoKX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjI5NS0yMjk4CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgaW50IDAKICAgIGR1cG4gNQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzAwCiAgICAvLyB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKS5jb3B5KCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9nZXRfdXNlcgogICAgZHVwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMDEKICAgIC8vIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzID09IDAgYW5kIHVzZXIuc2NhbGVkX2JvcnJvd3MgPT0gMDoKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAKICAgIGI9PQogICAgYnogX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZV9hZnRlcl9pZl9lbHNlQDMKICAgIGZyYW1lX2RpZyA2CiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAKICAgIGI9PQogICAgYnogX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZV9hZnRlcl9pZl9lbHNlQDMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMwMgogICAgLy8gcmV0dXJuCiAgICByZXRzdWIKCl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2VfYWZ0ZXJfaWZfZWxzZUAzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzA0CiAgICAvLyBtYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9hY2NydWVfaW50ZXJlc3QKICAgIGZyYW1lX2J1cnkgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzA2CiAgICAvLyBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPiAwOgogICAgZnJhbWVfZGlnIDcKICAgIGJ5dGUgMHgKICAgIGI+CiAgICBieiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlX2FmdGVyX2lmX2Vsc2VAOAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzA4CiAgICAvLyB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyAyCiAgICBleHRyYWN0IDE3NyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyA3CiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzA5CiAgICAvLyApIC8vIFNDQUxFCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzA3LTIzMDkKICAgIC8vIGRlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gKSAvLyBTQ0FMRQogICAgYi8KICAgIGZyYW1lX2J1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzEzCiAgICAvLyBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgZnJhbWVfZGlnIDYKICAgIGV4dHJhY3QgMTM2IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDUKICAgIGJ5dGUgMHgKICAgIGI+CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMTItMjMxNAogICAgLy8gdXNlci5sYXN0X3ByaWNlLm5hdGl2ZQogICAgLy8gaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vIGVsc2UgbWFya2V0LnByaWNlLm5hdGl2ZQogICAgYnogX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZV90ZXJuYXJ5X2ZhbHNlQDYKICAgIGZyYW1lX2RpZyA1CiAgICBiIF91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2VfdGVybmFyeV9tZXJnZUA3CgpfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlX3Rlcm5hcnlfZmFsc2VANjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMxNAogICAgLy8gZWxzZSBtYXJrZXQucHJpY2UubmF0aXZlCiAgICBmcmFtZV9kaWcgMgogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKCl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2VfdGVybmFyeV9tZXJnZUA3OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzE2CiAgICAvLyBvbGRfZGVwb3NpdF92YWx1ZSA9IChkZXBvc2l0X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICBmcmFtZV9kaWcgMQogICAgZHVwCiAgICB1bmNvdmVyIDIKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMxNwogICAgLy8gbmV3X2RlcG9zaXRfdmFsdWUgPSAoZGVwb3NpdF9hbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDIKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMTgtMjMyMAogICAgLy8gc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgIHVzZXJfaWQsIG1hcmtldF9pZCwgb2xkX2RlcG9zaXRfdmFsdWUsIG5ld19kZXBvc2l0X3ZhbHVlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgdW5jb3ZlciAzCiAgICB1bmNvdmVyIDMKICAgIGNhbGxzdWIgX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbAoKX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZV9hZnRlcl9pZl9lbHNlQDg6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMjIKICAgIC8vIGlmIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID4gMDoKICAgIGZyYW1lX2RpZyA2CiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDMKICAgIGJ5dGUgMHgKICAgIGI+CiAgICBieiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlX2FmdGVyX2lmX2Vsc2VAMTMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMyNAogICAgLy8gdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgZnJhbWVfZGlnIDIKICAgIGV4dHJhY3QgMjA5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIDMKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMjUKICAgIC8vICkgLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMjMtMjMyNQogICAgLy8gYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyApIC8vIFNDQUxFCiAgICBiLwogICAgZnJhbWVfYnVyeSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMjkKICAgIC8vIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICBmcmFtZV9kaWcgNgogICAgZXh0cmFjdCAxMzYgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgNAogICAgYnl0ZSAweAogICAgYj4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMyOC0yMzMwCiAgICAvLyB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgLy8gZWxzZSBtYXJrZXQucHJpY2UubmF0aXZlCiAgICBieiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlX3Rlcm5hcnlfZmFsc2VAMTEKICAgIGZyYW1lX2RpZyA0CiAgICBiIF91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2VfdGVybmFyeV9tZXJnZUAxMgoKX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZV90ZXJuYXJ5X2ZhbHNlQDExOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzMwCiAgICAvLyBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIGZyYW1lX2RpZyAyCiAgICBpbnQgMjgxCiAgICBpbnQgMzIKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwoKX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZV90ZXJuYXJ5X21lcmdlQDEyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzMyCiAgICAvLyBvbGRfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDAKICAgIGR1cAogICAgdW5jb3ZlciAyCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMzMKICAgIC8vIG5ld19ib3Jyb3dfdmFsdWUgPSAoYm9ycm93X2Ftb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICBmcmFtZV9kaWcgMgogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMzNC0yMzM2CiAgICAvLyBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgdXNlcl9pZCwgbWFya2V0X2lkLCBvbGRfYm9ycm93X3ZhbHVlLCBuZXdfYm9ycm93X3ZhbHVlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgdW5jb3ZlciAzCiAgICB1bmNvdmVyIDMKICAgIGNhbGxzdWIgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cwoKX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZV9hZnRlcl9pZl9lbHNlQDEzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzM4CiAgICAvLyB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X3VzZXJfa2V5CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMzkKICAgIC8vIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgZnJhbWVfZGlnIDIKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgNgogICAgc3dhcAogICAgcmVwbGFjZTIgMTM2CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk3MAogICAgLy8gc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICBieXRlICJ1c2VycyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM0MAogICAgLy8gc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgdW5jb3ZlciAyCiAgICBjb25jYXQKICAgIHN3YXAKICAgIGJveF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3ModXNlcl9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0LCBvbGRfdmFsdWU6IGJ5dGVzLCBuZXdfdmFsdWU6IGJ5dGVzKSAtPiB2b2lkOgpfdXBkYXRlX2dsb2JhbF9ib3Jyb3dzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzc1LTIzODIKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzgzCiAgICAvLyBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgZnJhbWVfZGlnIC00CiAgICBjYWxsc3ViIF9nZXRfZ2xvYmFsX3VzZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM4NgogICAgLy8gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSAtIG9sZF92YWx1ZSArIG5ld192YWx1ZQogICAgZHVwCiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIC0yCiAgICBiLQogICAgZnJhbWVfZGlnIC0xCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzg1LTIzODcKICAgIC8vIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZSA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIC0gb2xkX3ZhbHVlICsgbmV3X3ZhbHVlCiAgICAvLyApCiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBifAogICAgcmVwbGFjZTIgMzIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM4OAogICAgLy8gZ2xvYmFsX3VzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgaXRvYgogICAgcmVwbGFjZTIgNjQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTcxCiAgICAvLyBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIGJ5dGUgImdsb2JhbF91c2VycyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM5MAogICAgLy8gc2VsZi5nbG9iYWxfdXNlcnNbdXNlcl9pZF0gPSBnbG9iYWxfdXNlci5jb3B5KCkKICAgIGZyYW1lX2RpZyAtNAogICAgY29uY2F0CiAgICBzd2FwCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fd2l0aGRyYXcodXNlcl9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0LCBhbW91bnQ6IGJ5dGVzKSAtPiBieXRlczoKX3dpdGhkcmF3OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODIwLTE4MjMKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIHByb3RvIDMgMQogICAgaW50IDAKICAgIGR1cG4gMTcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg0NwogICAgLy8gc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBpbnQgMQogICAgY2FsbHN1YiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODQ5LTE4NTIKICAgIC8vICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIHdpdGhkcmF3IG9wZXJhdGlvbgogICAgLy8gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIG1hcmtldF9pZAogICAgLy8gKS53aXRoZHJhdy5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg1MwogICAgLy8gaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICBieXRlIDB4CiAgICBiPgogICAgYnogX3dpdGhkcmF3X2FmdGVyX2lmX2Vsc2VAMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODU0CiAgICAvLyBhc3NlcnQgYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJXaXRoZHJhdyBjYXAgZXhjZWVkZWQiCiAgICBmcmFtZV9kaWcgLTEKICAgIGZyYW1lX2RpZyAxOAogICAgYjw9CiAgICBhc3NlcnQgLy8gV2l0aGRyYXcgY2FwIGV4Y2VlZGVkCgpfd2l0aGRyYXdfYWZ0ZXJfaWZfZWxzZUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODU2CiAgICAvLyBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfYWNjcnVlX2ludGVyZXN0CiAgICBmcmFtZV9idXJ5IDUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg1NwogICAgLy8gdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfdXNlcgogICAgZHVwCiAgICBmcmFtZV9idXJ5IDE1CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4NTkKICAgIC8vIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0CiAgICBmcmFtZV9idXJ5IDMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg2MwogICAgLy8gYW1vdW50IDw9IHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEzCiAgICBmcmFtZV9kaWcgLTEKICAgIGI+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODYxLTE4NjQKICAgIC8vICMgYW1vdW50IGlzIHRoZSBhbW91bnQgb2YgblRva2VucyBiZWluZyBidXJuZWQKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgYW1vdW50IDw9IHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgYXNzZXJ0IC8vIEluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4NjYKICAgIC8vIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF9nbG9iYWxfdXNlcgogICAgZHVwCiAgICBmcmFtZV9idXJ5IDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg2OC0xODY5CiAgICAvLyAjIGhlYWx0aCBjaGVjazogZW5zdXJlIHdpdGhkcmF3IHdvdWxkIG5vdCBwdXQgYm9ycm93cyBhdCByaXNrCiAgICAvLyBpZiBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPiAwOgogICAgZXh0cmFjdCAzMiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA4CiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAogICAgYj4KICAgIGJ6IF93aXRoZHJhd19hZnRlcl9pZl9lbHNlQDQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg3MC0xODcxCiAgICAvLyAjIHZhbHVlIG9mIHVuZGVybHlpbmcgYW1vdW50IHRvIHdpdGhkcmF3IHVzaW5nIG5ldyBtYXJrZXQgcHJpY2UKICAgIC8vIHdpdGhkcmF3X3ZhbHVlID0gKGFtb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDUKICAgIGR1cAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAtMQogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODczCiAgICAvLyBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIHdpdGhkcmF3X3ZhbHVlCiAgICBmcmFtZV9kaWcgMgogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODcyLTE4NzQKICAgIC8vIHJlbWFpbmluZ19jb2xsYXRlcmFsID0gKAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gd2l0aGRyYXdfdmFsdWUKICAgIC8vICkKICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg3MwogICAgLy8gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSB3aXRoZHJhd192YWx1ZQogICAgYi0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg3NgogICAgLy8gcmVtYWluaW5nX2NvbGxhdGVyYWwgKiBCaWdVSW50KG5ld19tYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgc3dhcAogICAgZXh0cmFjdCA3MyA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgaXRvYgogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg3NwogICAgLy8gKSAvLyBCaWdVSW50KDEwMDAwKSwgIldpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzayIKICAgIGJ5dGUgMHgyNzEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4NzUtMTg3NwogICAgLy8gYXNzZXJ0IGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgPD0gKAogICAgLy8gICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsICogQmlnVUludChuZXdfbWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICkgLy8gQmlnVUludCgxMDAwMCksICJXaXRoZHJhd2FsIHdvdWxkIHB1dCBib3Jyb3dzIGF0IHJpc2siCiAgICBiLwogICAgZnJhbWVfZGlnIDgKICAgIGI+PQogICAgYXNzZXJ0IC8vIFdpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzawoKX3dpdGhkcmF3X2FmdGVyX2lmX2Vsc2VANDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg3OQogICAgLy8gc2VsZi5fZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHVzZXJfaWQsIGFtb3VudCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg4MAogICAgLy8gc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBhbW91bnQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg4Mi0xODg3CiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIE5Ub2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODg1CiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMQogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGR1cAogICAgZnJhbWVfYnVyeSAxCiAgICBmcmFtZV9kaWcgLTEKICAgIGRpZyAxCiAgICBifAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODg2CiAgICAvLyBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIGZyYW1lX2RpZyA1CiAgICBkdXAKICAgIGNvdmVyIDMKICAgIGludCAzMTMKICAgIGludCA4CiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ0b2kKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODgyLTE4ODcKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgTlRva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG5ld19tYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyApCiAgICBtZXRob2QgImJ1cm5fZnJvbShhZGRyZXNzLHVpbnQyNTYpdm9pZCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTMKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg4OS0xODk0CiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg5MgogICAgLy8gYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIGZyYW1lX2RpZyAtMQogICAgZnJhbWVfZGlnIDMKICAgIGR1cAogICAgY292ZXIgMwogICAgYisKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxMAogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgYnwKICAgIGZyYW1lX2RpZyAtMgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4ODktMTg5NAogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQgKyBpbnRlcmVzdCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyApCiAgICBtZXRob2QgImFyYzIwMF90cmFuc2ZlcihhZGRyZXNzLHVpbnQyNTYpYm9vbCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTMKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODk3CiAgICAvLyB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICBmcmFtZV9kaWcgMTUKICAgIGV4dHJhY3QgNjQgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgMTMKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4OTgKICAgIC8vICkgLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4OTYtMTg5OAogICAgLy8gb2xkX2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICkgLy8gU0NBTEUKICAgIGIvCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgNwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODk5CiAgICAvLyBuZXdfZGVwb3NpdF9hbW91bnQgPSBvbGRfZGVwb3NpdF9hbW91bnQgKyBpbnRlcmVzdCAtIGFtb3VudAogICAgYisKICAgIGZyYW1lX2RpZyAtMQogICAgYi0KICAgIGZyYW1lX2J1cnkgNAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTAxCiAgICAvLyBhbW91bnRfdXNkX3ZhbHVlID0gKGFtb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxMQogICAgZnJhbWVfZGlnIC0xCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICBmcmFtZV9idXJ5IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkwMy0xOTA0CiAgICAvLyAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIHdpdGhkcmF3IG9wZXJhdGlvbgogICAgLy8gdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X3VzZXJfY2FwCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMTYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkwNQogICAgLy8gaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9PSAwOgogICAgZXh0cmFjdCAxOTIgOCAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA5CiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMAogICAgYj09CiAgICBieiBfd2l0aGRyYXdfZWxzZV9ib2R5QDgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkwNgogICAgLy8gdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wICsgODY0MDApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpbnQgODY0MDAKICAgICsKICAgIGl0b2IKICAgIGZyYW1lX2RpZyAxNgogICAgc3dhcAogICAgcmVwbGFjZTIgMTkyCiAgICBmcmFtZV9idXJ5IDE2CiAgICBiIF93aXRoZHJhd19hZnRlcl9pZl9lbHNlQDExCgpfd2l0aGRyYXdfZWxzZV9ib2R5QDg6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MDcKICAgIC8vIGVsaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA8IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wOgogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgaXRvYgogICAgZnJhbWVfZGlnIDkKICAgIGI+CiAgICBmcmFtZV9kaWcgMTYKICAgIGZyYW1lX2J1cnkgMTcKICAgIGJ6IF93aXRoZHJhd19hZnRlcl9pZl9lbHNlQDEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MDgKICAgIC8vIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KDApCiAgICBmcmFtZV9kaWcgMTYKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICByZXBsYWNlMiA5NgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTA5CiAgICAvLyB1c2VyX2NhcC50b3RhbF9saXF1aWRhdGlvbnMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICByZXBsYWNlMiA2NAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTEwCiAgICAvLyB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGludCA4NjQwMAogICAgKwogICAgaXRvYgogICAgcmVwbGFjZTIgMTkyCiAgICBmcmFtZV9idXJ5IDE3Cgpfd2l0aGRyYXdfYWZ0ZXJfaWZfZWxzZUAxMDoKICAgIGZyYW1lX2RpZyAxNwogICAgZnJhbWVfYnVyeSAxNgoKX3dpdGhkcmF3X2FmdGVyX2lmX2Vsc2VAMTE6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MTEKICAgIC8vIGlmIHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZSA+IDA6CiAgICBmcmFtZV9kaWcgMTYKICAgIGV4dHJhY3QgMTYwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEyCiAgICBieXRlIDB4CiAgICBiPgogICAgYnogX3dpdGhkcmF3X2FmdGVyX2lmX2Vsc2VAMTMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkxMgogICAgLy8gbmV3X3RvdGFsX3dpdGhkcmF3YWxzID0gdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMubmF0aXZlICsgYW1vdW50X3VzZF92YWx1ZQogICAgZnJhbWVfZGlnIDE2CiAgICBkdXAKICAgIGV4dHJhY3QgOTYgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgMAogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkxNAogICAgLy8gbmV3X3RvdGFsX3dpdGhkcmF3YWxzIDw9IHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZQogICAgZHVwCiAgICBmcmFtZV9kaWcgMTIKICAgIGI8PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTEzLTE5MTUKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgbmV3X3RvdGFsX3dpdGhkcmF3YWxzIDw9IHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZQogICAgLy8gKSwgIlVzZXIgd2l0aGRyYXcgY2FwIGV4Y2VlZGVkIgogICAgYXNzZXJ0IC8vIFVzZXIgd2l0aGRyYXcgY2FwIGV4Y2VlZGVkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MTYKICAgIC8vIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KG5ld190b3RhbF93aXRoZHJhd2FscykKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGZyYW1lX2RpZyAxCiAgICBifAogICAgcmVwbGFjZTIgOTYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkxNwogICAgLy8gc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQsIHVzZXJfY2FwKQogICAgZnJhbWVfZGlnIC0zCiAgICBzd2FwCiAgICBjYWxsc3ViIF9zZXRfdXNlcl9jYXAKICAgIHBvcAoKX3dpdGhkcmF3X2FmdGVyX2lmX2Vsc2VAMTM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MTkKICAgIC8vIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPT0gMDoKICAgIGZyYW1lX2RpZyAxNQogICAgZXh0cmFjdCAxMzYgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMTQKICAgIGJ5dGUgMHgKICAgIGI9PQogICAgYnogX3dpdGhkcmF3X2Vsc2VfYm9keUAxNQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTIwLTE5MjEKICAgIC8vICMgRmFsbGJhY2s6IFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSB0byBwcmV2ZW50IG5lZ2F0aXZlIGNvbGxhdGVyYWwKICAgIC8vIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIGZyYW1lX2RpZyA3CiAgICBmcmFtZV9kaWcgMTEKICAgIGR1cAogICAgY292ZXIgMgogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTIyCiAgICAvLyBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICBmcmFtZV9kaWcgNAogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgZnJhbWVfYnVyeSA2CiAgICBiIF93aXRoZHJhd19hZnRlcl9pZl9lbHNlQDE2Cgpfd2l0aGRyYXdfZWxzZV9ib2R5QDE1OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTI0LTE5MjUKICAgIC8vICMgTm9ybWFsIGNhc2U6IFVzZSB1c2VyJ3MgbGFzdCByZWNvcmRlZCBwcmljZSBmb3IgYWNjdXJhdGUgY29sbGF0ZXJhbCByZWR1Y3Rpb24KICAgIC8vIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDcKICAgIGZyYW1lX2RpZyAxNAogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTI2CiAgICAvLyBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICBmcmFtZV9kaWcgNAogICAgZnJhbWVfZGlnIDExCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICBmcmFtZV9idXJ5IDYKCl93aXRoZHJhd19hZnRlcl9pZl9lbHNlQDE2OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTI4LTE5MzMKICAgIC8vIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICB1c2VyX2lkLAogICAgLy8gICAgIG1hcmtldF9pZCwKICAgIC8vICAgICBvbGRfdmFsdWUsICAjIG9sZCBVU0QgdmFsdWUKICAgIC8vICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC0yCiAgICB1bmNvdmVyIDIKICAgIGZyYW1lX2RpZyA2CiAgICBjYWxsc3ViIF91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk0MgogICAgLy8gcmV0dXJuIGFtb3VudCArIGludGVyZXN0CiAgICBmcmFtZV9kaWcgMTAKICAgIGZyYW1lX2J1cnkgMAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkOiB1aW50NjQsIHVzZXJfaWQ6IGJ5dGVzLCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0czoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA5Ny0xMTAwCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTAxCiAgICAvLyBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X21hcmtldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTAyCiAgICAvLyB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF91c2VyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMDMKICAgIC8vIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfdXNlcl9rZXkKICAgIGNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEwNQogICAgLy8gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgZHVwCiAgICBleHRyYWN0IDAgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2RpZyAtMQogICAgYj49CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMDQtMTEwNgogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICBhc3NlcnQgLy8gSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEwNwogICAgLy8gdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgZnJhbWVfZGlnIC0xCiAgICBiLQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEwOAogICAgLy8gdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIGRpZyAxCiAgICBleHRyYWN0IDE3NyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHJlcGxhY2UyIDY0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMDkKICAgIC8vIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgaXRvYgogICAgcmVwbGFjZTIgMTI4CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMTAKICAgIC8vIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIHN3YXAKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICByZXBsYWNlMiAxMzYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTcwCiAgICAvLyBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIGJ5dGUgInVzZXJzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTExCiAgICAvLyBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICB1bmNvdmVyIDIKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZDogdWludDY0LCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NjQtMTQ2NwogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NjgKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NzAKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgZHVwCiAgICBleHRyYWN0IDExMyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfZGlnIC0xCiAgICBiPj0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ2OS0xNDcxCiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgYXNzZXJ0IC8vIEluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NzMKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50CiAgICBmcmFtZV9kaWcgLTEKICAgIGItCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NzItMTQ3NAogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gKQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDExMwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDc1CiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIGZyYW1lX2RpZyAtMgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjkKICAgIC8vIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgYnl0ZSAibWFya2V0cyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ3NQogICAgLy8gc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBzd2FwCiAgICBjb25jYXQKICAgIHN3YXAKICAgIGJveF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLmJvcnJvdyhtYXJrZXRfaWQ6IGJ5dGVzLCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpib3Jyb3c6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NDYtMTk0NwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYm9ycm93KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NDgKICAgIC8vIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIGludCAyODAwCiAgICBpbnQgMAogICAgY2FsbHN1YiBlbnN1cmVfYnVkZ2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NTAtMTk1MQogICAgLy8gIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgYm9ycm93ZWQgZnJvbSB0byB1cGRhdGUgZ2xvYmFsIHZhbHVlcyB3aXRoIGludGVyZXN0CiAgICAvLyBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIHR4biBTZW5kZXIKICAgIGZyYW1lX2RpZyAtMgogICAgYnRvaQogICAgZHVwCiAgICBjb3ZlciAyCiAgICBjYWxsc3ViIF91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk1MwogICAgLy8gc2VsZi5fYm9ycm93KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICB0eG4gU2VuZGVyCiAgICBzd2FwCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2JvcnJvdwogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2JvcnJvdyh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9ib3Jyb3c6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NTUtMTk1NgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYm9ycm93KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICBwcm90byAzIDAKICAgIGludCAwCiAgICBkdXBuIDE0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NTcKICAgIC8vIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIEZhbHNlKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIGludCAwCiAgICBjYWxsc3ViIF92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NTktMTk2MgogICAgLy8gIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgYm9ycm93IG9wZXJhdGlvbgogICAgLy8gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIG1hcmtldF9pZAogICAgLy8gKS5ib3Jyb3cubmF0aXZlCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICBleHRyYWN0IDY0IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NjMKICAgIC8vIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgYnl0ZSAweAogICAgYj4KICAgIGJ6IF9ib3Jyb3dfYWZ0ZXJfaWZfZWxzZUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NjQKICAgIC8vIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIkJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICBmcmFtZV9kaWcgLTEKICAgIGZyYW1lX2RpZyAxNQogICAgYjw9CiAgICBhc3NlcnQgLy8gQm9ycm93IGNhcCBleGNlZWRlZAoKX2JvcnJvd19hZnRlcl9pZl9lbHNlQDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NjYKICAgIC8vIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxNAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTY4CiAgICAvLyBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KHVzZXJfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgcmVxdWlyZV9wYXltZW50CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NjkKICAgIC8vIGFzc2VydCBwYXltZW50ID49IFVJbnQ2NCgxMDAwMDApLCAiUGF5bWVudCBhbW91bnQgbXVzdCBiZSA+PSAwLjEiCiAgICBpbnQgMTAwMDAwCiAgICA+PQogICAgYXNzZXJ0IC8vIFBheW1lbnQgYW1vdW50IG11c3QgYmUgPj0gMC4xCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NzEKICAgIC8vIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9hY2NydWVfaW50ZXJlc3QKICAgIGR1cAogICAgZnJhbWVfYnVyeSAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NzMtMTk3NAogICAgLy8gIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gZGVidF9pbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QKICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk3OAogICAgLy8gbmV3X21hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIGR1cAogICAgZXh0cmFjdCAxNDUgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBzd2FwCiAgICBkdXAKICAgIGV4dHJhY3QgMjA5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDExCiAgICB1bmNvdmVyIDIKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NzkKICAgIC8vICkgLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NzYtMTk3OQogICAgLy8gIyBDYWxjdWxhdGUgY3VycmVudCBtYXJrZXQgdG90YWwgYm9ycm93cyAoaW5jbHVkaW5nIGludGVyZXN0KQogICAgLy8gY3VycmVudF9tYXJrZXRfdG90YWxfYm9ycm93cyA9ICgKICAgIC8vICAgICBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gKSAvLyBTQ0FMRQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk4MS0xOTgzCiAgICAvLyAjIENhbGN1bGF0ZSB0b3RhbCBhbW91bnQgYmVpbmcgYWRkZWQgKG5ldyBib3Jyb3cgKyBkZWJ0IGludGVyZXN0KQogICAgLy8gIyBkZWJ0IGludGVyZXN0IGFkZGVkIGF0IHRoaXMgcG9pbnQgdG8gcHJldmVudCB1bm5lY2Vzc2FyeSBkZWJ0IHJlc2V0CiAgICAvLyB0b3RhbF9hbW91bnRfdG9fYWRkID0gYW1vdW50ICsgZGVidF9pbnRlcmVzdAogICAgZnJhbWVfZGlnIC0xCiAgICB1bmNvdmVyIDMKICAgIGIrCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMTIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk4NwogICAgLy8gbmV3X21hcmtldC5tYXhfdG90YWxfYm9ycm93cy5uYXRpdmUKICAgIGRpZyAyCiAgICBleHRyYWN0IDMzIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTg4CiAgICAvLyA+PSBjdXJyZW50X21hcmtldF90b3RhbF9ib3Jyb3dzICsgdG90YWxfYW1vdW50X3RvX2FkZAogICAgdW5jb3ZlciAyCiAgICBkaWcgMQogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk4Ny0xOTg4CiAgICAvLyBuZXdfbWFya2V0Lm1heF90b3RhbF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gPj0gY3VycmVudF9tYXJrZXRfdG90YWxfYm9ycm93cyArIHRvdGFsX2Ftb3VudF90b19hZGQKICAgIHVuY292ZXIgMgogICAgYjw9CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5ODUtMTk4OQogICAgLy8gIyBWYWxpZGF0ZSBhZ2FpbnN0IG1hcmtldC13aWRlIGJvcnJvdyBjYXAKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgbmV3X21hcmtldC5tYXhfdG90YWxfYm9ycm93cy5uYXRpdmUKICAgIC8vICAgICA+PSBjdXJyZW50X21hcmtldF90b3RhbF9ib3Jyb3dzICsgdG90YWxfYW1vdW50X3RvX2FkZAogICAgLy8gKSwgIkJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICBhc3NlcnQgLy8gQm9ycm93IGNhcCBleGNlZWRlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTkxLTE5OTMKICAgIC8vICMgQ2hlY2sgY29sbGF0ZXJhbCByZXF1aXJlbWVudHMgLSBleGNsdWRlIHNhbWUgbWFya2V0IGNvbGxhdGVyYWwgdG8gcHJldmVudAogICAgLy8gIyBpbmVmZmljaWVudCBzYW1lLWFzc2V0IGJvcnJvd2luZwogICAgLy8gZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X2dsb2JhbF91c2VyCiAgICBkdXAKICAgIGNvdmVyIDQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk5NQogICAgLy8gbmV3X2JvcnJvd192YWx1ZSA9ICh0b3RhbF9hbW91bnRfdG9fYWRkICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICB1bmNvdmVyIDIKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgNgogICAgdW5jb3ZlciAyCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5OTYKICAgIC8vIHRvdGFsX2JvcnJvd192YWx1ZSA9IGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgKyBuZXdfYm9ycm93X3ZhbHVlCiAgICBzd2FwCiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYisKICAgIGZyYW1lX2J1cnkgMTMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk5OC0xOTk5CiAgICAvLyAjIENhbGN1bGF0ZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IEJpZ1VJbnQoMCk6CiAgICBleHRyYWN0IDAgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgNwogICAgYnl0ZSAweAogICAgYj09CiAgICBieiBfYm9ycm93X2Vsc2VfYm9keUA0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMDAKICAgIC8vIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGIgX2JvcnJvd19hZnRlcl9pZl9lbHNlQDgKCl9ib3Jyb3dfZWxzZV9ib2R5QDQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMDQKICAgIC8vIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyAyCiAgICBleHRyYWN0IDE3NyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyA3CiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDA1CiAgICAvLyApIC8vIFNDQUxFCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDAzLTIwMDUKICAgIC8vIGRlcG9zaXRlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gKSAvLyBTQ0FMRQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAwNgogICAgLy8gZXhjbHVkZWRfdmFsdWUgPSAoZGVwb3NpdGVkX2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDYKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIGR1cAogICAgZnJhbWVfYnVyeSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMDcKICAgIC8vIGlmIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlID4gZXhjbHVkZWRfdmFsdWU6CiAgICBzd2FwCiAgICBleHRyYWN0IDAgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgOAogICAgYjwKICAgIGJ6IF9ib3Jyb3dfZWxzZV9ib2R5QDYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAwOC0yMDEwCiAgICAvLyBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSA9ICgKICAgIC8vICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIGV4Y2x1ZGVkX3ZhbHVlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgOAogICAgZnJhbWVfZGlnIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAwOQogICAgLy8gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBleGNsdWRlZF92YWx1ZQogICAgYi0KICAgIGIgX2JvcnJvd19hZnRlcl9pZl9lbHNlQDgKCl9ib3Jyb3dfZWxzZV9ib2R5QDY6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMTIKICAgIC8vIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gQmlnVUludCgwKQogICAgYnl0ZSAweAoKX2JvcnJvd19hZnRlcl9pZl9lbHNlQDg6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMTUKICAgIC8vIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlICogQmlnVUludChuZXdfbWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAyCiAgICBleHRyYWN0IDczIDggLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICBpdG9iCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDE2CiAgICAvLyApIC8vIEJpZ1VJbnQoMTAwMDApLCAiSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgYWNyb3NzIG1hcmtldHMiCiAgICBieXRlIDB4MjcxMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDE0LTIwMTYKICAgIC8vIGFzc2VydCB0b3RhbF9ib3Jyb3dfdmFsdWUgPD0gKAogICAgLy8gICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlICogQmlnVUludChuZXdfbWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICkgLy8gQmlnVUludCgxMDAwMCksICJJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCBhY3Jvc3MgbWFya2V0cyIKICAgIGIvCiAgICBmcmFtZV9kaWcgMTMKICAgIGI+PQogICAgYXNzZXJ0IC8vIEluc3VmZmljaWVudCBjb2xsYXRlcmFsIGFjcm9zcyBtYXJrZXRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMTgtMjAxOQogICAgLy8gIyBDYWxjdWxhdGUgc2NhbGVkIGFtb3VudCBmb3IgdGhlIHRvdGFsCiAgICAvLyBzY2FsZWRfYW1vdW50ID0gKHRvdGFsX2Ftb3VudF90b19hZGQgKiBTQ0FMRSkgLy8gbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICBmcmFtZV9kaWcgMTIKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiKgogICAgZnJhbWVfZGlnIDExCiAgICBkdXAKICAgIGNvdmVyIDIKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMjEKICAgIC8vIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMwogICAgZGlnIDIKICAgIGNhbGxzdWIgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDIyCiAgICAvLyBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIGZyYW1lX2RpZyAtMgogICAgZGlnIDEKICAgIGNhbGxzdWIgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAyNQogICAgLy8gdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgLy8gU0NBTEUKICAgIGZyYW1lX2RpZyAxNAogICAgZHVwCiAgICBjb3ZlciAzCiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBkaWcgMwogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDI0LTIwMjYKICAgIC8vIG9sZF9ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlIC8vIFNDQUxFCiAgICAvLyApCiAgICBmcmFtZV9idXJ5IDQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAyOAogICAgLy8gKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgc2NhbGVkX2Ftb3VudCkKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMjgtMjAyOQogICAgLy8gKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgc2NhbGVkX2Ftb3VudCkKICAgIC8vICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDMwCiAgICAvLyAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAyOC0yMDMwCiAgICAvLyAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBzY2FsZWRfYW1vdW50KQogICAgLy8gKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vIC8vIFNDQUxFCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDI3LTIwMzEKICAgIC8vIG5ld19ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAvLyBTQ0FMRQogICAgLy8gKQogICAgZnJhbWVfYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMzYKICAgIC8vIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICBleHRyYWN0IDEzNiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA5CiAgICBieXRlIDB4CiAgICBiPgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDM1LTIwMzcKICAgIC8vIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyBlbHNlIG5ld19tYXJrZXQucHJpY2UubmF0aXZlCiAgICBieiBfYm9ycm93X3Rlcm5hcnlfZmFsc2VAMTAKICAgIGZyYW1lX2RpZyA5CiAgICBiIF9ib3Jyb3dfdGVybmFyeV9tZXJnZUAxMQoKX2JvcnJvd190ZXJuYXJ5X2ZhbHNlQDEwOgogICAgZnJhbWVfZGlnIDYKCl9ib3Jyb3dfdGVybmFyeV9tZXJnZUAxMToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA0MQogICAgLy8gb2xkX3ZhbHVlID0gKG9sZF9ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX29sZCkgLy8gU0NBTEUKICAgIGZyYW1lX2RpZyA0CiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICBmcmFtZV9idXJ5IDUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA0MgogICAgLy8gbmV3X3ZhbHVlID0gKG5ld19ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX25ldykgLy8gU0NBTEUKICAgIGZyYW1lX2RpZyAxCiAgICBmcmFtZV9kaWcgNgogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgZnJhbWVfYnVyeSAzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNDQtMjA0NQogICAgLy8gIyBERi1BVUQtMDk6IFZhbGlkYXRlIHVzZXIgY2FwIGZvciBib3Jyb3cgb3BlcmF0aW9uCiAgICAvLyB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfdXNlcl9jYXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA0NgogICAgLy8gaWYgdXNlcl9jYXAudG90YWxfYm9ycm93cy5uYXRpdmUgPiAwOgogICAgZXh0cmFjdCAzMiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxMAogICAgYnl0ZSAweAogICAgYj4KICAgIGJ6IF9ib3Jyb3dfYWZ0ZXJfaWZfZWxzZUAxMwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDQ4CiAgICAvLyBuZXdfdmFsdWUgPD0gdXNlcl9jYXAudG90YWxfYm9ycm93cy5uYXRpdmUKICAgIGZyYW1lX2RpZyAzCiAgICBmcmFtZV9kaWcgMTAKICAgIGI8PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDQ3LTIwNDkKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2JvcnJvd3MubmF0aXZlCiAgICAvLyApLCAiVXNlciBib3Jyb3cgY2FwIGV4Y2VlZGVkIgogICAgYXNzZXJ0IC8vIFVzZXIgYm9ycm93IGNhcCBleGNlZWRlZAoKX2JvcnJvd19hZnRlcl9pZl9lbHNlQDEzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDUxLTIwNTYKICAgIC8vIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICB1c2VyX2lkLAogICAgLy8gICAgIG1hcmtldF9pZCwKICAgIC8vICAgICBvbGRfdmFsdWUsICAjIG9sZCBVU0QgdmFsdWUKICAgIC8vICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgNQogICAgZnJhbWVfZGlnIDMKICAgIGNhbGxzdWIgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDU4LTIwNTkKICAgIC8vICMgaWYgc3Rva2VuLCBtaW50IHN0b2tlbgogICAgLy8gaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2NwogICAgLy8gc2VsZi5zdG9rZW5fYXBwX2lkID0gVUludDY0KCkgICMgc3RhYmxlIG1hcmtldAogICAgYnl0ZSAic3Rva2VuX2FwcF9pZCIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA1OC0yMDU5CiAgICAvLyAjIGlmIHN0b2tlbiwgbWludCBzdG9rZW4KICAgIC8vIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYuc3Rva2VuX2FwcF9pZCBleGlzdHMKICAgIGZyYW1lX2RpZyAtMgogICAgPT0KICAgIGJ6IF9ib3Jyb3dfZWxzZV9ib2R5QDE3CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNjAtMjA2NQogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBTVG9rZW4ubWludCwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyApCiAgICBpdHhuX2JlZ2luCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNjMKICAgIC8vIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgZnJhbWVfZGlnIC0xCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgZnJhbWVfZGlnIC0xCiAgICBifAogICAgZnJhbWVfZGlnIC0yCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA2MC0yMDY1CiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIFNUb2tlbi5taW50LAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICkKICAgIG1ldGhvZCAibWludChhZGRyZXNzLHVpbnQyNTYpdm9pZCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTMKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA2Ni0yMDY4CiAgICAvLyBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgLy8gKS5zdWJtaXQoKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDY3CiAgICAvLyByZWNlaXZlcj1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAsIGZlZT0wCiAgICBmcmFtZV9kaWcgLTIKICAgIGFwcF9wYXJhbXNfZ2V0IEFwcEFkZHJlc3MKICAgIGFzc2VydCAvLyBhcHBsaWNhdGlvbiBleGlzdHMKICAgIGludCAxMDAwMDAKICAgIGl0eG5fZmllbGQgQW1vdW50CiAgICBpdHhuX2ZpZWxkIFJlY2VpdmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNjYKICAgIC8vIGl0eG4uUGF5bWVudCgKICAgIGludCBwYXkKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA2NwogICAgLy8gcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNjYtMjA2OAogICAgLy8gaXR4bi5QYXltZW50KAogICAgLy8gICAgIHJlY2VpdmVyPUFwcGxpY2F0aW9uKG1hcmtldF9pZCkuYWRkcmVzcywgYW1vdW50PTEwMDAwMCwgZmVlPTAKICAgIC8vICkuc3VibWl0KCkKICAgIGl0eG5fc3VibWl0CiAgICBiIF9ib3Jyb3dfYWZ0ZXJfaWZfZWxzZUAxOQoKX2JvcnJvd19lbHNlX2JvZHlAMTc6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNzEtMjA3NgogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDc0CiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMQogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGZyYW1lX2RpZyAtMQogICAgYnwKICAgIGZyYW1lX2RpZyAtMgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNzEtMjA3NgogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgbWV0aG9kICJhcmMyMDBfdHJhbnNmZXIoYWRkcmVzcyx1aW50MjU2KWJvb2wiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgZnJhbWVfZGlnIC0zCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGV4dHJhY3QgMCA0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgID09CiAgICBhc3NlcnQgLy8gQVJDNCBwcmVmaXggaXMgdmFsaWQKCl9ib3Jyb3dfYWZ0ZXJfaWZfZWxzZUAxOToKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCkgLT4gYnl0ZXM6Cl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzg0LTE3ODcKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzg5CiAgICAvLyBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfYWNjcnVlX2ludGVyZXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3OTAKICAgIC8vIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc5NAogICAgLy8gdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIGR1cAogICAgZXh0cmFjdCAzMiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgY292ZXIgMwogICAgdW5jb3ZlciAyCiAgICBleHRyYWN0IDIwOSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgY292ZXIgMwogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc5NQogICAgLy8gKSAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc5Mi0xNzk1CiAgICAvLyAjIENhbGN1bGF0ZSB0b3RhbCB1bmRlcmx5aW5nIGRlYnQgYW1vdW50CiAgICAvLyB1c2VyX3RvdGFsX2RlYnQgPSAoCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICkgLy8gU0NBTEUKICAgIGIvCiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MDEKICAgIC8vIGlmIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZSA+IDAKICAgIGV4dHJhY3QgOTYgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGJ5dGUgMHgKICAgIGI+CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MDAtMTgwMgogICAgLy8gdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyBpZiB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUgPiAwCiAgICAvLyBlbHNlIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgYnogX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3RfdGVybmFyeV9mYWxzZUAyCiAgICBmcmFtZV9kaWcgMwogICAgYiBfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdF90ZXJuYXJ5X21lcmdlQDMKCl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0X3Rlcm5hcnlfZmFsc2VAMjoKICAgIGZyYW1lX2RpZyAxCgpfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdF90ZXJuYXJ5X21lcmdlQDM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MDQKICAgIC8vIG9yaWdpbmFsX3ByaW5jaXBhbCA9ICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHVzZXJfYm9ycm93X2luZGV4KSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDAKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTgwNi0xODA3CiAgICAvLyAjIEludGVyZXN0IGlzIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gY3VycmVudCB0b3RhbCBkZWJ0IGFuZCBvcmlnaW5hbCBwcmluY2lwYWwKICAgIC8vIGRlYnRfaW50ZXJlc3QgPSB1c2VyX3RvdGFsX2RlYnQgLSBvcmlnaW5hbF9wcmluY2lwYWwKICAgIGZyYW1lX2RpZyAyCiAgICBzd2FwCiAgICBiLQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODA5CiAgICAvLyByZXR1cm4gZGVidF9pbnRlcmVzdAogICAgZnJhbWVfYnVyeSAwCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZDogdWludDY0LCB1c2VyX2lkOiBieXRlcywgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93czoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA4NC0xMDg3CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMyAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwODgKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwODkKICAgIC8vIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA5MAogICAgLy8gdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF91c2VyX2tleQogICAgY292ZXIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDkxCiAgICAvLyB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgZHVwCiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIC0xCiAgICBiKwogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDMyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwOTIKICAgIC8vIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgZGlnIDEKICAgIGV4dHJhY3QgMjA5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgcmVwbGFjZTIgOTYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA5MwogICAgLy8gdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICByZXBsYWNlMiAxMjgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA5NAogICAgLy8gdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgc3dhcAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHJlcGxhY2UyIDEzNgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NzAKICAgIC8vIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgYnl0ZSAidXNlcnMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwOTUKICAgIC8vIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIHVuY292ZXIgMgogICAgY29uY2F0CiAgICBzd2FwCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3M6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NzctMTQ4MAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ4MQogICAgLy8gbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ4MwogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudAogICAgZHVwCiAgICBleHRyYWN0IDE0NSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAtMQogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ4Mi0xNDg0CiAgICAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gKQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDE0NQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDg1CiAgICAvLyBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgaXRvYgogICAgcmVwbGFjZTIgMjQxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0ODYKICAgIC8vIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgZnJhbWVfZGlnIC0yCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OQogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDg2CiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIHN3YXAKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wucmVwYXkobWFya2V0X2lkOiBieXRlcywgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKcmVwYXk6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwODYtMjA4NwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcmVwYXkoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA4OAogICAgLy8gZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgaW50IDE0MDAKICAgIGludCAwCiAgICBjYWxsc3ViIGVuc3VyZV9idWRnZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA4OQogICAgLy8gc2VsZi5fcmVwYXkoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIHR4biBTZW5kZXIKICAgIGZyYW1lX2RpZyAtMgogICAgYnRvaQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9yZXBheQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3JlcGF5KHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX3JlcGF5OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDkxLTIwOTIKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3JlcGF5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICBwcm90byAzIDAKICAgIGludCAwCiAgICBkdXBuIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjExOQogICAgLy8gc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgaW50IDAKICAgIGNhbGxzdWIgX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjEyMQogICAgLy8gdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfdXNlcgogICAgZHVwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxMjIKICAgIC8vIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9hY2NydWVfaW50ZXJlc3QKICAgIGR1cAogICAgdW5jb3ZlciAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxMjQtMjEyNQogICAgLy8gIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gZGVidF9pbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QKICAgIGNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjEyOQogICAgLy8gdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGNvdmVyIDMKICAgIHN3YXAKICAgIGV4dHJhY3QgMjA5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBjb3ZlciAzCiAgICBkdXAyCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTMwCiAgICAvLyApIC8vIFNDQUxFCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTI3LTIxMzAKICAgIC8vICMgQ2FsY3VsYXRlIHRvdGFsIGRlYnQgaW5jbHVkaW5nIGludGVyZXN0CiAgICAvLyB1bnNjYWxlZF9ib3Jyb3dzID0gKAogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyApIC8vIFNDQUxFCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTMxCiAgICAvLyB0b3RhbF9kZWJ0ID0gdW5zY2FsZWRfYm9ycm93cyArIGRlYnRfaW50ZXJlc3QKICAgIGRpZyAzCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTMzLTIxMzQKICAgIC8vICMgVmFsaWRhdGUgcmVwYXkgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vIGFzc2VydCBhbW91bnQgPD0gdG90YWxfZGVidCwgIlJlcGF5IGFtb3VudCBleGNlZWRzIHRvdGFsIGRlYnQiCiAgICBmcmFtZV9kaWcgLTEKICAgIGI+PQogICAgYXNzZXJ0IC8vIFJlcGF5IGFtb3VudCBleGNlZWRzIHRvdGFsIGRlYnQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjEzOAogICAgLy8gYW1vdW50ID49IGRlYnRfaW50ZXJlc3QKICAgIGZyYW1lX2RpZyAtMQogICAgZGlnIDMKICAgIGI+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTM2LTIxMzkKICAgIC8vICMgUmVxdWlyZSBtaW5pbXVtIHJlcGF5bWVudCBvZiBhdCBsZWFzdCB0aGUgZGVidCBpbnRlcmVzdAogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBhbW91bnQgPj0gZGVidF9pbnRlcmVzdAogICAgLy8gKSwgIlJlcGF5IGFtb3VudCBtdXN0IGJlIGF0IGxlYXN0IHRoZSBhY2NydWVkIGludGVyZXN0IgogICAgYXNzZXJ0IC8vIFJlcGF5IGFtb3VudCBtdXN0IGJlIGF0IGxlYXN0IHRoZSBhY2NydWVkIGludGVyZXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNDEtMjE0MgogICAgLy8gIyBDYWxjdWxhdGUgaG93IG11Y2ggZ29lcyB0b3dhcmQgcHJpbmNpcGFsIHJlcGF5bWVudAogICAgLy8gcHJpbmNpcGFsX3JlcGF5bWVudCA9IGFtb3VudCAtIGRlYnRfaW50ZXJlc3QKICAgIGZyYW1lX2RpZyAtMQogICAgdW5jb3ZlciAzCiAgICBiLQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTQ0LTIxNDUKICAgIC8vICMgQ2FsY3VsYXRlIHNjYWxlZCBhbW91bnQgZm9yIHByaW5jaXBhbCByZXBheW1lbnQgb25seQogICAgLy8gc2NhbGVkX2Ftb3VudCA9IChwcmluY2lwYWxfcmVwYXltZW50ICogU0NBTEUpIC8vIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIqCiAgICBzd2FwCiAgICBiLwogICAgZHVwCiAgICBjb3ZlciAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNDYKICAgIC8vIGFzc2VydCB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBzY2FsZWRfYW1vdW50LCAiUmVwYXkgYW1vdW50IGV4Y2VlZHMgZGVidCIKICAgIGI+PQogICAgYXNzZXJ0IC8vIFJlcGF5IGFtb3VudCBleGNlZWRzIGRlYnQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE0OAogICAgLy8gaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2NwogICAgLy8gc2VsZi5zdG9rZW5fYXBwX2lkID0gVUludDY0KCkgICMgc3RhYmxlIG1hcmtldAogICAgYnl0ZSAic3Rva2VuX2FwcF9pZCIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE0OAogICAgLy8gaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5zdG9rZW5fYXBwX2lkIGV4aXN0cwogICAgZnJhbWVfZGlnIC0yCiAgICA9PQogICAgYnogX3JlcGF5X2Vsc2VfYm9keUAzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNDktMjE1NAogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBTVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE1MgogICAgLy8gYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICBmcmFtZV9kaWcgLTEKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ8CiAgICBmcmFtZV9kaWcgLTIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTQ5LTIxNTQKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgU1Rva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyApCiAgICBtZXRob2QgImJ1cm5fZnJvbShhZGRyZXNzLHVpbnQyNTYpdm9pZCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTMKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGIgX3JlcGF5X2FmdGVyX2lmX2Vsc2VANQoKX3JlcGF5X2Vsc2VfYm9keUAzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTU2LTIxNjIKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTU5CiAgICAvLyBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICBnbG9iYWwgQ3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTYwCiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMQogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGZyYW1lX2RpZyAtMQogICAgYnwKICAgIGZyYW1lX2RpZyAtMgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNTYtMjE2MgogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyApCiAgICBtZXRob2QgImFyYzIwMF90cmFuc2ZlckZyb20oYWRkcmVzcyxhZGRyZXNzLHVpbnQyNTYpYm9vbCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTMKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBzd2FwCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGV4dHJhY3QgMCA0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgID09CiAgICBhc3NlcnQgLy8gQVJDNCBwcmVmaXggaXMgdmFsaWQKCl9yZXBheV9hZnRlcl9pZl9lbHNlQDU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNjQKICAgIC8vIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIDcKICAgIGR1cAogICAgY292ZXIgMwogICAgY2FsbHN1YiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNjUKICAgIC8vIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgZnJhbWVfZGlnIC0yCiAgICBkaWcgMQogICAgY2FsbHN1YiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTY4CiAgICAvLyB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDMKICAgIGR1cAogICAgY292ZXIgMgogICAgZXh0cmFjdCA5NiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyA1CiAgICBkdXAKICAgIHVuY292ZXIgMgogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTY3LTIxNjkKICAgIC8vIG9sZF9ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlIC8vIFNDQUxFCiAgICAvLyApCiAgICBmcmFtZV9idXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE3MQogICAgLy8gKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gc2NhbGVkX2Ftb3VudCkKICAgIHN3YXAKICAgIGItCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNzEtMjE3MgogICAgLy8gKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gc2NhbGVkX2Ftb3VudCkKICAgIC8vICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICBmcmFtZV9kaWcgNgogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE3MwogICAgLy8gLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNzEtMjE3MwogICAgLy8gKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gc2NhbGVkX2Ftb3VudCkKICAgIC8vICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAvLyBTQ0FMRQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE3MC0yMTc0CiAgICAvLyBuZXdfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgLy8gU0NBTEUKICAgIC8vICkKICAgIGZyYW1lX2J1cnkgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTc5CiAgICAvLyBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgZXh0cmFjdCAxMzYgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMgogICAgYnl0ZSAweAogICAgYj4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE3OC0yMTgwCiAgICAvLyB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgLy8gZWxzZSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgYnogX3JlcGF5X3Rlcm5hcnlfZmFsc2VANwogICAgZnJhbWVfZGlnIDIKICAgIGIgX3JlcGF5X3Rlcm5hcnlfbWVyZ2VAOAoKX3JlcGF5X3Rlcm5hcnlfZmFsc2VANzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE4MAogICAgLy8gZWxzZSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgZnJhbWVfZGlnIDQKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCgpfcmVwYXlfdGVybmFyeV9tZXJnZUA4OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTgyCiAgICAvLyBwcmljZV9mb3JfbmV3ID0gbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIGZyYW1lX2RpZyA0CiAgICBpbnQgMjgxCiAgICBpbnQgMzIKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTg0CiAgICAvLyBvbGRfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDEKICAgIHVuY292ZXIgMgogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTg1CiAgICAvLyBuZXdfdmFsdWUgPSAobmV3X2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3JfbmV3KSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDAKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE4Ni0yMTkxCiAgICAvLyBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgdXNlcl9pZCwKICAgIC8vICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgb2xkX3ZhbHVlLCAgIyBvbGQgVVNEIHZhbHVlCiAgICAvLyAgICAgbmV3X3ZhbHVlLCAgIyBuZXcgVVNEIHZhbHVlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgdW5jb3ZlciAzCiAgICB1bmNvdmVyIDMKICAgIGNhbGxzdWIgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cwogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQ6IHVpbnQ2NCwgdXNlcl9pZDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3M6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMTMtMTExNgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTE3CiAgICAvLyBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X21hcmtldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTE4CiAgICAvLyB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF91c2VyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMTkKICAgIC8vIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfdXNlcl9rZXkKICAgIGNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEyMQogICAgLy8gdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICBkdXAKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2RpZyAtMQogICAgYj49CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMjAtMTEyMgogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIGFzc2VydCAvLyBJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTIzCiAgICAvLyB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgZnJhbWVfZGlnIC0xCiAgICBiLQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDMyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMjQKICAgIC8vIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgZGlnIDEKICAgIGV4dHJhY3QgMjA5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgcmVwbGFjZTIgOTYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEyNQogICAgLy8gdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICByZXBsYWNlMiAxMjgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEyNgogICAgLy8gdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgc3dhcAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHJlcGxhY2UyIDEzNgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NzAKICAgIC8vIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgYnl0ZSAidXNlcnMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMjcKICAgIC8vIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIHVuY292ZXIgMgogICAgY29uY2F0CiAgICBzd2FwCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3M6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0ODgtMTQ5MQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ5MgogICAgLy8gbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ5NAogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIGR1cAogICAgZXh0cmFjdCAxNDUgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2RpZyAtMQogICAgYj49CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0OTMtMTQ5NQogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgYXNzZXJ0IC8vIEluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0OTcKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQKICAgIGZyYW1lX2RpZyAtMQogICAgYi0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ5Ni0xNDk4CiAgICAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gKQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDE0NQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDk5CiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIGZyYW1lX2RpZyAtMgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjkKICAgIC8vIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgYnl0ZSAibWFya2V0cyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ5OQogICAgLy8gc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBzd2FwCiAgICBjb25jYXQKICAgIHN3YXAKICAgIGJveF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLnN5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiBieXRlcykgLT4gdm9pZDoKc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjg2LTIyODkKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjkwCiAgICAvLyBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICBpbnQgMTQwMAogICAgaW50IDAKICAgIGNhbGxzdWIgZW5zdXJlX2J1ZGdldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjkyCiAgICAvLyB1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyOTEtMjI5MwogICAgLy8gc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgIHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTIKICAgIHN3YXAKICAgIGNhbGxzdWIgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQ6IGJ5dGVzKSAtPiBieXRlczoKZ2V0X2dsb2JhbF91c2VyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzQyLTIzNDMKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9nbG9iYWxfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IEdsb2JhbFVzZXJEYXRhOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNDQKICAgIC8vIHJldHVybiBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZC5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2dldF9nbG9iYWxfdXNlcgogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wubGlxdWlkYXRlX2Nyb3NzX21hcmtldChkZWJ0X21hcmtldF9pZDogYnl0ZXMsIGNvbGxhdGVyYWxfbWFya2V0X2lkOiBieXRlcywgdXNlcjogYnl0ZXMsIGRlYnRfYW1vdW50OiBieXRlcywgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQ6IGJ5dGVzKSAtPiB2b2lkOgpsaXF1aWRhdGVfY3Jvc3NfbWFya2V0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzkyLTI0MDAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGxpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHVzZXI6IGFyYzQuQWRkcmVzcywKICAgIC8vICAgICBkZWJ0X2Ftb3VudDogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBhcmM0LlVJbnQyNTYsCiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byA1IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQwMQogICAgLy8gZW5zdXJlX2J1ZGdldCg0OTAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgaW50IDQ5MDAKICAgIGludCAwCiAgICBjYWxsc3ViIGVuc3VyZV9idWRnZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQwMgogICAgLy8gYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIGNhbGxzdWIgX2lzX3BhdXNlZAogICAgIQogICAgYXNzZXJ0IC8vIFByb3RvY29sIGlzIHBhdXNlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDA2CiAgICAvLyB1c2VyLm5hdGl2ZSwgZGVidF9tYXJrZXRfaWQubmF0aXZlCiAgICBmcmFtZV9kaWcgLTUKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQwNC0yNDA3CiAgICAvLyAjIFN5bmMgZ2xvYmFsIHVzZXIgdmFsdWVzIGZvciBib3RoIG1hcmtldHMgdG8gaW5jbHVkZSBhY2NydWVkIGludGVyZXN0CiAgICAvLyBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgdXNlci5uYXRpdmUsIGRlYnRfbWFya2V0X2lkLm5hdGl2ZQogICAgLy8gKQogICAgZnJhbWVfZGlnIC0zCiAgICBkaWcgMQogICAgY2FsbHN1YiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MDkKICAgIC8vIHVzZXIubmF0aXZlLCBjb2xsYXRlcmFsX21hcmtldF9pZC5uYXRpdmUKICAgIGZyYW1lX2RpZyAtNAogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDA4LTI0MTAKICAgIC8vIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTMKICAgIGRpZyAxCiAgICBjYWxsc3ViIF91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQxNQogICAgLy8gVHhuLnNlbmRlciwKICAgIHR4biBTZW5kZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQxMi0yNDE5CiAgICAvLyBzZWxmLl9saXF1aWRhdGVfY3Jvc3NfbWFya2V0KAogICAgLy8gICAgIGRlYnRfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZC5uYXRpdmUsCiAgICAvLyAgICAgVHhuLnNlbmRlciwKICAgIC8vICAgICB1c2VyLm5hdGl2ZSwKICAgIC8vICAgICBkZWJ0X2Ftb3VudC5uYXRpdmUsCiAgICAvLyAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQubmF0aXZlLAogICAgLy8gKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfbGlxdWlkYXRlX2Nyb3NzX21hcmtldAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXQoZGVidF9tYXJrZXRfaWQ6IHVpbnQ2NCwgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IHVpbnQ2NCwgbGlxdWlkYXRvcl9pZDogYnl0ZXMsIHVzZXJfaWQ6IGJ5dGVzLCBkZWJ0X2Ftb3VudDogYnl0ZXMsIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBieXRlcykgLT4gdm9pZDoKX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MjEtMjQzMAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfbGlxdWlkYXRlX2Nyb3NzX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIGRlYnRfbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdG9yX2lkOiBBY2NvdW50LAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgZGVidF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQ6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byA2IDAKICAgIGludCAwCiAgICBkdXBuIDE2CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NjUtMjQ2OAogICAgLy8gIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgbGlxdWlkYXRlIG9wZXJhdGlvbgogICAgLy8gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIGRlYnRfbWFya2V0X2lkCiAgICAvLyApLmxpcXVpZGF0ZS5uYXRpdmUKICAgIGZyYW1lX2RpZyAtNgogICAgY2FsbHN1YiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIGV4dHJhY3QgOTYgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ2OQogICAgLy8gaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICBieXRlIDB4CiAgICBiPgogICAgYnogX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfYWZ0ZXJfaWZfZWxzZUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NzAKICAgIC8vIGFzc2VydCBkZWJ0X2Ftb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiTGlxdWlkYXRlIGNhcCBleGNlZWRlZCIKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIDE3CiAgICBiPD0KICAgIGFzc2VydCAvLyBMaXF1aWRhdGUgY2FwIGV4Y2VlZGVkCgpfbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9hZnRlcl9pZl9lbHNlQDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NzcKICAgIC8vIGNvbGxhdGVyYWxfbWFya2V0X2lkICE9IHNlbGYuc3Rva2VuX2FwcF9pZAogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY3CiAgICAvLyBzZWxmLnN0b2tlbl9hcHBfaWQgPSBVSW50NjQoKSAgIyBzdGFibGUgbWFya2V0CiAgICBieXRlICJzdG9rZW5fYXBwX2lkIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDc3CiAgICAvLyBjb2xsYXRlcmFsX21hcmtldF9pZCAhPSBzZWxmLnN0b2tlbl9hcHBfaWQKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5zdG9rZW5fYXBwX2lkIGV4aXN0cwogICAgZnJhbWVfZGlnIC01CiAgICAhPQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDcyLTI0NzgKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIyBSRU0gcHJldmVudCB1c2luZyBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgaW4gbGlxdWlkYXRpb24gYmVjYXVzZSBzdG9rZW4KICAgIC8vICMgUkVNIG1hcmtldCBjb2xsYXRlcmFsIGRvZXMgbm90IGV4aXN0CiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQgIT0gc2VsZi5zdG9rZW5fYXBwX2lkCiAgICAvLyApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgKGJvcnJvdy1vbmx5IG1hcmtldCkiCiAgICBhc3NlcnQgLy8gQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgKGJvcnJvdy1vbmx5IG1hcmtldCkKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ4MS0yNDg0CiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICMgUkVNIHByZXZlbnQgc2VsZiBsaXF1aWRhdGlvbgogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyBhc3NlcnQgdXNlcl9pZCAhPSBsaXF1aWRhdG9yX2lkLCAiQ2Fubm90IGxpcXVpZGF0ZSBzZWxmIgogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTQKICAgICE9CiAgICBhc3NlcnQgLy8gQ2Fubm90IGxpcXVpZGF0ZSBzZWxmCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OS0yNDg3CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc29tZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Iob3BlcmF0b3JfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3ggPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3gudmFsdWUgPSBhcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgQXV0aG9yaXplZFByaWNlT3BlcmF0b3JTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I9YXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gQWNjb3VudDoKICAgIC8vICAgICBvcGVyYXRvcl9pZCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyID09IHNlbGYuX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICAgICAgb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICAvLyAgICAgKSwgIm9ubHkgYXV0aG9yaXplZCBwcmljZSBvcGVyYXRvciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMTAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTUKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBwYXltZW50IDw9IDEwMDAwMDAKICAgIC8vICAgICApLCAicGF5bWVudCBleGNlZWRzIG1heGltdW0gZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTYKICAgIC8vICAgICBhcHAgPSBBcHBsaWNhdGlvbihzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gICAgIGl0eG4uUGF5bWVudChyZWNlaXZlcj1hcHAuYWRkcmVzcywgYW1vdW50PXBheW1lbnQsIGZlZT0wKS5zdWJtaXQoKQogICAgLy8gICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBQcmljZUZlZWRQcm92aWRlckludGVyZmFjZS5nZXRfcHJpY2Vfd2l0aF90aW1lc3RhbXAsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWFwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgICAgID4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICk6CiAgICAvLyAgICAgICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wID0gKAogICAgLy8gICAgICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAuY29weSgpCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZCwgcHJpY2Vfd2l0aF90aW1lc3RhbXAucHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBjb21tZW50ZWQgb3V0CiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBhc3NlcnQgdG9rZW5faWQubmF0aXZlIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAjICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NgogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfbWF4X3RvdGFsX2RlcG9zaXRzKHRva2VuX2lkLm5hdGl2ZSwgbWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWF4X3RvdGFsX2RlcG9zaXRzOiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBtYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KG1heF90b3RhbF9kZXBvc2l0cykKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldE1heFRvdGFsRGVwb3NpdHNTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KG1heF90b3RhbF9kZXBvc2l0cykKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fcGF1c2VfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgcGF1c2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9wYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0ucGF1c2VkID0gYXJjNC5Cb29sKHBhdXNlID09IFVJbnQ2NCgxKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY19tYXJrZXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYWNjcnVlX2ludGVyZXN0KHNlbGYsIG1hcmtldF9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGN1cnJlbnRfdGltZSA9IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wCiAgICAvLyAgICAgdGltZV9kZWx0YSA9IGN1cnJlbnRfdGltZSAtIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lLm5hdGl2ZQogICAgLy8gICAgIGlmIHRpbWVfZGVsdGEgPD0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgIyBGb3Igc3Rva2VuIG1hcmtldCAoYm9ycm93LW9ubHkpLCB1c2UgYSBmaXhlZCB1dGlsaXphdGlvbiByYXRlIHNpbmNlIHRoZXJlIGFyZSBubyBkZXBvc2l0cwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHV0aWxpemF0aW9uID0gQmlnVUludCgxMDAwMCkgICMgMTAwJSB1dGlsaXphdGlvbiBmb3IgYm9ycm93LW9ubHkgbWFya2V0CiAgICAvLyAgICAgZWxpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgdXRpbGl6YXRpb24gPSAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDAKICAgIC8vICAgICAgICAgKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgIHJhdGUgPSBtYXJrZXQuYm9ycm93X3JhdGUubmF0aXZlICsgKG1hcmtldC5zbG9wZS5uYXRpdmUgKiB1dGlsaXphdGlvbikgLy8gMTAwMDAKICAgIC8vICAgICBpbnRlcmVzdCA9IChyYXRlICogbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHRpbWVfZGVsdGEpIC8vICgKICAgIC8vICAgICAgICAgc2VsZi5zZWNvbmRzX3Blcl95ZWFyICogMTAwMDAKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHN0b2tlbiBtYXJrZXQgLSBhbGwgaW50ZXJlc3QgZ29lcyB0byByZXNlcnZlcwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBhcmM0LlVJbnQyNTYuZnJvbV9ieXRlcyhtYXJrZXQucmVzZXJ2ZV9mYWN0b3IuYnl0ZXMpLm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIDEwMDAwCiAgICAvLyAgICAgICAgIGlmIHByb3RvY29sX3BvcnRpb24gPiBpbnRlcmVzdDoKICAgIC8vICAgICAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IGludGVyZXN0IC0gcHJvdG9jb2xfcG9ydGlvbgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChkZXBvc2l0b3JfcG9ydGlvbiAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID4gMDoKICAgIC8vICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChpbnRlcmVzdCAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGludGVyZXN0CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgZGVwb3NpdG9yX3BvcnRpb24KICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgKyBwcm90b2NvbF9wb3J0aW9uKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoY3VycmVudF90aW1lKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAgICAgcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gIyBUT0RPIGdvdmVybmFuY2U6IGNvbnNpZGVyIGlmIHJlc2VydmUgd2l0aGRyYXdhbCBzaG91bGQgcmVxdWlyZSBhZGRpdGlvbmFsCiAgICAvLyAjICAgICAgZ292ZXJuYW5jZSBtZWNoYW5pc21zCiAgICAvLyAjIFRPRE8gbWluaW11bSByZXNlcnZlIGxldmVsczogbWlnaHQgd2FudCB0byBlbmZvcmNlIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHMgZm9yCiAgICAvLyAjICAgICAgcHJvdG9jb2wgc2FmZXR5CiAgICAvLyAjIFRPRE8gZXZlbnQgZW1pc3Npb246IENvbnNpZGVyIGFkZGluZyBhbiBldmVudCB0byBsb2cgcmVzZXJ2ZSB3aXRoZHJhd2FscyBmb3IKICAgIC8vICMgICAgICB0cmFuc3BhcmVuY3kKICAgIC8vIAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBza2lwcGluZyBzdWJyb3V0aW5lIHRvIHJlZHVjZSBjb250cmFjdCBzaXplCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl93aXRoZHJhd19yZXNlcnZlcyhtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIEFjY3J1ZSBpbnRlcmVzdCBmaXJzdCB0byBnZXQgdXAtdG8tZGF0ZSByZXNlcnZlcwogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgPj0gYW1vdW50LCAiSW5zdWZmaWNpZW50IHJlc2VydmVzIgogICAgLy8gCiAgICAvLyAgICAgIyBUcmFuc2ZlciByZXNlcnZlcyB0byB0aGUgb3duZXIgKG5vdCB0byB0aGUgY29udHJhY3QgaXRzZWxmKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVcGRhdGUgcmVzZXJ2ZXMKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbigKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50LCBndWFyZF9zdG9rZW46IGJvb2wKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCBhbW91bnQgPiAwLCAiQW1vdW50IG11c3QgYmUgPiAwIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBub3QgbWFya2V0LnBhdXNlZCwgIk1hcmtldCBpcyBwYXVzZWQiCiAgICAvLyAgICAgaWYgZ3VhcmRfc3Rva2VuOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgLy8gICAgICAgICApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGZvciB0aGlzIG9wZXJhdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGVwb3NpdChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9kZXBvc2l0KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgUkVNIG1heSBhZGQgcHJvdGVjdGlvbiBmb3IgbG93IHV0aWxpc2F0aW9uIGluIGZ1dHVyZQogICAgLy8gIyBSRU0gbG93ZXIgbWF4IGRlcG9zaXQgYW1vdW50IGZvciBsb3cgdXRpbGlzYXRpb24KICAgIC8vICMgUkVNIGhpZ2ggbWF4IGRlcG9zaXQgYW1vdW50IGZvciBoaWdoIHV0aWxpc2F0aW9uCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlcG9zaXQoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBJbnRlcm5hbCBkZXBvc2l0IG1ldGhvZCB0aGF0IGhhbmRsZXMgdXNlciBkZXBvc2l0cyBpbnRvIGEgbGVuZGluZyBtYXJrZXQuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBwZXJmb3JtcyBhIGNvbXBsZXRlIGRlcG9zaXQgb3BlcmF0aW9uIGluY2x1ZGluZzoKICAgIC8vICAgICAxLiBWYWxpZGF0aW5nIHRoZSBtYXJrZXQgb3BlcmF0aW9uIChwcm90b2NvbCBub3QgcGF1c2VkLCBtYXJrZXQgZXhpc3RzLCBhbW91bnQgPiAwLCBtYXJrZXQgbm90IHBhdXNlZCkKICAgIC8vICAgICAyLiBUcmFuc2ZlcnJpbmcgQVJDMjAwIHRva2VucyBmcm9tIHVzZXIgdG8gdGhlIGxlbmRpbmcgcG9vbCBjb250cmFjdAogICAgLy8gICAgIDMuIEFjY3J1aW5nIGludGVyZXN0IG9uIHRoZSBtYXJrZXQgdG8gZ2V0IHVwZGF0ZWQgZGVwb3NpdCBpbmRleAogICAgLy8gICAgIDQuIENhbGN1bGF0aW5nIGFuZCBhZGRpbmcgZWFybmVkIGludGVyZXN0IHRvIHRoZSB1c2VyJ3MgcG9zaXRpb24KICAgIC8vICAgICA1LiBDb252ZXJ0aW5nIGRlcG9zaXQgYW1vdW50IHRvIHNjYWxlZCBkZXBvc2l0cyB1c2luZyBjdXJyZW50IGRlcG9zaXQgaW5kZXgKICAgIC8vICAgICA2LiBDaGVja2luZyBkZXBvc2l0IGNhcCBjb25zdHJhaW50cwogICAgLy8gICAgIDcuIFVwZGF0aW5nIHVzZXIgYW5kIG1hcmtldCBzY2FsZWQgZGVwb3NpdCBiYWxhbmNlcwogICAgLy8gICAgIDguIE1pbnRpbmcgTlRva2VucyB0byByZXByZXNlbnQgdGhlIHVzZXIncyBkZXBvc2l0IHBvc2l0aW9uCiAgICAvLyAgICAgOS4gVXBkYXRpbmcgZ2xvYmFsIGNvbGxhdGVyYWwgY2FsY3VsYXRpb25zIGZvciB0aGUgdXNlcgogICAgLy8gICAgIDEwLiBFbWl0dGluZyBhIE1hcmtldERlcG9zaXQgZXZlbnQKICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQgKEFjY291bnQpOiBUaGUgYWNjb3VudCBJRCBvZiB0aGUgdXNlciBtYWtpbmcgdGhlIGRlcG9zaXQKICAgIC8vICAgICAgICAgbWFya2V0X2lkIChVSW50NjQpOiBUaGUgSUQgb2YgdGhlIG1hcmtldCB0byBkZXBvc2l0IGludG8KICAgIC8vICAgICAgICAgYW1vdW50IChCaWdVSW50KTogVGhlIGFtb3VudCBvZiB1bmRlcmx5aW5nIHRva2VucyB0byBkZXBvc2l0CiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiBtYXJrZXQgdmFsaWRhdGlvbiBmYWlscywgZGVwb3NpdCBjYXAgaXMgZXhjZWVkZWQsIG9yIG90aGVyIGNvbnN0cmFpbnRzIGFyZSB2aW9sYXRlZAogICAgLy8gCiAgICAvLyAgICAgTm90ZToKICAgIC8vICAgICAgICAgLSBJbnRlcmVzdCBlYXJuZWQgc2luY2UgbGFzdCBpbnRlcmFjdGlvbiBpcyBhdXRvbWF0aWNhbGx5IGFkZGVkIHRvIHRoZSBkZXBvc2l0CiAgICAvLyAgICAgICAgIC0gU2NhbGVkIGRlcG9zaXRzIGFyZSB1c2VkIHRvIHRyYWNrIHVzZXIgcG9zaXRpb25zIGFuZCBjYWxjdWxhdGUgaW50ZXJlc3QKICAgIC8vICAgICAgICAgLSBDb2xsYXRlcmFsIHZhbHVlIGlzIHVwZGF0ZWQgdXNpbmcgZWl0aGVyIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIG9yIGN1cnJlbnQgbWFya2V0IHByaWNlCiAgICAvLyAgICAgICAgIC0gTlRva2VucyBhcmUgbWludGVkIHRvIHJlcHJlc2VudCB0aGUgdXNlcidzIGRlcG9zaXQgcG9zaXRpb24gKGFtb3VudCArIGludGVyZXN0KQogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgKS5kZXBvc2l0Lm5hdGl2ZQogICAgLy8gICAgIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJEZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApICAjIEdldCB1cGRhdGVkIG1hcmtldCB3aXRoIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBBZGQgZWFybmVkIGludGVyZXN0IHRvIHVzZXIncyBwb3NpdGlvbiBhcyBhZGRpdGlvbmFsIHNjYWxlZCBkZXBvc2l0cwogICAgLy8gICAgIGludGVyZXN0X3NjYWxlZF9hbW91bnQgPSBCaWdVSW50KDApCiAgICAvLyAgICAgaWYgaW50ZXJlc3QgPiAwOgogICAgLy8gICAgICAgICBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBTQ0FMRQogICAgLy8gICAgICAgICApIC8vIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIGFtb3VudCAqIFNDQUxFCiAgICAvLyAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgLy8gCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2Ftb3VudCA9IHNjYWxlZF9hbW91bnQgKyBpbnRlcmVzdF9zY2FsZWRfYW1vdW50CiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0Lm1heF90b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgPj0gbmV3X21hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgdG90YWxfc2NhbGVkX2Ftb3VudAogICAgLy8gICAgICksICJNYXJrZXQgZGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIHVzZXJfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50ICsgaW50ZXJlc3QpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2RlcG9zaXRfYW1vdW50ID0gb2xkX2RlcG9zaXRfYW1vdW50ICsgYW1vdW50ICsgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgIyBGYWxsYmFjazogVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIHRvIHByZXZlbnQgbmVnYXRpdmUgY29sbGF0ZXJhbAogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSA9IChuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICAjIE5vcm1hbCBjYXNlOiBVc2UgdXNlcidzIGxhc3QgcmVjb3JkZWQgcHJpY2UgZm9yIGFjY3VyYXRlIGNvbGxhdGVyYWwgcmVkdWN0aW9uCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIGRlcG9zaXQgb3BlcmF0aW9uCiAgICAvLyAgICAgdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC50b3RhbF9kZXBvc2l0cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApLCAiVXNlciBkZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF92YWx1ZSwgbmV3X3ZhbHVlKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0RGVwb3NpdCgKICAgIC8vICAgICAjICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLCBhcmM0LlVJbnQyNTYoYW1vdW50KQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGNhbGN1bGF0ZV91c2VyX2ludGVyZXN0KAogICAgLy8gIyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyAjICkgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAjICAgICByZXR1cm4gYXJjNC5VSW50MjU2KAogICAgLy8gIyAgICAgICAgIHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgaW50ZXJlc3QiIiIKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgdW5kZXJseWluZyBhbW91bnQKICAgIC8vICAgICB1c2VyX3RvdGFsX3VuZGVybHlpbmcgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIEludGVyZXN0IGlzIHRoZSBkaWZmZXJlbmNlIGZyb20gdGhlIHNjYWxlZCBkZXBvc2l0cyAod2hpY2ggcmVwcmVzZW50IHRoZSAiYmFzZSIgYW1vdW50KQogICAgLy8gICAgIGludGVyZXN0ID0gdXNlcl90b3RhbF91bmRlcmx5aW5nIC0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gaW50ZXJlc3QKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGNhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAjICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICMgKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAjICAgICBlbnN1cmVfYnVkZ2V0KDcwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICMgICAgIHJldHVybiBhcmM0LlVJbnQyNTYoCiAgICAvLyAjICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBkZWJ0IGludGVyZXN0IiIiCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIHVuZGVybHlpbmcgZGVidCBhbW91bnQKICAgIC8vICAgICB1c2VyX3RvdGFsX2RlYnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgb3JpZ2luYWwgcHJpbmNpcGFsIGFtb3VudCB1c2luZyB1c2VyJ3MgYm9ycm93X2luZGV4CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIncyBib3Jyb3dfaW5kZXggaXMgMCwgdXNlIGN1cnJlbnQgbWFya2V0IGJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXJfYm9ycm93X2luZGV4ID0gKAogICAgLy8gICAgICAgICB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBvcmlnaW5hbF9wcmluY2lwYWwgPSAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyX2JvcnJvd19pbmRleCkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRvdGFsIGRlYnQgYW5kIG9yaWdpbmFsIHByaW5jaXBhbAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSB1c2VyX3RvdGFsX2RlYnQgLSBvcmlnaW5hbF9wcmluY2lwYWwKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHdpdGhkcmF3KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyMTAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gCiAgICAvLyAgICAgIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgd2l0aGRyYXduIGZyb20gdG8gdXBkYXRlIGdsb2JhbCB2YWx1ZXMgd2l0aCBpbnRlcmVzdAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDI1NihzZWxmLl93aXRoZHJhdyhUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXcoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFdpdGhkcmF3IHRva2VucyBmcm9tIGEgbGVuZGluZyBtYXJrZXQgYnkgYnVybmluZyBuVG9rZW5zLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgaGFuZGxlcyB0aGUgd2l0aGRyYXdhbCBwcm9jZXNzIGJ5OgogICAgLy8gICAgIDEuIFZhbGlkYXRpbmcgdGhlIG1hcmtldCBvcGVyYXRpb24gYW5kIHVzZXIgYmFsYW5jZQogICAgLy8gICAgIDIuIEFjY3J1aW5nIGludGVyZXN0IHRvIGdldCB0aGUgbGF0ZXN0IG1hcmtldCBzdGF0ZQogICAgLy8gICAgIDMuIENhbGN1bGF0aW5nIHVzZXIncyBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgNC4gUGVyZm9ybWluZyBoZWFsdGggY2hlY2tzIHRvIGVuc3VyZSB3aXRoZHJhd2FsIGRvZXNuJ3QgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgIDUuIEJ1cm5pbmcgblRva2VucyBhbmQgdHJhbnNmZXJyaW5nIHVuZGVybHlpbmcgdG9rZW5zIHRvIHVzZXIKICAgIC8vICAgICA2LiBVcGRhdGluZyBnbG9iYWwgY29sbGF0ZXJhbCB2YWx1ZXMKICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIHdpdGhkcmF3aW5nIHRva2VucwogICAgLy8gICAgICAgICBtYXJrZXRfaWQ6IFRoZSBJRCBvZiB0aGUgbWFya2V0IHRvIHdpdGhkcmF3IGZyb20KICAgIC8vICAgICAgICAgYW1vdW50OiBUaGUgYW1vdW50IG9mIG5Ub2tlbnMgdG8gYnVybiAobm90IHRoZSB1bmRlcmx5aW5nIHRva2VuIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAgIFJldHVybnM6CiAgICAvLyAgICAgICAgIEJpZ1VJbnQ6IFRoZSB0b3RhbCBhbW91bnQgb2YgdW5kZXJseWluZyB0b2tlbnMgdHJhbnNmZXJyZWQgdG8gdGhlIHVzZXIKICAgIC8vICAgICAgICAgICAgICAgICAoaW5jbHVkZXMgYm90aCB0aGUgd2l0aGRyYXduIGFtb3VudCBhbmQgYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIHVzZXIgaGFzIGluc3VmZmljaWVudCBiYWxhbmNlIG9yIHdpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciB3aXRoZHJhdyBvcGVyYXRpb24KICAgIC8vICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gICAgICkud2l0aGRyYXcubmF0aXZlCiAgICAvLyAgICAgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIldpdGhkcmF3IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgYW1vdW50IGlzIHRoZSBhbW91bnQgb2YgblRva2VucyBiZWluZyBidXJuZWQKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBhbW91bnQgPD0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgICMgaGVhbHRoIGNoZWNrOiBlbnN1cmUgd2l0aGRyYXcgd291bGQgbm90IHB1dCBib3Jyb3dzIGF0IHJpc2sKICAgIC8vICAgICBpZiBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPiAwOgogICAgLy8gICAgICAgICAjIHZhbHVlIG9mIHVuZGVybHlpbmcgYW1vdW50IHRvIHdpdGhkcmF3IHVzaW5nIG5ldyBtYXJrZXQgcHJpY2UKICAgIC8vICAgICAgICAgd2l0aGRyYXdfdmFsdWUgPSAoYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsID0gKAogICAgLy8gICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSB3aXRoZHJhd192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIGFzc2VydCBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIDw9ICgKICAgIC8vICAgICAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsICogQmlnVUludChuZXdfbWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICAgICAgICAgKSAvLyBCaWdVSW50KDEwMDAwKSwgIldpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzayIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCB1c2VyX2lkLCBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19kZXBvc2l0X2Ftb3VudCA9IG9sZF9kZXBvc2l0X2Ftb3VudCArIGludGVyZXN0IC0gYW1vdW50CiAgICAvLyAKICAgIC8vICAgICBhbW91bnRfdXNkX3ZhbHVlID0gKGFtb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHVzZXIgY2FwIGZvciB3aXRoZHJhdyBvcGVyYXRpb24KICAgIC8vICAgICB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgIGlmIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPT0gMDoKICAgIC8vICAgICAgICAgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wICsgODY0MDApCiAgICAvLyAgICAgZWxpZiB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lIDwgR2xvYmFsLmxhdGVzdF90aW1lc3RhbXA6CiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KDApCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX2xpcXVpZGF0aW9ucyA9IGFyYzQuVUludDI1NigwKQogICAgLy8gICAgICAgICB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC5kYWlseV93aXRoZHJhd2Fscy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBuZXdfdG90YWxfd2l0aGRyYXdhbHMgPSB1c2VyX2NhcC50b3RhbF93aXRoZHJhd2Fscy5uYXRpdmUgKyBhbW91bnRfdXNkX3ZhbHVlCiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICBuZXdfdG90YWxfd2l0aGRyYXdhbHMgPD0gdXNlcl9jYXAuZGFpbHlfd2l0aGRyYXdhbHMubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIHdpdGhkcmF3IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYobmV3X3RvdGFsX3dpdGhkcmF3YWxzKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZCwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgICMgRmFsbGJhY2s6IFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSB0byBwcmV2ZW50IG5lZ2F0aXZlIGNvbGxhdGVyYWwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgIyBOb3JtYWwgY2FzZTogVXNlIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIGZvciBhY2N1cmF0ZSBjb2xsYXRlcmFsIHJlZHVjdGlvbgogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIEVtaXQgZXZlbnRzCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0V2l0aGRyYXcoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgYXJjNC5VSW50NjQobWFya2V0X2lkKSwgYXJjNC5VSW50MjU2KGFtb3VudCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gYW1vdW50ICsgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gIyB3aXRoZHJhdyBjb3N0IDkwMDAwMAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBib3Jyb3coc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyODAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gCiAgICAvLyAgICAgIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgYm9ycm93ZWQgZnJvbSB0byB1cGRhdGUgZ2xvYmFsIHZhbHVlcyB3aXRoIGludGVyZXN0CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9ib3Jyb3coVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYm9ycm93KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBib3Jyb3cgb3BlcmF0aW9uCiAgICAvLyAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApLmJvcnJvdy5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KHVzZXJfaWQpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gVUludDY0KDEwMDAwMCksICJQYXltZW50IGFtb3VudCBtdXN0IGJlID49IDAuMSIKICAgIC8vIAogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGN1cnJlbnQgbWFya2V0IHRvdGFsIGJvcnJvd3MgKGluY2x1ZGluZyBpbnRlcmVzdCkKICAgIC8vICAgICBjdXJyZW50X21hcmtldF90b3RhbF9ib3Jyb3dzID0gKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIGFtb3VudCBiZWluZyBhZGRlZCAobmV3IGJvcnJvdyArIGRlYnQgaW50ZXJlc3QpCiAgICAvLyAgICAgIyBkZWJ0IGludGVyZXN0IGFkZGVkIGF0IHRoaXMgcG9pbnQgdG8gcHJldmVudCB1bm5lY2Vzc2FyeSBkZWJ0IHJlc2V0CiAgICAvLyAgICAgdG90YWxfYW1vdW50X3RvX2FkZCA9IGFtb3VudCArIGRlYnRfaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgICMgVmFsaWRhdGUgYWdhaW5zdCBtYXJrZXQtd2lkZSBib3Jyb3cgY2FwCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbmV3X21hcmtldC5tYXhfdG90YWxfYm9ycm93cy5uYXRpdmUKICAgIC8vICAgICAgICAgPj0gY3VycmVudF9tYXJrZXRfdG90YWxfYm9ycm93cyArIHRvdGFsX2Ftb3VudF90b19hZGQKICAgIC8vICAgICApLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgY29sbGF0ZXJhbCByZXF1aXJlbWVudHMgLSBleGNsdWRlIHNhbWUgbWFya2V0IGNvbGxhdGVyYWwgdG8gcHJldmVudAogICAgLy8gICAgICMgaW5lZmZpY2llbnQgc2FtZS1hc3NldCBib3Jyb3dpbmcKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgbmV3X2JvcnJvd192YWx1ZSA9ICh0b3RhbF9hbW91bnRfdG9fYWRkICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgdG90YWxfYm9ycm93X3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSArIG5ld19ib3Jyb3dfdmFsdWUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IEJpZ1VJbnQoMCk6CiAgICAvLyAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICAgICAjIFVzZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgZXhjbHVkZWRfdmFsdWUgPSAoZGVwb3NpdGVkX2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBpZiBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSA+IGV4Y2x1ZGVkX3ZhbHVlOgogICAgLy8gICAgICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSAoCiAgICAvLyAgICAgICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBleGNsdWRlZF92YWx1ZQogICAgLy8gICAgICAgICAgICAgKQogICAgLy8gICAgICAgICBlbHNlOgogICAgLy8gICAgICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSBCaWdVSW50KDApCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgdG90YWxfYm9ycm93X3ZhbHVlIDw9ICgKICAgIC8vICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgKiBCaWdVSW50KG5ld19tYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgLy8gICAgICkgLy8gQmlnVUludCgxMDAwMCksICJJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCBhY3Jvc3MgbWFya2V0cyIKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHNjYWxlZCBhbW91bnQgZm9yIHRoZSB0b3RhbAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAodG90YWxfYW1vdW50X3RvX2FkZCAqIFNDQUxFKSAvLyBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBvbGRfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgLy8gU0NBTEUKICAgIC8vICAgICApCiAgICAvLyAgICAgbmV3X2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgICAgICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgaWYgdXNlciBkb2Vzbid0IGhhdmUgYSBwcmV2aW91cyBwcmljZQogICAgLy8gICAgIHByaWNlX2Zvcl9vbGQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBwcmljZV9mb3JfbmV3ID0gbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIG9sZF92YWx1ZSA9IChvbGRfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X3ZhbHVlID0gKG5ld19ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX25ldykgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3IgYm9ycm93IG9wZXJhdGlvbgogICAgLy8gICAgIHVzZXJfY2FwID0gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9jYXAudG90YWxfYm9ycm93cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIGJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlLCAgIyBvbGQgVVNEIHZhbHVlCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSwgICMgbmV3IFVTRCB2YWx1ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgaWYgc3Rva2VuLCBtaW50IHN0b2tlbgogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBTVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICAgICAgcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgLy8gICAgICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgIyBpZiBhVG9rZW4sIHRyYW5zZmVyIGFUb2tlbgogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRCb3Jyb3coCiAgICAvLyAgICAgIyAgICAgICAgIHVzZXI9YXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICMgICAgICAgICB0b2tlbl9pZD1hcmM0LlVJbnQ2NChtYXJrZXRfaWQpLAogICAgLy8gICAgICMgICAgICAgICBhbW91bnQ9YXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiByZXBheShzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fcmVwYXkoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBSZXBheSBib3Jyb3dlZCB0b2tlbnMgZm9yIGEgc3BlY2lmaWMgbWFya2V0LgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgaGFuZGxlcyB0aGUgcmVwYXltZW50IG9mIGJvcnJvd2VkIHRva2VucyB3aXRoIGEgbWluaW11bSBpbnRlcmVzdAogICAgLy8gICAgIHJlcXVpcmVtZW50LiBJdCBzdXBwb3J0cyBib3RoIHNUb2tlbiAoYnVybikgYW5kIGFUb2tlbiAodHJhbnNmZXIpIG1hcmtldHMuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgdXNlciBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIG1hcmtldF9pZDogVGhlIG1hcmtldCBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIGFtb3VudDogVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gcmVwYXkgKG11c3QgYmUgPj0gYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIG1hcmtldCB2YWxpZGF0aW9uIGZhaWxzLCByZXBheSBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0LAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgIHJlcGF5IGFtb3VudCBpcyBsZXNzIHRoYW4gYWNjcnVlZCBpbnRlcmVzdCwgb3IgcHJpbmNpcGFsCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgcmVwYXltZW50IGV4Y2VlZHMgc2NhbGVkIGRlYnQKICAgIC8vIAogICAgLy8gICAgIFByb2Nlc3M6CiAgICAvLyAgICAgICAgIDEuIFZhbGlkYXRlcyBtYXJrZXQgb3BlcmF0aW9uIGFuZCBhY2NydWVzIGludGVyZXN0CiAgICAvLyAgICAgICAgIDIuIENhbGN1bGF0ZXMgdG90YWwgZGVidCBpbmNsdWRpbmcgYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gICAgICAgICAzLiBWYWxpZGF0ZXMgcmVwYXkgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vICAgICAgICAgNC4gUmVxdWlyZXMgbWluaW11bSByZXBheW1lbnQgb2YgYXQgbGVhc3QgdGhlIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICAgICAgICAgNS4gQ2FsY3VsYXRlcyBwcmluY2lwYWwgcmVwYXltZW50IChhbW91bnQgLSBpbnRlcmVzdCkKICAgIC8vICAgICAgICAgNi4gQnVybnMgc1Rva2VucyBvciB0cmFuc2ZlcnMgYVRva2VucyBmcm9tIHVzZXIKICAgIC8vICAgICAgICAgNy4gVXBkYXRlcyB1c2VyIGFuZCBtYXJrZXQgc2NhbGVkIGJvcnJvdyBhbW91bnRzIChwcmluY2lwYWwgb25seSkKICAgIC8vICAgICAgICAgOC4gVXBkYXRlcyBnbG9iYWwgYm9ycm93IHZhbHVlIHRyYWNraW5nIHdpdGggcHJvcGVyIHByaWNlIGhhbmRsaW5nCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIGRlYnQgaW5jbHVkaW5nIGludGVyZXN0CiAgICAvLyAgICAgdW5zY2FsZWRfYm9ycm93cyA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgdG90YWxfZGVidCA9IHVuc2NhbGVkX2JvcnJvd3MgKyBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIFZhbGlkYXRlIHJlcGF5IGFtb3VudCBkb2Vzbid0IGV4Y2VlZCB0b3RhbCBkZWJ0CiAgICAvLyAgICAgYXNzZXJ0IGFtb3VudCA8PSB0b3RhbF9kZWJ0LCAiUmVwYXkgYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidCIKICAgIC8vIAogICAgLy8gICAgICMgUmVxdWlyZSBtaW5pbXVtIHJlcGF5bWVudCBvZiBhdCBsZWFzdCB0aGUgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGFtb3VudCA+PSBkZWJ0X2ludGVyZXN0CiAgICAvLyAgICAgKSwgIlJlcGF5IGFtb3VudCBtdXN0IGJlIGF0IGxlYXN0IHRoZSBhY2NydWVkIGludGVyZXN0IgogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgaG93IG11Y2ggZ29lcyB0b3dhcmQgcHJpbmNpcGFsIHJlcGF5bWVudAogICAgLy8gICAgIHByaW5jaXBhbF9yZXBheW1lbnQgPSBhbW91bnQgLSBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBzY2FsZWQgYW1vdW50IGZvciBwcmluY2lwYWwgcmVwYXltZW50IG9ubHkKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gKHByaW5jaXBhbF9yZXBheW1lbnQgKiBTQ0FMRSkgLy8gbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgYXNzZXJ0IHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IHNjYWxlZF9hbW91bnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyBkZWJ0IgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCB1c2VyX2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gICAgIG5ld19ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgICAgICAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAvLyBTQ0FMRQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICBwcmljZV9mb3Jfb2xkID0gKAogICAgLy8gICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgcHJpY2VfZm9yX25ldyA9IG5ld19tYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICBvbGRfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld192YWx1ZSA9IChuZXdfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9uZXcpIC8vIFNDQUxFCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRSZXBheSgKICAgIC8vICAgICAjICAgICAgICAgdXNlcj1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NChtYXJrZXRfaWQpLAogICAgLy8gICAgICMgICAgICAgICBhbW91bnQ9YXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyAjIG1pbnQvcmVkZWVtIHJlbGF0ZWQgY29kZQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgcmVkZWVtKHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gIyAgICAgc2VsZi5fcmVkZWVtKG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9yZWRlZW0oc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICMgICAgIGFzc2VydCBub3Qgc2VsZi5faGFzX3Bvc2l0aW9uKAogICAgLy8gIyAgICAgICAgIFR4bi5zZW5kZXIsIG1hcmtldF9pZAogICAgLy8gIyAgICAgKSwgIkNhbm5vdCBtaW50L3JlZGVlbSB3aGVuIHVzZXIgaGFzIHRyYWNrZWQgZGVwb3NpdCBwb3NpdGlvbiIKICAgIC8vIAogICAgLy8gIyAgICAgbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBzY2FsZWRfYW1vdW50ID0gKGFtb3VudCAqIFNDQUxFKSAvLyBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICMgICAgIGFzc2VydCAoCiAgICAvLyAjICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gc2NhbGVkX2Ftb3VudAogICAgLy8gIyAgICAgKSwgIkluc3VmZmljaWVudCBtYXJrZXQgZGVwb3NpdHMgdG8gcmVkZWVtIgogICAgLy8gIyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksCiAgICAvLyAjICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAjICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBtaW50KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fbWludChtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfbWludChzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIC8vIAogICAgLy8gIyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9oYXNfcG9zaXRpb24oCiAgICAvLyAjICAgICAgICAgVHhuLnNlbmRlciwgbWFya2V0X2lkCiAgICAvLyAjICAgICApLCAiQ2Fubm90IG1pbnQvcmVkZWVtIHdoZW4gdXNlciBoYXMgdHJhY2tlZCBkZXBvc2l0IHBvc2l0aW9uIgogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gIyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdCgKICAgIC8vICMgICAgICAgICBtYXJrZXRfaWQKICAgIC8vICMgICAgICkgICMgR2V0IHVwZGF0ZWQgbWFya2V0IHdpdGggYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gIyAgICAgc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICMgICAgICAgICBhbW91bnQgKiBTQ0FMRQogICAgLy8gIyAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgLy8gCiAgICAvLyAjICAgICBhc3NlcnQgKAogICAgLy8gIyAgICAgICAgIG5ld19tYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gIyAgICAgICAgID49IG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQKICAgIC8vICMgICAgICksICJEZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gIyAgICAgIyBPbmx5IGluY3JlbWVudCBtYXJrZXQgdG90YWwgZGVwb3NpdHMsIG5vdCB1c2VyIGRlcG9zaXRzIHNpbmNlIHBvc2l0aW9uIGlzIG5vdCB0cmFja2VkCiAgICAvLyAjICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gIyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAgICAgTWludEV2ZW50KAogICAgLy8gIyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksIGFyYzQuVUludDI1NihhbW91bnQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICAgICAgdXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkuY29weSgpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMgPT0gMCBhbmQgdXNlci5zY2FsZWRfYm9ycm93cyA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBkZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgICAgICBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBvbGRfZGVwb3NpdF92YWx1ZSA9IChkZXBvc2l0X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld19kZXBvc2l0X3ZhbHVlID0gKGRlcG9zaXRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICAgICAgdXNlcl9pZCwgbWFya2V0X2lkLCBvbGRfZGVwb3NpdF92YWx1ZSwgbmV3X2RlcG9zaXRfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgICAgICBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBvbGRfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgICAgICB1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF9ib3Jyb3dfdmFsdWUsIG5ld19ib3Jyb3dfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gR2xvYmFsVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IEdsb2JhbFVzZXJEYXRhOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi5nbG9iYWxfdXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBnbG9iYWxfdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfZ2xvYmFsX3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBnbG9iYWxfdXNlcgogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIG1hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIG9sZF92YWx1ZTogQmlnVUludCwKICAgIC8vICAgICBuZXdfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gb2xkX3ZhbHVlICsgbmV3X3ZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gICAgIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIC0gb2xkX3ZhbHVlICsgbmV3X3ZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gICAgIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGxpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHVzZXI6IGFyYzQuQWRkcmVzcywKICAgIC8vICAgICBkZWJ0X2Ftb3VudDogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBhcmM0LlVJbnQyNTYsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCg0OTAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIFN5bmMgZ2xvYmFsIHVzZXIgdmFsdWVzIGZvciBib3RoIG1hcmtldHMgdG8gaW5jbHVkZSBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgZGVidF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICAgICAgdXNlci5uYXRpdmUsIGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgICAgIGRlYnRfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlLAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyLAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwKICAgIC8vICAgICAgICAgZGVidF9hbW91bnQubmF0aXZlLAogICAgLy8gICAgICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZC5uYXRpdmUsCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9saXF1aWRhdGVfY3Jvc3NfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgZGVidF9tYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0b3JfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBkZWJ0X2Ftb3VudDogQmlnVUludCwKICAgIC8vICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBMaXF1aWRhdGUgYSB1c2VyJ3MgdW5kZXJjb2xsYXRlcmFsaXplZCBwb3NpdGlvbiBhY3Jvc3MgZGlmZmVyZW50IG1hcmtldHMuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBhbGxvd3MgYSBsaXF1aWRhdG9yIHRvIHJlcGF5IGEgcG9ydGlvbiBvZiBhIHVzZXIncyBkZWJ0IGluIG9uZSBtYXJrZXQKICAgIC8vICAgICBhbmQgcmVjZWl2ZSBjb2xsYXRlcmFsIGZyb20gYW5vdGhlciBtYXJrZXQgYXMgY29tcGVuc2F0aW9uLiBUaGUgbGlxdWlkYXRpb24gaW5jbHVkZXMKICAgIC8vICAgICBhIGJvbnVzIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzIGFuZCBoZWxwcyBtYWludGFpbiBwcm90b2NvbCBoZWFsdGggYnkgcmVtb3ZpbmcKICAgIC8vICAgICB1bmRlcmNvbGxhdGVyYWxpemVkIHBvc2l0aW9ucy4KICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIGRlYnRfbWFya2V0X2lkOiBUaGUgbWFya2V0IElEIHdoZXJlIHRoZSBkZWJ0IHRvIGJlIHJlcGFpZCBleGlzdHMKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IFRoZSBtYXJrZXQgSUQgd2hlcmUgY29sbGF0ZXJhbCB3aWxsIGJlIHNlaXplZCBmcm9tCiAgICAvLyAgICAgICAgIGxpcXVpZGF0b3JfaWQ6IFRoZSBhY2NvdW50IHBlcmZvcm1pbmcgdGhlIGxpcXVpZGF0aW9uCiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSBhY2NvdW50IGJlaW5nIGxpcXVpZGF0ZWQKICAgIC8vICAgICAgICAgZGVidF9hbW91bnQ6IFRoZSBhbW91bnQgb2YgZGVidCB0byByZXBheSAobXVzdCBpbmNsdWRlIGFjY3J1ZWQgaW50ZXJlc3QpCiAgICAvLyAgICAgICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBNaW5pbXVtIGNvbGxhdGVyYWwgYW1vdW50IHRoZSBsaXF1aWRhdG9yIGV4cGVjdHMgdG8gcmVjZWl2ZQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgYW55IHZhbGlkYXRpb24gZmFpbHMsIGluY2x1ZGluZzoKICAgIC8vICAgICAgICAgICAgIC0gVXNpbmcgc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIChib3Jyb3ctb25seSBtYXJrZXQpCiAgICAvLyAgICAgICAgICAgICAtIEF0dGVtcHRpbmcgc2VsZi1saXF1aWRhdGlvbgogICAgLy8gICAgICAgICAgICAgLSBNYXJrZXQgZG9lc24ndCBleGlzdCBvciBpcyBwYXVzZWQKICAgIC8vICAgICAgICAgICAgIC0gUG9zaXRpb24gaXMgbm90IGxpcXVpZGF0YWJsZSAoaGVhbHRoIGZhY3RvciA+PSAxLjApCiAgICAvLyAgICAgICAgICAgICAtIExpcXVpZGF0aW9uIGFtb3VudCBleGNlZWRzIG1heGltdW0gYWxsb3dlZCBvciB0b3RhbCBkZWJ0CiAgICAvLyAgICAgICAgICAgICAtIEluc3VmZmljaWVudCBjb2xsYXRlcmFsIHRvIHNlaXplCiAgICAvLyAgICAgICAgICAgICAtIENvbGxhdGVyYWwgcmVjZWl2ZWQgYmVsb3cgbWluaW11bSB0aHJlc2hvbGQKICAgIC8vIAogICAgLy8gICAgIE5vdGVzOgogICAgLy8gICAgICAgICAtIFVzZXMgdGhlIGNvbGxhdGVyYWwgbWFya2V0J3MgbGlxdWlkYXRpb24gdGhyZXNob2xkIGZvciBoZWFsdGggY2FsY3VsYXRpb24KICAgIC8vICAgICAgICAgLSBMaXF1aWRhdGlvbiBib251cyBpcyBhcHBsaWVkIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzCiAgICAvLyAgICAgICAgIC0gQWNjcnVlZCBpbnRlcmVzdCBvbiBib3RoIGRlYnQgYW5kIGNvbGxhdGVyYWwgcG9zaXRpb25zIGlzIGluY2x1ZGVkCiAgICAvLyAgICAgICAgIC0gSGFuZGxlcyBkaWZmZXJlbnQgdG9rZW4gdHlwZXMgKEFSQzIwMCB2cyBTVG9rZW4pIGFwcHJvcHJpYXRlbHkKICAgIC8vICAgICAgICAgLSBVcGRhdGVzIGdsb2JhbCBib3Jyb3cgYW5kIGNvbGxhdGVyYWwgdmFsdWVzIGZvciB0aGUgdXNlcgogICAgLy8gICAgICIiIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgbGlxdWlkYXRlIG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgZGVidF9tYXJrZXRfaWQKICAgIC8vICAgICApLmxpcXVpZGF0ZS5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGRlYnRfYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJMaXF1aWRhdGUgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBSRU0gcHJldmVudCB1c2luZyBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgaW4gbGlxdWlkYXRpb24gYmVjYXVzZSBzdG9rZW4KICAgIC8vICAgICAjIFJFTSBtYXJrZXQgY29sbGF0ZXJhbCBkb2VzIG5vdCBleGlzdAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkICE9IHNlbGYuc3Rva2VuX2FwcF9pZAogICAgLy8gICAgICksICJDYW5ub3QgdXNlIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCAoYm9ycm93LW9ubHkgbWFya2V0KSIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgUkVNIHByZXZlbnQgc2VsZiBsaXF1aWRhdGlvbgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIGFzc2VydCB1c2VyX2lkICE9IGxpcXVpZGF0b3JfaWQsICJDYW5ub3QgbGlxdWlkYXRlIHNlbGYiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgZGVidF9tYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiRGVidCBtYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBmcmFtZV9kaWcgLTYKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY5CiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OS0yNDg3CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc29tZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Iob3BlcmF0b3JfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3ggPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3gudmFsdWUgPSBhcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgQXV0aG9yaXplZFByaWNlT3BlcmF0b3JTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I9YXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gQWNjb3VudDoKICAgIC8vICAgICBvcGVyYXRvcl9pZCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyID09IHNlbGYuX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICAgICAgb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICAvLyAgICAgKSwgIm9ubHkgYXV0aG9yaXplZCBwcmljZSBvcGVyYXRvciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMTAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTUKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBwYXltZW50IDw9IDEwMDAwMDAKICAgIC8vICAgICApLCAicGF5bWVudCBleGNlZWRzIG1heGltdW0gZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTYKICAgIC8vICAgICBhcHAgPSBBcHBsaWNhdGlvbihzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gICAgIGl0eG4uUGF5bWVudChyZWNlaXZlcj1hcHAuYWRkcmVzcywgYW1vdW50PXBheW1lbnQsIGZlZT0wKS5zdWJtaXQoKQogICAgLy8gICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBQcmljZUZlZWRQcm92aWRlckludGVyZmFjZS5nZXRfcHJpY2Vfd2l0aF90aW1lc3RhbXAsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWFwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgICAgID4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICk6CiAgICAvLyAgICAgICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wID0gKAogICAgLy8gICAgICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAuY29weSgpCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZCwgcHJpY2Vfd2l0aF90aW1lc3RhbXAucHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBjb21tZW50ZWQgb3V0CiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBhc3NlcnQgdG9rZW5faWQubmF0aXZlIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAjICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NgogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfbWF4X3RvdGFsX2RlcG9zaXRzKHRva2VuX2lkLm5hdGl2ZSwgbWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWF4X3RvdGFsX2RlcG9zaXRzOiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBtYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KG1heF90b3RhbF9kZXBvc2l0cykKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldE1heFRvdGFsRGVwb3NpdHNTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KG1heF90b3RhbF9kZXBvc2l0cykKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fcGF1c2VfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgcGF1c2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9wYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0ucGF1c2VkID0gYXJjNC5Cb29sKHBhdXNlID09IFVJbnQ2NCgxKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY19tYXJrZXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYWNjcnVlX2ludGVyZXN0KHNlbGYsIG1hcmtldF9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGN1cnJlbnRfdGltZSA9IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wCiAgICAvLyAgICAgdGltZV9kZWx0YSA9IGN1cnJlbnRfdGltZSAtIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lLm5hdGl2ZQogICAgLy8gICAgIGlmIHRpbWVfZGVsdGEgPD0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgIyBGb3Igc3Rva2VuIG1hcmtldCAoYm9ycm93LW9ubHkpLCB1c2UgYSBmaXhlZCB1dGlsaXphdGlvbiByYXRlIHNpbmNlIHRoZXJlIGFyZSBubyBkZXBvc2l0cwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHV0aWxpemF0aW9uID0gQmlnVUludCgxMDAwMCkgICMgMTAwJSB1dGlsaXphdGlvbiBmb3IgYm9ycm93LW9ubHkgbWFya2V0CiAgICAvLyAgICAgZWxpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgdXRpbGl6YXRpb24gPSAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDAKICAgIC8vICAgICAgICAgKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgIHJhdGUgPSBtYXJrZXQuYm9ycm93X3JhdGUubmF0aXZlICsgKG1hcmtldC5zbG9wZS5uYXRpdmUgKiB1dGlsaXphdGlvbikgLy8gMTAwMDAKICAgIC8vICAgICBpbnRlcmVzdCA9IChyYXRlICogbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHRpbWVfZGVsdGEpIC8vICgKICAgIC8vICAgICAgICAgc2VsZi5zZWNvbmRzX3Blcl95ZWFyICogMTAwMDAKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHN0b2tlbiBtYXJrZXQgLSBhbGwgaW50ZXJlc3QgZ29lcyB0byByZXNlcnZlcwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBhcmM0LlVJbnQyNTYuZnJvbV9ieXRlcyhtYXJrZXQucmVzZXJ2ZV9mYWN0b3IuYnl0ZXMpLm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIDEwMDAwCiAgICAvLyAgICAgICAgIGlmIHByb3RvY29sX3BvcnRpb24gPiBpbnRlcmVzdDoKICAgIC8vICAgICAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IGludGVyZXN0IC0gcHJvdG9jb2xfcG9ydGlvbgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChkZXBvc2l0b3JfcG9ydGlvbiAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID4gMDoKICAgIC8vICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChpbnRlcmVzdCAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGludGVyZXN0CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgZGVwb3NpdG9yX3BvcnRpb24KICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgKyBwcm90b2NvbF9wb3J0aW9uKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoY3VycmVudF90aW1lKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAgICAgcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gIyBUT0RPIGdvdmVybmFuY2U6IGNvbnNpZGVyIGlmIHJlc2VydmUgd2l0aGRyYXdhbCBzaG91bGQgcmVxdWlyZSBhZGRpdGlvbmFsCiAgICAvLyAjICAgICAgZ292ZXJuYW5jZSBtZWNoYW5pc21zCiAgICAvLyAjIFRPRE8gbWluaW11bSByZXNlcnZlIGxldmVsczogbWlnaHQgd2FudCB0byBlbmZvcmNlIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHMgZm9yCiAgICAvLyAjICAgICAgcHJvdG9jb2wgc2FmZXR5CiAgICAvLyAjIFRPRE8gZXZlbnQgZW1pc3Npb246IENvbnNpZGVyIGFkZGluZyBhbiBldmVudCB0byBsb2cgcmVzZXJ2ZSB3aXRoZHJhd2FscyBmb3IKICAgIC8vICMgICAgICB0cmFuc3BhcmVuY3kKICAgIC8vIAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBza2lwcGluZyBzdWJyb3V0aW5lIHRvIHJlZHVjZSBjb250cmFjdCBzaXplCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl93aXRoZHJhd19yZXNlcnZlcyhtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIEFjY3J1ZSBpbnRlcmVzdCBmaXJzdCB0byBnZXQgdXAtdG8tZGF0ZSByZXNlcnZlcwogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgPj0gYW1vdW50LCAiSW5zdWZmaWNpZW50IHJlc2VydmVzIgogICAgLy8gCiAgICAvLyAgICAgIyBUcmFuc2ZlciByZXNlcnZlcyB0byB0aGUgb3duZXIgKG5vdCB0byB0aGUgY29udHJhY3QgaXRzZWxmKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVcGRhdGUgcmVzZXJ2ZXMKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbigKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50LCBndWFyZF9zdG9rZW46IGJvb2wKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCBhbW91bnQgPiAwLCAiQW1vdW50IG11c3QgYmUgPiAwIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBub3QgbWFya2V0LnBhdXNlZCwgIk1hcmtldCBpcyBwYXVzZWQiCiAgICAvLyAgICAgaWYgZ3VhcmRfc3Rva2VuOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgLy8gICAgICAgICApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGZvciB0aGlzIG9wZXJhdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGVwb3NpdChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9kZXBvc2l0KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgUkVNIG1heSBhZGQgcHJvdGVjdGlvbiBmb3IgbG93IHV0aWxpc2F0aW9uIGluIGZ1dHVyZQogICAgLy8gIyBSRU0gbG93ZXIgbWF4IGRlcG9zaXQgYW1vdW50IGZvciBsb3cgdXRpbGlzYXRpb24KICAgIC8vICMgUkVNIGhpZ2ggbWF4IGRlcG9zaXQgYW1vdW50IGZvciBoaWdoIHV0aWxpc2F0aW9uCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlcG9zaXQoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBJbnRlcm5hbCBkZXBvc2l0IG1ldGhvZCB0aGF0IGhhbmRsZXMgdXNlciBkZXBvc2l0cyBpbnRvIGEgbGVuZGluZyBtYXJrZXQuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBwZXJmb3JtcyBhIGNvbXBsZXRlIGRlcG9zaXQgb3BlcmF0aW9uIGluY2x1ZGluZzoKICAgIC8vICAgICAxLiBWYWxpZGF0aW5nIHRoZSBtYXJrZXQgb3BlcmF0aW9uIChwcm90b2NvbCBub3QgcGF1c2VkLCBtYXJrZXQgZXhpc3RzLCBhbW91bnQgPiAwLCBtYXJrZXQgbm90IHBhdXNlZCkKICAgIC8vICAgICAyLiBUcmFuc2ZlcnJpbmcgQVJDMjAwIHRva2VucyBmcm9tIHVzZXIgdG8gdGhlIGxlbmRpbmcgcG9vbCBjb250cmFjdAogICAgLy8gICAgIDMuIEFjY3J1aW5nIGludGVyZXN0IG9uIHRoZSBtYXJrZXQgdG8gZ2V0IHVwZGF0ZWQgZGVwb3NpdCBpbmRleAogICAgLy8gICAgIDQuIENhbGN1bGF0aW5nIGFuZCBhZGRpbmcgZWFybmVkIGludGVyZXN0IHRvIHRoZSB1c2VyJ3MgcG9zaXRpb24KICAgIC8vICAgICA1LiBDb252ZXJ0aW5nIGRlcG9zaXQgYW1vdW50IHRvIHNjYWxlZCBkZXBvc2l0cyB1c2luZyBjdXJyZW50IGRlcG9zaXQgaW5kZXgKICAgIC8vICAgICA2LiBDaGVja2luZyBkZXBvc2l0IGNhcCBjb25zdHJhaW50cwogICAgLy8gICAgIDcuIFVwZGF0aW5nIHVzZXIgYW5kIG1hcmtldCBzY2FsZWQgZGVwb3NpdCBiYWxhbmNlcwogICAgLy8gICAgIDguIE1pbnRpbmcgTlRva2VucyB0byByZXByZXNlbnQgdGhlIHVzZXIncyBkZXBvc2l0IHBvc2l0aW9uCiAgICAvLyAgICAgOS4gVXBkYXRpbmcgZ2xvYmFsIGNvbGxhdGVyYWwgY2FsY3VsYXRpb25zIGZvciB0aGUgdXNlcgogICAgLy8gICAgIDEwLiBFbWl0dGluZyBhIE1hcmtldERlcG9zaXQgZXZlbnQKICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQgKEFjY291bnQpOiBUaGUgYWNjb3VudCBJRCBvZiB0aGUgdXNlciBtYWtpbmcgdGhlIGRlcG9zaXQKICAgIC8vICAgICAgICAgbWFya2V0X2lkIChVSW50NjQpOiBUaGUgSUQgb2YgdGhlIG1hcmtldCB0byBkZXBvc2l0IGludG8KICAgIC8vICAgICAgICAgYW1vdW50IChCaWdVSW50KTogVGhlIGFtb3VudCBvZiB1bmRlcmx5aW5nIHRva2VucyB0byBkZXBvc2l0CiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiBtYXJrZXQgdmFsaWRhdGlvbiBmYWlscywgZGVwb3NpdCBjYXAgaXMgZXhjZWVkZWQsIG9yIG90aGVyIGNvbnN0cmFpbnRzIGFyZSB2aW9sYXRlZAogICAgLy8gCiAgICAvLyAgICAgTm90ZToKICAgIC8vICAgICAgICAgLSBJbnRlcmVzdCBlYXJuZWQgc2luY2UgbGFzdCBpbnRlcmFjdGlvbiBpcyBhdXRvbWF0aWNhbGx5IGFkZGVkIHRvIHRoZSBkZXBvc2l0CiAgICAvLyAgICAgICAgIC0gU2NhbGVkIGRlcG9zaXRzIGFyZSB1c2VkIHRvIHRyYWNrIHVzZXIgcG9zaXRpb25zIGFuZCBjYWxjdWxhdGUgaW50ZXJlc3QKICAgIC8vICAgICAgICAgLSBDb2xsYXRlcmFsIHZhbHVlIGlzIHVwZGF0ZWQgdXNpbmcgZWl0aGVyIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIG9yIGN1cnJlbnQgbWFya2V0IHByaWNlCiAgICAvLyAgICAgICAgIC0gTlRva2VucyBhcmUgbWludGVkIHRvIHJlcHJlc2VudCB0aGUgdXNlcidzIGRlcG9zaXQgcG9zaXRpb24gKGFtb3VudCArIGludGVyZXN0KQogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgKS5kZXBvc2l0Lm5hdGl2ZQogICAgLy8gICAgIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJEZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApICAjIEdldCB1cGRhdGVkIG1hcmtldCB3aXRoIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBBZGQgZWFybmVkIGludGVyZXN0IHRvIHVzZXIncyBwb3NpdGlvbiBhcyBhZGRpdGlvbmFsIHNjYWxlZCBkZXBvc2l0cwogICAgLy8gICAgIGludGVyZXN0X3NjYWxlZF9hbW91bnQgPSBCaWdVSW50KDApCiAgICAvLyAgICAgaWYgaW50ZXJlc3QgPiAwOgogICAgLy8gICAgICAgICBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBTQ0FMRQogICAgLy8gICAgICAgICApIC8vIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIGFtb3VudCAqIFNDQUxFCiAgICAvLyAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgLy8gCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2Ftb3VudCA9IHNjYWxlZF9hbW91bnQgKyBpbnRlcmVzdF9zY2FsZWRfYW1vdW50CiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0Lm1heF90b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgPj0gbmV3X21hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgdG90YWxfc2NhbGVkX2Ftb3VudAogICAgLy8gICAgICksICJNYXJrZXQgZGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIHVzZXJfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50ICsgaW50ZXJlc3QpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2RlcG9zaXRfYW1vdW50ID0gb2xkX2RlcG9zaXRfYW1vdW50ICsgYW1vdW50ICsgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgIyBGYWxsYmFjazogVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIHRvIHByZXZlbnQgbmVnYXRpdmUgY29sbGF0ZXJhbAogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSA9IChuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICAjIE5vcm1hbCBjYXNlOiBVc2UgdXNlcidzIGxhc3QgcmVjb3JkZWQgcHJpY2UgZm9yIGFjY3VyYXRlIGNvbGxhdGVyYWwgcmVkdWN0aW9uCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIGRlcG9zaXQgb3BlcmF0aW9uCiAgICAvLyAgICAgdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC50b3RhbF9kZXBvc2l0cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApLCAiVXNlciBkZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF92YWx1ZSwgbmV3X3ZhbHVlKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0RGVwb3NpdCgKICAgIC8vICAgICAjICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLCBhcmM0LlVJbnQyNTYoYW1vdW50KQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGNhbGN1bGF0ZV91c2VyX2ludGVyZXN0KAogICAgLy8gIyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyAjICkgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAjICAgICByZXR1cm4gYXJjNC5VSW50MjU2KAogICAgLy8gIyAgICAgICAgIHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgaW50ZXJlc3QiIiIKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgdW5kZXJseWluZyBhbW91bnQKICAgIC8vICAgICB1c2VyX3RvdGFsX3VuZGVybHlpbmcgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIEludGVyZXN0IGlzIHRoZSBkaWZmZXJlbmNlIGZyb20gdGhlIHNjYWxlZCBkZXBvc2l0cyAod2hpY2ggcmVwcmVzZW50IHRoZSAiYmFzZSIgYW1vdW50KQogICAgLy8gICAgIGludGVyZXN0ID0gdXNlcl90b3RhbF91bmRlcmx5aW5nIC0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gaW50ZXJlc3QKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGNhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAjICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICMgKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAjICAgICBlbnN1cmVfYnVkZ2V0KDcwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICMgICAgIHJldHVybiBhcmM0LlVJbnQyNTYoCiAgICAvLyAjICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBkZWJ0IGludGVyZXN0IiIiCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIHVuZGVybHlpbmcgZGVidCBhbW91bnQKICAgIC8vICAgICB1c2VyX3RvdGFsX2RlYnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgb3JpZ2luYWwgcHJpbmNpcGFsIGFtb3VudCB1c2luZyB1c2VyJ3MgYm9ycm93X2luZGV4CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIncyBib3Jyb3dfaW5kZXggaXMgMCwgdXNlIGN1cnJlbnQgbWFya2V0IGJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXJfYm9ycm93X2luZGV4ID0gKAogICAgLy8gICAgICAgICB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBvcmlnaW5hbF9wcmluY2lwYWwgPSAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyX2JvcnJvd19pbmRleCkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRvdGFsIGRlYnQgYW5kIG9yaWdpbmFsIHByaW5jaXBhbAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSB1c2VyX3RvdGFsX2RlYnQgLSBvcmlnaW5hbF9wcmluY2lwYWwKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHdpdGhkcmF3KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyMTAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gCiAgICAvLyAgICAgIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgd2l0aGRyYXduIGZyb20gdG8gdXBkYXRlIGdsb2JhbCB2YWx1ZXMgd2l0aCBpbnRlcmVzdAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDI1NihzZWxmLl93aXRoZHJhdyhUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXcoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFdpdGhkcmF3IHRva2VucyBmcm9tIGEgbGVuZGluZyBtYXJrZXQgYnkgYnVybmluZyBuVG9rZW5zLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgaGFuZGxlcyB0aGUgd2l0aGRyYXdhbCBwcm9jZXNzIGJ5OgogICAgLy8gICAgIDEuIFZhbGlkYXRpbmcgdGhlIG1hcmtldCBvcGVyYXRpb24gYW5kIHVzZXIgYmFsYW5jZQogICAgLy8gICAgIDIuIEFjY3J1aW5nIGludGVyZXN0IHRvIGdldCB0aGUgbGF0ZXN0IG1hcmtldCBzdGF0ZQogICAgLy8gICAgIDMuIENhbGN1bGF0aW5nIHVzZXIncyBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgNC4gUGVyZm9ybWluZyBoZWFsdGggY2hlY2tzIHRvIGVuc3VyZSB3aXRoZHJhd2FsIGRvZXNuJ3QgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgIDUuIEJ1cm5pbmcgblRva2VucyBhbmQgdHJhbnNmZXJyaW5nIHVuZGVybHlpbmcgdG9rZW5zIHRvIHVzZXIKICAgIC8vICAgICA2LiBVcGRhdGluZyBnbG9iYWwgY29sbGF0ZXJhbCB2YWx1ZXMKICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIHdpdGhkcmF3aW5nIHRva2VucwogICAgLy8gICAgICAgICBtYXJrZXRfaWQ6IFRoZSBJRCBvZiB0aGUgbWFya2V0IHRvIHdpdGhkcmF3IGZyb20KICAgIC8vICAgICAgICAgYW1vdW50OiBUaGUgYW1vdW50IG9mIG5Ub2tlbnMgdG8gYnVybiAobm90IHRoZSB1bmRlcmx5aW5nIHRva2VuIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAgIFJldHVybnM6CiAgICAvLyAgICAgICAgIEJpZ1VJbnQ6IFRoZSB0b3RhbCBhbW91bnQgb2YgdW5kZXJseWluZyB0b2tlbnMgdHJhbnNmZXJyZWQgdG8gdGhlIHVzZXIKICAgIC8vICAgICAgICAgICAgICAgICAoaW5jbHVkZXMgYm90aCB0aGUgd2l0aGRyYXduIGFtb3VudCBhbmQgYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIHVzZXIgaGFzIGluc3VmZmljaWVudCBiYWxhbmNlIG9yIHdpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciB3aXRoZHJhdyBvcGVyYXRpb24KICAgIC8vICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gICAgICkud2l0aGRyYXcubmF0aXZlCiAgICAvLyAgICAgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIldpdGhkcmF3IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgYW1vdW50IGlzIHRoZSBhbW91bnQgb2YgblRva2VucyBiZWluZyBidXJuZWQKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBhbW91bnQgPD0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgICMgaGVhbHRoIGNoZWNrOiBlbnN1cmUgd2l0aGRyYXcgd291bGQgbm90IHB1dCBib3Jyb3dzIGF0IHJpc2sKICAgIC8vICAgICBpZiBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPiAwOgogICAgLy8gICAgICAgICAjIHZhbHVlIG9mIHVuZGVybHlpbmcgYW1vdW50IHRvIHdpdGhkcmF3IHVzaW5nIG5ldyBtYXJrZXQgcHJpY2UKICAgIC8vICAgICAgICAgd2l0aGRyYXdfdmFsdWUgPSAoYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsID0gKAogICAgLy8gICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSB3aXRoZHJhd192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIGFzc2VydCBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIDw9ICgKICAgIC8vICAgICAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsICogQmlnVUludChuZXdfbWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICAgICAgICAgKSAvLyBCaWdVSW50KDEwMDAwKSwgIldpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzayIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCB1c2VyX2lkLCBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19kZXBvc2l0X2Ftb3VudCA9IG9sZF9kZXBvc2l0X2Ftb3VudCArIGludGVyZXN0IC0gYW1vdW50CiAgICAvLyAKICAgIC8vICAgICBhbW91bnRfdXNkX3ZhbHVlID0gKGFtb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHVzZXIgY2FwIGZvciB3aXRoZHJhdyBvcGVyYXRpb24KICAgIC8vICAgICB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgIGlmIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPT0gMDoKICAgIC8vICAgICAgICAgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wICsgODY0MDApCiAgICAvLyAgICAgZWxpZiB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lIDwgR2xvYmFsLmxhdGVzdF90aW1lc3RhbXA6CiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KDApCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX2xpcXVpZGF0aW9ucyA9IGFyYzQuVUludDI1NigwKQogICAgLy8gICAgICAgICB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC5kYWlseV93aXRoZHJhd2Fscy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBuZXdfdG90YWxfd2l0aGRyYXdhbHMgPSB1c2VyX2NhcC50b3RhbF93aXRoZHJhd2Fscy5uYXRpdmUgKyBhbW91bnRfdXNkX3ZhbHVlCiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICBuZXdfdG90YWxfd2l0aGRyYXdhbHMgPD0gdXNlcl9jYXAuZGFpbHlfd2l0aGRyYXdhbHMubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIHdpdGhkcmF3IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYobmV3X3RvdGFsX3dpdGhkcmF3YWxzKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZCwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgICMgRmFsbGJhY2s6IFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSB0byBwcmV2ZW50IG5lZ2F0aXZlIGNvbGxhdGVyYWwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgIyBOb3JtYWwgY2FzZTogVXNlIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIGZvciBhY2N1cmF0ZSBjb2xsYXRlcmFsIHJlZHVjdGlvbgogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIEVtaXQgZXZlbnRzCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0V2l0aGRyYXcoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgYXJjNC5VSW50NjQobWFya2V0X2lkKSwgYXJjNC5VSW50MjU2KGFtb3VudCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gYW1vdW50ICsgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gIyB3aXRoZHJhdyBjb3N0IDkwMDAwMAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBib3Jyb3coc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyODAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gCiAgICAvLyAgICAgIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgYm9ycm93ZWQgZnJvbSB0byB1cGRhdGUgZ2xvYmFsIHZhbHVlcyB3aXRoIGludGVyZXN0CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9ib3Jyb3coVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYm9ycm93KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBib3Jyb3cgb3BlcmF0aW9uCiAgICAvLyAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApLmJvcnJvdy5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KHVzZXJfaWQpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gVUludDY0KDEwMDAwMCksICJQYXltZW50IGFtb3VudCBtdXN0IGJlID49IDAuMSIKICAgIC8vIAogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGN1cnJlbnQgbWFya2V0IHRvdGFsIGJvcnJvd3MgKGluY2x1ZGluZyBpbnRlcmVzdCkKICAgIC8vICAgICBjdXJyZW50X21hcmtldF90b3RhbF9ib3Jyb3dzID0gKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIGFtb3VudCBiZWluZyBhZGRlZCAobmV3IGJvcnJvdyArIGRlYnQgaW50ZXJlc3QpCiAgICAvLyAgICAgIyBkZWJ0IGludGVyZXN0IGFkZGVkIGF0IHRoaXMgcG9pbnQgdG8gcHJldmVudCB1bm5lY2Vzc2FyeSBkZWJ0IHJlc2V0CiAgICAvLyAgICAgdG90YWxfYW1vdW50X3RvX2FkZCA9IGFtb3VudCArIGRlYnRfaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgICMgVmFsaWRhdGUgYWdhaW5zdCBtYXJrZXQtd2lkZSBib3Jyb3cgY2FwCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbmV3X21hcmtldC5tYXhfdG90YWxfYm9ycm93cy5uYXRpdmUKICAgIC8vICAgICAgICAgPj0gY3VycmVudF9tYXJrZXRfdG90YWxfYm9ycm93cyArIHRvdGFsX2Ftb3VudF90b19hZGQKICAgIC8vICAgICApLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgY29sbGF0ZXJhbCByZXF1aXJlbWVudHMgLSBleGNsdWRlIHNhbWUgbWFya2V0IGNvbGxhdGVyYWwgdG8gcHJldmVudAogICAgLy8gICAgICMgaW5lZmZpY2llbnQgc2FtZS1hc3NldCBib3Jyb3dpbmcKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgbmV3X2JvcnJvd192YWx1ZSA9ICh0b3RhbF9hbW91bnRfdG9fYWRkICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgdG90YWxfYm9ycm93X3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSArIG5ld19ib3Jyb3dfdmFsdWUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IEJpZ1VJbnQoMCk6CiAgICAvLyAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICAgICAjIFVzZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgZXhjbHVkZWRfdmFsdWUgPSAoZGVwb3NpdGVkX2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBpZiBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSA+IGV4Y2x1ZGVkX3ZhbHVlOgogICAgLy8gICAgICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSAoCiAgICAvLyAgICAgICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBleGNsdWRlZF92YWx1ZQogICAgLy8gICAgICAgICAgICAgKQogICAgLy8gICAgICAgICBlbHNlOgogICAgLy8gICAgICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSBCaWdVSW50KDApCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgdG90YWxfYm9ycm93X3ZhbHVlIDw9ICgKICAgIC8vICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgKiBCaWdVSW50KG5ld19tYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgLy8gICAgICkgLy8gQmlnVUludCgxMDAwMCksICJJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCBhY3Jvc3MgbWFya2V0cyIKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHNjYWxlZCBhbW91bnQgZm9yIHRoZSB0b3RhbAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAodG90YWxfYW1vdW50X3RvX2FkZCAqIFNDQUxFKSAvLyBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBvbGRfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgLy8gU0NBTEUKICAgIC8vICAgICApCiAgICAvLyAgICAgbmV3X2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgICAgICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgaWYgdXNlciBkb2Vzbid0IGhhdmUgYSBwcmV2aW91cyBwcmljZQogICAgLy8gICAgIHByaWNlX2Zvcl9vbGQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBwcmljZV9mb3JfbmV3ID0gbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIG9sZF92YWx1ZSA9IChvbGRfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X3ZhbHVlID0gKG5ld19ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX25ldykgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3IgYm9ycm93IG9wZXJhdGlvbgogICAgLy8gICAgIHVzZXJfY2FwID0gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9jYXAudG90YWxfYm9ycm93cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIGJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlLCAgIyBvbGQgVVNEIHZhbHVlCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSwgICMgbmV3IFVTRCB2YWx1ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgaWYgc3Rva2VuLCBtaW50IHN0b2tlbgogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBTVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICAgICAgcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgLy8gICAgICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgIyBpZiBhVG9rZW4sIHRyYW5zZmVyIGFUb2tlbgogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRCb3Jyb3coCiAgICAvLyAgICAgIyAgICAgICAgIHVzZXI9YXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICMgICAgICAgICB0b2tlbl9pZD1hcmM0LlVJbnQ2NChtYXJrZXRfaWQpLAogICAgLy8gICAgICMgICAgICAgICBhbW91bnQ9YXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiByZXBheShzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fcmVwYXkoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBSZXBheSBib3Jyb3dlZCB0b2tlbnMgZm9yIGEgc3BlY2lmaWMgbWFya2V0LgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgaGFuZGxlcyB0aGUgcmVwYXltZW50IG9mIGJvcnJvd2VkIHRva2VucyB3aXRoIGEgbWluaW11bSBpbnRlcmVzdAogICAgLy8gICAgIHJlcXVpcmVtZW50LiBJdCBzdXBwb3J0cyBib3RoIHNUb2tlbiAoYnVybikgYW5kIGFUb2tlbiAodHJhbnNmZXIpIG1hcmtldHMuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgdXNlciBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIG1hcmtldF9pZDogVGhlIG1hcmtldCBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIGFtb3VudDogVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gcmVwYXkgKG11c3QgYmUgPj0gYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIG1hcmtldCB2YWxpZGF0aW9uIGZhaWxzLCByZXBheSBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0LAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgIHJlcGF5IGFtb3VudCBpcyBsZXNzIHRoYW4gYWNjcnVlZCBpbnRlcmVzdCwgb3IgcHJpbmNpcGFsCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgcmVwYXltZW50IGV4Y2VlZHMgc2NhbGVkIGRlYnQKICAgIC8vIAogICAgLy8gICAgIFByb2Nlc3M6CiAgICAvLyAgICAgICAgIDEuIFZhbGlkYXRlcyBtYXJrZXQgb3BlcmF0aW9uIGFuZCBhY2NydWVzIGludGVyZXN0CiAgICAvLyAgICAgICAgIDIuIENhbGN1bGF0ZXMgdG90YWwgZGVidCBpbmNsdWRpbmcgYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gICAgICAgICAzLiBWYWxpZGF0ZXMgcmVwYXkgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vICAgICAgICAgNC4gUmVxdWlyZXMgbWluaW11bSByZXBheW1lbnQgb2YgYXQgbGVhc3QgdGhlIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICAgICAgICAgNS4gQ2FsY3VsYXRlcyBwcmluY2lwYWwgcmVwYXltZW50IChhbW91bnQgLSBpbnRlcmVzdCkKICAgIC8vICAgICAgICAgNi4gQnVybnMgc1Rva2VucyBvciB0cmFuc2ZlcnMgYVRva2VucyBmcm9tIHVzZXIKICAgIC8vICAgICAgICAgNy4gVXBkYXRlcyB1c2VyIGFuZCBtYXJrZXQgc2NhbGVkIGJvcnJvdyBhbW91bnRzIChwcmluY2lwYWwgb25seSkKICAgIC8vICAgICAgICAgOC4gVXBkYXRlcyBnbG9iYWwgYm9ycm93IHZhbHVlIHRyYWNraW5nIHdpdGggcHJvcGVyIHByaWNlIGhhbmRsaW5nCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIGRlYnQgaW5jbHVkaW5nIGludGVyZXN0CiAgICAvLyAgICAgdW5zY2FsZWRfYm9ycm93cyA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgdG90YWxfZGVidCA9IHVuc2NhbGVkX2JvcnJvd3MgKyBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIFZhbGlkYXRlIHJlcGF5IGFtb3VudCBkb2Vzbid0IGV4Y2VlZCB0b3RhbCBkZWJ0CiAgICAvLyAgICAgYXNzZXJ0IGFtb3VudCA8PSB0b3RhbF9kZWJ0LCAiUmVwYXkgYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidCIKICAgIC8vIAogICAgLy8gICAgICMgUmVxdWlyZSBtaW5pbXVtIHJlcGF5bWVudCBvZiBhdCBsZWFzdCB0aGUgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGFtb3VudCA+PSBkZWJ0X2ludGVyZXN0CiAgICAvLyAgICAgKSwgIlJlcGF5IGFtb3VudCBtdXN0IGJlIGF0IGxlYXN0IHRoZSBhY2NydWVkIGludGVyZXN0IgogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgaG93IG11Y2ggZ29lcyB0b3dhcmQgcHJpbmNpcGFsIHJlcGF5bWVudAogICAgLy8gICAgIHByaW5jaXBhbF9yZXBheW1lbnQgPSBhbW91bnQgLSBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBzY2FsZWQgYW1vdW50IGZvciBwcmluY2lwYWwgcmVwYXltZW50IG9ubHkKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gKHByaW5jaXBhbF9yZXBheW1lbnQgKiBTQ0FMRSkgLy8gbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgYXNzZXJ0IHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IHNjYWxlZF9hbW91bnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyBkZWJ0IgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCB1c2VyX2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gICAgIG5ld19ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgICAgICAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAvLyBTQ0FMRQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICBwcmljZV9mb3Jfb2xkID0gKAogICAgLy8gICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgcHJpY2VfZm9yX25ldyA9IG5ld19tYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICBvbGRfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld192YWx1ZSA9IChuZXdfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9uZXcpIC8vIFNDQUxFCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRSZXBheSgKICAgIC8vICAgICAjICAgICAgICAgdXNlcj1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NChtYXJrZXRfaWQpLAogICAgLy8gICAgICMgICAgICAgICBhbW91bnQ9YXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyAjIG1pbnQvcmVkZWVtIHJlbGF0ZWQgY29kZQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgcmVkZWVtKHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gIyAgICAgc2VsZi5fcmVkZWVtKG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9yZWRlZW0oc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICMgICAgIGFzc2VydCBub3Qgc2VsZi5faGFzX3Bvc2l0aW9uKAogICAgLy8gIyAgICAgICAgIFR4bi5zZW5kZXIsIG1hcmtldF9pZAogICAgLy8gIyAgICAgKSwgIkNhbm5vdCBtaW50L3JlZGVlbSB3aGVuIHVzZXIgaGFzIHRyYWNrZWQgZGVwb3NpdCBwb3NpdGlvbiIKICAgIC8vIAogICAgLy8gIyAgICAgbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBzY2FsZWRfYW1vdW50ID0gKGFtb3VudCAqIFNDQUxFKSAvLyBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICMgICAgIGFzc2VydCAoCiAgICAvLyAjICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gc2NhbGVkX2Ftb3VudAogICAgLy8gIyAgICAgKSwgIkluc3VmZmljaWVudCBtYXJrZXQgZGVwb3NpdHMgdG8gcmVkZWVtIgogICAgLy8gIyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksCiAgICAvLyAjICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAjICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBtaW50KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fbWludChtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfbWludChzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIC8vIAogICAgLy8gIyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9oYXNfcG9zaXRpb24oCiAgICAvLyAjICAgICAgICAgVHhuLnNlbmRlciwgbWFya2V0X2lkCiAgICAvLyAjICAgICApLCAiQ2Fubm90IG1pbnQvcmVkZWVtIHdoZW4gdXNlciBoYXMgdHJhY2tlZCBkZXBvc2l0IHBvc2l0aW9uIgogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gIyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdCgKICAgIC8vICMgICAgICAgICBtYXJrZXRfaWQKICAgIC8vICMgICAgICkgICMgR2V0IHVwZGF0ZWQgbWFya2V0IHdpdGggYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gIyAgICAgc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICMgICAgICAgICBhbW91bnQgKiBTQ0FMRQogICAgLy8gIyAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgLy8gCiAgICAvLyAjICAgICBhc3NlcnQgKAogICAgLy8gIyAgICAgICAgIG5ld19tYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gIyAgICAgICAgID49IG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQKICAgIC8vICMgICAgICksICJEZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gIyAgICAgIyBPbmx5IGluY3JlbWVudCBtYXJrZXQgdG90YWwgZGVwb3NpdHMsIG5vdCB1c2VyIGRlcG9zaXRzIHNpbmNlIHBvc2l0aW9uIGlzIG5vdCB0cmFja2VkCiAgICAvLyAjICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gIyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAgICAgTWludEV2ZW50KAogICAgLy8gIyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksIGFyYzQuVUludDI1NihhbW91bnQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICAgICAgdXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkuY29weSgpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMgPT0gMCBhbmQgdXNlci5zY2FsZWRfYm9ycm93cyA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBkZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgICAgICBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBvbGRfZGVwb3NpdF92YWx1ZSA9IChkZXBvc2l0X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld19kZXBvc2l0X3ZhbHVlID0gKGRlcG9zaXRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICAgICAgdXNlcl9pZCwgbWFya2V0X2lkLCBvbGRfZGVwb3NpdF92YWx1ZSwgbmV3X2RlcG9zaXRfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgICAgICBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBvbGRfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgICAgICB1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF9ib3Jyb3dfdmFsdWUsIG5ld19ib3Jyb3dfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gR2xvYmFsVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IEdsb2JhbFVzZXJEYXRhOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi5nbG9iYWxfdXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBnbG9iYWxfdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfZ2xvYmFsX3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBnbG9iYWxfdXNlcgogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIG1hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIG9sZF92YWx1ZTogQmlnVUludCwKICAgIC8vICAgICBuZXdfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gb2xkX3ZhbHVlICsgbmV3X3ZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gICAgIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIC0gb2xkX3ZhbHVlICsgbmV3X3ZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gICAgIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGxpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHVzZXI6IGFyYzQuQWRkcmVzcywKICAgIC8vICAgICBkZWJ0X2Ftb3VudDogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBhcmM0LlVJbnQyNTYsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCg0OTAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIFN5bmMgZ2xvYmFsIHVzZXIgdmFsdWVzIGZvciBib3RoIG1hcmtldHMgdG8gaW5jbHVkZSBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgZGVidF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICAgICAgdXNlci5uYXRpdmUsIGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgICAgIGRlYnRfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlLAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyLAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwKICAgIC8vICAgICAgICAgZGVidF9hbW91bnQubmF0aXZlLAogICAgLy8gICAgICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZC5uYXRpdmUsCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9saXF1aWRhdGVfY3Jvc3NfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgZGVidF9tYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0b3JfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBkZWJ0X2Ftb3VudDogQmlnVUludCwKICAgIC8vICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBMaXF1aWRhdGUgYSB1c2VyJ3MgdW5kZXJjb2xsYXRlcmFsaXplZCBwb3NpdGlvbiBhY3Jvc3MgZGlmZmVyZW50IG1hcmtldHMuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBhbGxvd3MgYSBsaXF1aWRhdG9yIHRvIHJlcGF5IGEgcG9ydGlvbiBvZiBhIHVzZXIncyBkZWJ0IGluIG9uZSBtYXJrZXQKICAgIC8vICAgICBhbmQgcmVjZWl2ZSBjb2xsYXRlcmFsIGZyb20gYW5vdGhlciBtYXJrZXQgYXMgY29tcGVuc2F0aW9uLiBUaGUgbGlxdWlkYXRpb24gaW5jbHVkZXMKICAgIC8vICAgICBhIGJvbnVzIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzIGFuZCBoZWxwcyBtYWludGFpbiBwcm90b2NvbCBoZWFsdGggYnkgcmVtb3ZpbmcKICAgIC8vICAgICB1bmRlcmNvbGxhdGVyYWxpemVkIHBvc2l0aW9ucy4KICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIGRlYnRfbWFya2V0X2lkOiBUaGUgbWFya2V0IElEIHdoZXJlIHRoZSBkZWJ0IHRvIGJlIHJlcGFpZCBleGlzdHMKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IFRoZSBtYXJrZXQgSUQgd2hlcmUgY29sbGF0ZXJhbCB3aWxsIGJlIHNlaXplZCBmcm9tCiAgICAvLyAgICAgICAgIGxpcXVpZGF0b3JfaWQ6IFRoZSBhY2NvdW50IHBlcmZvcm1pbmcgdGhlIGxpcXVpZGF0aW9uCiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSBhY2NvdW50IGJlaW5nIGxpcXVpZGF0ZWQKICAgIC8vICAgICAgICAgZGVidF9hbW91bnQ6IFRoZSBhbW91bnQgb2YgZGVidCB0byByZXBheSAobXVzdCBpbmNsdWRlIGFjY3J1ZWQgaW50ZXJlc3QpCiAgICAvLyAgICAgICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBNaW5pbXVtIGNvbGxhdGVyYWwgYW1vdW50IHRoZSBsaXF1aWRhdG9yIGV4cGVjdHMgdG8gcmVjZWl2ZQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgYW55IHZhbGlkYXRpb24gZmFpbHMsIGluY2x1ZGluZzoKICAgIC8vICAgICAgICAgICAgIC0gVXNpbmcgc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIChib3Jyb3ctb25seSBtYXJrZXQpCiAgICAvLyAgICAgICAgICAgICAtIEF0dGVtcHRpbmcgc2VsZi1saXF1aWRhdGlvbgogICAgLy8gICAgICAgICAgICAgLSBNYXJrZXQgZG9lc24ndCBleGlzdCBvciBpcyBwYXVzZWQKICAgIC8vICAgICAgICAgICAgIC0gUG9zaXRpb24gaXMgbm90IGxpcXVpZGF0YWJsZSAoaGVhbHRoIGZhY3RvciA+PSAxLjApCiAgICAvLyAgICAgICAgICAgICAtIExpcXVpZGF0aW9uIGFtb3VudCBleGNlZWRzIG1heGltdW0gYWxsb3dlZCBvciB0b3RhbCBkZWJ0CiAgICAvLyAgICAgICAgICAgICAtIEluc3VmZmljaWVudCBjb2xsYXRlcmFsIHRvIHNlaXplCiAgICAvLyAgICAgICAgICAgICAtIENvbGxhdGVyYWwgcmVjZWl2ZWQgYmVsb3cgbWluaW11bSB0aHJlc2hvbGQKICAgIC8vIAogICAgLy8gICAgIE5vdGVzOgogICAgLy8gICAgICAgICAtIFVzZXMgdGhlIGNvbGxhdGVyYWwgbWFya2V0J3MgbGlxdWlkYXRpb24gdGhyZXNob2xkIGZvciBoZWFsdGggY2FsY3VsYXRpb24KICAgIC8vICAgICAgICAgLSBMaXF1aWRhdGlvbiBib251cyBpcyBhcHBsaWVkIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzCiAgICAvLyAgICAgICAgIC0gQWNjcnVlZCBpbnRlcmVzdCBvbiBib3RoIGRlYnQgYW5kIGNvbGxhdGVyYWwgcG9zaXRpb25zIGlzIGluY2x1ZGVkCiAgICAvLyAgICAgICAgIC0gSGFuZGxlcyBkaWZmZXJlbnQgdG9rZW4gdHlwZXMgKEFSQzIwMCB2cyBTVG9rZW4pIGFwcHJvcHJpYXRlbHkKICAgIC8vICAgICAgICAgLSBVcGRhdGVzIGdsb2JhbCBib3Jyb3cgYW5kIGNvbGxhdGVyYWwgdmFsdWVzIGZvciB0aGUgdXNlcgogICAgLy8gICAgICIiIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgbGlxdWlkYXRlIG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgZGVidF9tYXJrZXRfaWQKICAgIC8vICAgICApLmxpcXVpZGF0ZS5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGRlYnRfYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJMaXF1aWRhdGUgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBSRU0gcHJldmVudCB1c2luZyBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgaW4gbGlxdWlkYXRpb24gYmVjYXVzZSBzdG9rZW4KICAgIC8vICAgICAjIFJFTSBtYXJrZXQgY29sbGF0ZXJhbCBkb2VzIG5vdCBleGlzdAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkICE9IHNlbGYuc3Rva2VuX2FwcF9pZAogICAgLy8gICAgICksICJDYW5ub3QgdXNlIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCAoYm9ycm93LW9ubHkgbWFya2V0KSIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgUkVNIHByZXZlbnQgc2VsZiBsaXF1aWRhdGlvbgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIGFzc2VydCB1c2VyX2lkICE9IGxpcXVpZGF0b3JfaWQsICJDYW5ub3QgbGlxdWlkYXRlIHNlbGYiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgZGVidF9tYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiRGVidCBtYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBzd2FwCiAgICBjb25jYXQKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDg3CiAgICAvLyBhc3NlcnQgZGVidF9tYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiRGVidCBtYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBhc3NlcnQgLy8gRGVidCBtYXJrZXQgZG9lcyBub3QgZXhpc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY5LTI0ODgKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPj0gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID49IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+PSBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zb21lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZiwgb3BlcmF0b3JfaWQ6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihvcGVyYXRvcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gICAgIG9wZXJhdG9yX2lkX2JveCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIG9wZXJhdG9yX2lkX2JveC52YWx1ZSA9IGFyYzQuQWRkcmVzcyhvcGVyYXRvcl9pZCkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBBdXRob3JpemVkUHJpY2VPcGVyYXRvclNldCgKICAgIC8vICAgICAjICAgICAgICAgYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcj1hcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmKSAtPiBBY2NvdW50OgogICAgLy8gICAgIG9wZXJhdG9yX2lkID0gQm94KGFyYzQuQWRkcmVzcywga2V5PWIiYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvciIpCiAgICAvLyAgICAgcmV0dXJuIG9wZXJhdG9yX2lkLmdldChkZWZhdWx0PWFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSkubmF0aXZlCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIFR4bi5zZW5kZXIgPT0gc2VsZi5fZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgICAgICBvciBUeG4uc2VuZGVyID09IHNlbGYub3duZXIKICAgIC8vICAgICApLCAib25seSBhdXRob3JpemVkIHByaWNlIG9wZXJhdG9yIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXSA9IFByaWNlRmVlZCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wPVByaWNlV2l0aFRpbWVzdGFtcCgKICAgIC8vICAgICAgICAgICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICksCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZEF0dGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZC5uYXRpdmUsIHByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcmljZTogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIC8vICAgICAgICAgbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgU2NhbGUgdGhlIHByaWNlIGJ5IFNDQUxFIGludGVybmFsbHkgZm9yIHN0b3JhZ2UKICAgIC8vICAgICBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRQcmljZVNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihwcmljZSkpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBmZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9mZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAxMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHBheW1lbnQgPD0gMTAwMDAwMAogICAgLy8gICAgICksICJwYXltZW50IGV4Y2VlZHMgbWF4aW11bSBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNgogICAgLy8gICAgIGFwcCA9IEFwcGxpY2F0aW9uKHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAgICAgaXR4bi5QYXltZW50KHJlY2VpdmVyPWFwcC5hZGRyZXNzLCBhbW91bnQ9cGF5bWVudCwgZmVlPTApLnN1Ym1pdCgpCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFByaWNlRmVlZFByb3ZpZGVySW50ZXJmYWNlLmdldF9wcmljZV93aXRoX3RpbWVzdGFtcCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICAgICAgPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgKToKICAgIC8vICAgICAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICAvLyAgICAgICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC5jb3B5KCkKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLCBwcmljZV93aXRoX3RpbWVzdGFtcC5wcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyAjIFJFTSBpbnRlbnRpb25hbGx5IGNvbW1lbnRlZCBvdXQKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIGFzc2VydCB0b2tlbl9pZC5uYXRpdmUgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gIyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICMgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHModG9rZW5faWQubmF0aXZlLCBtYXhfdG90YWxfZGVwb3NpdHMubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X21heF90b3RhbF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXhfdG90YWxfZGVwb3NpdHM6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIG1hcmtldC5tYXhfdG90YWxfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYobWF4X3RvdGFsX2RlcG9zaXRzKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0TWF4VG90YWxEZXBvc2l0c1NldCgKICAgIC8vICAgICAjICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYobWF4X3RvdGFsX2RlcG9zaXRzKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlX21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9wYXVzZV9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBwYXVzZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3BhdXNlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5wYXVzZWQgPSBhcmM0LkJvb2wocGF1c2UgPT0gVUludDY0KDEpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzeW5jX21hcmtldChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hY2NydWVfaW50ZXJlc3Qoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgY3VycmVudF90aW1lID0gR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAKICAgIC8vICAgICB0aW1lX2RlbHRhID0gY3VycmVudF90aW1lIC0gbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUubmF0aXZlCiAgICAvLyAgICAgaWYgdGltZV9kZWx0YSA8PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICAgICAjIEZvciBzdG9rZW4gbWFya2V0IChib3Jyb3ctb25seSksIHVzZSBhIGZpeGVkIHV0aWxpemF0aW9uIHJhdGUgc2luY2UgdGhlcmUgYXJlIG5vIGRlcG9zaXRzCiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgdXRpbGl6YXRpb24gPSBCaWdVSW50KDEwMDAwKSAgIyAxMDAlIHV0aWxpemF0aW9uIGZvciBib3Jyb3ctb25seSBtYXJrZXQKICAgIC8vICAgICBlbGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICB1dGlsaXphdGlvbiA9ICgKICAgIC8vICAgICAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiAxMDAwMAogICAgLy8gICAgICAgICApIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgcmF0ZSA9IG1hcmtldC5ib3Jyb3dfcmF0ZS5uYXRpdmUgKyAobWFya2V0LnNsb3BlLm5hdGl2ZSAqIHV0aWxpemF0aW9uKSAvLyAxMDAwMAogICAgLy8gICAgIGludGVyZXN0ID0gKHJhdGUgKiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdGltZV9kZWx0YSkgLy8gKAogICAgLy8gICAgICAgICBzZWxmLnNlY29uZHNfcGVyX3llYXIgKiAxMDAwMAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgU3BlY2lhbCBoYW5kbGluZyBmb3Igc3Rva2VuIG1hcmtldCAtIGFsbCBpbnRlcmVzdCBnb2VzIHRvIHJlc2VydmVzCiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IGludGVyZXN0CiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9wb3J0aW9uID0gQmlnVUludCgwKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSAoCiAgICAvLyAgICAgICAgICAgICBpbnRlcmVzdCAqIGFyYzQuVUludDI1Ni5mcm9tX2J5dGVzKG1hcmtldC5yZXNlcnZlX2ZhY3Rvci5ieXRlcykubmF0aXZlCiAgICAvLyAgICAgICAgICkgLy8gMTAwMDAKICAgIC8vICAgICAgICAgaWYgcHJvdG9jb2xfcG9ydGlvbiA+IGludGVyZXN0OgogICAgLy8gICAgICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IGludGVyZXN0CiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9wb3J0aW9uID0gaW50ZXJlc3QgLSBwcm90b2NvbF9wb3J0aW9uCiAgICAvLyAKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID4gMDoKICAgIC8vICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXggPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgICAgICsgKGRlcG9zaXRvcl9wb3J0aW9uICogU0NBTEUpIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPiAwOgogICAgLy8gICAgICAgICBtYXJrZXQuYm9ycm93X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgICAgICsgKGludGVyZXN0ICogU0NBTEUpIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgaW50ZXJlc3QKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBkZXBvc2l0b3JfcG9ydGlvbgogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSArIHByb3RvY29sX3BvcnRpb24pCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChjdXJyZW50X3RpbWUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vICAgICByZXR1cm4gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAjIFRPRE8gZ292ZXJuYW5jZTogY29uc2lkZXIgaWYgcmVzZXJ2ZSB3aXRoZHJhd2FsIHNob3VsZCByZXF1aXJlIGFkZGl0aW9uYWwKICAgIC8vICMgICAgICBnb3Zlcm5hbmNlIG1lY2hhbmlzbXMKICAgIC8vICMgVE9ETyBtaW5pbXVtIHJlc2VydmUgbGV2ZWxzOiBtaWdodCB3YW50IHRvIGVuZm9yY2UgbWluaW11bSByZXNlcnZlIGxldmVscyBmb3IKICAgIC8vICMgICAgICBwcm90b2NvbCBzYWZldHkKICAgIC8vICMgVE9ETyBldmVudCBlbWlzc2lvbjogQ29uc2lkZXIgYWRkaW5nIGFuIGV2ZW50IHRvIGxvZyByZXNlcnZlIHdpdGhkcmF3YWxzIGZvcgogICAgLy8gIyAgICAgIHRyYW5zcGFyZW5jeQogICAgLy8gCiAgICAvLyAjIFJFTSBpbnRlbnRpb25hbGx5IHNraXBwaW5nIHN1YnJvdXRpbmUgdG8gcmVkdWNlIGNvbnRyYWN0IHNpemUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHdpdGhkcmF3X3Jlc2VydmVzKHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3dpdGhkcmF3X3Jlc2VydmVzKG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3X3Jlc2VydmVzKHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgQWNjcnVlIGludGVyZXN0IGZpcnN0IHRvIGdldCB1cC10by1kYXRlIHJlc2VydmVzCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgbWFya2V0LnJlc2VydmVzLm5hdGl2ZSA+PSBhbW91bnQsICJJbnN1ZmZpY2llbnQgcmVzZXJ2ZXMiCiAgICAvLyAKICAgIC8vICAgICAjIFRyYW5zZmVyIHJlc2VydmVzIHRvIHRoZSBvd25lciAobm90IHRvIHRoZSBjb250cmFjdCBpdHNlbGYpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3Moc2VsZi5vd25lciksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFVwZGF0ZSByZXNlcnZlcwogICAgLy8gICAgIG1hcmtldC5yZXNlcnZlcyA9IGFyYzQuVUludDI1NihtYXJrZXQucmVzZXJ2ZXMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQsIGd1YXJkX3N0b2tlbjogYm9vbAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IGFtb3VudCA+IDAsICJBbW91bnQgbXVzdCBiZSA+IDAiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBtYXJrZXQucGF1c2VkLCAiTWFya2V0IGlzIHBhdXNlZCIKICAgIC8vICAgICBpZiBndWFyZF9zdG9rZW46CiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgIT0gbWFya2V0X2lkCiAgICAvLyAgICAgICAgICksICJDYW5ub3QgdXNlIHN0b2tlbiBtYXJrZXQgZm9yIHRoaXMgb3BlcmF0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXBvc2l0KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX2RlcG9zaXQoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBSRU0gbWF5IGFkZCBwcm90ZWN0aW9uIGZvciBsb3cgdXRpbGlzYXRpb24gaW4gZnV0dXJlCiAgICAvLyAjIFJFTSBsb3dlciBtYXggZGVwb3NpdCBhbW91bnQgZm9yIGxvdyB1dGlsaXNhdGlvbgogICAgLy8gIyBSRU0gaGlnaCBtYXggZGVwb3NpdCBhbW91bnQgZm9yIGhpZ2ggdXRpbGlzYXRpb24KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVwb3NpdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIEludGVybmFsIGRlcG9zaXQgbWV0aG9kIHRoYXQgaGFuZGxlcyB1c2VyIGRlcG9zaXRzIGludG8gYSBsZW5kaW5nIG1hcmtldC4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIHBlcmZvcm1zIGEgY29tcGxldGUgZGVwb3NpdCBvcGVyYXRpb24gaW5jbHVkaW5nOgogICAgLy8gICAgIDEuIFZhbGlkYXRpbmcgdGhlIG1hcmtldCBvcGVyYXRpb24gKHByb3RvY29sIG5vdCBwYXVzZWQsIG1hcmtldCBleGlzdHMsIGFtb3VudCA+IDAsIG1hcmtldCBub3QgcGF1c2VkKQogICAgLy8gICAgIDIuIFRyYW5zZmVycmluZyBBUkMyMDAgdG9rZW5zIGZyb20gdXNlciB0byB0aGUgbGVuZGluZyBwb29sIGNvbnRyYWN0CiAgICAvLyAgICAgMy4gQWNjcnVpbmcgaW50ZXJlc3Qgb24gdGhlIG1hcmtldCB0byBnZXQgdXBkYXRlZCBkZXBvc2l0IGluZGV4CiAgICAvLyAgICAgNC4gQ2FsY3VsYXRpbmcgYW5kIGFkZGluZyBlYXJuZWQgaW50ZXJlc3QgdG8gdGhlIHVzZXIncyBwb3NpdGlvbgogICAgLy8gICAgIDUuIENvbnZlcnRpbmcgZGVwb3NpdCBhbW91bnQgdG8gc2NhbGVkIGRlcG9zaXRzIHVzaW5nIGN1cnJlbnQgZGVwb3NpdCBpbmRleAogICAgLy8gICAgIDYuIENoZWNraW5nIGRlcG9zaXQgY2FwIGNvbnN0cmFpbnRzCiAgICAvLyAgICAgNy4gVXBkYXRpbmcgdXNlciBhbmQgbWFya2V0IHNjYWxlZCBkZXBvc2l0IGJhbGFuY2VzCiAgICAvLyAgICAgOC4gTWludGluZyBOVG9rZW5zIHRvIHJlcHJlc2VudCB0aGUgdXNlcidzIGRlcG9zaXQgcG9zaXRpb24KICAgIC8vICAgICA5LiBVcGRhdGluZyBnbG9iYWwgY29sbGF0ZXJhbCBjYWxjdWxhdGlvbnMgZm9yIHRoZSB1c2VyCiAgICAvLyAgICAgMTAuIEVtaXR0aW5nIGEgTWFya2V0RGVwb3NpdCBldmVudAogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIG1ha2luZyB0aGUgZGVwb3NpdAogICAgLy8gICAgICAgICBtYXJrZXRfaWQgKFVJbnQ2NCk6IFRoZSBJRCBvZiB0aGUgbWFya2V0IHRvIGRlcG9zaXQgaW50bwogICAgLy8gICAgICAgICBhbW91bnQgKEJpZ1VJbnQpOiBUaGUgYW1vdW50IG9mIHVuZGVybHlpbmcgdG9rZW5zIHRvIGRlcG9zaXQKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIG1hcmtldCB2YWxpZGF0aW9uIGZhaWxzLCBkZXBvc2l0IGNhcCBpcyBleGNlZWRlZCwgb3Igb3RoZXIgY29uc3RyYWludHMgYXJlIHZpb2xhdGVkCiAgICAvLyAKICAgIC8vICAgICBOb3RlOgogICAgLy8gICAgICAgICAtIEludGVyZXN0IGVhcm5lZCBzaW5jZSBsYXN0IGludGVyYWN0aW9uIGlzIGF1dG9tYXRpY2FsbHkgYWRkZWQgdG8gdGhlIGRlcG9zaXQKICAgIC8vICAgICAgICAgLSBTY2FsZWQgZGVwb3NpdHMgYXJlIHVzZWQgdG8gdHJhY2sgdXNlciBwb3NpdGlvbnMgYW5kIGNhbGN1bGF0ZSBpbnRlcmVzdAogICAgLy8gICAgICAgICAtIENvbGxhdGVyYWwgdmFsdWUgaXMgdXBkYXRlZCB1c2luZyBlaXRoZXIgdXNlcidzIGxhc3QgcmVjb3JkZWQgcHJpY2Ugb3IgY3VycmVudCBtYXJrZXQgcHJpY2UKICAgIC8vICAgICAgICAgLSBOVG9rZW5zIGFyZSBtaW50ZWQgdG8gcmVwcmVzZW50IHRoZSB1c2VyJ3MgZGVwb3NpdCBwb3NpdGlvbiAoYW1vdW50ICsgaW50ZXJlc3QpCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIGRlcG9zaXQgb3BlcmF0aW9uCiAgICAvLyAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApLmRlcG9zaXQubmF0aXZlCiAgICAvLyAgICAgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIkRlcG9zaXQgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gICAgICkgICMgR2V0IHVwZGF0ZWQgbWFya2V0IHdpdGggYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIEFkZCBlYXJuZWQgaW50ZXJlc3QgdG8gdXNlcidzIHBvc2l0aW9uIGFzIGFkZGl0aW9uYWwgc2NhbGVkIGRlcG9zaXRzCiAgICAvLyAgICAgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBpZiBpbnRlcmVzdCA+IDA6CiAgICAvLyAgICAgICAgIGludGVyZXN0X3NjYWxlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICBpbnRlcmVzdCAqIFNDQUxFCiAgICAvLyAgICAgICAgICkgLy8gbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gCiAgICAvLyAgICAgc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgYW1vdW50ICogU0NBTEUKICAgIC8vICAgICApIC8vIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUgICMgQ2FsY3VsYXRlIHdpdGggbmV3IGluZGV4CiAgICAvLyAKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfYW1vdW50ID0gc2NhbGVkX2Ftb3VudCArIGludGVyZXN0X3NjYWxlZF9hbW91bnQKICAgIC8vIAogICAgLy8gICAgIG9sZF9kZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG5ld19tYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICA+PSBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyB0b3RhbF9zY2FsZWRfYW1vdW50CiAgICAvLyAgICAgKSwgIk1hcmtldCBkZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgdXNlcl9pZCwgdG90YWxfc2NhbGVkX2Ftb3VudAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgdG90YWxfc2NhbGVkX2Ftb3VudCkKICAgIC8vIAogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5taW50LAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQgKyBpbnRlcmVzdCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIG9sZF9kZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vICAgICBuZXdfZGVwb3NpdF9hbW91bnQgPSBvbGRfZGVwb3NpdF9hbW91bnQgKyBhbW91bnQgKyBpbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICAjIEZhbGxiYWNrOiBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgdG8gcHJldmVudCBuZWdhdGl2ZSBjb2xsYXRlcmFsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgICMgTm9ybWFsIGNhc2U6IFVzZSB1c2VyJ3MgbGFzdCByZWNvcmRlZCBwcmljZSBmb3IgYWNjdXJhdGUgY29sbGF0ZXJhbCByZWR1Y3Rpb24KICAgIC8vICAgICAgICAgb2xkX3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIHVzZXIubGFzdF9wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSA9IChuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3IgZGVwb3NpdCBvcGVyYXRpb24KICAgIC8vICAgICB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgIGlmIHVzZXJfY2FwLnRvdGFsX2RlcG9zaXRzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICBuZXdfdmFsdWUgPD0gdXNlcl9jYXAudG90YWxfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIGRlcG9zaXQgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKHVzZXJfaWQsIG1hcmtldF9pZCwgb2xkX3ZhbHVlLCBuZXdfdmFsdWUpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXREZXBvc2l0KAogICAgLy8gICAgICMgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksIGFyYzQuVUludDY0KG1hcmtldF9pZCksIGFyYzQuVUludDI1NihhbW91bnQpCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QoCiAgICAvLyAjICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICMgKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAjICAgICBlbnN1cmVfYnVkZ2V0KDcwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICMgICAgIHJldHVybiBhcmM0LlVJbnQyNTYoCiAgICAvLyAjICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBpbnRlcmVzdCIiIgogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB0b3RhbCB1bmRlcmx5aW5nIGFtb3VudAogICAgLy8gICAgIHVzZXJfdG90YWxfdW5kZXJseWluZyA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UgZnJvbSB0aGUgc2NhbGVkIGRlcG9zaXRzICh3aGljaCByZXByZXNlbnQgdGhlICJiYXNlIiBhbW91bnQpCiAgICAvLyAgICAgaW50ZXJlc3QgPSB1c2VyX3RvdGFsX3VuZGVybHlpbmcgLSB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCgKICAgIC8vICMgICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gIyApIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICMgICAgIGVuc3VyZV9idWRnZXQoNzAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gIyAgICAgcmV0dXJuIGFyYzQuVUludDI1NigKICAgIC8vICMgICAgICAgICBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIiIiQ2FsY3VsYXRlIHVzZXIncyBhY2NydWVkIGRlYnQgaW50ZXJlc3QiIiIKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgdW5kZXJseWluZyBkZWJ0IGFtb3VudAogICAgLy8gICAgIHVzZXJfdG90YWxfZGVidCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBvcmlnaW5hbCBwcmluY2lwYWwgYW1vdW50IHVzaW5nIHVzZXIncyBib3Jyb3dfaW5kZXgKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogaWYgdXNlcidzIGJvcnJvd19pbmRleCBpcyAwLCB1c2UgY3VycmVudCBtYXJrZXQgYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlcl9ib3Jyb3dfaW5kZXggPSAoCiAgICAvLyAgICAgICAgIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIG9yaWdpbmFsX3ByaW5jaXBhbCA9ICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHVzZXJfYm9ycm93X2luZGV4KSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBJbnRlcmVzdCBpcyB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGN1cnJlbnQgdG90YWwgZGVidCBhbmQgb3JpZ2luYWwgcHJpbmNpcGFsCiAgICAvLyAgICAgZGVidF9pbnRlcmVzdCA9IHVzZXJfdG90YWxfZGVidCAtIG9yaWdpbmFsX3ByaW5jaXBhbAogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIGRlYnRfaW50ZXJlc3QKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgd2l0aGRyYXcoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDIxMDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAKICAgIC8vICAgICAjIFN5bmMgdGhlIG1hcmtldCBiZWluZyB3aXRoZHJhd24gZnJvbSB0byB1cGRhdGUgZ2xvYmFsIHZhbHVlcyB3aXRoIGludGVyZXN0CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50MjU2KHNlbGYuX3dpdGhkcmF3KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhdygKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgV2l0aGRyYXcgdG9rZW5zIGZyb20gYSBsZW5kaW5nIG1hcmtldCBieSBidXJuaW5nIG5Ub2tlbnMuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBoYW5kbGVzIHRoZSB3aXRoZHJhd2FsIHByb2Nlc3MgYnk6CiAgICAvLyAgICAgMS4gVmFsaWRhdGluZyB0aGUgbWFya2V0IG9wZXJhdGlvbiBhbmQgdXNlciBiYWxhbmNlCiAgICAvLyAgICAgMi4gQWNjcnVpbmcgaW50ZXJlc3QgdG8gZ2V0IHRoZSBsYXRlc3QgbWFya2V0IHN0YXRlCiAgICAvLyAgICAgMy4gQ2FsY3VsYXRpbmcgdXNlcidzIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICAgICA0LiBQZXJmb3JtaW5nIGhlYWx0aCBjaGVja3MgdG8gZW5zdXJlIHdpdGhkcmF3YWwgZG9lc24ndCBwdXQgYm9ycm93cyBhdCByaXNrCiAgICAvLyAgICAgNS4gQnVybmluZyBuVG9rZW5zIGFuZCB0cmFuc2ZlcnJpbmcgdW5kZXJseWluZyB0b2tlbnMgdG8gdXNlcgogICAgLy8gICAgIDYuIFVwZGF0aW5nIGdsb2JhbCBjb2xsYXRlcmFsIHZhbHVlcwogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZDogVGhlIGFjY291bnQgSUQgb2YgdGhlIHVzZXIgd2l0aGRyYXdpbmcgdG9rZW5zCiAgICAvLyAgICAgICAgIG1hcmtldF9pZDogVGhlIElEIG9mIHRoZSBtYXJrZXQgdG8gd2l0aGRyYXcgZnJvbQogICAgLy8gICAgICAgICBhbW91bnQ6IFRoZSBhbW91bnQgb2YgblRva2VucyB0byBidXJuIChub3QgdGhlIHVuZGVybHlpbmcgdG9rZW4gYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgUmV0dXJuczoKICAgIC8vICAgICAgICAgQmlnVUludDogVGhlIHRvdGFsIGFtb3VudCBvZiB1bmRlcmx5aW5nIHRva2VucyB0cmFuc2ZlcnJlZCB0byB0aGUgdXNlcgogICAgLy8gICAgICAgICAgICAgICAgIChpbmNsdWRlcyBib3RoIHRoZSB3aXRoZHJhd24gYW1vdW50IGFuZCBhY2NydWVkIGludGVyZXN0KQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgdXNlciBoYXMgaW5zdWZmaWNpZW50IGJhbGFuY2Ugb3Igd2l0aGRyYXdhbCB3b3VsZCBwdXQgYm9ycm93cyBhdCByaXNrCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIHdpdGhkcmF3IG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgKS53aXRoZHJhdy5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiV2l0aGRyYXcgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBhbW91bnQgaXMgdGhlIGFtb3VudCBvZiBuVG9rZW5zIGJlaW5nIGJ1cm5lZAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGFtb3VudCA8PSB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBoZWFsdGggY2hlY2s6IGVuc3VyZSB3aXRoZHJhdyB3b3VsZCBub3QgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgIGlmIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZSA+IDA6CiAgICAvLyAgICAgICAgICMgdmFsdWUgb2YgdW5kZXJseWluZyBhbW91bnQgdG8gd2l0aGRyYXcgdXNpbmcgbmV3IG1hcmtldCBwcmljZQogICAgLy8gICAgICAgICB3aXRoZHJhd192YWx1ZSA9IChhbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgcmVtYWluaW5nX2NvbGxhdGVyYWwgPSAoCiAgICAvLyAgICAgICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIHdpdGhkcmF3X3ZhbHVlCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgYXNzZXJ0IGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgPD0gKAogICAgLy8gICAgICAgICAgICAgcmVtYWluaW5nX2NvbGxhdGVyYWwgKiBCaWdVSW50KG5ld19tYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgLy8gICAgICAgICApIC8vIEJpZ1VJbnQoMTAwMDApLCAiV2l0aGRyYXdhbCB3b3VsZCBwdXQgYm9ycm93cyBhdCByaXNrIgogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHVzZXJfaWQsIGFtb3VudCkKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50ICsgaW50ZXJlc3QpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2RlcG9zaXRfYW1vdW50ID0gb2xkX2RlcG9zaXRfYW1vdW50ICsgaW50ZXJlc3QgLSBhbW91bnQKICAgIC8vIAogICAgLy8gICAgIGFtb3VudF91c2RfdmFsdWUgPSAoYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIHdpdGhkcmF3IG9wZXJhdGlvbgogICAgLy8gICAgIHVzZXJfY2FwID0gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9PSAwOgogICAgLy8gICAgICAgICB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIC8vICAgICBlbGlmIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPCBHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcDoKICAgIC8vICAgICAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIC8vICAgICAgICAgdXNlcl9jYXAudG90YWxfbGlxdWlkYXRpb25zID0gYXJjNC5VSW50MjU2KDApCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCArIDg2NDAwKQogICAgLy8gICAgIGlmIHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgICAgIG5ld190b3RhbF93aXRoZHJhd2FscyA9IHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzLm5hdGl2ZSArIGFtb3VudF91c2RfdmFsdWUKICAgIC8vICAgICAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgICAgIG5ld190b3RhbF93aXRoZHJhd2FscyA8PSB1c2VyX2NhcC5kYWlseV93aXRoZHJhd2Fscy5uYXRpdmUKICAgIC8vICAgICAgICAgKSwgIlVzZXIgd2l0aGRyYXcgY2FwIGV4Y2VlZGVkIgogICAgLy8gICAgICAgICB1c2VyX2NhcC50b3RhbF93aXRoZHJhd2FscyA9IGFyYzQuVUludDI1NihuZXdfdG90YWxfd2l0aGRyYXdhbHMpCiAgICAvLyAgICAgICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgIyBGYWxsYmFjazogVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIHRvIHByZXZlbnQgbmVnYXRpdmUgY29sbGF0ZXJhbAogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSA9IChuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICAjIE5vcm1hbCBjYXNlOiBVc2UgdXNlcidzIGxhc3QgcmVjb3JkZWQgcHJpY2UgZm9yIGFjY3VyYXRlIGNvbGxhdGVyYWwgcmVkdWN0aW9uCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlLCAgIyBvbGQgVVNEIHZhbHVlCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSwgICMgbmV3IFVTRCB2YWx1ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgRW1pdCBldmVudHMKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRXaXRoZHJhdygKICAgIC8vICAgICAjICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLCBhcmM0LlVJbnQyNTYoYW1vdW50KQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBhbW91bnQgKyBpbnRlcmVzdAogICAgLy8gCiAgICAvLyAjIHdpdGhkcmF3IGNvc3QgOTAwMDAwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGJvcnJvdyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDI4MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAKICAgIC8vICAgICAjIFN5bmMgdGhlIG1hcmtldCBiZWluZyBib3Jyb3dlZCBmcm9tIHRvIHVwZGF0ZSBnbG9iYWwgdmFsdWVzIHdpdGggaW50ZXJlc3QKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2JvcnJvdyhUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9ib3Jyb3coc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIGJvcnJvdyBvcGVyYXRpb24KICAgIC8vICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gICAgICkuYm9ycm93Lm5hdGl2ZQogICAgLy8gICAgIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJCb3Jyb3cgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQodXNlcl9pZCkKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSBVSW50NjQoMTAwMDAwKSwgIlBheW1lbnQgYW1vdW50IG11c3QgYmUgPj0gMC4xIgogICAgLy8gCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB1c2VyJ3MgY3VycmVudCBkZWJ0IGludGVyZXN0CiAgICAvLyAgICAgZGVidF9pbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgY3VycmVudCBtYXJrZXQgdG90YWwgYm9ycm93cyAoaW5jbHVkaW5nIGludGVyZXN0KQogICAgLy8gICAgIGN1cnJlbnRfbWFya2V0X3RvdGFsX2JvcnJvd3MgPSAoCiAgICAvLyAgICAgICAgIG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgYW1vdW50IGJlaW5nIGFkZGVkIChuZXcgYm9ycm93ICsgZGVidCBpbnRlcmVzdCkKICAgIC8vICAgICAjIGRlYnQgaW50ZXJlc3QgYWRkZWQgYXQgdGhpcyBwb2ludCB0byBwcmV2ZW50IHVubmVjZXNzYXJ5IGRlYnQgcmVzZXQKICAgIC8vICAgICB0b3RhbF9hbW91bnRfdG9fYWRkID0gYW1vdW50ICsgZGVidF9pbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgIyBWYWxpZGF0ZSBhZ2FpbnN0IG1hcmtldC13aWRlIGJvcnJvdyBjYXAKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0Lm1heF90b3RhbF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICAgICA+PSBjdXJyZW50X21hcmtldF90b3RhbF9ib3Jyb3dzICsgdG90YWxfYW1vdW50X3RvX2FkZAogICAgLy8gICAgICksICJCb3Jyb3cgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgIyBDaGVjayBjb2xsYXRlcmFsIHJlcXVpcmVtZW50cyAtIGV4Y2x1ZGUgc2FtZSBtYXJrZXQgY29sbGF0ZXJhbCB0byBwcmV2ZW50CiAgICAvLyAgICAgIyBpbmVmZmljaWVudCBzYW1lLWFzc2V0IGJvcnJvd2luZwogICAgLy8gICAgIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICAvLyAKICAgIC8vICAgICBuZXdfYm9ycm93X3ZhbHVlID0gKHRvdGFsX2Ftb3VudF90b19hZGQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICB0b3RhbF9ib3Jyb3dfdmFsdWUgPSBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlICsgbmV3X2JvcnJvd192YWx1ZQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgZWZmZWN0aXZlIGNvbGxhdGVyYWwgdmFsdWUgKGV4Y2x1ZGluZyBzYW1lLW1hcmtldCBkZXBvc2l0cykKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gQmlnVUludCgwKToKICAgIC8vICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZQogICAgLy8gICAgICMgVXNlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgZGVwb3NpdGVkX2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBleGNsdWRlZF92YWx1ZSA9IChkZXBvc2l0ZWRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIGlmIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlID4gZXhjbHVkZWRfdmFsdWU6CiAgICAvLyAgICAgICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSA9ICgKICAgIC8vICAgICAgICAgICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIGV4Y2x1ZGVkX3ZhbHVlCiAgICAvLyAgICAgICAgICAgICApCiAgICAvLyAgICAgICAgIGVsc2U6CiAgICAvLyAgICAgICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSA9IEJpZ1VJbnQoMCkKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCB0b3RhbF9ib3Jyb3dfdmFsdWUgPD0gKAogICAgLy8gICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSAqIEJpZ1VJbnQobmV3X21hcmtldC5jb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUpCiAgICAvLyAgICAgKSAvLyBCaWdVSW50KDEwMDAwKSwgIkluc3VmZmljaWVudCBjb2xsYXRlcmFsIGFjcm9zcyBtYXJrZXRzIgogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgc2NhbGVkIGFtb3VudCBmb3IgdGhlIHRvdGFsCiAgICAvLyAgICAgc2NhbGVkX2Ftb3VudCA9ICh0b3RhbF9hbW91bnRfdG9fYWRkICogU0NBTEUpIC8vIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vIAogICAgLy8gICAgIG9sZF9ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZSAvLyBTQ0FMRQogICAgLy8gICAgICkKICAgIC8vICAgICBuZXdfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICAgICAgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgLy8gU0NBTEUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSBpZiB1c2VyIGRvZXNuJ3QgaGF2ZSBhIHByZXZpb3VzIHByaWNlCiAgICAvLyAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG5ld19tYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHByaWNlX2Zvcl9uZXcgPSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAgICAgb2xkX3ZhbHVlID0gKG9sZF9ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX29sZCkgLy8gU0NBTEUKICAgIC8vICAgICBuZXdfdmFsdWUgPSAobmV3X2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3JfbmV3KSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHVzZXIgY2FwIGZvciBib3Jyb3cgb3BlcmF0aW9uCiAgICAvLyAgICAgdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC50b3RhbF9ib3Jyb3dzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICBuZXdfdmFsdWUgPD0gdXNlcl9jYXAudG90YWxfYm9ycm93cy5uYXRpdmUKICAgIC8vICAgICAgICAgKSwgIlVzZXIgYm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBvbGRfdmFsdWUsICAjIG9sZCBVU0QgdmFsdWUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlLCAgIyBuZXcgVVNEIHZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBpZiBzdG9rZW4sIG1pbnQgc3Rva2VuCiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5taW50LAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgICAgICByZWNlaXZlcj1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAsIGZlZT0wCiAgICAvLyAgICAgICAgICkuc3VibWl0KCkKICAgIC8vICAgICAjIGlmIGFUb2tlbiwgdHJhbnNmZXIgYVRva2VuCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldEJvcnJvdygKICAgIC8vICAgICAjICAgICAgICAgdXNlcj1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHRva2VuX2lkPWFyYzQuVUludDY0KG1hcmtldF9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIGFtb3VudD1hcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHJlcGF5KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMTQwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICBzZWxmLl9yZXBheShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9yZXBheShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFJlcGF5IGJvcnJvd2VkIHRva2VucyBmb3IgYSBzcGVjaWZpYyBtYXJrZXQuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBoYW5kbGVzIHRoZSByZXBheW1lbnQgb2YgYm9ycm93ZWQgdG9rZW5zIHdpdGggYSBtaW5pbXVtIGludGVyZXN0CiAgICAvLyAgICAgcmVxdWlyZW1lbnQuIEl0IHN1cHBvcnRzIGJvdGggc1Rva2VuIChidXJuKSBhbmQgYVRva2VuICh0cmFuc2ZlcikgbWFya2V0cy4KICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSB1c2VyIElEIHRvIHJlcGF5IHRva2VucyBmb3IKICAgIC8vICAgICAgICAgbWFya2V0X2lkOiBUaGUgbWFya2V0IElEIHRvIHJlcGF5IHRva2VucyBmb3IKICAgIC8vICAgICAgICAgYW1vdW50OiBUaGUgYW1vdW50IG9mIHRva2VucyB0byByZXBheSAobXVzdCBiZSA+PSBhY2NydWVkIGludGVyZXN0KQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgbWFya2V0IHZhbGlkYXRpb24gZmFpbHMsIHJlcGF5IGFtb3VudCBleGNlZWRzIHRvdGFsIGRlYnQsCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgcmVwYXkgYW1vdW50IGlzIGxlc3MgdGhhbiBhY2NydWVkIGludGVyZXN0LCBvciBwcmluY2lwYWwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICByZXBheW1lbnQgZXhjZWVkcyBzY2FsZWQgZGVidAogICAgLy8gCiAgICAvLyAgICAgUHJvY2VzczoKICAgIC8vICAgICAgICAgMS4gVmFsaWRhdGVzIG1hcmtldCBvcGVyYXRpb24gYW5kIGFjY3J1ZXMgaW50ZXJlc3QKICAgIC8vICAgICAgICAgMi4gQ2FsY3VsYXRlcyB0b3RhbCBkZWJ0IGluY2x1ZGluZyBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgICAgIDMuIFZhbGlkYXRlcyByZXBheSBhbW91bnQgZG9lc24ndCBleGNlZWQgdG90YWwgZGVidAogICAgLy8gICAgICAgICA0LiBSZXF1aXJlcyBtaW5pbXVtIHJlcGF5bWVudCBvZiBhdCBsZWFzdCB0aGUgYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gICAgICAgICA1LiBDYWxjdWxhdGVzIHByaW5jaXBhbCByZXBheW1lbnQgKGFtb3VudCAtIGludGVyZXN0KQogICAgLy8gICAgICAgICA2LiBCdXJucyBzVG9rZW5zIG9yIHRyYW5zZmVycyBhVG9rZW5zIGZyb20gdXNlcgogICAgLy8gICAgICAgICA3LiBVcGRhdGVzIHVzZXIgYW5kIG1hcmtldCBzY2FsZWQgYm9ycm93IGFtb3VudHMgKHByaW5jaXBhbCBvbmx5KQogICAgLy8gICAgICAgICA4LiBVcGRhdGVzIGdsb2JhbCBib3Jyb3cgdmFsdWUgdHJhY2tpbmcgd2l0aCBwcm9wZXIgcHJpY2UgaGFuZGxpbmcKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBGYWxzZSkKICAgIC8vIAogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB1c2VyJ3MgY3VycmVudCBkZWJ0IGludGVyZXN0CiAgICAvLyAgICAgZGVidF9pbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgZGVidCBpbmNsdWRpbmcgaW50ZXJlc3QKICAgIC8vICAgICB1bnNjYWxlZF9ib3Jyb3dzID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vICAgICB0b3RhbF9kZWJ0ID0gdW5zY2FsZWRfYm9ycm93cyArIGRlYnRfaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgICMgVmFsaWRhdGUgcmVwYXkgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vICAgICBhc3NlcnQgYW1vdW50IDw9IHRvdGFsX2RlYnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0IgogICAgLy8gCiAgICAvLyAgICAgIyBSZXF1aXJlIG1pbmltdW0gcmVwYXltZW50IG9mIGF0IGxlYXN0IHRoZSBkZWJ0IGludGVyZXN0CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgYW1vdW50ID49IGRlYnRfaW50ZXJlc3QKICAgIC8vICAgICApLCAiUmVwYXkgYW1vdW50IG11c3QgYmUgYXQgbGVhc3QgdGhlIGFjY3J1ZWQgaW50ZXJlc3QiCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBob3cgbXVjaCBnb2VzIHRvd2FyZCBwcmluY2lwYWwgcmVwYXltZW50CiAgICAvLyAgICAgcHJpbmNpcGFsX3JlcGF5bWVudCA9IGFtb3VudCAtIGRlYnRfaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHNjYWxlZCBhbW91bnQgZm9yIHByaW5jaXBhbCByZXBheW1lbnQgb25seQogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAocHJpbmNpcGFsX3JlcGF5bWVudCAqIFNDQUxFKSAvLyBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICBhc3NlcnQgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gc2NhbGVkX2Ftb3VudCwgIlJlcGF5IGFtb3VudCBleGNlZWRzIGRlYnQiCiAgICAvLyAKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgU1Rva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBvbGRfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUgLy8gU0NBTEUKICAgIC8vICAgICApCiAgICAvLyAgICAgbmV3X2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgICAgICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgaWYgdXNlciBkb2Vzbid0IGhhdmUgYSBwcmV2aW91cyBwcmljZQogICAgLy8gICAgIHByaWNlX2Zvcl9vbGQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBwcmljZV9mb3JfbmV3ID0gbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIG9sZF92YWx1ZSA9IChvbGRfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X3ZhbHVlID0gKG5ld19ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX25ldykgLy8gU0NBTEUKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlLCAgIyBvbGQgVVNEIHZhbHVlCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSwgICMgbmV3IFVTRCB2YWx1ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldFJlcGF5KAogICAgLy8gICAgICMgICAgICAgICB1c2VyPWFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KG1hcmtldF9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIGFtb3VudD1hcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgbWludC9yZWRlZW0gcmVsYXRlZCBjb2RlCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiByZWRlZW0oc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAjICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAjICAgICBzZWxmLl9yZWRlZW0obWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3JlZGVlbShzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIC8vIAogICAgLy8gIyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9oYXNfcG9zaXRpb24oCiAgICAvLyAjICAgICAgICAgVHhuLnNlbmRlciwgbWFya2V0X2lkCiAgICAvLyAjICAgICApLCAiQ2Fubm90IG1pbnQvcmVkZWVtIHdoZW4gdXNlciBoYXMgdHJhY2tlZCBkZXBvc2l0IHBvc2l0aW9uIgogICAgLy8gCiAgICAvLyAjICAgICBtYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIE5Ub2tlbi5idXJuX2Zyb20sCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gIyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vICMgICAgIHNjYWxlZF9hbW91bnQgPSAoYW1vdW50ICogU0NBTEUpIC8vIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gIyAgICAgYXNzZXJ0ICgKICAgIC8vICMgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBzY2FsZWRfYW1vdW50CiAgICAvLyAjICAgICApLCAiSW5zdWZmaWNpZW50IG1hcmtldCBkZXBvc2l0cyB0byByZWRlZW0iCiAgICAvLyAjICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIG1pbnQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9taW50KG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9taW50KHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgLy8gCiAgICAvLyAjICAgICBhc3NlcnQgbm90IHNlbGYuX2hhc19wb3NpdGlvbigKICAgIC8vICMgICAgICAgICBUeG4uc2VuZGVyLCBtYXJrZXRfaWQKICAgIC8vICMgICAgICksICJDYW5ub3QgbWludC9yZWRlZW0gd2hlbiB1c2VyIGhhcyB0cmFja2VkIGRlcG9zaXQgcG9zaXRpb24iCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gIyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gIyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KAogICAgLy8gIyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gIyAgICAgKSAgIyBHZXQgdXBkYXRlZCBtYXJrZXQgd2l0aCBhY2NydWVkIGludGVyZXN0CiAgICAvLyAjICAgICBzY2FsZWRfYW1vdW50ID0gKAogICAgLy8gIyAgICAgICAgIGFtb3VudCAqIFNDQUxFCiAgICAvLyAjICAgICApIC8vIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUgICMgQ2FsY3VsYXRlIHdpdGggbmV3IGluZGV4CiAgICAvLyAKICAgIC8vICMgICAgIGFzc2VydCAoCiAgICAvLyAjICAgICAgICAgbmV3X21hcmtldC5tYXhfdG90YWxfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAjICAgICAgICAgPj0gbmV3X21hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgc2NhbGVkX2Ftb3VudAogICAgLy8gIyAgICAgKSwgIkRlcG9zaXQgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAjICAgICAjIE9ubHkgaW5jcmVtZW50IG1hcmtldCB0b3RhbCBkZXBvc2l0cywgbm90IHVzZXIgZGVwb3NpdHMgc2luY2UgcG9zaXRpb24gaXMgbm90IHRyYWNrZWQKICAgIC8vICMgICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICBOVG9rZW4ubWludCwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksCiAgICAvLyAjICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAjICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG5ld19tYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICAgICBNaW50RXZlbnQoCiAgICAvLyAjICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwgYXJjNC5VSW50MjU2KGFtb3VudCksIGFyYzQuVUludDY0KG1hcmtldF9pZCkKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgICAgICB1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKS5jb3B5KCkKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9PSAwIGFuZCB1c2VyLnNjYWxlZF9ib3Jyb3dzID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgICAgIGRlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgIyBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgaWYgdXNlciBkb2Vzbid0IGhhdmUgYSBwcmV2aW91cyBwcmljZQogICAgLy8gICAgICAgICBwcmljZV9mb3Jfb2xkID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgICAgIGVsc2UgbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIG9sZF9kZXBvc2l0X3ZhbHVlID0gKGRlcG9zaXRfYW1vdW50ICogcHJpY2VfZm9yX29sZCkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X2RlcG9zaXRfdmFsdWUgPSAoZGVwb3NpdF9hbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgICAgICAgICB1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF9kZXBvc2l0X3ZhbHVlLCBuZXdfZGVwb3NpdF92YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgICAgIGJvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgIyBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgaWYgdXNlciBkb2Vzbid0IGhhdmUgYSBwcmV2aW91cyBwcmljZQogICAgLy8gICAgICAgICBwcmljZV9mb3Jfb2xkID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgICAgIGVsc2UgbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIG9sZF9ib3Jyb3dfdmFsdWUgPSAoYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld19ib3Jyb3dfdmFsdWUgPSAoYm9ycm93X2Ftb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICAgICAgICAgIHVzZXJfaWQsIG1hcmtldF9pZCwgb2xkX2JvcnJvd192YWx1ZSwgbmV3X2JvcnJvd192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfZ2xvYmFsX3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBHbG9iYWxVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfZ2xvYmFsX3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gR2xvYmFsVXNlckRhdGE6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLmdsb2JhbF91c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9nbG9iYWxfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIGdsb2JhbF91c2VyCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZSA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnNbdXNlcl9pZF0gPSBnbG9iYWxfdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBtYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBvbGRfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyAgICAgbmV3X3ZhbHVlOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICAvLyAKICAgIC8vICAgICBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnNbdXNlcl9pZF0gPSBnbG9iYWxfdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgbGlxdWlkYXRlX2Nyb3NzX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIGRlYnRfbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgdXNlcjogYXJjNC5BZGRyZXNzLAogICAgLy8gICAgIGRlYnRfYW1vdW50OiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQ6IGFyYzQuVUludDI1NiwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDQ5MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgU3luYyBnbG9iYWwgdXNlciB2YWx1ZXMgZm9yIGJvdGggbWFya2V0cyB0byBpbmNsdWRlIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgICAgIHVzZXIubmF0aXZlLCBkZWJ0X21hcmtldF9pZC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fbGlxdWlkYXRlX2Nyb3NzX21hcmtldCgKICAgIC8vICAgICAgICAgZGVidF9tYXJrZXRfaWQubmF0aXZlLAogICAgLy8gICAgICAgICBjb2xsYXRlcmFsX21hcmtldF9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgIFR4bi5zZW5kZXIsCiAgICAvLyAgICAgICAgIHVzZXIubmF0aXZlLAogICAgLy8gICAgICAgICBkZWJ0X2Ftb3VudC5uYXRpdmUsCiAgICAvLyAgICAgICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkLm5hdGl2ZSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRvcl9pZDogQWNjb3VudCwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGRlYnRfYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIExpcXVpZGF0ZSBhIHVzZXIncyB1bmRlcmNvbGxhdGVyYWxpemVkIHBvc2l0aW9uIGFjcm9zcyBkaWZmZXJlbnQgbWFya2V0cy4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIGFsbG93cyBhIGxpcXVpZGF0b3IgdG8gcmVwYXkgYSBwb3J0aW9uIG9mIGEgdXNlcidzIGRlYnQgaW4gb25lIG1hcmtldAogICAgLy8gICAgIGFuZCByZWNlaXZlIGNvbGxhdGVyYWwgZnJvbSBhbm90aGVyIG1hcmtldCBhcyBjb21wZW5zYXRpb24uIFRoZSBsaXF1aWRhdGlvbiBpbmNsdWRlcwogICAgLy8gICAgIGEgYm9udXMgdG8gaW5jZW50aXZpemUgbGlxdWlkYXRvcnMgYW5kIGhlbHBzIG1haW50YWluIHByb3RvY29sIGhlYWx0aCBieSByZW1vdmluZwogICAgLy8gICAgIHVuZGVyY29sbGF0ZXJhbGl6ZWQgcG9zaXRpb25zLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgZGVidF9tYXJrZXRfaWQ6IFRoZSBtYXJrZXQgSUQgd2hlcmUgdGhlIGRlYnQgdG8gYmUgcmVwYWlkIGV4aXN0cwogICAgLy8gICAgICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogVGhlIG1hcmtldCBJRCB3aGVyZSBjb2xsYXRlcmFsIHdpbGwgYmUgc2VpemVkIGZyb20KICAgIC8vICAgICAgICAgbGlxdWlkYXRvcl9pZDogVGhlIGFjY291bnQgcGVyZm9ybWluZyB0aGUgbGlxdWlkYXRpb24KICAgIC8vICAgICAgICAgdXNlcl9pZDogVGhlIGFjY291bnQgYmVpbmcgbGlxdWlkYXRlZAogICAgLy8gICAgICAgICBkZWJ0X2Ftb3VudDogVGhlIGFtb3VudCBvZiBkZWJ0IHRvIHJlcGF5IChtdXN0IGluY2x1ZGUgYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vICAgICAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQ6IE1pbmltdW0gY29sbGF0ZXJhbCBhbW91bnQgdGhlIGxpcXVpZGF0b3IgZXhwZWN0cyB0byByZWNlaXZlCiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiBhbnkgdmFsaWRhdGlvbiBmYWlscywgaW5jbHVkaW5nOgogICAgLy8gICAgICAgICAgICAgLSBVc2luZyBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgKGJvcnJvdy1vbmx5IG1hcmtldCkKICAgIC8vICAgICAgICAgICAgIC0gQXR0ZW1wdGluZyBzZWxmLWxpcXVpZGF0aW9uCiAgICAvLyAgICAgICAgICAgICAtIE1hcmtldCBkb2Vzbid0IGV4aXN0IG9yIGlzIHBhdXNlZAogICAgLy8gICAgICAgICAgICAgLSBQb3NpdGlvbiBpcyBub3QgbGlxdWlkYXRhYmxlIChoZWFsdGggZmFjdG9yID49IDEuMCkKICAgIC8vICAgICAgICAgICAgIC0gTGlxdWlkYXRpb24gYW1vdW50IGV4Y2VlZHMgbWF4aW11bSBhbGxvd2VkIG9yIHRvdGFsIGRlYnQKICAgIC8vICAgICAgICAgICAgIC0gSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgdG8gc2VpemUKICAgIC8vICAgICAgICAgICAgIC0gQ29sbGF0ZXJhbCByZWNlaXZlZCBiZWxvdyBtaW5pbXVtIHRocmVzaG9sZAogICAgLy8gCiAgICAvLyAgICAgTm90ZXM6CiAgICAvLyAgICAgICAgIC0gVXNlcyB0aGUgY29sbGF0ZXJhbCBtYXJrZXQncyBsaXF1aWRhdGlvbiB0aHJlc2hvbGQgZm9yIGhlYWx0aCBjYWxjdWxhdGlvbgogICAgLy8gICAgICAgICAtIExpcXVpZGF0aW9uIGJvbnVzIGlzIGFwcGxpZWQgdG8gaW5jZW50aXZpemUgbGlxdWlkYXRvcnMKICAgIC8vICAgICAgICAgLSBBY2NydWVkIGludGVyZXN0IG9uIGJvdGggZGVidCBhbmQgY29sbGF0ZXJhbCBwb3NpdGlvbnMgaXMgaW5jbHVkZWQKICAgIC8vICAgICAgICAgLSBIYW5kbGVzIGRpZmZlcmVudCB0b2tlbiB0eXBlcyAoQVJDMjAwIHZzIFNUb2tlbikgYXBwcm9wcmlhdGVseQogICAgLy8gICAgICAgICAtIFVwZGF0ZXMgZ2xvYmFsIGJvcnJvdyBhbmQgY29sbGF0ZXJhbCB2YWx1ZXMgZm9yIHRoZSB1c2VyCiAgICAvLyAgICAgIiIiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBsaXF1aWRhdGUgb3BlcmF0aW9uCiAgICAvLyAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICAgICBkZWJ0X21hcmtldF9pZAogICAgLy8gICAgICkubGlxdWlkYXRlLm5hdGl2ZQogICAgLy8gICAgIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgZGVidF9hbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIkxpcXVpZGF0ZSBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIFJFTSBwcmV2ZW50IHVzaW5nIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCBpbiBsaXF1aWRhdGlvbiBiZWNhdXNlIHN0b2tlbgogICAgLy8gICAgICMgUkVNIG1hcmtldCBjb2xsYXRlcmFsIGRvZXMgbm90IGV4aXN0CiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQgIT0gc2VsZi5zdG9rZW5fYXBwX2lkCiAgICAvLyAgICAgKSwgIkNhbm5vdCB1c2Ugc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIChib3Jyb3ctb25seSBtYXJrZXQpIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBSRU0gcHJldmVudCBzZWxmIGxpcXVpZGF0aW9uCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgYXNzZXJ0IHVzZXJfaWQgIT0gbGlxdWlkYXRvcl9pZCwgIkNhbm5vdCBsaXF1aWRhdGUgc2VsZiIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCBkZWJ0X21hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJEZWJ0IG1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgY29sbGF0ZXJhbF9tYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiQ29sbGF0ZXJhbCBtYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBmcmFtZV9kaWcgLTUKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY5CiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2OS0yNDg4CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1iInN0b3JhZ2VfYXBwX2lkIikKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID49IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+PSBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPj0gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc29tZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9YiJzdG9yYWdlX2FwcF9pZCIpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKHNlbGYsIG9wZXJhdG9yX2lkOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Iob3BlcmF0b3JfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfYXV0aG9yaXplZF9wcmljZV9vcGVyYXRvcihzZWxmLCBvcGVyYXRvcl9pZDogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3ggPSBCb3goYXJjNC5BZGRyZXNzLCBrZXk9YiJhdXRob3JpemVkX3ByaWNlX29wZXJhdG9yIikKICAgIC8vICAgICBvcGVyYXRvcl9pZF9ib3gudmFsdWUgPSBhcmM0LkFkZHJlc3Mob3BlcmF0b3JfaWQpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgQXV0aG9yaXplZFByaWNlT3BlcmF0b3JTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3I9YXJjNC5BZGRyZXNzKG9wZXJhdG9yX2lkKQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gQWNjb3VudDoKICAgIC8vICAgICBvcGVyYXRvcl9pZCA9IEJveChhcmM0LkFkZHJlc3MsIGtleT1iImF1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IiKQogICAgLy8gICAgIHJldHVybiBvcGVyYXRvcl9pZC5nZXQoZGVmYXVsdD1hcmM0LkFkZHJlc3Moc2VsZi5vd25lcikpLm5hdGl2ZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3Ioc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyID09IHNlbGYuX2dldF9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICAgICAgb3IgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyCiAgICAvLyAgICAgKSwgIm9ubHkgYXV0aG9yaXplZCBwcmljZSBvcGVyYXRvciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3BlcmF0b3IoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29wZXJhdG9yKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMTAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTUKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBwYXltZW50IDw9IDEwMDAwMDAKICAgIC8vICAgICApLCAicGF5bWVudCBleGNlZWRzIG1heGltdW0gZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTYKICAgIC8vICAgICBhcHAgPSBBcHBsaWNhdGlvbihzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gICAgIGl0eG4uUGF5bWVudChyZWNlaXZlcj1hcHAuYWRkcmVzcywgYW1vdW50PXBheW1lbnQsIGZlZT0wKS5zdWJtaXQoKQogICAgLy8gICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBQcmljZUZlZWRQcm92aWRlckludGVyZmFjZS5nZXRfcHJpY2Vfd2l0aF90aW1lc3RhbXAsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWFwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgICAgID4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICk6CiAgICAvLyAgICAgICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wID0gKAogICAgLy8gICAgICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAuY29weSgpCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZCwgcHJpY2Vfd2l0aF90aW1lc3RhbXAucHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBjb21tZW50ZWQgb3V0CiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBhc3NlcnQgdG9rZW5faWQubmF0aXZlIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAjICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NgogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfbWF4X3RvdGFsX2RlcG9zaXRzKHRva2VuX2lkLm5hdGl2ZSwgbWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9tYXhfdG90YWxfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWF4X3RvdGFsX2RlcG9zaXRzOiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBtYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KG1heF90b3RhbF9kZXBvc2l0cykKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldE1heFRvdGFsRGVwb3NpdHNTZXQoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KG1heF90b3RhbF9kZXBvc2l0cykKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fcGF1c2VfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgcGF1c2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9wYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0ucGF1c2VkID0gYXJjNC5Cb29sKHBhdXNlID09IFVJbnQ2NCgxKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY19tYXJrZXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYWNjcnVlX2ludGVyZXN0KHNlbGYsIG1hcmtldF9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGN1cnJlbnRfdGltZSA9IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wCiAgICAvLyAgICAgdGltZV9kZWx0YSA9IGN1cnJlbnRfdGltZSAtIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lLm5hdGl2ZQogICAgLy8gICAgIGlmIHRpbWVfZGVsdGEgPD0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgIyBGb3Igc3Rva2VuIG1hcmtldCAoYm9ycm93LW9ubHkpLCB1c2UgYSBmaXhlZCB1dGlsaXphdGlvbiByYXRlIHNpbmNlIHRoZXJlIGFyZSBubyBkZXBvc2l0cwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHV0aWxpemF0aW9uID0gQmlnVUludCgxMDAwMCkgICMgMTAwJSB1dGlsaXphdGlvbiBmb3IgYm9ycm93LW9ubHkgbWFya2V0CiAgICAvLyAgICAgZWxpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgdXRpbGl6YXRpb24gPSAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDAKICAgIC8vICAgICAgICAgKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgIHJhdGUgPSBtYXJrZXQuYm9ycm93X3JhdGUubmF0aXZlICsgKG1hcmtldC5zbG9wZS5uYXRpdmUgKiB1dGlsaXphdGlvbikgLy8gMTAwMDAKICAgIC8vICAgICBpbnRlcmVzdCA9IChyYXRlICogbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHRpbWVfZGVsdGEpIC8vICgKICAgIC8vICAgICAgICAgc2VsZi5zZWNvbmRzX3Blcl95ZWFyICogMTAwMDAKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHN0b2tlbiBtYXJrZXQgLSBhbGwgaW50ZXJlc3QgZ29lcyB0byByZXNlcnZlcwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBhcmM0LlVJbnQyNTYuZnJvbV9ieXRlcyhtYXJrZXQucmVzZXJ2ZV9mYWN0b3IuYnl0ZXMpLm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIDEwMDAwCiAgICAvLyAgICAgICAgIGlmIHByb3RvY29sX3BvcnRpb24gPiBpbnRlcmVzdDoKICAgIC8vICAgICAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IGludGVyZXN0IC0gcHJvdG9jb2xfcG9ydGlvbgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChkZXBvc2l0b3JfcG9ydGlvbiAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID4gMDoKICAgIC8vICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChpbnRlcmVzdCAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGludGVyZXN0CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgZGVwb3NpdG9yX3BvcnRpb24KICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgKyBwcm90b2NvbF9wb3J0aW9uKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoY3VycmVudF90aW1lKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAgICAgcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gIyBUT0RPIGdvdmVybmFuY2U6IGNvbnNpZGVyIGlmIHJlc2VydmUgd2l0aGRyYXdhbCBzaG91bGQgcmVxdWlyZSBhZGRpdGlvbmFsCiAgICAvLyAjICAgICAgZ292ZXJuYW5jZSBtZWNoYW5pc21zCiAgICAvLyAjIFRPRE8gbWluaW11bSByZXNlcnZlIGxldmVsczogbWlnaHQgd2FudCB0byBlbmZvcmNlIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHMgZm9yCiAgICAvLyAjICAgICAgcHJvdG9jb2wgc2FmZXR5CiAgICAvLyAjIFRPRE8gZXZlbnQgZW1pc3Npb246IENvbnNpZGVyIGFkZGluZyBhbiBldmVudCB0byBsb2cgcmVzZXJ2ZSB3aXRoZHJhd2FscyBmb3IKICAgIC8vICMgICAgICB0cmFuc3BhcmVuY3kKICAgIC8vIAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBza2lwcGluZyBzdWJyb3V0aW5lIHRvIHJlZHVjZSBjb250cmFjdCBzaXplCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl93aXRoZHJhd19yZXNlcnZlcyhtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIEFjY3J1ZSBpbnRlcmVzdCBmaXJzdCB0byBnZXQgdXAtdG8tZGF0ZSByZXNlcnZlcwogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgPj0gYW1vdW50LCAiSW5zdWZmaWNpZW50IHJlc2VydmVzIgogICAgLy8gCiAgICAvLyAgICAgIyBUcmFuc2ZlciByZXNlcnZlcyB0byB0aGUgb3duZXIgKG5vdCB0byB0aGUgY29udHJhY3QgaXRzZWxmKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVcGRhdGUgcmVzZXJ2ZXMKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbigKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50LCBndWFyZF9zdG9rZW46IGJvb2wKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCBhbW91bnQgPiAwLCAiQW1vdW50IG11c3QgYmUgPiAwIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBub3QgbWFya2V0LnBhdXNlZCwgIk1hcmtldCBpcyBwYXVzZWQiCiAgICAvLyAgICAgaWYgZ3VhcmRfc3Rva2VuOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgLy8gICAgICAgICApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGZvciB0aGlzIG9wZXJhdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGVwb3NpdChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9kZXBvc2l0KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgUkVNIG1heSBhZGQgcHJvdGVjdGlvbiBmb3IgbG93IHV0aWxpc2F0aW9uIGluIGZ1dHVyZQogICAgLy8gIyBSRU0gbG93ZXIgbWF4IGRlcG9zaXQgYW1vdW50IGZvciBsb3cgdXRpbGlzYXRpb24KICAgIC8vICMgUkVNIGhpZ2ggbWF4IGRlcG9zaXQgYW1vdW50IGZvciBoaWdoIHV0aWxpc2F0aW9uCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlcG9zaXQoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBJbnRlcm5hbCBkZXBvc2l0IG1ldGhvZCB0aGF0IGhhbmRsZXMgdXNlciBkZXBvc2l0cyBpbnRvIGEgbGVuZGluZyBtYXJrZXQuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBwZXJmb3JtcyBhIGNvbXBsZXRlIGRlcG9zaXQgb3BlcmF0aW9uIGluY2x1ZGluZzoKICAgIC8vICAgICAxLiBWYWxpZGF0aW5nIHRoZSBtYXJrZXQgb3BlcmF0aW9uIChwcm90b2NvbCBub3QgcGF1c2VkLCBtYXJrZXQgZXhpc3RzLCBhbW91bnQgPiAwLCBtYXJrZXQgbm90IHBhdXNlZCkKICAgIC8vICAgICAyLiBUcmFuc2ZlcnJpbmcgQVJDMjAwIHRva2VucyBmcm9tIHVzZXIgdG8gdGhlIGxlbmRpbmcgcG9vbCBjb250cmFjdAogICAgLy8gICAgIDMuIEFjY3J1aW5nIGludGVyZXN0IG9uIHRoZSBtYXJrZXQgdG8gZ2V0IHVwZGF0ZWQgZGVwb3NpdCBpbmRleAogICAgLy8gICAgIDQuIENhbGN1bGF0aW5nIGFuZCBhZGRpbmcgZWFybmVkIGludGVyZXN0IHRvIHRoZSB1c2VyJ3MgcG9zaXRpb24KICAgIC8vICAgICA1LiBDb252ZXJ0aW5nIGRlcG9zaXQgYW1vdW50IHRvIHNjYWxlZCBkZXBvc2l0cyB1c2luZyBjdXJyZW50IGRlcG9zaXQgaW5kZXgKICAgIC8vICAgICA2LiBDaGVja2luZyBkZXBvc2l0IGNhcCBjb25zdHJhaW50cwogICAgLy8gICAgIDcuIFVwZGF0aW5nIHVzZXIgYW5kIG1hcmtldCBzY2FsZWQgZGVwb3NpdCBiYWxhbmNlcwogICAgLy8gICAgIDguIE1pbnRpbmcgTlRva2VucyB0byByZXByZXNlbnQgdGhlIHVzZXIncyBkZXBvc2l0IHBvc2l0aW9uCiAgICAvLyAgICAgOS4gVXBkYXRpbmcgZ2xvYmFsIGNvbGxhdGVyYWwgY2FsY3VsYXRpb25zIGZvciB0aGUgdXNlcgogICAgLy8gICAgIDEwLiBFbWl0dGluZyBhIE1hcmtldERlcG9zaXQgZXZlbnQKICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQgKEFjY291bnQpOiBUaGUgYWNjb3VudCBJRCBvZiB0aGUgdXNlciBtYWtpbmcgdGhlIGRlcG9zaXQKICAgIC8vICAgICAgICAgbWFya2V0X2lkIChVSW50NjQpOiBUaGUgSUQgb2YgdGhlIG1hcmtldCB0byBkZXBvc2l0IGludG8KICAgIC8vICAgICAgICAgYW1vdW50IChCaWdVSW50KTogVGhlIGFtb3VudCBvZiB1bmRlcmx5aW5nIHRva2VucyB0byBkZXBvc2l0CiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiBtYXJrZXQgdmFsaWRhdGlvbiBmYWlscywgZGVwb3NpdCBjYXAgaXMgZXhjZWVkZWQsIG9yIG90aGVyIGNvbnN0cmFpbnRzIGFyZSB2aW9sYXRlZAogICAgLy8gCiAgICAvLyAgICAgTm90ZToKICAgIC8vICAgICAgICAgLSBJbnRlcmVzdCBlYXJuZWQgc2luY2UgbGFzdCBpbnRlcmFjdGlvbiBpcyBhdXRvbWF0aWNhbGx5IGFkZGVkIHRvIHRoZSBkZXBvc2l0CiAgICAvLyAgICAgICAgIC0gU2NhbGVkIGRlcG9zaXRzIGFyZSB1c2VkIHRvIHRyYWNrIHVzZXIgcG9zaXRpb25zIGFuZCBjYWxjdWxhdGUgaW50ZXJlc3QKICAgIC8vICAgICAgICAgLSBDb2xsYXRlcmFsIHZhbHVlIGlzIHVwZGF0ZWQgdXNpbmcgZWl0aGVyIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIG9yIGN1cnJlbnQgbWFya2V0IHByaWNlCiAgICAvLyAgICAgICAgIC0gTlRva2VucyBhcmUgbWludGVkIHRvIHJlcHJlc2VudCB0aGUgdXNlcidzIGRlcG9zaXQgcG9zaXRpb24gKGFtb3VudCArIGludGVyZXN0KQogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgKS5kZXBvc2l0Lm5hdGl2ZQogICAgLy8gICAgIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJEZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApICAjIEdldCB1cGRhdGVkIG1hcmtldCB3aXRoIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBBZGQgZWFybmVkIGludGVyZXN0IHRvIHVzZXIncyBwb3NpdGlvbiBhcyBhZGRpdGlvbmFsIHNjYWxlZCBkZXBvc2l0cwogICAgLy8gICAgIGludGVyZXN0X3NjYWxlZF9hbW91bnQgPSBCaWdVSW50KDApCiAgICAvLyAgICAgaWYgaW50ZXJlc3QgPiAwOgogICAgLy8gICAgICAgICBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBTQ0FMRQogICAgLy8gICAgICAgICApIC8vIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIGFtb3VudCAqIFNDQUxFCiAgICAvLyAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgLy8gCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2Ftb3VudCA9IHNjYWxlZF9hbW91bnQgKyBpbnRlcmVzdF9zY2FsZWRfYW1vdW50CiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0Lm1heF90b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgPj0gbmV3X21hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgdG90YWxfc2NhbGVkX2Ftb3VudAogICAgLy8gICAgICksICJNYXJrZXQgZGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIHVzZXJfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50ICsgaW50ZXJlc3QpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2RlcG9zaXRfYW1vdW50ID0gb2xkX2RlcG9zaXRfYW1vdW50ICsgYW1vdW50ICsgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgIyBGYWxsYmFjazogVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIHRvIHByZXZlbnQgbmVnYXRpdmUgY29sbGF0ZXJhbAogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSA9IChuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICAjIE5vcm1hbCBjYXNlOiBVc2UgdXNlcidzIGxhc3QgcmVjb3JkZWQgcHJpY2UgZm9yIGFjY3VyYXRlIGNvbGxhdGVyYWwgcmVkdWN0aW9uCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIGRlcG9zaXQgb3BlcmF0aW9uCiAgICAvLyAgICAgdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC50b3RhbF9kZXBvc2l0cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApLCAiVXNlciBkZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF92YWx1ZSwgbmV3X3ZhbHVlKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0RGVwb3NpdCgKICAgIC8vICAgICAjICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLCBhcmM0LlVJbnQyNTYoYW1vdW50KQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGNhbGN1bGF0ZV91c2VyX2ludGVyZXN0KAogICAgLy8gIyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyAjICkgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAjICAgICByZXR1cm4gYXJjNC5VSW50MjU2KAogICAgLy8gIyAgICAgICAgIHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgaW50ZXJlc3QiIiIKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgdW5kZXJseWluZyBhbW91bnQKICAgIC8vICAgICB1c2VyX3RvdGFsX3VuZGVybHlpbmcgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIEludGVyZXN0IGlzIHRoZSBkaWZmZXJlbmNlIGZyb20gdGhlIHNjYWxlZCBkZXBvc2l0cyAod2hpY2ggcmVwcmVzZW50IHRoZSAiYmFzZSIgYW1vdW50KQogICAgLy8gICAgIGludGVyZXN0ID0gdXNlcl90b3RhbF91bmRlcmx5aW5nIC0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gaW50ZXJlc3QKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGNhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAjICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICMgKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAjICAgICBlbnN1cmVfYnVkZ2V0KDcwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICMgICAgIHJldHVybiBhcmM0LlVJbnQyNTYoCiAgICAvLyAjICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBkZWJ0IGludGVyZXN0IiIiCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIHVuZGVybHlpbmcgZGVidCBhbW91bnQKICAgIC8vICAgICB1c2VyX3RvdGFsX2RlYnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgb3JpZ2luYWwgcHJpbmNpcGFsIGFtb3VudCB1c2luZyB1c2VyJ3MgYm9ycm93X2luZGV4CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIncyBib3Jyb3dfaW5kZXggaXMgMCwgdXNlIGN1cnJlbnQgbWFya2V0IGJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXJfYm9ycm93X2luZGV4ID0gKAogICAgLy8gICAgICAgICB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBvcmlnaW5hbF9wcmluY2lwYWwgPSAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyX2JvcnJvd19pbmRleCkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRvdGFsIGRlYnQgYW5kIG9yaWdpbmFsIHByaW5jaXBhbAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSB1c2VyX3RvdGFsX2RlYnQgLSBvcmlnaW5hbF9wcmluY2lwYWwKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHdpdGhkcmF3KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyMTAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gCiAgICAvLyAgICAgIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgd2l0aGRyYXduIGZyb20gdG8gdXBkYXRlIGdsb2JhbCB2YWx1ZXMgd2l0aCBpbnRlcmVzdAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDI1NihzZWxmLl93aXRoZHJhdyhUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXcoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFdpdGhkcmF3IHRva2VucyBmcm9tIGEgbGVuZGluZyBtYXJrZXQgYnkgYnVybmluZyBuVG9rZW5zLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgaGFuZGxlcyB0aGUgd2l0aGRyYXdhbCBwcm9jZXNzIGJ5OgogICAgLy8gICAgIDEuIFZhbGlkYXRpbmcgdGhlIG1hcmtldCBvcGVyYXRpb24gYW5kIHVzZXIgYmFsYW5jZQogICAgLy8gICAgIDIuIEFjY3J1aW5nIGludGVyZXN0IHRvIGdldCB0aGUgbGF0ZXN0IG1hcmtldCBzdGF0ZQogICAgLy8gICAgIDMuIENhbGN1bGF0aW5nIHVzZXIncyBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgNC4gUGVyZm9ybWluZyBoZWFsdGggY2hlY2tzIHRvIGVuc3VyZSB3aXRoZHJhd2FsIGRvZXNuJ3QgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgIDUuIEJ1cm5pbmcgblRva2VucyBhbmQgdHJhbnNmZXJyaW5nIHVuZGVybHlpbmcgdG9rZW5zIHRvIHVzZXIKICAgIC8vICAgICA2LiBVcGRhdGluZyBnbG9iYWwgY29sbGF0ZXJhbCB2YWx1ZXMKICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIHdpdGhkcmF3aW5nIHRva2VucwogICAgLy8gICAgICAgICBtYXJrZXRfaWQ6IFRoZSBJRCBvZiB0aGUgbWFya2V0IHRvIHdpdGhkcmF3IGZyb20KICAgIC8vICAgICAgICAgYW1vdW50OiBUaGUgYW1vdW50IG9mIG5Ub2tlbnMgdG8gYnVybiAobm90IHRoZSB1bmRlcmx5aW5nIHRva2VuIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAgIFJldHVybnM6CiAgICAvLyAgICAgICAgIEJpZ1VJbnQ6IFRoZSB0b3RhbCBhbW91bnQgb2YgdW5kZXJseWluZyB0b2tlbnMgdHJhbnNmZXJyZWQgdG8gdGhlIHVzZXIKICAgIC8vICAgICAgICAgICAgICAgICAoaW5jbHVkZXMgYm90aCB0aGUgd2l0aGRyYXduIGFtb3VudCBhbmQgYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIHVzZXIgaGFzIGluc3VmZmljaWVudCBiYWxhbmNlIG9yIHdpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciB3aXRoZHJhdyBvcGVyYXRpb24KICAgIC8vICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gICAgICkud2l0aGRyYXcubmF0aXZlCiAgICAvLyAgICAgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIldpdGhkcmF3IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgYW1vdW50IGlzIHRoZSBhbW91bnQgb2YgblRva2VucyBiZWluZyBidXJuZWQKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBhbW91bnQgPD0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgICMgaGVhbHRoIGNoZWNrOiBlbnN1cmUgd2l0aGRyYXcgd291bGQgbm90IHB1dCBib3Jyb3dzIGF0IHJpc2sKICAgIC8vICAgICBpZiBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPiAwOgogICAgLy8gICAgICAgICAjIHZhbHVlIG9mIHVuZGVybHlpbmcgYW1vdW50IHRvIHdpdGhkcmF3IHVzaW5nIG5ldyBtYXJrZXQgcHJpY2UKICAgIC8vICAgICAgICAgd2l0aGRyYXdfdmFsdWUgPSAoYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsID0gKAogICAgLy8gICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSB3aXRoZHJhd192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIGFzc2VydCBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIDw9ICgKICAgIC8vICAgICAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsICogQmlnVUludChuZXdfbWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICAgICAgICAgKSAvLyBCaWdVSW50KDEwMDAwKSwgIldpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzayIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCB1c2VyX2lkLCBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19kZXBvc2l0X2Ftb3VudCA9IG9sZF9kZXBvc2l0X2Ftb3VudCArIGludGVyZXN0IC0gYW1vdW50CiAgICAvLyAKICAgIC8vICAgICBhbW91bnRfdXNkX3ZhbHVlID0gKGFtb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHVzZXIgY2FwIGZvciB3aXRoZHJhdyBvcGVyYXRpb24KICAgIC8vICAgICB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgIGlmIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPT0gMDoKICAgIC8vICAgICAgICAgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wICsgODY0MDApCiAgICAvLyAgICAgZWxpZiB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lIDwgR2xvYmFsLmxhdGVzdF90aW1lc3RhbXA6CiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KDApCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX2xpcXVpZGF0aW9ucyA9IGFyYzQuVUludDI1NigwKQogICAgLy8gICAgICAgICB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC5kYWlseV93aXRoZHJhd2Fscy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBuZXdfdG90YWxfd2l0aGRyYXdhbHMgPSB1c2VyX2NhcC50b3RhbF93aXRoZHJhd2Fscy5uYXRpdmUgKyBhbW91bnRfdXNkX3ZhbHVlCiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICBuZXdfdG90YWxfd2l0aGRyYXdhbHMgPD0gdXNlcl9jYXAuZGFpbHlfd2l0aGRyYXdhbHMubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIHdpdGhkcmF3IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYobmV3X3RvdGFsX3dpdGhkcmF3YWxzKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZCwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgICMgRmFsbGJhY2s6IFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSB0byBwcmV2ZW50IG5lZ2F0aXZlIGNvbGxhdGVyYWwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgIyBOb3JtYWwgY2FzZTogVXNlIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIGZvciBhY2N1cmF0ZSBjb2xsYXRlcmFsIHJlZHVjdGlvbgogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIEVtaXQgZXZlbnRzCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0V2l0aGRyYXcoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgYXJjNC5VSW50NjQobWFya2V0X2lkKSwgYXJjNC5VSW50MjU2KGFtb3VudCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gYW1vdW50ICsgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gIyB3aXRoZHJhdyBjb3N0IDkwMDAwMAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBib3Jyb3coc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyODAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gCiAgICAvLyAgICAgIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgYm9ycm93ZWQgZnJvbSB0byB1cGRhdGUgZ2xvYmFsIHZhbHVlcyB3aXRoIGludGVyZXN0CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9ib3Jyb3coVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYm9ycm93KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBib3Jyb3cgb3BlcmF0aW9uCiAgICAvLyAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApLmJvcnJvdy5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KHVzZXJfaWQpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gVUludDY0KDEwMDAwMCksICJQYXltZW50IGFtb3VudCBtdXN0IGJlID49IDAuMSIKICAgIC8vIAogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGN1cnJlbnQgbWFya2V0IHRvdGFsIGJvcnJvd3MgKGluY2x1ZGluZyBpbnRlcmVzdCkKICAgIC8vICAgICBjdXJyZW50X21hcmtldF90b3RhbF9ib3Jyb3dzID0gKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIGFtb3VudCBiZWluZyBhZGRlZCAobmV3IGJvcnJvdyArIGRlYnQgaW50ZXJlc3QpCiAgICAvLyAgICAgIyBkZWJ0IGludGVyZXN0IGFkZGVkIGF0IHRoaXMgcG9pbnQgdG8gcHJldmVudCB1bm5lY2Vzc2FyeSBkZWJ0IHJlc2V0CiAgICAvLyAgICAgdG90YWxfYW1vdW50X3RvX2FkZCA9IGFtb3VudCArIGRlYnRfaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgICMgVmFsaWRhdGUgYWdhaW5zdCBtYXJrZXQtd2lkZSBib3Jyb3cgY2FwCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbmV3X21hcmtldC5tYXhfdG90YWxfYm9ycm93cy5uYXRpdmUKICAgIC8vICAgICAgICAgPj0gY3VycmVudF9tYXJrZXRfdG90YWxfYm9ycm93cyArIHRvdGFsX2Ftb3VudF90b19hZGQKICAgIC8vICAgICApLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgY29sbGF0ZXJhbCByZXF1aXJlbWVudHMgLSBleGNsdWRlIHNhbWUgbWFya2V0IGNvbGxhdGVyYWwgdG8gcHJldmVudAogICAgLy8gICAgICMgaW5lZmZpY2llbnQgc2FtZS1hc3NldCBib3Jyb3dpbmcKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgbmV3X2JvcnJvd192YWx1ZSA9ICh0b3RhbF9hbW91bnRfdG9fYWRkICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgdG90YWxfYm9ycm93X3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSArIG5ld19ib3Jyb3dfdmFsdWUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IEJpZ1VJbnQoMCk6CiAgICAvLyAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICAgICAjIFVzZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgZXhjbHVkZWRfdmFsdWUgPSAoZGVwb3NpdGVkX2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBpZiBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSA+IGV4Y2x1ZGVkX3ZhbHVlOgogICAgLy8gICAgICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSAoCiAgICAvLyAgICAgICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBleGNsdWRlZF92YWx1ZQogICAgLy8gICAgICAgICAgICAgKQogICAgLy8gICAgICAgICBlbHNlOgogICAgLy8gICAgICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSBCaWdVSW50KDApCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgdG90YWxfYm9ycm93X3ZhbHVlIDw9ICgKICAgIC8vICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgKiBCaWdVSW50KG5ld19tYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgLy8gICAgICkgLy8gQmlnVUludCgxMDAwMCksICJJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCBhY3Jvc3MgbWFya2V0cyIKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHNjYWxlZCBhbW91bnQgZm9yIHRoZSB0b3RhbAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAodG90YWxfYW1vdW50X3RvX2FkZCAqIFNDQUxFKSAvLyBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBvbGRfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgLy8gU0NBTEUKICAgIC8vICAgICApCiAgICAvLyAgICAgbmV3X2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgICAgICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgaWYgdXNlciBkb2Vzbid0IGhhdmUgYSBwcmV2aW91cyBwcmljZQogICAgLy8gICAgIHByaWNlX2Zvcl9vbGQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBwcmljZV9mb3JfbmV3ID0gbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIG9sZF92YWx1ZSA9IChvbGRfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X3ZhbHVlID0gKG5ld19ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX25ldykgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3IgYm9ycm93IG9wZXJhdGlvbgogICAgLy8gICAgIHVzZXJfY2FwID0gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9jYXAudG90YWxfYm9ycm93cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIGJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlLCAgIyBvbGQgVVNEIHZhbHVlCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSwgICMgbmV3IFVTRCB2YWx1ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgaWYgc3Rva2VuLCBtaW50IHN0b2tlbgogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBTVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICAgICAgcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgLy8gICAgICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgIyBpZiBhVG9rZW4sIHRyYW5zZmVyIGFUb2tlbgogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRCb3Jyb3coCiAgICAvLyAgICAgIyAgICAgICAgIHVzZXI9YXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICMgICAgICAgICB0b2tlbl9pZD1hcmM0LlVJbnQ2NChtYXJrZXRfaWQpLAogICAgLy8gICAgICMgICAgICAgICBhbW91bnQ9YXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiByZXBheShzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fcmVwYXkoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBSZXBheSBib3Jyb3dlZCB0b2tlbnMgZm9yIGEgc3BlY2lmaWMgbWFya2V0LgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgaGFuZGxlcyB0aGUgcmVwYXltZW50IG9mIGJvcnJvd2VkIHRva2VucyB3aXRoIGEgbWluaW11bSBpbnRlcmVzdAogICAgLy8gICAgIHJlcXVpcmVtZW50LiBJdCBzdXBwb3J0cyBib3RoIHNUb2tlbiAoYnVybikgYW5kIGFUb2tlbiAodHJhbnNmZXIpIG1hcmtldHMuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgdXNlciBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIG1hcmtldF9pZDogVGhlIG1hcmtldCBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIGFtb3VudDogVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gcmVwYXkgKG11c3QgYmUgPj0gYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIG1hcmtldCB2YWxpZGF0aW9uIGZhaWxzLCByZXBheSBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0LAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgIHJlcGF5IGFtb3VudCBpcyBsZXNzIHRoYW4gYWNjcnVlZCBpbnRlcmVzdCwgb3IgcHJpbmNpcGFsCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgcmVwYXltZW50IGV4Y2VlZHMgc2NhbGVkIGRlYnQKICAgIC8vIAogICAgLy8gICAgIFByb2Nlc3M6CiAgICAvLyAgICAgICAgIDEuIFZhbGlkYXRlcyBtYXJrZXQgb3BlcmF0aW9uIGFuZCBhY2NydWVzIGludGVyZXN0CiAgICAvLyAgICAgICAgIDIuIENhbGN1bGF0ZXMgdG90YWwgZGVidCBpbmNsdWRpbmcgYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gICAgICAgICAzLiBWYWxpZGF0ZXMgcmVwYXkgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vICAgICAgICAgNC4gUmVxdWlyZXMgbWluaW11bSByZXBheW1lbnQgb2YgYXQgbGVhc3QgdGhlIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICAgICAgICAgNS4gQ2FsY3VsYXRlcyBwcmluY2lwYWwgcmVwYXltZW50IChhbW91bnQgLSBpbnRlcmVzdCkKICAgIC8vICAgICAgICAgNi4gQnVybnMgc1Rva2VucyBvciB0cmFuc2ZlcnMgYVRva2VucyBmcm9tIHVzZXIKICAgIC8vICAgICAgICAgNy4gVXBkYXRlcyB1c2VyIGFuZCBtYXJrZXQgc2NhbGVkIGJvcnJvdyBhbW91bnRzIChwcmluY2lwYWwgb25seSkKICAgIC8vICAgICAgICAgOC4gVXBkYXRlcyBnbG9iYWwgYm9ycm93IHZhbHVlIHRyYWNraW5nIHdpdGggcHJvcGVyIHByaWNlIGhhbmRsaW5nCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIGRlYnQgaW5jbHVkaW5nIGludGVyZXN0CiAgICAvLyAgICAgdW5zY2FsZWRfYm9ycm93cyA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgdG90YWxfZGVidCA9IHVuc2NhbGVkX2JvcnJvd3MgKyBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIFZhbGlkYXRlIHJlcGF5IGFtb3VudCBkb2Vzbid0IGV4Y2VlZCB0b3RhbCBkZWJ0CiAgICAvLyAgICAgYXNzZXJ0IGFtb3VudCA8PSB0b3RhbF9kZWJ0LCAiUmVwYXkgYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidCIKICAgIC8vIAogICAgLy8gICAgICMgUmVxdWlyZSBtaW5pbXVtIHJlcGF5bWVudCBvZiBhdCBsZWFzdCB0aGUgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGFtb3VudCA+PSBkZWJ0X2ludGVyZXN0CiAgICAvLyAgICAgKSwgIlJlcGF5IGFtb3VudCBtdXN0IGJlIGF0IGxlYXN0IHRoZSBhY2NydWVkIGludGVyZXN0IgogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgaG93IG11Y2ggZ29lcyB0b3dhcmQgcHJpbmNpcGFsIHJlcGF5bWVudAogICAgLy8gICAgIHByaW5jaXBhbF9yZXBheW1lbnQgPSBhbW91bnQgLSBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBzY2FsZWQgYW1vdW50IGZvciBwcmluY2lwYWwgcmVwYXltZW50IG9ubHkKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gKHByaW5jaXBhbF9yZXBheW1lbnQgKiBTQ0FMRSkgLy8gbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgYXNzZXJ0IHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IHNjYWxlZF9hbW91bnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyBkZWJ0IgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCB1c2VyX2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gICAgIG5ld19ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgICAgICAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAvLyBTQ0FMRQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICBwcmljZV9mb3Jfb2xkID0gKAogICAgLy8gICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgcHJpY2VfZm9yX25ldyA9IG5ld19tYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICBvbGRfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld192YWx1ZSA9IChuZXdfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9uZXcpIC8vIFNDQUxFCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRSZXBheSgKICAgIC8vICAgICAjICAgICAgICAgdXNlcj1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NChtYXJrZXRfaWQpLAogICAgLy8gICAgICMgICAgICAgICBhbW91bnQ9YXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyAjIG1pbnQvcmVkZWVtIHJlbGF0ZWQgY29kZQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgcmVkZWVtKHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gIyAgICAgc2VsZi5fcmVkZWVtKG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9yZWRlZW0oc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICMgICAgIGFzc2VydCBub3Qgc2VsZi5faGFzX3Bvc2l0aW9uKAogICAgLy8gIyAgICAgICAgIFR4bi5zZW5kZXIsIG1hcmtldF9pZAogICAgLy8gIyAgICAgKSwgIkNhbm5vdCBtaW50L3JlZGVlbSB3aGVuIHVzZXIgaGFzIHRyYWNrZWQgZGVwb3NpdCBwb3NpdGlvbiIKICAgIC8vIAogICAgLy8gIyAgICAgbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBzY2FsZWRfYW1vdW50ID0gKGFtb3VudCAqIFNDQUxFKSAvLyBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICMgICAgIGFzc2VydCAoCiAgICAvLyAjICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gc2NhbGVkX2Ftb3VudAogICAgLy8gIyAgICAgKSwgIkluc3VmZmljaWVudCBtYXJrZXQgZGVwb3NpdHMgdG8gcmVkZWVtIgogICAgLy8gIyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksCiAgICAvLyAjICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAjICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBtaW50KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fbWludChtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfbWludChzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIC8vIAogICAgLy8gIyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9oYXNfcG9zaXRpb24oCiAgICAvLyAjICAgICAgICAgVHhuLnNlbmRlciwgbWFya2V0X2lkCiAgICAvLyAjICAgICApLCAiQ2Fubm90IG1pbnQvcmVkZWVtIHdoZW4gdXNlciBoYXMgdHJhY2tlZCBkZXBvc2l0IHBvc2l0aW9uIgogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gIyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdCgKICAgIC8vICMgICAgICAgICBtYXJrZXRfaWQKICAgIC8vICMgICAgICkgICMgR2V0IHVwZGF0ZWQgbWFya2V0IHdpdGggYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gIyAgICAgc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICMgICAgICAgICBhbW91bnQgKiBTQ0FMRQogICAgLy8gIyAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgLy8gCiAgICAvLyAjICAgICBhc3NlcnQgKAogICAgLy8gIyAgICAgICAgIG5ld19tYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gIyAgICAgICAgID49IG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQKICAgIC8vICMgICAgICksICJEZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gIyAgICAgIyBPbmx5IGluY3JlbWVudCBtYXJrZXQgdG90YWwgZGVwb3NpdHMsIG5vdCB1c2VyIGRlcG9zaXRzIHNpbmNlIHBvc2l0aW9uIGlzIG5vdCB0cmFja2VkCiAgICAvLyAjICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gIyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAgICAgTWludEV2ZW50KAogICAgLy8gIyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksIGFyYzQuVUludDI1NihhbW91bnQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICAgICAgdXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkuY29weSgpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMgPT0gMCBhbmQgdXNlci5zY2FsZWRfYm9ycm93cyA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBkZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgICAgICBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBvbGRfZGVwb3NpdF92YWx1ZSA9IChkZXBvc2l0X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld19kZXBvc2l0X3ZhbHVlID0gKGRlcG9zaXRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICAgICAgdXNlcl9pZCwgbWFya2V0X2lkLCBvbGRfZGVwb3NpdF92YWx1ZSwgbmV3X2RlcG9zaXRfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgICAgICBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBvbGRfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgICAgICB1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF9ib3Jyb3dfdmFsdWUsIG5ld19ib3Jyb3dfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gR2xvYmFsVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IEdsb2JhbFVzZXJEYXRhOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi5nbG9iYWxfdXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PWIic3RvcmFnZV9hcHBfaWQiKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBnbG9iYWxfdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfZ2xvYmFsX3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBnbG9iYWxfdXNlcgogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIG1hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIG9sZF92YWx1ZTogQmlnVUludCwKICAgIC8vICAgICBuZXdfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gb2xkX3ZhbHVlICsgbmV3X3ZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gICAgIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIC0gb2xkX3ZhbHVlICsgbmV3X3ZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gICAgIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGxpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHVzZXI6IGFyYzQuQWRkcmVzcywKICAgIC8vICAgICBkZWJ0X2Ftb3VudDogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBhcmM0LlVJbnQyNTYsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCg0OTAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIFN5bmMgZ2xvYmFsIHVzZXIgdmFsdWVzIGZvciBib3RoIG1hcmtldHMgdG8gaW5jbHVkZSBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgZGVidF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICAgICAgdXNlci5uYXRpdmUsIGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgICAgIGRlYnRfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlLAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyLAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwKICAgIC8vICAgICAgICAgZGVidF9hbW91bnQubmF0aXZlLAogICAgLy8gICAgICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZC5uYXRpdmUsCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9saXF1aWRhdGVfY3Jvc3NfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgZGVidF9tYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0b3JfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBkZWJ0X2Ftb3VudDogQmlnVUludCwKICAgIC8vICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBMaXF1aWRhdGUgYSB1c2VyJ3MgdW5kZXJjb2xsYXRlcmFsaXplZCBwb3NpdGlvbiBhY3Jvc3MgZGlmZmVyZW50IG1hcmtldHMuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBhbGxvd3MgYSBsaXF1aWRhdG9yIHRvIHJlcGF5IGEgcG9ydGlvbiBvZiBhIHVzZXIncyBkZWJ0IGluIG9uZSBtYXJrZXQKICAgIC8vICAgICBhbmQgcmVjZWl2ZSBjb2xsYXRlcmFsIGZyb20gYW5vdGhlciBtYXJrZXQgYXMgY29tcGVuc2F0aW9uLiBUaGUgbGlxdWlkYXRpb24gaW5jbHVkZXMKICAgIC8vICAgICBhIGJvbnVzIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzIGFuZCBoZWxwcyBtYWludGFpbiBwcm90b2NvbCBoZWFsdGggYnkgcmVtb3ZpbmcKICAgIC8vICAgICB1bmRlcmNvbGxhdGVyYWxpemVkIHBvc2l0aW9ucy4KICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIGRlYnRfbWFya2V0X2lkOiBUaGUgbWFya2V0IElEIHdoZXJlIHRoZSBkZWJ0IHRvIGJlIHJlcGFpZCBleGlzdHMKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IFRoZSBtYXJrZXQgSUQgd2hlcmUgY29sbGF0ZXJhbCB3aWxsIGJlIHNlaXplZCBmcm9tCiAgICAvLyAgICAgICAgIGxpcXVpZGF0b3JfaWQ6IFRoZSBhY2NvdW50IHBlcmZvcm1pbmcgdGhlIGxpcXVpZGF0aW9uCiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSBhY2NvdW50IGJlaW5nIGxpcXVpZGF0ZWQKICAgIC8vICAgICAgICAgZGVidF9hbW91bnQ6IFRoZSBhbW91bnQgb2YgZGVidCB0byByZXBheSAobXVzdCBpbmNsdWRlIGFjY3J1ZWQgaW50ZXJlc3QpCiAgICAvLyAgICAgICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBNaW5pbXVtIGNvbGxhdGVyYWwgYW1vdW50IHRoZSBsaXF1aWRhdG9yIGV4cGVjdHMgdG8gcmVjZWl2ZQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgYW55IHZhbGlkYXRpb24gZmFpbHMsIGluY2x1ZGluZzoKICAgIC8vICAgICAgICAgICAgIC0gVXNpbmcgc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIChib3Jyb3ctb25seSBtYXJrZXQpCiAgICAvLyAgICAgICAgICAgICAtIEF0dGVtcHRpbmcgc2VsZi1saXF1aWRhdGlvbgogICAgLy8gICAgICAgICAgICAgLSBNYXJrZXQgZG9lc24ndCBleGlzdCBvciBpcyBwYXVzZWQKICAgIC8vICAgICAgICAgICAgIC0gUG9zaXRpb24gaXMgbm90IGxpcXVpZGF0YWJsZSAoaGVhbHRoIGZhY3RvciA+PSAxLjApCiAgICAvLyAgICAgICAgICAgICAtIExpcXVpZGF0aW9uIGFtb3VudCBleGNlZWRzIG1heGltdW0gYWxsb3dlZCBvciB0b3RhbCBkZWJ0CiAgICAvLyAgICAgICAgICAgICAtIEluc3VmZmljaWVudCBjb2xsYXRlcmFsIHRvIHNlaXplCiAgICAvLyAgICAgICAgICAgICAtIENvbGxhdGVyYWwgcmVjZWl2ZWQgYmVsb3cgbWluaW11bSB0aHJlc2hvbGQKICAgIC8vIAogICAgLy8gICAgIE5vdGVzOgogICAgLy8gICAgICAgICAtIFVzZXMgdGhlIGNvbGxhdGVyYWwgbWFya2V0J3MgbGlxdWlkYXRpb24gdGhyZXNob2xkIGZvciBoZWFsdGggY2FsY3VsYXRpb24KICAgIC8vICAgICAgICAgLSBMaXF1aWRhdGlvbiBib251cyBpcyBhcHBsaWVkIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzCiAgICAvLyAgICAgICAgIC0gQWNjcnVlZCBpbnRlcmVzdCBvbiBib3RoIGRlYnQgYW5kIGNvbGxhdGVyYWwgcG9zaXRpb25zIGlzIGluY2x1ZGVkCiAgICAvLyAgICAgICAgIC0gSGFuZGxlcyBkaWZmZXJlbnQgdG9rZW4gdHlwZXMgKEFSQzIwMCB2cyBTVG9rZW4pIGFwcHJvcHJpYXRlbHkKICAgIC8vICAgICAgICAgLSBVcGRhdGVzIGdsb2JhbCBib3Jyb3cgYW5kIGNvbGxhdGVyYWwgdmFsdWVzIGZvciB0aGUgdXNlcgogICAgLy8gICAgICIiIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgbGlxdWlkYXRlIG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgZGVidF9tYXJrZXRfaWQKICAgIC8vICAgICApLmxpcXVpZGF0ZS5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGRlYnRfYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJMaXF1aWRhdGUgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBSRU0gcHJldmVudCB1c2luZyBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgaW4gbGlxdWlkYXRpb24gYmVjYXVzZSBzdG9rZW4KICAgIC8vICAgICAjIFJFTSBtYXJrZXQgY29sbGF0ZXJhbCBkb2VzIG5vdCBleGlzdAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkICE9IHNlbGYuc3Rva2VuX2FwcF9pZAogICAgLy8gICAgICksICJDYW5ub3QgdXNlIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCAoYm9ycm93LW9ubHkgbWFya2V0KSIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgUkVNIHByZXZlbnQgc2VsZiBsaXF1aWRhdGlvbgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIGFzc2VydCB1c2VyX2lkICE9IGxpcXVpZGF0b3JfaWQsICJDYW5ub3QgbGlxdWlkYXRlIHNlbGYiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgZGVidF9tYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiRGVidCBtYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IGNvbGxhdGVyYWxfbWFya2V0X2lkIGluIHNlbGYubWFya2V0cywgIkNvbGxhdGVyYWwgbWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgc3dhcAogICAgY29uY2F0CiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ4OAogICAgLy8gYXNzZXJ0IGNvbGxhdGVyYWxfbWFya2V0X2lkIGluIHNlbGYubWFya2V0cywgIkNvbGxhdGVyYWwgbWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgYXNzZXJ0IC8vIENvbGxhdGVyYWwgbWFya2V0IGRvZXMgbm90IGV4aXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0ODkKICAgIC8vIGFzc2VydCBkZWJ0X2Ftb3VudCA+IDAsICJEZWJ0IGFtb3VudCBtdXN0IGJlID4gMCIKICAgIGZyYW1lX2RpZyAtMgogICAgYnl0ZSAweAogICAgYj4KICAgIGFzc2VydCAvLyBEZWJ0IGFtb3VudCBtdXN0IGJlID4gMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDkxCiAgICAvLyBkZWJ0X21hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQoZGVidF9tYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTYKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ5MgogICAgLy8gY29sbGF0ZXJhbF9tYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KGNvbGxhdGVyYWxfbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC01CiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0OTQKICAgIC8vIGRlYnRfdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIGRlYnRfbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTYKICAgIGNhbGxzdWIgX2dldF91c2VyCiAgICBkdXAKICAgIGNvdmVyIDMKICAgIGZyYW1lX2J1cnkgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDk1CiAgICAvLyBjb2xsYXRlcmFsX3VzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBjb2xsYXRlcmFsX21hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC01CiAgICBjYWxsc3ViIF9nZXRfdXNlcgogICAgZnJhbWVfYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0OTcKICAgIC8vIGFzc2VydCBub3QgZGVidF9tYXJrZXQucGF1c2VkLCAiRGVidCBtYXJrZXQgaXMgcGF1c2VkIgogICAgaW50IDAKICAgIGdldGJpdAogICAgYnl0ZSAweDAwCiAgICBpbnQgMAogICAgdW5jb3ZlciAyCiAgICBzZXRiaXQKICAgIGJ5dGUgMHgwMAogICAgPT0KICAgIGFzc2VydCAvLyBEZWJ0IG1hcmtldCBpcyBwYXVzZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ5OAogICAgLy8gYXNzZXJ0IG5vdCBjb2xsYXRlcmFsX21hcmtldC5wYXVzZWQsICJDb2xsYXRlcmFsIG1hcmtldCBpcyBwYXVzZWQiCiAgICBkdXAKICAgIGludCAwCiAgICBnZXRiaXQKICAgIGJ5dGUgMHgwMAogICAgaW50IDAKICAgIHVuY292ZXIgMgogICAgc2V0Yml0CiAgICBieXRlIDB4MDAKICAgID09CiAgICBhc3NlcnQgLy8gQ29sbGF0ZXJhbCBtYXJrZXQgaXMgcGF1c2VkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MDAKICAgIC8vIG5ld19kZWJ0X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChkZWJ0X21hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtNgogICAgY2FsbHN1YiBfYWNjcnVlX2ludGVyZXN0CiAgICBjb3ZlciAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MDEKICAgIC8vIG5ld19jb2xsYXRlcmFsX21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChjb2xsYXRlcmFsX21hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtNQogICAgY2FsbHN1YiBfYWNjcnVlX2ludGVyZXN0CiAgICBkdXAKICAgIGNvdmVyIDQKICAgIGZyYW1lX2J1cnkgMwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTAzLTI1MDYKICAgIC8vICMgQ2FsY3VsYXRlIGVhcm5lZCBpbnRlcmVzdCBvbiBjb2xsYXRlcmFsIHBvc2l0aW9uCiAgICAvLyBjb2xsYXRlcmFsX2ludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QoCiAgICAvLyAgICAgdXNlcl9pZCwgY29sbGF0ZXJhbF9tYXJrZXRfaWQKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC01CiAgICBjYWxsc3ViIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdAogICAgY292ZXIgNAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTA4LTI1MDkKICAgIC8vICMgQ2FsY3VsYXRlIHVzZXIncyBjdXJyZW50IGRlYnQgaW50ZXJlc3QKICAgIC8vIGRlYnRfaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQsIGRlYnRfbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTYKICAgIGNhbGxzdWIgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUxMS0yNTEyCiAgICAvLyAjIENhbGN1bGF0ZSB0b3RhbCBkZWJ0IGluY2x1ZGluZyBpbnRlcmVzdAogICAgLy8gdG90YWxfZGVidCA9IGRlYnRfdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBkZWJ0X2ludGVyZXN0CiAgICB1bmNvdmVyIDIKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgNwogICAgZHVwCiAgICBkaWcgMgogICAgYisKICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUxNAogICAgLy8gZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X2dsb2JhbF91c2VyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MTYKICAgIC8vIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgPiAwCiAgICBkdXAKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGJ5dGUgMHgKICAgIGI+CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MTUtMjUxNwogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlID4gMAogICAgLy8gKSwgIlVzZXIgaGFzIG5vIGRlYnQgdG8gbGlxdWlkYXRlIgogICAgYXNzZXJ0IC8vIFVzZXIgaGFzIG5vIGRlYnQgdG8gbGlxdWlkYXRlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MTktMjUyOAogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjIFJFTSB1c2VzIG1pbiBvZiB0aGUgdHdvIG1hcmtldHMnIGxpcXVpZGF0aW9uIHRocmVzaG9sZHMKICAgIC8vICMgUkVNIGNvbnZlbnRpb25hbGx5IHdlIHVzZSB0aGUgY29sbGF0ZXJhbCBtYXJrZXQncyBsaXF1aWRhdGlvbiB0aHJlc2hvbGQKICAgIC8vICMgbGlxdWlkYXRpb25fdGhyZXNob2xkID0gc2VsZi5fbWluNjQoCiAgICAvLyAjICAgICBkZWJ0X21hcmtldC5saXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlLAogICAgLy8gIyAgICAgY29sbGF0ZXJhbF9tYXJrZXQubGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSwKICAgIC8vICMgKQogICAgLy8gIyBSRU0gdXNpbmcgY2FsYXRlcmFsIG1hcmtldCdzIGxpcXVpZGF0aW9uIHRocmVzaG9sZCBmb3IgaGVhbHRoIGNhbGN1bGF0aW9uCiAgICAvLyAjIFJFTSBpdCBpcyB0aGUgbm9ybSBmb3IgbGlxdWlkYXRpb24gdGhyZXNob2xkCiAgICAvLyBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPSBjb2xsYXRlcmFsX21hcmtldC5saXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlCiAgICB1bmNvdmVyIDUKICAgIGV4dHJhY3QgODEgOCAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUzMgogICAgLy8gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIHVuY292ZXIgMgogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTMzCiAgICAvLyAqIEJpZ1VJbnQobGlxdWlkYXRpb25fdGhyZXNob2xkKQogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTMyLTI1MzMKICAgIC8vIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlCiAgICAvLyAqIEJpZ1VJbnQobGlxdWlkYXRpb25fdGhyZXNob2xkKQogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUzNAogICAgLy8gKiBCaWdVSW50KDEwMDAwKQogICAgYnl0ZSAweDI3MTAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUzMi0yNTM0CiAgICAvLyBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZQogICAgLy8gKiBCaWdVSW50KGxpcXVpZGF0aW9uX3RocmVzaG9sZCkKICAgIC8vICogQmlnVUludCgxMDAwMCkKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MzUKICAgIC8vICkgLy8gKGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgKiBCaWdVSW50KDEwMDAwKSkKICAgIHN3YXAKICAgIGJ5dGUgMHgyNzEwCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTMxLTI1MzUKICAgIC8vIGhlYWx0aCA9ICgKICAgIC8vICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZQogICAgLy8gICAgICogQmlnVUludChsaXF1aWRhdGlvbl90aHJlc2hvbGQpCiAgICAvLyAgICAgKiBCaWdVSW50KDEwMDAwKQogICAgLy8gKSAvLyAoZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSAqIEJpZ1VJbnQoMTAwMDApKQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUzNgogICAgLy8gYXNzZXJ0IGhlYWx0aCA8IDEwMDAwLCAiUG9zaXRpb24gaXMgbm90IGxpcXVpZGF0YWJsZSIKICAgIGJ5dGUgMHgyNzEwCiAgICBiPAogICAgYXNzZXJ0IC8vIFBvc2l0aW9uIGlzIG5vdCBsaXF1aWRhdGFibGUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU0MAogICAgLy8gZGVidF92YWx1ZSAqIEJpZ1VJbnQobmV3X2RlYnRfbWFya2V0LmNsb3NlX2ZhY3Rvci5uYXRpdmUpCiAgICBkaWcgMwogICAgaW50IDMyMQogICAgaW50IDgKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgaXRvYgogICAgZGlnIDIKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NDEKICAgIC8vICkgLy8gQmlnVUludCgxMDAwMCkKICAgIGJ5dGUgMHgyNzEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MzktMjU0MQogICAgLy8gbWF4X2xpcXVpZGF0YWJsZSA9ICgKICAgIC8vICAgICBkZWJ0X3ZhbHVlICogQmlnVUludChuZXdfZGVidF9tYXJrZXQuY2xvc2VfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICkgLy8gQmlnVUludCgxMDAwMCkKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NDMKICAgIC8vIGRlYnRfYW1vdW50IDw9IG1heF9saXF1aWRhdGFibGUKICAgIGZyYW1lX2RpZyAtMgogICAgYj49CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NDItMjU0NAogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBkZWJ0X2Ftb3VudCA8PSBtYXhfbGlxdWlkYXRhYmxlCiAgICAvLyApLCAiQW1vdW50IGV4Y2VlZHMgbWF4aW11bSBsaXF1aWRhdGFibGUgYW1vdW50IgogICAgYXNzZXJ0IC8vIEFtb3VudCBleGNlZWRzIG1heGltdW0gbGlxdWlkYXRhYmxlIGFtb3VudAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTQ2LTI1NDcKICAgIC8vICMgVmFsaWRhdGUgbGlxdWlkYXRpb24gYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vIGFzc2VydCBkZWJ0X2Ftb3VudCA8PSB0b3RhbF9kZWJ0LCAiTGlxdWlkYXRpb24gYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidCIKICAgIGZyYW1lX2RpZyAtMgogICAgdW5jb3ZlciAyCiAgICBiPD0KICAgIGFzc2VydCAvLyBMaXF1aWRhdGlvbiBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NTEKICAgIC8vIGRlYnRfYW1vdW50ID49IGRlYnRfaW50ZXJlc3QKICAgIGZyYW1lX2RpZyAtMgogICAgZGlnIDIKICAgIGI+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTQ5LTI1NTIKICAgIC8vICMgUmVxdWlyZSBtaW5pbXVtIGxpcXVpZGF0aW9uIG9mIGF0IGxlYXN0IHRoZSBkZWJ0IGludGVyZXN0CiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIGRlYnRfYW1vdW50ID49IGRlYnRfaW50ZXJlc3QKICAgIC8vICksICJMaXF1aWRhdGlvbiBhbW91bnQgbXVzdCBiZSBhdCBsZWFzdCB0aGUgYWNjcnVlZCBpbnRlcmVzdCIKICAgIGFzc2VydCAvLyBMaXF1aWRhdGlvbiBhbW91bnQgbXVzdCBiZSBhdCBsZWFzdCB0aGUgYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTU0LTI1NTUKICAgIC8vICMgQ2FsY3VsYXRlIGhvdyBtdWNoIGdvZXMgdG93YXJkIHByaW5jaXBhbCByZXBheW1lbnQKICAgIC8vIHByaW5jaXBhbF9yZXBheW1lbnQgPSBkZWJ0X2Ftb3VudCAtIGRlYnRfaW50ZXJlc3QKICAgIGZyYW1lX2RpZyAtMgogICAgdW5jb3ZlciAyCiAgICBiLQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTU5CiAgICAvLyBwcmluY2lwYWxfcmVwYXltZW50ICogU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTYwCiAgICAvLyApIC8vIG5ld19kZWJ0X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICBkaWcgMgogICAgZXh0cmFjdCAyMDkgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgOAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTU3LTI1NjAKICAgIC8vICMgQ2FsY3VsYXRlIHNjYWxlZCBhbW91bnQgZm9yIHByaW5jaXBhbCByZXBheW1lbnQgb25seQogICAgLy8gc2NhbGVkX3JlcGF5X2Ftb3VudCA9ICgKICAgIC8vICAgICBwcmluY2lwYWxfcmVwYXltZW50ICogU0NBTEUKICAgIC8vICkgLy8gbmV3X2RlYnRfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIGIvCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgNgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTYyCiAgICAvLyBkZWJ0X3VzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IHNjYWxlZF9yZXBheV9hbW91bnQKICAgIGI+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTYxLTI1NjMKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgZGVidF91c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBzY2FsZWRfcmVwYXlfYW1vdW50CiAgICAvLyApLCAiUHJpbmNpcGFsIHJlcGF5bWVudCBleGNlZWRzIGRlYnQiCiAgICBhc3NlcnQgLy8gUHJpbmNpcGFsIHJlcGF5bWVudCBleGNlZWRzIGRlYnQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU2NQogICAgLy8gZGVidF91c2RfdmFsdWUgPSAoZGVidF9hbW91bnQgKiBuZXdfZGVidF9tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA5CiAgICBmcmFtZV9kaWcgLTIKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU2OAogICAgLy8gZGVidF91c2RfdmFsdWUgKiBCaWdVSW50KG5ld19jb2xsYXRlcmFsX21hcmtldC5saXF1aWRhdGlvbl9ib251cy5uYXRpdmUpCiAgICBkaWcgMQogICAgZXh0cmFjdCA2NSA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgaXRvYgogICAgZGlnIDEKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NjkKICAgIC8vICkgLy8gQmlnVUludCgxMDAwMCkKICAgIGJ5dGUgMHgyNzEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NjctMjU2OQogICAgLy8gYm9udXNfdXNkX3ZhbHVlID0gKAogICAgLy8gICAgIGRlYnRfdXNkX3ZhbHVlICogQmlnVUludChuZXdfY29sbGF0ZXJhbF9tYXJrZXQubGlxdWlkYXRpb25fYm9udXMubmF0aXZlKQogICAgLy8gKSAvLyBCaWdVSW50KDEwMDAwKQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU3MAogICAgLy8gY29sbGF0ZXJhbF91c2RfdmFsdWUgPSBkZWJ0X3VzZF92YWx1ZSArIGJvbnVzX3VzZF92YWx1ZQogICAgYisKICAgIGR1cAogICAgZnJhbWVfYnVyeSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NzMKICAgIC8vIGNvbGxhdGVyYWxfdXNkX3ZhbHVlICogU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTc0CiAgICAvLyApIC8vIG5ld19jb2xsYXRlcmFsX21hcmtldC5wcmljZS5uYXRpdmUKICAgIGRpZyAxCiAgICBpbnQgMjgxCiAgICBpbnQgMzIKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NzItMjU3NAogICAgLy8gY29sbGF0ZXJhbF9hbW91bnQgPSAoCiAgICAvLyAgICAgY29sbGF0ZXJhbF91c2RfdmFsdWUgKiBTQ0FMRQogICAgLy8gKSAvLyBuZXdfY29sbGF0ZXJhbF9tYXJrZXQucHJpY2UubmF0aXZlCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTc2LTI1NzcKICAgIC8vICMgQWRkIGVhcm5lZCBpbnRlcmVzdCB0byBjb2xsYXRlcmFsIGFtb3VudCBmb3IgbGlxdWlkYXRvcgogICAgLy8gdG90YWxfY29sbGF0ZXJhbF9hbW91bnQgPSBjb2xsYXRlcmFsX2Ftb3VudCArIGNvbGxhdGVyYWxfaW50ZXJlc3QKICAgIHVuY292ZXIgMgogICAgYisKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxNAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTgwCiAgICAvLyB0b3RhbF9jb2xsYXRlcmFsX2Ftb3VudCAqIFNDQUxFCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU4MQogICAgLy8gKSAvLyBuZXdfY29sbGF0ZXJhbF9tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIHN3YXAKICAgIGV4dHJhY3QgMTc3IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDExCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NzktMjU4MQogICAgLy8gc2NhbGVkX2NvbGxhdGVyYWxfYW1vdW50ID0gKAogICAgLy8gICAgIHRvdGFsX2NvbGxhdGVyYWxfYW1vdW50ICogU0NBTEUKICAgIC8vICkgLy8gbmV3X2NvbGxhdGVyYWxfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICBiLwogICAgZnJhbWVfYnVyeSA1CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1ODMtMjU4NAogICAgLy8gIyBERi1BVUQtMDk6IFZhbGlkYXRlIHVzZXIgY2FwIGZvciBjb2xsYXRlcmFsIG9wZXJhdGlvbgogICAgLy8gdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAobGlxdWlkYXRvcl9pZCkKICAgIGZyYW1lX2RpZyAtNAogICAgY2FsbHN1YiBfZ2V0X3VzZXJfY2FwCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMTUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU4NQogICAgLy8gaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9PSAwOgogICAgZXh0cmFjdCAxOTIgOCAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA0CiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMAogICAgYj09CiAgICBieiBfbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9lbHNlX2JvZHlANAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTg2CiAgICAvLyB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGludCA4NjQwMAogICAgKwogICAgaXRvYgogICAgZnJhbWVfZGlnIDE1CiAgICBzd2FwCiAgICByZXBsYWNlMiAxOTIKICAgIGZyYW1lX2J1cnkgMTUKICAgIGIgX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfYWZ0ZXJfaWZfZWxzZUA3CgpfbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9lbHNlX2JvZHlANDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU4NwogICAgLy8gZWxpZiB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lIDwgR2xvYmFsLmxhdGVzdF90aW1lc3RhbXA6CiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICBmcmFtZV9kaWcgNAogICAgYj4KICAgIGZyYW1lX2RpZyAxNQogICAgZnJhbWVfYnVyeSAxNgogICAgYnogX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfYWZ0ZXJfaWZfZWxzZUA2CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1ODgKICAgIC8vIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KDApCiAgICBmcmFtZV9kaWcgMTUKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICByZXBsYWNlMiA5NgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTg5CiAgICAvLyB1c2VyX2NhcC50b3RhbF9saXF1aWRhdGlvbnMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICByZXBsYWNlMiA2NAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTkwCiAgICAvLyB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGludCA4NjQwMAogICAgKwogICAgaXRvYgogICAgcmVwbGFjZTIgMTkyCiAgICBmcmFtZV9idXJ5IDE2CgpfbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9hZnRlcl9pZl9lbHNlQDY6CiAgICBmcmFtZV9kaWcgMTYKICAgIGZyYW1lX2J1cnkgMTUKCl9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X2FmdGVyX2lmX2Vsc2VANzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU5MQogICAgLy8gaWYgdXNlcl9jYXAuZGFpbHlfbGlxdWlkYXRpb25zLm5hdGl2ZSA+IDA6CiAgICBmcmFtZV9kaWcgMTUKICAgIGV4dHJhY3QgMTI4IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEyCiAgICBieXRlIDB4CiAgICBiPgogICAgYnogX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfYWZ0ZXJfaWZfZWxzZUA5CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1OTMKICAgIC8vIHVzZXJfY2FwLnRvdGFsX2xpcXVpZGF0aW9ucy5uYXRpdmUgKyBjb2xsYXRlcmFsX3VzZF92YWx1ZQogICAgZnJhbWVfZGlnIDE1CiAgICBkdXAKICAgIGV4dHJhY3QgNjQgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1OTItMjU5NAogICAgLy8gbmV3X3RvdGFsX2xpcXVpZGF0aW9ucyA9ICgKICAgIC8vICAgICB1c2VyX2NhcC50b3RhbF9saXF1aWRhdGlvbnMubmF0aXZlICsgY29sbGF0ZXJhbF91c2RfdmFsdWUKICAgIC8vICkKICAgIGZyYW1lX2RpZyAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1OTMKICAgIC8vIHVzZXJfY2FwLnRvdGFsX2xpcXVpZGF0aW9ucy5uYXRpdmUgKyBjb2xsYXRlcmFsX3VzZF92YWx1ZQogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU5NgogICAgLy8gbmV3X3RvdGFsX2xpcXVpZGF0aW9ucyA8PSB1c2VyX2NhcC5kYWlseV9saXF1aWRhdGlvbnMubmF0aXZlCiAgICBkdXAKICAgIGZyYW1lX2RpZyAxMgogICAgYjw9CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1OTUtMjU5NwogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBuZXdfdG90YWxfbGlxdWlkYXRpb25zIDw9IHVzZXJfY2FwLmRhaWx5X2xpcXVpZGF0aW9ucy5uYXRpdmUKICAgIC8vICksICJVc2VyIGNvbGxhdGVyYWwgY2FwIGV4Y2VlZGVkIgogICAgYXNzZXJ0IC8vIFVzZXIgY29sbGF0ZXJhbCBjYXAgZXhjZWVkZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU5OAogICAgLy8gdXNlcl9jYXAudG90YWxfbGlxdWlkYXRpb25zID0gYXJjNC5VSW50MjU2KG5ld190b3RhbF9saXF1aWRhdGlvbnMpCiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBifAogICAgcmVwbGFjZTIgNjQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU5OQogICAgLy8gc2VsZi5fc2V0X3VzZXJfY2FwKGxpcXVpZGF0b3JfaWQsIHVzZXJfY2FwKQogICAgZnJhbWVfZGlnIC00CiAgICBzd2FwCiAgICBjYWxsc3ViIF9zZXRfdXNlcl9jYXAKICAgIHBvcAoKX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfYWZ0ZXJfaWZfZWxzZUA5OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjAyCiAgICAvLyBjb2xsYXRlcmFsX3VzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBzY2FsZWRfY29sbGF0ZXJhbF9hbW91bnQKICAgIGZyYW1lX2RpZyAxCiAgICBleHRyYWN0IDAgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMTMKICAgIGZyYW1lX2RpZyA1CiAgICBiPj0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjYwMS0yNjAzCiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIGNvbGxhdGVyYWxfdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IHNjYWxlZF9jb2xsYXRlcmFsX2Ftb3VudAogICAgLy8gKSwgIkluc3VmZmljaWVudCBjb2xsYXRlcmFsIHRvIHNlaXplIgogICAgYXNzZXJ0IC8vIEluc3VmZmljaWVudCBjb2xsYXRlcmFsIHRvIHNlaXplCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MDkKICAgIC8vIHRvdGFsX2NvbGxhdGVyYWxfYW1vdW50ID49IG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkCiAgICBmcmFtZV9kaWcgMTQKICAgIGZyYW1lX2RpZyAtMQogICAgYj49CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MDUtMjYxMAogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjIFJFTSBjb2xsYXRlcmFsIGFtb3VudCBzbGlwcGFnZSBwcm90ZWN0aW9uCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgdG90YWxfY29sbGF0ZXJhbF9hbW91bnQgPj0gbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQKICAgIC8vICksICJJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCByZWNlaXZlZCIKICAgIGFzc2VydCAvLyBJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCByZWNlaXZlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjExLTI2MjAKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIwogICAgLy8gIyBCT1JST1cgSEFORExJTkcKICAgIC8vICMKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIyBSRU0gbGlxdWlkYXRvciByZXBheXMgZGVidAogICAgLy8gIyBSRU0gdHJhbnNmZXIgZGVidCBmcm9tIGxpcXVpZGF0b3IgdG8gdGhlIHByb3RvY29sCiAgICAvLyAjIFJFTSBkaWZmZXJlbnQgZm9yIHN0b2tlbiBhbmQgcmVndWxhciBtYXJrZXQKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gaWYgZGVidF9tYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY3CiAgICAvLyBzZWxmLnN0b2tlbl9hcHBfaWQgPSBVSW50NjQoKSAgIyBzdGFibGUgbWFya2V0CiAgICBieXRlICJzdG9rZW5fYXBwX2lkIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjExLTI2MjAKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIwogICAgLy8gIyBCT1JST1cgSEFORExJTkcKICAgIC8vICMKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIyBSRU0gbGlxdWlkYXRvciByZXBheXMgZGVidAogICAgLy8gIyBSRU0gdHJhbnNmZXIgZGVidCBmcm9tIGxpcXVpZGF0b3IgdG8gdGhlIHByb3RvY29sCiAgICAvLyAjIFJFTSBkaWZmZXJlbnQgZm9yIHN0b2tlbiBhbmQgcmVndWxhciBtYXJrZXQKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gaWYgZGVidF9tYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnN0b2tlbl9hcHBfaWQgZXhpc3RzCiAgICBmcmFtZV9kaWcgLTYKICAgID09CiAgICBieiBfbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9lbHNlX2JvZHlAMTIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjYyMS0yNjI2CiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIFNUb2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKGxpcXVpZGF0b3JfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihkZWJ0X2Ftb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKGRlYnRfbWFya2V0X2lkKSwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjYyNAogICAgLy8gYXJjNC5VSW50MjU2KGRlYnRfYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMgogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGZyYW1lX2RpZyAtMgogICAgYnwKICAgIGZyYW1lX2RpZyAtNgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MjEtMjYyNgogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBTVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyhsaXF1aWRhdG9yX2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoZGVidF9hbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihkZWJ0X21hcmtldF9pZCksCiAgICAvLyApCiAgICBtZXRob2QgImJ1cm5fZnJvbShhZGRyZXNzLHVpbnQyNTYpdm9pZCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTQKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGIgX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfYWZ0ZXJfaWZfZWxzZUAxNAoKX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfZWxzZV9ib2R5QDEyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjI4LTI2MzQKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3MobGlxdWlkYXRvcl9pZCksCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihkZWJ0X2Ftb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKGRlYnRfbWFya2V0X2lkKSwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjYzMQogICAgLy8gYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgZ2xvYmFsIEN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjYzMgogICAgLy8gYXJjNC5VSW50MjU2KGRlYnRfYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMgogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGZyYW1lX2RpZyAtMgogICAgYnwKICAgIGZyYW1lX2RpZyAtNgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MjgtMjYzNAogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyhsaXF1aWRhdG9yX2lkKSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGRlYnRfYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24oZGVidF9tYXJrZXRfaWQpLAogICAgLy8gKQogICAgbWV0aG9kICJhcmMyMDBfdHJhbnNmZXJGcm9tKGFkZHJlc3MsYWRkcmVzcyx1aW50MjU2KWJvb2wiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgZnJhbWVfZGlnIC00CiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgc3dhcAogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgaXR4biBMYXN0TG9nCiAgICBleHRyYWN0IDAgNAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICA9PQogICAgYXNzZXJ0IC8vIEFSQzQgcHJlZml4IGlzIHZhbGlkCgpfbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9hZnRlcl9pZl9lbHNlQDE0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjM3LTI2MzkKICAgIC8vIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX3JlcGF5X2Ftb3VudAogICAgLy8gKQogICAgZnJhbWVfZGlnIC02CiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyA2CiAgICBkdXAKICAgIGNvdmVyIDMKICAgIGNhbGxzdWIgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjQwCiAgICAvLyBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKGRlYnRfbWFya2V0X2lkLCBzY2FsZWRfcmVwYXlfYW1vdW50KQogICAgZnJhbWVfZGlnIC02CiAgICBkaWcgMQogICAgY2FsbHN1YiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjQyLTI2NTQKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIwogICAgLy8gIyBDT0xMQVRFUkFMIEhBTkRMSU5HCiAgICAvLyAjCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICMgYnVybiB0aGUgY29sbGF0ZXJhbCB0b2tlbgogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIE5Ub2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1Nih0b3RhbF9jb2xsYXRlcmFsX2Ftb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG5ld19jb2xsYXRlcmFsX21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY1MgogICAgLy8gYXJjNC5VSW50MjU2KHRvdGFsX2NvbGxhdGVyYWxfYW1vdW50KSwKICAgIGZyYW1lX2RpZyAxNAogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY1MwogICAgLy8gYXBwX2lkPUFwcGxpY2F0aW9uKG5ld19jb2xsYXRlcmFsX21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIGZyYW1lX2RpZyAzCiAgICBpbnQgMzEzCiAgICBpbnQgOAogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY0Mi0yNjU0CiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICMKICAgIC8vICMgQ09MTEFURVJBTCBIQU5ETElORwogICAgLy8gIwogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjIGJ1cm4gdGhlIGNvbGxhdGVyYWwgdG9rZW4KICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYodG90YWxfY29sbGF0ZXJhbF9hbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfY29sbGF0ZXJhbF9tYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyApCiAgICBtZXRob2QgImJ1cm5fZnJvbShhZGRyZXNzLHVpbnQyNTYpdm9pZCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTMKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBkdXAKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjU3LTI2NTkKICAgIC8vIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9jb2xsYXRlcmFsX2Ftb3VudAogICAgLy8gKQogICAgZnJhbWVfZGlnIC01CiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyA1CiAgICBkdXAKICAgIGNvdmVyIDMKICAgIGNhbGxzdWIgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY2MC0yNjYyCiAgICAvLyBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZCwgc2NhbGVkX2NvbGxhdGVyYWxfYW1vdW50CiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTUKICAgIGRpZyAxCiAgICBjYWxsc3ViIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjY0LTI2NjkKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyhsaXF1aWRhdG9yX2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYodG90YWxfY29sbGF0ZXJhbF9hbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihjb2xsYXRlcmFsX21hcmtldF9pZCksCiAgICAvLyApCiAgICBpdHhuX2JlZ2luCiAgICBmcmFtZV9kaWcgLTUKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgbWV0aG9kICJhcmMyMDBfdHJhbnNmZXIoYWRkcmVzcyx1aW50MjU2KWJvb2wiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgZnJhbWVfZGlnIC00CiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgc3dhcAogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGV4dHJhY3QgMCA0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgID09CiAgICBhc3NlcnQgLy8gQVJDNCBwcmVmaXggaXMgdmFsaWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY3MgogICAgLy8gZGVidF91c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIGRlYnRfdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlIC8vIFNDQUxFCiAgICBmcmFtZV9kaWcgMgogICAgZHVwCiAgICBleHRyYWN0IDk2IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIDcKICAgIGR1cAogICAgdW5jb3ZlciAyCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NzEtMjY3MwogICAgLy8gb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgZGVidF91c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIGRlYnRfdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlIC8vIFNDQUxFCiAgICAvLyApCiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NzUKICAgIC8vIChkZWJ0X3VzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gc2NhbGVkX3JlcGF5X2Ftb3VudCkKICAgIHVuY292ZXIgNAogICAgYi0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY3NS0yNjc2CiAgICAvLyAoZGVidF91c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIHNjYWxlZF9yZXBheV9hbW91bnQpCiAgICAvLyAqIG5ld19kZWJ0X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICBmcmFtZV9kaWcgOAogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY3NwogICAgLy8gLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NzUtMjY3NwogICAgLy8gKGRlYnRfdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBzY2FsZWRfcmVwYXlfYW1vdW50KQogICAgLy8gKiBuZXdfZGVidF9tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gLy8gU0NBTEUKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NzkKICAgIC8vIG9sZF9ib3Jyb3dfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBkZWJ0X3VzZXIubGFzdF9wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICB1bmNvdmVyIDIKICAgIGV4dHJhY3QgMTM2IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgdW5jb3ZlciAyCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2ODAKICAgIC8vIG5ld19ib3Jyb3dfdmFsdWUgPSAobmV3X2JvcnJvd19hbW91bnQgKiBuZXdfZGVidF9tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgc3dhcAogICAgZnJhbWVfZGlnIDkKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY4MS0yNjgzCiAgICAvLyBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgdXNlcl9pZCwgZGVidF9tYXJrZXRfaWQsIG9sZF9ib3Jyb3dfdmFsdWUsIG5ld19ib3Jyb3dfdmFsdWUKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC02CiAgICB1bmNvdmVyIDMKICAgIHVuY292ZXIgMwogICAgY2FsbHN1YiBfdXBkYXRlX2dsb2JhbF9ib3Jyb3dzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2ODcKICAgIC8vICogY29sbGF0ZXJhbF91c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICBmcmFtZV9kaWcgMQogICAgZHVwCiAgICBleHRyYWN0IDY0IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjg2LTI2ODcKICAgIC8vIGNvbGxhdGVyYWxfdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAqIGNvbGxhdGVyYWxfdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgZnJhbWVfZGlnIDEzCiAgICBkdXAKICAgIHVuY292ZXIgMgogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY4OAogICAgLy8gLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2ODYtMjY4OAogICAgLy8gY29sbGF0ZXJhbF91c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICogY29sbGF0ZXJhbF91c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAvLyBTQ0FMRQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY4NS0yNjg5CiAgICAvLyBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgY29sbGF0ZXJhbF91c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAqIGNvbGxhdGVyYWxfdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgIC8vIFNDQUxFCiAgICAvLyApCiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2OTEKICAgIC8vIChjb2xsYXRlcmFsX3VzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIHNjYWxlZF9jb2xsYXRlcmFsX2Ftb3VudCkKICAgIHVuY292ZXIgMwogICAgYi0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY5MS0yNjkyCiAgICAvLyAoY29sbGF0ZXJhbF91c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBzY2FsZWRfY29sbGF0ZXJhbF9hbW91bnQpCiAgICAvLyAqIG5ld19jb2xsYXRlcmFsX21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgZnJhbWVfZGlnIDExCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjkzCiAgICAvLyAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY5MS0yNjkzCiAgICAvLyAoY29sbGF0ZXJhbF91c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBzY2FsZWRfY29sbGF0ZXJhbF9hbW91bnQpCiAgICAvLyAqIG5ld19jb2xsYXRlcmFsX21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gLy8gU0NBTEUKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2OTYKICAgIC8vIG9sZF9kZXBvc2l0X2Ftb3VudCAqIGNvbGxhdGVyYWxfdXNlci5sYXN0X3ByaWNlLm5hdGl2ZQogICAgdW5jb3ZlciAyCiAgICBleHRyYWN0IDEzNiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHVuY292ZXIgMgogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY5NwogICAgLy8gKSAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY5NS0yNjk3CiAgICAvLyBvbGRfZGVwb3NpdF92YWx1ZSA9ICgKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgKiBjb2xsYXRlcmFsX3VzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICkgLy8gU0NBTEUKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2OTkKICAgIC8vIG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19jb2xsYXRlcmFsX21hcmtldC5wcmljZS5uYXRpdmUKICAgIHN3YXAKICAgIGZyYW1lX2RpZyAxMAogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjcwMAogICAgLy8gKSAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY5OC0yNzAwCiAgICAvLyBuZXdfZGVwb3NpdF92YWx1ZSA9ICgKICAgIC8vICAgICBuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfY29sbGF0ZXJhbF9tYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyApIC8vIFNDQUxFCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzAyLTI3MDQKICAgIC8vIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICB1c2VyX2lkLCBjb2xsYXRlcmFsX21hcmtldF9pZCwgb2xkX2RlcG9zaXRfdmFsdWUsIG5ld19kZXBvc2l0X3ZhbHVlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtNQogICAgdW5jb3ZlciAzCiAgICB1bmNvdmVyIDMKICAgIGNhbGxzdWIgX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuVXBncmFkZWFibGUuc2V0X3ZlcnNpb24oY29udHJhY3RfdmVyc2lvbjogYnl0ZXMsIGRlcGxveW1lbnRfdmVyc2lvbjogYnl0ZXMpIC0+IHZvaWQ6CnNldF92ZXJzaW9uOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMtMTA2CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdmVyc2lvbigKICAgIC8vICAgICBzZWxmLCBjb250cmFjdF92ZXJzaW9uOiBhcmM0LlVJbnQ2NCwgZGVwbG95bWVudF92ZXJzaW9uOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNwogICAgLy8gYXJjNC5lbWl0KFZlcnNpb25VcGRhdGVkKGNvbnRyYWN0X3ZlcnNpb24sIGRlcGxveW1lbnRfdmVyc2lvbikpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY29uY2F0CiAgICBtZXRob2QgIlZlcnNpb25VcGRhdGVkKHVpbnQ2NCx1aW50NjQpIgogICAgc3dhcAogICAgY29uY2F0CiAgICBsb2cKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA4CiAgICAvLyBzZWxmLmNvbnRyYWN0X3ZlcnNpb24gPSBjb250cmFjdF92ZXJzaW9uLm5hdGl2ZQogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjU5CiAgICAvLyBzZWxmLmNvbnRyYWN0X3ZlcnNpb24gPSBVSW50NjQoKQogICAgYnl0ZSAiY29udHJhY3RfdmVyc2lvbiIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA4CiAgICAvLyBzZWxmLmNvbnRyYWN0X3ZlcnNpb24gPSBjb250cmFjdF92ZXJzaW9uLm5hdGl2ZQogICAgc3dhcAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA5CiAgICAvLyBzZWxmLmRlcGxveW1lbnRfdmVyc2lvbiA9IGRlcGxveW1lbnRfdmVyc2lvbi5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo2MAogICAgLy8gc2VsZi5kZXBsb3ltZW50X3ZlcnNpb24gPSBVSW50NjQoKQogICAgYnl0ZSAiZGVwbG95bWVudF92ZXJzaW9uIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDkKICAgIC8vIHNlbGYuZGVwbG95bWVudF92ZXJzaW9uID0gZGVwbG95bWVudF92ZXJzaW9uLm5hdGl2ZQogICAgc3dhcAogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LlVwZ3JhZGVhYmxlLmdyYW50X3VwZ3JhZGVyKHVwZ3JhZGVyOiBieXRlcykgLT4gdm9pZDoKZ3JhbnRfdXBncmFkZXI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNy0xMjgKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdyYW50X3VwZ3JhZGVyKHNlbGYsIHVwZ3JhZGVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI5CiAgICAvLyBhc3NlcnQgVHhuLnNlbmRlciA9PSBHbG9iYWwuY3JlYXRvcl9hZGRyZXNzLCAibXVzdCBiZSBjcmVhdG9yIgogICAgdHhuIFNlbmRlcgogICAgZ2xvYmFsIENyZWF0b3JBZGRyZXNzCiAgICA9PQogICAgYXNzZXJ0IC8vIG11c3QgYmUgY3JlYXRvcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzAKICAgIC8vIGFyYzQuZW1pdChVcGdyYWRlckdyYW50ZWQoYXJjNC5BZGRyZXNzKHNlbGYudXBncmFkZXIpLCB1cGdyYWRlcikpCiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo2MgogICAgLy8gc2VsZi51cGdyYWRlciA9IEFjY291bnQoKQogICAgYnl0ZSAidXBncmFkZXIiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMAogICAgLy8gYXJjNC5lbWl0KFVwZ3JhZGVyR3JhbnRlZChhcmM0LkFkZHJlc3Moc2VsZi51cGdyYWRlciksIHVwZ3JhZGVyKSkKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi51cGdyYWRlciBleGlzdHMKICAgIGZyYW1lX2RpZyAtMQogICAgY29uY2F0CiAgICBtZXRob2QgIlVwZ3JhZGVyR3JhbnRlZChhZGRyZXNzLGFkZHJlc3MpIgogICAgc3dhcAogICAgY29uY2F0CiAgICBsb2cKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NjIKICAgIC8vIHNlbGYudXBncmFkZXIgPSBBY2NvdW50KCkKICAgIGJ5dGUgInVwZ3JhZGVyIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzEKICAgIC8vIHNlbGYudXBncmFkZXIgPSB1cGdyYWRlci5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMQogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LlVwZ3JhZGVhYmxlLm9uX3VwZGF0ZSgpIC0+IHZvaWQ6Cm9uX3VwZGF0ZToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTExLTExMgogICAgLy8gQGFyYzQuYmFyZW1ldGhvZChhbGxvd19hY3Rpb25zPVsiVXBkYXRlQXBwbGljYXRpb24iXSkKICAgIC8vIGRlZiBvbl91cGRhdGUoc2VsZikgLT4gTm9uZToKICAgIHByb3RvIDAgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTMtMTE2CiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICMgV0FSTklORzogVGhpcyBhcHAgY2FuIGJlIHVwZGF0ZWQgYnkgdGhlIGNyZWF0b3IKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi51cGdyYWRlciwgIm11c3QgYmUgdXBncmFkZXIiCiAgICB0eG4gU2VuZGVyCiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo2MgogICAgLy8gc2VsZi51cGdyYWRlciA9IEFjY291bnQoKQogICAgYnl0ZSAidXBncmFkZXIiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMy0xMTYKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIyBXQVJOSU5HOiBUaGlzIGFwcCBjYW4gYmUgdXBkYXRlZCBieSB0aGUgY3JlYXRvcgogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLnVwZ3JhZGVyLCAibXVzdCBiZSB1cGdyYWRlciIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi51cGdyYWRlciBleGlzdHMKICAgID09CiAgICBhc3NlcnQgLy8gbXVzdCBiZSB1cGdyYWRlcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTcKICAgIC8vIGFzc2VydCBzZWxmLnVwZGF0YWJsZSA9PSBVSW50NjQoMSksICJub3QgYXBwcm92ZWQiCiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo2MQogICAgLy8gc2VsZi51cGRhdGFibGUgPSBib29sKDEpCiAgICBieXRlICJ1cGRhdGFibGUiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNwogICAgLy8gYXNzZXJ0IHNlbGYudXBkYXRhYmxlID09IFVJbnQ2NCgxKSwgIm5vdCBhcHByb3ZlZCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi51cGRhdGFibGUgZXhpc3RzCiAgICBpbnQgMQogICAgPT0KICAgIGFzc2VydCAvLyBub3QgYXBwcm92ZWQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkRvcmtGaUxlbmRpbmdQb29sLl9faW5pdF9fKCkgLT4gdm9pZDoKX19pbml0X186CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMxOTgKICAgIC8vIGRlZiBfX2luaXRfXyhzZWxmKSAtPiBOb25lOgogICAgcHJvdG8gMCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5Ojk2NQogICAgLy8gc2VsZi5vd25lciA9IEFjY291bnQoKQogICAgYnl0ZSAib3duZXIiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMxOTktMzIwMAogICAgLy8gIyBvd25hYmxlIHN0YXRlCiAgICAvLyBzZWxmLm93bmVyID0gR2xvYmFsLmNyZWF0b3JfYWRkcmVzcwogICAgZ2xvYmFsIENyZWF0b3JBZGRyZXNzCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjYKICAgIC8vIHNlbGYucGF1c2VkID0gVUludDY0KCkKICAgIGJ5dGUgInBhdXNlZCIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIwMS0zMjAyCiAgICAvLyAjIGxlbmRpbmcgcG9vbCBzdGF0ZQogICAgLy8gc2VsZi5wYXVzZWQgPSBVSW50NjQoMSkKICAgIGludCAxCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo5NjcKICAgIC8vIHNlbGYuc3Rva2VuX2FwcF9pZCA9IFVJbnQ2NCgpICAjIHN0YWJsZSBtYXJrZXQKICAgIGJ5dGUgInN0b2tlbl9hcHBfaWQiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMDMKICAgIC8vIHNlbGYuc3Rva2VuX2FwcF9pZCA9IFVJbnQ2NCgwKSAgIyBzdGFibGUgbWFya2V0CiAgICBpbnQgMAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6OTY4CiAgICAvLyBzZWxmLnNlY29uZHNfcGVyX3llYXIgPSBVSW50NjQoKSAgIyBzZWNvbmRzIHBlciB5ZWFyCiAgICBieXRlICJzZWNvbmRzX3Blcl95ZWFyIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjA0CiAgICAvLyBzZWxmLnNlY29uZHNfcGVyX3llYXIgPSBVSW50NjQoU0VDT05EU19QRVJfWUVBUikKICAgIGludCAzMTUzNjAwMAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NTkKICAgIC8vIHNlbGYuY29udHJhY3RfdmVyc2lvbiA9IFVJbnQ2NCgpCiAgICBieXRlICJjb250cmFjdF92ZXJzaW9uIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjA1LTMyMDYKICAgIC8vICMgdXBncmFkZWFibGUgc3RhdGUKICAgIC8vIHNlbGYuY29udHJhY3RfdmVyc2lvbiA9IFVJbnQ2NCgwKQogICAgaW50IDAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjYwCiAgICAvLyBzZWxmLmRlcGxveW1lbnRfdmVyc2lvbiA9IFVJbnQ2NCgpCiAgICBieXRlICJkZXBsb3ltZW50X3ZlcnNpb24iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMDcKICAgIC8vIHNlbGYuZGVwbG95bWVudF92ZXJzaW9uID0gVUludDY0KDQpCiAgICBpbnQgNAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NjEKICAgIC8vIHNlbGYudXBkYXRhYmxlID0gYm9vbCgxKQogICAgYnl0ZSAidXBkYXRhYmxlIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjA4CiAgICAvLyBzZWxmLnVwZGF0YWJsZSA9IGJvb2woMSkKICAgIGludCAxCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo2MgogICAgLy8gc2VsZi51cGdyYWRlciA9IEFjY291bnQoKQogICAgYnl0ZSAidXBncmFkZXIiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMDkKICAgIC8vIHNlbGYudXBncmFkZXIgPSBHbG9iYWwuY3JlYXRvcl9hZGRyZXNzCiAgICBnbG9iYWwgQ3JlYXRvckFkZHJlc3MKICAgIGFwcF9nbG9iYWxfcHV0CiAgICByZXRzdWIK",
    "clear": "I3ByYWdtYSB2ZXJzaW9uIDEwCgpjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5jbGVhcl9zdGF0ZV9wcm9ncmFtOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMTk2CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUpOgogICAgaW50IDEKICAgIHJldHVybgo="
  },
  "state": {
    "global": {
      "num_byte_slices": 2,
      "num_uints": 6
    },
    "local": {
      "num_byte_slices": 0,
      "num_uints": 0
    }
  },
  "schema": {
    "global": {
      "declared": {
        "contract_version": {
          "type": "uint64",
          "key": "contract_version"
        },
        "deployment_version": {
          "type": "uint64",
          "key": "deployment_version"
        },
        "owner": {
          "type": "bytes",
          "key": "owner"
        },
        "paused": {
          "type": "uint64",
          "key": "paused"
        },
        "seconds_per_year": {
          "type": "uint64",
          "key": "seconds_per_year"
        },
        "stoken_app_id": {
          "type": "uint64",
          "key": "stoken_app_id"
        },
        "updatable": {
          "type": "uint64",
          "key": "updatable"
        },
        "upgrader": {
          "type": "bytes",
          "key": "upgrader"
        }
      },
      "reserved": {}
    },
    "local": {
      "declared": {},
      "reserved": {}
    }
  },
  "contract": {
    "name": "DorkFiLendingPool",
    "methods": [
      {
        "name": "post_update",
        "args": [],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_owner",
        "args": [],
        "readonly": true,
        "returns": {
          "type": "address"
        }
      },
      {
        "name": "transfer_ownership",
        "args": [
          {
            "type": "address",
            "name": "new_owner"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "is_paused",
        "args": [],
        "readonly": false,
        "returns": {
          "type": "bool"
        }
      },
      {
        "name": "pause",
        "args": [
          {
            "type": "uint64",
            "name": "pause"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "set_stoken_app_id",
        "args": [
          {
            "type": "uint64",
            "name": "stoken_app_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_user",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          },
          {
            "type": "uint64",
            "name": "market_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "(uint256,uint256,uint256,uint256,uint64,uint256)"
        }
      },
      {
        "name": "create_market",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "uint64",
            "name": "collateral_factor"
          },
          {
            "type": "uint64",
            "name": "liquidation_threshold"
          },
          {
            "type": "uint64",
            "name": "reserve_factor"
          },
          {
            "type": "uint64",
            "name": "borrow_rate"
          },
          {
            "type": "uint64",
            "name": "slope"
          },
          {
            "type": "uint256",
            "name": "max_total_deposits"
          },
          {
            "type": "uint256",
            "name": "max_total_borrows"
          },
          {
            "type": "uint64",
            "name": "liquidation_bonus"
          },
          {
            "type": "uint64",
            "name": "close_factor"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "uint64"
        }
      },
      {
        "name": "set_storage_app_id",
        "args": [
          {
            "type": "uint64",
            "name": "storage_app_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_market",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": true,
        "returns": {
          "type": "(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)"
        }
      },
      {
        "name": "get_market_transaction_cap",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "(uint256,uint256,uint256,uint256)"
        }
      },
      {
        "name": "get_user_cap",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "(uint256,uint256,uint256,uint256,uint256,uint256,uint64)"
        }
      },
      {
        "name": "set_user_cap",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          },
          {
            "type": "(uint256,uint256,uint256,uint256,uint256,uint256,uint64)",
            "name": "user_cap"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "set_market_transaction_cap",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "(uint256,uint256,uint256,uint256)",
            "name": "transaction_cap"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_price_feed",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "(uint64,uint64,(uint256,uint64))"
        }
      },
      {
        "name": "set_authorized_price_operator",
        "args": [
          {
            "type": "address",
            "name": "operator_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "attach_price_feed",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "uint64",
            "name": "provider_app_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "detach_price_feed",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "set_market_price",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "uint256",
            "name": "price"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "fetch_price_feed",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "set_market_max_total_deposits",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "uint256",
            "name": "max_total_deposits"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "pause_market",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "uint64",
            "name": "pause"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "sync_market",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "withdraw_reserves",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "deposit",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "withdraw",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "uint256"
        }
      },
      {
        "name": "borrow",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "repay",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "sync_user_market_for_price_change",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          },
          {
            "type": "uint64",
            "name": "market_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_global_user",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "(uint256,uint256,uint64)"
        }
      },
      {
        "name": "liquidate_cross_market",
        "args": [
          {
            "type": "uint64",
            "name": "debt_market_id"
          },
          {
            "type": "uint64",
            "name": "collateral_market_id"
          },
          {
            "type": "address",
            "name": "user"
          },
          {
            "type": "uint256",
            "name": "debt_amount"
          },
          {
            "type": "uint256",
            "name": "min_collateral_received"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "set_version",
        "args": [
          {
            "type": "uint64",
            "name": "contract_version"
          },
          {
            "type": "uint64",
            "name": "deployment_version"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "grant_upgrader",
        "args": [
          {
            "type": "address",
            "name": "upgrader"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "approve_update",
        "args": [
          {
            "type": "bool",
            "name": "approval"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        },
        "desc": "Approve update."
      }
    ],
    "networks": {}
  },
  "bare_call_config": {
    "update_application": "CALL",
    "no_op": "CREATE"
  }
}

/**
 * Defines an onCompletionAction of 'no_op'
 */
export type OnCompleteNoOp =  { onCompleteAction?: 'no_op' | OnApplicationComplete.NoOpOC }
/**
 * Defines an onCompletionAction of 'opt_in'
 */
export type OnCompleteOptIn =  { onCompleteAction: 'opt_in' | OnApplicationComplete.OptInOC }
/**
 * Defines an onCompletionAction of 'close_out'
 */
export type OnCompleteCloseOut =  { onCompleteAction: 'close_out' | OnApplicationComplete.CloseOutOC }
/**
 * Defines an onCompletionAction of 'delete_application'
 */
export type OnCompleteDelApp =  { onCompleteAction: 'delete_application' | OnApplicationComplete.DeleteApplicationOC }
/**
 * Defines an onCompletionAction of 'update_application'
 */
export type OnCompleteUpdApp =  { onCompleteAction: 'update_application' | OnApplicationComplete.UpdateApplicationOC }
/**
 * A state record containing a single unsigned integer
 */
export type IntegerState = {
  /**
   * Gets the state value as a BigInt.
   */
  asBigInt(): bigint
  /**
   * Gets the state value as a number.
   */
  asNumber(): number
}
/**
 * A state record containing binary data
 */
export type BinaryState = {
  /**
   * Gets the state value as a Uint8Array
   */
  asByteArray(): Uint8Array
  /**
   * Gets the state value as a string
   */
  asString(): string
}

export type AppCreateCallTransactionResult = AppCallTransactionResult & Partial<AppCompilationResult> & AppReference
export type AppUpdateCallTransactionResult = AppCallTransactionResult & Partial<AppCompilationResult>

export type AppClientComposeCallCoreParams = Omit<AppClientCallCoreParams, 'sendParams'> & {
  sendParams?: Omit<SendTransactionParams, 'skipSending' | 'atc' | 'skipWaiting' | 'maxRoundsToWaitForConfirmation' | 'populateAppCallResources'>
}
export type AppClientComposeExecuteParams = Pick<SendTransactionParams, 'skipWaiting' | 'maxRoundsToWaitForConfirmation' | 'populateAppCallResources' | 'suppressLog'>

/**
 * Defines the types of available calls and state of the DorkFiLendingPool smart contract.
 */
export type DorkFiLendingPool = {
  /**
   * Maps method signatures / names to their argument and return types.
   */
  methods:
    & Record<'post_update()void' | 'post_update', {
      argsObj: {
      }
      argsTuple: []
      returns: void
    }>
    & Record<'get_owner()address' | 'get_owner', {
      argsObj: {
      }
      argsTuple: []
      returns: string
    }>
    & Record<'transfer_ownership(address)void' | 'transfer_ownership', {
      argsObj: {
        newOwner: string
      }
      argsTuple: [newOwner: string]
      returns: void
    }>
    & Record<'is_paused()bool' | 'is_paused', {
      argsObj: {
      }
      argsTuple: []
      returns: boolean
    }>
    & Record<'pause(uint64)void' | 'pause', {
      argsObj: {
        pause: bigint | number
      }
      argsTuple: [pause: bigint | number]
      returns: void
    }>
    & Record<'set_stoken_app_id(uint64)void' | 'set_stoken_app_id', {
      argsObj: {
        stokenAppId: bigint | number
      }
      argsTuple: [stokenAppId: bigint | number]
      returns: void
    }>
    & Record<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)' | 'get_user', {
      argsObj: {
        userId: string
        marketId: bigint | number
      }
      argsTuple: [userId: string, marketId: bigint | number]
      returns: UserData
    }>
    & Record<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64' | 'create_market', {
      argsObj: {
        tokenId: bigint | number
        collateralFactor: bigint | number
        liquidationThreshold: bigint | number
        reserveFactor: bigint | number
        borrowRate: bigint | number
        slope: bigint | number
        maxTotalDeposits: bigint | number
        maxTotalBorrows: bigint | number
        liquidationBonus: bigint | number
        closeFactor: bigint | number
      }
      argsTuple: [tokenId: bigint | number, collateralFactor: bigint | number, liquidationThreshold: bigint | number, reserveFactor: bigint | number, borrowRate: bigint | number, slope: bigint | number, maxTotalDeposits: bigint | number, maxTotalBorrows: bigint | number, liquidationBonus: bigint | number, closeFactor: bigint | number]
      returns: bigint
    }>
    & Record<'set_storage_app_id(uint64)void' | 'set_storage_app_id', {
      argsObj: {
        storageAppId: bigint | number
      }
      argsTuple: [storageAppId: bigint | number]
      returns: void
    }>
    & Record<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)' | 'get_market', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: MarketData
    }>
    & Record<'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)' | 'get_market_transaction_cap', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: MarketTransactionCap
    }>
    & Record<'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)' | 'get_user_cap', {
      argsObj: {
        userId: string
      }
      argsTuple: [userId: string]
      returns: UserCap
    }>
    & Record<'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void' | 'set_user_cap', {
      argsObj: {
        userId: string
        userCap: [bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number]
      }
      argsTuple: [userId: string, userCap: [bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number]]
      returns: void
    }>
    & Record<'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void' | 'set_market_transaction_cap', {
      argsObj: {
        tokenId: bigint | number
        transactionCap: [bigint | number, bigint | number, bigint | number, bigint | number]
      }
      argsTuple: [tokenId: bigint | number, transactionCap: [bigint | number, bigint | number, bigint | number, bigint | number]]
      returns: void
    }>
    & Record<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))' | 'get_price_feed', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: PriceFeed
    }>
    & Record<'set_authorized_price_operator(address)void' | 'set_authorized_price_operator', {
      argsObj: {
        operatorId: string
      }
      argsTuple: [operatorId: string]
      returns: void
    }>
    & Record<'attach_price_feed(uint64,uint64)void' | 'attach_price_feed', {
      argsObj: {
        tokenId: bigint | number
        providerAppId: bigint | number
      }
      argsTuple: [tokenId: bigint | number, providerAppId: bigint | number]
      returns: void
    }>
    & Record<'detach_price_feed(uint64)void' | 'detach_price_feed', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: void
    }>
    & Record<'set_market_price(uint64,uint256)void' | 'set_market_price', {
      argsObj: {
        tokenId: bigint | number
        price: bigint | number
      }
      argsTuple: [tokenId: bigint | number, price: bigint | number]
      returns: void
    }>
    & Record<'fetch_price_feed(uint64)void' | 'fetch_price_feed', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: void
    }>
    & Record<'set_market_max_total_deposits(uint64,uint256)void' | 'set_market_max_total_deposits', {
      argsObj: {
        tokenId: bigint | number
        maxTotalDeposits: bigint | number
      }
      argsTuple: [tokenId: bigint | number, maxTotalDeposits: bigint | number]
      returns: void
    }>
    & Record<'pause_market(uint64,uint64)void' | 'pause_market', {
      argsObj: {
        tokenId: bigint | number
        pause: bigint | number
      }
      argsTuple: [tokenId: bigint | number, pause: bigint | number]
      returns: void
    }>
    & Record<'sync_market(uint64)void' | 'sync_market', {
      argsObj: {
        marketId: bigint | number
      }
      argsTuple: [marketId: bigint | number]
      returns: void
    }>
    & Record<'withdraw_reserves(uint64,uint256)void' | 'withdraw_reserves', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: void
    }>
    & Record<'deposit(uint64,uint256)void' | 'deposit', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: void
    }>
    & Record<'withdraw(uint64,uint256)uint256' | 'withdraw', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: bigint
    }>
    & Record<'borrow(uint64,uint256)void' | 'borrow', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: void
    }>
    & Record<'repay(uint64,uint256)void' | 'repay', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: void
    }>
    & Record<'sync_user_market_for_price_change(address,uint64)void' | 'sync_user_market_for_price_change', {
      argsObj: {
        userId: string
        marketId: bigint | number
      }
      argsTuple: [userId: string, marketId: bigint | number]
      returns: void
    }>
    & Record<'get_global_user(address)(uint256,uint256,uint64)' | 'get_global_user', {
      argsObj: {
        userId: string
      }
      argsTuple: [userId: string]
      returns: GlobalUserData
    }>
    & Record<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void' | 'liquidate_cross_market', {
      argsObj: {
        debtMarketId: bigint | number
        collateralMarketId: bigint | number
        user: string
        debtAmount: bigint | number
        minCollateralReceived: bigint | number
      }
      argsTuple: [debtMarketId: bigint | number, collateralMarketId: bigint | number, user: string, debtAmount: bigint | number, minCollateralReceived: bigint | number]
      returns: void
    }>
    & Record<'set_version(uint64,uint64)void' | 'set_version', {
      argsObj: {
        contractVersion: bigint | number
        deploymentVersion: bigint | number
      }
      argsTuple: [contractVersion: bigint | number, deploymentVersion: bigint | number]
      returns: void
    }>
    & Record<'grant_upgrader(address)void' | 'grant_upgrader', {
      argsObj: {
        upgrader: string
      }
      argsTuple: [upgrader: string]
      returns: void
    }>
    & Record<'approve_update(bool)void' | 'approve_update', {
      argsObj: {
        approval: boolean
      }
      argsTuple: [approval: boolean]
      returns: void
    }>
  /**
   * Defines the shape of the global and local state of the application.
   */
  state: {
    global: {
      contractVersion?: IntegerState
      deploymentVersion?: IntegerState
      owner?: BinaryState
      paused?: IntegerState
      secondsPerYear?: IntegerState
      stokenAppId?: IntegerState
      updatable?: IntegerState
      upgrader?: BinaryState
    }
  }
}
/**
 * Defines the possible abi call signatures
 */
export type DorkFiLendingPoolSig = keyof DorkFiLendingPool['methods']
/**
 * Defines an object containing all relevant parameters for a single call to the contract. Where TSignature is undefined, a bare call is made
 */
export type TypedCallParams<TSignature extends DorkFiLendingPoolSig | undefined> = {
  method: TSignature
  methodArgs: TSignature extends undefined ? undefined : Array<ABIAppCallArg | undefined>
} & AppClientCallCoreParams & CoreAppCallArgs
/**
 * Defines the arguments required for a bare call
 */
export type BareCallArgs = Omit<RawAppCallArgs, keyof CoreAppCallArgs>
/**
 * Represents a UserData result as a struct
 */
export type UserData = {
  scaledDeposits: bigint
  scaledBorrows: bigint
  depositIndex: bigint
  borrowIndex: bigint
  lastUpdateTime: bigint
  lastPrice: bigint
}
/**
 * Converts the tuple representation of a UserData to the struct representation
 */
export function UserData([scaledDeposits, scaledBorrows, depositIndex, borrowIndex, lastUpdateTime, lastPrice]: [bigint, bigint, bigint, bigint, bigint, bigint] ) {
  return {
    scaledDeposits,
    scaledBorrows,
    depositIndex,
    borrowIndex,
    lastUpdateTime,
    lastPrice,
  }
}
/**
 * Represents a MarketData result as a struct
 */
export type MarketData = {
  paused: boolean
  maxTotalDeposits: bigint
  maxTotalBorrows: bigint
  liquidationBonus: bigint
  collateralFactor: bigint
  liquidationThreshold: bigint
  reserveFactor: bigint
  borrowRate: bigint
  slope: bigint
  totalScaledDeposits: bigint
  totalScaledBorrows: bigint
  depositIndex: bigint
  borrowIndex: bigint
  lastUpdateTime: bigint
  reserves: bigint
  price: bigint
  ntokenId: bigint
  closeFactor: bigint
}
/**
 * Converts the tuple representation of a MarketData to the struct representation
 */
export function MarketData([paused, maxTotalDeposits, maxTotalBorrows, liquidationBonus, collateralFactor, liquidationThreshold, reserveFactor, borrowRate, slope, totalScaledDeposits, totalScaledBorrows, depositIndex, borrowIndex, lastUpdateTime, reserves, price, ntokenId, closeFactor]: [boolean, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint] ) {
  return {
    paused,
    maxTotalDeposits,
    maxTotalBorrows,
    liquidationBonus,
    collateralFactor,
    liquidationThreshold,
    reserveFactor,
    borrowRate,
    slope,
    totalScaledDeposits,
    totalScaledBorrows,
    depositIndex,
    borrowIndex,
    lastUpdateTime,
    reserves,
    price,
    ntokenId,
    closeFactor,
  }
}
/**
 * Represents a MarketTransactionCap result as a struct
 */
export type MarketTransactionCap = {
  deposit: bigint
  withdraw: bigint
  borrow: bigint
  liquidate: bigint
}
/**
 * Converts the tuple representation of a MarketTransactionCap to the struct representation
 */
export function MarketTransactionCap([deposit, withdraw, borrow, liquidate]: [bigint, bigint, bigint, bigint] ) {
  return {
    deposit,
    withdraw,
    borrow,
    liquidate,
  }
}
/**
 * Represents a UserCap result as a struct
 */
export type UserCap = {
  totalDeposits: bigint
  totalBorrows: bigint
  totalLiquidations: bigint
  totalWithdrawals: bigint
  dailyLiquidations: bigint
  dailyWithdrawals: bigint
  dailyResetTime: bigint
}
/**
 * Converts the tuple representation of a UserCap to the struct representation
 */
export function UserCap([totalDeposits, totalBorrows, totalLiquidations, totalWithdrawals, dailyLiquidations, dailyWithdrawals, dailyResetTime]: [bigint, bigint, bigint, bigint, bigint, bigint, bigint] ) {
  return {
    totalDeposits,
    totalBorrows,
    totalLiquidations,
    totalWithdrawals,
    dailyLiquidations,
    dailyWithdrawals,
    dailyResetTime,
  }
}
/**
 * Represents a UserCap result as a struct
 */
/**
 * Converts the tuple representation of a UserCap to the struct representation
 */
/**
 * Represents a MarketTransactionCap result as a struct
 */
/**
 * Converts the tuple representation of a MarketTransactionCap to the struct representation
 */
/**
 * Represents a PriceFeed result as a struct
 */
export type PriceFeed = {
  marketId: bigint
  providerAppId: bigint
  priceWithTimestamp: [bigint, bigint]
}
/**
 * Converts the tuple representation of a PriceFeed to the struct representation
 */
export function PriceFeed([marketId, providerAppId, priceWithTimestamp]: [bigint, bigint, [bigint, bigint]] ) {
  return {
    marketId,
    providerAppId,
    priceWithTimestamp,
  }
}
/**
 * Represents a GlobalUserData result as a struct
 */
export type GlobalUserData = {
  totalCollateralValue: bigint
  totalBorrowValue: bigint
  lastUpdateTime: bigint
}
/**
 * Converts the tuple representation of a GlobalUserData to the struct representation
 */
export function GlobalUserData([totalCollateralValue, totalBorrowValue, lastUpdateTime]: [bigint, bigint, bigint] ) {
  return {
    totalCollateralValue,
    totalBorrowValue,
    lastUpdateTime,
  }
}
/**
 * Maps a method signature from the DorkFiLendingPool smart contract to the method's arguments in either tuple of struct form
 */
export type MethodArgs<TSignature extends DorkFiLendingPoolSig> = DorkFiLendingPool['methods'][TSignature]['argsObj' | 'argsTuple']
/**
 * Maps a method signature from the DorkFiLendingPool smart contract to the method's return type
 */
export type MethodReturn<TSignature extends DorkFiLendingPoolSig> = DorkFiLendingPool['methods'][TSignature]['returns']

/**
 * A factory for available 'create' calls
 */
export type DorkFiLendingPoolCreateCalls = (typeof DorkFiLendingPoolCallFactory)['create']
/**
 * Defines supported create methods for this smart contract
 */
export type DorkFiLendingPoolCreateCallParams =
  | (TypedCallParams<undefined> & (OnCompleteNoOp))
/**
 * A factory for available 'update' calls
 */
export type DorkFiLendingPoolUpdateCalls = (typeof DorkFiLendingPoolCallFactory)['update']
/**
 * Defines supported update methods for this smart contract
 */
export type DorkFiLendingPoolUpdateCallParams =
  | TypedCallParams<undefined>
/**
 * Defines arguments required for the deploy method.
 */
export type DorkFiLendingPoolDeployArgs = {
  deployTimeParams?: TealTemplateParams
  /**
   * A delegate which takes a create call factory and returns the create call params for this smart contract
   */
  createCall?: (callFactory: DorkFiLendingPoolCreateCalls) => DorkFiLendingPoolCreateCallParams
  /**
   * A delegate which takes a update call factory and returns the update call params for this smart contract
   */
  updateCall?: (callFactory: DorkFiLendingPoolUpdateCalls) => DorkFiLendingPoolUpdateCallParams
}


/**
 * Exposes methods for constructing all available smart contract calls
 */
export abstract class DorkFiLendingPoolCallFactory {
  /**
   * Gets available create call factories
   */
  static get create() {
    return {
      /**
       * Constructs a create call for the DorkFiLendingPool smart contract using a bare call
       *
       * @param params Any parameters for the call
       * @returns A TypedCallParams object for the call
       */
      bare(params: BareCallArgs & AppClientCallCoreParams & CoreAppCallArgs & AppClientCompilationParams & (OnCompleteNoOp) = {}) {
        return {
          method: undefined,
          methodArgs: undefined,
          ...params,
        }
      },
    }
  }

  /**
   * Gets available update call factories
   */
  static get update() {
    return {
      /**
       * Constructs an update call for the DorkFiLendingPool smart contract using a bare call
       *
       * @param params Any parameters for the call
       * @returns A TypedCallParams object for the call
       */
      bare(params: BareCallArgs & AppClientCallCoreParams & CoreAppCallArgs & AppClientCompilationParams = {}) {
        return {
          method: undefined,
          methodArgs: undefined,
          ...params,
        }
      },
    }
  }

  /**
   * Constructs a no op call for the post_update()void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static postUpdate(args: MethodArgs<'post_update()void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'post_update()void' as const,
      methodArgs: Array.isArray(args) ? args : [],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_owner()address ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getOwner(args: MethodArgs<'get_owner()address'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_owner()address' as const,
      methodArgs: Array.isArray(args) ? args : [],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the transfer_ownership(address)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static transferOwnership(args: MethodArgs<'transfer_ownership(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'transfer_ownership(address)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.newOwner],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the is_paused()bool ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static isPaused(args: MethodArgs<'is_paused()bool'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'is_paused()bool' as const,
      methodArgs: Array.isArray(args) ? args : [],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the pause(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static pause(args: MethodArgs<'pause(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'pause(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.pause],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_stoken_app_id(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setStokenAppId(args: MethodArgs<'set_stoken_app_id(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_stoken_app_id(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.stokenAppId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getUser(args: MethodArgs<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId, args.marketId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64 ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static createMarket(args: MethodArgs<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.collateralFactor, args.liquidationThreshold, args.reserveFactor, args.borrowRate, args.slope, args.maxTotalDeposits, args.maxTotalBorrows, args.liquidationBonus, args.closeFactor],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_storage_app_id(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setStorageAppId(args: MethodArgs<'set_storage_app_id(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_storage_app_id(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.storageAppId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getMarket(args: MethodArgs<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getMarketTransactionCap(args: MethodArgs<'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getUserCap(args: MethodArgs<'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setUserCap(args: MethodArgs<'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId, args.userCap],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setMarketTransactionCap(args: MethodArgs<'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.transactionCap],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_price_feed(uint64)(uint64,uint64,(uint256,uint64)) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getPriceFeed(args: MethodArgs<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_authorized_price_operator(address)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setAuthorizedPriceOperator(args: MethodArgs<'set_authorized_price_operator(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_authorized_price_operator(address)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.operatorId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the attach_price_feed(uint64,uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static attachPriceFeed(args: MethodArgs<'attach_price_feed(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'attach_price_feed(uint64,uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.providerAppId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the detach_price_feed(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static detachPriceFeed(args: MethodArgs<'detach_price_feed(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'detach_price_feed(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_market_price(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setMarketPrice(args: MethodArgs<'set_market_price(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_market_price(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.price],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the fetch_price_feed(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static fetchPriceFeed(args: MethodArgs<'fetch_price_feed(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'fetch_price_feed(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_market_max_total_deposits(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setMarketMaxTotalDeposits(args: MethodArgs<'set_market_max_total_deposits(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_market_max_total_deposits(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.maxTotalDeposits],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the pause_market(uint64,uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static pauseMarket(args: MethodArgs<'pause_market(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'pause_market(uint64,uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.pause],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the sync_market(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static syncMarket(args: MethodArgs<'sync_market(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'sync_market(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the withdraw_reserves(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static withdrawReserves(args: MethodArgs<'withdraw_reserves(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'withdraw_reserves(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the deposit(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static deposit(args: MethodArgs<'deposit(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'deposit(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the withdraw(uint64,uint256)uint256 ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static withdraw(args: MethodArgs<'withdraw(uint64,uint256)uint256'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'withdraw(uint64,uint256)uint256' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the borrow(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static borrow(args: MethodArgs<'borrow(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'borrow(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the repay(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static repay(args: MethodArgs<'repay(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'repay(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the sync_user_market_for_price_change(address,uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static syncUserMarketForPriceChange(args: MethodArgs<'sync_user_market_for_price_change(address,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'sync_user_market_for_price_change(address,uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId, args.marketId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_global_user(address)(uint256,uint256,uint64) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getGlobalUser(args: MethodArgs<'get_global_user(address)(uint256,uint256,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_global_user(address)(uint256,uint256,uint64)' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the liquidate_cross_market(uint64,uint64,address,uint256,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static liquidateCrossMarket(args: MethodArgs<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.debtMarketId, args.collateralMarketId, args.user, args.debtAmount, args.minCollateralReceived],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_version(uint64,uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setVersion(args: MethodArgs<'set_version(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_version(uint64,uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.contractVersion, args.deploymentVersion],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the grant_upgrader(address)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static grantUpgrader(args: MethodArgs<'grant_upgrader(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'grant_upgrader(address)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.upgrader],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the approve_update(bool)void ABI method
   *
   * Approve update.
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static approveUpdate(args: MethodArgs<'approve_update(bool)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'approve_update(bool)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.approval],
      ...params,
    }
  }
}

/**
 * A client to make calls to the DorkFiLendingPool smart contract
 */
export class DorkFiLendingPoolClient {
  /**
   * The underlying `ApplicationClient` for when you want to have more flexibility
   */
  public readonly appClient: ApplicationClient

  private readonly sender: SendTransactionFrom | undefined

  /**
   * Creates a new instance of `DorkFiLendingPoolClient`
   *
   * @param appDetails appDetails The details to identify the app to deploy
   * @param algod An algod client instance
   */
  constructor(appDetails: AppDetails, private algod: Algodv2) {
    this.sender = appDetails.sender
    this.appClient = algokit.getAppClient({
      ...appDetails,
      app: APP_SPEC
    }, algod)
  }

  /**
   * Checks for decode errors on the AppCallTransactionResult and maps the return value to the specified generic type
   *
   * @param result The AppCallTransactionResult to be mapped
   * @param returnValueFormatter An optional delegate to format the return value if required
   * @returns The smart contract response with an updated return value
   */
  protected mapReturnValue<TReturn, TResult extends AppCallTransactionResult = AppCallTransactionResult>(result: AppCallTransactionResult, returnValueFormatter?: (value: any) => TReturn): AppCallTransactionResultOfType<TReturn> & TResult {
    if(result.return?.decodeError) {
      throw result.return.decodeError
    }
    const returnValue = result.return?.returnValue !== undefined && returnValueFormatter !== undefined
      ? returnValueFormatter(result.return.returnValue)
      : result.return?.returnValue as TReturn | undefined
      return { ...result, return: returnValue } as AppCallTransactionResultOfType<TReturn> & TResult
  }

  /**
   * Calls the ABI method with the matching signature using an onCompletion code of NO_OP
   *
   * @param typedCallParams An object containing the method signature, args, and any other relevant parameters
   * @param returnValueFormatter An optional delegate which when provided will be used to map non-undefined return values to the target type
   * @returns The result of the smart contract call
   */
  public async call<TSignature extends keyof DorkFiLendingPool['methods']>(typedCallParams: TypedCallParams<TSignature>, returnValueFormatter?: (value: any) => MethodReturn<TSignature>) {
    return this.mapReturnValue<MethodReturn<TSignature>>(await this.appClient.call(typedCallParams), returnValueFormatter)
  }

  /**
   * Idempotently deploys the DorkFiLendingPool smart contract.
   *
   * @param params The arguments for the contract calls and any additional parameters for the call
   * @returns The deployment result
   */
  public deploy(params: DorkFiLendingPoolDeployArgs & AppClientDeployCoreParams = {}): ReturnType<ApplicationClient['deploy']> {
    const createArgs = params.createCall?.(DorkFiLendingPoolCallFactory.create)
    const updateArgs = params.updateCall?.(DorkFiLendingPoolCallFactory.update)
    return this.appClient.deploy({
      ...params,
      updateArgs,
      createArgs,
      createOnCompleteAction: createArgs?.onCompleteAction,
    })
  }

  /**
   * Gets available create methods
   */
  public get create() {
    const $this = this
    return {
      /**
       * Creates a new instance of the DorkFiLendingPool smart contract using a bare call.
       *
       * @param args The arguments for the bare call
       * @returns The create result
       */
      async bare(args: BareCallArgs & AppClientCallCoreParams & AppClientCompilationParams & CoreAppCallArgs & (OnCompleteNoOp) = {}) {
        return $this.mapReturnValue<undefined, AppCreateCallTransactionResult>(await $this.appClient.create(args))
      },
    }
  }

  /**
   * Gets available update methods
   */
  public get update() {
    const $this = this
    return {
      /**
       * Updates an existing instance of the DorkFiLendingPool smart contract using a bare call.
       *
       * @param args The arguments for the bare call
       * @returns The update result
       */
      async bare(args: BareCallArgs & AppClientCallCoreParams & AppClientCompilationParams & CoreAppCallArgs = {}) {
        return $this.mapReturnValue<undefined, AppUpdateCallTransactionResult>(await $this.appClient.update(args))
      },
    }
  }

  /**
   * Makes a clear_state call to an existing instance of the DorkFiLendingPool smart contract.
   *
   * @param args The arguments for the bare call
   * @returns The clear_state result
   */
  public clearState(args: BareCallArgs & AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.appClient.clearState(args)
  }

  /**
   * Calls the post_update()void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public postUpdate(args: MethodArgs<'post_update()void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.postUpdate(args, params))
  }

  /**
   * Calls the get_owner()address ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getOwner(args: MethodArgs<'get_owner()address'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getOwner(args, params))
  }

  /**
   * Calls the transfer_ownership(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public transferOwnership(args: MethodArgs<'transfer_ownership(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.transferOwnership(args, params))
  }

  /**
   * Calls the is_paused()bool ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public isPaused(args: MethodArgs<'is_paused()bool'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.isPaused(args, params))
  }

  /**
   * Calls the pause(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public pause(args: MethodArgs<'pause(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.pause(args, params))
  }

  /**
   * Calls the set_stoken_app_id(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setStokenAppId(args: MethodArgs<'set_stoken_app_id(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setStokenAppId(args, params))
  }

  /**
   * Calls the get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getUser(args: MethodArgs<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getUser(args, params), UserData)
  }

  /**
   * Calls the create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public createMarket(args: MethodArgs<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.createMarket(args, params))
  }

  /**
   * Calls the set_storage_app_id(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setStorageAppId(args: MethodArgs<'set_storage_app_id(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setStorageAppId(args, params))
  }

  /**
   * Calls the get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getMarket(args: MethodArgs<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getMarket(args, params), MarketData)
  }

  /**
   * Calls the get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getMarketTransactionCap(args: MethodArgs<'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getMarketTransactionCap(args, params), MarketTransactionCap)
  }

  /**
   * Calls the get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getUserCap(args: MethodArgs<'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getUserCap(args, params), UserCap)
  }

  /**
   * Calls the set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setUserCap(args: MethodArgs<'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setUserCap(args, params))
  }

  /**
   * Calls the set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setMarketTransactionCap(args: MethodArgs<'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setMarketTransactionCap(args, params))
  }

  /**
   * Calls the get_price_feed(uint64)(uint64,uint64,(uint256,uint64)) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getPriceFeed(args: MethodArgs<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getPriceFeed(args, params), PriceFeed)
  }

  /**
   * Calls the set_authorized_price_operator(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setAuthorizedPriceOperator(args: MethodArgs<'set_authorized_price_operator(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setAuthorizedPriceOperator(args, params))
  }

  /**
   * Calls the attach_price_feed(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public attachPriceFeed(args: MethodArgs<'attach_price_feed(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.attachPriceFeed(args, params))
  }

  /**
   * Calls the detach_price_feed(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public detachPriceFeed(args: MethodArgs<'detach_price_feed(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.detachPriceFeed(args, params))
  }

  /**
   * Calls the set_market_price(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setMarketPrice(args: MethodArgs<'set_market_price(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setMarketPrice(args, params))
  }

  /**
   * Calls the fetch_price_feed(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public fetchPriceFeed(args: MethodArgs<'fetch_price_feed(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.fetchPriceFeed(args, params))
  }

  /**
   * Calls the set_market_max_total_deposits(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setMarketMaxTotalDeposits(args: MethodArgs<'set_market_max_total_deposits(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setMarketMaxTotalDeposits(args, params))
  }

  /**
   * Calls the pause_market(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public pauseMarket(args: MethodArgs<'pause_market(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.pauseMarket(args, params))
  }

  /**
   * Calls the sync_market(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public syncMarket(args: MethodArgs<'sync_market(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.syncMarket(args, params))
  }

  /**
   * Calls the withdraw_reserves(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public withdrawReserves(args: MethodArgs<'withdraw_reserves(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.withdrawReserves(args, params))
  }

  /**
   * Calls the deposit(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public deposit(args: MethodArgs<'deposit(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.deposit(args, params))
  }

  /**
   * Calls the withdraw(uint64,uint256)uint256 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public withdraw(args: MethodArgs<'withdraw(uint64,uint256)uint256'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.withdraw(args, params))
  }

  /**
   * Calls the borrow(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public borrow(args: MethodArgs<'borrow(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.borrow(args, params))
  }

  /**
   * Calls the repay(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public repay(args: MethodArgs<'repay(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.repay(args, params))
  }

  /**
   * Calls the sync_user_market_for_price_change(address,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public syncUserMarketForPriceChange(args: MethodArgs<'sync_user_market_for_price_change(address,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.syncUserMarketForPriceChange(args, params))
  }

  /**
   * Calls the get_global_user(address)(uint256,uint256,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getGlobalUser(args: MethodArgs<'get_global_user(address)(uint256,uint256,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getGlobalUser(args, params), GlobalUserData)
  }

  /**
   * Calls the liquidate_cross_market(uint64,uint64,address,uint256,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public liquidateCrossMarket(args: MethodArgs<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.liquidateCrossMarket(args, params))
  }

  /**
   * Calls the set_version(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setVersion(args: MethodArgs<'set_version(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setVersion(args, params))
  }

  /**
   * Calls the grant_upgrader(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public grantUpgrader(args: MethodArgs<'grant_upgrader(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.grantUpgrader(args, params))
  }

  /**
   * Calls the approve_update(bool)void ABI method.
   *
   * Approve update.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public approveUpdate(args: MethodArgs<'approve_update(bool)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.approveUpdate(args, params))
  }

  /**
   * Extracts a binary state value out of an AppState dictionary
   *
   * @param state The state dictionary containing the state value
   * @param key The key of the state value
   * @returns A BinaryState instance containing the state value, or undefined if the key was not found
   */
  private static getBinaryState(state: AppState, key: string): BinaryState | undefined {
    const value = state[key]
    if (!value) return undefined
    if (!('valueRaw' in value))
      throw new Error(`Failed to parse state value for ${key}; received an int when expected a byte array`)
    return {
      asString(): string {
        return value.value
      },
      asByteArray(): Uint8Array {
        return value.valueRaw
      }
    }
  }

  /**
   * Extracts a integer state value out of an AppState dictionary
   *
   * @param state The state dictionary containing the state value
   * @param key The key of the state value
   * @returns An IntegerState instance containing the state value, or undefined if the key was not found
   */
  private static getIntegerState(state: AppState, key: string): IntegerState | undefined {
    const value = state[key]
    if (!value) return undefined
    if ('valueRaw' in value)
      throw new Error(`Failed to parse state value for ${key}; received a byte array when expected a number`)
    return {
      asBigInt() {
        return typeof value.value === 'bigint' ? value.value : BigInt(value.value)
      },
      asNumber(): number {
        return typeof value.value === 'bigint' ? Number(value.value) : value.value
      },
    }
  }

  /**
   * Returns the smart contract's global state wrapped in a strongly typed accessor with options to format the stored value
   */
  public async getGlobalState(): Promise<DorkFiLendingPool['state']['global']> {
    const state = await this.appClient.getGlobalState()
    return {
      get contractVersion() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'contract_version')
      },
      get deploymentVersion() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'deployment_version')
      },
      get owner() {
        return DorkFiLendingPoolClient.getBinaryState(state, 'owner')
      },
      get paused() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'paused')
      },
      get secondsPerYear() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'seconds_per_year')
      },
      get stokenAppId() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'stoken_app_id')
      },
      get updatable() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'updatable')
      },
      get upgrader() {
        return DorkFiLendingPoolClient.getBinaryState(state, 'upgrader')
      },
    }
  }

  public compose(): DorkFiLendingPoolComposer {
    const client = this
    const atc = new AtomicTransactionComposer()
    let promiseChain:Promise<unknown> = Promise.resolve()
    const resultMappers: Array<undefined | ((x: any) => any)> = []
    return {
      postUpdate(args: MethodArgs<'post_update()void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.postUpdate(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getOwner(args: MethodArgs<'get_owner()address'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getOwner(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      transferOwnership(args: MethodArgs<'transfer_ownership(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.transferOwnership(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      isPaused(args: MethodArgs<'is_paused()bool'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.isPaused(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      pause(args: MethodArgs<'pause(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.pause(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setStokenAppId(args: MethodArgs<'set_stoken_app_id(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setStokenAppId(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getUser(args: MethodArgs<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getUser(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(UserData)
        return this
      },
      createMarket(args: MethodArgs<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.createMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setStorageAppId(args: MethodArgs<'set_storage_app_id(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setStorageAppId(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getMarket(args: MethodArgs<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(MarketData)
        return this
      },
      getMarketTransactionCap(args: MethodArgs<'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getMarketTransactionCap(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(MarketTransactionCap)
        return this
      },
      getUserCap(args: MethodArgs<'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getUserCap(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(UserCap)
        return this
      },
      setUserCap(args: MethodArgs<'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setUserCap(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setMarketTransactionCap(args: MethodArgs<'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setMarketTransactionCap(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getPriceFeed(args: MethodArgs<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getPriceFeed(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(PriceFeed)
        return this
      },
      setAuthorizedPriceOperator(args: MethodArgs<'set_authorized_price_operator(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setAuthorizedPriceOperator(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      attachPriceFeed(args: MethodArgs<'attach_price_feed(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.attachPriceFeed(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      detachPriceFeed(args: MethodArgs<'detach_price_feed(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.detachPriceFeed(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setMarketPrice(args: MethodArgs<'set_market_price(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setMarketPrice(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      fetchPriceFeed(args: MethodArgs<'fetch_price_feed(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.fetchPriceFeed(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setMarketMaxTotalDeposits(args: MethodArgs<'set_market_max_total_deposits(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setMarketMaxTotalDeposits(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      pauseMarket(args: MethodArgs<'pause_market(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.pauseMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      syncMarket(args: MethodArgs<'sync_market(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.syncMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      withdrawReserves(args: MethodArgs<'withdraw_reserves(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.withdrawReserves(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      deposit(args: MethodArgs<'deposit(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.deposit(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      withdraw(args: MethodArgs<'withdraw(uint64,uint256)uint256'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.withdraw(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      borrow(args: MethodArgs<'borrow(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.borrow(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      repay(args: MethodArgs<'repay(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.repay(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      syncUserMarketForPriceChange(args: MethodArgs<'sync_user_market_for_price_change(address,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.syncUserMarketForPriceChange(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getGlobalUser(args: MethodArgs<'get_global_user(address)(uint256,uint256,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getGlobalUser(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(GlobalUserData)
        return this
      },
      liquidateCrossMarket(args: MethodArgs<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.liquidateCrossMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setVersion(args: MethodArgs<'set_version(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setVersion(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      grantUpgrader(args: MethodArgs<'grant_upgrader(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.grantUpgrader(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      approveUpdate(args: MethodArgs<'approve_update(bool)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.approveUpdate(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      get update() {
        const $this = this
        return {
          bare(args?: BareCallArgs & AppClientComposeCallCoreParams & AppClientCompilationParams & CoreAppCallArgs) {
            promiseChain = promiseChain.then(() => client.update.bare({...args, sendParams: {...args?.sendParams, skipSending: true, atc}}))
            resultMappers.push(undefined)
            return $this
          },
        }
      },
      clearState(args?: BareCallArgs & AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.clearState({...args, sendParams: {...args?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      addTransaction(txn: TransactionWithSigner | TransactionToSign | Transaction | Promise<SendTransactionResult>, defaultSender?: SendTransactionFrom) {
        promiseChain = promiseChain.then(async () => atc.addTransaction(await algokit.getTransactionWithSigner(txn, defaultSender ?? client.sender)))
        return this
      },
      async atc() {
        await promiseChain
        return atc
      },
      async simulate(options?: SimulateOptions) {
        await promiseChain
        const result = await atc.simulate(client.algod, new modelsv2.SimulateRequest({ txnGroups: [], ...options }))
        return {
          ...result,
          returns: result.methodResults?.map((val, i) => resultMappers[i] !== undefined ? resultMappers[i]!(val.returnValue) : val.returnValue)
        }
      },
      async execute(sendParams?: AppClientComposeExecuteParams) {
        await promiseChain
        const result = await algokit.sendAtomicTransactionComposer({ atc, sendParams }, client.algod)
        return {
          ...result,
          returns: result.returns?.map((val, i) => resultMappers[i] !== undefined ? resultMappers[i]!(val.returnValue) : val.returnValue)
        }
      }
    } as unknown as DorkFiLendingPoolComposer
  }
}
export type DorkFiLendingPoolComposer<TReturns extends [...any[]] = []> = {
  /**
   * Calls the post_update()void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  postUpdate(args: MethodArgs<'post_update()void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'post_update()void'>]>

  /**
   * Calls the get_owner()address ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getOwner(args: MethodArgs<'get_owner()address'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_owner()address'>]>

  /**
   * Calls the transfer_ownership(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  transferOwnership(args: MethodArgs<'transfer_ownership(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'transfer_ownership(address)void'>]>

  /**
   * Calls the is_paused()bool ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  isPaused(args: MethodArgs<'is_paused()bool'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'is_paused()bool'>]>

  /**
   * Calls the pause(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  pause(args: MethodArgs<'pause(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'pause(uint64)void'>]>

  /**
   * Calls the set_stoken_app_id(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setStokenAppId(args: MethodArgs<'set_stoken_app_id(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_stoken_app_id(uint64)void'>]>

  /**
   * Calls the get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getUser(args: MethodArgs<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>]>

  /**
   * Calls the create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  createMarket(args: MethodArgs<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>]>

  /**
   * Calls the set_storage_app_id(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setStorageAppId(args: MethodArgs<'set_storage_app_id(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_storage_app_id(uint64)void'>]>

  /**
   * Calls the get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getMarket(args: MethodArgs<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>]>

  /**
   * Calls the get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getMarketTransactionCap(args: MethodArgs<'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)'>]>

  /**
   * Calls the get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getUserCap(args: MethodArgs<'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)'>]>

  /**
   * Calls the set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setUserCap(args: MethodArgs<'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void'>]>

  /**
   * Calls the set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setMarketTransactionCap(args: MethodArgs<'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void'>]>

  /**
   * Calls the get_price_feed(uint64)(uint64,uint64,(uint256,uint64)) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getPriceFeed(args: MethodArgs<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>]>

  /**
   * Calls the set_authorized_price_operator(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setAuthorizedPriceOperator(args: MethodArgs<'set_authorized_price_operator(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_authorized_price_operator(address)void'>]>

  /**
   * Calls the attach_price_feed(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  attachPriceFeed(args: MethodArgs<'attach_price_feed(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'attach_price_feed(uint64,uint64)void'>]>

  /**
   * Calls the detach_price_feed(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  detachPriceFeed(args: MethodArgs<'detach_price_feed(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'detach_price_feed(uint64)void'>]>

  /**
   * Calls the set_market_price(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setMarketPrice(args: MethodArgs<'set_market_price(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_market_price(uint64,uint256)void'>]>

  /**
   * Calls the fetch_price_feed(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  fetchPriceFeed(args: MethodArgs<'fetch_price_feed(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'fetch_price_feed(uint64)void'>]>

  /**
   * Calls the set_market_max_total_deposits(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setMarketMaxTotalDeposits(args: MethodArgs<'set_market_max_total_deposits(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_market_max_total_deposits(uint64,uint256)void'>]>

  /**
   * Calls the pause_market(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  pauseMarket(args: MethodArgs<'pause_market(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'pause_market(uint64,uint64)void'>]>

  /**
   * Calls the sync_market(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  syncMarket(args: MethodArgs<'sync_market(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'sync_market(uint64)void'>]>

  /**
   * Calls the withdraw_reserves(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  withdrawReserves(args: MethodArgs<'withdraw_reserves(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'withdraw_reserves(uint64,uint256)void'>]>

  /**
   * Calls the deposit(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  deposit(args: MethodArgs<'deposit(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'deposit(uint64,uint256)void'>]>

  /**
   * Calls the withdraw(uint64,uint256)uint256 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  withdraw(args: MethodArgs<'withdraw(uint64,uint256)uint256'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'withdraw(uint64,uint256)uint256'>]>

  /**
   * Calls the borrow(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  borrow(args: MethodArgs<'borrow(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'borrow(uint64,uint256)void'>]>

  /**
   * Calls the repay(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  repay(args: MethodArgs<'repay(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'repay(uint64,uint256)void'>]>

  /**
   * Calls the sync_user_market_for_price_change(address,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  syncUserMarketForPriceChange(args: MethodArgs<'sync_user_market_for_price_change(address,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'sync_user_market_for_price_change(address,uint64)void'>]>

  /**
   * Calls the get_global_user(address)(uint256,uint256,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getGlobalUser(args: MethodArgs<'get_global_user(address)(uint256,uint256,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_global_user(address)(uint256,uint256,uint64)'>]>

  /**
   * Calls the liquidate_cross_market(uint64,uint64,address,uint256,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  liquidateCrossMarket(args: MethodArgs<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void'>]>

  /**
   * Calls the set_version(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setVersion(args: MethodArgs<'set_version(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_version(uint64,uint64)void'>]>

  /**
   * Calls the grant_upgrader(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  grantUpgrader(args: MethodArgs<'grant_upgrader(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'grant_upgrader(address)void'>]>

  /**
   * Calls the approve_update(bool)void ABI method.
   *
   * Approve update.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  approveUpdate(args: MethodArgs<'approve_update(bool)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'approve_update(bool)void'>]>

  /**
   * Gets available update methods
   */
  readonly update: {
    /**
     * Updates an existing instance of the DorkFiLendingPool smart contract using a bare call.
     *
     * @param args The arguments for the bare call
     * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
     */
    bare(args?: BareCallArgs & AppClientComposeCallCoreParams & AppClientCompilationParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, undefined]>
  }

  /**
   * Makes a clear_state call to an existing instance of the DorkFiLendingPool smart contract.
   *
   * @param args The arguments for the bare call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  clearState(args?: BareCallArgs & AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, undefined]>

  /**
   * Adds a transaction to the composer
   *
   * @param txn One of: A TransactionWithSigner object (returned as is), a TransactionToSign object (signer is obtained from the signer property), a Transaction object (signer is extracted from the defaultSender parameter), an async SendTransactionResult returned by one of algokit utils helpers (signer is obtained from the defaultSender parameter)
   * @param defaultSender The default sender to be used to obtain a signer where the object provided to the transaction parameter does not include a signer.
   */
  addTransaction(txn: TransactionWithSigner | TransactionToSign | Transaction | Promise<SendTransactionResult>, defaultSender?: SendTransactionFrom): DorkFiLendingPoolComposer<TReturns>
  /**
   * Returns the underlying AtomicTransactionComposer instance
   */
  atc(): Promise<AtomicTransactionComposer>
  /**
   * Simulates the transaction group and returns the result
   */
  simulate(options?: SimulateOptions): Promise<DorkFiLendingPoolComposerSimulateResult<TReturns>>
  /**
   * Executes the transaction group and returns the results
   */
  execute(sendParams?: AppClientComposeExecuteParams): Promise<DorkFiLendingPoolComposerResults<TReturns>>
}
export type SimulateOptions = Omit<ConstructorParameters<typeof modelsv2.SimulateRequest>[0], 'txnGroups'>
export type DorkFiLendingPoolComposerSimulateResult<TReturns extends [...any[]]> = {
  returns: TReturns
  methodResults: ABIResult[]
  simulateResponse: modelsv2.SimulateResponse
}
export type DorkFiLendingPoolComposerResults<TReturns extends [...any[]]> = {
  returns: TReturns
  groupId: string
  txIds: string[]
  transactions: Transaction[]
}
