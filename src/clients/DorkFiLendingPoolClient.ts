/* eslint-disable */
/**
 * This file was automatically generated by @algorandfoundation/algokit-client-generator.
 * DO NOT MODIFY IT BY HAND.
 * requires: @algorandfoundation/algokit-utils: ^2
 */
import * as algokit from '@algorandfoundation/algokit-utils'
import type {
  ABIAppCallArg,
  AppCallTransactionResult,
  AppCallTransactionResultOfType,
  AppCompilationResult,
  AppReference,
  AppState,
  CoreAppCallArgs,
  RawAppCallArgs,
  TealTemplateParams,
} from '@algorandfoundation/algokit-utils/types/app'
import type {
  AppClientCallCoreParams,
  AppClientCompilationParams,
  AppClientDeployCoreParams,
  AppDetails,
  ApplicationClient,
} from '@algorandfoundation/algokit-utils/types/app-client'
import type { AppSpec } from '@algorandfoundation/algokit-utils/types/app-spec'
import type { SendTransactionResult, TransactionToSign, SendTransactionFrom, SendTransactionParams } from '@algorandfoundation/algokit-utils/types/transaction'
import type { ABIResult, TransactionWithSigner } from 'algosdk'
import { Algodv2, OnApplicationComplete, Transaction, AtomicTransactionComposer, modelsv2 } from 'algosdk'
export const APP_SPEC: AppSpec = {
  "hints": {
    "post_update()void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_role_key(address,byte[3])byte[32]": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_market_price(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "market_data": {
          "name": "MarketData",
          "elements": [
            [
              "paused",
              "bool"
            ],
            [
              "max_total_deposits",
              "uint256"
            ],
            [
              "max_total_borrows",
              "uint256"
            ],
            [
              "liquidation_bonus",
              "uint64"
            ],
            [
              "collateral_factor",
              "uint64"
            ],
            [
              "liquidation_threshold",
              "uint64"
            ],
            [
              "reserve_factor",
              "uint64"
            ],
            [
              "borrow_rate",
              "uint64"
            ],
            [
              "slope",
              "uint64"
            ],
            [
              "total_scaled_deposits",
              "uint256"
            ],
            [
              "total_scaled_borrows",
              "uint256"
            ],
            [
              "deposit_index",
              "uint256"
            ],
            [
              "borrow_index",
              "uint256"
            ],
            [
              "last_update_time",
              "uint64"
            ],
            [
              "reserves",
              "uint256"
            ],
            [
              "price",
              "uint256"
            ],
            [
              "ntoken_id",
              "uint64"
            ],
            [
              "close_factor",
              "uint64"
            ]
          ]
        }
      }
    },
    "attach_price_feed(uint64,uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "detach_price_feed(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_owner()address": {
      "read_only": true,
      "call_config": {
        "no_op": "CALL"
      }
    },
    "transfer_ownership(address)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_storage_app_id(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "is_paused()bool": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "pause(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_stoken_app_id(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "UserData",
          "elements": [
            [
              "scaled_deposits",
              "uint256"
            ],
            [
              "scaled_borrows",
              "uint256"
            ],
            [
              "deposit_index",
              "uint256"
            ],
            [
              "borrow_index",
              "uint256"
            ],
            [
              "last_update_time",
              "uint64"
            ],
            [
              "last_price",
              "uint256"
            ]
          ]
        }
      }
    },
    "create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)": {
      "read_only": true,
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "MarketData",
          "elements": [
            [
              "paused",
              "bool"
            ],
            [
              "max_total_deposits",
              "uint256"
            ],
            [
              "max_total_borrows",
              "uint256"
            ],
            [
              "liquidation_bonus",
              "uint64"
            ],
            [
              "collateral_factor",
              "uint64"
            ],
            [
              "liquidation_threshold",
              "uint64"
            ],
            [
              "reserve_factor",
              "uint64"
            ],
            [
              "borrow_rate",
              "uint64"
            ],
            [
              "slope",
              "uint64"
            ],
            [
              "total_scaled_deposits",
              "uint256"
            ],
            [
              "total_scaled_borrows",
              "uint256"
            ],
            [
              "deposit_index",
              "uint256"
            ],
            [
              "borrow_index",
              "uint256"
            ],
            [
              "last_update_time",
              "uint64"
            ],
            [
              "reserves",
              "uint256"
            ],
            [
              "price",
              "uint256"
            ],
            [
              "ntoken_id",
              "uint64"
            ],
            [
              "close_factor",
              "uint64"
            ]
          ]
        }
      }
    },
    "get_price_feed(uint64)(uint64,uint64,(uint256,uint64))": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "PriceFeed",
          "elements": [
            [
              "market_id",
              "uint64"
            ],
            [
              "provider_app_id",
              "uint64"
            ],
            [
              "price_with_timestamp",
              "(uint256,uint64)"
            ]
          ]
        }
      }
    },
    "fetch_price_feed(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "pause_market(uint64,uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "sync_market(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "withdraw_reserves(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "deposit(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "calculate_user_interest(address,uint64)uint256": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "calculate_user_debt_interest(address,uint64)uint256": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "withdraw(uint64,uint256)uint256": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "borrow(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "repay(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "sync_user_market_for_price_change(address,uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_global_user(address)(uint256,uint256,uint64)": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "GlobalUserData",
          "elements": [
            [
              "total_collateral_value",
              "uint256"
            ],
            [
              "total_borrow_value",
              "uint256"
            ],
            [
              "last_update_time",
              "uint64"
            ]
          ]
        }
      }
    },
    "liquidate_cross_market(uint64,uint64,address,uint256,uint256)uint256": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_version(uint64,uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "grant_upgrader(address)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "approve_update(bool)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_role(byte[32],bool)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "has_role(byte[32])bool": {
      "call_config": {
        "no_op": "CALL"
      }
    }
  },
  "source": {
    "approval": "I3ByYWdtYSB2ZXJzaW9uIDEwCgpjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5hcHByb3ZhbF9wcm9ncmFtOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzUxCiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuIE51bUFwcEFyZ3MKICAgIGJ6IG1haW5fYmFyZV9yb3V0aW5nQDM4CiAgICBtZXRob2QgInBvc3RfdXBkYXRlKCl2b2lkIgogICAgbWV0aG9kICJnZXRfcm9sZV9rZXkoYWRkcmVzcyxieXRlWzNdKWJ5dGVbMzJdIgogICAgbWV0aG9kICJzZXRfbWFya2V0X3ByaWNlKHVpbnQ2NCx1aW50MjU2KXZvaWQiCiAgICBtZXRob2QgInNldF9tYXJrZXQodWludDY0LChib29sLHVpbnQyNTYsdWludDI1Nix1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQ2NCx1aW50MjU2LHVpbnQyNTYsdWludDY0LHVpbnQ2NCkpdm9pZCIKICAgIG1ldGhvZCAiYXR0YWNoX3ByaWNlX2ZlZWQodWludDY0LHVpbnQ2NCl2b2lkIgogICAgbWV0aG9kICJkZXRhY2hfcHJpY2VfZmVlZCh1aW50NjQpdm9pZCIKICAgIG1ldGhvZCAiZ2V0X293bmVyKClhZGRyZXNzIgogICAgbWV0aG9kICJ0cmFuc2Zlcl9vd25lcnNoaXAoYWRkcmVzcyl2b2lkIgogICAgbWV0aG9kICJzZXRfc3RvcmFnZV9hcHBfaWQodWludDY0KXZvaWQiCiAgICBtZXRob2QgImlzX3BhdXNlZCgpYm9vbCIKICAgIG1ldGhvZCAicGF1c2UodWludDY0KXZvaWQiCiAgICBtZXRob2QgInNldF9zdG9rZW5fYXBwX2lkKHVpbnQ2NCl2b2lkIgogICAgbWV0aG9kICJnZXRfdXNlcihhZGRyZXNzLHVpbnQ2NCkodWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50NjQsdWludDI1NikiCiAgICBtZXRob2QgImNyZWF0ZV9tYXJrZXQodWludDY0LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50NjQsdWludDI1Nix1aW50MjU2LHVpbnQ2NCx1aW50NjQpdWludDY0IgogICAgbWV0aG9kICJnZXRfbWFya2V0KHVpbnQ2NCkoYm9vbCx1aW50MjU2LHVpbnQyNTYsdWludDY0LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50NjQsdWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50NjQsdWludDI1Nix1aW50MjU2LHVpbnQ2NCx1aW50NjQpIgogICAgbWV0aG9kICJnZXRfcHJpY2VfZmVlZCh1aW50NjQpKHVpbnQ2NCx1aW50NjQsKHVpbnQyNTYsdWludDY0KSkiCiAgICBtZXRob2QgImZldGNoX3ByaWNlX2ZlZWQodWludDY0KXZvaWQiCiAgICBtZXRob2QgInBhdXNlX21hcmtldCh1aW50NjQsdWludDY0KXZvaWQiCiAgICBtZXRob2QgInN5bmNfbWFya2V0KHVpbnQ2NCl2b2lkIgogICAgbWV0aG9kICJ3aXRoZHJhd19yZXNlcnZlcyh1aW50NjQsdWludDI1Nil2b2lkIgogICAgbWV0aG9kICJkZXBvc2l0KHVpbnQ2NCx1aW50MjU2KXZvaWQiCiAgICBtZXRob2QgImNhbGN1bGF0ZV91c2VyX2ludGVyZXN0KGFkZHJlc3MsdWludDY0KXVpbnQyNTYiCiAgICBtZXRob2QgImNhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoYWRkcmVzcyx1aW50NjQpdWludDI1NiIKICAgIG1ldGhvZCAid2l0aGRyYXcodWludDY0LHVpbnQyNTYpdWludDI1NiIKICAgIG1ldGhvZCAiYm9ycm93KHVpbnQ2NCx1aW50MjU2KXZvaWQiCiAgICBtZXRob2QgInJlcGF5KHVpbnQ2NCx1aW50MjU2KXZvaWQiCiAgICBtZXRob2QgInN5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZShhZGRyZXNzLHVpbnQ2NCl2b2lkIgogICAgbWV0aG9kICJnZXRfZ2xvYmFsX3VzZXIoYWRkcmVzcykodWludDI1Nix1aW50MjU2LHVpbnQ2NCkiCiAgICBtZXRob2QgImxpcXVpZGF0ZV9jcm9zc19tYXJrZXQodWludDY0LHVpbnQ2NCxhZGRyZXNzLHVpbnQyNTYsdWludDI1Nil1aW50MjU2IgogICAgbWV0aG9kICJzZXRfdmVyc2lvbih1aW50NjQsdWludDY0KXZvaWQiCiAgICBtZXRob2QgImdyYW50X3VwZ3JhZGVyKGFkZHJlc3Mpdm9pZCIKICAgIG1ldGhvZCAiYXBwcm92ZV91cGRhdGUoYm9vbCl2b2lkIgogICAgbWV0aG9kICJzZXRfcm9sZShieXRlWzMyXSxib29sKXZvaWQiCiAgICBtZXRob2QgImhhc19yb2xlKGJ5dGVbMzJdKWJvb2wiCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAwCiAgICBtYXRjaCBtYWluX3Bvc3RfdXBkYXRlX3JvdXRlQDIgbWFpbl9nZXRfcm9sZV9rZXlfcm91dGVAMyBtYWluX3NldF9tYXJrZXRfcHJpY2Vfcm91dGVANCBtYWluX3NldF9tYXJrZXRfcm91dGVANSBtYWluX2F0dGFjaF9wcmljZV9mZWVkX3JvdXRlQDYgbWFpbl9kZXRhY2hfcHJpY2VfZmVlZF9yb3V0ZUA3IG1haW5fZ2V0X293bmVyX3JvdXRlQDggbWFpbl90cmFuc2Zlcl9vd25lcnNoaXBfcm91dGVAOSBtYWluX3NldF9zdG9yYWdlX2FwcF9pZF9yb3V0ZUAxMCBtYWluX2lzX3BhdXNlZF9yb3V0ZUAxMSBtYWluX3BhdXNlX3JvdXRlQDEyIG1haW5fc2V0X3N0b2tlbl9hcHBfaWRfcm91dGVAMTMgbWFpbl9nZXRfdXNlcl9yb3V0ZUAxNCBtYWluX2NyZWF0ZV9tYXJrZXRfcm91dGVAMTUgbWFpbl9nZXRfbWFya2V0X3JvdXRlQDE2IG1haW5fZ2V0X3ByaWNlX2ZlZWRfcm91dGVAMTcgbWFpbl9mZXRjaF9wcmljZV9mZWVkX3JvdXRlQDE4IG1haW5fcGF1c2VfbWFya2V0X3JvdXRlQDE5IG1haW5fc3luY19tYXJrZXRfcm91dGVAMjAgbWFpbl93aXRoZHJhd19yZXNlcnZlc19yb3V0ZUAyMSBtYWluX2RlcG9zaXRfcm91dGVAMjIgbWFpbl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF9yb3V0ZUAyMyBtYWluX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfcm91dGVAMjQgbWFpbl93aXRoZHJhd19yb3V0ZUAyNSBtYWluX2JvcnJvd19yb3V0ZUAyNiBtYWluX3JlcGF5X3JvdXRlQDI3IG1haW5fc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlX3JvdXRlQDI4IG1haW5fZ2V0X2dsb2JhbF91c2VyX3JvdXRlQDI5IG1haW5fbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9yb3V0ZUAzMCBtYWluX3NldF92ZXJzaW9uX3JvdXRlQDMxIG1haW5fZ3JhbnRfdXBncmFkZXJfcm91dGVAMzIgbWFpbl9hcHByb3ZlX3VwZGF0ZV9yb3V0ZUAzMyBtYWluX3NldF9yb2xlX3JvdXRlQDM0IG1haW5faGFzX3JvbGVfcm91dGVAMzUKICAgIGVyciAvLyByZWplY3QgdHJhbnNhY3Rpb24KCm1haW5fcG9zdF91cGRhdGVfcm91dGVAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM2NgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICBjYWxsc3ViIHBvc3RfdXBkYXRlCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2dldF9yb2xlX2tleV9yb3V0ZUAzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzc2CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM1MQogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM3NgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGdldF9yb2xlX2tleQogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9zZXRfbWFya2V0X3ByaWNlX3JvdXRlQDQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjM0MTEtMzQxMgogICAgLy8gIyBvdmVycmlkZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjM0MTEtMzQxMgogICAgLy8gIyBvdmVycmlkZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHNldF9tYXJrZXRfcHJpY2UKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fc2V0X21hcmtldF9yb3V0ZUA1OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozNDE3LTM0MTgKICAgIC8vICMgb3ZlcnJpZGUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzUxCiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozNDE3LTM0MTgKICAgIC8vICMgb3ZlcnJpZGUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBzZXRfbWFya2V0CiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2F0dGFjaF9wcmljZV9mZWVkX3JvdXRlQDY6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjM0MjMtMzQyNAogICAgLy8gIyBvdmVycmlkZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjM0MjMtMzQyNAogICAgLy8gIyBvdmVycmlkZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGF0dGFjaF9wcmljZV9mZWVkCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2RldGFjaF9wcmljZV9mZWVkX3JvdXRlQDc6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjM0MzEtMzQzMgogICAgLy8gIyBvdmVycmlkZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjM0MzEtMzQzMgogICAgLy8gIyBvdmVycmlkZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGRldGFjaF9wcmljZV9mZWVkCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2dldF9vd25lcl9yb3V0ZUA4OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDUwCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIGNhbGxzdWIgZ2V0X293bmVyCiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX3RyYW5zZmVyX293bmVyc2hpcF9yb3V0ZUA5OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDU0CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM1MQogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA1NAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHRyYW5zZmVyX293bmVyc2hpcAogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9zZXRfc3RvcmFnZV9hcHBfaWRfcm91dGVAMTA6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNzIKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzUxCiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDcyCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgc2V0X3N0b3JhZ2VfYXBwX2lkCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2lzX3BhdXNlZF9yb3V0ZUAxMToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA4NAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICBjYWxsc3ViIGlzX3BhdXNlZAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9wYXVzZV9yb3V0ZUAxMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA5MgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwOTIKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBwYXVzZQogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9zZXRfc3Rva2VuX2FwcF9pZF9yb3V0ZUAxMzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEwNAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMDQKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBzZXRfc3Rva2VuX2FwcF9pZAogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9nZXRfdXNlcl9yb3V0ZUAxNDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEzMgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMzIKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBnZXRfdXNlcgogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9jcmVhdGVfbWFya2V0X3JvdXRlQDE1OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjA3CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM1MQogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDMKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDQKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDUKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDYKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDcKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDgKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDkKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMDcKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBjcmVhdGVfbWFya2V0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2dldF9tYXJrZXRfcm91dGVAMTY6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNzcKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzUxCiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjc3CiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIGNhbGxzdWIgZ2V0X21hcmtldAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9nZXRfcHJpY2VfZmVlZF9yb3V0ZUAxNzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM2OQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNjkKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBnZXRfcHJpY2VfZmVlZAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9mZXRjaF9wcmljZV9mZWVkX3JvdXRlQDE4OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDUzCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM1MQogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ1MwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGZldGNoX3ByaWNlX2ZlZWQKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fcGF1c2VfbWFya2V0X3JvdXRlQDE5OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTMzCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM1MQogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUzMwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHBhdXNlX21hcmtldAogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9zeW5jX21hcmtldF9yb3V0ZUAyMDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU0MwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NDMKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBzeW5jX21hcmtldAogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl93aXRoZHJhd19yZXNlcnZlc19yb3V0ZUAyMToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY5NgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2OTYKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiB3aXRoZHJhd19yZXNlcnZlcwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9kZXBvc2l0X3JvdXRlQDIyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODQzCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM1MQogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg0MwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGRlcG9zaXQKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3Rfcm91dGVAMjM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MjQKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzUxCiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTI0CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgc3dhcAogICAgY29uY2F0CiAgICBsb2cKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdF9yb3V0ZUAyNDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk3MgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NzIKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBjYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX3dpdGhkcmF3X3JvdXRlQDI1OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDE5CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM1MQogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAxOQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHdpdGhkcmF3CiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2JvcnJvd19yb3V0ZUAyNjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE5NgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxOTYKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBib3Jyb3cKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fcmVwYXlfcm91dGVAMjc6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyODUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzUxCiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjg1CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgcmVwYXkKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlX3JvdXRlQDI4OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzkzCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM1MQogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM5MwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHN5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZQogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9nZXRfZ2xvYmFsX3VzZXJfcm91dGVAMjk6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0ODYKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzUxCiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDg2CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgZ2V0X2dsb2JhbF91c2VyCiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfcm91dGVAMzA6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1OTEKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzUxCiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMwogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgNAogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgNQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTkxCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgbGlxdWlkYXRlX2Nyb3NzX21hcmtldAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9zZXRfdmVyc2lvbl9yb3V0ZUAzMToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ0CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM1MQogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ0CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgc2V0X3ZlcnNpb24KICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fZ3JhbnRfdXBncmFkZXJfcm91dGVAMzI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2OAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2OAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGdyYW50X3VwZ3JhZGVyCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2FwcHJvdmVfdXBkYXRlX3JvdXRlQDMzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjEKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9zZXRfcm9sZV9yb3V0ZUAzNDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NTIKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzUxCiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo1MgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHNldF9yb2xlCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2hhc19yb2xlX3JvdXRlQDM1OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo2MAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjYwCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgaGFzX3JvbGUKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgc3dhcAogICAgY29uY2F0CiAgICBsb2cKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fYmFyZV9yb3V0aW5nQDM4OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzUxCiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgaW50IDAKICAgIGludCA0CiAgICB0eG4gT25Db21wbGV0aW9uCiAgICBtYXRjaCBtYWluX2NyZWF0ZUAzOSBtYWluX29uX3VwZGF0ZUA0MAogICAgZXJyIC8vIHJlamVjdCB0cmFuc2FjdGlvbgoKbWFpbl9jcmVhdGVAMzk6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNTEKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgIQogICAgYXNzZXJ0IC8vIGlzIGNyZWF0aW5nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX29uX3VwZGF0ZUA0MDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUyCiAgICAvLyBAYXJjNC5iYXJlbWV0aG9kKGFsbG93X2FjdGlvbnM9WyJVcGRhdGVBcHBsaWNhdGlvbiJdKQogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUyLTE1MwogICAgLy8gQGFyYzQuYmFyZW1ldGhvZChhbGxvd19hY3Rpb25zPVsiVXBkYXRlQXBwbGljYXRpb24iXSkKICAgIC8vIGRlZiBvbl91cGRhdGUoc2VsZikgLT4gTm9uZToKICAgIGNhbGxzdWIgb25fdXBkYXRlCiAgICBpbnQgMQogICAgcmV0dXJuCgoKLy8gY29udHJhY3QuRG9ya0ZpTGVuZGluZ1Bvb2wucG9zdF91cGRhdGUoKSAtPiB2b2lkOgpwb3N0X3VwZGF0ZToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM2Ni0zMzY3CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwb3N0X3VwZGF0ZShzZWxmKSAtPiBOb25lOgogICAgcHJvdG8gMCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNjgKICAgIC8vIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYudXBncmFkZXIsICJtdXN0IGJlIHVwZ3JhZGVyIgogICAgdHhuIFNlbmRlcgogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzCiAgICAvLyBzZWxmLnVwZ3JhZGVyID0gQWNjb3VudCgpCiAgICBieXRlICJ1cGdyYWRlciIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM2OAogICAgLy8gYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi51cGdyYWRlciwgIm11c3QgYmUgdXBncmFkZXIiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYudXBncmFkZXIgZXhpc3RzCiAgICA9PQogICAgYXNzZXJ0IC8vIG11c3QgYmUgdXBncmFkZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAwCiAgICAvLyBzZWxmLmNvbnRyYWN0X3ZlcnNpb24gPSBVSW50NjQoKQogICAgYnl0ZSAiY29udHJhY3RfdmVyc2lvbiIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM2OQogICAgLy8gc2VsZi5jb250cmFjdF92ZXJzaW9uID0gVUludDY0KDApCiAgICBpbnQgMAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAxCiAgICAvLyBzZWxmLmRlcGxveW1lbnRfdmVyc2lvbiA9IFVJbnQ2NCgpCiAgICBieXRlICJkZXBsb3ltZW50X3ZlcnNpb24iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNzAKICAgIC8vIHNlbGYuZGVwbG95bWVudF92ZXJzaW9uID0gVUludDY0KDQpCiAgICBpbnQgNAogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkRvcmtGaUxlbmRpbmdQb29sLmdldF9yb2xlX2tleShhY2NvdW50OiBieXRlcywgcm9sZTogYnl0ZXMpIC0+IGJ5dGVzOgpnZXRfcm9sZV9rZXk6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNzYtMzM3NwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3JvbGVfa2V5KHNlbGYsIGFjY291bnQ6IGFyYzQuQWRkcmVzcywgcm9sZTogQnl0ZXMzKSAtPiBCeXRlczMyOgogICAgcHJvdG8gMiAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzNzgKICAgIC8vIHJldHVybiBCeXRlczMyLmZyb21fYnl0ZXMoc2VsZi5fcm9sZV9rZXkoYWNjb3VudC5uYXRpdmUsIHJvbGUuYnl0ZXMpKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX3JvbGVfa2V5CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5fcm9sZV9rZXkoYWNjb3VudDogYnl0ZXMsIHJvbGU6IGJ5dGVzKSAtPiBieXRlczoKX3JvbGVfa2V5OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzgwLTMzODEKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3JvbGVfa2V5KHNlbGYsIGFjY291bnQ6IEFjY291bnQsIHJvbGU6IEJ5dGVzKSAtPiBCeXRlczoKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzgyCiAgICAvLyByZXR1cm4gb3Auc2hhMjU2KGFjY291bnQuYnl0ZXMgKyByb2xlKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIGNvbmNhdAogICAgc2hhMjU2CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5zZXRfbWFya2V0X3ByaWNlKG1hcmtldF9pZDogYnl0ZXMsIHByaWNlOiBieXRlcykgLT4gdm9pZDoKc2V0X21hcmtldF9wcmljZToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzQxMS0zNDEzCiAgICAvLyAjIG92ZXJyaWRlCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzQxNAogICAgLy8gc2VsZi5fb25seV9hdXRob3JpemVkX3ByaWNlX29yYWNsZSgpCiAgICBjYWxsc3ViIF9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3JhY2xlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjM0MTUKICAgIC8vIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UobWFya2V0X2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX3NldF9tYXJrZXRfcHJpY2UKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkRvcmtGaUxlbmRpbmdQb29sLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3JhY2xlKCkgLT4gdm9pZDoKX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcmFjbGU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzOTQtMzM5NQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9hdXRob3JpemVkX3ByaWNlX29yYWNsZShzZWxmKSAtPiBOb25lOgogICAgcHJvdG8gMCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzOTYKICAgIC8vIHNlbGYuX29ubHlfYXV0aG9yaXplZF9yb2xlKEJ5dGVzKFJPTEVfUFJJQ0VfT1JBQ0xFKSkKICAgIGJ5dGUgMHg3MjcwNmYKICAgIGNhbGxzdWIgX29ubHlfYXV0aG9yaXplZF9yb2xlCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5fb25seV9hdXRob3JpemVkX3JvbGUocm9sZTogYnl0ZXMpIC0+IHZvaWQ6Cl9vbmx5X2F1dGhvcml6ZWRfcm9sZToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzM4NC0zMzg1CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X2F1dGhvcml6ZWRfcm9sZShzZWxmLCByb2xlOiBCeXRlcykgLT4gTm9uZToKICAgIHByb3RvIDEgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzg3CiAgICAvLyBzZWxmLl9yb2xlX2tleShUeG4uc2VuZGVyLCByb2xlKQogICAgdHhuIFNlbmRlcgogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9yb2xlX2tleQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzg2LTMzODgKICAgIC8vIGFzc2VydCBzZWxmLl9oYXNfcm9sZSgKICAgIC8vICAgICBzZWxmLl9yb2xlX2tleShUeG4uc2VuZGVyLCByb2xlKQogICAgLy8gKSwgIm9ubHkgYXV0aG9yaXplZCByb2xlIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICBjYWxsc3ViIF9oYXNfcm9sZQogICAgYXNzZXJ0IC8vIG9ubHkgYXV0aG9yaXplZCByb2xlIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24KICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkFjY2Vzc0NvbnRyb2wuX2hhc19yb2xlKHJvbGU6IGJ5dGVzKSAtPiB1aW50NjQ6Cl9oYXNfcm9sZToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NjQtNjUKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2hhc19yb2xlKHNlbGYsIHJvbGU6IEJ5dGVzKSAtPiBib29sOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjUwCiAgICAvLyBzZWxmLmFkZHJlc3Nfcm9sZXMgPSBCb3hNYXAoQnl0ZXMzMiwgYm9vbCkKICAgIGJ5dGUgImFkZHJlc3Nfcm9sZXMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjY2CiAgICAvLyByZXR1cm4gc2VsZi5hZGRyZXNzX3JvbGVzLmdldChCeXRlczMyLmZyb21fYnl0ZXMocm9sZSksIGRlZmF1bHQ9RmFsc2UpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNvbmNhdAogICAgYm94X2dldAogICAgc3dhcAogICAgYnRvaQogICAgaW50IDAKICAgIHN3YXAKICAgIHVuY292ZXIgMgogICAgc2VsZWN0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZDogdWludDY0LCBwcmljZTogYnl0ZXMpIC0+IHZvaWQ6Cl9zZXRfbWFya2V0X3ByaWNlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDMzLTE0MzQKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQzNQogICAgLy8gYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIGNhbGxzdWIgX2lzX3BhdXNlZAogICAgIQogICAgYXNzZXJ0IC8vIFByb3RvY29sIGlzIHBhdXNlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyLTE0MzYKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGZyYW1lX2RpZyAtMgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzItMTQzNgogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBkZWwgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWREZXRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgc3dhcAogICAgY29uY2F0CiAgICBkdXBuIDIKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDM2CiAgICAvLyBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgYXNzZXJ0IC8vIE1hcmtldCBkb2VzIG5vdCBleGlzdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDM3LTE0MzgKICAgIC8vICMgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ5dGUgMHgKICAgIGI+CiAgICBhc3NlcnQgLy8gUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDQwCiAgICAvLyBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgYm94X2dldAogICAgc3dhcAogICAgZHVwCiAgICB1bmNvdmVyIDIKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLm1hcmtldHMgZW50cnkgZXhpc3RzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NDItMTQ0MwogICAgLy8gIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIGR1cAogICAgaW50IDAKICAgIGdldGJpdAogICAgYnl0ZSAweDAwCiAgICBpbnQgMAogICAgdW5jb3ZlciAyCiAgICBzZXRiaXQKICAgIGJ5dGUgMHgwMAogICAgIT0KICAgIGJ6IF9zZXRfbWFya2V0X3ByaWNlX2FmdGVyX2lmX2Vsc2VAMwogICAgZnJhbWVfZGlnIDEKICAgIGR1cAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICBiPT0KICAgIHN3YXAKICAgIGZyYW1lX2J1cnkgMgogICAgYnogX3NldF9tYXJrZXRfcHJpY2VfYWZ0ZXJfaWZfZWxzZUAzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NDQKICAgIC8vIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICBmcmFtZV9kaWcgMQogICAgaW50IDAKICAgIGR1cAogICAgc2V0Yml0CiAgICBmcmFtZV9idXJ5IDIKCl9zZXRfbWFya2V0X3ByaWNlX2FmdGVyX2lmX2Vsc2VAMzoKICAgIGZyYW1lX2RpZyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NDYtMTQ0NwogICAgLy8gIyBTY2FsZSB0aGUgcHJpY2UgYnkgU0NBTEUgaW50ZXJuYWxseSBmb3Igc3RvcmFnZQogICAgLy8gbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiKgogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIGludCAyODEKICAgIHN3YXAKICAgIHJlcGxhY2UzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NDkKICAgIC8vIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBmcmFtZV9kaWcgMAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2lzX3BhdXNlZCgpIC0+IHVpbnQ2NDoKX2lzX3BhdXNlZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA4OC0xMDg5CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIHByb3RvIDAgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDkwCiAgICAvLyByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDI5CiAgICAvLyBzZWxmLnBhdXNlZCA9IFVJbnQ2NCgpCiAgICBieXRlICJwYXVzZWQiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwOTAKICAgIC8vIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5wYXVzZWQgZXhpc3RzCiAgICBpbnQgMQogICAgPT0KICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkRvcmtGaUxlbmRpbmdQb29sLnNldF9tYXJrZXQodG9rZW5faWQ6IGJ5dGVzLCBtYXJrZXRfZGF0YTogYnl0ZXMpIC0+IHZvaWQ6CnNldF9tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjM0MTctMzQxOQogICAgLy8gIyBvdmVycmlkZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjM0MjAKICAgIC8vIHNlbGYuX29ubHlfYXV0aG9yaXplZF9tYXJrZXRfY29udHJvbGxlcigpCiAgICBjYWxsc3ViIF9vbmx5X2F1dGhvcml6ZWRfbWFya2V0X2NvbnRyb2xsZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzQyMQogICAgLy8gc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX3NldF9tYXJrZXQKICAgIGZyYW1lX2J1cnkgLTEKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkRvcmtGaUxlbmRpbmdQb29sLl9vbmx5X2F1dGhvcml6ZWRfbWFya2V0X2NvbnRyb2xsZXIoKSAtPiB2b2lkOgpfb25seV9hdXRob3JpemVkX21hcmtldF9jb250cm9sbGVyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzkwLTMzOTEKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfYXV0aG9yaXplZF9tYXJrZXRfY29udHJvbGxlcihzZWxmKSAtPiBOb25lOgogICAgcHJvdG8gMCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzOTIKICAgIC8vIHNlbGYuX29ubHlfYXV0aG9yaXplZF9yb2xlKEJ5dGVzKFJPTEVfTUFSS0VUX0NPTlRST0xMRVIpKQogICAgYnl0ZSAweDcyNmQ2MwogICAgY2FsbHN1YiBfb25seV9hdXRob3JpemVkX3JvbGUKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9zZXRfbWFya2V0KHRva2VuX2lkOiB1aW50NjQsIG1hcmtldF9kYXRhOiBieXRlcykgLT4gYnl0ZXM6Cl9zZXRfbWFya2V0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzU4LTEzNTkKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICBwcm90byAyIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM2MAogICAgLy8gbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIGZyYW1lX2RpZyAtMgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNjAKICAgIC8vIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICBzd2FwCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2dldAogICAgc3dhcAogICAgY292ZXIgMgogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYubWFya2V0cyBlbnRyeSBleGlzdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMi0xMzYxCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICBkdXAKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzYxCiAgICAvLyBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgYXNzZXJ0IC8vIE1hcmtldCBhbHJlYWR5IGV4aXN0cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzYyCiAgICAvLyBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICBmcmFtZV9kaWcgLTEKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICB1bmNvdmVyIDIKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBiPT0KICAgIGFzc2VydCAvLyBQcmljZSBtaXNtYXRjaAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzYzCiAgICAvLyBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICBmcmFtZV9kaWcgLTEKICAgIGJveF9wdXQKICAgIGZyYW1lX2RpZyAtMQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuRG9ya0ZpTGVuZGluZ1Bvb2wuYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQ6IGJ5dGVzLCBwcm92aWRlcl9hcHBfaWQ6IGJ5dGVzKSAtPiB2b2lkOgphdHRhY2hfcHJpY2VfZmVlZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzQyMy0zNDI3CiAgICAvLyAjIG92ZXJyaWRlCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozNDI4CiAgICAvLyBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2VfZmVlZF9tYW5hZ2VyKCkKICAgIGNhbGxzdWIgX29ubHlfYXV0aG9yaXplZF9wcmljZV9mZWVkX21hbmFnZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzQyOQogICAgLy8gc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ0b2kKICAgIGNhbGxzdWIgX2F0dGFjaF9wcmljZV9mZWVkCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5fb25seV9hdXRob3JpemVkX3ByaWNlX2ZlZWRfbWFuYWdlcigpIC0+IHZvaWQ6Cl9vbmx5X2F1dGhvcml6ZWRfcHJpY2VfZmVlZF9tYW5hZ2VyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzk4LTMzOTkKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfYXV0aG9yaXplZF9wcmljZV9mZWVkX21hbmFnZXIoc2VsZikgLT4gTm9uZToKICAgIHByb3RvIDAgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozNDAwCiAgICAvLyBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcm9sZShCeXRlcyhST0xFX1BSSUNFX0ZFRURfTUFOQUdFUikpCiAgICBieXRlIDB4NzI3MDZkCiAgICBjYWxsc3ViIF9vbmx5X2F1dGhvcml6ZWRfcm9sZQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkOiB1aW50NjQsIHByb3ZpZGVyX2FwcF9pZDogdWludDY0KSAtPiB2b2lkOgpfYXR0YWNoX3ByaWNlX2ZlZWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzOTItMTM5MwogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMi0xMzk0CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9kYXRhLnByaWNlID09IG1hcmtldC5wcmljZSwgIlByaWNlIG1pc21hdGNoIgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc3VtZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIGZyYW1lX2RpZyAtMgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzItMTM5NAogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICBkaWcgMQogICAgY29uY2F0CiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM5NAogICAgLy8gYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICBhc3NlcnQgLy8gTWFya2V0IGV4aXN0cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDM5CiAgICAvLyBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgYnl0ZSAicHJpY2VfZmVlZHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzktMTM5NQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgZGlnIDEKICAgIGNvbmNhdAogICAgZHVwCiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgICEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM5NQogICAgLy8gYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgYXNzZXJ0IC8vIFByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzk2CiAgICAvLyBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzOTkKICAgIC8vIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgZnJhbWVfZGlnIC0xCiAgICBpdG9iCiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MDEKICAgIC8vIHByaWNlPW1hcmtldC5wcmljZSwKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MDIKICAgIC8vIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MDAtMTQwMwogICAgLy8gcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gKSwKICAgIGNvbmNhdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzk3LTE0MDQKICAgIC8vIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgKSwKICAgIC8vICkKICAgIHVuY292ZXIgMwogICAgdW5jb3ZlciAyCiAgICBjb25jYXQKICAgIHN3YXAKICAgIGNvbmNhdAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2dldF9tYXJrZXQodG9rZW5faWQ6IHVpbnQ2NCkgLT4gYnl0ZXM6Cl9nZXRfbWFya2V0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjgxLTEyODIKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIHByb3RvIDEgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyLTEyODMKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICBmcmFtZV9kaWcgLTEKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMgogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyLTEyODMKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyODMKICAgIC8vIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIGJ6IF9nZXRfbWFya2V0X2Vsc2VfYm9keUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyODQKICAgIC8vIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICBmcmFtZV9kaWcgMAogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYubWFya2V0cyBlbnRyeSBleGlzdHMKICAgIHN3YXAKICAgIHJldHN1YgoKX2dldF9tYXJrZXRfZWxzZV9ib2R5QDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyODYKICAgIC8vIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICBieXRlIDB4NzMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI4NwogICAgLy8gYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIGJveF9nZXQKICAgIGFzc2VydCAvLyBjaGVjayBCb3ggZXhpc3RzCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyODgtMTI5MAogICAgLy8gbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgbWV0aG9kICJnZXRfbWFya2V0X2RlZmF1bHQoKShib29sLHVpbnQyNTYsdWludDI1Nix1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQ2NCx1aW50MjU2LHVpbnQyNTYsdWludDY0LHVpbnQ2NCkiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZHVwCiAgICBleHRyYWN0IDQgMAogICAgc3dhcAogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjkxCiAgICAvLyByZXR1cm4gbWFya2V0CiAgICBzd2FwCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZDogYnl0ZXMpIC0+IHZvaWQ6CmRldGFjaF9wcmljZV9mZWVkOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozNDMxLTM0MzMKICAgIC8vICMgb3ZlcnJpZGUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIHByb3RvIDEgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozNDM0CiAgICAvLyBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2VfZmVlZF9tYW5hZ2VyKCkKICAgIGNhbGxzdWIgX29ubHlfYXV0aG9yaXplZF9wcmljZV9mZWVkX21hbmFnZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzQzNQogICAgLy8gc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBjYWxsc3ViIF9kZXRhY2hfcHJpY2VfZmVlZAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkOiB1aW50NjQpIC0+IHZvaWQ6Cl9kZXRhY2hfcHJpY2VfZmVlZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQxNy0xNDE4CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgcHJvdG8gMSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzItMTQxOQogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBmcmFtZV9kaWcgLTEKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMgogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyLTE0MTkKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgZGlnIDEKICAgIGNvbmNhdAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MTkKICAgIC8vIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBhc3NlcnQgLy8gTWFya2V0IGRvZXMgbm90IGV4aXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzkKICAgIC8vIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICBieXRlICJwcmljZV9mZWVkcyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzOS0xNDIwCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9kYXRhLnByaWNlID09IG1hcmtldC5wcmljZSwgIlByaWNlIG1pc21hdGNoIgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc3VtZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXSA9IFByaWNlRmVlZCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wPVByaWNlV2l0aFRpbWVzdGFtcCgKICAgIC8vICAgICAgICAgICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICksCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZEF0dGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgc3dhcAogICAgY29uY2F0CiAgICBkdXAKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDIwCiAgICAvLyBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgYXNzZXJ0IC8vIFByaWNlIGZlZWQgbm90IGF0dGFjaGVkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MjEKICAgIC8vIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgYm94X2RlbAogICAgcG9wCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5nZXRfb3duZXIoKSAtPiBieXRlczoKZ2V0X293bmVyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDUwLTEwNTEKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICBwcm90byAwIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA1MgogICAgLy8gcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyOAogICAgLy8gc2VsZi5vd25lciA9IEFjY291bnQoKQogICAgYnl0ZSAib3duZXIiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNTIKICAgIC8vIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5vd25lciBleGlzdHMKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLnRyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXI6IGJ5dGVzKSAtPiB2b2lkOgp0cmFuc2Zlcl9vd25lcnNoaXA6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNTQtMTA1NQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgcHJvdG8gMSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNTYKICAgIC8vIHNlbGYuX29ubHlfb3duZXIoKQogICAgY2FsbHN1YiBfb25seV9vd25lcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDI4CiAgICAvLyBzZWxmLm93bmVyID0gQWNjb3VudCgpCiAgICBieXRlICJvd25lciIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA1Ny0xMDU4CiAgICAvLyAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMQogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9vbmx5X293bmVyKCkgLT4gdm9pZDoKX29ubHlfb3duZXI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNDYtMTA0NwogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgcHJvdG8gMCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNDgKICAgIC8vIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgdHhuIFNlbmRlcgogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyOAogICAgLy8gc2VsZi5vd25lciA9IEFjY291bnQoKQogICAgYnl0ZSAib3duZXIiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNDgKICAgIC8vIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLm93bmVyIGV4aXN0cwogICAgPT0KICAgIGFzc2VydCAvLyBvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQ6IGJ5dGVzKSAtPiB2b2lkOgpzZXRfc3RvcmFnZV9hcHBfaWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNzItMTA3MwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIHByb3RvIDEgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDc0CiAgICAvLyBzZWxmLl9vbmx5X293bmVyKCkKICAgIGNhbGxzdWIgX29ubHlfb3duZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA3NQogICAgLy8gc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgY2FsbHN1YiBfc2V0X3N0b3JhZ2VfYXBwX2lkCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkOiB1aW50NjQpIC0+IHZvaWQ6Cl9zZXRfc3RvcmFnZV9hcHBfaWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNzctMTA3OAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA4MAogICAgLy8gYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIGZyYW1lX2RpZyAtMQogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDc5CiAgICAvLyBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIGJ5dGUgMHg3MwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDgwCiAgICAvLyBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuaXNfcGF1c2VkKCkgLT4gYnl0ZXM6CmlzX3BhdXNlZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA4NC0xMDg1CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgcHJvdG8gMCAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwODYKICAgIC8vIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICBjYWxsc3ViIF9pc19wYXVzZWQKICAgIGJ5dGUgMHgwMAogICAgaW50IDAKICAgIHVuY292ZXIgMgogICAgc2V0Yml0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5wYXVzZShwYXVzZTogYnl0ZXMpIC0+IHZvaWQ6CnBhdXNlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDkyLTEwOTMKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIHByb3RvIDEgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDk0CiAgICAvLyBzZWxmLl9vbmx5X293bmVyKCkKICAgIGNhbGxzdWIgX29ubHlfb3duZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA5NS0xMDk2CiAgICAvLyAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyOQogICAgLy8gc2VsZi5wYXVzZWQgPSBVSW50NjQoKQogICAgYnl0ZSAicGF1c2VkIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDk1LTEwOTYKICAgIC8vICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIHN3YXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkOiBieXRlcykgLT4gdm9pZDoKc2V0X3N0b2tlbl9hcHBfaWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMDQtMTEwNQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEwNgogICAgLy8gc2VsZi5fb25seV9vd25lcigpCiAgICBjYWxsc3ViIF9vbmx5X293bmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMDctMTEwOAogICAgLy8gIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBjYWxsc3ViIF9zZXRfc3Rva2VuX2FwcF9pZAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQ6IHVpbnQ2NCkgLT4gdm9pZDoKX3NldF9zdG9rZW5fYXBwX2lkOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTEwLTExMTEKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIHByb3RvIDEgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTEzCiAgICAvLyBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIGdsb2JhbCBDdXJyZW50QXBwbGljYXRpb25BZGRyZXNzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMTQtMTExNwogICAgLy8gIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgZnJhbWVfZGlnIC0xCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIG1ldGhvZCAiaXNfbWludGVyKGFkZHJlc3MpYm9vbCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZHVwCiAgICBleHRyYWN0IDQgMAogICAgc3dhcAogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTIwCiAgICAvLyBpc19hcHByb3ZlZF9taW50ZXIKICAgIGJ5dGUgMHgwMAogICAgIT0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTExOC0xMTIxCiAgICAvLyAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgYXNzZXJ0IC8vIExlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMAogICAgLy8gc2VsZi5zdG9rZW5fYXBwX2lkID0gVUludDY0KCkgICMgc3RhYmxlIG1hcmtldAogICAgYnl0ZSAic3Rva2VuX2FwcF9pZCIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEyMgogICAgLy8gc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgZnJhbWVfZGlnIC0xCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuZ2V0X3VzZXIodXNlcl9pZDogYnl0ZXMsIG1hcmtldF9pZDogYnl0ZXMpIC0+IGJ5dGVzOgpnZXRfdXNlcjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEzMi0xMTMzCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgcHJvdG8gMiAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMzQKICAgIC8vIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgZnJhbWVfZGlnIC0yCiAgICBzd2FwCiAgICBjYWxsc3ViIF9nZXRfdXNlcgogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2dldF91c2VyKHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCkgLT4gYnl0ZXM6Cl9nZXRfdXNlcjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEzNi0xMTM3CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICBwcm90byAyIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEzOAogICAgLy8gdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2dldF91c2VyX2tleQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMzCiAgICAvLyBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIGJ5dGUgInVzZXJzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMzLTExMzkKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMzkKICAgIC8vIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICBieiBfZ2V0X3VzZXJfZWxzZV9ib2R5QDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE0MAogICAgLy8gcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICBmcmFtZV9kaWcgMAogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYudXNlcnMgZW50cnkgZXhpc3RzCiAgICBzd2FwCiAgICByZXRzdWIKCl9nZXRfdXNlcl9lbHNlX2JvZHlAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE0MgogICAgLy8gYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIGJ5dGUgMHg3MwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTQzCiAgICAvLyBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIEJveCBleGlzdHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE0NAogICAgLy8gdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIGl0eG5fYmVnaW4KICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgbWV0aG9kICJnZXRfdXNlcl9kZWZhdWx0KCkodWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50NjQsdWludDI1NikiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZHVwCiAgICBleHRyYWN0IDQgMAogICAgc3dhcAogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTQ1CiAgICAvLyByZXR1cm4gdXNlcgogICAgc3dhcAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2dldF91c2VyX2tleSh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQpIC0+IGJ5dGVzOgpfZ2V0X3VzZXJfa2V5OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTI2LTExMjcKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTI5CiAgICAvLyBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICBmcmFtZV9kaWcgLTEKICAgIGl0b2IKICAgIGZyYW1lX2RpZyAtMgogICAgc3dhcAogICAgY29uY2F0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMjgtMTEzMAogICAgLy8gcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyApCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5jcmVhdGVfbWFya2V0KHRva2VuX2lkOiBieXRlcywgY29sbGF0ZXJhbF9mYWN0b3I6IGJ5dGVzLCBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGJ5dGVzLCByZXNlcnZlX2ZhY3RvcjogYnl0ZXMsIGJvcnJvd19yYXRlOiBieXRlcywgc2xvcGU6IGJ5dGVzLCBtYXhfdG90YWxfZGVwb3NpdHM6IGJ5dGVzLCBtYXhfdG90YWxfYm9ycm93czogYnl0ZXMsIGxpcXVpZGF0aW9uX2JvbnVzOiBieXRlcywgY2xvc2VfZmFjdG9yOiBieXRlcykgLT4gYnl0ZXM6CmNyZWF0ZV9tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMDctMTIyMAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIHByb3RvIDEwIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIyMQogICAgLy8gc2VsZi5fb25seV9vd25lcigpCiAgICBjYWxsc3ViIF9vbmx5X293bmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMjIKICAgIC8vIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICBjYWxsc3ViIF9pc19wYXVzZWQKICAgICEKICAgIGFzc2VydCAvLyBQcm90b2NvbCBpcyBwYXVzZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIyNgogICAgLy8gbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgZnJhbWVfZGlnIC04CiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTkKICAgIGJ0b2kKICAgID4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIyMy0xMjI3CiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgYXNzZXJ0IC8vIExpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIzMQogICAgLy8gdG9rZW5faWQubmF0aXZlLAogICAgZnJhbWVfZGlnIC0xMAogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjQ2CiAgICAvLyBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIzMwogICAgLy8gcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgYnl0ZSAweDgwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMzItMTI1MwogICAgLy8gTWFya2V0RGF0YSgKICAgIC8vICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAwCiAgICAvLyAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICksCiAgICBmcmFtZV9kaWcgLTQKICAgIGNvbmNhdAogICAgZnJhbWVfZGlnIC0zCiAgICBjb25jYXQKICAgIGZyYW1lX2RpZyAtMgogICAgY29uY2F0CiAgICBmcmFtZV9kaWcgLTkKICAgIGNvbmNhdAogICAgZnJhbWVfZGlnIC04CiAgICBjb25jYXQKICAgIGZyYW1lX2RpZyAtNwogICAgY29uY2F0CiAgICBmcmFtZV9kaWcgLTYKICAgIGNvbmNhdAogICAgZnJhbWVfZGlnIC01CiAgICBjb25jYXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI0MgogICAgLy8gdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMzItMTI1MwogICAgLy8gTWFya2V0RGF0YSgKICAgIC8vICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAwCiAgICAvLyAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICksCiAgICBjb25jYXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI0MwogICAgLy8gdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIzMi0xMjUzCiAgICAvLyBNYXJrZXREYXRhKAogICAgLy8gICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIDAKICAgIC8vICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gKSwKICAgIGNvbmNhdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjQ0CiAgICAvLyBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMGRlMGI2YjNhNzY0MDAwMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjMyLTEyNTMKICAgIC8vIE1hcmtldERhdGEoCiAgICAvLyAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgMAogICAgLy8gICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyApLAogICAgY29uY2F0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNDUKICAgIC8vIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIzMi0xMjUzCiAgICAvLyBNYXJrZXREYXRhKAogICAgLy8gICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIDAKICAgIC8vICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gKSwKICAgIGNvbmNhdAogICAgc3dhcAogICAgY29uY2F0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNDcKICAgIC8vIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMzItMTI1MwogICAgLy8gTWFya2V0RGF0YSgKICAgIC8vICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAwCiAgICAvLyAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICksCiAgICBjb25jYXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI0OC0xMjUwCiAgICAvLyBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgMAogICAgLy8gKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIzMi0xMjUzCiAgICAvLyBNYXJrZXREYXRhKAogICAgLy8gICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIDAKICAgIC8vICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gKSwKICAgIGNvbmNhdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjUxCiAgICAvLyBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIzMi0xMjUzCiAgICAvLyBNYXJrZXREYXRhKAogICAgLy8gICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIDAKICAgIC8vICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gKSwKICAgIGNvbmNhdAogICAgZnJhbWVfZGlnIC0xCiAgICBjb25jYXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIzMC0xMjU0CiAgICAvLyBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgMAogICAgLy8gICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgKSwKICAgIC8vICkKICAgIGNhbGxzdWIgX2NyZWF0ZV9tYXJrZXQKICAgIHBvcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjI4LTEyNTUKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICksCiAgICAvLyAgICAgKQogICAgLy8gKQogICAgaXRvYgogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2NyZWF0ZV9tYXJrZXQodG9rZW5faWQ6IHVpbnQ2NCwgbWFya2V0X2RhdGE6IGJ5dGVzKSAtPiB1aW50NjQsIGJ5dGVzOgpfY3JlYXRlX21hcmtldDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI1Ny0xMjU4CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICBwcm90byAyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMi0xMjU5CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgZnJhbWVfZGlnIC0yCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzIKICAgIC8vIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgYnl0ZSAibWFya2V0cyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMi0xMjU5CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgZGlnIDEKICAgIGNvbmNhdAogICAgZHVwCiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgICEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI1OQogICAgLy8gYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICBhc3NlcnQgLy8gTWFya2V0IGFscmVhZHkgZXhpc3RzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNjAKICAgIC8vIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIHR4biBTZW5kZXIKICAgIGNhbGxzdWIgcmVxdWlyZV9wYXltZW50CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNjEKICAgIC8vIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIGludCAyMDAwMDAwCiAgICA+PQogICAgYXNzZXJ0IC8vIGluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNjMKICAgIC8vIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjYyCiAgICAvLyBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICBpbnQgNgogICAgaXR4bl9maWVsZCBHbG9iYWxOdW1VaW50CiAgICBpbnQgNgogICAgaXR4bl9maWVsZCBHbG9iYWxOdW1CeXRlU2xpY2UKICAgIGJ5dGUgYmFzZTY0IENvRUJRdz09CiAgICBpdHhuX2ZpZWxkIENsZWFyU3RhdGVQcm9ncmFtUGFnZXMKICAgIGJ5dGUgYmFzZTY0IENpQUVBQUVnQmlZVEJCVWZmSFVMZEc5MFlXeFRkWEJ3YkhrRmIzZHVaWElBQ0dKaGJHRnVZMlZ6Q0hWd1ozSmhaR1Z5Q0hSdmEyVnVYMmxrQkc1aGJXVUdjM2x0WW05c0NHUmxZMmx0WVd4ekJIbUR3MXdCQUFSbGZSUHNCTGF1R2lVRWhPd1QxUkJqYjI1MGNtRmpkRjkyWlhKemFXOXVFbVJsY0d4dmVXMWxiblJmZG1WeWMybHZiZ2x3WVhKbGJuUmZhV1FKZFhCa1lYUmhZbXhsTVJoQUFBT0lCSkl4RzBFQnVJSUhCS2F5MC9zRXRaWHNFd1R4VUZVbkJQTjROd0VFMm5BbHVRUktsbytQQkxWQ0lTVW5EQ2NOSnc2Q0NBVHNtV0JCQklMbGM4UUV1N01aOHdUL0s2WEZCSVVtVFg0RWVMeVoxQVRVbHI5REJHc0xqL2cyR2dDT0VnQUJBQkFBSWdBeEFFTUFXUUJ5QUlnQW1BQ29BTGdBeUFEYkFQRUJBUUVRQVNJQk1RQXhHUlJFTVJoRU5ob0JpQUZKSTBNeEdSUkVNUmhFTmhvQk5ob0NpQUhKSTBNeEdSUkVNUmhFTmhvQmlBSVZJME14R1JSRU1SaEVOaG9CTmhvQ2lBSlVJME14R1JSRU1SaEVOaG9CTmhvQ2lBS2lLRXhRc0NORE1Sa1VSREVZUkRZYUFUWWFBallhQTRnQ2p5aE1VTEFqUXpFWkZFUXhHRVEyR2dFMkdnS0lBbjhvVEZDd0kwTXhHUlJFTVJoRWlBSjFLRXhRc0NORE1Sa1VSREVZUklnQ2JpaE1VTEFqUXpFWkZFUXhHRVNJQW1jb1RGQ3dJME14R1JSRU1SaEVpQUprS0V4UXNDTkRNUmtVUkRFWVJEWWFBWWdDWVNoTVVMQWpRekVaRkVReEdFUTJHZ0UyR2dLSUFsd29URkN3STBNeEdSUkVNUmhFaUFKN0tFeFFzQ05ETVJrVVJERVlSRFlhQVlnQ2NDTkRNUmtVUkRFWVJEWWFBVFlhQW9nQ2ppTkRNUmtVUkRFWVJEWWFBWWdDbnlORE1Sa1VSREVZUkNORElvRUVNUm1PQWdBQkFBb0FNUmdVUklnQ29TTkRNUmhFaUFLbEkwT0tBUUFpSndabFJCUkVpLzhYaUFBQmlZb0JBTEdMLzdJWUp3NnlHaVd5RUNLeUFiTzBQa2xYQkFCTVZ3QUVLQkpFc1l2L3NoZ25ETElhSmJJUUlySUJzN1ErU1ZjRUFFeFhBQVFvRWtTeGkvK3lHQ2NOc2hvbHNoQWlzZ0d6dEQ1SlZ3UUFURmNBQkNnU1JJQUhSRzl5YTBacElFOENVQ2NIVEdlQUFXNU1VQ2NJVEdjWEp3bE1aeWtyWnljR2kvOW5pWW9DQURFQUlpcGxSQkpFaS82TC80Z0FBWW1LQWdBaUtXVkVpLytnS1V4bmkvNklBQ2duQkl2K1VFeUwvNkJNU2J4SVRMOHlBNHYvRlNRT1JDU3ZpLytyVEl2K1VFeFFKd3BNVUxDSmlnRUJKd1NMLzFDK0swNENUWW1LQVFBaUttVkVNUUFTUkl2L2lBQUJpWW9CQURFQWlQL1pTWXYvcDBRbkJERUFVRXlMLzZGTVNieElUTDhpS1dWRWkvK2hLVXhuTVFBeUE0di9GU1FPUkNTdmkvK3JUZ0pRVEZBbkNreFFzSW1LQWdBaUttVkVNUUFTUkl2K2kvK0lBQUdKaWdJQWkvNkkvNGFML3l1bFJFbUwvNmRFSWlsbFJJdi9wMFFuQkl2K1VFeUwvNkZNU2J4SVRMOGlLV1ZFaS8raEtVeG5NZ09ML3hVa0RrUWtyNHYvcTR2K1R3SlFURkFuQ2t4UXNJbUtBZ0VuQzRtS0F3RW5DNG1LQWdFbkM0bUtBQUVpSndkbFJJbUtBQUVpSndobFJJbUtBQUVpSndsbFJCWlhCd0dKaWdBQklpbGxSRWtWSkE1RUpLK3JpWW9CQVl2L2lQNzRTUlVrRGtRa3I2dUppZ0lCaS82TC80Z0FDVWtWSkE1RUpLK3JpWW9DQVl2K2kvOVFBWUFKWVhCd2NtOTJZV3h6VEZDK0swNENUWW1LQUFFaUttVkVpWW9CQUlnQUJvdi9pQUFOaVlvQUFERUFJaXBsUkJKRWlZb0JBQ0lxWlVRcWkvOW5pLzlRZ0FTYUlqNzdURkN3aVlvQ0FJditpLzlRZ0FTTWpQbk5URkN3aS80WEp3OU1aNHYvRnljUVRHZUppZ0VBTVFBeUNSSkVJaWNGWlVTTC8xQ0FCSzMxNHJoTVVMQW5CWXYvWjRtS0FBQXlEVWxFSnhGTVo0bUtBQUF4QUNJbkJXVkVFa1FpSnhKbFJDTVNSSW1LQUFBbkJ5dG5Kd2dyWnljSkltY3BLMmNuRVNKbkp3WWlaeW95Q1djbkR5Sm5KeEFpWnljU0kyY25CVElKWjRrPQogICAgaXR4bl9maWVsZCBBcHByb3ZhbFByb2dyYW1QYWdlcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjYzCiAgICAvLyBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIENyZWF0ZWRBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNjQtMTI2NgogICAgLy8gaXR4bi5QYXltZW50KAogICAgLy8gICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICkuc3VibWl0KCkKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI2NQogICAgLy8gcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgZHVwCiAgICBhcHBfcGFyYW1zX2dldCBBcHBBZGRyZXNzCiAgICBhc3NlcnQgLy8gYXBwbGljYXRpb24gZXhpc3RzCiAgICBpbnQgMTAwMDAwMAogICAgaXR4bl9maWVsZCBBbW91bnQKICAgIGl0eG5fZmllbGQgUmVjZWl2ZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI2NAogICAgLy8gaXR4bi5QYXltZW50KAogICAgaW50IHBheQogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjY1CiAgICAvLyByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI2NC0xMjY2CiAgICAvLyBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gKS5zdWJtaXQoKQogICAgaXR4bl9zdWJtaXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI2Ny0xMjcxCiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgZHVwCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIG1ldGhvZCAiYm9vdHN0cmFwNjQodWludDY0KXZvaWQiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgZGlnIDIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjcyCiAgICAvLyBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIGR1cAogICAgaXRvYgogICAgZnJhbWVfZGlnIC0xCiAgICBpbnQgMzEzCiAgICB1bmNvdmVyIDIKICAgIHJlcGxhY2UzCiAgICBmcmFtZV9idXJ5IC0xCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNzMKICAgIC8vIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIHN3YXAKICAgIGZyYW1lX2RpZyAtMQogICAgYm94X3B1dAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjc0CiAgICAvLyBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgbWV0aG9kICJNYXJrZXRDcmVhdGVkKHVpbnQ2NCkiCiAgICB1bmNvdmVyIDIKICAgIGNvbmNhdAogICAgbG9nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNzUKICAgIC8vIHJldHVybiBiYXNlX2FwcC5pZAogICAgZnJhbWVfZGlnIC0xCiAgICByZXRzdWIKCgovLyBvcGVuc3VibWFyaW5lLnV0aWxzLmFsZ29yYW5kLnJlcXVpcmVfcGF5bWVudCh3aG86IGJ5dGVzKSAtPiB1aW50NjQ6CnJlcXVpcmVfcGF5bWVudDoKICAgIC8vIHVzci9sb2NhbC9saWIvcHl0aG9uMy4xMi9zaXRlLXBhY2thZ2VzL29wZW5zdWJtYXJpbmUvdXRpbHMvYWxnb3JhbmQucHk6MTUtMjMKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICMgZnVuY3Rpb246IHJlcXVpcmVfcGF5bWVudCAoaW50ZXJuYWwpCiAgICAvLyAjIGFyZ3VtZW50czogTm9uZQogICAgLy8gIyBwdXJwb3NlOiBjaGVjayBwYXltZW50CiAgICAvLyAjIHByZS1jb25kaXRpb25zOiBOb25lCiAgICAvLyAjIHBvc3QtY29uZGl0aW9uczogTm9uZQogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiByZXF1aXJlX3BheW1lbnQod2hvOiBBY2NvdW50KSAtPiBVSW50NjQ6CiAgICBwcm90byAxIDEKICAgIC8vIHVzci9sb2NhbC9saWIvcHl0aG9uMy4xMi9zaXRlLXBhY2thZ2VzL29wZW5zdWJtYXJpbmUvdXRpbHMvYWxnb3JhbmQucHk6MjQKICAgIC8vIHJlZl9ncm91cF9pbmRleCA9IFR4bi5ncm91cF9pbmRleAogICAgdHhuIEdyb3VwSW5kZXgKICAgIC8vIHVzci9sb2NhbC9saWIvcHl0aG9uMy4xMi9zaXRlLXBhY2thZ2VzL29wZW5zdWJtYXJpbmUvdXRpbHMvYWxnb3JhbmQucHk6MjUKICAgIC8vIGFzc2VydCByZWZfZ3JvdXBfaW5kZXggPiAwLCAiZ3JvdXAgaW5kZXggZ3JlYXRlciB0aGFuIHplcm8iCiAgICBkdXAKICAgIGFzc2VydCAvLyBncm91cCBpbmRleCBncmVhdGVyIHRoYW4gemVybwogICAgLy8gdXNyL2xvY2FsL2xpYi9weXRob24zLjEyL3NpdGUtcGFja2FnZXMvb3BlbnN1Ym1hcmluZS91dGlscy9hbGdvcmFuZC5weToyNgogICAgLy8gcGF5bWVudF9ncm91cF9pbmRleCA9IHJlZl9ncm91cF9pbmRleCAtIDEKICAgIGludCAxCiAgICAtCiAgICAvLyB1c3IvbG9jYWwvbGliL3B5dGhvbjMuMTIvc2l0ZS1wYWNrYWdlcy9vcGVuc3VibWFyaW5lL3V0aWxzL2FsZ29yYW5kLnB5OjI4CiAgICAvLyBndHhuLlBheW1lbnRUcmFuc2FjdGlvbihwYXltZW50X2dyb3VwX2luZGV4KS5zZW5kZXIgPT0gd2hvCiAgICBkdXAKICAgIGd0eG5zIFR5cGVFbnVtCiAgICBpbnQgcGF5CiAgICA9PQogICAgYXNzZXJ0IC8vIHRyYW5zYWN0aW9uIHR5cGUgaXMgcGF5CiAgICBkdXAKICAgIGd0eG5zIFNlbmRlcgogICAgZnJhbWVfZGlnIC0xCiAgICA9PQogICAgLy8gdXNyL2xvY2FsL2xpYi9weXRob24zLjEyL3NpdGUtcGFja2FnZXMvb3BlbnN1Ym1hcmluZS91dGlscy9hbGdvcmFuZC5weToyNy0yOQogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBndHhuLlBheW1lbnRUcmFuc2FjdGlvbihwYXltZW50X2dyb3VwX2luZGV4KS5zZW5kZXIgPT0gd2hvCiAgICAvLyApLCAicGF5bWVudCBzZW5kZXIgYWNjdXJhdGUiCiAgICBhc3NlcnQgLy8gcGF5bWVudCBzZW5kZXIgYWNjdXJhdGUKICAgIC8vIHVzci9sb2NhbC9saWIvcHl0aG9uMy4xMi9zaXRlLXBhY2thZ2VzL29wZW5zdWJtYXJpbmUvdXRpbHMvYWxnb3JhbmQucHk6MzEKICAgIC8vIGd0eG4uUGF5bWVudFRyYW5zYWN0aW9uKHBheW1lbnRfZ3JvdXBfaW5kZXgpLnJlY2VpdmVyCiAgICBkdXAKICAgIGd0eG5zIFJlY2VpdmVyCiAgICAvLyB1c3IvbG9jYWwvbGliL3B5dGhvbjMuMTIvc2l0ZS1wYWNrYWdlcy9vcGVuc3VibWFyaW5lL3V0aWxzL2FsZ29yYW5kLnB5OjMyCiAgICAvLyA9PSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICBnbG9iYWwgQ3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcwogICAgLy8gdXNyL2xvY2FsL2xpYi9weXRob24zLjEyL3NpdGUtcGFja2FnZXMvb3BlbnN1Ym1hcmluZS91dGlscy9hbGdvcmFuZC5weTozMS0zMgogICAgLy8gZ3R4bi5QYXltZW50VHJhbnNhY3Rpb24ocGF5bWVudF9ncm91cF9pbmRleCkucmVjZWl2ZXIKICAgIC8vID09IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgID09CiAgICAvLyB1c3IvbG9jYWwvbGliL3B5dGhvbjMuMTIvc2l0ZS1wYWNrYWdlcy9vcGVuc3VibWFyaW5lL3V0aWxzL2FsZ29yYW5kLnB5OjMwLTMzCiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIGd0eG4uUGF5bWVudFRyYW5zYWN0aW9uKHBheW1lbnRfZ3JvdXBfaW5kZXgpLnJlY2VpdmVyCiAgICAvLyAgICAgPT0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gKSwgInBheW1lbnQgcmVjZWl2ZXIgYWNjdXJhdGUiCiAgICBhc3NlcnQgLy8gcGF5bWVudCByZWNlaXZlciBhY2N1cmF0ZQogICAgLy8gdXNyL2xvY2FsL2xpYi9weXRob24zLjEyL3NpdGUtcGFja2FnZXMvb3BlbnN1Ym1hcmluZS91dGlscy9hbGdvcmFuZC5weTozNAogICAgLy8gcmV0dXJuIGd0eG4uUGF5bWVudFRyYW5zYWN0aW9uKHBheW1lbnRfZ3JvdXBfaW5kZXgpLmFtb3VudAogICAgZ3R4bnMgQW1vdW50CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5nZXRfbWFya2V0KHRva2VuX2lkOiBieXRlcykgLT4gYnl0ZXM6CmdldF9tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNzctMTI3OAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICBwcm90byAxIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI3OQogICAgLy8gcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZDogYnl0ZXMpIC0+IGJ5dGVzOgpnZXRfcHJpY2VfZmVlZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM2OS0xMzcwCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIHByb3RvIDEgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzcxCiAgICAvLyByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBjYWxsc3ViIF9nZXRfcHJpY2VfZmVlZAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkOiB1aW50NjQpIC0+IGJ5dGVzOgpfZ2V0X3ByaWNlX2ZlZWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNzMtMTM3NAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzktMTM3NQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICBmcmFtZV9kaWcgLTEKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzOQogICAgLy8gc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIGJ5dGUgInByaWNlX2ZlZWRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDM5LTEzNzUKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgc3dhcAogICAgY29uY2F0CiAgICBkdXAKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzc1CiAgICAvLyBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgYnogX2dldF9wcmljZV9mZWVkX2Vsc2VfYm9keUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNzYKICAgIC8vIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgZnJhbWVfZGlnIDAKICAgIGJveF9nZXQKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnByaWNlX2ZlZWRzIGVudHJ5IGV4aXN0cwogICAgc3dhcAogICAgcmV0c3ViCgpfZ2V0X3ByaWNlX2ZlZWRfZWxzZV9ib2R5QDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNzgKICAgIC8vIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICBieXRlIDB4NzMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM3OQogICAgLy8gYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIGJveF9nZXQKICAgIGFzc2VydCAvLyBjaGVjayBCb3ggZXhpc3RzCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzODAtMTM4MgogICAgLy8gcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICBtZXRob2QgImdldF9wcmljZV9mZWVkX2RlZmF1bHQoKSh1aW50NjQsdWludDY0LCh1aW50MjU2LHVpbnQ2NCkpIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGR1cAogICAgZXh0cmFjdCA0IDAKICAgIHN3YXAKICAgIGV4dHJhY3QgMCA0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgID09CiAgICBhc3NlcnQgLy8gQVJDNCBwcmVmaXggaXMgdmFsaWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM4MwogICAgLy8gcmV0dXJuIHByaWNlX2ZlZWQKICAgIHN3YXAKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLmZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQ6IGJ5dGVzKSAtPiB2b2lkOgpmZXRjaF9wcmljZV9mZWVkOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDUzLTE0NTQKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgcHJvdG8gMSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NTUKICAgIC8vIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICBjYWxsc3ViIF9pc19wYXVzZWQKICAgICEKICAgIGFzc2VydCAvLyBQcm90b2NvbCBpcyBwYXVzZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ1NgogICAgLy8gc2VsZi5fZmV0Y2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ0b2kKICAgIGNhbGxzdWIgX2ZldGNoX3ByaWNlX2ZlZWQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkOiB1aW50NjQpIC0+IHZvaWQ6Cl9mZXRjaF9wcmljZV9mZWVkOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDU4LTE0NTkKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2ZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIHByb3RvIDEgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyLTE0NjAKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICAjIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIC8vICAgICAgICAgbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgU2NhbGUgdGhlIHByaWNlIGJ5IFNDQUxFIGludGVybmFsbHkgZm9yIHN0b3JhZ2UKICAgIC8vICAgICBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRQcmljZVNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihwcmljZSkpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBmZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9mZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGZyYW1lX2RpZyAtMQogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzItMTQ2MAogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBkZWwgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWREZXRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgICMgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIGFzc2VydCBwcmljZSA+IDAsICJQcmljZSBtdXN0IGJlIHBvc2l0aXZlIgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgVW5wYXVzZSB0aGUgbWFya2V0IG9uIGZpcnN0IHByaWNlIHNldAogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQgYW5kIG1hcmtldC5wcmljZSA9PSAwOgogICAgLy8gICAgICAgICBtYXJrZXQucGF1c2VkID0gYXJjNC5Cb29sKEZhbHNlKQogICAgLy8gCiAgICAvLyAgICAgIyBTY2FsZSB0aGUgcHJpY2UgYnkgU0NBTEUgaW50ZXJuYWxseSBmb3Igc3RvcmFnZQogICAgLy8gICAgIG1hcmtldC5wcmljZSA9IGFyYzQuVUludDI1NihwcmljZSAqIFNDQUxFKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFByaWNlU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KHByaWNlKSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgc2VsZi5fZmV0Y2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2ZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgZGlnIDEKICAgIGNvbmNhdAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NjAKICAgIC8vIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBhc3NlcnQgLy8gTWFya2V0IGRvZXMgbm90IGV4aXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzkKICAgIC8vIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICBieXRlICJwcmljZV9mZWVkcyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzOS0xNDYxCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9kYXRhLnByaWNlID09IG1hcmtldC5wcmljZSwgIlByaWNlIG1pc21hdGNoIgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc3VtZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXSA9IFByaWNlRmVlZCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wPVByaWNlV2l0aFRpbWVzdGFtcCgKICAgIC8vICAgICAgICAgICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICksCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZEF0dGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZC5uYXRpdmUsIHByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcmljZTogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgIyBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIGRpZyAxCiAgICBjb25jYXQKICAgIGR1cAogICAgY292ZXIgMgogICAgZHVwCiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ2MQogICAgLy8gYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIGFzc2VydCAvLyBQcmljZSBmZWVkIG5vdCBhdHRhY2hlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDYyCiAgICAvLyBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICB0eG4gU2VuZGVyCiAgICBjYWxsc3ViIHJlcXVpcmVfcGF5bWVudAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDYzCiAgICAvLyBhc3NlcnQgcGF5bWVudCA+PSAxMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNQogICAgZHVwCiAgICBpbnQgMTAwMDAwCiAgICA+PQogICAgYXNzZXJ0IC8vIGluc3VmZmljaWVudCBwYXltZW50IGZvciBmZXRjaCBwcmljZSBmZWVkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NjUKICAgIC8vIHBheW1lbnQgPD0gMTAwMDAwMAogICAgZHVwCiAgICBpbnQgMTAwMDAwMAogICAgPD0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ2NC0xNDY2CiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIHBheW1lbnQgPD0gMTAwMDAwMAogICAgLy8gKSwgInBheW1lbnQgZXhjZWVkcyBtYXhpbXVtIGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS02CiAgICBhc3NlcnQgLy8gcGF5bWVudCBleGNlZWRzIG1heGltdW0gZm9yIGZldGNoIHByaWNlIGZlZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ2NwogICAgLy8gYXBwID0gQXBwbGljYXRpb24oc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIGRpZyAxCiAgICBib3hfZ2V0CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5wcmljZV9mZWVkcyBlbnRyeSBleGlzdHMKICAgIGV4dHJhY3QgOCA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDY4CiAgICAvLyBpdHhuLlBheW1lbnQocmVjZWl2ZXI9YXBwLmFkZHJlc3MsIGFtb3VudD1wYXltZW50LCBmZWU9MCkuc3VibWl0KCkKICAgIGl0eG5fYmVnaW4KICAgIGR1cAogICAgYXBwX3BhcmFtc19nZXQgQXBwQWRkcmVzcwogICAgYXNzZXJ0IC8vIGFwcGxpY2F0aW9uIGV4aXN0cwogICAgdW5jb3ZlciAyCiAgICBpdHhuX2ZpZWxkIEFtb3VudAogICAgaXR4bl9maWVsZCBSZWNlaXZlcgogICAgaW50IHBheQogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDY5LTE0NzMKICAgIC8vIHByaWNlX3dpdGhfdGltZXN0YW1wLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIFByaWNlRmVlZFByb3ZpZGVySW50ZXJmYWNlLmdldF9wcmljZV93aXRoX3RpbWVzdGFtcCwKICAgIC8vICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgYXBwX2lkPWFwcCwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgbWV0aG9kICJnZXRfcHJpY2Vfd2l0aF90aW1lc3RhbXAodWludDY0KSh1aW50MjU2LHVpbnQ2NCkiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgc3dhcAogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGR1cAogICAgZXh0cmFjdCA0IDAKICAgIGR1cAogICAgY292ZXIgMgogICAgY292ZXIgMwogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDc1CiAgICAvLyBwcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICBleHRyYWN0IDMyIDggLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NzYKICAgIC8vID4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgc3dhcAogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYucHJpY2VfZmVlZHMgZW50cnkgZXhpc3RzCiAgICBleHRyYWN0IDE2IDQwIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZXh0cmFjdCAzMiA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDc1LTE0NzYKICAgIC8vIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vID4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgPgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDc0LTE0NzcKICAgIC8vIGlmICgKICAgIC8vICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyApOgogICAgYnogX2ZldGNoX3ByaWNlX2ZlZWRfYWZ0ZXJfaWZfZWxzZUA0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NzgKICAgIC8vIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wID0gKAogICAgZnJhbWVfZGlnIDAKICAgIGR1cAogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYucHJpY2VfZmVlZHMgZW50cnkgZXhpc3RzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NzgtMTQ4MAogICAgLy8gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAuY29weSgpCiAgICAvLyApCiAgICBmcmFtZV9kaWcgMQogICAgZHVwCiAgICBjb3ZlciAyCiAgICByZXBsYWNlMiAxNgogICAgdW5jb3ZlciAyCiAgICBzd2FwCiAgICBib3hfcHV0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0ODEKICAgIC8vIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQsIHByaWNlX3dpdGhfdGltZXN0YW1wLnByaWNlLm5hdGl2ZSkKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAtMQogICAgc3dhcAogICAgY2FsbHN1YiBfc2V0X21hcmtldF9wcmljZQoKX2ZldGNoX3ByaWNlX2ZlZWRfYWZ0ZXJfaWZfZWxzZUA0OgogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wucGF1c2VfbWFya2V0KHRva2VuX2lkOiBieXRlcywgcGF1c2U6IGJ5dGVzKSAtPiB2b2lkOgpwYXVzZV9tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MzMtMTUzNAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MzUKICAgIC8vIHNlbGYuX29ubHlfb3duZXIoKQogICAgY2FsbHN1YiBfb25seV9vd25lcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTM2CiAgICAvLyBzZWxmLl9wYXVzZV9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBwYXVzZS5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ0b2kKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgY2FsbHN1YiBfcGF1c2VfbWFya2V0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fcGF1c2VfbWFya2V0KHRva2VuX2lkOiB1aW50NjQsIHBhdXNlOiB1aW50NjQpIC0+IHZvaWQ6Cl9wYXVzZV9tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MzgtMTUzOQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMi0xNTQwCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9kYXRhLnByaWNlID09IG1hcmtldC5wcmljZSwgIlByaWNlIG1pc21hdGNoIgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc3VtZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXSA9IFByaWNlRmVlZCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wPVByaWNlV2l0aFRpbWVzdGFtcCgKICAgIC8vICAgICAgICAgICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICksCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZEF0dGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZC5uYXRpdmUsIHByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcmljZTogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgIyBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMTAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTUKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBwYXltZW50IDw9IDEwMDAwMDAKICAgIC8vICAgICApLCAicGF5bWVudCBleGNlZWRzIG1heGltdW0gZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTYKICAgIC8vICAgICBhcHAgPSBBcHBsaWNhdGlvbihzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gICAgIGl0eG4uUGF5bWVudChyZWNlaXZlcj1hcHAuYWRkcmVzcywgYW1vdW50PXBheW1lbnQsIGZlZT0wKS5zdWJtaXQoKQogICAgLy8gICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBQcmljZUZlZWRQcm92aWRlckludGVyZmFjZS5nZXRfcHJpY2Vfd2l0aF90aW1lc3RhbXAsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWFwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgICAgID4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICk6CiAgICAvLyAgICAgICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wID0gKAogICAgLy8gICAgICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAuY29weSgpCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZCwgcHJpY2Vfd2l0aF90aW1lc3RhbXAucHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlX21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9wYXVzZV9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBwYXVzZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3BhdXNlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBmcmFtZV9kaWcgLTIKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMgogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyLTE1NDAKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICAjIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIC8vICAgICAgICAgbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgU2NhbGUgdGhlIHByaWNlIGJ5IFNDQUxFIGludGVybmFsbHkgZm9yIHN0b3JhZ2UKICAgIC8vICAgICBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRQcmljZVNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihwcmljZSkpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBmZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9mZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAxMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHBheW1lbnQgPD0gMTAwMDAwMAogICAgLy8gICAgICksICJwYXltZW50IGV4Y2VlZHMgbWF4aW11bSBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNgogICAgLy8gICAgIGFwcCA9IEFwcGxpY2F0aW9uKHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAgICAgaXR4bi5QYXltZW50KHJlY2VpdmVyPWFwcC5hZGRyZXNzLCBhbW91bnQ9cGF5bWVudCwgZmVlPTApLnN1Ym1pdCgpCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFByaWNlRmVlZFByb3ZpZGVySW50ZXJmYWNlLmdldF9wcmljZV93aXRoX3RpbWVzdGFtcCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICAgICAgPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgKToKICAgIC8vICAgICAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICAvLyAgICAgICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC5jb3B5KCkKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLCBwcmljZV93aXRoX3RpbWVzdGFtcC5wcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3BhdXNlX21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIHBhdXNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIHN3YXAKICAgIGNvbmNhdAogICAgZHVwCiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU0MAogICAgLy8gYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGFzc2VydCAvLyBNYXJrZXQgZG9lcyBub3QgZXhpc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU0MQogICAgLy8gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5wYXVzZWQgPSBhcmM0LkJvb2wocGF1c2UgPT0gVUludDY0KDEpKQogICAgZnJhbWVfZGlnIC0xCiAgICBpbnQgMQogICAgPT0KICAgIGJ5dGUgMHgwMAogICAgaW50IDAKICAgIHVuY292ZXIgMgogICAgc2V0Yml0CiAgICBkaWcgMQogICAgYm94X2dldAogICAgc3dhcAogICAgY292ZXIgMgogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYubWFya2V0cyBlbnRyeSBleGlzdHMKICAgIGludCAwCiAgICBnZXRiaXQKICAgIGludCAwCiAgICBzd2FwCiAgICBzZXRiaXQKICAgIGJveF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLnN5bmNfbWFya2V0KG1hcmtldF9pZDogYnl0ZXMpIC0+IHZvaWQ6CnN5bmNfbWFya2V0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTQzLTE1NDQKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfbWFya2V0KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU0NQogICAgLy8gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZC5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ0b2kKICAgIGNhbGxzdWIgX2FjY3J1ZV9pbnRlcmVzdAogICAgcG9wCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZDogdWludDY0KSAtPiBieXRlczoKX2FjY3J1ZV9pbnRlcmVzdDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU5NS0xNTk2CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hY2NydWVfaW50ZXJlc3Qoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICBwcm90byAxIDEKICAgIGludCAwCiAgICBkdXBuIDEwCiAgICBieXRlICIiCiAgICBkdXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYwMAogICAgLy8gbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIGR1cAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjAxCiAgICAvLyBpZiBtYXJrZXQucGF1c2VkOgogICAgaW50IDAKICAgIGdldGJpdAogICAgYnl0ZSAweDAwCiAgICBpbnQgMAogICAgdW5jb3ZlciAyCiAgICBzZXRiaXQKICAgIGJ5dGUgMHgwMAogICAgIT0KICAgIGJ6IF9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MDIKICAgIC8vIHJldHVybiBtYXJrZXQKICAgIGZyYW1lX2RpZyAxMwogICAgZnJhbWVfYnVyeSAwCiAgICByZXRzdWIKCl9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjA0CiAgICAvLyBjdXJyZW50X3RpbWUgPSBHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcAogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgZHVwCiAgICBmcmFtZV9idXJ5IDExCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MDUKICAgIC8vIHRpbWVfZGVsdGEgPSBjdXJyZW50X3RpbWUgLSBtYXJrZXQubGFzdF91cGRhdGVfdGltZS5uYXRpdmUKICAgIGZyYW1lX2RpZyAxMwogICAgZXh0cmFjdCAyNDEgOCAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ0b2kKICAgIC0KICAgIGR1cAogICAgZnJhbWVfYnVyeSAxMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjA2CiAgICAvLyBpZiB0aW1lX2RlbHRhIDw9IDA6CiAgICBpbnQgMAogICAgPD0KICAgIGJ6IF9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUA0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MDcKICAgIC8vIHJldHVybiBtYXJrZXQKICAgIGZyYW1lX2RpZyAxMwogICAgZnJhbWVfYnVyeSAwCiAgICByZXRzdWIKCl9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUA0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjA5CiAgICAvLyB1dGlsaXphdGlvbiA9IHNlbGYuX2NhbGN1bGF0ZV91dGlsaXphdGlvbihtYXJrZXQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAxMwogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9jYWxjdWxhdGVfdXRpbGl6YXRpb24KICAgIGZyYW1lX2J1cnkgMTMKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjEwCiAgICAvLyBpZiB1dGlsaXphdGlvbiA9PSAwOgogICAgYnl0ZSAweAogICAgYj09CiAgICBieiBfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VANgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjExCiAgICAvLyByZXR1cm4gbWFya2V0CiAgICBmcmFtZV9kaWcgMTMKICAgIGZyYW1lX2J1cnkgMAogICAgcmV0c3ViCgpfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VANjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYxMwogICAgLy8gaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfaW50ZXJlc3QobWFya2V0LCB1dGlsaXphdGlvbiwgdGltZV9kZWx0YSkKICAgIGZyYW1lX2RpZyAxMwogICAgZnJhbWVfZGlnIDEwCiAgICBmcmFtZV9kaWcgMTIKICAgIGNhbGxzdWIgX2NhbGN1bGF0ZV9pbnRlcmVzdAogICAgZHVwCiAgICBjb3ZlciAyCiAgICBmcmFtZV9idXJ5IDEzCiAgICBkdXAKICAgIGNvdmVyIDIKICAgIGZyYW1lX2J1cnkgNQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjE4CiAgICAvLyBtYXJrZXRfaWQsIHNlbGYuc3Rva2VuX2FwcF9pZCwgaW50ZXJlc3QsIG1hcmtldC5yZXNlcnZlX2ZhY3Rvci5uYXRpdmUKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzAKICAgIC8vIHNlbGYuc3Rva2VuX2FwcF9pZCA9IFVJbnQ2NCgpICAjIHN0YWJsZSBtYXJrZXQKICAgIGJ5dGUgInN0b2tlbl9hcHBfaWQiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MTgKICAgIC8vIG1hcmtldF9pZCwgc2VsZi5zdG9rZW5fYXBwX2lkLCBpbnRlcmVzdCwgbWFya2V0LnJlc2VydmVfZmFjdG9yLm5hdGl2ZQogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIHN3YXAKICAgIGNvdmVyIDIKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnN0b2tlbl9hcHBfaWQgZXhpc3RzCiAgICBkdXAKICAgIGV4dHJhY3QgODkgOCAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYxNS0xNjE5CiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICMgSW50ZXJlc3QgZGlzdHJpYnV0aW9uCiAgICAvLyBpbnRlcmVzdF9zcGxpdCA9IHNlbGYuX2NhbGN1bGF0ZV9pbnRlcmVzdF9zcGxpdCgKICAgIC8vICAgICBtYXJrZXRfaWQsIHNlbGYuc3Rva2VuX2FwcF9pZCwgaW50ZXJlc3QsIG1hcmtldC5yZXNlcnZlX2ZhY3Rvci5uYXRpdmUKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMQogICAgdW5jb3ZlciAzCiAgICB1bmNvdmVyIDQKICAgIHVuY292ZXIgMwogICAgY2FsbHN1YiBfY2FsY3VsYXRlX2ludGVyZXN0X3NwbGl0CiAgICBmcmFtZV9idXJ5IDYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYyMi0xNjI0CiAgICAvLyAjIENoZWNrIGlmIHVzZXIgaW5kZXhlcyBjYW4gZ3JvdyBtZWFuaW5nZnVsbHkKICAgIC8vICMgU2FmZXR5IGNoZWNrOiBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8gZm9yIGZpcnN0IGRlcG9zaXRzL2JvcnJvd3MKICAgIC8vIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICBleHRyYWN0IDExMyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA5CiAgICBieXRlIDB4CiAgICBiPT0KICAgIGJ6IF9hY2NydWVfaW50ZXJlc3RfZWxzZV9ib2R5QDgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYyNQogICAgLy8gZGVwb3NpdG9yX2luY3JlbWVudCA9IEJpZ1VJbnQoMCkKICAgIGJ5dGUgMHgKICAgIGZyYW1lX2J1cnkgNAogICAgYiBfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAOQoKX2FjY3J1ZV9pbnRlcmVzdF9lbHNlX2JvZHlAODoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYyNwogICAgLy8gZGVwb3NpdG9yX2luY3JlbWVudCA9IChpbnRlcmVzdF9zcGxpdC5kZXBvc2l0b3JfcG9ydGlvbi5uYXRpdmUgKiBTQ0FMRSkgLy8gKAogICAgZnJhbWVfZGlnIDYKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjI3LTE2MjkKICAgIC8vIGRlcG9zaXRvcl9pbmNyZW1lbnQgPSAoaW50ZXJlc3Rfc3BsaXQuZGVwb3NpdG9yX3BvcnRpb24ubmF0aXZlICogU0NBTEUpIC8vICgKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gKQogICAgZnJhbWVfZGlnIDkKICAgIGIvCiAgICBmcmFtZV9idXJ5IDQKCl9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUA5OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjMxCiAgICAvLyBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID09IDA6CiAgICBmcmFtZV9kaWcgMTMKICAgIGV4dHJhY3QgMTQ1IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDgKICAgIGJ5dGUgMHgKICAgIGI9PQogICAgYnogX2FjY3J1ZV9pbnRlcmVzdF9lbHNlX2JvZHlAMTEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYzMgogICAgLy8gYm9ycm93ZXJfaW5jcmVtZW50ID0gQmlnVUludCgwKQogICAgYnl0ZSAweAogICAgZnJhbWVfYnVyeSAyCiAgICBiIF9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAxMgoKX2FjY3J1ZV9pbnRlcmVzdF9lbHNlX2JvZHlAMTE6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MzQKICAgIC8vIGJvcnJvd2VyX2luY3JlbWVudCA9IChpbnRlcmVzdCAqIFNDQUxFKSAvLyAoCiAgICBmcmFtZV9kaWcgNQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MzQtMTYzNgogICAgLy8gYm9ycm93ZXJfaW5jcmVtZW50ID0gKGludGVyZXN0ICogU0NBTEUpIC8vICgKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgOAogICAgYi8KICAgIGZyYW1lX2J1cnkgMgoKX2FjY3J1ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDEyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjM4CiAgICAvLyBpZiBkZXBvc2l0b3JfaW5jcmVtZW50ID09IDAgb3IgYm9ycm93ZXJfaW5jcmVtZW50ID09IDA6CiAgICBmcmFtZV9kaWcgNAogICAgYnl0ZSAweAogICAgYj09CiAgICBibnogX2FjY3J1ZV9pbnRlcmVzdF9pZl9ib2R5QDE0CiAgICBmcmFtZV9kaWcgMgogICAgYnl0ZSAweAogICAgYj09CiAgICBieiBfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMTUKCl9hY2NydWVfaW50ZXJlc3RfaWZfYm9keUAxNDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYzOQogICAgLy8gcmV0dXJuIG1hcmtldAogICAgZnJhbWVfZGlnIDEzCiAgICBmcmFtZV9idXJ5IDAKICAgIHJldHN1YgoKX2FjY3J1ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDE1OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjQzCiAgICAvLyBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID4gMDoKICAgIGZyYW1lX2RpZyA5CiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAogICAgYj4KICAgIGZyYW1lX2RpZyAxMwogICAgZnJhbWVfYnVyeSA3CiAgICBieiBfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMTcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY0NQogICAgLy8gbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICsgZGVwb3NpdG9yX2luY3JlbWVudAogICAgZnJhbWVfZGlnIDEzCiAgICBkdXAKICAgIGV4dHJhY3QgMTc3IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIDQKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NDQtMTY0NgogICAgLy8gbWFya2V0LmRlcG9zaXRfaW5kZXggPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICsgZGVwb3NpdG9yX2luY3JlbWVudAogICAgLy8gKQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDE3NwogICAgZnJhbWVfYnVyeSA3CgpfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMTc6CiAgICBmcmFtZV9kaWcgNwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NDgtMTY0OQogICAgLy8gIyBtYXJrZXQgYm9ycm93IGluZGV4IHVwZGF0ZSBkZXBlbmRzIG9uIGZ1bGwgaW50ZXJlc3QgYW1vdW50CiAgICAvLyBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPiAwOgogICAgZHVwCiAgICBleHRyYWN0IDE0NSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICBiPgogICAgc3dhcAogICAgZnJhbWVfYnVyeSA3CiAgICBieiBfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMTkKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY1MQogICAgLy8gbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgKyBib3Jyb3dlcl9pbmNyZW1lbnQKICAgIGZyYW1lX2RpZyAxMwogICAgZHVwCiAgICBleHRyYWN0IDIwOSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAyCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjUwLTE2NTIKICAgIC8vIG1hcmtldC5ib3Jyb3dfaW5kZXggPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgKyBib3Jyb3dlcl9pbmNyZW1lbnQKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXBsYWNlMiAyMDkKICAgIGZyYW1lX2J1cnkgNwoKX2FjY3J1ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDE5OgogICAgZnJhbWVfZGlnIDcKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxMwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjU0LTE2NTcKICAgIC8vICMgbWFya2V0IHRvdGFsIHNjYWxlZCBib3Jyb3dzIHVwZGF0ZSBkZXBlbmRzIG9uIGZ1bGwgaW50ZXJlc3QgYW1vdW50CiAgICAvLyAjIENvbnZlcnQgaW50ZXJlc3QgdG8gc2NhbGVkIGJvcnJvd3MgdXNpbmcgY3VycmVudCBtYXJrZXQgaW5kZXgKICAgIC8vICMgU2FmZXR5IGNoZWNrOiBlbnN1cmUgYm9ycm93X2luZGV4IGlzIG5ldmVyIDAKICAgIC8vIGJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICBleHRyYWN0IDIwOSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NTgKICAgIC8vIGlmIGJvcnJvd19pbmRleCA9PSAwOgogICAgYnl0ZSAweAogICAgYj09CiAgICBieiBfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMjEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY1OQogICAgLy8gYm9ycm93X2luZGV4ID0gQmlnVUludChTQ0FMRSkKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBmcmFtZV9idXJ5IDEKCl9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAyMToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY2MAogICAgLy8gaW50ZXJlc3Rfc2NhbGVkX2JvcnJvd3MgPSAoaW50ZXJlc3QgKiBTQ0FMRSkgLy8gYm9ycm93X2luZGV4CiAgICBmcmFtZV9kaWcgNQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIqCiAgICBmcmFtZV9kaWcgMQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY2MgogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGludGVyZXN0X3NjYWxlZF9ib3Jyb3dzCiAgICBmcmFtZV9kaWcgMTMKICAgIGR1cAogICAgY292ZXIgMgogICAgZXh0cmFjdCAxNDUgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjYxLTE2NjMKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgaW50ZXJlc3Rfc2NhbGVkX2JvcnJvd3MKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGR1cAogICAgZnJhbWVfYnVyeSAwCiAgICBifAogICAgcmVwbGFjZTIgMTQ1CiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMTMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY2NS0xNjY4CiAgICAvLyAjIG1hcmtldCB0b3RhbCBzY2FsZWQgZGVwb3NpdHMgdXBkYXRlIGRlcGVuZHMgb24gZGVwb3NpdG9yIHBvcnRpb24gb2YgaW50ZXJlc3QKICAgIC8vICMgQ29udmVydCBkZXBvc2l0b3IgcG9ydGlvbiB0byBzY2FsZWQgZGVwb3NpdHMgdXNpbmcgY3VycmVudCBtYXJrZXQgaW5kZXgKICAgIC8vICMgU2FmZXR5IGNoZWNrOiBlbnN1cmUgZGVwb3NpdF9pbmRleCBpcyBuZXZlciAwCiAgICAvLyBkZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICBleHRyYWN0IDE3NyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSAzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NjkKICAgIC8vIGlmIGRlcG9zaXRfaW5kZXggPT0gMDoKICAgIGJ5dGUgMHgKICAgIGI9PQogICAgYnogX2FjY3J1ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDIzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NzAKICAgIC8vIGRlcG9zaXRfaW5kZXggPSBCaWdVSW50KFNDQUxFKQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGZyYW1lX2J1cnkgMwoKX2FjY3J1ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDIzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjcyCiAgICAvLyBpbnRlcmVzdF9zcGxpdC5kZXBvc2l0b3JfcG9ydGlvbi5uYXRpdmUgKiBTQ0FMRQogICAgZnJhbWVfZGlnIDYKICAgIGR1cAogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NzEtMTY3MwogICAgLy8gZGVwb3NpdG9yX3NjYWxlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgaW50ZXJlc3Rfc3BsaXQuZGVwb3NpdG9yX3BvcnRpb24ubmF0aXZlICogU0NBTEUKICAgIC8vICkgLy8gZGVwb3NpdF9pbmRleAogICAgZnJhbWVfZGlnIDMKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NzUKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgZGVwb3NpdG9yX3NjYWxlZF9hbW91bnQKICAgIGZyYW1lX2RpZyAxMwogICAgZHVwCiAgICBjb3ZlciAyCiAgICBleHRyYWN0IDExMyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NzQtMTY3NgogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGRlcG9zaXRvcl9zY2FsZWRfYW1vdW50CiAgICAvLyApCiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBmcmFtZV9kaWcgMAogICAgZHVwCiAgICBjb3ZlciAzCiAgICBifAogICAgcmVwbGFjZTIgMTEzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2ODAKICAgIC8vIG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgKyBpbnRlcmVzdF9zcGxpdC5wcm90b2NvbF9wb3J0aW9uLm5hdGl2ZQogICAgZHVwCiAgICBleHRyYWN0IDI0OSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHVuY292ZXIgMwogICAgZXh0cmFjdCAzMiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NzgtMTY4MQogICAgLy8gIyBtYXJrZXQgcmVzZXJ2ZXMgdXBkYXRlIGRlcGVuZHMgb24gcHJvdG9jb2wgcG9ydGlvbiBvZiBpbnRlcmVzdAogICAgLy8gbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgIG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgKyBpbnRlcmVzdF9zcGxpdC5wcm90b2NvbF9wb3J0aW9uLm5hdGl2ZQogICAgLy8gKQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgdW5jb3ZlciAyCiAgICBifAogICAgcmVwbGFjZTIgMjQ5CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2ODMKICAgIC8vIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoY3VycmVudF90aW1lKQogICAgZnJhbWVfZGlnIDExCiAgICBpdG9iCiAgICByZXBsYWNlMiAyNDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY4NQogICAgLy8gc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBmcmFtZV9kaWcgLTEKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMgogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjg1CiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIHN3YXAKICAgIGNvbmNhdAogICAgZGlnIDEKICAgIGJveF9wdXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY4NwogICAgLy8gcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIGZyYW1lX2J1cnkgMAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2NhbGN1bGF0ZV91dGlsaXphdGlvbihtYXJrZXQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCkgLT4gYnl0ZXMsIGJ5dGVzOgpfY2FsY3VsYXRlX3V0aWxpemF0aW9uOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTQ3LTE1NDgKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91dGlsaXphdGlvbihzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIG1hcmtldF9pZDogVUludDY0KSAtPiBCaWdVSW50OgogICAgcHJvdG8gMiAyCiAgICBpbnQgMAogICAgYnl0ZSAiIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTQ5CiAgICAvLyBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMAogICAgLy8gc2VsZi5zdG9rZW5fYXBwX2lkID0gVUludDY0KCkgICMgc3RhYmxlIG1hcmtldAogICAgYnl0ZSAic3Rva2VuX2FwcF9pZCIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU0OQogICAgLy8gaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5zdG9rZW5fYXBwX2lkIGV4aXN0cwogICAgZnJhbWVfZGlnIC0xCiAgICA9PQogICAgYnogX2NhbGN1bGF0ZV91dGlsaXphdGlvbl9lbHNlX2JvZHlAMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTUwCiAgICAvLyByZXR1cm4gQmlnVUludCgxMDAwMCkgICMgMTAwJSB1dGlsaXphdGlvbiBmb3IgYm9ycm93LW9ubHkgbWFya2V0CiAgICBieXRlIDB4MjcxMAogICAgZnJhbWVfZGlnIC0yCiAgICB1bmNvdmVyIDMKICAgIHVuY292ZXIgMwogICAgcmV0c3ViCgpfY2FsY3VsYXRlX3V0aWxpemF0aW9uX2Vsc2VfYm9keUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTUxCiAgICAvLyBlbGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICBmcmFtZV9kaWcgLTIKICAgIGV4dHJhY3QgMTEzIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDAKICAgIGJ5dGUgMHgKICAgIGI9PQogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEKICAgIGJ6IF9jYWxjdWxhdGVfdXRpbGl6YXRpb25fZWxzZV9ib2R5QDQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU1MgogICAgLy8gcmV0dXJuIEJpZ1VJbnQoMCkKICAgIGJ5dGUgMHgKICAgIGZyYW1lX2RpZyAtMgogICAgdW5jb3ZlciAzCiAgICB1bmNvdmVyIDMKICAgIHJldHN1YgoKX2NhbGN1bGF0ZV91dGlsaXphdGlvbl9lbHNlX2JvZHlANDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU1NgogICAgLy8gaWYgdG90YWxfZGVwb3NpdHMgPT0gMDoKICAgIGZyYW1lX2RpZyAxCiAgICBieiBfY2FsY3VsYXRlX3V0aWxpemF0aW9uX2FmdGVyX2lmX2Vsc2VANgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTU3CiAgICAvLyByZXR1cm4gQmlnVUludCgwKQogICAgYnl0ZSAweAogICAgZnJhbWVfZGlnIC0yCiAgICB1bmNvdmVyIDMKICAgIHVuY292ZXIgMwogICAgcmV0c3ViCgpfY2FsY3VsYXRlX3V0aWxpemF0aW9uX2FmdGVyX2lmX2Vsc2VANjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU1OAogICAgLy8gcmV0dXJuIChtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDApIC8vIHRvdGFsX2RlcG9zaXRzCiAgICBmcmFtZV9kaWcgLTIKICAgIGV4dHJhY3QgMTQ1IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnl0ZSAweDI3MTAKICAgIGIqCiAgICBmcmFtZV9kaWcgMAogICAgYi8KICAgIGZyYW1lX2RpZyAtMgogICAgdW5jb3ZlciAzCiAgICB1bmNvdmVyIDMKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9jYWxjdWxhdGVfaW50ZXJlc3QobWFya2V0OiBieXRlcywgdXRpbGl6YXRpb246IGJ5dGVzLCB0aW1lX2RlbHRhOiB1aW50NjQpIC0+IGJ5dGVzLCBieXRlczoKX2NhbGN1bGF0ZV9pbnRlcmVzdDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU2MC0xNTYzCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhLCB1dGlsaXphdGlvbjogQmlnVUludCwgdGltZV9kZWx0YTogVUludDY0CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICBwcm90byAzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU2NAogICAgLy8gaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA9PSAwOgogICAgZnJhbWVfZGlnIC0zCiAgICBleHRyYWN0IDE0NSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgYnl0ZSAweAogICAgYj09CiAgICBieiBfY2FsY3VsYXRlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTY1CiAgICAvLyByZXR1cm4gQmlnVUludCgwKQogICAgYnl0ZSAweAogICAgZnJhbWVfZGlnIC0zCiAgICB1bmNvdmVyIDIKICAgIHJldHN1YgoKX2NhbGN1bGF0ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NjYKICAgIC8vIHJhdGUgPSBtYXJrZXQuYm9ycm93X3JhdGUubmF0aXZlICsgKG1hcmtldC5zbG9wZS5uYXRpdmUgKiB1dGlsaXphdGlvbikgLy8gMTAwMDAKICAgIGZyYW1lX2RpZyAtMwogICAgZXh0cmFjdCA5NyA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgaXRvYgogICAgZnJhbWVfZGlnIC0zCiAgICBleHRyYWN0IDEwNSA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgaXRvYgogICAgZnJhbWVfZGlnIC0yCiAgICBiKgogICAgYnl0ZSAweDI3MTAKICAgIGIvCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTY3LTE1NjkKICAgIC8vICMgQ2FsY3VsYXRlIGludGVyZXN0IGJhc2VkIG9uIFNDQUxFRCBib3Jyb3dzLCBub3QgdW5kZXJseWluZwogICAgLy8gIyBUaGlzIHByZXZlbnRzIGRvdWJsZSBjb21wb3VuZGluZyBhbmQgbWFpbnRhaW5zIGNvbnNpc3RlbmN5IHdpdGggdGhlIGFjY291bnRpbmcgc3lzdGVtCiAgICAvLyByZXR1cm4gKHJhdGUgKiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdGltZV9kZWx0YSkgLy8gKAogICAgZnJhbWVfZGlnIDAKICAgIGIqCiAgICBmcmFtZV9kaWcgLTEKICAgIGl0b2IKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NzAKICAgIC8vIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMxCiAgICAvLyBzZWxmLnNlY29uZHNfcGVyX3llYXIgPSBVSW50NjQoKSAgIyBzZWNvbmRzIHBlciB5ZWFyCiAgICBieXRlICJzZWNvbmRzX3Blcl95ZWFyIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTcwCiAgICAvLyBzZWxmLnNlY29uZHNfcGVyX3llYXIgKiAxMDAwMAogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnNlY29uZHNfcGVyX3llYXIgZXhpc3RzCiAgICBpbnQgMTAwMDAKICAgICoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU2Ny0xNTcxCiAgICAvLyAjIENhbGN1bGF0ZSBpbnRlcmVzdCBiYXNlZCBvbiBTQ0FMRUQgYm9ycm93cywgbm90IHVuZGVybHlpbmcKICAgIC8vICMgVGhpcyBwcmV2ZW50cyBkb3VibGUgY29tcG91bmRpbmcgYW5kIG1haW50YWlucyBjb25zaXN0ZW5jeSB3aXRoIHRoZSBhY2NvdW50aW5nIHN5c3RlbQogICAgLy8gcmV0dXJuIChyYXRlICogbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHRpbWVfZGVsdGEpIC8vICgKICAgIC8vICAgICBzZWxmLnNlY29uZHNfcGVyX3llYXIgKiAxMDAwMAogICAgLy8gKQogICAgaXRvYgogICAgYi8KICAgIGZyYW1lX2RpZyAtMwogICAgdW5jb3ZlciAyCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fY2FsY3VsYXRlX2ludGVyZXN0X3NwbGl0KG1hcmtldF9pZDogdWludDY0LCBzdG9rZW5fYXBwX2lkOiB1aW50NjQsIGludGVyZXN0OiBieXRlcywgcmVzZXJ2ZV9mYWN0b3I6IHVpbnQ2NCkgLT4gYnl0ZXM6Cl9jYWxjdWxhdGVfaW50ZXJlc3Rfc3BsaXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NzMtMTU4MAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX2ludGVyZXN0X3NwbGl0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgc3Rva2VuX2FwcF9pZDogVUludDY0LAogICAgLy8gICAgIGludGVyZXN0OiBCaWdVSW50LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBVSW50NjQsCiAgICAvLyApIC0+IEludGVyZXN0U3BsaXQ6CiAgICBwcm90byA0IDEKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1ODEtMTU4MgogICAgLy8gIyBTcGVjaWFsIGhhbmRsaW5nIGZvciBzdG9rZW4gbWFya2V0IC0gYWxsIGludGVyZXN0IGdvZXMgdG8gcmVzZXJ2ZXMKICAgIC8vIGlmIG1hcmtldF9pZCA9PSBzdG9rZW5fYXBwX2lkOgogICAgZnJhbWVfZGlnIC00CiAgICBmcmFtZV9kaWcgLTMKICAgID09CiAgICBieiBfY2FsY3VsYXRlX2ludGVyZXN0X3NwbGl0X2Vsc2VfYm9keUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1ODMKICAgIC8vIGRlcG9zaXRvcl9wb3J0aW9uID0gQmlnVUludCgwKQogICAgYnl0ZSAweAogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9idXJ5IDAKICAgIGIgX2NhbGN1bGF0ZV9pbnRlcmVzdF9zcGxpdF9hZnRlcl9pZl9lbHNlQDUKCl9jYWxjdWxhdGVfaW50ZXJlc3Rfc3BsaXRfZWxzZV9ib2R5QDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1ODYKICAgIC8vIHByb3RvY29sX3BvcnRpb24gPSAoaW50ZXJlc3QgKiByZXNlcnZlX2ZhY3RvcikgLy8gMTAwMDAKICAgIGZyYW1lX2RpZyAtMQogICAgaXRvYgogICAgZnJhbWVfZGlnIC0yCiAgICBiKgogICAgYnl0ZSAweDI3MTAKICAgIGIvCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTg3CiAgICAvLyBpZiBwcm90b2NvbF9wb3J0aW9uID4gaW50ZXJlc3Q6CiAgICBmcmFtZV9kaWcgLTIKICAgIGI+CiAgICBieiBfY2FsY3VsYXRlX2ludGVyZXN0X3NwbGl0X2FmdGVyX2lmX2Vsc2VANAogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9idXJ5IDAKCl9jYWxjdWxhdGVfaW50ZXJlc3Rfc3BsaXRfYWZ0ZXJfaWZfZWxzZUA0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTg5CiAgICAvLyBkZXBvc2l0b3JfcG9ydGlvbiA9IGludGVyZXN0IC0gcHJvdG9jb2xfcG9ydGlvbgogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgMAogICAgYi0KCl9jYWxjdWxhdGVfaW50ZXJlc3Rfc3BsaXRfYWZ0ZXJfaWZfZWxzZUA1OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTkxCiAgICAvLyBkZXBvc2l0b3JfcG9ydGlvbj1hcmM0LlVJbnQyNTYoZGVwb3NpdG9yX3BvcnRpb24pLAogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgZHVwCiAgICBjb3ZlciAyCiAgICBifAogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTkyCiAgICAvLyBwcm90b2NvbF9wb3J0aW9uPWFyYzQuVUludDI1Nihwcm90b2NvbF9wb3J0aW9uKSwKICAgIGZyYW1lX2RpZyAwCiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBifAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTkwLTE1OTMKICAgIC8vIHJldHVybiBJbnRlcmVzdFNwbGl0KAogICAgLy8gICAgIGRlcG9zaXRvcl9wb3J0aW9uPWFyYzQuVUludDI1NihkZXBvc2l0b3JfcG9ydGlvbiksCiAgICAvLyAgICAgcHJvdG9jb2xfcG9ydGlvbj1hcmM0LlVJbnQyNTYocHJvdG9jb2xfcG9ydGlvbiksCiAgICAvLyApCiAgICBjb25jYXQKICAgIHN3YXAKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLndpdGhkcmF3X3Jlc2VydmVzKG1hcmtldF9pZDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6CndpdGhkcmF3X3Jlc2VydmVzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjk2LTE2OTcKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHdpdGhkcmF3X3Jlc2VydmVzKHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2OTgKICAgIC8vIHNlbGYuX29ubHlfb3duZXIoKQogICAgY2FsbHN1YiBfb25seV9vd25lcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjk5CiAgICAvLyBzZWxmLl93aXRoZHJhd19yZXNlcnZlcyhtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX3dpdGhkcmF3X3Jlc2VydmVzCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fd2l0aGRyYXdfcmVzZXJ2ZXMobWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl93aXRoZHJhd19yZXNlcnZlczoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcwMS0xNzAyCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MDMKICAgIC8vIHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2FjY3J1ZV9pbnRlcmVzdAogICAgcG9wCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MDQKICAgIC8vIHNlbGYuX3dpdGhkcmF3X3Jlc2VydmVzX3B1cmUobWFya2V0X2lkLCBhbW91bnQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfd2l0aGRyYXdfcmVzZXJ2ZXNfcHVyZQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3dpdGhkcmF3X3Jlc2VydmVzX3B1cmUobWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl93aXRoZHJhd19yZXNlcnZlc19wdXJlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzA2LTE3MDcKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3X3Jlc2VydmVzX3B1cmUoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzA4CiAgICAvLyBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgY2FsbHN1YiBfaXNfcGF1c2VkCiAgICAhCiAgICBhc3NlcnQgLy8gUHJvdG9jb2wgaXMgcGF1c2VkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MDkKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MTAKICAgIC8vIGFzc2VydCBtYXJrZXQucmVzZXJ2ZXMubmF0aXZlID49IGFtb3VudCwgIkluc3VmZmljaWVudCByZXNlcnZlcyIKICAgIGR1cAogICAgZXh0cmFjdCAyNDkgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2RpZyAtMQogICAgYj49CiAgICBhc3NlcnQgLy8gSW5zdWZmaWNpZW50IHJlc2VydmVzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MTEtMTcxNgogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzEzCiAgICAvLyBhcmM0LkFkZHJlc3Moc2VsZi5vd25lciksCiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDI4CiAgICAvLyBzZWxmLm93bmVyID0gQWNjb3VudCgpCiAgICBieXRlICJvd25lciIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcxMwogICAgLy8gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpLAogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLm93bmVyIGV4aXN0cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzE0CiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMQogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGZyYW1lX2RpZyAtMQogICAgZGlnIDEKICAgIGJ8CiAgICBmcmFtZV9kaWcgLTIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzExLTE3MTYKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICkKICAgIG1ldGhvZCAiYXJjMjAwX3RyYW5zZmVyKGFkZHJlc3MsdWludDI1Nilib29sIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIHVuY292ZXIgMgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgaXR4biBMYXN0TG9nCiAgICBleHRyYWN0IDAgNAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICA9PQogICAgYXNzZXJ0IC8vIEFSQzQgcHJlZml4IGlzIHZhbGlkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MTcKICAgIC8vIG1hcmtldC5yZXNlcnZlcyA9IGFyYzQuVUludDI1NihtYXJrZXQucmVzZXJ2ZXMubmF0aXZlIC0gYW1vdW50KQogICAgc3dhcAogICAgZnJhbWVfZGlnIC0xCiAgICBiLQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgYnwKICAgIHJlcGxhY2UyIDI0OQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzE4CiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIGZyYW1lX2RpZyAtMgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MTgKICAgIC8vIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgc3dhcAogICAgY29uY2F0CiAgICBzd2FwCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5kZXBvc2l0KG1hcmtldF9pZDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6CmRlcG9zaXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4NDMtMTg0NAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGVwb3NpdChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODQ1CiAgICAvLyBlbnN1cmVfYnVkZ2V0KDI4MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICBpbnQgMjgwMAogICAgaW50IDAKICAgIGNhbGxzdWIgZW5zdXJlX2J1ZGdldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODQ2CiAgICAvLyBzZWxmLl9kZXBvc2l0KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICB0eG4gU2VuZGVyCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ0b2kKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZGVwb3NpdAogICAgcmV0c3ViCgoKLy8gYWxnb3B5LmVuc3VyZV9idWRnZXQocmVxdWlyZWRfYnVkZ2V0OiB1aW50NjQsIGZlZV9zb3VyY2U6IHVpbnQ2NCkgLT4gdm9pZDoKZW5zdXJlX2J1ZGdldDoKICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weToxMS0xNwogICAgcHJvdG8gMiAwCiAgICAvLyA8YWxnb3B5Pi9hbGdvcHkucHk6MTgKICAgIGZyYW1lX2RpZyAtMgogICAgaW50IDEwCiAgICArCgplbnN1cmVfYnVkZ2V0X3doaWxlX3RvcEAxOgogICAgLy8gPGFsZ29weT4vYWxnb3B5LnB5OjE5CiAgICBmcmFtZV9kaWcgMAogICAgZ2xvYmFsIE9wY29kZUJ1ZGdldAogICAgPgogICAgYnogZW5zdXJlX2J1ZGdldF9hZnRlcl93aGlsZUA3CiAgICAvLyA8YWxnb3B5Pi9hbGdvcHkucHk6MjAKICAgIGl0eG5fYmVnaW4KICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weToyMQogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weToyMgogICAgaW50IERlbGV0ZUFwcGxpY2F0aW9uCiAgICBpdHhuX2ZpZWxkIE9uQ29tcGxldGlvbgogICAgLy8gPGFsZ29weT4vYWxnb3B5LnB5OjIzCiAgICBieXRlIDB4MDY4MTAxCiAgICBpdHhuX2ZpZWxkIEFwcHJvdmFsUHJvZ3JhbQogICAgLy8gPGFsZ29weT4vYWxnb3B5LnB5OjI0CiAgICBieXRlIDB4MDY4MTAxCiAgICBpdHhuX2ZpZWxkIENsZWFyU3RhdGVQcm9ncmFtCiAgICAvLyA8YWxnb3B5Pi9hbGdvcHkucHk6MjUtMjkKICAgIGZyYW1lX2RpZyAtMQogICAgc3dpdGNoIGVuc3VyZV9idWRnZXRfc3dpdGNoX2Nhc2VfMEAzIGVuc3VyZV9idWRnZXRfc3dpdGNoX2Nhc2VfMUA0CiAgICBiIGVuc3VyZV9idWRnZXRfc3dpdGNoX2Nhc2VfbmV4dEA2CgplbnN1cmVfYnVkZ2V0X3N3aXRjaF9jYXNlXzBAMzoKICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weToyNwogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBiIGVuc3VyZV9idWRnZXRfc3dpdGNoX2Nhc2VfbmV4dEA2CgplbnN1cmVfYnVkZ2V0X3N3aXRjaF9jYXNlXzFANDoKICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weToyOQogICAgZ2xvYmFsIE1pblR4bkZlZQogICAgaXR4bl9maWVsZCBGZWUKCmVuc3VyZV9idWRnZXRfc3dpdGNoX2Nhc2VfbmV4dEA2OgogICAgLy8gPGFsZ29weT4vYWxnb3B5LnB5OjMwCiAgICBpdHhuX3N1Ym1pdAogICAgYiBlbnN1cmVfYnVkZ2V0X3doaWxlX3RvcEAxCgplbnN1cmVfYnVkZ2V0X2FmdGVyX3doaWxlQDc6CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZGVwb3NpdCh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9kZXBvc2l0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODkwLTE4OTEKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlcG9zaXQoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTE4LTE5MTkKICAgIC8vICMgU3luYyB1c2VyIG1hcmtldCBmb3IgcHJpY2UgY2hhbmdlCiAgICAvLyBzZWxmLl9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTIxLTE5MjIKICAgIC8vICMgUGVyZm9ybSBwdXJlIGRlcG9zaXQgb3BlcmF0aW9uCiAgICAvLyBzZWxmLl9kZXBvc2l0X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9kZXBvc2l0X3B1cmUKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UodXNlcl9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0KSAtPiB2b2lkOgpfc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDAwLTI0MDMKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MDQKICAgIC8vIHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2FjY3J1ZV9pbnRlcmVzdAogICAgcG9wCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MDUKICAgIC8vIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MDYKICAgIC8vIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfZGVwb3NpdF9pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MDcKICAgIC8vIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9yZXNvbHZlX2FjY3VtdWxhdGVkX2JvcnJvd19pbnRlcmVzdAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQpIC0+IHZvaWQ6Cl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2U6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NjUtMjQ2OAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ3MwogICAgLy8gdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkuY29weSgpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIGR1cAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDc0CiAgICAvLyBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9PSAwIGFuZCB1c2VyLnNjYWxlZF9ib3Jyb3dzID09IDA6CiAgICBleHRyYWN0IDAgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAogICAgYj09CiAgICBieiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlX2FmdGVyX2lmX2Vsc2VAMwogICAgZnJhbWVfZGlnIDAKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAogICAgYj09CiAgICBieiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlX2FmdGVyX2lmX2Vsc2VAMwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDc1CiAgICAvLyByZXR1cm4KICAgIHJldHN1YgoKX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZV9hZnRlcl9pZl9lbHNlQDM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NzcKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NzkKICAgIC8vIHNlbGYuX3VwZGF0ZV91c2VyX21hcmtldF9jb2xsYXRlcmEodXNlcl9pZCwgdXNlciwgbWFya2V0KQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgMAogICAgdW5jb3ZlciAyCiAgICBjYWxsc3ViIF91cGRhdGVfdXNlcl9tYXJrZXRfY29sbGF0ZXJhCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0ODAKICAgIC8vIHNlbGYuX3VwZGF0ZV91c2VyX21hcmtldF9ib3Jyb3dzKHVzZXJfaWQsIHVzZXIsIG1hcmtldCkKICAgIGZyYW1lX2RpZyAtMgogICAgY292ZXIgMgogICAgY2FsbHN1YiBfdXBkYXRlX3VzZXJfbWFya2V0X2JvcnJvd3MKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ4MgogICAgLy8gdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2dldF91c2VyX2tleQogICAgY292ZXIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDgzCiAgICAvLyB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICByZXBsYWNlMiAxMzYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMwogICAgLy8gc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICBieXRlICJ1c2VycyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ4NAogICAgLy8gc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgdW5jb3ZlciAyCiAgICBjb25jYXQKICAgIHN3YXAKICAgIGJveF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl91cGRhdGVfdXNlcl9tYXJrZXRfY29sbGF0ZXJhKHVzZXJfaWQ6IGJ5dGVzLCB1c2VyOiBieXRlcywgbWFya2V0OiBieXRlcykgLT4gYnl0ZXMsIGJ5dGVzOgpfdXBkYXRlX3VzZXJfbWFya2V0X2NvbGxhdGVyYToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQxNS0yNDE4CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfdXNlcl9tYXJrZXRfY29sbGF0ZXJhKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXI6IFVzZXJEYXRhLCBtYXJrZXQ6IE1hcmtldERhdGEKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDMgMgogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQyMgogICAgLy8gaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICBmcmFtZV9kaWcgLTIKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgYnl0ZSAweAogICAgYj09CiAgICBieiBfdXBkYXRlX3VzZXJfbWFya2V0X2NvbGxhdGVyYV9hZnRlcl9pZl9lbHNlQDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQyMwogICAgLy8gcmV0dXJuCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgdW5jb3ZlciAzCiAgICB1bmNvdmVyIDMKICAgIHJldHN1YgoKX3VwZGF0ZV91c2VyX21hcmtldF9jb2xsYXRlcmFfYWZ0ZXJfaWZfZWxzZUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDI4CiAgICAvLyBpZiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlID4gMAogICAgZnJhbWVfZGlnIC0yCiAgICBleHRyYWN0IDY0IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDAKICAgIGJ5dGUgMHgKICAgIGI+CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MjctMjQyOQogICAgLy8gdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gaWYgdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZSA+IDAKICAgIC8vIGVsc2UgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICBieiBfdXBkYXRlX3VzZXJfbWFya2V0X2NvbGxhdGVyYV90ZXJuYXJ5X2ZhbHNlQDQKICAgIGZyYW1lX2RpZyAwCiAgICBiIF91cGRhdGVfdXNlcl9tYXJrZXRfY29sbGF0ZXJhX3Rlcm5hcnlfbWVyZ2VANQoKX3VwZGF0ZV91c2VyX21hcmtldF9jb2xsYXRlcmFfdGVybmFyeV9mYWxzZUA0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDI5CiAgICAvLyBlbHNlIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgZnJhbWVfZGlnIC0xCiAgICBleHRyYWN0IDE3NyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKCl91cGRhdGVfdXNlcl9tYXJrZXRfY29sbGF0ZXJhX3Rlcm5hcnlfbWVyZ2VANToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQzMgogICAgLy8gb2xkX2RlcG9zaXRfYW1vdW50ID0gKHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXJfZGVwb3NpdF9pbmRleCkgLy8gU0NBTEUKICAgIGZyYW1lX2RpZyAxCiAgICBkdXAKICAgIHVuY292ZXIgMgogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDM0CiAgICAvLyB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMQogICAgZXh0cmFjdCAxNzcgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDM1CiAgICAvLyApIC8vIFNDQUxFCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDMzLTI0MzUKICAgIC8vIG5ld19kZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICkgLy8gU0NBTEUKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MzcKICAgIC8vIHVzZXIubGFzdF9wcmljZS5uYXRpdmUsIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMgogICAgZXh0cmFjdCAxMzYgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgLTEKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MzYtMjQzOAogICAgLy8gcHJpY2VfZm9yX29sZCA9IHNlbGYuX2dldF9wcmV2aW91c19wcmljZSgKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlLCBtYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyApCiAgICBkdXAKICAgIGNvdmVyIDIKICAgIGNhbGxzdWIgX2dldF9wcmV2aW91c19wcmljZQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDM5CiAgICAvLyBvbGRfZGVwb3NpdF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgdW5jb3ZlciAzCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NDAKICAgIC8vIG5ld19kZXBvc2l0X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICBjb3ZlciAyCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NDEKICAgIC8vIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCBvbGRfZGVwb3NpdF92YWx1ZSwgbmV3X2RlcG9zaXRfdmFsdWUpCiAgICBmcmFtZV9kaWcgLTMKICAgIGNvdmVyIDIKICAgIGNhbGxzdWIgX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbAogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIHVuY292ZXIgMwogICAgdW5jb3ZlciAzCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZ2V0X3ByZXZpb3VzX3ByaWNlKHVzZXJfbGFzdF9wcmljZTogYnl0ZXMsIG1hcmtldF9wcmljZTogYnl0ZXMpIC0+IGJ5dGVzOgpfZ2V0X3ByZXZpb3VzX3ByaWNlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDA5LTI0MTIKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmV2aW91c19wcmljZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2xhc3RfcHJpY2U6IEJpZ1VJbnQsIG1hcmtldF9wcmljZTogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgcHJvdG8gMiAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MTMKICAgIC8vIHJldHVybiB1c2VyX2xhc3RfcHJpY2UgaWYgdXNlcl9sYXN0X3ByaWNlID4gMCBlbHNlIG1hcmtldF9wcmljZQogICAgZnJhbWVfZGlnIC0yCiAgICBieXRlIDB4CiAgICBiPgogICAgZnJhbWVfZGlnIC0xCiAgICBmcmFtZV9kaWcgLTIKICAgIHVuY292ZXIgMgogICAgc2VsZWN0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKHVzZXJfaWQ6IGJ5dGVzLCBvbGRfdmFsdWU6IGJ5dGVzLCBuZXdfdmFsdWU6IGJ5dGVzKSAtPiB2b2lkOgpfdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTI2LTI1MzIKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTMzCiAgICAvLyBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfZ2xvYmFsX3VzZXIKICAgIGR1cAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTM0CiAgICAvLyBpZiBvbGRfdmFsdWUgPiBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZToKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgY292ZXIgMgogICAgZnJhbWVfZGlnIC0yCiAgICBiPAogICAgYnogX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbF9lbHNlX2JvZHlAMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTM1CiAgICAvLyBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlID0gYXJjNC5VSW50MjU2KG5ld192YWx1ZSkKICAgIGZyYW1lX2RpZyAtMQogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGZyYW1lX2RpZyAtMQogICAgYnwKICAgIHJlcGxhY2UyIDAKICAgIGIgX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbF9hZnRlcl9pZl9lbHNlQDMKCl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWxfZWxzZV9ib2R5QDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MzgKICAgIC8vIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gb2xkX3ZhbHVlICsgbmV3X3ZhbHVlCiAgICBmcmFtZV9kaWcgMAogICAgZnJhbWVfZGlnIC0yCiAgICBiLQogICAgZnJhbWVfZGlnIC0xCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTM3LTI1MzkKICAgIC8vIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXBsYWNlMiAwCgpfdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsX2FmdGVyX2lmX2Vsc2VAMzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU0MAogICAgLy8gZ2xvYmFsX3VzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgaXRvYgogICAgcmVwbGFjZTIgNjQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzNAogICAgLy8gc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICBieXRlICJnbG9iYWxfdXNlcnMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NDEKICAgIC8vIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICBmcmFtZV9kaWcgLTMKICAgIGNvbmNhdAogICAgZGlnIDEKICAgIGJveF9wdXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU0MwogICAgLy8gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUsCiAgICBkdXAKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU0NAogICAgLy8gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSwKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NDItMjU0NgogICAgLy8gaGVhbHRoID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaGVhbHRoKAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlLAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUsCiAgICAvLyAgICAgVUludDY0KDgwMDApLCAgIyA4MCUgbGlxdWlkYXRpb24gdGhyZXNob2xkCiAgICAvLyApCiAgICBkdXAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NDUKICAgIC8vIFVJbnQ2NCg4MDAwKSwgICMgODAlIGxpcXVpZGF0aW9uIHRocmVzaG9sZAogICAgaW50IDgwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU0Mi0yNTQ2CiAgICAvLyBoZWFsdGggPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9oZWFsdGgoCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUsCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSwKICAgIC8vICAgICBVSW50NjQoODAwMCksICAjIDgwJSBsaXF1aWRhdGlvbiB0aHJlc2hvbGQKICAgIC8vICkKICAgIGNhbGxzdWIgX2NhbGN1bGF0ZV91c2VyX2hlYWx0aAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTUwCiAgICAvLyBoZWFsdGhfZmFjdG9yPWFyYzQuVUludDI1NihoZWFsdGgpLAogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgZHVwCiAgICBjb3ZlciAyCiAgICBifAogICAgY292ZXIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTUxLTI1NTMKICAgIC8vIHRvdGFsX2NvbGxhdGVyYWxfdmFsdWU9YXJjNC5VSW50MjU2KAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlCiAgICAvLyApLAogICAgZGlnIDMKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICB1bmNvdmVyIDMKICAgIGRpZyAxCiAgICBifAogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTU0CiAgICAvLyB0b3RhbF9ib3Jyb3dfdmFsdWU9YXJjNC5VSW50MjU2KGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUpLAogICAgZGlnIDIKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICB1bmNvdmVyIDIKICAgIGJ8CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NDgtMjU1NQogICAgLy8gVXNlckhlYWx0aCgKICAgIC8vICAgICB1c2VyX2lkPWFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBoZWFsdGhfZmFjdG9yPWFyYzQuVUludDI1NihoZWFsdGgpLAogICAgLy8gICAgIHRvdGFsX2NvbGxhdGVyYWxfdmFsdWU9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZQogICAgLy8gICAgICksCiAgICAvLyAgICAgdG90YWxfYm9ycm93X3ZhbHVlPWFyYzQuVUludDI1NihnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlKSwKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMwogICAgdW5jb3ZlciAzCiAgICBjb25jYXQKICAgIHVuY292ZXIgMgogICAgY29uY2F0CiAgICBzd2FwCiAgICBjb25jYXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU0Ny0yNTU2CiAgICAvLyBhcmM0LmVtaXQoCiAgICAvLyAgICAgVXNlckhlYWx0aCgKICAgIC8vICAgICAgICAgdXNlcl9pZD1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgIGhlYWx0aF9mYWN0b3I9YXJjNC5VSW50MjU2KGhlYWx0aCksCiAgICAvLyAgICAgICAgIHRvdGFsX2NvbGxhdGVyYWxfdmFsdWU9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICAgICAgdG90YWxfYm9ycm93X3ZhbHVlPWFyYzQuVUludDI1NihnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlKSwKICAgIC8vICAgICApCiAgICAvLyApCiAgICBtZXRob2QgIlVzZXJIZWFsdGgoYWRkcmVzcyx1aW50MjU2LHVpbnQyNTYsdWludDI1NikiCiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkOiBieXRlcykgLT4gYnl0ZXM6Cl9nZXRfZ2xvYmFsX3VzZXI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0OTAtMjQ5MQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IEdsb2JhbFVzZXJEYXRhOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzQKICAgIC8vIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgYnl0ZSAiZ2xvYmFsX3VzZXJzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDM0LTI0OTIKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICAjIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIC8vICAgICAgICAgbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgU2NhbGUgdGhlIHByaWNlIGJ5IFNDQUxFIGludGVybmFsbHkgZm9yIHN0b3JhZ2UKICAgIC8vICAgICBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRQcmljZVNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihwcmljZSkpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBmZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9mZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAxMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHBheW1lbnQgPD0gMTAwMDAwMAogICAgLy8gICAgICksICJwYXltZW50IGV4Y2VlZHMgbWF4aW11bSBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNgogICAgLy8gICAgIGFwcCA9IEFwcGxpY2F0aW9uKHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAgICAgaXR4bi5QYXltZW50KHJlY2VpdmVyPWFwcC5hZGRyZXNzLCBhbW91bnQ9cGF5bWVudCwgZmVlPTApLnN1Ym1pdCgpCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFByaWNlRmVlZFByb3ZpZGVySW50ZXJmYWNlLmdldF9wcmljZV93aXRoX3RpbWVzdGFtcCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICAgICAgPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgKToKICAgIC8vICAgICAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICAvLyAgICAgICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC5jb3B5KCkKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLCBwcmljZV93aXRoX3RpbWVzdGFtcC5wcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3BhdXNlX21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIHBhdXNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdLnBhdXNlZCA9IGFyYzQuQm9vbChwYXVzZSA9PSBVSW50NjQoMSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfbWFya2V0KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91dGlsaXphdGlvbihzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIG1hcmtldF9pZDogVUludDY0KSAtPiBCaWdVSW50OgogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBCaWdVSW50KDEwMDAwKSAgIyAxMDAlIHV0aWxpemF0aW9uIGZvciBib3Jyb3ctb25seSBtYXJrZXQKICAgIC8vICAgICBlbGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBCaWdVSW50KDApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgIyBBZGRpdGlvbmFsIHNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8KICAgIC8vICAgICAgICAgdG90YWxfZGVwb3NpdHMgPSBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB0b3RhbF9kZXBvc2l0cyA9PSAwOgogICAgLy8gICAgICAgICAgICAgcmV0dXJuIEJpZ1VJbnQoMCkKICAgIC8vICAgICAgICAgcmV0dXJuIChtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDApIC8vIHRvdGFsX2RlcG9zaXRzCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV9pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIHV0aWxpemF0aW9uOiBCaWdVSW50LCB0aW1lX2RlbHRhOiBVSW50NjQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBCaWdVSW50KDApCiAgICAvLyAgICAgcmF0ZSA9IG1hcmtldC5ib3Jyb3dfcmF0ZS5uYXRpdmUgKyAobWFya2V0LnNsb3BlLm5hdGl2ZSAqIHV0aWxpemF0aW9uKSAvLyAxMDAwMAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGludGVyZXN0IGJhc2VkIG9uIFNDQUxFRCBib3Jyb3dzLCBub3QgdW5kZXJseWluZwogICAgLy8gICAgICMgVGhpcyBwcmV2ZW50cyBkb3VibGUgY29tcG91bmRpbmcgYW5kIG1haW50YWlucyBjb25zaXN0ZW5jeSB3aXRoIHRoZSBhY2NvdW50aW5nIHN5c3RlbQogICAgLy8gICAgIHJldHVybiAocmF0ZSAqIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB0aW1lX2RlbHRhKSAvLyAoCiAgICAvLyAgICAgICAgIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfaW50ZXJlc3Rfc3BsaXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBtYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBzdG9rZW5fYXBwX2lkOiBVSW50NjQsCiAgICAvLyAgICAgaW50ZXJlc3Q6IEJpZ1VJbnQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IFVJbnQ2NCwKICAgIC8vICkgLT4gSW50ZXJlc3RTcGxpdDoKICAgIC8vICAgICAjIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHN0b2tlbiBtYXJrZXQgLSBhbGwgaW50ZXJlc3QgZ29lcyB0byByZXNlcnZlcwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IGludGVyZXN0CiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IChpbnRlcmVzdCAqIHJlc2VydmVfZmFjdG9yKSAvLyAxMDAwMAogICAgLy8gICAgICAgICBpZiBwcm90b2NvbF9wb3J0aW9uID4gaW50ZXJlc3Q6CiAgICAvLyAgICAgICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gaW50ZXJlc3QKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBpbnRlcmVzdCAtIHByb3RvY29sX3BvcnRpb24KICAgIC8vICAgICByZXR1cm4gSW50ZXJlc3RTcGxpdCgKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb249YXJjNC5VSW50MjU2KGRlcG9zaXRvcl9wb3J0aW9uKSwKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbj1hcmM0LlVJbnQyNTYocHJvdG9jb2xfcG9ydGlvbiksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hY2NydWVfaW50ZXJlc3Qoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgQWNjcnVlIGludGVyZXN0IGZvciBhIG1hcmtldCBiYXNlZCBvbiB0aW1lIGVsYXBzZWQgYW5kIHV0aWxpemF0aW9uLgogICAgLy8gICAgICIiIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGN1cnJlbnRfdGltZSA9IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wCiAgICAvLyAgICAgdGltZV9kZWx0YSA9IGN1cnJlbnRfdGltZSAtIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lLm5hdGl2ZQogICAgLy8gICAgIGlmIHRpbWVfZGVsdGEgPD0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgdXRpbGl6YXRpb24gPSBzZWxmLl9jYWxjdWxhdGVfdXRpbGl6YXRpb24obWFya2V0LCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXRpbGl6YXRpb24gPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfaW50ZXJlc3QobWFya2V0LCB1dGlsaXphdGlvbiwgdGltZV9kZWx0YSkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgSW50ZXJlc3QgZGlzdHJpYnV0aW9uCiAgICAvLyAgICAgaW50ZXJlc3Rfc3BsaXQgPSBzZWxmLl9jYWxjdWxhdGVfaW50ZXJlc3Rfc3BsaXQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgc2VsZi5zdG9rZW5fYXBwX2lkLCBpbnRlcmVzdCwgbWFya2V0LnJlc2VydmVfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgaWYgdXNlciBpbmRleGVzIGNhbiBncm93IG1lYW5pbmdmdWxseQogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8gZm9yIGZpcnN0IGRlcG9zaXRzL2JvcnJvd3MKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICBkZXBvc2l0b3JfaW5jcmVtZW50ID0gQmlnVUludCgwKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9pbmNyZW1lbnQgPSAoaW50ZXJlc3Rfc3BsaXQuZGVwb3NpdG9yX3BvcnRpb24ubmF0aXZlICogU0NBTEUpIC8vICgKICAgIC8vICAgICAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgYm9ycm93ZXJfaW5jcmVtZW50ID0gQmlnVUludCgwKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJvcnJvd2VyX2luY3JlbWVudCA9IChpbnRlcmVzdCAqIFNDQUxFKSAvLyAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIGlmIGRlcG9zaXRvcl9pbmNyZW1lbnQgPT0gMCBvciBib3Jyb3dlcl9pbmNyZW1lbnQgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgIyBtYXJrZXQgZGVwb3NpdCBpbmRleCB1cGRhdGUgZGVwZW5kcyBvbiBkZXBvc2l0b3IgcG9ydGlvbiBvZiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICsgZGVwb3NpdG9yX2luY3JlbWVudAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIG1hcmtldCBib3Jyb3cgaW5kZXggdXBkYXRlIGRlcGVuZHMgb24gZnVsbCBpbnRlcmVzdCBhbW91bnQKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPiAwOgogICAgLy8gICAgICAgICBtYXJrZXQuYm9ycm93X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgKyBib3Jyb3dlcl9pbmNyZW1lbnQKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBtYXJrZXQgdG90YWwgc2NhbGVkIGJvcnJvd3MgdXBkYXRlIGRlcGVuZHMgb24gZnVsbCBpbnRlcmVzdCBhbW91bnQKICAgIC8vICAgICAjIENvbnZlcnQgaW50ZXJlc3QgdG8gc2NhbGVkIGJvcnJvd3MgdXNpbmcgY3VycmVudCBtYXJrZXQgaW5kZXgKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogZW5zdXJlIGJvcnJvd19pbmRleCBpcyBuZXZlciAwCiAgICAvLyAgICAgYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICBpZiBib3Jyb3dfaW5kZXggPT0gMDoKICAgIC8vICAgICAgICAgYm9ycm93X2luZGV4ID0gQmlnVUludChTQ0FMRSkKICAgIC8vICAgICBpbnRlcmVzdF9zY2FsZWRfYm9ycm93cyA9IChpbnRlcmVzdCAqIFNDQUxFKSAvLyBib3Jyb3dfaW5kZXgKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBpbnRlcmVzdF9zY2FsZWRfYm9ycm93cwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgbWFya2V0IHRvdGFsIHNjYWxlZCBkZXBvc2l0cyB1cGRhdGUgZGVwZW5kcyBvbiBkZXBvc2l0b3IgcG9ydGlvbiBvZiBpbnRlcmVzdAogICAgLy8gICAgICMgQ29udmVydCBkZXBvc2l0b3IgcG9ydGlvbiB0byBzY2FsZWQgZGVwb3NpdHMgdXNpbmcgY3VycmVudCBtYXJrZXQgaW5kZXgKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogZW5zdXJlIGRlcG9zaXRfaW5kZXggaXMgbmV2ZXIgMAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICBpZiBkZXBvc2l0X2luZGV4ID09IDA6CiAgICAvLyAgICAgICAgIGRlcG9zaXRfaW5kZXggPSBCaWdVSW50KFNDQUxFKQogICAgLy8gICAgIGRlcG9zaXRvcl9zY2FsZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICBpbnRlcmVzdF9zcGxpdC5kZXBvc2l0b3JfcG9ydGlvbi5uYXRpdmUgKiBTQ0FMRQogICAgLy8gICAgICkgLy8gZGVwb3NpdF9pbmRleAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgZGVwb3NpdG9yX3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIG1hcmtldCByZXNlcnZlcyB1cGRhdGUgZGVwZW5kcyBvbiBwcm90b2NvbCBwb3J0aW9uIG9mIGludGVyZXN0CiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQucmVzZXJ2ZXMubmF0aXZlICsgaW50ZXJlc3Rfc3BsaXQucHJvdG9jb2xfcG9ydGlvbi5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KGN1cnJlbnRfdGltZSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gIyBUT0RPIGdvdmVybmFuY2U6IGNvbnNpZGVyIGlmIHJlc2VydmUgd2l0aGRyYXdhbCBzaG91bGQgcmVxdWlyZSBhZGRpdGlvbmFsCiAgICAvLyAjICAgICAgZ292ZXJuYW5jZSBtZWNoYW5pc21zCiAgICAvLyAjIFRPRE8gbWluaW11bSByZXNlcnZlIGxldmVsczogbWlnaHQgd2FudCB0byBlbmZvcmNlIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHMgZm9yCiAgICAvLyAjICAgICAgcHJvdG9jb2wgc2FmZXR5CiAgICAvLyAjIFRPRE8gZXZlbnQgZW1pc3Npb246IENvbnNpZGVyIGFkZGluZyBhbiBldmVudCB0byBsb2cgcmVzZXJ2ZSB3aXRoZHJhd2FscyBmb3IKICAgIC8vICMgICAgICB0cmFuc3BhcmVuY3kKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fd2l0aGRyYXdfcmVzZXJ2ZXMobWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX3dpdGhkcmF3X3Jlc2VydmVzX3B1cmUobWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3X3Jlc2VydmVzX3B1cmUoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBtYXJrZXQucmVzZXJ2ZXMubmF0aXZlID49IGFtb3VudCwgIkluc3VmZmljaWVudCByZXNlcnZlcyIKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbigKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50LCBndWFyZF9zdG9rZW46IGJvb2wKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCBhbW91bnQgPiAwLCAiQW1vdW50IG11c3QgYmUgPiAwIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBub3QgbWFya2V0LnBhdXNlZCwgIk1hcmtldCBpcyBwYXVzZWQiCiAgICAvLyAgICAgaWYgZ3VhcmRfc3Rva2VuOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgLy8gICAgICAgICApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGZvciB0aGlzIG9wZXJhdGlvbiIKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUmVzb2x2ZSAoY2xhaW0vY29tcG91bmQpIGFjY3VtdWxhdGVkIGludGVyZXN0IGZvciBhIHVzZXIncyBkZXBvc2l0IHBvc2l0aW9uLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBmdW5jdGlvbiBoYW5kbGVzIHRoZSBpbnRlcmVzdCB0aGF0IGhhcyBhY2NydWVkIHNpbmNlIHRoZSB1c2VyJ3MgbGFzdAogICAgLy8gICAgIGludGVyYWN0aW9uIGJ5IGNvbnZlcnRpbmcgaXQgdG8gYWRkaXRpb25hbCBzY2FsZWQgZGVwb3NpdHMuIFRoaXMgbWFrZXMKICAgIC8vICAgICBzdWJzZXF1ZW50IG9wZXJhdGlvbnMgcHVyZWx5IGFkZGl0aXZlIHNpbmNlIHRoZSBpbnRlcmVzdCBoYXMgYWxyZWFkeSBiZWVuCiAgICAvLyAgICAgInBhaWQgb3V0Ii4KICAgIC8vIAogICAgLy8gICAgIE5vdGU6IFRoaXMgZnVuY3Rpb24gYXNzdW1lcyB0aGF0IGludGVyZXN0IGhhcyBhbHJlYWR5IGJlZW4gYWNjcnVlZCBieSB0aGUKICAgIC8vICAgICBjYWxsZXIgKGUuZy4sIHZpYSBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKSB0byBhdm9pZAogICAgLy8gICAgIGRvdWJsZSBpbnRlcmVzdCBhY2NydWFsLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCAoVUludDY0KTogVGhlIElEIG9mIHRoZSBtYXJrZXQKICAgIC8vICAgICAiIiIKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0X3dpdGhfZGF0YSh1c2VyLCBtYXJrZXQpCiAgICAvLyAgICAgaWYgaW50ZXJlc3QgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuCiAgICAvLyAgICAgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCA9IHNlbGYuX2dldF9tYXJrZXRfc2NhbGVkX2RlcG9zaXQobWFya2V0LCBpbnRlcmVzdCkKICAgIC8vICAgICBpbnRlcmVzdF92YWx1ZSA9IHNlbGYuX2dldF9tYXJrZXRfdmFsdWUobWFya2V0LCBpbnRlcmVzdCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgdXNlcl9pZCwgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwodXNlcl9pZCwgQmlnVUludCgwKSwgaW50ZXJlc3RfdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUmVzb2x2ZSAoY2xhaW0vY29tcG91bmQpIGFjY3VtdWxhdGVkIGludGVyZXN0IGZvciBhIHVzZXIncyBib3Jyb3cgcG9zaXRpb24uCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhKHVzZXIsIG1hcmtldCkKICAgIC8vICAgICBpZiBpbnRlcmVzdCA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vICAgICBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gc2VsZi5fZ2V0X21hcmtldF9zY2FsZWRfYm9ycm93KG1hcmtldCwgaW50ZXJlc3QpCiAgICAvLyAgICAgaW50ZXJlc3RfdmFsdWUgPSBzZWxmLl9nZXRfbWFya2V0X3ZhbHVlKG1hcmtldCwgaW50ZXJlc3QpCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIHVzZXJfaWQsIGludGVyZXN0X3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKHVzZXJfaWQsIEJpZ1VJbnQoMCksIGludGVyZXN0X3ZhbHVlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdHMoc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdF9hbW91bnQoCiAgICAvLyAgICAgICAgIG1hcmtldCwgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzKHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSkgLT4gQmlnVUludDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd19hbW91bnQoCiAgICAvLyAgICAgICAgIG1hcmtldCwgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRfYW1vdW50KAogICAgLy8gICAgIHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dfYW1vdW50KAogICAgLy8gICAgIHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF9zY2FsZWRfZGVwb3NpdCgKICAgIC8vICAgICBzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBlbnN1cmUgZGVwb3NpdF9pbmRleCBpcyBuZXZlciAwIHRvIHByZXZlbnQgZGl2aXNpb24gYnkgemVybwogICAgLy8gICAgICMgSWYgZGVwb3NpdF9pbmRleCBpcyAwLCBpbml0aWFsaXplIGl0IHRvIFNDQUxFICgxLjApCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgIGlmIGRlcG9zaXRfaW5kZXggPT0gMDoKICAgIC8vICAgICAgICAgZGVwb3NpdF9pbmRleCA9IEJpZ1VJbnQoU0NBTEUpCiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBTQ0FMRSkgLy8gZGVwb3NpdF9pbmRleAogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3coc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhLCBhbW91bnQ6IEJpZ1VJbnQpIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGVuc3VyZSBib3Jyb3dfaW5kZXggaXMgbmV2ZXIgMCB0byBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8KICAgIC8vICAgICAjIElmIGJvcnJvd19pbmRleCBpcyAwLCBpbml0aWFsaXplIGl0IHRvIFNDQUxFICgxLjApCiAgICAvLyAgICAgYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICBpZiBib3Jyb3dfaW5kZXggPT0gMDoKICAgIC8vICAgICAgICAgYm9ycm93X2luZGV4ID0gQmlnVUludChTQ0FMRSkKICAgIC8vICAgICByZXR1cm4gKGFtb3VudCAqIFNDQUxFKSAvLyBib3Jyb3dfaW5kZXgKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF92YWx1ZShzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIGFtb3VudDogQmlnVUludCkgLT4gQmlnVUludDoKICAgIC8vICAgICByZXR1cm4gKGFtb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRlcG9zaXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyODAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX2RlcG9zaXQoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVwb3NpdF9wdXJlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBQdXJlIGRlcG9zaXQgb3BlcmF0aW9uIHRoYXQgYWRkcyBuZXcgZnVuZHMgd2l0aG91dCBoYW5kbGluZyBpbnRlcmVzdC4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgZnVuY3Rpb24gYXNzdW1lcyB0aGF0IGFueSBhY2N1bXVsYXRlZCBpbnRlcmVzdCBoYXMgYWxyZWFkeSBiZWVuIHJlc29sdmVkCiAgICAvLyAgICAgYnkgY2FsbGluZyBfcmVzb2x2ZV9hY2N1bXVsYXRlZF9pbnRlcmVzdCgpIGJlZm9yZWhhbmQuIEl0IHBlcmZvcm1zIG9ubHkgdGhlCiAgICAvLyAgICAgZGVwb3NpdCBvcGVyYXRpb24sIG1ha2luZyBpdCBwdXJlbHkgYWRkaXRpdmUuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkIChBY2NvdW50KTogVGhlIGFjY291bnQgSUQgb2YgdGhlIHVzZXIgbWFraW5nIHRoZSBkZXBvc2l0CiAgICAvLyAgICAgICAgIG1hcmtldF9pZCAoVUludDY0KTogVGhlIElEIG9mIHRoZSBtYXJrZXQgdG8gZGVwb3NpdCBpbnRvCiAgICAvLyAgICAgICAgIGFtb3VudCAoQmlnVUludCk6IFRoZSBhbW91bnQgb2YgdW5kZXJseWluZyB0b2tlbnMgdG8gZGVwb3NpdAogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgZGVwb3NpdCBvcGVyYXRpb24KICAgIC8vICAgICAjIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAjICAgICBtYXJrZXRfaWQKICAgIC8vICAgICAjICkuZGVwb3NpdC5uYXRpdmUKICAgIC8vICAgICAjIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICMgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiRGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdHMgPSBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdHMobWFya2V0KQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC5tYXhfdG90YWxfZGVwb3NpdHMubmF0aXZlID49IG1hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRzICsgYW1vdW50CiAgICAvLyAgICAgKSwgIk1hcmtldCBkZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gc2VsZi5fZ2V0X21hcmtldF9zY2FsZWRfZGVwb3NpdChtYXJrZXQsIGFtb3VudCkKICAgIC8vICAgICBkZXBvc2l0X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGFtb3VudCkKICAgIC8vICAgICBzZWxmLl9jb2xsYXRlcmFsX2RlcG9zaXRfcHVyZSgKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgYW1vdW50LAogICAgLy8gICAgICAgICBzY2FsZWRfYW1vdW50LAogICAgLy8gICAgICAgICBkZXBvc2l0X3ZhbHVlLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVwb3NpdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIEludGVybmFsIGRlcG9zaXQgbWV0aG9kIHRoYXQgaGFuZGxlcyB1c2VyIGRlcG9zaXRzIGludG8gYSBsZW5kaW5nIG1hcmtldC4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIHBlcmZvcm1zIGEgY29tcGxldGUgZGVwb3NpdCBvcGVyYXRpb24gd2l0aCBzZXBhcmF0ZWQgY29uY2VybnM6CiAgICAvLyAgICAgMS4gU3luY3MgdXNlciBtYXJrZXQgZm9yIHByaWNlIGNoYW5nZXMgKGFjY3J1ZXMgaW50ZXJlc3QsIHVwZGF0ZXMgZ2xvYmFsIHZhbHVlcywgcmVzb2x2ZXMgaW50ZXJlc3QpCiAgICAvLyAgICAgMi4gUGVyZm9ybXMgcHVyZSBkZXBvc2l0IG9wZXJhdGlvbiAoYWRkcyBuZXcgZnVuZHMgd2l0aG91dCBpbnRlcmVzdCBoYW5kbGluZykKICAgIC8vIAogICAgLy8gICAgIFRoZSBzZXBhcmF0aW9uIGVuc3VyZXM6CiAgICAvLyAgICAgLSBTaW5nbGUgaW50ZXJlc3QgYWNjcnVhbCBwZXIgb3BlcmF0aW9uCiAgICAvLyAgICAgLSBDbGVhbiBzZXBhcmF0aW9uIGJldHdlZW4gaW50ZXJlc3QgcmVzb2x1dGlvbiBhbmQgbmV3IGRlcG9zaXRzCiAgICAvLyAgICAgLSBDb25zaXN0ZW50IHByaWNlIHN5bmNocm9uaXphdGlvbgogICAgLy8gICAgIC0gUHVyZSBhZGRpdGl2ZSBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIG1ha2luZyB0aGUgZGVwb3NpdAogICAgLy8gICAgICAgICBtYXJrZXRfaWQgKFVJbnQ2NCk6IFRoZSBJRCBvZiB0aGUgbWFya2V0IHRvIGRlcG9zaXQgaW50bwogICAgLy8gICAgICAgICBhbW91bnQgKEJpZ1VJbnQpOiBUaGUgYW1vdW50IG9mIHVuZGVybHlpbmcgdG9rZW5zIHRvIGRlcG9zaXQKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIG1hcmtldCB2YWxpZGF0aW9uIGZhaWxzLCBkZXBvc2l0IGNhcCBpcyBleGNlZWRlZCwgb3Igb3RoZXIgY29uc3RyYWludHMgYXJlIHZpb2xhdGVkCiAgICAvLyAKICAgIC8vICAgICBOb3RlOgogICAgLy8gICAgICAgICAtIEFsbCBwcmljZSBjaGFuZ2VzIGFuZCBpbnRlcmVzdCByZXNvbHV0aW9uIGFyZSBoYW5kbGVkIGluIHRoZSBzeW5jIHN0ZXAKICAgIC8vICAgICAgICAgLSBUaGUgZGVwb3NpdCBvcGVyYXRpb24gaXMgcHVyZWx5IGFkZGl0aXZlLCBhZGRpbmcgb25seSB0aGUgbmV3IGFtb3VudAogICAgLy8gICAgICAgICAtIFVzZXIncyBnbG9iYWwgY29sbGF0ZXJhbC9ib3Jyb3cgdmFsdWVzIGFyZSB1cGRhdGVkIHdpdGggY3VycmVudCBwcmljZXMgZHVyaW5nIHN5bmMKICAgIC8vICAgICAiIiIKICAgIC8vICAgICAjIFN5bmMgdXNlciBtYXJrZXQgZm9yIHByaWNlIGNoYW5nZQogICAgLy8gICAgIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIFBlcmZvcm0gcHVyZSBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gICAgIHNlbGYuX2RlcG9zaXRfcHVyZSh1c2VyX2lkLCBtYXJrZXRfaWQsIGFtb3VudCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDcwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBpbnRlcmVzdCIiIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGEodXNlciwgbWFya2V0KQogICAgLy8gICAgIHJldHVybiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGEoCiAgICAvLyAgICAgc2VsZiwgdXNlcjogVXNlckRhdGEsIG1hcmtldDogTWFya2V0RGF0YQogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBpbnRlcmVzdCB1c2luZyBwcmUtZmV0Y2hlZCBkYXRhIiIiCiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIgaGFzIG5vIGRlcG9zaXRzLCByZXR1cm4gMCBpbnRlcmVzdAogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gQmlnVUludCgwKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgY3VycmVudCB1bmRlcmx5aW5nIHZhbHVlCiAgICAvLyAgICAgY3VycmVudF91bmRlcmx5aW5nID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB1bmRlcmx5aW5nIHZhbHVlIGF0IHVzZXIncyBsYXN0IHVwZGF0ZQogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBpZiB1c2VyJ3MgZGVwb3NpdF9pbmRleCBpcyAwIChuZXcgdXNlciksIHVzZSBjdXJyZW50IG1hcmtldCBpbmRleAogICAgLy8gICAgIHVzZXJfZGVwb3NpdF9pbmRleCA9ICgKICAgIC8vICAgICAgICAgdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBsYXN0X3VuZGVybHlpbmcgPSAodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogdXNlcl9kZXBvc2l0X2luZGV4KSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBJbnRlcmVzdCBpcyB0aGUgZGlmZmVyZW5jZQogICAgLy8gICAgIGlmIGN1cnJlbnRfdW5kZXJseWluZyA+IGxhc3RfdW5kZXJseWluZzoKICAgIC8vICAgICAgICAgaW50ZXJlc3QgPSBjdXJyZW50X3VuZGVybHlpbmcgLSBsYXN0X3VuZGVybHlpbmcKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBpbnRlcmVzdCA9IEJpZ1VJbnQoMCkKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgZGVidCBpbnRlcmVzdCIiIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0X3dpdGhfZGF0YSh1c2VyLCBtYXJrZXQpCiAgICAvLyAgICAgcmV0dXJuIGludGVyZXN0CiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhKAogICAgLy8gICAgIHNlbGYsIHVzZXI6IFVzZXJEYXRhLCBtYXJrZXQ6IE1hcmtldERhdGEKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgZGVidCBpbnRlcmVzdCB1c2luZyBwcmUtZmV0Y2hlZCBkYXRhIiIiCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgdW5kZXJseWluZyBkZWJ0IGFtb3VudAogICAgLy8gICAgIHVzZXJfdG90YWxfZGVidCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIG9yaWdpbmFsIHByaW5jaXBhbCBhbW91bnQgdXNpbmcgdXNlcidzIGJvcnJvd19pbmRleAogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBpZiB1c2VyJ3MgYm9ycm93X2luZGV4IGlzIDAsIHVzZSBjdXJyZW50IG1hcmtldCBib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyX2JvcnJvd19pbmRleCA9ICgKICAgIC8vICAgICAgICAgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBvcmlnaW5hbF9wcmluY2lwYWwgPSAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyX2JvcnJvd19pbmRleCkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRvdGFsIGRlYnQgYW5kIG9yaWdpbmFsIHByaW5jaXBhbAogICAgLy8gICAgICMgUHJldmVudCBuZWdhdGl2ZSBpbnRlcmVzdCAodW5kZXJmbG93IHByb3RlY3Rpb24pCiAgICAvLyAgICAgaWYgdXNlcl90b3RhbF9kZWJ0ID49IG9yaWdpbmFsX3ByaW5jaXBhbDoKICAgIC8vICAgICAgICAgZGVidF9pbnRlcmVzdCA9IHVzZXJfdG90YWxfZGVidCAtIG9yaWdpbmFsX3ByaW5jaXBhbAogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlYnRfaW50ZXJlc3QgPSBCaWdVSW50KDApCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gZGVidF9pbnRlcmVzdAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhdyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50MjU2KHNlbGYuX3dpdGhkcmF3KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jb2xsYXRlcmFsX2RlcG9zaXRfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbnRva2VuX2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhiZW5lZmljaWFyeV9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihzY2FsZWRfYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG50b2tlbl9pZCksCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgYmVuZWZpY2lhcnlfaWQsIHNjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9nbG9iYWxfY29sbGF0ZXJhbChiZW5lZmljaWFyeV9pZCwgdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NvbGxhdGVyYWxfd2l0aGRyYXdfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbnRva2VuX2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUHVyZSBjb2xsYXRlcmFsIHdpdGhkcmF3YWwgb3BlcmF0aW9uIHRoYXQgYnVybnMgblRva2VucyBhbmQgdHJhbnNmZXJzIHVuZGVybHlpbmcgdG9rZW5zLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgcGVyZm9ybXMgdGhlIGNvcmUgY29sbGF0ZXJhbCB3aXRoZHJhd2FsIGxvZ2ljIHdpdGhvdXQgaGFuZGxpbmcgaW50ZXJlc3QKICAgIC8vICAgICBjYWxjdWxhdGlvbnMgb3IgdmFsaWRhdGlvbnMuIEl0IGFzc3VtZXMgdGhhdCBhbGwgbmVjZXNzYXJ5IHZhbGlkYXRpb25zIGFuZCBpbnRlcmVzdAogICAgLy8gICAgIGFjY3J1YWxzIGhhdmUgYmVlbiBoYW5kbGVkIGJ5IHRoZSBjYWxsaW5nIG1ldGhvZCBiZWZvcmVoYW5kLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIHdpdGhkcmF3aW5nIGNvbGxhdGVyYWwKICAgIC8vICAgICAgICAgYmVuZWZpY2lhcnlfaWQgKEFjY291bnQpOiBUaGUgYWNjb3VudCBJRCB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgd2l0aGRyYXduIHRva2VucwogICAgLy8gICAgICAgICBtYXJrZXRfaWQgKFVJbnQ2NCk6IFRoZSBJRCBvZiB0aGUgbWFya2V0IGZyb20gd2hpY2ggY29sbGF0ZXJhbCBpcyBiZWluZyB3aXRoZHJhd24KICAgIC8vICAgICAgICAgbnRva2VuX2lkIChVSW50NjQpOiBUaGUgSUQgb2YgdGhlIG5Ub2tlbiBhcHBsaWNhdGlvbiB0byBidXJuIHRva2VucyBmcm9tCiAgICAvLyAgICAgICAgIGFtb3VudCAoQmlnVUludCk6IFRoZSBhY3R1YWwgYW1vdW50IG9mIHVuZGVybHlpbmcgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAvLyAgICAgICAgIHNjYWxlZF9hbW91bnQgKEJpZ1VJbnQpOiBUaGUgc2NhbGVkIGFtb3VudCBvZiBuVG9rZW5zIHRvIGJ1cm4KICAgIC8vICAgICAgICAgdmFsdWUgKEJpZ1VJbnQpOiBUaGUgVVNEIHZhbHVlIG9mIHRoZSBjb2xsYXRlcmFsIGJlaW5nIHdpdGhkcmF3bgogICAgLy8gCiAgICAvLyAgICAgUHJvY2VzczoKICAgIC8vICAgICAgICAgMS4gQnVybnMgdGhlIHNwZWNpZmllZCBzY2FsZWQgYW1vdW50IG9mIG5Ub2tlbnMgZnJvbSB0aGUgdXNlcgogICAgLy8gICAgICAgICAyLiBEZWNyZW1lbnRzIHRoZSB1c2VyJ3Mgc2NhbGVkIGRlcG9zaXQgYmFsYW5jZSBmb3IgdGhlIG1hcmtldAogICAgLy8gICAgICAgICAzLiBEZWNyZW1lbnRzIHRoZSB0b3RhbCBzY2FsZWQgZGVwb3NpdHMgZm9yIHRoZSBtYXJrZXQKICAgIC8vICAgICAgICAgNC4gVHJhbnNmZXJzIHRoZSB1bmRlcmx5aW5nIHRva2VucyB0byB0aGUgYmVuZWZpY2lhcnkKICAgIC8vICAgICAgICAgNS4gRGVjcmVtZW50cyB0aGUgdXNlcidzIGdsb2JhbCBjb2xsYXRlcmFsIHZhbHVlIHRyYWNraW5nCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoc2NhbGVkX2Ftb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihudG9rZW5faWQpLAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3MoYmVuZWZpY2lhcnlfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCB2YWx1ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcHVyZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUHVyZSB3aXRoZHJhdyBvcGVyYXRpb24gdGhhdCBidXJucyBuVG9rZW5zIGFuZCB0cmFuc2ZlcnMgdW5kZXJseWluZyB0b2tlbnMgdG8gdXNlci4KICAgIC8vICAgICAiIiIKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3Igd2l0aGRyYXcgb3BlcmF0aW9uCiAgICAvLyAgICAgIyBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgIyAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgIyApLndpdGhkcmF3Lm5hdGl2ZQogICAgLy8gICAgICMgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgIyAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiV2l0aGRyYXcgY2FwIGV4Y2VlZGVkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGFtb3VudCA8PSB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB0aGUgYWN0dWFsIHVuZGVybHlpbmcgYW1vdW50IHRvIHRyYW5zZmVyIHRvIHVzZXIKICAgIC8vICAgICAjIGFtb3VudCBpcyB0aGUgc2NhbGVkIGFtb3VudCAoblRva2VucyksIHdlIG5lZWQgdG8gY29udmVydCB0byB1bmRlcmx5aW5nCiAgICAvLyAgICAgdW5kZXJseWluZ19hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdF9hbW91bnQobWFya2V0LCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICB1bmRlcmx5aW5nX3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIHVuZGVybHlpbmdfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBoZWFsdGggY2hlY2s6IGVuc3VyZSB3aXRoZHJhdyB3b3VsZCBub3QgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgIGlmIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZSA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICB1bmRlcmx5aW5nX3ZhbHVlIDw9IGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlCiAgICAvLyAgICAgICAgICksICJXaXRoZHJhd2FsIHB1dHMgdXNlciBhdCByaXNrIG9mIGxpcXVpZGF0aW9uIgogICAgLy8gICAgICAgICByZW1haW5pbmdfY29sbGF0ZXJhbCA9ICgKICAgIC8vICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gdW5kZXJseWluZ192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIGFzc2VydCBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIDw9ICgKICAgIC8vICAgICAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsICogQmlnVUludChtYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgLy8gICAgICAgICApIC8vIEJpZ1VJbnQoMTAwMDApLCAiV2l0aGRyYXdhbCBwdXRzIHVzZXIgYXQgcmlzayBvZiBsaXF1aWRhdGlvbiIKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3Igd2l0aGRyYXcgb3BlcmF0aW9uCiAgICAvLyAgICAgIyB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgICMgaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9PSAwOgogICAgLy8gICAgICMgICAgIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCArIDg2NDAwKQogICAgLy8gICAgICMgZWxpZiB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lIDwgR2xvYmFsLmxhdGVzdF90aW1lc3RhbXA6CiAgICAvLyAgICAgIyAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIC8vICAgICAjICAgICB1c2VyX2NhcC50b3RhbF9saXF1aWRhdGlvbnMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIC8vICAgICAjICAgICB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIC8vICAgICAjIGlmIHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgIyAgICAgbmV3X3RvdGFsX3dpdGhkcmF3YWxzID0gdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMubmF0aXZlICsgYW1vdW50X3VzZF92YWx1ZQogICAgLy8gICAgICMgICAgIGFzc2VydCAoCiAgICAvLyAgICAgIyAgICAgICAgIG5ld190b3RhbF93aXRoZHJhd2FscyA8PSB1c2VyX2NhcC5kYWlseV93aXRoZHJhd2Fscy5uYXRpdmUKICAgIC8vICAgICAjICAgICApLCAiVXNlciB3aXRoZHJhdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAgICAgIyAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYobmV3X3RvdGFsX3dpdGhkcmF3YWxzKQogICAgLy8gICAgICMgICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLCB1c2VyX2NhcCkKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2NvbGxhdGVyYWxfd2l0aGRyYXdfcHVyZSgKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgdW5kZXJseWluZ19hbW91bnQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgdW5kZXJseWluZ192YWx1ZSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIEVtaXQgZXZlbnRzCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0V2l0aGRyYXcoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgYXJjNC5VSW50NjQobWFya2V0X2lkKSwgYXJjNC5VSW50MjU2KGFtb3VudCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gdW5kZXJseWluZ19hbW91bnQKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXcoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX3dpdGhkcmF3X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGJvcnJvdyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDI4MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fYm9ycm93KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2JvcnJvd19wdXJlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIGJvcnJvdyBvcGVyYXRpb24KICAgIC8vICAgICAjIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAjICAgICBtYXJrZXRfaWQKICAgIC8vICAgICAjICkuYm9ycm93Lm5hdGl2ZQogICAgLy8gICAgICMgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgIyAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQodXNlcl9pZCkKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSBVSW50NjQoMTAwMDAwKSwgIlBheW1lbnQgYW1vdW50IG11c3QgYmUgPj0gMC4xIgogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGN1cnJlbnQgbWFya2V0IHRvdGFsIGJvcnJvd3MgKGluY2x1ZGluZyBpbnRlcmVzdCkKICAgIC8vICAgICBtYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzID0gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd3MobWFya2V0KQogICAgLy8gCiAgICAvLyAgICAgIyBWYWxpZGF0ZSBhZ2FpbnN0IG1hcmtldC13aWRlIGJvcnJvdyBjYXAKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQubWF4X3RvdGFsX2JvcnJvd3MubmF0aXZlID49IG1hcmtldF91bmRlcmx5aW5nX2JvcnJvd3MgKyBhbW91bnQKICAgIC8vICAgICApLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgY29sbGF0ZXJhbCByZXF1aXJlbWVudHMgLSBleGNsdWRlIHNhbWUgbWFya2V0IGNvbGxhdGVyYWwgdG8gcHJldmVudAogICAgLy8gICAgICMgaW5lZmZpY2llbnQgc2FtZS1hc3NldCBib3Jyb3dpbmcKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgYm9ycm93X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IEJpZ1VJbnQoMCk6CiAgICAvLyAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICAgICAjIFVzZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBleGNsdWRlZF92YWx1ZSA9IChkZXBvc2l0ZWRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgaWYgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgPiBleGNsdWRlZF92YWx1ZToKICAgIC8vICAgICAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gKAogICAgLy8gICAgICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gZXhjbHVkZWRfdmFsdWUKICAgIC8vICAgICAgICAgICAgICkKICAgIC8vICAgICAgICAgZWxzZToKICAgIC8vICAgICAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gQmlnVUludCgwKQogICAgLy8gCiAgICAvLyAgICAgdG90YWxfYm9ycm93X3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSArIGJvcnJvd192YWx1ZQogICAgLy8gICAgIGFzc2VydCB0b3RhbF9ib3Jyb3dfdmFsdWUgPD0gKAogICAgLy8gICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSAqIEJpZ1VJbnQobWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICAgICApIC8vIEJpZ1VJbnQoMTAwMDApLCAiSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgYWNyb3NzIG1hcmtldHMiCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBleHBlY3RlZCBzY2FsZWQgYm9ycm93cwogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3cobWFya2V0LCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9kZWJ0X2JvcnJvd19wdXJlKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgc2NhbGVkX2Ftb3VudCwKICAgIC8vICAgICAgICAgYm9ycm93X3ZhbHVlLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgRW1pdCBldmVudAogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldEJvcnJvdygKICAgIC8vICAgICAjICAgICAgICAgdXNlcj1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHRva2VuX2lkPWFyYzQuVUludDY0KG1hcmtldF9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIGFtb3VudD1hcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2JvcnJvdyhzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgc2VsZi5fYm9ycm93X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHJlcGF5KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICBzZWxmLl9yZXBheShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWJ0X3JlcGF5bWVudF9wdXJlKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgcGF5ZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MocGF5ZXJfaWQpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKHBheWVyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAjIGFkanVzdCB1c2VyJ3Mgc2NhbGVkIGJvcnJvd3MKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgYmVuZWZpY2lhcnlfaWQsIHNjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhZGp1c3QgbWFya2V0J3MgdG90YWwgc2NhbGVkIGJvcnJvd3MKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICAjIGFkanVzdCBnbG9iYWwgYm9ycm93IHZhbHVlCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X2dsb2JhbF9ib3Jyb3dzKGJlbmVmaWNpYXJ5X2lkLCB2YWx1ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXlfcHVyZShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFJlcGF5IGJvcnJvd2VkIHRva2VucyBmb3IgYSBzcGVjaWZpYyBtYXJrZXQuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBoYW5kbGVzIHRoZSByZXBheW1lbnQgb2YgYm9ycm93ZWQgdG9rZW5zLiBJdCBzdXBwb3J0cyBib3RoCiAgICAvLyAgICAgc1Rva2VuIChidXJuKSBhbmQgYVRva2VuICh0cmFuc2ZlcikgbWFya2V0cy4gVGhlIGFjdHVhbCB0b2tlbiBvcGVyYXRpb25zCiAgICAvLyAgICAgYXJlIGRlbGVnYXRlZCB0byBfZGVidF9yZXBheW1lbnRfcHVyZSgpIHdoaWNoIGNvcnJlY3RseSBoYW5kbGVzIHRoZQogICAgLy8gICAgIGNyaXRpY2FsIHRva2VuIGJ1cm4vdHJhbnNmZXIgbG9naWMuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgdXNlciBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIG1hcmtldF9pZDogVGhlIG1hcmtldCBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIGFtb3VudDogVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gcmVwYXkgKG11c3Qgbm90IGV4Y2VlZCB0b3RhbCBkZWJ0KQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgbWFya2V0IHZhbGlkYXRpb24gZmFpbHMsIHJlcGF5IGFtb3VudCBleGNlZWRzIHRvdGFsIGRlYnQsCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgb3IgcHJpbmNpcGFsIHJlcGF5bWVudCBleGNlZWRzIHNjYWxlZCBkZWJ0CiAgICAvLyAKICAgIC8vICAgICBQcm9jZXNzOgogICAgLy8gICAgICAgICAxLiBWYWxpZGF0ZXMgbWFya2V0IG9wZXJhdGlvbiBhbmQgYWNjcnVlcyBpbnRlcmVzdAogICAgLy8gICAgICAgICAyLiBHZXRzIHVzZXIgYW5kIG1hcmtldCBzdGF0ZQogICAgLy8gICAgICAgICAzLiBDYWxjdWxhdGVzIHRvdGFsIHVuZGVybHlpbmcgYm9ycm93cyBmb3IgdmFsaWRhdGlvbgogICAgLy8gICAgICAgICA0LiBWYWxpZGF0ZXMgcmVwYXkgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vICAgICAgICAgNS4gQ2FsY3VsYXRlcyBzY2FsZWQgYW1vdW50IGZvciBwcmluY2lwYWwgcmVwYXltZW50CiAgICAvLyAgICAgICAgIDYuIFZhbGlkYXRlcyBzY2FsZWQgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHVzZXIncyBzY2FsZWQgZGVidAogICAgLy8gICAgICAgICA3LiBDYWxjdWxhdGVzIHJlcGF5IHZhbHVlIGZvciBnbG9iYWwgdHJhY2tpbmcKICAgIC8vICAgICAgICAgOC4gRGVsZWdhdGVzIHRvIF9kZWJ0X3JlcGF5bWVudF9wdXJlKCkgZm9yOgogICAgLy8gICAgICAgICAgICAgLSBUb2tlbiBidXJuIChzVG9rZW4pIG9yIHRyYW5zZmVyIChhVG9rZW4pIGZyb20gdXNlcgogICAgLy8gICAgICAgICAgICAgLSBVc2VyIGFuZCBtYXJrZXQgc2NhbGVkIGJvcnJvdyB1cGRhdGVzCiAgICAvLyAgICAgICAgICAgICAtIEdsb2JhbCBib3Jyb3cgdmFsdWUgdHJhY2tpbmcKICAgIC8vIAogICAgLy8gICAgIFNlY3VyaXR5IE5vdGU6CiAgICAvLyAgICAgICAgIFRoaXMgbWV0aG9kIGNvcnJlY3RseSBidXJucyBzVG9rZW5zIGZyb20gdGhlIHVzZXIncyBhZGRyZXNzIChub3QgdGhlCiAgICAvLyAgICAgICAgIHByb3RvY29sIGFkZHJlc3MpIGFzIHBlciB0aGUgZml4IGZvciBERi1BVUQtMDIuCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB0b3RhbF91bmRlcmx5aW5nX2JvcnJvd3MgPSBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfYm9ycm93cyhtYXJrZXQpCiAgICAvLyAgICAgYXNzZXJ0IGFtb3VudCA8PSB0b3RhbF91bmRlcmx5aW5nX2JvcnJvd3MsICJSZXBheSBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0IgogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3cobWFya2V0LCBhbW91bnQpCiAgICAvLyAgICAgYXNzZXJ0IHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IHNjYWxlZF9hbW91bnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyBkZWJ0IgogICAgLy8gICAgIHJlcGF5X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGFtb3VudCkKICAgIC8vICAgICBzZWxmLl9kZWJ0X3JlcGF5bWVudF9wdXJlKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgc2NhbGVkX2Ftb3VudCwKICAgIC8vICAgICAgICAgcmVwYXlfdmFsdWUsCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBFbWl0IGV2ZW50CiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0UmVwYXkoCiAgICAvLyAgICAgIyAgICAgICAgIHVzZXI9YXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQobWFya2V0X2lkKSwKICAgIC8vICAgICAjICAgICAgICAgYW1vdW50PWFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX3JlcGF5X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgc2VsZi5fcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBzZWxmLl9yZXNvbHZlX2FjY3VtdWxhdGVkX2JvcnJvd19pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmV2aW91c19wcmljZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2xhc3RfcHJpY2U6IEJpZ1VJbnQsIG1hcmtldF9wcmljZTogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHJldHVybiB1c2VyX2xhc3RfcHJpY2UgaWYgdXNlcl9sYXN0X3ByaWNlID4gMCBlbHNlIG1hcmtldF9wcmljZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfdXNlcl9tYXJrZXRfY29sbGF0ZXJhKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXI6IFVzZXJEYXRhLCBtYXJrZXQ6IE1hcmtldERhdGEKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBVcGRhdGUgYSB1c2VyJ3MgbWFya2V0IGNvbGxhdGVyYWwgdmFsdWVzIHdoZW4gbWFya2V0IHByaWNlcyBjaGFuZ2UuCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybgogICAgLy8gCiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIncyBkZXBvc2l0X2luZGV4IGlzIDAgKG5ldyB1c2VyKSwgdXNlIGN1cnJlbnQgbWFya2V0IGluZGV4CiAgICAvLyAgICAgdXNlcl9kZXBvc2l0X2luZGV4ID0gKAogICAgLy8gICAgICAgICB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXJfZGVwb3NpdF9pbmRleCkgLy8gU0NBTEUKICAgIC8vICAgICBuZXdfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vICAgICBwcmljZV9mb3Jfb2xkID0gc2VsZi5fZ2V0X3ByZXZpb3VzX3ByaWNlKAogICAgLy8gICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlLCBtYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIG9sZF9kZXBvc2l0X3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2RlcG9zaXRfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwodXNlcl9pZCwgb2xkX2RlcG9zaXRfdmFsdWUsIG5ld19kZXBvc2l0X3ZhbHVlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfdXNlcl9tYXJrZXRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyOiBVc2VyRGF0YSwgbWFya2V0OiBNYXJrZXREYXRhCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgVXBkYXRlIGEgdXNlcidzIG1hcmtldCBib3Jyb3cgdmFsdWVzIHdoZW4gbWFya2V0IHByaWNlcyBjaGFuZ2UuCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuCiAgICAvLyAgICAgb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIHByaWNlX2Zvcl9vbGQgPSBzZWxmLl9nZXRfcHJldmlvdXNfcHJpY2UoCiAgICAvLyAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUsIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgb2xkX2JvcnJvd192YWx1ZSA9IChvbGRfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2JvcnJvd192YWx1ZSA9IChuZXdfYm9ycm93X2Ftb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKHVzZXJfaWQsIG9sZF9ib3Jyb3dfdmFsdWUsIG5ld19ib3Jyb3dfdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFVwZGF0ZSBhIHVzZXIncyBnbG9iYWwgdmFsdWVzIHdoZW4gbWFya2V0IHByaWNlcyBjaGFuZ2UuCiAgICAvLyAgICAgIiIiCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKS5jb3B5KCkKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9PSAwIGFuZCB1c2VyLnNjYWxlZF9ib3Jyb3dzID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9tYXJrZXRfY29sbGF0ZXJhKHVzZXJfaWQsIHVzZXIsIG1hcmtldCkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9tYXJrZXRfYm9ycm93cyh1c2VyX2lkLCB1c2VyLCBtYXJrZXQpCiAgICAvLyAKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfZ2xvYmFsX3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBHbG9iYWxVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfZ2xvYmFsX3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gR2xvYmFsVXNlckRhdGE6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLmdsb2JhbF91c2VyczoKICAgIGZyYW1lX2RpZyAtMQogICAgY29uY2F0CiAgICBkdXAKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDkyCiAgICAvLyBpZiB1c2VyX2lkIGluIHNlbGYuZ2xvYmFsX3VzZXJzOgogICAgYnogX2dldF9nbG9iYWxfdXNlcl9lbHNlX2JvZHlAMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDkzCiAgICAvLyByZXR1cm4gc2VsZi5nbG9iYWxfdXNlcnNbdXNlcl9pZF0KICAgIGZyYW1lX2RpZyAwCiAgICBib3hfZ2V0CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5nbG9iYWxfdXNlcnMgZW50cnkgZXhpc3RzCiAgICBzd2FwCiAgICByZXRzdWIKCl9nZXRfZ2xvYmFsX3VzZXJfZWxzZV9ib2R5QDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0OTUKICAgIC8vIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICBieXRlIDB4NzMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ5NgogICAgLy8gYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIGJveF9nZXQKICAgIGFzc2VydCAvLyBjaGVjayBCb3ggZXhpc3RzCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0OTctMjQ5OQogICAgLy8gZ2xvYmFsX3VzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9nbG9iYWxfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyApCiAgICBpdHhuX2JlZ2luCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIG1ldGhvZCAiZ2V0X2dsb2JhbF91c2VyX2RlZmF1bHQoKSh1aW50MjU2LHVpbnQyNTYsdWludDY0KSIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgaXR4biBMYXN0TG9nCiAgICBkdXAKICAgIGV4dHJhY3QgNCAwCiAgICBzd2FwCiAgICBleHRyYWN0IDAgNAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICA9PQogICAgYXNzZXJ0IC8vIEFSQzQgcHJlZml4IGlzIHZhbGlkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MDAKICAgIC8vIHJldHVybiBnbG9iYWxfdXNlcgogICAgc3dhcAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2NhbGN1bGF0ZV91c2VyX2hlYWx0aChjb2xsYXRlcmFsX3ZhbHVlOiBieXRlcywgYm9ycm93X3ZhbHVlOiBieXRlcywgbGlxdWlkYXRpb25fdGhyZXNob2xkOiB1aW50NjQpIC0+IGJ5dGVzOgpfY2FsY3VsYXRlX3VzZXJfaGVhbHRoOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjYxLTI2NjcKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2hlYWx0aCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIGNvbGxhdGVyYWxfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyAgICAgYm9ycm93X3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogVUludDY0LAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgcHJvdG8gMyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NjgKICAgIC8vIGlmIGJvcnJvd192YWx1ZSA9PSAwOgogICAgZnJhbWVfZGlnIC0yCiAgICBieXRlIDB4CiAgICBiPT0KICAgIGJ6IF9jYWxjdWxhdGVfdXNlcl9oZWFsdGhfZWxzZV9ib2R5QDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY2OQogICAgLy8gcmV0dXJuIEJpZ1VJbnQoMTAwMDApCiAgICBieXRlIDB4MjcxMAogICAgcmV0c3ViCgpfY2FsY3VsYXRlX3VzZXJfaGVhbHRoX2Vsc2VfYm9keUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjcyCiAgICAvLyBjb2xsYXRlcmFsX3ZhbHVlICogQmlnVUludChsaXF1aWRhdGlvbl90aHJlc2hvbGQpICogQmlnVUludCgxMDAwMCkKICAgIGZyYW1lX2RpZyAtMQogICAgaXRvYgogICAgZnJhbWVfZGlnIC0zCiAgICBiKgogICAgYnl0ZSAweDI3MTAKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NzMKICAgIC8vICkgLy8gKGJvcnJvd192YWx1ZSAqIEJpZ1VJbnQoMTAwMDApKQogICAgZnJhbWVfZGlnIC0yCiAgICBieXRlIDB4MjcxMAogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY3MS0yNjczCiAgICAvLyByZXR1cm4gKAogICAgLy8gICAgIGNvbGxhdGVyYWxfdmFsdWUgKiBCaWdVSW50KGxpcXVpZGF0aW9uX3RocmVzaG9sZCkgKiBCaWdVSW50KDEwMDAwKQogICAgLy8gKSAvLyAoYm9ycm93X3ZhbHVlICogQmlnVUludCgxMDAwMCkpCiAgICBiLwogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3VwZGF0ZV91c2VyX21hcmtldF9ib3Jyb3dzKHVzZXJfaWQ6IGJ5dGVzLCB1c2VyOiBieXRlcywgbWFya2V0OiBieXRlcykgLT4gYnl0ZXMsIGJ5dGVzOgpfdXBkYXRlX3VzZXJfbWFya2V0X2JvcnJvd3M6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NDMtMjQ0NgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdXBkYXRlX3VzZXJfbWFya2V0X2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcjogVXNlckRhdGEsIG1hcmtldDogTWFya2V0RGF0YQogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NTAKICAgIC8vIGlmIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID09IDA6CiAgICBmcmFtZV9kaWcgLTIKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGJ5dGUgMHgKICAgIGI9PQogICAgYnogX3VwZGF0ZV91c2VyX21hcmtldF9ib3Jyb3dzX2FmdGVyX2lmX2Vsc2VAMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDUxCiAgICAvLyByZXR1cm4KICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICB1bmNvdmVyIDIKICAgIHJldHN1YgoKX3VwZGF0ZV91c2VyX21hcmtldF9ib3Jyb3dzX2FmdGVyX2lmX2Vsc2VAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ1MwogICAgLy8gdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMgogICAgZXh0cmFjdCA5NiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAwCiAgICBkdXAKICAgIHVuY292ZXIgMgogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ1NAogICAgLy8gKSAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ1Mi0yNDU0CiAgICAvLyBvbGRfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gKSAvLyBTQ0FMRQogICAgYi8KICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ1NgogICAgLy8gdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgZnJhbWVfZGlnIC0xCiAgICBleHRyYWN0IDIwOSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NTcKICAgIC8vICkgLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NTUtMjQ1NwogICAgLy8gbmV3X2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gKSAvLyBTQ0FMRQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ1OQogICAgLy8gdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSwgbWFya2V0LnByaWNlLm5hdGl2ZQogICAgZnJhbWVfZGlnIC0yCiAgICBleHRyYWN0IDEzNiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAtMQogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ1OC0yNDYwCiAgICAvLyBwcmljZV9mb3Jfb2xkID0gc2VsZi5fZ2V0X3ByZXZpb3VzX3ByaWNlKAogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUsIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICkKICAgIGR1cAogICAgY292ZXIgMgogICAgY2FsbHN1YiBfZ2V0X3ByZXZpb3VzX3ByaWNlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NjEKICAgIC8vIG9sZF9ib3Jyb3dfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgdW5jb3ZlciAzCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0NjIKICAgIC8vIG5ld19ib3Jyb3dfdmFsdWUgPSAobmV3X2JvcnJvd19hbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgY292ZXIgMgogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDYzCiAgICAvLyBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3ModXNlcl9pZCwgb2xkX2JvcnJvd192YWx1ZSwgbmV3X2JvcnJvd192YWx1ZSkKICAgIGZyYW1lX2RpZyAtMwogICAgY292ZXIgMgogICAgY2FsbHN1YiBfdXBkYXRlX2dsb2JhbF9ib3Jyb3dzCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgdW5jb3ZlciAyCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKHVzZXJfaWQ6IGJ5dGVzLCBvbGRfdmFsdWU6IGJ5dGVzLCBuZXdfdmFsdWU6IGJ5dGVzKSAtPiB2b2lkOgpfdXBkYXRlX2dsb2JhbF9ib3Jyb3dzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTc0LTI1ODAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTgxCiAgICAvLyBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfZ2xvYmFsX3VzZXIKICAgIGR1cAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTgyCiAgICAvLyBpZiBvbGRfdmFsdWUgPiBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlOgogICAgZXh0cmFjdCAzMiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgY292ZXIgMgogICAgZnJhbWVfZGlnIC0yCiAgICBiPAogICAgYnogX3VwZGF0ZV9nbG9iYWxfYm9ycm93c19lbHNlX2JvZHlAMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTgzCiAgICAvLyBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPSBhcmM0LlVJbnQyNTYobmV3X3ZhbHVlKQogICAgZnJhbWVfZGlnIC0xCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgZnJhbWVfZGlnIC0xCiAgICBifAogICAgcmVwbGFjZTIgMzIKICAgIGIgX3VwZGF0ZV9nbG9iYWxfYm9ycm93c19hZnRlcl9pZl9lbHNlQDMKCl91cGRhdGVfZ2xvYmFsX2JvcnJvd3NfZWxzZV9ib2R5QDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1ODYKICAgIC8vIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIGZyYW1lX2RpZyAwCiAgICBmcmFtZV9kaWcgLTIKICAgIGItCiAgICBmcmFtZV9kaWcgLTEKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1ODUtMjU4NwogICAgLy8gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXBsYWNlMiAzMgoKX3VwZGF0ZV9nbG9iYWxfYm9ycm93c19hZnRlcl9pZl9lbHNlQDM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1ODgKICAgIC8vIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGl0b2IKICAgIHJlcGxhY2UyIDY0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzQKICAgIC8vIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgYnl0ZSAiZ2xvYmFsX3VzZXJzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTg5CiAgICAvLyBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXSA9IGdsb2JhbF91c2VyLmNvcHkoKQogICAgZnJhbWVfZGlnIC0zCiAgICBjb25jYXQKICAgIHN3YXAKICAgIGJveF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9yZXNvbHZlX2FjY3VtdWxhdGVkX2RlcG9zaXRfaW50ZXJlc3QodXNlcl9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0KSAtPiB2b2lkOgpfcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzM0LTE3MzcKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3Jlc29sdmVfYWNjdW11bGF0ZWRfZGVwb3NpdF9pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICBpbnQgMAogICAgZHVwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3NTQKICAgIC8vIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIGR1cAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzU1CiAgICAvLyBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gMDoKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ5dGUgMHgKICAgIGI9PQogICAgYnogX3Jlc29sdmVfYWNjdW11bGF0ZWRfZGVwb3NpdF9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc1NgogICAgLy8gcmV0dXJuCiAgICByZXRzdWIKCl9yZXNvbHZlX2FjY3VtdWxhdGVkX2RlcG9zaXRfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzU3CiAgICAvLyBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X21hcmtldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzU4CiAgICAvLyBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0X3dpdGhfZGF0YSh1c2VyLCBtYXJrZXQpCiAgICBmcmFtZV9kaWcgMgogICAgc3dhcAogICAgY2FsbHN1YiBfY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3Rfd2l0aF9kYXRhCiAgICBmcmFtZV9idXJ5IDEKICAgIHBvcAogICAgZHVwCiAgICBmcmFtZV9idXJ5IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc1OQogICAgLy8gaWYgaW50ZXJlc3QgPT0gMDoKICAgIGJ5dGUgMHgKICAgIGI9PQogICAgYnogX3Jlc29sdmVfYWNjdW11bGF0ZWRfZGVwb3NpdF9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc2MAogICAgLy8gcmV0dXJuCiAgICByZXRzdWIKCl9yZXNvbHZlX2FjY3VtdWxhdGVkX2RlcG9zaXRfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUA0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzYxCiAgICAvLyBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gc2VsZi5fZ2V0X21hcmtldF9zY2FsZWRfZGVwb3NpdChtYXJrZXQsIGludGVyZXN0KQogICAgZnJhbWVfZGlnIDEKICAgIGZyYW1lX2RpZyAwCiAgICBkdXAKICAgIGNvdmVyIDIKICAgIGNhbGxzdWIgX2dldF9tYXJrZXRfc2NhbGVkX2RlcG9zaXQKICAgIHN3YXAKICAgIGNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc2MgogICAgLy8gaW50ZXJlc3RfdmFsdWUgPSBzZWxmLl9nZXRfbWFya2V0X3ZhbHVlKG1hcmtldCwgaW50ZXJlc3QpCiAgICBzd2FwCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0X3ZhbHVlCiAgICB1bmNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc2My0xNzY4CiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIE5Ub2tlbi5taW50LAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc2NgogICAgLy8gYXJjNC5VSW50MjU2KGludGVyZXN0X3NjYWxlZF9hbW91bnQpLAogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgZGlnIDEKICAgIGJ8CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3NjcKICAgIC8vIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICB1bmNvdmVyIDIKICAgIGludCAzMTMKICAgIGludCA4CiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ0b2kKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzYzLTE3NjgKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihpbnRlcmVzdF9zY2FsZWRfYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gKQogICAgbWV0aG9kICJtaW50KGFkZHJlc3MsdWludDI1Nil2b2lkIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGZyYW1lX2RpZyAtMgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzY5LTE3NzEKICAgIC8vIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgbWFya2V0X2lkLCB1c2VyX2lkLCBpbnRlcmVzdF9zY2FsZWRfYW1vdW50CiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTEKICAgIGZyYW1lX2RpZyAtMgogICAgdW5jb3ZlciAyCiAgICBjYWxsc3ViIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3NzIKICAgIC8vIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCBCaWdVSW50KDApLCBpbnRlcmVzdF92YWx1ZSkKICAgIGZyYW1lX2RpZyAtMgogICAgYnl0ZSAweAogICAgdW5jb3ZlciAyCiAgICBjYWxsc3ViIF91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGEodXNlcjogYnl0ZXMsIG1hcmtldDogYnl0ZXMpIC0+IGJ5dGVzLCBieXRlcywgYnl0ZXM6Cl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGE6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NDEtMTk0NAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3Rfd2l0aF9kYXRhKAogICAgLy8gICAgIHNlbGYsIHVzZXI6IFVzZXJEYXRhLCBtYXJrZXQ6IE1hcmtldERhdGEKICAgIC8vICkgLT4gQmlnVUludDoKICAgIHByb3RvIDIgMwogICAgaW50IDAKICAgIGR1cG4gMwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTQ2LTE5NDcKICAgIC8vICMgU2FmZXR5IGNoZWNrOiBpZiB1c2VyIGhhcyBubyBkZXBvc2l0cywgcmV0dXJuIDAgaW50ZXJlc3QKICAgIC8vIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgZnJhbWVfZGlnIC0yCiAgICBleHRyYWN0IDAgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGJ5dGUgMHgKICAgIGI9PQogICAgYnogX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0X3dpdGhfZGF0YV9hZnRlcl9pZl9lbHNlQDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk0OAogICAgLy8gcmV0dXJuIEJpZ1VJbnQoMCkKICAgIGJ5dGUgMHgKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBmcmFtZV9idXJ5IDIKICAgIGZyYW1lX2J1cnkgMQogICAgZnJhbWVfYnVyeSAwCiAgICByZXRzdWIKCl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGFfYWZ0ZXJfaWZfZWxzZUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTUyCiAgICAvLyB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMQogICAgZXh0cmFjdCAxNzcgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMgogICAgZnJhbWVfZGlnIDQKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NTMKICAgIC8vICkgLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NTAtMTk1MwogICAgLy8gIyBDYWxjdWxhdGUgY3VycmVudCB1bmRlcmx5aW5nIHZhbHVlCiAgICAvLyBjdXJyZW50X3VuZGVybHlpbmcgPSAoCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyApIC8vIFNDQUxFCiAgICBiLwogICAgZnJhbWVfYnVyeSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NTkKICAgIC8vIGlmIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUgPiAwCiAgICBmcmFtZV9kaWcgLTIKICAgIGV4dHJhY3QgNjQgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMwogICAgYnl0ZSAweAogICAgYj4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk1OC0xOTYwCiAgICAvLyB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyBpZiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlID4gMAogICAgLy8gZWxzZSBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIGJ6IF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGFfdGVybmFyeV9mYWxzZUA0CiAgICBmcmFtZV9kaWcgMwogICAgYiBfY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3Rfd2l0aF9kYXRhX3Rlcm5hcnlfbWVyZ2VANQoKX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0X3dpdGhfZGF0YV90ZXJuYXJ5X2ZhbHNlQDQ6CiAgICBmcmFtZV9kaWcgMgoKX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0X3dpdGhfZGF0YV90ZXJuYXJ5X21lcmdlQDU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NjIKICAgIC8vIGxhc3RfdW5kZXJseWluZyA9ICh1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyX2RlcG9zaXRfaW5kZXgpIC8vIFNDQUxFCiAgICBmcmFtZV9kaWcgNAogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk2NC0xOTY1CiAgICAvLyAjIEludGVyZXN0IGlzIHRoZSBkaWZmZXJlbmNlCiAgICAvLyBpZiBjdXJyZW50X3VuZGVybHlpbmcgPiBsYXN0X3VuZGVybHlpbmc6CiAgICBmcmFtZV9kaWcgMAogICAgYjwKICAgIGJ6IF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGFfZWxzZV9ib2R5QDcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk2NgogICAgLy8gaW50ZXJlc3QgPSBjdXJyZW50X3VuZGVybHlpbmcgLSBsYXN0X3VuZGVybHlpbmcKICAgIGZyYW1lX2RpZyAwCiAgICBmcmFtZV9kaWcgMQogICAgYi0KICAgIGIgX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0X3dpdGhfZGF0YV9hZnRlcl9pZl9lbHNlQDgKCl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGFfZWxzZV9ib2R5QDc6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NjgKICAgIC8vIGludGVyZXN0ID0gQmlnVUludCgwKQogICAgYnl0ZSAweAoKX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0X3dpdGhfZGF0YV9hZnRlcl9pZl9lbHNlQDg6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NzAKICAgIC8vIHJldHVybiBpbnRlcmVzdAogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIGZyYW1lX2J1cnkgMgogICAgZnJhbWVfYnVyeSAxCiAgICBmcmFtZV9idXJ5IDAKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9nZXRfbWFya2V0X3NjYWxlZF9kZXBvc2l0KG1hcmtldDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IGJ5dGVzLCBieXRlczoKX2dldF9tYXJrZXRfc2NhbGVkX2RlcG9zaXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MTktMTgyMgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF9zY2FsZWRfZGVwb3NpdCgKICAgIC8vICAgICBzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgcHJvdG8gMiAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MjMtMTgyNQogICAgLy8gIyBTYWZldHkgY2hlY2s6IGVuc3VyZSBkZXBvc2l0X2luZGV4IGlzIG5ldmVyIDAgdG8gcHJldmVudCBkaXZpc2lvbiBieSB6ZXJvCiAgICAvLyAjIElmIGRlcG9zaXRfaW5kZXggaXMgMCwgaW5pdGlhbGl6ZSBpdCB0byBTQ0FMRSAoMS4wKQogICAgLy8gZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgZnJhbWVfZGlnIC0yCiAgICBleHRyYWN0IDE3NyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODI2CiAgICAvLyBpZiBkZXBvc2l0X2luZGV4ID09IDA6CiAgICBieXRlIDB4CiAgICBiPT0KICAgIGJ6IF9nZXRfbWFya2V0X3NjYWxlZF9kZXBvc2l0X2FmdGVyX2lmX2Vsc2VAMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODI3CiAgICAvLyBkZXBvc2l0X2luZGV4ID0gQmlnVUludChTQ0FMRSkKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBmcmFtZV9idXJ5IDAKCl9nZXRfbWFya2V0X3NjYWxlZF9kZXBvc2l0X2FmdGVyX2lmX2Vsc2VAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTgyOAogICAgLy8gcmV0dXJuIChhbW91bnQgKiBTQ0FMRSkgLy8gZGVwb3NpdF9pbmRleAogICAgZnJhbWVfZGlnIC0xCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYioKICAgIGZyYW1lX2RpZyAwCiAgICBiLwogICAgZnJhbWVfZGlnIC0yCiAgICB1bmNvdmVyIDIKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9nZXRfbWFya2V0X3ZhbHVlKG1hcmtldDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IGJ5dGVzLCBieXRlczoKX2dldF9tYXJrZXRfdmFsdWU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MzktMTg0MAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF92YWx1ZShzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIGFtb3VudDogQmlnVUludCkgLT4gQmlnVUludDoKICAgIHByb3RvIDIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODQxCiAgICAvLyByZXR1cm4gKGFtb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICBmcmFtZV9kaWcgLTIKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgLTEKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIGZyYW1lX2RpZyAtMgogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkOiB1aW50NjQsIHVzZXJfaWQ6IGJ5dGVzLCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0czoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE0OS0xMTUyCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTUzCiAgICAvLyBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X21hcmtldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTU0CiAgICAvLyB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF91c2VyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNTUKICAgIC8vIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfdXNlcl9rZXkKICAgIGNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE1NgogICAgLy8gdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgZHVwCiAgICBleHRyYWN0IDAgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgLTEKICAgIGIrCiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBifAogICAgcmVwbGFjZTIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTU3CiAgICAvLyB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgZGlnIDEKICAgIGV4dHJhY3QgMTc3IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgcmVwbGFjZTIgNjQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE1OAogICAgLy8gdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICByZXBsYWNlMiAxMjgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE1OQogICAgLy8gdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICBzd2FwCiAgICBpbnQgMjgxCiAgICBpbnQgMzIKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgcmVwbGFjZTIgMTM2CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzMKICAgIC8vIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgYnl0ZSAidXNlcnMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNjAKICAgIC8vIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIHVuY292ZXIgMgogICAgY29uY2F0CiAgICBzd2FwCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fcmVzb2x2ZV9hY2N1bXVsYXRlZF9ib3Jyb3dfaW50ZXJlc3QodXNlcl9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0KSAtPiB2b2lkOgpfcmVzb2x2ZV9hY2N1bXVsYXRlZF9ib3Jyb3dfaW50ZXJlc3Q6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3NzQtMTc3NwogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVzb2x2ZV9hY2N1bXVsYXRlZF9ib3Jyb3dfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgaW50IDAKICAgIGR1cAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzgxCiAgICAvLyB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2dldF91c2VyCiAgICBkdXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc4MgogICAgLy8gaWYgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPT0gMDoKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBieXRlIDB4CiAgICBiPT0KICAgIGJ6IF9yZXNvbHZlX2FjY3VtdWxhdGVkX2JvcnJvd19pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc4MwogICAgLy8gcmV0dXJuCiAgICByZXRzdWIKCl9yZXNvbHZlX2FjY3VtdWxhdGVkX2JvcnJvd19pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3ODQKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3ODUKICAgIC8vIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdF93aXRoX2RhdGEodXNlciwgbWFya2V0KQogICAgZnJhbWVfZGlnIDIKICAgIHN3YXAKICAgIGNhbGxzdWIgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhCiAgICBmcmFtZV9idXJ5IDEKICAgIHBvcAogICAgZHVwCiAgICBmcmFtZV9idXJ5IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc4NgogICAgLy8gaWYgaW50ZXJlc3QgPT0gMDoKICAgIGJ5dGUgMHgKICAgIGI9PQogICAgYnogX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VANAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzg3CiAgICAvLyByZXR1cm4KICAgIHJldHN1YgoKX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VANDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc4OAogICAgLy8gaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCA9IHNlbGYuX2dldF9tYXJrZXRfc2NhbGVkX2JvcnJvdyhtYXJrZXQsIGludGVyZXN0KQogICAgZnJhbWVfZGlnIDEKICAgIGZyYW1lX2RpZyAwCiAgICBkdXAKICAgIGNvdmVyIDIKICAgIGNhbGxzdWIgX2dldF9tYXJrZXRfc2NhbGVkX2JvcnJvdwogICAgc3dhcAogICAgY292ZXIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzg5CiAgICAvLyBpbnRlcmVzdF92YWx1ZSA9IHNlbGYuX2dldF9tYXJrZXRfdmFsdWUobWFya2V0LCBpbnRlcmVzdCkKICAgIHN3YXAKICAgIGNhbGxzdWIgX2dldF9tYXJrZXRfdmFsdWUKICAgIHBvcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzkwLTE3OTIKICAgIC8vIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBtYXJrZXRfaWQsIHVzZXJfaWQsIGludGVyZXN0X3NjYWxlZF9hbW91bnQKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMQogICAgZnJhbWVfZGlnIC0yCiAgICB1bmNvdmVyIDMKICAgIGNhbGxzdWIgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzkzCiAgICAvLyBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3ModXNlcl9pZCwgQmlnVUludCgwKSwgaW50ZXJlc3RfdmFsdWUpCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ5dGUgMHgKICAgIHVuY292ZXIgMgogICAgY2FsbHN1YiBfdXBkYXRlX2dsb2JhbF9ib3Jyb3dzCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdF93aXRoX2RhdGEodXNlcjogYnl0ZXMsIG1hcmtldDogYnl0ZXMpIC0+IGJ5dGVzLCBieXRlcywgYnl0ZXM6Cl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0X3dpdGhfZGF0YToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk5MS0xOTk0CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0X3dpdGhfZGF0YSgKICAgIC8vICAgICBzZWxmLCB1c2VyOiBVc2VyRGF0YSwgbWFya2V0OiBNYXJrZXREYXRhCiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICBwcm90byAyIDMKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5OTgKICAgIC8vIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMgogICAgZXh0cmFjdCAzMiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfZGlnIC0xCiAgICBleHRyYWN0IDIwOSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgY292ZXIgMgogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk5OQogICAgLy8gKSAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk5Ni0xOTk5CiAgICAvLyAjIENhbGN1bGF0ZSB0b3RhbCB1bmRlcmx5aW5nIGRlYnQgYW1vdW50CiAgICAvLyB1c2VyX3RvdGFsX2RlYnQgPSAoCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gKSAvLyBTQ0FMRQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAwNQogICAgLy8gaWYgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlID4gMAogICAgZnJhbWVfZGlnIC0yCiAgICBleHRyYWN0IDk2IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBieXRlIDB4CiAgICBiPgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDA0LTIwMDYKICAgIC8vIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gaWYgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlID4gMAogICAgLy8gZWxzZSBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgYnogX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhX3Rlcm5hcnlfZmFsc2VAMgogICAgZnJhbWVfZGlnIDQKICAgIGIgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhX3Rlcm5hcnlfbWVyZ2VAMwoKX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhX3Rlcm5hcnlfZmFsc2VAMjoKICAgIGZyYW1lX2RpZyAyCgpfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdF93aXRoX2RhdGFfdGVybmFyeV9tZXJnZUAzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDA4CiAgICAvLyBvcmlnaW5hbF9wcmluY2lwYWwgPSAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyX2JvcnJvd19pbmRleCkgLy8gU0NBTEUKICAgIGZyYW1lX2RpZyAxCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDEwLTIwMTIKICAgIC8vICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRvdGFsIGRlYnQgYW5kIG9yaWdpbmFsIHByaW5jaXBhbAogICAgLy8gIyBQcmV2ZW50IG5lZ2F0aXZlIGludGVyZXN0ICh1bmRlcmZsb3cgcHJvdGVjdGlvbikKICAgIC8vIGlmIHVzZXJfdG90YWxfZGVidCA+PSBvcmlnaW5hbF9wcmluY2lwYWw6CiAgICBmcmFtZV9kaWcgMwogICAgYjw9CiAgICBieiBfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdF93aXRoX2RhdGFfZWxzZV9ib2R5QDUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAxMwogICAgLy8gZGVidF9pbnRlcmVzdCA9IHVzZXJfdG90YWxfZGVidCAtIG9yaWdpbmFsX3ByaW5jaXBhbAogICAgZnJhbWVfZGlnIDMKICAgIGZyYW1lX2RpZyAwCiAgICBiLQogICAgYiBfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdF93aXRoX2RhdGFfYWZ0ZXJfaWZfZWxzZUA2CgpfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdF93aXRoX2RhdGFfZWxzZV9ib2R5QDU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMTUKICAgIC8vIGRlYnRfaW50ZXJlc3QgPSBCaWdVSW50KDApCiAgICBieXRlIDB4CgpfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdF93aXRoX2RhdGFfYWZ0ZXJfaWZfZWxzZUA2OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDE3CiAgICAvLyByZXR1cm4gZGVidF9pbnRlcmVzdAogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIGZyYW1lX2J1cnkgMgogICAgZnJhbWVfYnVyeSAxCiAgICBmcmFtZV9idXJ5IDAKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3cobWFya2V0OiBieXRlcywgYW1vdW50OiBieXRlcykgLT4gYnl0ZXMsIGJ5dGVzOgpfZ2V0X21hcmtldF9zY2FsZWRfYm9ycm93OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODMwLTE4MzEKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfc2NhbGVkX2JvcnJvdyhzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIGFtb3VudDogQmlnVUludCkgLT4gQmlnVUludDoKICAgIHByb3RvIDIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODMyLTE4MzQKICAgIC8vICMgU2FmZXR5IGNoZWNrOiBlbnN1cmUgYm9ycm93X2luZGV4IGlzIG5ldmVyIDAgdG8gcHJldmVudCBkaXZpc2lvbiBieSB6ZXJvCiAgICAvLyAjIElmIGJvcnJvd19pbmRleCBpcyAwLCBpbml0aWFsaXplIGl0IHRvIFNDQUxFICgxLjApCiAgICAvLyBib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgZnJhbWVfZGlnIC0yCiAgICBleHRyYWN0IDIwOSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODM1CiAgICAvLyBpZiBib3Jyb3dfaW5kZXggPT0gMDoKICAgIGJ5dGUgMHgKICAgIGI9PQogICAgYnogX2dldF9tYXJrZXRfc2NhbGVkX2JvcnJvd19hZnRlcl9pZl9lbHNlQDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTgzNgogICAgLy8gYm9ycm93X2luZGV4ID0gQmlnVUludChTQ0FMRSkKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBmcmFtZV9idXJ5IDAKCl9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3dfYWZ0ZXJfaWZfZWxzZUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODM3CiAgICAvLyByZXR1cm4gKGFtb3VudCAqIFNDQUxFKSAvLyBib3Jyb3dfaW5kZXgKICAgIGZyYW1lX2RpZyAtMQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIqCiAgICBmcmFtZV9kaWcgMAogICAgYi8KICAgIGZyYW1lX2RpZyAtMgogICAgdW5jb3ZlciAyCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZDogdWludDY0LCB1c2VyX2lkOiBieXRlcywgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93czoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE2Mi0xMTY1CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMyAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNjYKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNjcKICAgIC8vIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE2OAogICAgLy8gdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF91c2VyX2tleQogICAgY292ZXIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTY5CiAgICAvLyB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgZHVwCiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIC0xCiAgICBiKwogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDMyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNzAKICAgIC8vIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgZGlnIDEKICAgIGV4dHJhY3QgMjA5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgcmVwbGFjZTIgOTYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE3MQogICAgLy8gdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICByZXBsYWNlMiAxMjgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE3MgogICAgLy8gdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgc3dhcAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHJlcGxhY2UyIDEzNgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMzCiAgICAvLyBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIGJ5dGUgInVzZXJzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTczCiAgICAvLyBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICB1bmNvdmVyIDIKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2RlcG9zaXRfcHVyZSh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9kZXBvc2l0X3B1cmU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4NDgtMTg1MQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVwb3NpdF9wdXJlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODY0CiAgICAvLyBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIGludCAxCiAgICBjYWxsc3ViIF92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4NjUtMTg3MwogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gIyBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBtYXJrZXRfaWQKICAgIC8vICMgKS5kZXBvc2l0Lm5hdGl2ZQogICAgLy8gIyBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICMgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiRGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4NzQKICAgIC8vIG1hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRzID0gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRzKG1hcmtldCkKICAgIGNhbGxzdWIgX2dldF9tYXJrZXRfdW5kZXJseWluZ19kZXBvc2l0cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODc2CiAgICAvLyBtYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZSA+PSBtYXJrZXRfdW5kZXJseWluZ19kZXBvc2l0cyArIGFtb3VudAogICAgZHVwCiAgICBleHRyYWN0IDEgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBzd2FwCiAgICB1bmNvdmVyIDIKICAgIGZyYW1lX2RpZyAtMQogICAgYisKICAgIHVuY292ZXIgMgogICAgYjw9CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4NzUtMTg3NwogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBtYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZSA+PSBtYXJrZXRfdW5kZXJseWluZ19kZXBvc2l0cyArIGFtb3VudAogICAgLy8gKSwgIk1hcmtldCBkZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIGFzc2VydCAvLyBNYXJrZXQgZGVwb3NpdCBjYXAgZXhjZWVkZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg3OAogICAgLy8gc2NhbGVkX2Ftb3VudCA9IHNlbGYuX2dldF9tYXJrZXRfc2NhbGVkX2RlcG9zaXQobWFya2V0LCBhbW91bnQpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2dldF9tYXJrZXRfc2NhbGVkX2RlcG9zaXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg3OQogICAgLy8gZGVwb3NpdF92YWx1ZSA9IHNlbGYuX2dldF9tYXJrZXRfdmFsdWUobWFya2V0LCBhbW91bnQpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2dldF9tYXJrZXRfdmFsdWUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg4NAogICAgLy8gbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUsCiAgICBpbnQgMzEzCiAgICBpbnQgOAogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4ODAtMTg4OAogICAgLy8gc2VsZi5fY29sbGF0ZXJhbF9kZXBvc2l0X3B1cmUoCiAgICAvLyAgICAgdXNlcl9pZCwKICAgIC8vICAgICB1c2VyX2lkLAogICAgLy8gICAgIG1hcmtldF9pZCwKICAgIC8vICAgICBtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICBhbW91bnQsCiAgICAvLyAgICAgc2NhbGVkX2Ftb3VudCwKICAgIC8vICAgICBkZXBvc2l0X3ZhbHVlLAogICAgLy8gKQogICAgZnJhbWVfZGlnIC0zCiAgICBkdXAKICAgIGZyYW1lX2RpZyAtMgogICAgdW5jb3ZlciAzCiAgICBmcmFtZV9kaWcgLTEKICAgIHVuY292ZXIgNgogICAgdW5jb3ZlciA2CiAgICBjYWxsc3ViIF9jb2xsYXRlcmFsX2RlcG9zaXRfcHVyZQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMsIGd1YXJkX3N0b2tlbjogdWludDY0KSAtPiB2b2lkOgpfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcyMC0xNzIzCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQsIGd1YXJkX3N0b2tlbjogYm9vbAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMyAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MjQKICAgIC8vIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICBjYWxsc3ViIF9pc19wYXVzZWQKICAgICEKICAgIGFzc2VydCAvLyBQcm90b2NvbCBpcyBwYXVzZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMi0xNzI1CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9kYXRhLnByaWNlID09IG1hcmtldC5wcmljZSwgIlByaWNlIG1pc21hdGNoIgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc3VtZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXSA9IFByaWNlRmVlZCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wPVByaWNlV2l0aFRpbWVzdGFtcCgKICAgIC8vICAgICAgICAgICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICksCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZEF0dGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZC5uYXRpdmUsIHByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcmljZTogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgIyBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMTAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTUKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBwYXltZW50IDw9IDEwMDAwMDAKICAgIC8vICAgICApLCAicGF5bWVudCBleGNlZWRzIG1heGltdW0gZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTYKICAgIC8vICAgICBhcHAgPSBBcHBsaWNhdGlvbihzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gICAgIGl0eG4uUGF5bWVudChyZWNlaXZlcj1hcHAuYWRkcmVzcywgYW1vdW50PXBheW1lbnQsIGZlZT0wKS5zdWJtaXQoKQogICAgLy8gICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBQcmljZUZlZWRQcm92aWRlckludGVyZmFjZS5nZXRfcHJpY2Vfd2l0aF90aW1lc3RhbXAsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWFwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgICAgID4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICk6CiAgICAvLyAgICAgICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wID0gKAogICAgLy8gICAgICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAuY29weSgpCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZCwgcHJpY2Vfd2l0aF90aW1lc3RhbXAucHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlX21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9wYXVzZV9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBwYXVzZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3BhdXNlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5wYXVzZWQgPSBhcmM0LkJvb2wocGF1c2UgPT0gVUludDY0KDEpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzeW5jX21hcmtldChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXRpbGl6YXRpb24oc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhLCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQmlnVUludDoKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICByZXR1cm4gQmlnVUludCgxMDAwMCkgICMgMTAwJSB1dGlsaXphdGlvbiBmb3IgYm9ycm93LW9ubHkgbWFya2V0CiAgICAvLyAgICAgZWxpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gQmlnVUludCgwKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgICMgQWRkaXRpb25hbCBzYWZldHkgY2hlY2sgdG8gcHJldmVudCBkaXZpc2lvbiBieSB6ZXJvCiAgICAvLyAgICAgICAgIHRvdGFsX2RlcG9zaXRzID0gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdG90YWxfZGVwb3NpdHMgPT0gMDoKICAgIC8vICAgICAgICAgICAgIHJldHVybiBCaWdVSW50KDApCiAgICAvLyAgICAgICAgIHJldHVybiAobWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIDEwMDAwKSAvLyB0b3RhbF9kZXBvc2l0cwogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhLCB1dGlsaXphdGlvbjogQmlnVUludCwgdGltZV9kZWx0YTogVUludDY0CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gQmlnVUludCgwKQogICAgLy8gICAgIHJhdGUgPSBtYXJrZXQuYm9ycm93X3JhdGUubmF0aXZlICsgKG1hcmtldC5zbG9wZS5uYXRpdmUgKiB1dGlsaXphdGlvbikgLy8gMTAwMDAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBpbnRlcmVzdCBiYXNlZCBvbiBTQ0FMRUQgYm9ycm93cywgbm90IHVuZGVybHlpbmcKICAgIC8vICAgICAjIFRoaXMgcHJldmVudHMgZG91YmxlIGNvbXBvdW5kaW5nIGFuZCBtYWludGFpbnMgY29uc2lzdGVuY3kgd2l0aCB0aGUgYWNjb3VudGluZyBzeXN0ZW0KICAgIC8vICAgICByZXR1cm4gKHJhdGUgKiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdGltZV9kZWx0YSkgLy8gKAogICAgLy8gICAgICAgICBzZWxmLnNlY29uZHNfcGVyX3llYXIgKiAxMDAwMAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX2ludGVyZXN0X3NwbGl0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgc3Rva2VuX2FwcF9pZDogVUludDY0LAogICAgLy8gICAgIGludGVyZXN0OiBCaWdVSW50LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBVSW50NjQsCiAgICAvLyApIC0+IEludGVyZXN0U3BsaXQ6CiAgICAvLyAgICAgIyBTcGVjaWFsIGhhbmRsaW5nIGZvciBzdG9rZW4gbWFya2V0IC0gYWxsIGludGVyZXN0IGdvZXMgdG8gcmVzZXJ2ZXMKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBCaWdVSW50KDApCiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSAoaW50ZXJlc3QgKiByZXNlcnZlX2ZhY3RvcikgLy8gMTAwMDAKICAgIC8vICAgICAgICAgaWYgcHJvdG9jb2xfcG9ydGlvbiA+IGludGVyZXN0OgogICAgLy8gICAgICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IGludGVyZXN0CiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9wb3J0aW9uID0gaW50ZXJlc3QgLSBwcm90b2NvbF9wb3J0aW9uCiAgICAvLyAgICAgcmV0dXJuIEludGVyZXN0U3BsaXQoCiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9wb3J0aW9uPWFyYzQuVUludDI1NihkZXBvc2l0b3JfcG9ydGlvbiksCiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb249YXJjNC5VSW50MjU2KHByb3RvY29sX3BvcnRpb24pLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYWNjcnVlX2ludGVyZXN0KHNlbGYsIG1hcmtldF9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIEFjY3J1ZSBpbnRlcmVzdCBmb3IgYSBtYXJrZXQgYmFzZWQgb24gdGltZSBlbGFwc2VkIGFuZCB1dGlsaXphdGlvbi4KICAgIC8vICAgICAiIiIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICAgICBjdXJyZW50X3RpbWUgPSBHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcAogICAgLy8gICAgIHRpbWVfZGVsdGEgPSBjdXJyZW50X3RpbWUgLSBtYXJrZXQubGFzdF91cGRhdGVfdGltZS5uYXRpdmUKICAgIC8vICAgICBpZiB0aW1lX2RlbHRhIDw9IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIHV0aWxpemF0aW9uID0gc2VsZi5fY2FsY3VsYXRlX3V0aWxpemF0aW9uKG1hcmtldCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHV0aWxpemF0aW9uID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX2ludGVyZXN0KG1hcmtldCwgdXRpbGl6YXRpb24sIHRpbWVfZGVsdGEpCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIEludGVyZXN0IGRpc3RyaWJ1dGlvbgogICAgLy8gICAgIGludGVyZXN0X3NwbGl0ID0gc2VsZi5fY2FsY3VsYXRlX2ludGVyZXN0X3NwbGl0KAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIHNlbGYuc3Rva2VuX2FwcF9pZCwgaW50ZXJlc3QsIG1hcmtldC5yZXNlcnZlX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICAjIENoZWNrIGlmIHVzZXIgaW5kZXhlcyBjYW4gZ3JvdyBtZWFuaW5nZnVsbHkKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogcHJldmVudCBkaXZpc2lvbiBieSB6ZXJvIGZvciBmaXJzdCBkZXBvc2l0cy9ib3Jyb3dzCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX2luY3JlbWVudCA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBkZXBvc2l0b3JfaW5jcmVtZW50ID0gKGludGVyZXN0X3NwbGl0LmRlcG9zaXRvcl9wb3J0aW9uLm5hdGl2ZSAqIFNDQUxFKSAvLyAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIGJvcnJvd2VyX2luY3JlbWVudCA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3Jyb3dlcl9pbmNyZW1lbnQgPSAoaW50ZXJlc3QgKiBTQ0FMRSkgLy8gKAogICAgLy8gICAgICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBpZiBkZXBvc2l0b3JfaW5jcmVtZW50ID09IDAgb3IgYm9ycm93ZXJfaW5jcmVtZW50ID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgICMgbWFya2V0IGRlcG9zaXQgaW5kZXggdXBkYXRlIGRlcGVuZHMgb24gZGVwb3NpdG9yIHBvcnRpb24gb2YgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPiAwOgogICAgLy8gICAgICAgICBtYXJrZXQuZGVwb3NpdF9pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZSArIGRlcG9zaXRvcl9pbmNyZW1lbnQKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBtYXJrZXQgYm9ycm93IGluZGV4IHVwZGF0ZSBkZXBlbmRzIG9uIGZ1bGwgaW50ZXJlc3QgYW1vdW50CiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID4gMDoKICAgIC8vICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlICsgYm9ycm93ZXJfaW5jcmVtZW50CiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgICMgbWFya2V0IHRvdGFsIHNjYWxlZCBib3Jyb3dzIHVwZGF0ZSBkZXBlbmRzIG9uIGZ1bGwgaW50ZXJlc3QgYW1vdW50CiAgICAvLyAgICAgIyBDb252ZXJ0IGludGVyZXN0IHRvIHNjYWxlZCBib3Jyb3dzIHVzaW5nIGN1cnJlbnQgbWFya2V0IGluZGV4CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGVuc3VyZSBib3Jyb3dfaW5kZXggaXMgbmV2ZXIgMAogICAgLy8gICAgIGJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgaWYgYm9ycm93X2luZGV4ID09IDA6CiAgICAvLyAgICAgICAgIGJvcnJvd19pbmRleCA9IEJpZ1VJbnQoU0NBTEUpCiAgICAvLyAgICAgaW50ZXJlc3Rfc2NhbGVkX2JvcnJvd3MgPSAoaW50ZXJlc3QgKiBTQ0FMRSkgLy8gYm9ycm93X2luZGV4CiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgaW50ZXJlc3Rfc2NhbGVkX2JvcnJvd3MKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIG1hcmtldCB0b3RhbCBzY2FsZWQgZGVwb3NpdHMgdXBkYXRlIGRlcGVuZHMgb24gZGVwb3NpdG9yIHBvcnRpb24gb2YgaW50ZXJlc3QKICAgIC8vICAgICAjIENvbnZlcnQgZGVwb3NpdG9yIHBvcnRpb24gdG8gc2NhbGVkIGRlcG9zaXRzIHVzaW5nIGN1cnJlbnQgbWFya2V0IGluZGV4CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGVuc3VyZSBkZXBvc2l0X2luZGV4IGlzIG5ldmVyIDAKICAgIC8vICAgICBkZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgaWYgZGVwb3NpdF9pbmRleCA9PSAwOgogICAgLy8gICAgICAgICBkZXBvc2l0X2luZGV4ID0gQmlnVUludChTQ0FMRSkKICAgIC8vICAgICBkZXBvc2l0b3Jfc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgaW50ZXJlc3Rfc3BsaXQuZGVwb3NpdG9yX3BvcnRpb24ubmF0aXZlICogU0NBTEUKICAgIC8vICAgICApIC8vIGRlcG9zaXRfaW5kZXgKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGRlcG9zaXRvcl9zY2FsZWRfYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBtYXJrZXQgcmVzZXJ2ZXMgdXBkYXRlIGRlcGVuZHMgb24gcHJvdG9jb2wgcG9ydGlvbiBvZiBpbnRlcmVzdAogICAgLy8gICAgIG1hcmtldC5yZXNlcnZlcyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnJlc2VydmVzLm5hdGl2ZSArIGludGVyZXN0X3NwbGl0LnByb3RvY29sX3BvcnRpb24ubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChjdXJyZW50X3RpbWUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICMgVE9ETyBnb3Zlcm5hbmNlOiBjb25zaWRlciBpZiByZXNlcnZlIHdpdGhkcmF3YWwgc2hvdWxkIHJlcXVpcmUgYWRkaXRpb25hbAogICAgLy8gIyAgICAgIGdvdmVybmFuY2UgbWVjaGFuaXNtcwogICAgLy8gIyBUT0RPIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHM6IG1pZ2h0IHdhbnQgdG8gZW5mb3JjZSBtaW5pbXVtIHJlc2VydmUgbGV2ZWxzIGZvcgogICAgLy8gIyAgICAgIHByb3RvY29sIHNhZmV0eQogICAgLy8gIyBUT0RPIGV2ZW50IGVtaXNzaW9uOiBDb25zaWRlciBhZGRpbmcgYW4gZXZlbnQgdG8gbG9nIHJlc2VydmUgd2l0aGRyYXdhbHMgZm9yCiAgICAvLyAjICAgICAgdHJhbnNwYXJlbmN5CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHdpdGhkcmF3X3Jlc2VydmVzKHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3dpdGhkcmF3X3Jlc2VydmVzKG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3X3Jlc2VydmVzKHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICBzZWxmLl93aXRoZHJhd19yZXNlcnZlc19wdXJlKG1hcmtldF9pZCwgYW1vdW50KQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19yZXNlcnZlc19wdXJlKHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgbWFya2V0LnJlc2VydmVzLm5hdGl2ZSA+PSBhbW91bnQsICJJbnN1ZmZpY2llbnQgcmVzZXJ2ZXMiCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3Moc2VsZi5vd25lciksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24oCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCwgZ3VhcmRfc3Rva2VuOiBib29sCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGZyYW1lX2RpZyAtMwogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzItMTcyNQogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICMgICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICMgICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAjICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAjICAgICBlbHNlOgogICAgLy8gIyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAjICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICMgICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBkZWwgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWREZXRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgICMgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIGFzc2VydCBwcmljZSA+IDAsICJQcmljZSBtdXN0IGJlIHBvc2l0aXZlIgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgVW5wYXVzZSB0aGUgbWFya2V0IG9uIGZpcnN0IHByaWNlIHNldAogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQgYW5kIG1hcmtldC5wcmljZSA9PSAwOgogICAgLy8gICAgICAgICBtYXJrZXQucGF1c2VkID0gYXJjNC5Cb29sKEZhbHNlKQogICAgLy8gCiAgICAvLyAgICAgIyBTY2FsZSB0aGUgcHJpY2UgYnkgU0NBTEUgaW50ZXJuYWxseSBmb3Igc3RvcmFnZQogICAgLy8gICAgIG1hcmtldC5wcmljZSA9IGFyYzQuVUludDI1NihwcmljZSAqIFNDQUxFKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFByaWNlU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KHByaWNlKSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgc2VsZi5fZmV0Y2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2ZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDEwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS01CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgcGF5bWVudCA8PSAxMDAwMDAwCiAgICAvLyAgICAgKSwgInBheW1lbnQgZXhjZWVkcyBtYXhpbXVtIGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS02CiAgICAvLyAgICAgYXBwID0gQXBwbGljYXRpb24oc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vICAgICBpdHhuLlBheW1lbnQocmVjZWl2ZXI9YXBwLmFkZHJlc3MsIGFtb3VudD1wYXltZW50LCBmZWU9MCkuc3VibWl0KCkKICAgIC8vICAgICBwcmljZV93aXRoX3RpbWVzdGFtcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgUHJpY2VGZWVkUHJvdmlkZXJJbnRlcmZhY2UuZ2V0X3ByaWNlX3dpdGhfdGltZXN0YW1wLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIGlmICgKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICAgICA+IHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICApOgogICAgLy8gICAgICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcCA9ICgKICAgIC8vICAgICAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLmNvcHkoKQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQsIHByaWNlX3dpdGhfdGltZXN0YW1wLnByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fcGF1c2VfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgcGF1c2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9wYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0ucGF1c2VkID0gYXJjNC5Cb29sKHBhdXNlID09IFVJbnQ2NCgxKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY19tYXJrZXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX3V0aWxpemF0aW9uKHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgcmV0dXJuIEJpZ1VJbnQoMTAwMDApICAjIDEwMCUgdXRpbGl6YXRpb24gZm9yIGJvcnJvdy1vbmx5IG1hcmtldAogICAgLy8gICAgIGVsaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIEJpZ1VJbnQoMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICAjIEFkZGl0aW9uYWwgc2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgZGl2aXNpb24gYnkgemVybwogICAgLy8gICAgICAgICB0b3RhbF9kZXBvc2l0cyA9IG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHRvdGFsX2RlcG9zaXRzID09IDA6CiAgICAvLyAgICAgICAgICAgICByZXR1cm4gQmlnVUludCgwKQogICAgLy8gICAgICAgICByZXR1cm4gKG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiAxMDAwMCkgLy8gdG90YWxfZGVwb3NpdHMKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSwgdXRpbGl6YXRpb246IEJpZ1VJbnQsIHRpbWVfZGVsdGE6IFVJbnQ2NAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIEJpZ1VJbnQoMCkKICAgIC8vICAgICByYXRlID0gbWFya2V0LmJvcnJvd19yYXRlLm5hdGl2ZSArIChtYXJrZXQuc2xvcGUubmF0aXZlICogdXRpbGl6YXRpb24pIC8vIDEwMDAwCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgaW50ZXJlc3QgYmFzZWQgb24gU0NBTEVEIGJvcnJvd3MsIG5vdCB1bmRlcmx5aW5nCiAgICAvLyAgICAgIyBUaGlzIHByZXZlbnRzIGRvdWJsZSBjb21wb3VuZGluZyBhbmQgbWFpbnRhaW5zIGNvbnNpc3RlbmN5IHdpdGggdGhlIGFjY291bnRpbmcgc3lzdGVtCiAgICAvLyAgICAgcmV0dXJuIChyYXRlICogbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHRpbWVfZGVsdGEpIC8vICgKICAgIC8vICAgICAgICAgc2VsZi5zZWNvbmRzX3Blcl95ZWFyICogMTAwMDAKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV9pbnRlcmVzdF9zcGxpdCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIG1hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBpbnRlcmVzdDogQmlnVUludCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogVUludDY0LAogICAgLy8gKSAtPiBJbnRlcmVzdFNwbGl0OgogICAgLy8gICAgICMgU3BlY2lhbCBoYW5kbGluZyBmb3Igc3Rva2VuIG1hcmtldCAtIGFsbCBpbnRlcmVzdCBnb2VzIHRvIHJlc2VydmVzCiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9wb3J0aW9uID0gQmlnVUludCgwKQogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gaW50ZXJlc3QKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gKGludGVyZXN0ICogcmVzZXJ2ZV9mYWN0b3IpIC8vIDEwMDAwCiAgICAvLyAgICAgICAgIGlmIHByb3RvY29sX3BvcnRpb24gPiBpbnRlcmVzdDoKICAgIC8vICAgICAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IGludGVyZXN0IC0gcHJvdG9jb2xfcG9ydGlvbgogICAgLy8gICAgIHJldHVybiBJbnRlcmVzdFNwbGl0KAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbj1hcmM0LlVJbnQyNTYoZGVwb3NpdG9yX3BvcnRpb24pLAogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uPWFyYzQuVUludDI1Nihwcm90b2NvbF9wb3J0aW9uKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2FjY3J1ZV9pbnRlcmVzdChzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBBY2NydWUgaW50ZXJlc3QgZm9yIGEgbWFya2V0IGJhc2VkIG9uIHRpbWUgZWxhcHNlZCBhbmQgdXRpbGl6YXRpb24uCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgY3VycmVudF90aW1lID0gR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAKICAgIC8vICAgICB0aW1lX2RlbHRhID0gY3VycmVudF90aW1lIC0gbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUubmF0aXZlCiAgICAvLyAgICAgaWYgdGltZV9kZWx0YSA8PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICAgICB1dGlsaXphdGlvbiA9IHNlbGYuX2NhbGN1bGF0ZV91dGlsaXphdGlvbihtYXJrZXQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1dGlsaXphdGlvbiA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV9pbnRlcmVzdChtYXJrZXQsIHV0aWxpemF0aW9uLCB0aW1lX2RlbHRhKQogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBJbnRlcmVzdCBkaXN0cmlidXRpb24KICAgIC8vICAgICBpbnRlcmVzdF9zcGxpdCA9IHNlbGYuX2NhbGN1bGF0ZV9pbnRlcmVzdF9zcGxpdCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkLCBzZWxmLnN0b2tlbl9hcHBfaWQsIGludGVyZXN0LCBtYXJrZXQucmVzZXJ2ZV9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyAgICAgIyBDaGVjayBpZiB1c2VyIGluZGV4ZXMgY2FuIGdyb3cgbWVhbmluZ2Z1bGx5CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IHByZXZlbnQgZGl2aXNpb24gYnkgemVybyBmb3IgZmlyc3QgZGVwb3NpdHMvYm9ycm93cwogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9pbmNyZW1lbnQgPSBCaWdVSW50KDApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX2luY3JlbWVudCA9IChpbnRlcmVzdF9zcGxpdC5kZXBvc2l0b3JfcG9ydGlvbi5uYXRpdmUgKiBTQ0FMRSkgLy8gKAogICAgLy8gICAgICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICBib3Jyb3dlcl9pbmNyZW1lbnQgPSBCaWdVSW50KDApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm9ycm93ZXJfaW5jcmVtZW50ID0gKGludGVyZXN0ICogU0NBTEUpIC8vICgKICAgIC8vICAgICAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgaWYgZGVwb3NpdG9yX2luY3JlbWVudCA9PSAwIG9yIGJvcnJvd2VyX2luY3JlbWVudCA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICAgICAjIG1hcmtldCBkZXBvc2l0IGluZGV4IHVwZGF0ZSBkZXBlbmRzIG9uIGRlcG9zaXRvciBwb3J0aW9uIG9mIGludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID4gMDoKICAgIC8vICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXggPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUgKyBkZXBvc2l0b3JfaW5jcmVtZW50CiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgICMgbWFya2V0IGJvcnJvdyBpbmRleCB1cGRhdGUgZGVwZW5kcyBvbiBmdWxsIGludGVyZXN0IGFtb3VudAogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXggPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZSArIGJvcnJvd2VyX2luY3JlbWVudAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIG1hcmtldCB0b3RhbCBzY2FsZWQgYm9ycm93cyB1cGRhdGUgZGVwZW5kcyBvbiBmdWxsIGludGVyZXN0IGFtb3VudAogICAgLy8gICAgICMgQ29udmVydCBpbnRlcmVzdCB0byBzY2FsZWQgYm9ycm93cyB1c2luZyBjdXJyZW50IG1hcmtldCBpbmRleAogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBlbnN1cmUgYm9ycm93X2luZGV4IGlzIG5ldmVyIDAKICAgIC8vICAgICBib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgIGlmIGJvcnJvd19pbmRleCA9PSAwOgogICAgLy8gICAgICAgICBib3Jyb3dfaW5kZXggPSBCaWdVSW50KFNDQUxFKQogICAgLy8gICAgIGludGVyZXN0X3NjYWxlZF9ib3Jyb3dzID0gKGludGVyZXN0ICogU0NBTEUpIC8vIGJvcnJvd19pbmRleAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGludGVyZXN0X3NjYWxlZF9ib3Jyb3dzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBtYXJrZXQgdG90YWwgc2NhbGVkIGRlcG9zaXRzIHVwZGF0ZSBkZXBlbmRzIG9uIGRlcG9zaXRvciBwb3J0aW9uIG9mIGludGVyZXN0CiAgICAvLyAgICAgIyBDb252ZXJ0IGRlcG9zaXRvciBwb3J0aW9uIHRvIHNjYWxlZCBkZXBvc2l0cyB1c2luZyBjdXJyZW50IG1hcmtldCBpbmRleAogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBlbnN1cmUgZGVwb3NpdF9pbmRleCBpcyBuZXZlciAwCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgIGlmIGRlcG9zaXRfaW5kZXggPT0gMDoKICAgIC8vICAgICAgICAgZGVwb3NpdF9pbmRleCA9IEJpZ1VJbnQoU0NBTEUpCiAgICAvLyAgICAgZGVwb3NpdG9yX3NjYWxlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIGludGVyZXN0X3NwbGl0LmRlcG9zaXRvcl9wb3J0aW9uLm5hdGl2ZSAqIFNDQUxFCiAgICAvLyAgICAgKSAvLyBkZXBvc2l0X2luZGV4CiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBkZXBvc2l0b3Jfc2NhbGVkX2Ftb3VudAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgbWFya2V0IHJlc2VydmVzIHVwZGF0ZSBkZXBlbmRzIG9uIHByb3RvY29sIHBvcnRpb24gb2YgaW50ZXJlc3QKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgKyBpbnRlcmVzdF9zcGxpdC5wcm90b2NvbF9wb3J0aW9uLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoY3VycmVudF90aW1lKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAjIFRPRE8gZ292ZXJuYW5jZTogY29uc2lkZXIgaWYgcmVzZXJ2ZSB3aXRoZHJhd2FsIHNob3VsZCByZXF1aXJlIGFkZGl0aW9uYWwKICAgIC8vICMgICAgICBnb3Zlcm5hbmNlIG1lY2hhbmlzbXMKICAgIC8vICMgVE9ETyBtaW5pbXVtIHJlc2VydmUgbGV2ZWxzOiBtaWdodCB3YW50IHRvIGVuZm9yY2UgbWluaW11bSByZXNlcnZlIGxldmVscyBmb3IKICAgIC8vICMgICAgICBwcm90b2NvbCBzYWZldHkKICAgIC8vICMgVE9ETyBldmVudCBlbWlzc2lvbjogQ29uc2lkZXIgYWRkaW5nIGFuIGV2ZW50IHRvIGxvZyByZXNlcnZlIHdpdGhkcmF3YWxzIGZvcgogICAgLy8gIyAgICAgIHRyYW5zcGFyZW5jeQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl93aXRoZHJhd19yZXNlcnZlcyhtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgc2VsZi5fd2l0aGRyYXdfcmVzZXJ2ZXNfcHVyZShtYXJrZXRfaWQsIGFtb3VudCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcmVzZXJ2ZXNfcHVyZShzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgPj0gYW1vdW50LCAiSW5zdWZmaWNpZW50IHJlc2VydmVzIgogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5yZXNlcnZlcyA9IGFyYzQuVUludDI1NihtYXJrZXQucmVzZXJ2ZXMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQsIGd1YXJkX3N0b2tlbjogYm9vbAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBzd2FwCiAgICBjb25jYXQKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzI1CiAgICAvLyBhc3NlcnQgbWFya2V0X2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGFzc2VydCAvLyBNYXJrZXQgZG9lcyBub3QgZXhpc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcyNgogICAgLy8gYXNzZXJ0IGFtb3VudCA+IDAsICJBbW91bnQgbXVzdCBiZSA+IDAiCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ5dGUgMHgKICAgIGI+CiAgICBhc3NlcnQgLy8gQW1vdW50IG11c3QgYmUgPiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MjcKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MjgKICAgIC8vIGFzc2VydCBub3QgbWFya2V0LnBhdXNlZCwgIk1hcmtldCBpcyBwYXVzZWQiCiAgICBpbnQgMAogICAgZ2V0Yml0CiAgICBieXRlIDB4MDAKICAgIGludCAwCiAgICB1bmNvdmVyIDIKICAgIHNldGJpdAogICAgYnl0ZSAweDAwCiAgICA9PQogICAgYXNzZXJ0IC8vIE1hcmtldCBpcyBwYXVzZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcyOQogICAgLy8gaWYgZ3VhcmRfc3Rva2VuOgogICAgZnJhbWVfZGlnIC0xCiAgICBieiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbl9hZnRlcl9pZl9lbHNlQDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTczMQogICAgLy8gc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMAogICAgLy8gc2VsZi5zdG9rZW5fYXBwX2lkID0gVUludDY0KCkgICMgc3RhYmxlIG1hcmtldAogICAgYnl0ZSAic3Rva2VuX2FwcF9pZCIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTczMQogICAgLy8gc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnN0b2tlbl9hcHBfaWQgZXhpc3RzCiAgICBmcmFtZV9kaWcgLTMKICAgICE9CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MzAtMTczMgogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgIT0gbWFya2V0X2lkCiAgICAvLyApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGZvciB0aGlzIG9wZXJhdGlvbiIKICAgIGFzc2VydCAvLyBDYW5ub3QgdXNlIHN0b2tlbiBtYXJrZXQgZm9yIHRoaXMgb3BlcmF0aW9uCgpfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbl9hZnRlcl9pZl9lbHNlQDI6CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRzKG1hcmtldDogYnl0ZXMpIC0+IGJ5dGVzLCBieXRlczoKX2dldF9tYXJrZXRfdW5kZXJseWluZ19kZXBvc2l0czoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc5NS0xNzk2CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdHMoc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhKSAtPiBCaWdVSW50OgogICAgcHJvdG8gMSAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3OTgKICAgIC8vIG1hcmtldCwgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMQogICAgZXh0cmFjdCAxMTMgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3OTctMTc5OQogICAgLy8gcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdW5kZXJseWluZ19kZXBvc2l0X2Ftb3VudCgKICAgIC8vICAgICBtYXJrZXQsIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTEKICAgIHN3YXAKICAgIGNhbGxzdWIgX2dldF9tYXJrZXRfdW5kZXJseWluZ19kZXBvc2l0X2Ftb3VudAogICAgZHVwCiAgICBmcmFtZV9idXJ5IC0xCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRfYW1vdW50KG1hcmtldDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IGJ5dGVzLCBieXRlczoKX2dldF9tYXJrZXRfdW5kZXJseWluZ19kZXBvc2l0X2Ftb3VudDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTgwNy0xODEwCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdF9hbW91bnQoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhLCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIHByb3RvIDIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODExCiAgICAvLyByZXR1cm4gKGFtb3VudCAqIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZSkgLy8gU0NBTEUKICAgIGZyYW1lX2RpZyAtMgogICAgZXh0cmFjdCAxNzcgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgLTEKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIGZyYW1lX2RpZyAtMgogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2NvbGxhdGVyYWxfZGVwb3NpdF9wdXJlKHVzZXJfaWQ6IGJ5dGVzLCBiZW5lZmljaWFyeV9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0LCBudG9rZW5faWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcywgc2NhbGVkX2Ftb3VudDogYnl0ZXMsIHZhbHVlOiBieXRlcykgLT4gdm9pZDoKX2NvbGxhdGVyYWxfZGVwb3NpdF9wdXJlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDI0LTIwMzQKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NvbGxhdGVyYWxfZGVwb3NpdF9wdXJlKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBiZW5lZmljaWFyeV9pZDogQWNjb3VudCwKICAgIC8vICAgICBtYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBudG9rZW5faWQ6IFVJbnQ2NCwKICAgIC8vICAgICBhbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgc2NhbGVkX2Ftb3VudDogQmlnVUludCwKICAgIC8vICAgICB2YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDcgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDM1LTIwNDEKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDM4CiAgICAvLyBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICBnbG9iYWwgQ3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDM5CiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMwogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGZyYW1lX2RpZyAtMwogICAgZGlnIDEKICAgIGJ8CiAgICBmcmFtZV9kaWcgLTUKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDM1LTIwNDEKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgbWV0aG9kICJhcmMyMDBfdHJhbnNmZXJGcm9tKGFkZHJlc3MsYWRkcmVzcyx1aW50MjU2KWJvb2wiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgZnJhbWVfZGlnIC03CiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgdW5jb3ZlciAyCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGV4dHJhY3QgMCA0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgID09CiAgICBhc3NlcnQgLy8gQVJDNCBwcmVmaXggaXMgdmFsaWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA0Mi0yMDQ3CiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIE5Ub2tlbi5taW50LAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyhiZW5lZmljaWFyeV9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KHNjYWxlZF9hbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihudG9rZW5faWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDQ1CiAgICAvLyBhcmM0LlVJbnQyNTYoc2NhbGVkX2Ftb3VudCksCiAgICBmcmFtZV9kaWcgLTIKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBmcmFtZV9kaWcgLTIKICAgIGJ8CiAgICBmcmFtZV9kaWcgLTQKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDQyLTIwNDcKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKGJlbmVmaWNpYXJ5X2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoc2NhbGVkX2Ftb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG50b2tlbl9pZCksCiAgICAvLyApCiAgICBtZXRob2QgIm1pbnQoYWRkcmVzcyx1aW50MjU2KXZvaWQiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgZnJhbWVfZGlnIC02CiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNDgtMjA1MAogICAgLy8gc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBtYXJrZXRfaWQsIGJlbmVmaWNpYXJ5X2lkLCBzY2FsZWRfYW1vdW50CiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTUKICAgIGZyYW1lX2RpZyAtNgogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNTEKICAgIC8vIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIGZyYW1lX2RpZyAtNQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDUyCiAgICAvLyBzZWxmLl9pbmNyZW1lbnRfZ2xvYmFsX2NvbGxhdGVyYWwoYmVuZWZpY2lhcnlfaWQsIHZhbHVlKQogICAgZnJhbWVfZGlnIC02CiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2luY3JlbWVudF9nbG9iYWxfY29sbGF0ZXJhbAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZDogdWludDY0LCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0ODUtMTQ4OAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0ODkKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0OTEKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50CiAgICBkdXAKICAgIGV4dHJhY3QgMTEzIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIC0xCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDkwLTE0OTIKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXBsYWNlMiAxMTMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ5MwogICAgLy8gbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGl0b2IKICAgIHJlcGxhY2UyIDI0MQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDk0CiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIGZyYW1lX2RpZyAtMgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0OTQKICAgIC8vIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgc3dhcAogICAgY29uY2F0CiAgICBzd2FwCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5faW5jcmVtZW50X2dsb2JhbF9jb2xsYXRlcmFsKHVzZXJfaWQ6IGJ5dGVzLCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpfaW5jcmVtZW50X2dsb2JhbF9jb2xsYXRlcmFsOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTAyLTI1MDcKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MDgtMjUxMgogICAgLy8gc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgIHVzZXJfaWQsCiAgICAvLyAgICAgQmlnVUludCgwKSwKICAgIC8vICAgICBhbW91bnQsCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUxMAogICAgLy8gQmlnVUludCgwKSwKICAgIGJ5dGUgMHgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUwOC0yNTEyCiAgICAvLyBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgdXNlcl9pZCwKICAgIC8vICAgICBCaWdVSW50KDApLAogICAgLy8gICAgIGFtb3VudCwKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiBieXRlcykgLT4gYnl0ZXM6CmNhbGN1bGF0ZV91c2VyX2ludGVyZXN0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTI0LTE5MjcKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNhbGN1bGF0ZV91c2VyX2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBhcmM0LlVJbnQyNTY6CiAgICBwcm90byAyIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkyOAogICAgLy8gZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICBpbnQgNzAwCiAgICBpbnQgMAogICAgY2FsbHN1YiBlbnN1cmVfYnVkZ2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MzAKICAgIC8vIHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTIKICAgIHN3YXAKICAgIGNhbGxzdWIgX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MjktMTkzMQogICAgLy8gcmV0dXJuIGFyYzQuVUludDI1NigKICAgIC8vICAgICBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0KSAtPiBieXRlczoKX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTMzLTE5MzQKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCaWdVSW50OgogICAgcHJvdG8gMiAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MzYKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MzcKICAgIC8vIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkzOAogICAgLy8gaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGEodXNlciwgbWFya2V0KQogICAgc3dhcAogICAgY2FsbHN1YiBfY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3Rfd2l0aF9kYXRhCiAgICBwb3BuIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkzOQogICAgLy8gcmV0dXJuIGludGVyZXN0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IGJ5dGVzKSAtPiBieXRlczoKY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk3Mi0xOTc1CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBhcmM0LlVJbnQyNTY6CiAgICBwcm90byAyIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk3NgogICAgLy8gZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICBpbnQgNzAwCiAgICBpbnQgMAogICAgY2FsbHN1YiBlbnN1cmVfYnVkZ2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NzgKICAgIC8vIHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ0b2kKICAgIGZyYW1lX2RpZyAtMgogICAgc3dhcAogICAgY2FsbHN1YiBfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTc3LTE5NzkKICAgIC8vIHJldHVybiBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQpIC0+IGJ5dGVzOgpfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk4MS0xOTg0CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICBwcm90byAyIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk4NgogICAgLy8gbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk4NwogICAgLy8gdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9nZXRfdXNlcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTg4CiAgICAvLyBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhKHVzZXIsIG1hcmtldCkKICAgIHN3YXAKICAgIGNhbGxzdWIgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhCiAgICBwb3BuIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk4OQogICAgLy8gcmV0dXJuIGludGVyZXN0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC53aXRoZHJhdyhtYXJrZXRfaWQ6IGJ5dGVzLCBhbW91bnQ6IGJ5dGVzKSAtPiBieXRlczoKd2l0aGRyYXc6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMTktMjAyMAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgd2l0aGRyYXcoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IGFyYzQuVUludDI1NjoKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDIxCiAgICAvLyBlbnN1cmVfYnVkZ2V0KDI4MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICBpbnQgMjgwMAogICAgaW50IDAKICAgIGNhbGxzdWIgZW5zdXJlX2J1ZGdldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDIyCiAgICAvLyByZXR1cm4gYXJjNC5VSW50MjU2KHNlbGYuX3dpdGhkcmF3KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpKQogICAgdHhuIFNlbmRlcgogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX3dpdGhkcmF3CiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBifAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3dpdGhkcmF3KHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcykgLT4gYnl0ZXM6Cl93aXRoZHJhdzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE4OS0yMTkyCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhdygKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICBwcm90byAzIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE5MwogICAgLy8gc2VsZi5fc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE5NAogICAgLy8gcmV0dXJuIHNlbGYuX3dpdGhkcmF3X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF93aXRoZHJhd19wdXJlCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fd2l0aGRyYXdfcHVyZSh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IGJ5dGVzOgpfd2l0aGRyYXdfcHVyZToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjEwNC0yMTA3CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19wdXJlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIHByb3RvIDMgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTExCiAgICAvLyBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIGludCAxCiAgICBjYWxsc3ViIF92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxMjIKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxMjMKICAgIC8vIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjEyNgogICAgLy8gYW1vdW50IDw9IHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIC0xCiAgICBiPj0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjEyNS0yMTI3CiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIGFtb3VudCA8PSB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIGFzc2VydCAvLyBJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTI5LTIxMzEKICAgIC8vICMgQ2FsY3VsYXRlIHRoZSBhY3R1YWwgdW5kZXJseWluZyBhbW91bnQgdG8gdHJhbnNmZXIgdG8gdXNlcgogICAgLy8gIyBhbW91bnQgaXMgdGhlIHNjYWxlZCBhbW91bnQgKG5Ub2tlbnMpLCB3ZSBuZWVkIHRvIGNvbnZlcnQgdG8gdW5kZXJseWluZwogICAgLy8gdW5kZXJseWluZ19hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdF9hbW91bnQobWFya2V0LCBhbW91bnQpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2dldF9tYXJrZXRfdW5kZXJseWluZ19kZXBvc2l0X2Ftb3VudAogICAgc3dhcAogICAgZHVwCiAgICB1bmNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjEzMwogICAgLy8gdW5kZXJseWluZ192YWx1ZSA9IHNlbGYuX2dldF9tYXJrZXRfdmFsdWUobWFya2V0LCB1bmRlcmx5aW5nX2Ftb3VudCkKICAgIHN3YXAKICAgIGNhbGxzdWIgX2dldF9tYXJrZXRfdmFsdWUKICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjEzNQogICAgLy8gZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X2dsb2JhbF91c2VyCiAgICBkdXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjEzNy0yMTM5CiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIyBoZWFsdGggY2hlY2s6IGVuc3VyZSB3aXRoZHJhdyB3b3VsZCBub3QgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gaWYgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlID4gMDoKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICBiPgogICAgYnogX3dpdGhkcmF3X3B1cmVfYWZ0ZXJfaWZfZWxzZUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNDEKICAgIC8vIHVuZGVybHlpbmdfdmFsdWUgPD0gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIGZyYW1lX2RpZyAzCiAgICBleHRyYWN0IDAgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgMgogICAgZHVwCiAgICBjb3ZlciAyCiAgICBkaWcgMQogICAgYjw9CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNDAtMjE0MgogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICB1bmRlcmx5aW5nX3ZhbHVlIDw9IGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlCiAgICAvLyApLCAiV2l0aGRyYXdhbCBwdXRzIHVzZXIgYXQgcmlzayBvZiBsaXF1aWRhdGlvbiIKICAgIGFzc2VydCAvLyBXaXRoZHJhd2FsIHB1dHMgdXNlciBhdCByaXNrIG9mIGxpcXVpZGF0aW9uCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNDMtMjE0NQogICAgLy8gcmVtYWluaW5nX2NvbGxhdGVyYWwgPSAoCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSB1bmRlcmx5aW5nX3ZhbHVlCiAgICAvLyApCiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNDQKICAgIC8vIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gdW5kZXJseWluZ192YWx1ZQogICAgYi0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE0NwogICAgLy8gcmVtYWluaW5nX2NvbGxhdGVyYWwgKiBCaWdVSW50KG1hcmtldC5jb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUpCiAgICBmcmFtZV9kaWcgMQogICAgZXh0cmFjdCA3MyA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgaXRvYgogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE0OAogICAgLy8gKSAvLyBCaWdVSW50KDEwMDAwKSwgIldpdGhkcmF3YWwgcHV0cyB1c2VyIGF0IHJpc2sgb2YgbGlxdWlkYXRpb24iCiAgICBieXRlIDB4MjcxMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTQ2LTIxNDgKICAgIC8vIGFzc2VydCBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIDw9ICgKICAgIC8vICAgICByZW1haW5pbmdfY29sbGF0ZXJhbCAqIEJpZ1VJbnQobWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICkgLy8gQmlnVUludCgxMDAwMCksICJXaXRoZHJhd2FsIHB1dHMgdXNlciBhdCByaXNrIG9mIGxpcXVpZGF0aW9uIgogICAgYi8KICAgIGZyYW1lX2RpZyA0CiAgICBiPj0KICAgIGFzc2VydCAvLyBXaXRoZHJhd2FsIHB1dHMgdXNlciBhdCByaXNrIG9mIGxpcXVpZGF0aW9uCgpfd2l0aGRyYXdfcHVyZV9hZnRlcl9pZl9lbHNlQDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNzIKICAgIC8vIG1hcmtldC5udG9rZW5faWQubmF0aXZlLAogICAgZnJhbWVfZGlnIDEKICAgIGludCAzMTMKICAgIGludCA4CiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE2OC0yMTc2CiAgICAvLyBzZWxmLl9jb2xsYXRlcmFsX3dpdGhkcmF3X3B1cmUoCiAgICAvLyAgICAgdXNlcl9pZCwKICAgIC8vICAgICB1c2VyX2lkLAogICAgLy8gICAgIG1hcmtldF9pZCwKICAgIC8vICAgICBtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICB1bmRlcmx5aW5nX2Ftb3VudCwKICAgIC8vICAgICBhbW91bnQsCiAgICAvLyAgICAgdW5kZXJseWluZ192YWx1ZSwKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMwogICAgZHVwCiAgICBmcmFtZV9kaWcgLTIKICAgIHVuY292ZXIgMwogICAgZnJhbWVfZGlnIDAKICAgIGR1cAogICAgY292ZXIgNQogICAgZnJhbWVfZGlnIC0xCiAgICBmcmFtZV9kaWcgMgogICAgY2FsbHN1YiBfY29sbGF0ZXJhbF93aXRoZHJhd19wdXJlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxODcKICAgIC8vIHJldHVybiB1bmRlcmx5aW5nX2Ftb3VudAogICAgZnJhbWVfYnVyeSAwCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fY29sbGF0ZXJhbF93aXRoZHJhd19wdXJlKHVzZXJfaWQ6IGJ5dGVzLCBiZW5lZmljaWFyeV9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0LCBudG9rZW5faWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcywgc2NhbGVkX2Ftb3VudDogYnl0ZXMsIHZhbHVlOiBieXRlcykgLT4gdm9pZDoKX2NvbGxhdGVyYWxfd2l0aGRyYXdfcHVyZToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA1NC0yMDY0CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jb2xsYXRlcmFsX3dpdGhkcmF3X3B1cmUoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGJlbmVmaWNpYXJ5X2lkOiBBY2NvdW50LAogICAgLy8gICAgIG1hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIG50b2tlbl9pZDogVUludDY0LAogICAgLy8gICAgIGFtb3VudDogQmlnVUludCwKICAgIC8vICAgICBzY2FsZWRfYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHZhbHVlOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gNyAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwODgtMjA5MwogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoc2NhbGVkX2Ftb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG50b2tlbl9pZCksCiAgICAvLyApCiAgICBpdHhuX2JlZ2luCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwOTEKICAgIC8vIGFyYzQuVUludDI1NihzY2FsZWRfYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMgogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGZyYW1lX2RpZyAtMgogICAgZGlnIDEKICAgIGJ8CiAgICBmcmFtZV9kaWcgLTQKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDg4LTIwOTMKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgTlRva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KHNjYWxlZF9hbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihudG9rZW5faWQpLAogICAgLy8gKQogICAgbWV0aG9kICJidXJuX2Zyb20oYWRkcmVzcyx1aW50MjU2KXZvaWQiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgZnJhbWVfZGlnIC03CiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwOTQKICAgIC8vIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCB1c2VyX2lkLCBzY2FsZWRfYW1vdW50KQogICAgZnJhbWVfZGlnIC01CiAgICBmcmFtZV9kaWcgLTcKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDk1CiAgICAvLyBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICBmcmFtZV9kaWcgLTUKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA5Ni0yMTAxCiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICBhcmM0LkFkZHJlc3MoYmVuZWZpY2lhcnlfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDk5CiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMwogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGZyYW1lX2RpZyAtMwogICAgYnwKICAgIGZyYW1lX2RpZyAtNQogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwOTYtMjEwMQogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKGJlbmVmaWNpYXJ5X2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICkKICAgIG1ldGhvZCAiYXJjMjAwX3RyYW5zZmVyKGFkZHJlc3MsdWludDI1Nilib29sIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGZyYW1lX2RpZyAtNgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgaXR4biBMYXN0TG9nCiAgICBleHRyYWN0IDAgNAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICA9PQogICAgYXNzZXJ0IC8vIEFSQzQgcHJlZml4IGlzIHZhbGlkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxMDIKICAgIC8vIHNlbGYuX2RlY3JlbWVudF9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCB2YWx1ZSkKICAgIGZyYW1lX2RpZyAtNwogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9kZWNyZW1lbnRfZ2xvYmFsX2NvbGxhdGVyYWwKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZDogdWludDY0LCB1c2VyX2lkOiBieXRlcywgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNzUtMTE3OAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAzIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE3OQogICAgLy8gbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE4MAogICAgLy8gdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfdXNlcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTgxCiAgICAvLyB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X3VzZXJfa2V5CiAgICBjb3ZlciAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExODMKICAgIC8vIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIGR1cAogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9kaWcgLTEKICAgIGI+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTgyLTExODQKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgYXNzZXJ0IC8vIEluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExODUKICAgIC8vIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIGZyYW1lX2RpZyAtMQogICAgYi0KICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXBsYWNlMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExODYKICAgIC8vIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICBkaWcgMQogICAgZXh0cmFjdCAxNzcgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICByZXBsYWNlMiA2NAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTg3CiAgICAvLyB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGl0b2IKICAgIHJlcGxhY2UyIDEyOAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTg4CiAgICAvLyB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICBzd2FwCiAgICBpbnQgMjgxCiAgICBpbnQgMzIKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgcmVwbGFjZTIgMTM2CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzMKICAgIC8vIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgYnl0ZSAidXNlcnMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExODkKICAgIC8vIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIHVuY292ZXIgMgogICAgY29uY2F0CiAgICBzd2FwCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0czoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ5Ni0xNDk5CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUwMAogICAgLy8gbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUwMgogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICBkdXAKICAgIGV4dHJhY3QgMTEzIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9kaWcgLTEKICAgIGI+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTAxLTE1MDMKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICBhc3NlcnQgLy8gSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUwNQogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQKICAgIGZyYW1lX2RpZyAtMQogICAgYi0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUwNC0xNTA2CiAgICAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50CiAgICAvLyApCiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBifAogICAgcmVwbGFjZTIgMTEzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MDcKICAgIC8vIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgZnJhbWVfZGlnIC0yCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzIKICAgIC8vIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgYnl0ZSAibWFya2V0cyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUwNwogICAgLy8gc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBzd2FwCiAgICBjb25jYXQKICAgIHN3YXAKICAgIGJveF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9kZWNyZW1lbnRfZ2xvYmFsX2NvbGxhdGVyYWwodXNlcl9pZDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9kZWNyZW1lbnRfZ2xvYmFsX2NvbGxhdGVyYWw6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MTQtMjUxOQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBhbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUyMC0yNTI0CiAgICAvLyBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgdXNlcl9pZCwKICAgIC8vICAgICBhbW91bnQsCiAgICAvLyAgICAgQmlnVUludCgwKSwKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MjMKICAgIC8vIEJpZ1VJbnQoMCksCiAgICBieXRlIDB4CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MjAtMjUyNAogICAgLy8gc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgIHVzZXJfaWQsCiAgICAvLyAgICAgYW1vdW50LAogICAgLy8gICAgIEJpZ1VJbnQoMCksCiAgICAvLyApCiAgICBjYWxsc3ViIF91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLmJvcnJvdyhtYXJrZXRfaWQ6IGJ5dGVzLCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpib3Jyb3c6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxOTYtMjE5NwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYm9ycm93KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxOTgKICAgIC8vIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIGludCAyODAwCiAgICBpbnQgMAogICAgY2FsbHN1YiBlbnN1cmVfYnVkZ2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxOTkKICAgIC8vIHNlbGYuX2JvcnJvdyhUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgdHhuIFNlbmRlcgogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2JvcnJvdwogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2JvcnJvdyh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9ib3Jyb3c6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyODAtMjI4MQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYm9ycm93KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICBwcm90byAzIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjI4MgogICAgLy8gc2VsZi5fc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjI4MwogICAgLy8gc2VsZi5fYm9ycm93X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9ib3Jyb3dfcHVyZQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2JvcnJvd19wdXJlKHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2JvcnJvd19wdXJlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjAxLTIyMDQKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2JvcnJvd19wdXJlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgaW50IDAKICAgIGR1cAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjA1CiAgICAvLyBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBGYWxzZSkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBpbnQgMAogICAgY2FsbHN1YiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjE2CiAgICAvLyBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KHVzZXJfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgcmVxdWlyZV9wYXltZW50CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyMTcKICAgIC8vIGFzc2VydCBwYXltZW50ID49IFVJbnQ2NCgxMDAwMDApLCAiUGF5bWVudCBhbW91bnQgbXVzdCBiZSA+PSAwLjEiCiAgICBpbnQgMTAwMDAwCiAgICA+PQogICAgYXNzZXJ0IC8vIFBheW1lbnQgYW1vdW50IG11c3QgYmUgPj0gMC4xCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyMTkKICAgIC8vIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjIyMAogICAgLy8gbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjIyMi0yMjIzCiAgICAvLyAjIENhbGN1bGF0ZSBjdXJyZW50IG1hcmtldCB0b3RhbCBib3Jyb3dzIChpbmNsdWRpbmcgaW50ZXJlc3QpCiAgICAvLyBtYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzID0gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd3MobWFya2V0KQogICAgY2FsbHN1YiBfZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd3MKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjIyNwogICAgLy8gbWFya2V0Lm1heF90b3RhbF9ib3Jyb3dzLm5hdGl2ZSA+PSBtYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzICsgYW1vdW50CiAgICBkdXAKICAgIGV4dHJhY3QgMzMgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBzd2FwCiAgICB1bmNvdmVyIDIKICAgIGZyYW1lX2RpZyAtMQogICAgYisKICAgIHVuY292ZXIgMgogICAgYjw9CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyMjUtMjIyOAogICAgLy8gIyBWYWxpZGF0ZSBhZ2FpbnN0IG1hcmtldC13aWRlIGJvcnJvdyBjYXAKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgbWFya2V0Lm1heF90b3RhbF9ib3Jyb3dzLm5hdGl2ZSA+PSBtYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzICsgYW1vdW50CiAgICAvLyApLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIGFzc2VydCAvLyBCb3Jyb3cgY2FwIGV4Y2VlZGVkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyMzAtMjIzMgogICAgLy8gIyBDaGVjayBjb2xsYXRlcmFsIHJlcXVpcmVtZW50cyAtIGV4Y2x1ZGUgc2FtZSBtYXJrZXQgY29sbGF0ZXJhbCB0byBwcmV2ZW50CiAgICAvLyAjIGluZWZmaWNpZW50IHNhbWUtYXNzZXQgYm9ycm93aW5nCiAgICAvLyBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfZ2xvYmFsX3VzZXIKICAgIGNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjIzNAogICAgLy8gYm9ycm93X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGFtb3VudCkKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X21hcmtldF92YWx1ZQogICAgY292ZXIgMgogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjM2LTIyMzcKICAgIC8vICMgQ2FsY3VsYXRlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gQmlnVUludCgwKToKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgYnl0ZSAweAogICAgYj09CiAgICBieiBfYm9ycm93X3B1cmVfZWxzZV9ib2R5QDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjIzOAogICAgLy8gZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZQogICAgZnJhbWVfZGlnIDIKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGIgX2JvcnJvd19wdXJlX2FmdGVyX2lmX2Vsc2VANgoKX2JvcnJvd19wdXJlX2Vsc2VfYm9keUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjQyCiAgICAvLyB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyAzCiAgICBkdXAKICAgIGV4dHJhY3QgMTc3IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIDUKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyNDMKICAgIC8vICkgLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyNDEtMjI0MwogICAgLy8gZGVwb3NpdGVkX2Ftb3VudCA9ICgKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICkgLy8gU0NBTEUKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyNDQKICAgIC8vIGV4Y2x1ZGVkX3ZhbHVlID0gKGRlcG9zaXRlZF9hbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgc3dhcAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIGR1cAogICAgZnJhbWVfYnVyeSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyNDUKICAgIC8vIGlmIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlID4gZXhjbHVkZWRfdmFsdWU6CiAgICBmcmFtZV9kaWcgMgogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEKICAgIGI8CiAgICBieiBfYm9ycm93X3B1cmVfZWxzZV9ib2R5QDQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjI0Ni0yMjQ4CiAgICAvLyBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSA9ICgKICAgIC8vICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIGV4Y2x1ZGVkX3ZhbHVlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgMQogICAgZnJhbWVfZGlnIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjI0NwogICAgLy8gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBleGNsdWRlZF92YWx1ZQogICAgYi0KICAgIGIgX2JvcnJvd19wdXJlX2FmdGVyX2lmX2Vsc2VANgoKX2JvcnJvd19wdXJlX2Vsc2VfYm9keUA0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjUwCiAgICAvLyBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSA9IEJpZ1VJbnQoMCkKICAgIGJ5dGUgMHgKCl9ib3Jyb3dfcHVyZV9hZnRlcl9pZl9lbHNlQDY6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyNTIKICAgIC8vIHRvdGFsX2JvcnJvd192YWx1ZSA9IGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgKyBib3Jyb3dfdmFsdWUKICAgIGZyYW1lX2RpZyAyCiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIDQKICAgIGR1cAogICAgY292ZXIgMgogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjI1NAogICAgLy8gZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgKiBCaWdVSW50KG1hcmtldC5jb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUpCiAgICBmcmFtZV9kaWcgMwogICAgZHVwCiAgICBjb3ZlciAyCiAgICBleHRyYWN0IDczIDggLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICBpdG9iCiAgICB1bmNvdmVyIDQKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyNTUKICAgIC8vICkgLy8gQmlnVUludCgxMDAwMCksICJJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCBhY3Jvc3MgbWFya2V0cyIKICAgIGJ5dGUgMHgyNzEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyNTMtMjI1NQogICAgLy8gYXNzZXJ0IHRvdGFsX2JvcnJvd192YWx1ZSA8PSAoCiAgICAvLyAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgKiBCaWdVSW50KG1hcmtldC5jb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUpCiAgICAvLyApIC8vIEJpZ1VJbnQoMTAwMDApLCAiSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgYWNyb3NzIG1hcmtldHMiCiAgICBiLwogICAgYjw9CiAgICBhc3NlcnQgLy8gSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgYWNyb3NzIG1hcmtldHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjI1Ny0yMjU4CiAgICAvLyAjIENhbGN1bGF0ZSBleHBlY3RlZCBzY2FsZWQgYm9ycm93cwogICAgLy8gc2NhbGVkX2Ftb3VudCA9IHNlbGYuX2dldF9tYXJrZXRfc2NhbGVkX2JvcnJvdyhtYXJrZXQsIGFtb3VudCkKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X21hcmtldF9zY2FsZWRfYm9ycm93CiAgICBwb3AKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjI2MC0yMjY3CiAgICAvLyBzZWxmLl9kZWJ0X2JvcnJvd19wdXJlKAogICAgLy8gICAgIHVzZXJfaWQsCiAgICAvLyAgICAgdXNlcl9pZCwKICAgIC8vICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgYW1vdW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQsCiAgICAvLyAgICAgYm9ycm93X3ZhbHVlLAogICAgLy8gKQogICAgZnJhbWVfZGlnIC0zCiAgICBkdXAKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICB1bmNvdmVyIDQKICAgIHVuY292ZXIgNQogICAgY2FsbHN1YiBfZGVidF9ib3Jyb3dfcHVyZQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzKG1hcmtldDogYnl0ZXMpIC0+IGJ5dGVzLCBieXRlczoKX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODAxLTE4MDIKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzKHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSkgLT4gQmlnVUludDoKICAgIHByb3RvIDEgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODA0CiAgICAvLyBtYXJrZXQsIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMQogICAgZXh0cmFjdCAxNDUgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MDMtMTgwNQogICAgLy8gcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dfYW1vdW50KAogICAgLy8gICAgIG1hcmtldCwgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gKQogICAgZnJhbWVfZGlnIC0xCiAgICBzd2FwCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0X3VuZGVybHlpbmdfYm9ycm93X2Ftb3VudAogICAgZHVwCiAgICBmcmFtZV9idXJ5IC0xCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd19hbW91bnQobWFya2V0OiBieXRlcywgYW1vdW50OiBieXRlcykgLT4gYnl0ZXMsIGJ5dGVzOgpfZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd19hbW91bnQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MTMtMTgxNgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd19hbW91bnQoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhLCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIHByb3RvIDIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODE3CiAgICAvLyByZXR1cm4gKGFtb3VudCAqIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIC0yCiAgICBleHRyYWN0IDIwOSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAtMQogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgZnJhbWVfZGlnIC0yCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZGVidF9ib3Jyb3dfcHVyZSh1c2VyX2lkOiBieXRlcywgYmVuZWZpY2lhcnlfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcywgc2NhbGVkX2Ftb3VudDogYnl0ZXMsIHZhbHVlOiBieXRlcykgLT4gdm9pZDoKX2RlYnRfYm9ycm93X3B1cmU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MzAtMjYzOQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVidF9ib3Jyb3dfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byA2IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY0MAogICAgLy8gaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzAKICAgIC8vIHNlbGYuc3Rva2VuX2FwcF9pZCA9IFVJbnQ2NCgpICAjIHN0YWJsZSBtYXJrZXQKICAgIGJ5dGUgInN0b2tlbl9hcHBfaWQiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NDAKICAgIC8vIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYuc3Rva2VuX2FwcF9pZCBleGlzdHMKICAgIGZyYW1lX2RpZyAtNAogICAgPT0KICAgIGJ6IF9kZWJ0X2JvcnJvd19wdXJlX2Vsc2VfYm9keUA0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NDEtMjY0NgogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBTVG9rZW4ubWludCwKICAgIC8vICAgICBhcmM0LkFkZHJlc3MoYmVuZWZpY2lhcnlfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjQ0CiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMwogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGZyYW1lX2RpZyAtMwogICAgYnwKICAgIGZyYW1lX2RpZyAtNAogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NDEtMjY0NgogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBTVG9rZW4ubWludCwKICAgIC8vICAgICBhcmM0LkFkZHJlc3MoYmVuZWZpY2lhcnlfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgbWV0aG9kICJtaW50KGFkZHJlc3MsdWludDI1Nil2b2lkIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGZyYW1lX2RpZyAtNQogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjQ3LTI2NDkKICAgIC8vIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICByZWNlaXZlcj1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAsIGZlZT0wCiAgICAvLyApLnN1Ym1pdCgpCiAgICBpdHhuX2JlZ2luCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NDgKICAgIC8vIHJlY2VpdmVyPUFwcGxpY2F0aW9uKG1hcmtldF9pZCkuYWRkcmVzcywgYW1vdW50PTEwMDAwMCwgZmVlPTAKICAgIGZyYW1lX2RpZyAtNAogICAgYXBwX3BhcmFtc19nZXQgQXBwQWRkcmVzcwogICAgYXNzZXJ0IC8vIGFwcGxpY2F0aW9uIGV4aXN0cwogICAgaW50IDEwMDAwMAogICAgaXR4bl9maWVsZCBBbW91bnQKICAgIGl0eG5fZmllbGQgUmVjZWl2ZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY0NwogICAgLy8gaXR4bi5QYXltZW50KAogICAgaW50IHBheQogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjQ4CiAgICAvLyByZWNlaXZlcj1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAsIGZlZT0wCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY0Ny0yNjQ5CiAgICAvLyBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgLy8gKS5zdWJtaXQoKQogICAgaXR4bl9zdWJtaXQKICAgIGIgX2RlYnRfYm9ycm93X3B1cmVfYWZ0ZXJfaWZfZWxzZUA2CgpfZGVidF9ib3Jyb3dfcHVyZV9lbHNlX2JvZHlANDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY1MS0yNjU2CiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICBhcmM0LkFkZHJlc3MoYmVuZWZpY2lhcnlfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjU0CiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMwogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGZyYW1lX2RpZyAtMwogICAgYnwKICAgIGZyYW1lX2RpZyAtNAogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NTEtMjY1NgogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKGJlbmVmaWNpYXJ5X2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICkKICAgIG1ldGhvZCAiYXJjMjAwX3RyYW5zZmVyKGFkZHJlc3MsdWludDI1Nilib29sIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGZyYW1lX2RpZyAtNQogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgaXR4biBMYXN0TG9nCiAgICBleHRyYWN0IDAgNAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICA9PQogICAgYXNzZXJ0IC8vIEFSQzQgcHJlZml4IGlzIHZhbGlkCgpfZGVidF9ib3Jyb3dfcHVyZV9hZnRlcl9pZl9lbHNlQDY6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NTcKICAgIC8vIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICBmcmFtZV9kaWcgLTQKICAgIGZyYW1lX2RpZyAtNgogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY1OAogICAgLy8gc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICBmcmFtZV9kaWcgLTQKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjU5CiAgICAvLyBzZWxmLl9pbmNyZW1lbnRfZ2xvYmFsX2JvcnJvd3ModXNlcl9pZCwgdmFsdWUpCiAgICBmcmFtZV9kaWcgLTYKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfaW5jcmVtZW50X2dsb2JhbF9ib3Jyb3dzCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3M6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MDktMTUxMgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUxMwogICAgLy8gbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUxNQogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudAogICAgZHVwCiAgICBleHRyYWN0IDE0NSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAtMQogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUxNC0xNTE2CiAgICAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gKQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDE0NQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTE3CiAgICAvLyBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgaXRvYgogICAgcmVwbGFjZTIgMjQxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MTgKICAgIC8vIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgZnJhbWVfZGlnIC0yCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzIKICAgIC8vIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgYnl0ZSAibWFya2V0cyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUxOAogICAgLy8gc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBzd2FwCiAgICBjb25jYXQKICAgIHN3YXAKICAgIGJveF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9pbmNyZW1lbnRfZ2xvYmFsX2JvcnJvd3ModXNlcl9pZDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9pbmNyZW1lbnRfZ2xvYmFsX2JvcnJvd3M6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NTgtMjU2MwogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBhbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU2NAogICAgLy8gc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKHVzZXJfaWQsIEJpZ1VJbnQoMCksIGFtb3VudCkKICAgIGZyYW1lX2RpZyAtMgogICAgYnl0ZSAweAogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF91cGRhdGVfZ2xvYmFsX2JvcnJvd3MKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLnJlcGF5KG1hcmtldF9pZDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6CnJlcGF5OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjg1LTIyODYKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHJlcGF5KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyODcKICAgIC8vIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIGludCAyODAwCiAgICBpbnQgMAogICAgY2FsbHN1YiBlbnN1cmVfYnVkZ2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIyODgKICAgIC8vIHNlbGYuX3JlcGF5KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICB0eG4gU2VuZGVyCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ0b2kKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfcmVwYXkKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9yZXBheSh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9yZXBheToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM4OC0yMzg5CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9yZXBheShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgcHJvdG8gMyAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzOTAKICAgIC8vIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzOTEKICAgIC8vIHNlbGYuX3JlcGF5X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9yZXBheV9wdXJlCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fcmVwYXlfcHVyZSh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9yZXBheV9wdXJlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzI0LTIzMjUKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3JlcGF5X3B1cmUoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzYwCiAgICAvLyBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBGYWxzZSkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBpbnQgMAogICAgY2FsbHN1YiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzYxCiAgICAvLyB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2dldF91c2VyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNjIKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNjMKICAgIC8vIHRvdGFsX3VuZGVybHlpbmdfYm9ycm93cyA9IHNlbGYuX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzKG1hcmtldCkKICAgIGNhbGxzdWIgX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzCiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNjQKICAgIC8vIGFzc2VydCBhbW91bnQgPD0gdG90YWxfdW5kZXJseWluZ19ib3Jyb3dzLCAiUmVwYXkgYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidCIKICAgIGZyYW1lX2RpZyAtMQogICAgYj49CiAgICBhc3NlcnQgLy8gUmVwYXkgYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzY1CiAgICAvLyBzY2FsZWRfYW1vdW50ID0gc2VsZi5fZ2V0X21hcmtldF9zY2FsZWRfYm9ycm93KG1hcmtldCwgYW1vdW50KQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3cKICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM2NgogICAgLy8gYXNzZXJ0IHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IHNjYWxlZF9hbW91bnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyBkZWJ0IgogICAgdW5jb3ZlciAyCiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZGlnIDEKICAgIGI+PQogICAgYXNzZXJ0IC8vIFJlcGF5IGFtb3VudCBleGNlZWRzIGRlYnQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM2NwogICAgLy8gcmVwYXlfdmFsdWUgPSBzZWxmLl9nZXRfbWFya2V0X3ZhbHVlKG1hcmtldCwgYW1vdW50KQogICAgc3dhcAogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0X3ZhbHVlCiAgICBwb3AKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM2OC0yMzc1CiAgICAvLyBzZWxmLl9kZWJ0X3JlcGF5bWVudF9wdXJlKAogICAgLy8gICAgIHVzZXJfaWQsCiAgICAvLyAgICAgdXNlcl9pZCwKICAgIC8vICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgYW1vdW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQsCiAgICAvLyAgICAgcmVwYXlfdmFsdWUsCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTMKICAgIGR1cAogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIHVuY292ZXIgNQogICAgdW5jb3ZlciA1CiAgICBjYWxsc3ViIF9kZWJ0X3JlcGF5bWVudF9wdXJlCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZGVidF9yZXBheW1lbnRfcHVyZShwYXllcl9pZDogYnl0ZXMsIGJlbmVmaWNpYXJ5X2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMsIHNjYWxlZF9hbW91bnQ6IGJ5dGVzLCB2YWx1ZTogYnl0ZXMpIC0+IHZvaWQ6Cl9kZWJ0X3JlcGF5bWVudF9wdXJlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjkwLTIyOTkKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlYnRfcmVwYXltZW50X3B1cmUoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBwYXllcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBiZW5lZmljaWFyeV9pZDogQWNjb3VudCwKICAgIC8vICAgICBtYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBhbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgc2NhbGVkX2Ftb3VudDogQmlnVUludCwKICAgIC8vICAgICB2YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDYgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzAwCiAgICAvLyBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMAogICAgLy8gc2VsZi5zdG9rZW5fYXBwX2lkID0gVUludDY0KCkgICMgc3RhYmxlIG1hcmtldAogICAgYnl0ZSAic3Rva2VuX2FwcF9pZCIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMwMAogICAgLy8gaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5zdG9rZW5fYXBwX2lkIGV4aXN0cwogICAgZnJhbWVfZGlnIC00CiAgICA9PQogICAgYnogX2RlYnRfcmVwYXltZW50X3B1cmVfZWxzZV9ib2R5QDMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMwMS0yMzA2CiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIFNUb2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKHBheWVyX2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMwNAogICAgLy8gYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICBmcmFtZV9kaWcgLTMKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBmcmFtZV9kaWcgLTMKICAgIGJ8CiAgICBmcmFtZV9kaWcgLTQKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzAxLTIzMDYKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgU1Rva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3MocGF5ZXJfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgbWV0aG9kICJidXJuX2Zyb20oYWRkcmVzcyx1aW50MjU2KXZvaWQiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgZnJhbWVfZGlnIC02CiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBiIF9kZWJ0X3JlcGF5bWVudF9wdXJlX2FmdGVyX2lmX2Vsc2VANQoKX2RlYnRfcmVwYXltZW50X3B1cmVfZWxzZV9ib2R5QDM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMDgtMjMxNAogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyhwYXllcl9pZCksCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzExCiAgICAvLyBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICBnbG9iYWwgQ3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzEyCiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMwogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGZyYW1lX2RpZyAtMwogICAgYnwKICAgIGZyYW1lX2RpZyAtNAogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMDgtMjMxNAogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyhwYXllcl9pZCksCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgbWV0aG9kICJhcmMyMDBfdHJhbnNmZXJGcm9tKGFkZHJlc3MsYWRkcmVzcyx1aW50MjU2KWJvb2wiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgZnJhbWVfZGlnIC02CiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgc3dhcAogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgaXR4biBMYXN0TG9nCiAgICBleHRyYWN0IDAgNAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICA9PQogICAgYXNzZXJ0IC8vIEFSQzQgcHJlZml4IGlzIHZhbGlkCgpfZGVidF9yZXBheW1lbnRfcHVyZV9hZnRlcl9pZl9lbHNlQDU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMTUtMjMxOAogICAgLy8gIyBhZGp1c3QgdXNlcidzIHNjYWxlZCBib3Jyb3dzCiAgICAvLyBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgbWFya2V0X2lkLCBiZW5lZmljaWFyeV9pZCwgc2NhbGVkX2Ftb3VudAogICAgLy8gKQogICAgZnJhbWVfZGlnIC00CiAgICBmcmFtZV9kaWcgLTUKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMTktMjMyMAogICAgLy8gIyBhZGp1c3QgbWFya2V0J3MgdG90YWwgc2NhbGVkIGJvcnJvd3MKICAgIC8vIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgZnJhbWVfZGlnIC00CiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMyMS0yMzIyCiAgICAvLyAjIGFkanVzdCBnbG9iYWwgYm9ycm93IHZhbHVlCiAgICAvLyBzZWxmLl9kZWNyZW1lbnRfZ2xvYmFsX2JvcnJvd3MoYmVuZWZpY2lhcnlfaWQsIHZhbHVlKQogICAgZnJhbWVfZGlnIC01CiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2RlY3JlbWVudF9nbG9iYWxfYm9ycm93cwogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQ6IHVpbnQ2NCwgdXNlcl9pZDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3M6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExOTEtMTE5NAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTk1CiAgICAvLyBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X21hcmtldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTk2CiAgICAvLyB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF91c2VyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExOTcKICAgIC8vIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfdXNlcl9rZXkKICAgIGNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE5OQogICAgLy8gdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICBkdXAKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2RpZyAtMQogICAgYj49CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExOTgtMTIwMAogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIGFzc2VydCAvLyBJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjAxCiAgICAvLyB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgZnJhbWVfZGlnIC0xCiAgICBiLQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDMyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMDIKICAgIC8vIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgZGlnIDEKICAgIGV4dHJhY3QgMjA5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgcmVwbGFjZTIgOTYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIwMwogICAgLy8gdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICByZXBsYWNlMiAxMjgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIwNAogICAgLy8gdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgc3dhcAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHJlcGxhY2UyIDEzNgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMzCiAgICAvLyBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIGJ5dGUgInVzZXJzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjA1CiAgICAvLyBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICB1bmNvdmVyIDIKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTIwLTE1MjMKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MjQKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MjYKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICBkdXAKICAgIGV4dHJhY3QgMTQ1IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9kaWcgLTEKICAgIGI+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTI1LTE1MjcKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIGFzc2VydCAvLyBJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTI5CiAgICAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50CiAgICBmcmFtZV9kaWcgLTEKICAgIGItCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MjgtMTUzMAogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXBsYWNlMiAxNDUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUzMQogICAgLy8gc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBmcmFtZV9kaWcgLTIKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMgogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTMxCiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIHN3YXAKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2RlY3JlbWVudF9nbG9iYWxfYm9ycm93cyh1c2VyX2lkOiBieXRlcywgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2RlY3JlbWVudF9nbG9iYWxfYm9ycm93czoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU2Ni0yNTcxCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGFtb3VudDogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTcyCiAgICAvLyBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3ModXNlcl9pZCwgYW1vdW50LCBCaWdVSW50KDApKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ5dGUgMHgKICAgIGNhbGxzdWIgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cwogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IGJ5dGVzKSAtPiB2b2lkOgpzeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2U6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzOTMtMjM5NgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzOTcKICAgIC8vIGVuc3VyZV9idWRnZXQoMTQwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIGludCAxNDAwCiAgICBpbnQgMAogICAgY2FsbHN1YiBlbnN1cmVfYnVkZ2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzOTgKICAgIC8vIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgZnJhbWVfZGlnIC0yCiAgICBzd2FwCiAgICBjYWxsc3ViIF9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLmdldF9nbG9iYWxfdXNlcih1c2VyX2lkOiBieXRlcykgLT4gYnl0ZXM6CmdldF9nbG9iYWxfdXNlcjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ4Ni0yNDg3CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfZ2xvYmFsX3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBHbG9iYWxVc2VyRGF0YToKICAgIHByb3RvIDEgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDg4CiAgICAvLyByZXR1cm4gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9nZXRfZ2xvYmFsX3VzZXIKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLmxpcXVpZGF0ZV9jcm9zc19tYXJrZXQoZGVidF9tYXJrZXRfaWQ6IGJ5dGVzLCBjb2xsYXRlcmFsX21hcmtldF9pZDogYnl0ZXMsIHVzZXI6IGJ5dGVzLCBkZWJ0X2Ftb3VudDogYnl0ZXMsIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBieXRlcykgLT4gYnl0ZXM6CmxpcXVpZGF0ZV9jcm9zc19tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1OTEtMjU5OQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgbGlxdWlkYXRlX2Nyb3NzX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIGRlYnRfbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgdXNlcjogYXJjNC5BZGRyZXNzLAogICAgLy8gICAgIGRlYnRfYW1vdW50OiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQ6IGFyYzQuVUludDI1NiwKICAgIC8vICkgLT4gYXJjNC5VSW50MjU2OgogICAgcHJvdG8gNSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MDAKICAgIC8vIGVuc3VyZV9idWRnZXQoNDkwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIGludCA0OTAwCiAgICBpbnQgMAogICAgY2FsbHN1YiBlbnN1cmVfYnVkZ2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MDEKICAgIC8vIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICBjYWxsc3ViIF9pc19wYXVzZWQKICAgICEKICAgIGFzc2VydCAvLyBQcm90b2NvbCBpcyBwYXVzZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjYwMwogICAgLy8gc2VsZi5fYWNjcnVlX2ludGVyZXN0KGRlYnRfbWFya2V0X2lkLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtNQogICAgYnRvaQogICAgZHVwCiAgICBjYWxsc3ViIF9hY2NydWVfaW50ZXJlc3QKICAgIHBvcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjA0CiAgICAvLyBzZWxmLl9hY2NydWVfaW50ZXJlc3QoY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC00CiAgICBidG9pCiAgICBkdXAKICAgIGNhbGxzdWIgX2FjY3J1ZV9pbnRlcmVzdAogICAgcG9wCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MDUtMjYwNwogICAgLy8gc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgIHVzZXIubmF0aXZlLCBkZWJ0X21hcmtldF9pZC5uYXRpdmUKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMwogICAgZGlnIDIKICAgIGNhbGxzdWIgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjA4LTI2MTAKICAgIC8vIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTMKICAgIGRpZyAxCiAgICBjYWxsc3ViIF91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjYxMQogICAgLy8gc2VsZi5fcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0KHVzZXIubmF0aXZlLCBkZWJ0X21hcmtldF9pZC5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTMKICAgIGRpZyAyCiAgICBjYWxsc3ViIF9yZXNvbHZlX2FjY3VtdWxhdGVkX2RlcG9zaXRfaW50ZXJlc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjYxMgogICAgLy8gc2VsZi5fcmVzb2x2ZV9hY2N1bXVsYXRlZF9ib3Jyb3dfaW50ZXJlc3QodXNlci5uYXRpdmUsIGRlYnRfbWFya2V0X2lkLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMwogICAgZGlnIDIKICAgIGNhbGxzdWIgX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MTMtMjYxNQogICAgLy8gc2VsZi5fcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0KAogICAgLy8gICAgIHVzZXIubmF0aXZlLCBjb2xsYXRlcmFsX21hcmtldF9pZC5uYXRpdmUKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMwogICAgZGlnIDEKICAgIGNhbGxzdWIgX3Jlc29sdmVfYWNjdW11bGF0ZWRfZGVwb3NpdF9pbnRlcmVzdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjE2LTI2MTgKICAgIC8vIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0KAogICAgLy8gICAgIHVzZXIubmF0aXZlLCBjb2xsYXRlcmFsX21hcmtldF9pZC5uYXRpdmUKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMwogICAgZGlnIDEKICAgIGNhbGxzdWIgX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MjMKICAgIC8vIFR4bi5zZW5kZXIsCiAgICB0eG4gU2VuZGVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MjAtMjYyNwogICAgLy8gc2VsZi5fbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9wdXJlKAogICAgLy8gICAgIGRlYnRfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZC5uYXRpdmUsCiAgICAvLyAgICAgVHhuLnNlbmRlciwKICAgIC8vICAgICB1c2VyLm5hdGl2ZSwKICAgIC8vICAgICBkZWJ0X2Ftb3VudC5uYXRpdmUsCiAgICAvLyAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQubmF0aXZlLAogICAgLy8gKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9wdXJlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MTktMjYyOAogICAgLy8gcmV0dXJuIGFyYzQuVUludDI1NigKICAgIC8vICAgICBzZWxmLl9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X3B1cmUoCiAgICAvLyAgICAgICAgIGRlYnRfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlLAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyLAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwKICAgIC8vICAgICAgICAgZGVidF9hbW91bnQubmF0aXZlLAogICAgLy8gICAgICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZC5uYXRpdmUsCiAgICAvLyAgICAgKQogICAgLy8gKQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X3B1cmUoZGVidF9tYXJrZXRfaWQ6IHVpbnQ2NCwgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IHVpbnQ2NCwgbGlxdWlkYXRvcl9pZDogYnl0ZXMsIHVzZXJfaWQ6IGJ5dGVzLCByZXBheV9hbW91bnQ6IGJ5dGVzLCBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogYnl0ZXMpIC0+IGJ5dGVzOgpfbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9wdXJlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjc1LTI2ODQKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIGRlYnRfbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdG9yX2lkOiBBY2NvdW50LAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgcmVwYXlfYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBCaWdVSW50LAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgcHJvdG8gNiAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3MzEKICAgIC8vIGNvbGxhdGVyYWxfbWFya2V0X2lkICE9IHNlbGYuc3Rva2VuX2FwcF9pZAogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMAogICAgLy8gc2VsZi5zdG9rZW5fYXBwX2lkID0gVUludDY0KCkgICMgc3RhYmxlIG1hcmtldAogICAgYnl0ZSAic3Rva2VuX2FwcF9pZCIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjczMQogICAgLy8gY29sbGF0ZXJhbF9tYXJrZXRfaWQgIT0gc2VsZi5zdG9rZW5fYXBwX2lkCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYuc3Rva2VuX2FwcF9pZCBleGlzdHMKICAgIGZyYW1lX2RpZyAtNQogICAgIT0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjcxOS0yNzMyCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIGxpcXVpZGF0ZSBvcGVyYXRpb24KICAgIC8vICMgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgZGVidF9tYXJrZXRfaWQKICAgIC8vICMgKS5saXF1aWRhdGUubmF0aXZlCiAgICAvLyAjIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gIyAgICAgYXNzZXJ0IGRlYnRfYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJMaXF1aWRhdGUgY2FwIGV4Y2VlZGVkIgogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjIFJFTSBwcmV2ZW50IHVzaW5nIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCBpbiBsaXF1aWRhdGlvbiBiZWNhdXNlIHN0b2tlbgogICAgLy8gIyBSRU0gbWFya2V0IGNvbGxhdGVyYWwgZG9lcyBub3QgZXhpc3QKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZCAhPSBzZWxmLnN0b2tlbl9hcHBfaWQKICAgIC8vICksICJDYW5ub3QgdXNlIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCAoYm9ycm93LW9ubHkgbWFya2V0KSIKICAgIGFzc2VydCAvLyBDYW5ub3QgdXNlIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCAoYm9ycm93LW9ubHkgbWFya2V0KQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzM1LTI3MzgKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIyBSRU0gcHJldmVudCBzZWxmIGxpcXVpZGF0aW9uCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIGFzc2VydCB1c2VyX2lkICE9IGxpcXVpZGF0b3JfaWQsICJDYW5ub3QgbGlxdWlkYXRlIHNlbGYiCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtNAogICAgIT0KICAgIGFzc2VydCAvLyBDYW5ub3QgbGlxdWlkYXRlIHNlbGYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMi0yNzQxCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gIyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gIyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICMgICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICMgICAgIGVsc2U6CiAgICAvLyAjICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICMgICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gIyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gIyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICMgKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gIyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9kYXRhLnByaWNlID09IG1hcmtldC5wcmljZSwgIlByaWNlIG1pc21hdGNoIgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc3VtZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXSA9IFByaWNlRmVlZCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wPVByaWNlV2l0aFRpbWVzdGFtcCgKICAgIC8vICAgICAgICAgICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICksCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZEF0dGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZC5uYXRpdmUsIHByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcmljZTogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgIyBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMTAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTUKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBwYXltZW50IDw9IDEwMDAwMDAKICAgIC8vICAgICApLCAicGF5bWVudCBleGNlZWRzIG1heGltdW0gZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTYKICAgIC8vICAgICBhcHAgPSBBcHBsaWNhdGlvbihzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gICAgIGl0eG4uUGF5bWVudChyZWNlaXZlcj1hcHAuYWRkcmVzcywgYW1vdW50PXBheW1lbnQsIGZlZT0wKS5zdWJtaXQoKQogICAgLy8gICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBQcmljZUZlZWRQcm92aWRlckludGVyZmFjZS5nZXRfcHJpY2Vfd2l0aF90aW1lc3RhbXAsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWFwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgICAgID4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICk6CiAgICAvLyAgICAgICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wID0gKAogICAgLy8gICAgICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAuY29weSgpCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZCwgcHJpY2Vfd2l0aF90aW1lc3RhbXAucHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlX21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9wYXVzZV9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBwYXVzZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3BhdXNlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5wYXVzZWQgPSBhcmM0LkJvb2wocGF1c2UgPT0gVUludDY0KDEpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzeW5jX21hcmtldChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXRpbGl6YXRpb24oc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhLCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQmlnVUludDoKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICByZXR1cm4gQmlnVUludCgxMDAwMCkgICMgMTAwJSB1dGlsaXphdGlvbiBmb3IgYm9ycm93LW9ubHkgbWFya2V0CiAgICAvLyAgICAgZWxpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gQmlnVUludCgwKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgICMgQWRkaXRpb25hbCBzYWZldHkgY2hlY2sgdG8gcHJldmVudCBkaXZpc2lvbiBieSB6ZXJvCiAgICAvLyAgICAgICAgIHRvdGFsX2RlcG9zaXRzID0gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdG90YWxfZGVwb3NpdHMgPT0gMDoKICAgIC8vICAgICAgICAgICAgIHJldHVybiBCaWdVSW50KDApCiAgICAvLyAgICAgICAgIHJldHVybiAobWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIDEwMDAwKSAvLyB0b3RhbF9kZXBvc2l0cwogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhLCB1dGlsaXphdGlvbjogQmlnVUludCwgdGltZV9kZWx0YTogVUludDY0CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gQmlnVUludCgwKQogICAgLy8gICAgIHJhdGUgPSBtYXJrZXQuYm9ycm93X3JhdGUubmF0aXZlICsgKG1hcmtldC5zbG9wZS5uYXRpdmUgKiB1dGlsaXphdGlvbikgLy8gMTAwMDAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBpbnRlcmVzdCBiYXNlZCBvbiBTQ0FMRUQgYm9ycm93cywgbm90IHVuZGVybHlpbmcKICAgIC8vICAgICAjIFRoaXMgcHJldmVudHMgZG91YmxlIGNvbXBvdW5kaW5nIGFuZCBtYWludGFpbnMgY29uc2lzdGVuY3kgd2l0aCB0aGUgYWNjb3VudGluZyBzeXN0ZW0KICAgIC8vICAgICByZXR1cm4gKHJhdGUgKiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdGltZV9kZWx0YSkgLy8gKAogICAgLy8gICAgICAgICBzZWxmLnNlY29uZHNfcGVyX3llYXIgKiAxMDAwMAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX2ludGVyZXN0X3NwbGl0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgc3Rva2VuX2FwcF9pZDogVUludDY0LAogICAgLy8gICAgIGludGVyZXN0OiBCaWdVSW50LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBVSW50NjQsCiAgICAvLyApIC0+IEludGVyZXN0U3BsaXQ6CiAgICAvLyAgICAgIyBTcGVjaWFsIGhhbmRsaW5nIGZvciBzdG9rZW4gbWFya2V0IC0gYWxsIGludGVyZXN0IGdvZXMgdG8gcmVzZXJ2ZXMKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBCaWdVSW50KDApCiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSAoaW50ZXJlc3QgKiByZXNlcnZlX2ZhY3RvcikgLy8gMTAwMDAKICAgIC8vICAgICAgICAgaWYgcHJvdG9jb2xfcG9ydGlvbiA+IGludGVyZXN0OgogICAgLy8gICAgICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IGludGVyZXN0CiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9wb3J0aW9uID0gaW50ZXJlc3QgLSBwcm90b2NvbF9wb3J0aW9uCiAgICAvLyAgICAgcmV0dXJuIEludGVyZXN0U3BsaXQoCiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9wb3J0aW9uPWFyYzQuVUludDI1NihkZXBvc2l0b3JfcG9ydGlvbiksCiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb249YXJjNC5VSW50MjU2KHByb3RvY29sX3BvcnRpb24pLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYWNjcnVlX2ludGVyZXN0KHNlbGYsIG1hcmtldF9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIEFjY3J1ZSBpbnRlcmVzdCBmb3IgYSBtYXJrZXQgYmFzZWQgb24gdGltZSBlbGFwc2VkIGFuZCB1dGlsaXphdGlvbi4KICAgIC8vICAgICAiIiIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICAgICBjdXJyZW50X3RpbWUgPSBHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcAogICAgLy8gICAgIHRpbWVfZGVsdGEgPSBjdXJyZW50X3RpbWUgLSBtYXJrZXQubGFzdF91cGRhdGVfdGltZS5uYXRpdmUKICAgIC8vICAgICBpZiB0aW1lX2RlbHRhIDw9IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIHV0aWxpemF0aW9uID0gc2VsZi5fY2FsY3VsYXRlX3V0aWxpemF0aW9uKG1hcmtldCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHV0aWxpemF0aW9uID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX2ludGVyZXN0KG1hcmtldCwgdXRpbGl6YXRpb24sIHRpbWVfZGVsdGEpCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIEludGVyZXN0IGRpc3RyaWJ1dGlvbgogICAgLy8gICAgIGludGVyZXN0X3NwbGl0ID0gc2VsZi5fY2FsY3VsYXRlX2ludGVyZXN0X3NwbGl0KAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIHNlbGYuc3Rva2VuX2FwcF9pZCwgaW50ZXJlc3QsIG1hcmtldC5yZXNlcnZlX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICAjIENoZWNrIGlmIHVzZXIgaW5kZXhlcyBjYW4gZ3JvdyBtZWFuaW5nZnVsbHkKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogcHJldmVudCBkaXZpc2lvbiBieSB6ZXJvIGZvciBmaXJzdCBkZXBvc2l0cy9ib3Jyb3dzCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX2luY3JlbWVudCA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBkZXBvc2l0b3JfaW5jcmVtZW50ID0gKGludGVyZXN0X3NwbGl0LmRlcG9zaXRvcl9wb3J0aW9uLm5hdGl2ZSAqIFNDQUxFKSAvLyAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIGJvcnJvd2VyX2luY3JlbWVudCA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3Jyb3dlcl9pbmNyZW1lbnQgPSAoaW50ZXJlc3QgKiBTQ0FMRSkgLy8gKAogICAgLy8gICAgICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBpZiBkZXBvc2l0b3JfaW5jcmVtZW50ID09IDAgb3IgYm9ycm93ZXJfaW5jcmVtZW50ID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgICMgbWFya2V0IGRlcG9zaXQgaW5kZXggdXBkYXRlIGRlcGVuZHMgb24gZGVwb3NpdG9yIHBvcnRpb24gb2YgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPiAwOgogICAgLy8gICAgICAgICBtYXJrZXQuZGVwb3NpdF9pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZSArIGRlcG9zaXRvcl9pbmNyZW1lbnQKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBtYXJrZXQgYm9ycm93IGluZGV4IHVwZGF0ZSBkZXBlbmRzIG9uIGZ1bGwgaW50ZXJlc3QgYW1vdW50CiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID4gMDoKICAgIC8vICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlICsgYm9ycm93ZXJfaW5jcmVtZW50CiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgICMgbWFya2V0IHRvdGFsIHNjYWxlZCBib3Jyb3dzIHVwZGF0ZSBkZXBlbmRzIG9uIGZ1bGwgaW50ZXJlc3QgYW1vdW50CiAgICAvLyAgICAgIyBDb252ZXJ0IGludGVyZXN0IHRvIHNjYWxlZCBib3Jyb3dzIHVzaW5nIGN1cnJlbnQgbWFya2V0IGluZGV4CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGVuc3VyZSBib3Jyb3dfaW5kZXggaXMgbmV2ZXIgMAogICAgLy8gICAgIGJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgaWYgYm9ycm93X2luZGV4ID09IDA6CiAgICAvLyAgICAgICAgIGJvcnJvd19pbmRleCA9IEJpZ1VJbnQoU0NBTEUpCiAgICAvLyAgICAgaW50ZXJlc3Rfc2NhbGVkX2JvcnJvd3MgPSAoaW50ZXJlc3QgKiBTQ0FMRSkgLy8gYm9ycm93X2luZGV4CiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgaW50ZXJlc3Rfc2NhbGVkX2JvcnJvd3MKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIG1hcmtldCB0b3RhbCBzY2FsZWQgZGVwb3NpdHMgdXBkYXRlIGRlcGVuZHMgb24gZGVwb3NpdG9yIHBvcnRpb24gb2YgaW50ZXJlc3QKICAgIC8vICAgICAjIENvbnZlcnQgZGVwb3NpdG9yIHBvcnRpb24gdG8gc2NhbGVkIGRlcG9zaXRzIHVzaW5nIGN1cnJlbnQgbWFya2V0IGluZGV4CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGVuc3VyZSBkZXBvc2l0X2luZGV4IGlzIG5ldmVyIDAKICAgIC8vICAgICBkZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgaWYgZGVwb3NpdF9pbmRleCA9PSAwOgogICAgLy8gICAgICAgICBkZXBvc2l0X2luZGV4ID0gQmlnVUludChTQ0FMRSkKICAgIC8vICAgICBkZXBvc2l0b3Jfc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgaW50ZXJlc3Rfc3BsaXQuZGVwb3NpdG9yX3BvcnRpb24ubmF0aXZlICogU0NBTEUKICAgIC8vICAgICApIC8vIGRlcG9zaXRfaW5kZXgKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGRlcG9zaXRvcl9zY2FsZWRfYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBtYXJrZXQgcmVzZXJ2ZXMgdXBkYXRlIGRlcGVuZHMgb24gcHJvdG9jb2wgcG9ydGlvbiBvZiBpbnRlcmVzdAogICAgLy8gICAgIG1hcmtldC5yZXNlcnZlcyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnJlc2VydmVzLm5hdGl2ZSArIGludGVyZXN0X3NwbGl0LnByb3RvY29sX3BvcnRpb24ubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChjdXJyZW50X3RpbWUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICMgVE9ETyBnb3Zlcm5hbmNlOiBjb25zaWRlciBpZiByZXNlcnZlIHdpdGhkcmF3YWwgc2hvdWxkIHJlcXVpcmUgYWRkaXRpb25hbAogICAgLy8gIyAgICAgIGdvdmVybmFuY2UgbWVjaGFuaXNtcwogICAgLy8gIyBUT0RPIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHM6IG1pZ2h0IHdhbnQgdG8gZW5mb3JjZSBtaW5pbXVtIHJlc2VydmUgbGV2ZWxzIGZvcgogICAgLy8gIyAgICAgIHByb3RvY29sIHNhZmV0eQogICAgLy8gIyBUT0RPIGV2ZW50IGVtaXNzaW9uOiBDb25zaWRlciBhZGRpbmcgYW4gZXZlbnQgdG8gbG9nIHJlc2VydmUgd2l0aGRyYXdhbHMgZm9yCiAgICAvLyAjICAgICAgdHJhbnNwYXJlbmN5CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHdpdGhkcmF3X3Jlc2VydmVzKHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3dpdGhkcmF3X3Jlc2VydmVzKG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3X3Jlc2VydmVzKHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICBzZWxmLl93aXRoZHJhd19yZXNlcnZlc19wdXJlKG1hcmtldF9pZCwgYW1vdW50KQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19yZXNlcnZlc19wdXJlKHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgbWFya2V0LnJlc2VydmVzLm5hdGl2ZSA+PSBhbW91bnQsICJJbnN1ZmZpY2llbnQgcmVzZXJ2ZXMiCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3Moc2VsZi5vd25lciksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24oCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCwgZ3VhcmRfc3Rva2VuOiBib29sCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgYW1vdW50ID4gMCwgIkFtb3VudCBtdXN0IGJlID4gMCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgbm90IG1hcmtldC5wYXVzZWQsICJNYXJrZXQgaXMgcGF1c2VkIgogICAgLy8gICAgIGlmIGd1YXJkX3N0b2tlbjoKICAgIC8vICAgICAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgICAgIHNlbGYuc3Rva2VuX2FwcF9pZCAhPSBtYXJrZXRfaWQKICAgIC8vICAgICAgICAgKSwgIkNhbm5vdCB1c2Ugc3Rva2VuIG1hcmtldCBmb3IgdGhpcyBvcGVyYXRpb24iCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3Jlc29sdmVfYWNjdW11bGF0ZWRfZGVwb3NpdF9pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFJlc29sdmUgKGNsYWltL2NvbXBvdW5kKSBhY2N1bXVsYXRlZCBpbnRlcmVzdCBmb3IgYSB1c2VyJ3MgZGVwb3NpdCBwb3NpdGlvbi4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgZnVuY3Rpb24gaGFuZGxlcyB0aGUgaW50ZXJlc3QgdGhhdCBoYXMgYWNjcnVlZCBzaW5jZSB0aGUgdXNlcidzIGxhc3QKICAgIC8vICAgICBpbnRlcmFjdGlvbiBieSBjb252ZXJ0aW5nIGl0IHRvIGFkZGl0aW9uYWwgc2NhbGVkIGRlcG9zaXRzLiBUaGlzIG1ha2VzCiAgICAvLyAgICAgc3Vic2VxdWVudCBvcGVyYXRpb25zIHB1cmVseSBhZGRpdGl2ZSBzaW5jZSB0aGUgaW50ZXJlc3QgaGFzIGFscmVhZHkgYmVlbgogICAgLy8gICAgICJwYWlkIG91dCIuCiAgICAvLyAKICAgIC8vICAgICBOb3RlOiBUaGlzIGZ1bmN0aW9uIGFzc3VtZXMgdGhhdCBpbnRlcmVzdCBoYXMgYWxyZWFkeSBiZWVuIGFjY3J1ZWQgYnkgdGhlCiAgICAvLyAgICAgY2FsbGVyIChlLmcuLCB2aWEgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSkgdG8gYXZvaWQKICAgIC8vICAgICBkb3VibGUgaW50ZXJlc3QgYWNjcnVhbC4KICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQgKEFjY291bnQpOiBUaGUgYWNjb3VudCBJRCBvZiB0aGUgdXNlcgogICAgLy8gICAgICAgICBtYXJrZXRfaWQgKFVJbnQ2NCk6IFRoZSBJRCBvZiB0aGUgbWFya2V0CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGEodXNlciwgbWFya2V0KQogICAgLy8gICAgIGlmIGludGVyZXN0ID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybgogICAgLy8gICAgIGludGVyZXN0X3NjYWxlZF9hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3NjYWxlZF9kZXBvc2l0KG1hcmtldCwgaW50ZXJlc3QpCiAgICAvLyAgICAgaW50ZXJlc3RfdmFsdWUgPSBzZWxmLl9nZXRfbWFya2V0X3ZhbHVlKG1hcmtldCwgaW50ZXJlc3QpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGludGVyZXN0X3NjYWxlZF9hbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIHVzZXJfaWQsIGludGVyZXN0X3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKHVzZXJfaWQsIEJpZ1VJbnQoMCksIGludGVyZXN0X3ZhbHVlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9yZXNvbHZlX2FjY3VtdWxhdGVkX2JvcnJvd19pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFJlc29sdmUgKGNsYWltL2NvbXBvdW5kKSBhY2N1bXVsYXRlZCBpbnRlcmVzdCBmb3IgYSB1c2VyJ3MgYm9ycm93IHBvc2l0aW9uLgogICAgLy8gICAgICIiIgogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0X3dpdGhfZGF0YSh1c2VyLCBtYXJrZXQpCiAgICAvLyAgICAgaWYgaW50ZXJlc3QgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuCiAgICAvLyAgICAgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCA9IHNlbGYuX2dldF9tYXJrZXRfc2NhbGVkX2JvcnJvdyhtYXJrZXQsIGludGVyZXN0KQogICAgLy8gICAgIGludGVyZXN0X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGludGVyZXN0KQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICAgICAgbWFya2V0X2lkLCB1c2VyX2lkLCBpbnRlcmVzdF9zY2FsZWRfYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cyh1c2VyX2lkLCBCaWdVSW50KDApLCBpbnRlcmVzdF92YWx1ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRzKHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSkgLT4gQmlnVUludDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRfYW1vdW50KAogICAgLy8gICAgICAgICBtYXJrZXQsIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3VuZGVybHlpbmdfYm9ycm93cyhzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEpIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dfYW1vdW50KAogICAgLy8gICAgICAgICBtYXJrZXQsIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdW5kZXJseWluZ19kZXBvc2l0X2Ftb3VudCgKICAgIC8vICAgICBzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHJldHVybiAoYW1vdW50ICogbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3VuZGVybHlpbmdfYm9ycm93X2Ftb3VudCgKICAgIC8vICAgICBzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHJldHVybiAoYW1vdW50ICogbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfc2NhbGVkX2RlcG9zaXQoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhLCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogZW5zdXJlIGRlcG9zaXRfaW5kZXggaXMgbmV2ZXIgMCB0byBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8KICAgIC8vICAgICAjIElmIGRlcG9zaXRfaW5kZXggaXMgMCwgaW5pdGlhbGl6ZSBpdCB0byBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICBpZiBkZXBvc2l0X2luZGV4ID09IDA6CiAgICAvLyAgICAgICAgIGRlcG9zaXRfaW5kZXggPSBCaWdVSW50KFNDQUxFKQogICAgLy8gICAgIHJldHVybiAoYW1vdW50ICogU0NBTEUpIC8vIGRlcG9zaXRfaW5kZXgKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF9zY2FsZWRfYm9ycm93KHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSwgYW1vdW50OiBCaWdVSW50KSAtPiBCaWdVSW50OgogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBlbnN1cmUgYm9ycm93X2luZGV4IGlzIG5ldmVyIDAgdG8gcHJldmVudCBkaXZpc2lvbiBieSB6ZXJvCiAgICAvLyAgICAgIyBJZiBib3Jyb3dfaW5kZXggaXMgMCwgaW5pdGlhbGl6ZSBpdCB0byBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgaWYgYm9ycm93X2luZGV4ID09IDA6CiAgICAvLyAgICAgICAgIGJvcnJvd19pbmRleCA9IEJpZ1VJbnQoU0NBTEUpCiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBTQ0FMRSkgLy8gYm9ycm93X2luZGV4CiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdmFsdWUoc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhLCBhbW91bnQ6IEJpZ1VJbnQpIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXBvc2l0KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICBzZWxmLl9kZXBvc2l0KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlcG9zaXRfcHVyZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUHVyZSBkZXBvc2l0IG9wZXJhdGlvbiB0aGF0IGFkZHMgbmV3IGZ1bmRzIHdpdGhvdXQgaGFuZGxpbmcgaW50ZXJlc3QuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIGZ1bmN0aW9uIGFzc3VtZXMgdGhhdCBhbnkgYWNjdW11bGF0ZWQgaW50ZXJlc3QgaGFzIGFscmVhZHkgYmVlbiByZXNvbHZlZAogICAgLy8gICAgIGJ5IGNhbGxpbmcgX3Jlc29sdmVfYWNjdW11bGF0ZWRfaW50ZXJlc3QoKSBiZWZvcmVoYW5kLiBJdCBwZXJmb3JtcyBvbmx5IHRoZQogICAgLy8gICAgIGRlcG9zaXQgb3BlcmF0aW9uLCBtYWtpbmcgaXQgcHVyZWx5IGFkZGl0aXZlLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIG1ha2luZyB0aGUgZGVwb3NpdAogICAgLy8gICAgICAgICBtYXJrZXRfaWQgKFVJbnQ2NCk6IFRoZSBJRCBvZiB0aGUgbWFya2V0IHRvIGRlcG9zaXQgaW50bwogICAgLy8gICAgICAgICBhbW91bnQgKEJpZ1VJbnQpOiBUaGUgYW1vdW50IG9mIHVuZGVybHlpbmcgdG9rZW5zIHRvIGRlcG9zaXQKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIGRlcG9zaXQgb3BlcmF0aW9uCiAgICAvLyAgICAgIyBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgIyAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgIyApLmRlcG9zaXQubmF0aXZlCiAgICAvLyAgICAgIyBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAjIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIkRlcG9zaXQgY2FwIGV4Y2VlZGVkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIG1hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRzID0gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRzKG1hcmtldCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZSA+PSBtYXJrZXRfdW5kZXJseWluZ19kZXBvc2l0cyArIGFtb3VudAogICAgLy8gICAgICksICJNYXJrZXQgZGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAgICAgc2NhbGVkX2Ftb3VudCA9IHNlbGYuX2dldF9tYXJrZXRfc2NhbGVkX2RlcG9zaXQobWFya2V0LCBhbW91bnQpCiAgICAvLyAgICAgZGVwb3NpdF92YWx1ZSA9IHNlbGYuX2dldF9tYXJrZXRfdmFsdWUobWFya2V0LCBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5fY29sbGF0ZXJhbF9kZXBvc2l0X3B1cmUoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwKICAgIC8vICAgICAgICAgbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgc2NhbGVkX2Ftb3VudCwKICAgIC8vICAgICAgICAgZGVwb3NpdF92YWx1ZSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlcG9zaXQoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBJbnRlcm5hbCBkZXBvc2l0IG1ldGhvZCB0aGF0IGhhbmRsZXMgdXNlciBkZXBvc2l0cyBpbnRvIGEgbGVuZGluZyBtYXJrZXQuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBwZXJmb3JtcyBhIGNvbXBsZXRlIGRlcG9zaXQgb3BlcmF0aW9uIHdpdGggc2VwYXJhdGVkIGNvbmNlcm5zOgogICAgLy8gICAgIDEuIFN5bmNzIHVzZXIgbWFya2V0IGZvciBwcmljZSBjaGFuZ2VzIChhY2NydWVzIGludGVyZXN0LCB1cGRhdGVzIGdsb2JhbCB2YWx1ZXMsIHJlc29sdmVzIGludGVyZXN0KQogICAgLy8gICAgIDIuIFBlcmZvcm1zIHB1cmUgZGVwb3NpdCBvcGVyYXRpb24gKGFkZHMgbmV3IGZ1bmRzIHdpdGhvdXQgaW50ZXJlc3QgaGFuZGxpbmcpCiAgICAvLyAKICAgIC8vICAgICBUaGUgc2VwYXJhdGlvbiBlbnN1cmVzOgogICAgLy8gICAgIC0gU2luZ2xlIGludGVyZXN0IGFjY3J1YWwgcGVyIG9wZXJhdGlvbgogICAgLy8gICAgIC0gQ2xlYW4gc2VwYXJhdGlvbiBiZXR3ZWVuIGludGVyZXN0IHJlc29sdXRpb24gYW5kIG5ldyBkZXBvc2l0cwogICAgLy8gICAgIC0gQ29uc2lzdGVudCBwcmljZSBzeW5jaHJvbml6YXRpb24KICAgIC8vICAgICAtIFB1cmUgYWRkaXRpdmUgZGVwb3NpdCBvcGVyYXRpb24KICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQgKEFjY291bnQpOiBUaGUgYWNjb3VudCBJRCBvZiB0aGUgdXNlciBtYWtpbmcgdGhlIGRlcG9zaXQKICAgIC8vICAgICAgICAgbWFya2V0X2lkIChVSW50NjQpOiBUaGUgSUQgb2YgdGhlIG1hcmtldCB0byBkZXBvc2l0IGludG8KICAgIC8vICAgICAgICAgYW1vdW50IChCaWdVSW50KTogVGhlIGFtb3VudCBvZiB1bmRlcmx5aW5nIHRva2VucyB0byBkZXBvc2l0CiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiBtYXJrZXQgdmFsaWRhdGlvbiBmYWlscywgZGVwb3NpdCBjYXAgaXMgZXhjZWVkZWQsIG9yIG90aGVyIGNvbnN0cmFpbnRzIGFyZSB2aW9sYXRlZAogICAgLy8gCiAgICAvLyAgICAgTm90ZToKICAgIC8vICAgICAgICAgLSBBbGwgcHJpY2UgY2hhbmdlcyBhbmQgaW50ZXJlc3QgcmVzb2x1dGlvbiBhcmUgaGFuZGxlZCBpbiB0aGUgc3luYyBzdGVwCiAgICAvLyAgICAgICAgIC0gVGhlIGRlcG9zaXQgb3BlcmF0aW9uIGlzIHB1cmVseSBhZGRpdGl2ZSwgYWRkaW5nIG9ubHkgdGhlIG5ldyBhbW91bnQKICAgIC8vICAgICAgICAgLSBVc2VyJ3MgZ2xvYmFsIGNvbGxhdGVyYWwvYm9ycm93IHZhbHVlcyBhcmUgdXBkYXRlZCB3aXRoIGN1cnJlbnQgcHJpY2VzIGR1cmluZyBzeW5jCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgIyBTeW5jIHVzZXIgbWFya2V0IGZvciBwcmljZSBjaGFuZ2UKICAgIC8vICAgICBzZWxmLl9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBQZXJmb3JtIHB1cmUgZGVwb3NpdCBvcGVyYXRpb24KICAgIC8vICAgICBzZWxmLl9kZXBvc2l0X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNhbGN1bGF0ZV91c2VyX2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgaW50ZXJlc3QiIiIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3Rfd2l0aF9kYXRhKHVzZXIsIG1hcmtldCkKICAgIC8vICAgICByZXR1cm4gaW50ZXJlc3QKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3Rfd2l0aF9kYXRhKAogICAgLy8gICAgIHNlbGYsIHVzZXI6IFVzZXJEYXRhLCBtYXJrZXQ6IE1hcmtldERhdGEKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgaW50ZXJlc3QgdXNpbmcgcHJlLWZldGNoZWQgZGF0YSIiIgogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBpZiB1c2VyIGhhcyBubyBkZXBvc2l0cywgcmV0dXJuIDAgaW50ZXJlc3QKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIEJpZ1VJbnQoMCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGN1cnJlbnQgdW5kZXJseWluZyB2YWx1ZQogICAgLy8gICAgIGN1cnJlbnRfdW5kZXJseWluZyA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdW5kZXJseWluZyB2YWx1ZSBhdCB1c2VyJ3MgbGFzdCB1cGRhdGUKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogaWYgdXNlcidzIGRlcG9zaXRfaW5kZXggaXMgMCAobmV3IHVzZXIpLCB1c2UgY3VycmVudCBtYXJrZXQgaW5kZXgKICAgIC8vICAgICB1c2VyX2RlcG9zaXRfaW5kZXggPSAoCiAgICAvLyAgICAgICAgIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgbGFzdF91bmRlcmx5aW5nID0gKHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXJfZGVwb3NpdF9pbmRleCkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UKICAgIC8vICAgICBpZiBjdXJyZW50X3VuZGVybHlpbmcgPiBsYXN0X3VuZGVybHlpbmc6CiAgICAvLyAgICAgICAgIGludGVyZXN0ID0gY3VycmVudF91bmRlcmx5aW5nIC0gbGFzdF91bmRlcmx5aW5nCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgaW50ZXJlc3QgPSBCaWdVSW50KDApCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gaW50ZXJlc3QKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoNzAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIiIiQ2FsY3VsYXRlIHVzZXIncyBhY2NydWVkIGRlYnQgaW50ZXJlc3QiIiIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdF93aXRoX2RhdGEodXNlciwgbWFya2V0KQogICAgLy8gICAgIHJldHVybiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0X3dpdGhfZGF0YSgKICAgIC8vICAgICBzZWxmLCB1c2VyOiBVc2VyRGF0YSwgbWFya2V0OiBNYXJrZXREYXRhCiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIiIiQ2FsY3VsYXRlIHVzZXIncyBhY2NydWVkIGRlYnQgaW50ZXJlc3QgdXNpbmcgcHJlLWZldGNoZWQgZGF0YSIiIgogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIHVuZGVybHlpbmcgZGVidCBhbW91bnQKICAgIC8vICAgICB1c2VyX3RvdGFsX2RlYnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBvcmlnaW5hbCBwcmluY2lwYWwgYW1vdW50IHVzaW5nIHVzZXIncyBib3Jyb3dfaW5kZXgKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogaWYgdXNlcidzIGJvcnJvd19pbmRleCBpcyAwLCB1c2UgY3VycmVudCBtYXJrZXQgYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlcl9ib3Jyb3dfaW5kZXggPSAoCiAgICAvLyAgICAgICAgIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgb3JpZ2luYWxfcHJpbmNpcGFsID0gKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlcl9ib3Jyb3dfaW5kZXgpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIEludGVyZXN0IGlzIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gY3VycmVudCB0b3RhbCBkZWJ0IGFuZCBvcmlnaW5hbCBwcmluY2lwYWwKICAgIC8vICAgICAjIFByZXZlbnQgbmVnYXRpdmUgaW50ZXJlc3QgKHVuZGVyZmxvdyBwcm90ZWN0aW9uKQogICAgLy8gICAgIGlmIHVzZXJfdG90YWxfZGVidCA+PSBvcmlnaW5hbF9wcmluY2lwYWw6CiAgICAvLyAgICAgICAgIGRlYnRfaW50ZXJlc3QgPSB1c2VyX3RvdGFsX2RlYnQgLSBvcmlnaW5hbF9wcmluY2lwYWwKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBkZWJ0X2ludGVyZXN0ID0gQmlnVUludCgwKQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIGRlYnRfaW50ZXJlc3QKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgd2l0aGRyYXcoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDI4MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDI1NihzZWxmLl93aXRoZHJhdyhUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY29sbGF0ZXJhbF9kZXBvc2l0X3B1cmUoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGJlbmVmaWNpYXJ5X2lkOiBBY2NvdW50LAogICAgLy8gICAgIG1hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIG50b2tlbl9pZDogVUludDY0LAogICAgLy8gICAgIGFtb3VudDogQmlnVUludCwKICAgIC8vICAgICBzY2FsZWRfYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHZhbHVlOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5taW50LAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3MoYmVuZWZpY2lhcnlfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoc2NhbGVkX2Ftb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihudG9rZW5faWQpLAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIGJlbmVmaWNpYXJ5X2lkLCBzY2FsZWRfYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfZ2xvYmFsX2NvbGxhdGVyYWwoYmVuZWZpY2lhcnlfaWQsIHZhbHVlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jb2xsYXRlcmFsX3dpdGhkcmF3X3B1cmUoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGJlbmVmaWNpYXJ5X2lkOiBBY2NvdW50LAogICAgLy8gICAgIG1hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIG50b2tlbl9pZDogVUludDY0LAogICAgLy8gICAgIGFtb3VudDogQmlnVUludCwKICAgIC8vICAgICBzY2FsZWRfYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHZhbHVlOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFB1cmUgY29sbGF0ZXJhbCB3aXRoZHJhd2FsIG9wZXJhdGlvbiB0aGF0IGJ1cm5zIG5Ub2tlbnMgYW5kIHRyYW5zZmVycyB1bmRlcmx5aW5nIHRva2Vucy4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIHBlcmZvcm1zIHRoZSBjb3JlIGNvbGxhdGVyYWwgd2l0aGRyYXdhbCBsb2dpYyB3aXRob3V0IGhhbmRsaW5nIGludGVyZXN0CiAgICAvLyAgICAgY2FsY3VsYXRpb25zIG9yIHZhbGlkYXRpb25zLiBJdCBhc3N1bWVzIHRoYXQgYWxsIG5lY2Vzc2FyeSB2YWxpZGF0aW9ucyBhbmQgaW50ZXJlc3QKICAgIC8vICAgICBhY2NydWFscyBoYXZlIGJlZW4gaGFuZGxlZCBieSB0aGUgY2FsbGluZyBtZXRob2QgYmVmb3JlaGFuZC4KICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQgKEFjY291bnQpOiBUaGUgYWNjb3VudCBJRCBvZiB0aGUgdXNlciB3aXRoZHJhd2luZyBjb2xsYXRlcmFsCiAgICAvLyAgICAgICAgIGJlbmVmaWNpYXJ5X2lkIChBY2NvdW50KTogVGhlIGFjY291bnQgSUQgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIHdpdGhkcmF3biB0b2tlbnMKICAgIC8vICAgICAgICAgbWFya2V0X2lkIChVSW50NjQpOiBUaGUgSUQgb2YgdGhlIG1hcmtldCBmcm9tIHdoaWNoIGNvbGxhdGVyYWwgaXMgYmVpbmcgd2l0aGRyYXduCiAgICAvLyAgICAgICAgIG50b2tlbl9pZCAoVUludDY0KTogVGhlIElEIG9mIHRoZSBuVG9rZW4gYXBwbGljYXRpb24gdG8gYnVybiB0b2tlbnMgZnJvbQogICAgLy8gICAgICAgICBhbW91bnQgKEJpZ1VJbnQpOiBUaGUgYWN0dWFsIGFtb3VudCBvZiB1bmRlcmx5aW5nIHRva2VucyB0byB0cmFuc2ZlcgogICAgLy8gICAgICAgICBzY2FsZWRfYW1vdW50IChCaWdVSW50KTogVGhlIHNjYWxlZCBhbW91bnQgb2YgblRva2VucyB0byBidXJuCiAgICAvLyAgICAgICAgIHZhbHVlIChCaWdVSW50KTogVGhlIFVTRCB2YWx1ZSBvZiB0aGUgY29sbGF0ZXJhbCBiZWluZyB3aXRoZHJhd24KICAgIC8vIAogICAgLy8gICAgIFByb2Nlc3M6CiAgICAvLyAgICAgICAgIDEuIEJ1cm5zIHRoZSBzcGVjaWZpZWQgc2NhbGVkIGFtb3VudCBvZiBuVG9rZW5zIGZyb20gdGhlIHVzZXIKICAgIC8vICAgICAgICAgMi4gRGVjcmVtZW50cyB0aGUgdXNlcidzIHNjYWxlZCBkZXBvc2l0IGJhbGFuY2UgZm9yIHRoZSBtYXJrZXQKICAgIC8vICAgICAgICAgMy4gRGVjcmVtZW50cyB0aGUgdG90YWwgc2NhbGVkIGRlcG9zaXRzIGZvciB0aGUgbWFya2V0CiAgICAvLyAgICAgICAgIDQuIFRyYW5zZmVycyB0aGUgdW5kZXJseWluZyB0b2tlbnMgdG8gdGhlIGJlbmVmaWNpYXJ5CiAgICAvLyAgICAgICAgIDUuIERlY3JlbWVudHMgdGhlIHVzZXIncyBnbG9iYWwgY29sbGF0ZXJhbCB2YWx1ZSB0cmFja2luZwogICAgLy8gICAgICIiIgogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KHNjYWxlZF9hbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obnRva2VuX2lkKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKGJlbmVmaWNpYXJ5X2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfZ2xvYmFsX2NvbGxhdGVyYWwodXNlcl9pZCwgdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3X3B1cmUoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFB1cmUgd2l0aGRyYXcgb3BlcmF0aW9uIHRoYXQgYnVybnMgblRva2VucyBhbmQgdHJhbnNmZXJzIHVuZGVybHlpbmcgdG9rZW5zIHRvIHVzZXIuCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIHdpdGhkcmF3IG9wZXJhdGlvbgogICAgLy8gICAgICMgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICMgICAgIG1hcmtldF9pZAogICAgLy8gICAgICMgKS53aXRoZHJhdy5uYXRpdmUKICAgIC8vICAgICAjIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICMgICAgIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIldpdGhkcmF3IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBhbW91bnQgPD0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdGhlIGFjdHVhbCB1bmRlcmx5aW5nIGFtb3VudCB0byB0cmFuc2ZlciB0byB1c2VyCiAgICAvLyAgICAgIyBhbW91bnQgaXMgdGhlIHNjYWxlZCBhbW91bnQgKG5Ub2tlbnMpLCB3ZSBuZWVkIHRvIGNvbnZlcnQgdG8gdW5kZXJseWluZwogICAgLy8gICAgIHVuZGVybHlpbmdfYW1vdW50ID0gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRfYW1vdW50KG1hcmtldCwgYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgdW5kZXJseWluZ192YWx1ZSA9IHNlbGYuX2dldF9tYXJrZXRfdmFsdWUobWFya2V0LCB1bmRlcmx5aW5nX2Ftb3VudCkKICAgIC8vIAogICAgLy8gICAgIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgaGVhbHRoIGNoZWNrOiBlbnN1cmUgd2l0aGRyYXcgd291bGQgbm90IHB1dCBib3Jyb3dzIGF0IHJpc2sKICAgIC8vICAgICBpZiBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgdW5kZXJseWluZ192YWx1ZSA8PSBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZQogICAgLy8gICAgICAgICApLCAiV2l0aGRyYXdhbCBwdXRzIHVzZXIgYXQgcmlzayBvZiBsaXF1aWRhdGlvbiIKICAgIC8vICAgICAgICAgcmVtYWluaW5nX2NvbGxhdGVyYWwgPSAoCiAgICAvLyAgICAgICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIHVuZGVybHlpbmdfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBhc3NlcnQgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSA8PSAoCiAgICAvLyAgICAgICAgICAgICByZW1haW5pbmdfY29sbGF0ZXJhbCAqIEJpZ1VJbnQobWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICAgICAgICAgKSAvLyBCaWdVSW50KDEwMDAwKSwgIldpdGhkcmF3YWwgcHV0cyB1c2VyIGF0IHJpc2sgb2YgbGlxdWlkYXRpb24iCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIHdpdGhkcmF3IG9wZXJhdGlvbgogICAgLy8gICAgICMgdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIC8vICAgICAjIGlmIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPT0gMDoKICAgIC8vICAgICAjICAgICB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIC8vICAgICAjIGVsaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA8IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wOgogICAgLy8gICAgICMgICAgIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KDApCiAgICAvLyAgICAgIyAgICAgdXNlcl9jYXAudG90YWxfbGlxdWlkYXRpb25zID0gYXJjNC5VSW50MjU2KDApCiAgICAvLyAgICAgIyAgICAgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wICsgODY0MDApCiAgICAvLyAgICAgIyBpZiB1c2VyX2NhcC5kYWlseV93aXRoZHJhd2Fscy5uYXRpdmUgPiAwOgogICAgLy8gICAgICMgICAgIG5ld190b3RhbF93aXRoZHJhd2FscyA9IHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzLm5hdGl2ZSArIGFtb3VudF91c2RfdmFsdWUKICAgIC8vICAgICAjICAgICBhc3NlcnQgKAogICAgLy8gICAgICMgICAgICAgICBuZXdfdG90YWxfd2l0aGRyYXdhbHMgPD0gdXNlcl9jYXAuZGFpbHlfd2l0aGRyYXdhbHMubmF0aXZlCiAgICAvLyAgICAgIyAgICAgKSwgIlVzZXIgd2l0aGRyYXcgY2FwIGV4Y2VlZGVkIgogICAgLy8gICAgICMgICAgIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KG5ld190b3RhbF93aXRoZHJhd2FscykKICAgIC8vICAgICAjICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZCwgdXNlcl9jYXApCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9jb2xsYXRlcmFsX3dpdGhkcmF3X3B1cmUoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwKICAgIC8vICAgICAgICAgbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgIHVuZGVybHlpbmdfYW1vdW50LAogICAgLy8gICAgICAgICBhbW91bnQsCiAgICAvLyAgICAgICAgIHVuZGVybHlpbmdfdmFsdWUsCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBFbWl0IGV2ZW50cwogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldFdpdGhkcmF3KAogICAgLy8gICAgICMgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksIGFyYzQuVUludDY0KG1hcmtldF9pZCksIGFyYzQuVUludDI1NihhbW91bnQpCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIHVuZGVybHlpbmdfYW1vdW50CiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICBzZWxmLl9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHJldHVybiBzZWxmLl93aXRoZHJhd19wdXJlKHVzZXJfaWQsIG1hcmtldF9pZCwgYW1vdW50KQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBib3Jyb3coc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyODAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX2JvcnJvdyhUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9ib3Jyb3dfcHVyZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBib3Jyb3cgb3BlcmF0aW9uCiAgICAvLyAgICAgIyBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgIyAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgIyApLmJvcnJvdy5uYXRpdmUKICAgIC8vICAgICAjIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICMgICAgIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIkJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KHVzZXJfaWQpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gVUludDY0KDEwMDAwMCksICJQYXltZW50IGFtb3VudCBtdXN0IGJlID49IDAuMSIKICAgIC8vIAogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBjdXJyZW50IG1hcmtldCB0b3RhbCBib3Jyb3dzIChpbmNsdWRpbmcgaW50ZXJlc3QpCiAgICAvLyAgICAgbWFya2V0X3VuZGVybHlpbmdfYm9ycm93cyA9IHNlbGYuX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzKG1hcmtldCkKICAgIC8vIAogICAgLy8gICAgICMgVmFsaWRhdGUgYWdhaW5zdCBtYXJrZXQtd2lkZSBib3Jyb3cgY2FwCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0Lm1heF90b3RhbF9ib3Jyb3dzLm5hdGl2ZSA+PSBtYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzICsgYW1vdW50CiAgICAvLyAgICAgKSwgIkJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICAjIENoZWNrIGNvbGxhdGVyYWwgcmVxdWlyZW1lbnRzIC0gZXhjbHVkZSBzYW1lIG1hcmtldCBjb2xsYXRlcmFsIHRvIHByZXZlbnQKICAgIC8vICAgICAjIGluZWZmaWNpZW50IHNhbWUtYXNzZXQgYm9ycm93aW5nCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgIGJvcnJvd192YWx1ZSA9IHNlbGYuX2dldF9tYXJrZXRfdmFsdWUobWFya2V0LCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSBCaWdVSW50KDApOgogICAgLy8gICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSA9IGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlCiAgICAvLyAgICAgIyBVc2UgZWZmZWN0aXZlIGNvbGxhdGVyYWwgdmFsdWUgKGV4Y2x1ZGluZyBzYW1lLW1hcmtldCBkZXBvc2l0cykKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBkZXBvc2l0ZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgZXhjbHVkZWRfdmFsdWUgPSAoZGVwb3NpdGVkX2Ftb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIGlmIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlID4gZXhjbHVkZWRfdmFsdWU6CiAgICAvLyAgICAgICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSA9ICgKICAgIC8vICAgICAgICAgICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIGV4Y2x1ZGVkX3ZhbHVlCiAgICAvLyAgICAgICAgICAgICApCiAgICAvLyAgICAgICAgIGVsc2U6CiAgICAvLyAgICAgICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSA9IEJpZ1VJbnQoMCkKICAgIC8vIAogICAgLy8gICAgIHRvdGFsX2JvcnJvd192YWx1ZSA9IGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgKyBib3Jyb3dfdmFsdWUKICAgIC8vICAgICBhc3NlcnQgdG90YWxfYm9ycm93X3ZhbHVlIDw9ICgKICAgIC8vICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgKiBCaWdVSW50KG1hcmtldC5jb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUpCiAgICAvLyAgICAgKSAvLyBCaWdVSW50KDEwMDAwKSwgIkluc3VmZmljaWVudCBjb2xsYXRlcmFsIGFjcm9zcyBtYXJrZXRzIgogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgZXhwZWN0ZWQgc2NhbGVkIGJvcnJvd3MKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gc2VsZi5fZ2V0X21hcmtldF9zY2FsZWRfYm9ycm93KG1hcmtldCwgYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fZGVidF9ib3Jyb3dfcHVyZSgKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBhbW91bnQsCiAgICAvLyAgICAgICAgIHNjYWxlZF9hbW91bnQsCiAgICAvLyAgICAgICAgIGJvcnJvd192YWx1ZSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIEVtaXQgZXZlbnQKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRCb3Jyb3coCiAgICAvLyAgICAgIyAgICAgICAgIHVzZXI9YXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICMgICAgICAgICB0b2tlbl9pZD1hcmM0LlVJbnQ2NChtYXJrZXRfaWQpLAogICAgLy8gICAgICMgICAgICAgICBhbW91bnQ9YXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9ib3Jyb3coc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX2JvcnJvd19wdXJlKHVzZXJfaWQsIG1hcmtldF9pZCwgYW1vdW50KQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiByZXBheShzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDI4MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fcmVwYXkoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVidF9yZXBheW1lbnRfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHBheWVyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGJlbmVmaWNpYXJ5X2lkOiBBY2NvdW50LAogICAgLy8gICAgIG1hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGFtb3VudDogQmlnVUludCwKICAgIC8vICAgICBzY2FsZWRfYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHZhbHVlOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBTVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKHBheWVyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyhwYXllcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgIyBhZGp1c3QgdXNlcidzIHNjYWxlZCBib3Jyb3dzCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIGJlbmVmaWNpYXJ5X2lkLCBzY2FsZWRfYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgICMgYWRqdXN0IG1hcmtldCdzIHRvdGFsIHNjYWxlZCBib3Jyb3dzCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgIyBhZGp1c3QgZ2xvYmFsIGJvcnJvdyB2YWx1ZQogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9nbG9iYWxfYm9ycm93cyhiZW5lZmljaWFyeV9pZCwgdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3JlcGF5X3B1cmUoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBSZXBheSBib3Jyb3dlZCB0b2tlbnMgZm9yIGEgc3BlY2lmaWMgbWFya2V0LgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgaGFuZGxlcyB0aGUgcmVwYXltZW50IG9mIGJvcnJvd2VkIHRva2Vucy4gSXQgc3VwcG9ydHMgYm90aAogICAgLy8gICAgIHNUb2tlbiAoYnVybikgYW5kIGFUb2tlbiAodHJhbnNmZXIpIG1hcmtldHMuIFRoZSBhY3R1YWwgdG9rZW4gb3BlcmF0aW9ucwogICAgLy8gICAgIGFyZSBkZWxlZ2F0ZWQgdG8gX2RlYnRfcmVwYXltZW50X3B1cmUoKSB3aGljaCBjb3JyZWN0bHkgaGFuZGxlcyB0aGUKICAgIC8vICAgICBjcml0aWNhbCB0b2tlbiBidXJuL3RyYW5zZmVyIGxvZ2ljLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZDogVGhlIHVzZXIgSUQgdG8gcmVwYXkgdG9rZW5zIGZvcgogICAgLy8gICAgICAgICBtYXJrZXRfaWQ6IFRoZSBtYXJrZXQgSUQgdG8gcmVwYXkgdG9rZW5zIGZvcgogICAgLy8gICAgICAgICBhbW91bnQ6IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIHJlcGF5IChtdXN0IG5vdCBleGNlZWQgdG90YWwgZGVidCkKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIG1hcmtldCB2YWxpZGF0aW9uIGZhaWxzLCByZXBheSBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0LAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgIG9yIHByaW5jaXBhbCByZXBheW1lbnQgZXhjZWVkcyBzY2FsZWQgZGVidAogICAgLy8gCiAgICAvLyAgICAgUHJvY2VzczoKICAgIC8vICAgICAgICAgMS4gVmFsaWRhdGVzIG1hcmtldCBvcGVyYXRpb24gYW5kIGFjY3J1ZXMgaW50ZXJlc3QKICAgIC8vICAgICAgICAgMi4gR2V0cyB1c2VyIGFuZCBtYXJrZXQgc3RhdGUKICAgIC8vICAgICAgICAgMy4gQ2FsY3VsYXRlcyB0b3RhbCB1bmRlcmx5aW5nIGJvcnJvd3MgZm9yIHZhbGlkYXRpb24KICAgIC8vICAgICAgICAgNC4gVmFsaWRhdGVzIHJlcGF5IGFtb3VudCBkb2Vzbid0IGV4Y2VlZCB0b3RhbCBkZWJ0CiAgICAvLyAgICAgICAgIDUuIENhbGN1bGF0ZXMgc2NhbGVkIGFtb3VudCBmb3IgcHJpbmNpcGFsIHJlcGF5bWVudAogICAgLy8gICAgICAgICA2LiBWYWxpZGF0ZXMgc2NhbGVkIGFtb3VudCBkb2Vzbid0IGV4Y2VlZCB1c2VyJ3Mgc2NhbGVkIGRlYnQKICAgIC8vICAgICAgICAgNy4gQ2FsY3VsYXRlcyByZXBheSB2YWx1ZSBmb3IgZ2xvYmFsIHRyYWNraW5nCiAgICAvLyAgICAgICAgIDguIERlbGVnYXRlcyB0byBfZGVidF9yZXBheW1lbnRfcHVyZSgpIGZvcjoKICAgIC8vICAgICAgICAgICAgIC0gVG9rZW4gYnVybiAoc1Rva2VuKSBvciB0cmFuc2ZlciAoYVRva2VuKSBmcm9tIHVzZXIKICAgIC8vICAgICAgICAgICAgIC0gVXNlciBhbmQgbWFya2V0IHNjYWxlZCBib3Jyb3cgdXBkYXRlcwogICAgLy8gICAgICAgICAgICAgLSBHbG9iYWwgYm9ycm93IHZhbHVlIHRyYWNraW5nCiAgICAvLyAKICAgIC8vICAgICBTZWN1cml0eSBOb3RlOgogICAgLy8gICAgICAgICBUaGlzIG1ldGhvZCBjb3JyZWN0bHkgYnVybnMgc1Rva2VucyBmcm9tIHRoZSB1c2VyJ3MgYWRkcmVzcyAobm90IHRoZQogICAgLy8gICAgICAgICBwcm90b2NvbCBhZGRyZXNzKSBhcyBwZXIgdGhlIGZpeCBmb3IgREYtQVVELTAyLgogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIEZhbHNlKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdG90YWxfdW5kZXJseWluZ19ib3Jyb3dzID0gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd3MobWFya2V0KQogICAgLy8gICAgIGFzc2VydCBhbW91bnQgPD0gdG90YWxfdW5kZXJseWluZ19ib3Jyb3dzLCAiUmVwYXkgYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidCIKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gc2VsZi5fZ2V0X21hcmtldF9zY2FsZWRfYm9ycm93KG1hcmtldCwgYW1vdW50KQogICAgLy8gICAgIGFzc2VydCB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBzY2FsZWRfYW1vdW50LCAiUmVwYXkgYW1vdW50IGV4Y2VlZHMgZGVidCIKICAgIC8vICAgICByZXBheV92YWx1ZSA9IHNlbGYuX2dldF9tYXJrZXRfdmFsdWUobWFya2V0LCBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5fZGVidF9yZXBheW1lbnRfcHVyZSgKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBhbW91bnQsCiAgICAvLyAgICAgICAgIHNjYWxlZF9hbW91bnQsCiAgICAvLyAgICAgICAgIHJlcGF5X3ZhbHVlLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgRW1pdCBldmVudAogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldFJlcGF5KAogICAgLy8gICAgICMgICAgICAgICB1c2VyPWFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KG1hcmtldF9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIGFtb3VudD1hcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3JlcGF5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBzZWxmLl9yZXBheV9wdXJlKHVzZXJfaWQsIG1hcmtldF9pZCwgYW1vdW50KQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfZGVwb3NpdF9pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgc2VsZi5fcmVzb2x2ZV9hY2N1bXVsYXRlZF9ib3Jyb3dfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJldmlvdXNfcHJpY2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9sYXN0X3ByaWNlOiBCaWdVSW50LCBtYXJrZXRfcHJpY2U6IEJpZ1VJbnQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICByZXR1cm4gdXNlcl9sYXN0X3ByaWNlIGlmIHVzZXJfbGFzdF9wcmljZSA+IDAgZWxzZSBtYXJrZXRfcHJpY2UKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdXBkYXRlX3VzZXJfbWFya2V0X2NvbGxhdGVyYSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyOiBVc2VyRGF0YSwgbWFya2V0OiBNYXJrZXREYXRhCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgVXBkYXRlIGEgdXNlcidzIG1hcmtldCBjb2xsYXRlcmFsIHZhbHVlcyB3aGVuIG1hcmtldCBwcmljZXMgY2hhbmdlLgogICAgLy8gICAgICIiIgogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vIAogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBpZiB1c2VyJ3MgZGVwb3NpdF9pbmRleCBpcyAwIChuZXcgdXNlciksIHVzZSBjdXJyZW50IG1hcmtldCBpbmRleAogICAgLy8gICAgIHVzZXJfZGVwb3NpdF9pbmRleCA9ICgKICAgIC8vICAgICAgICAgdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIG9sZF9kZXBvc2l0X2Ftb3VudCA9ICh1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyX2RlcG9zaXRfaW5kZXgpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgcHJpY2VfZm9yX29sZCA9IHNlbGYuX2dldF9wcmV2aW91c19wcmljZSgKICAgIC8vICAgICAgICAgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSwgbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBvbGRfZGVwb3NpdF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19kZXBvc2l0X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKHVzZXJfaWQsIG9sZF9kZXBvc2l0X3ZhbHVlLCBuZXdfZGVwb3NpdF92YWx1ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdXBkYXRlX3VzZXJfbWFya2V0X2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcjogVXNlckRhdGEsIG1hcmtldDogTWFya2V0RGF0YQogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFVwZGF0ZSBhIHVzZXIncyBtYXJrZXQgYm9ycm93IHZhbHVlcyB3aGVuIG1hcmtldCBwcmljZXMgY2hhbmdlLgogICAgLy8gICAgICIiIgogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybgogICAgLy8gICAgIG9sZF9ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vICAgICBuZXdfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vICAgICBwcmljZV9mb3Jfb2xkID0gc2VsZi5fZ2V0X3ByZXZpb3VzX3ByaWNlKAogICAgLy8gICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlLCBtYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIG9sZF9ib3Jyb3dfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19ib3Jyb3dfdmFsdWUgPSAobmV3X2JvcnJvd19hbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cyh1c2VyX2lkLCBvbGRfYm9ycm93X3ZhbHVlLCBuZXdfYm9ycm93X3ZhbHVlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBVcGRhdGUgYSB1c2VyJ3MgZ2xvYmFsIHZhbHVlcyB3aGVuIG1hcmtldCBwcmljZXMgY2hhbmdlLgogICAgLy8gICAgICIiIgogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkuY29weSgpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMgPT0gMCBhbmQgdXNlci5zY2FsZWRfYm9ycm93cyA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfbWFya2V0X2NvbGxhdGVyYSh1c2VyX2lkLCB1c2VyLCBtYXJrZXQpCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfbWFya2V0X2JvcnJvd3ModXNlcl9pZCwgdXNlciwgbWFya2V0KQogICAgLy8gCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gR2xvYmFsVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IEdsb2JhbFVzZXJEYXRhOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi5nbG9iYWxfdXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9nbG9iYWxfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIGdsb2JhbF91c2VyCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgQmlnVUludCgwKSwKICAgIC8vICAgICAgICAgYW1vdW50LAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBhbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBhbW91bnQsCiAgICAvLyAgICAgICAgIEJpZ1VJbnQoMCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIG9sZF92YWx1ZTogQmlnVUludCwKICAgIC8vICAgICBuZXdfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vICAgICBpZiBvbGRfdmFsdWUgPiBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZToKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZSA9IGFyYzQuVUludDI1NihuZXdfdmFsdWUpCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZSA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gb2xkX3ZhbHVlICsgbmV3X3ZhbHVlCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICBnbG9iYWxfdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnNbdXNlcl9pZF0gPSBnbG9iYWxfdXNlci5jb3B5KCkKICAgIC8vICAgICBoZWFsdGggPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9oZWFsdGgoCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlLAogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlLAogICAgLy8gICAgICAgICBVSW50NjQoODAwMCksICAjIDgwJSBsaXF1aWRhdGlvbiB0aHJlc2hvbGQKICAgIC8vICAgICApCiAgICAvLyAgICAgYXJjNC5lbWl0KAogICAgLy8gICAgICAgICBVc2VySGVhbHRoKAogICAgLy8gICAgICAgICAgICAgdXNlcl9pZD1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBoZWFsdGhfZmFjdG9yPWFyYzQuVUludDI1NihoZWFsdGgpLAogICAgLy8gICAgICAgICAgICAgdG90YWxfY29sbGF0ZXJhbF92YWx1ZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICAgICB0b3RhbF9ib3Jyb3dfdmFsdWU9YXJjNC5VSW50MjU2KGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGFtb3VudDogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3ModXNlcl9pZCwgQmlnVUludCgwKSwgYW1vdW50KQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGFtb3VudDogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3ModXNlcl9pZCwgYW1vdW50LCBCaWdVSW50KDApKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIG9sZF92YWx1ZTogQmlnVUludCwKICAgIC8vICAgICBuZXdfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vICAgICBpZiBvbGRfdmFsdWUgPiBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlOgogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPSBhcmM0LlVJbnQyNTYobmV3X3ZhbHVlKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZSA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXSA9IGdsb2JhbF91c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBsaXF1aWRhdGVfY3Jvc3NfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgZGVidF9tYXJrZXRfaWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICB1c2VyOiBhcmM0LkFkZHJlc3MsCiAgICAvLyAgICAgZGVidF9hbW91bnQ6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogYXJjNC5VSW50MjU2LAogICAgLy8gKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCg0OTAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QoZGVidF9tYXJrZXRfaWQubmF0aXZlKQogICAgLy8gICAgIHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChjb2xsYXRlcmFsX21hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgZGVidF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICAgICAgdXNlci5uYXRpdmUsIGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl9yZXNvbHZlX2FjY3VtdWxhdGVkX2RlcG9zaXRfaW50ZXJlc3QodXNlci5uYXRpdmUsIGRlYnRfbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLl9yZXNvbHZlX2FjY3VtdWxhdGVkX2JvcnJvd19pbnRlcmVzdCh1c2VyLm5hdGl2ZSwgZGVidF9tYXJrZXRfaWQubmF0aXZlKQogICAgLy8gICAgIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfZGVwb3NpdF9pbnRlcmVzdCgKICAgIC8vICAgICAgICAgdXNlci5uYXRpdmUsIGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl9yZXNvbHZlX2FjY3VtdWxhdGVkX2JvcnJvd19pbnRlcmVzdCgKICAgIC8vICAgICAgICAgdXNlci5uYXRpdmUsIGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBzZWxmLl9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X3B1cmUoCiAgICAvLyAgICAgICAgICAgICBkZWJ0X21hcmtldF9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBjb2xsYXRlcmFsX21hcmtldF9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBUeG4uc2VuZGVyLAogICAgLy8gICAgICAgICAgICAgdXNlci5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBkZWJ0X2Ftb3VudC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlYnRfYm9ycm93X3B1cmUoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGJlbmVmaWNpYXJ5X2lkOiBBY2NvdW50LAogICAgLy8gICAgIG1hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGFtb3VudDogQmlnVUludCwKICAgIC8vICAgICBzY2FsZWRfYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHZhbHVlOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBTVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyhiZW5lZmljaWFyeV9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgICAgIHJlY2VpdmVyPUFwcGxpY2F0aW9uKG1hcmtldF9pZCkuYWRkcmVzcywgYW1vdW50PTEwMDAwMCwgZmVlPTAKICAgIC8vICAgICAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoYmVuZWZpY2lhcnlfaWQpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X2dsb2JhbF9ib3Jyb3dzKHVzZXJfaWQsIHZhbHVlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9oZWFsdGgoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBjb2xsYXRlcmFsX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIGJvcnJvd192YWx1ZTogQmlnVUludCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IFVJbnQ2NCwKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICBpZiBib3Jyb3dfdmFsdWUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIEJpZ1VJbnQoMTAwMDApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgcmV0dXJuICgKICAgIC8vICAgICAgICAgICAgIGNvbGxhdGVyYWxfdmFsdWUgKiBCaWdVSW50KGxpcXVpZGF0aW9uX3RocmVzaG9sZCkgKiBCaWdVSW50KDEwMDAwKQogICAgLy8gICAgICAgICApIC8vIChib3Jyb3dfdmFsdWUgKiBCaWdVSW50KDEwMDAwKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9wdXJlKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgZGVidF9tYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0b3JfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICByZXBheV9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQ6IEJpZ1VJbnQsCiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgTGlxdWlkYXRlIGEgdXNlcidzIHVuZGVyY29sbGF0ZXJhbGl6ZWQgcG9zaXRpb24gYWNyb3NzIGRpZmZlcmVudCBtYXJrZXRzLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgYWxsb3dzIGEgbGlxdWlkYXRvciB0byByZXBheSBhIHBvcnRpb24gb2YgYSB1c2VyJ3MgZGVidCBpbiBvbmUgbWFya2V0CiAgICAvLyAgICAgYW5kIHJlY2VpdmUgY29sbGF0ZXJhbCBmcm9tIGFub3RoZXIgbWFya2V0IGFzIGNvbXBlbnNhdGlvbi4gVGhlIGxpcXVpZGF0aW9uIGluY2x1ZGVzCiAgICAvLyAgICAgYSBib251cyB0byBpbmNlbnRpdml6ZSBsaXF1aWRhdG9ycyBhbmQgaGVscHMgbWFpbnRhaW4gcHJvdG9jb2wgaGVhbHRoIGJ5IHJlbW92aW5nCiAgICAvLyAgICAgdW5kZXJjb2xsYXRlcmFsaXplZCBwb3NpdGlvbnMuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICBkZWJ0X21hcmtldF9pZDogVGhlIG1hcmtldCBJRCB3aGVyZSB0aGUgZGVidCB0byBiZSByZXBhaWQgZXhpc3RzCiAgICAvLyAgICAgICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkOiBUaGUgbWFya2V0IElEIHdoZXJlIGNvbGxhdGVyYWwgd2lsbCBiZSBzZWl6ZWQgZnJvbQogICAgLy8gICAgICAgICBsaXF1aWRhdG9yX2lkOiBUaGUgYWNjb3VudCBwZXJmb3JtaW5nIHRoZSBsaXF1aWRhdGlvbgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgYWNjb3VudCBiZWluZyBsaXF1aWRhdGVkCiAgICAvLyAgICAgICAgIGRlYnRfYW1vdW50OiBUaGUgYW1vdW50IG9mIGRlYnQgdG8gcmVwYXkgKG11c3QgaW5jbHVkZSBhY2NydWVkIGludGVyZXN0KQogICAgLy8gICAgICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogTWluaW11bSBjb2xsYXRlcmFsIGFtb3VudCB0aGUgbGlxdWlkYXRvciBleHBlY3RzIHRvIHJlY2VpdmUKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIGFueSB2YWxpZGF0aW9uIGZhaWxzLCBpbmNsdWRpbmc6CiAgICAvLyAgICAgICAgICAgICAtIFVzaW5nIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCAoYm9ycm93LW9ubHkgbWFya2V0KQogICAgLy8gICAgICAgICAgICAgLSBBdHRlbXB0aW5nIHNlbGYtbGlxdWlkYXRpb24KICAgIC8vICAgICAgICAgICAgIC0gTWFya2V0IGRvZXNuJ3QgZXhpc3Qgb3IgaXMgcGF1c2VkCiAgICAvLyAgICAgICAgICAgICAtIFBvc2l0aW9uIGlzIG5vdCBsaXF1aWRhdGFibGUgKGhlYWx0aCBmYWN0b3IgPj0gMS4wKQogICAgLy8gICAgICAgICAgICAgLSBMaXF1aWRhdGlvbiBhbW91bnQgZXhjZWVkcyBtYXhpbXVtIGFsbG93ZWQgb3IgdG90YWwgZGVidAogICAgLy8gICAgICAgICAgICAgLSBJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCB0byBzZWl6ZQogICAgLy8gICAgICAgICAgICAgLSBDb2xsYXRlcmFsIHJlY2VpdmVkIGJlbG93IG1pbmltdW0gdGhyZXNob2xkCiAgICAvLyAKICAgIC8vICAgICBOb3RlczoKICAgIC8vICAgICAgICAgLSBVc2VzIHRoZSBjb2xsYXRlcmFsIG1hcmtldCdzIGxpcXVpZGF0aW9uIHRocmVzaG9sZCBmb3IgaGVhbHRoIGNhbGN1bGF0aW9uCiAgICAvLyAgICAgICAgIC0gTGlxdWlkYXRpb24gYm9udXMgaXMgYXBwbGllZCB0byBpbmNlbnRpdml6ZSBsaXF1aWRhdG9ycwogICAgLy8gICAgICAgICAtIEFjY3J1ZWQgaW50ZXJlc3Qgb24gYm90aCBkZWJ0IGFuZCBjb2xsYXRlcmFsIHBvc2l0aW9ucyBpcyBpbmNsdWRlZAogICAgLy8gICAgICAgICAtIEhhbmRsZXMgZGlmZmVyZW50IHRva2VuIHR5cGVzIChBUkMyMDAgdnMgU1Rva2VuKSBhcHByb3ByaWF0ZWx5CiAgICAvLyAgICAgICAgIC0gVXBkYXRlcyBnbG9iYWwgYm9ycm93IGFuZCBjb2xsYXRlcmFsIHZhbHVlcyBmb3IgdGhlIHVzZXIKICAgIC8vICAgICAiIiIKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIGxpcXVpZGF0ZSBvcGVyYXRpb24KICAgIC8vICAgICAjIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAjICAgICBkZWJ0X21hcmtldF9pZAogICAgLy8gICAgICMgKS5saXF1aWRhdGUubmF0aXZlCiAgICAvLyAgICAgIyBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAjICAgICBhc3NlcnQgZGVidF9hbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIkxpcXVpZGF0ZSBjYXAgZXhjZWVkZWQiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBSRU0gcHJldmVudCB1c2luZyBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgaW4gbGlxdWlkYXRpb24gYmVjYXVzZSBzdG9rZW4KICAgIC8vICAgICAjIFJFTSBtYXJrZXQgY29sbGF0ZXJhbCBkb2VzIG5vdCBleGlzdAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkICE9IHNlbGYuc3Rva2VuX2FwcF9pZAogICAgLy8gICAgICksICJDYW5ub3QgdXNlIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCAoYm9ycm93LW9ubHkgbWFya2V0KSIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgUkVNIHByZXZlbnQgc2VsZiBsaXF1aWRhdGlvbgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIGFzc2VydCB1c2VyX2lkICE9IGxpcXVpZGF0b3JfaWQsICJDYW5ub3QgbGlxdWlkYXRlIHNlbGYiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgZGVidF9tYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiRGVidCBtYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBmcmFtZV9kaWcgLTYKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMgogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyLTI3NDEKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICAjIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIC8vICAgICAgICAgbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgU2NhbGUgdGhlIHByaWNlIGJ5IFNDQUxFIGludGVybmFsbHkgZm9yIHN0b3JhZ2UKICAgIC8vICAgICBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRQcmljZVNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihwcmljZSkpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBmZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9mZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAxMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHBheW1lbnQgPD0gMTAwMDAwMAogICAgLy8gICAgICksICJwYXltZW50IGV4Y2VlZHMgbWF4aW11bSBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNgogICAgLy8gICAgIGFwcCA9IEFwcGxpY2F0aW9uKHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAgICAgaXR4bi5QYXltZW50KHJlY2VpdmVyPWFwcC5hZGRyZXNzLCBhbW91bnQ9cGF5bWVudCwgZmVlPTApLnN1Ym1pdCgpCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFByaWNlRmVlZFByb3ZpZGVySW50ZXJmYWNlLmdldF9wcmljZV93aXRoX3RpbWVzdGFtcCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICAgICAgPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgKToKICAgIC8vICAgICAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICAvLyAgICAgICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC5jb3B5KCkKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLCBwcmljZV93aXRoX3RpbWVzdGFtcC5wcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3BhdXNlX21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIHBhdXNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdLnBhdXNlZCA9IGFyYzQuQm9vbChwYXVzZSA9PSBVSW50NjQoMSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfbWFya2V0KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91dGlsaXphdGlvbihzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIG1hcmtldF9pZDogVUludDY0KSAtPiBCaWdVSW50OgogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBCaWdVSW50KDEwMDAwKSAgIyAxMDAlIHV0aWxpemF0aW9uIGZvciBib3Jyb3ctb25seSBtYXJrZXQKICAgIC8vICAgICBlbGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBCaWdVSW50KDApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgIyBBZGRpdGlvbmFsIHNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8KICAgIC8vICAgICAgICAgdG90YWxfZGVwb3NpdHMgPSBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB0b3RhbF9kZXBvc2l0cyA9PSAwOgogICAgLy8gICAgICAgICAgICAgcmV0dXJuIEJpZ1VJbnQoMCkKICAgIC8vICAgICAgICAgcmV0dXJuIChtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDApIC8vIHRvdGFsX2RlcG9zaXRzCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV9pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIHV0aWxpemF0aW9uOiBCaWdVSW50LCB0aW1lX2RlbHRhOiBVSW50NjQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBCaWdVSW50KDApCiAgICAvLyAgICAgcmF0ZSA9IG1hcmtldC5ib3Jyb3dfcmF0ZS5uYXRpdmUgKyAobWFya2V0LnNsb3BlLm5hdGl2ZSAqIHV0aWxpemF0aW9uKSAvLyAxMDAwMAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGludGVyZXN0IGJhc2VkIG9uIFNDQUxFRCBib3Jyb3dzLCBub3QgdW5kZXJseWluZwogICAgLy8gICAgICMgVGhpcyBwcmV2ZW50cyBkb3VibGUgY29tcG91bmRpbmcgYW5kIG1haW50YWlucyBjb25zaXN0ZW5jeSB3aXRoIHRoZSBhY2NvdW50aW5nIHN5c3RlbQogICAgLy8gICAgIHJldHVybiAocmF0ZSAqIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB0aW1lX2RlbHRhKSAvLyAoCiAgICAvLyAgICAgICAgIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfaW50ZXJlc3Rfc3BsaXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBtYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBzdG9rZW5fYXBwX2lkOiBVSW50NjQsCiAgICAvLyAgICAgaW50ZXJlc3Q6IEJpZ1VJbnQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IFVJbnQ2NCwKICAgIC8vICkgLT4gSW50ZXJlc3RTcGxpdDoKICAgIC8vICAgICAjIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHN0b2tlbiBtYXJrZXQgLSBhbGwgaW50ZXJlc3QgZ29lcyB0byByZXNlcnZlcwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IGludGVyZXN0CiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IChpbnRlcmVzdCAqIHJlc2VydmVfZmFjdG9yKSAvLyAxMDAwMAogICAgLy8gICAgICAgICBpZiBwcm90b2NvbF9wb3J0aW9uID4gaW50ZXJlc3Q6CiAgICAvLyAgICAgICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gaW50ZXJlc3QKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBpbnRlcmVzdCAtIHByb3RvY29sX3BvcnRpb24KICAgIC8vICAgICByZXR1cm4gSW50ZXJlc3RTcGxpdCgKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb249YXJjNC5VSW50MjU2KGRlcG9zaXRvcl9wb3J0aW9uKSwKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbj1hcmM0LlVJbnQyNTYocHJvdG9jb2xfcG9ydGlvbiksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hY2NydWVfaW50ZXJlc3Qoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgQWNjcnVlIGludGVyZXN0IGZvciBhIG1hcmtldCBiYXNlZCBvbiB0aW1lIGVsYXBzZWQgYW5kIHV0aWxpemF0aW9uLgogICAgLy8gICAgICIiIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGN1cnJlbnRfdGltZSA9IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wCiAgICAvLyAgICAgdGltZV9kZWx0YSA9IGN1cnJlbnRfdGltZSAtIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lLm5hdGl2ZQogICAgLy8gICAgIGlmIHRpbWVfZGVsdGEgPD0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgdXRpbGl6YXRpb24gPSBzZWxmLl9jYWxjdWxhdGVfdXRpbGl6YXRpb24obWFya2V0LCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXRpbGl6YXRpb24gPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfaW50ZXJlc3QobWFya2V0LCB1dGlsaXphdGlvbiwgdGltZV9kZWx0YSkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgSW50ZXJlc3QgZGlzdHJpYnV0aW9uCiAgICAvLyAgICAgaW50ZXJlc3Rfc3BsaXQgPSBzZWxmLl9jYWxjdWxhdGVfaW50ZXJlc3Rfc3BsaXQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgc2VsZi5zdG9rZW5fYXBwX2lkLCBpbnRlcmVzdCwgbWFya2V0LnJlc2VydmVfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgaWYgdXNlciBpbmRleGVzIGNhbiBncm93IG1lYW5pbmdmdWxseQogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8gZm9yIGZpcnN0IGRlcG9zaXRzL2JvcnJvd3MKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICBkZXBvc2l0b3JfaW5jcmVtZW50ID0gQmlnVUludCgwKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9pbmNyZW1lbnQgPSAoaW50ZXJlc3Rfc3BsaXQuZGVwb3NpdG9yX3BvcnRpb24ubmF0aXZlICogU0NBTEUpIC8vICgKICAgIC8vICAgICAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgYm9ycm93ZXJfaW5jcmVtZW50ID0gQmlnVUludCgwKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJvcnJvd2VyX2luY3JlbWVudCA9IChpbnRlcmVzdCAqIFNDQUxFKSAvLyAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIGlmIGRlcG9zaXRvcl9pbmNyZW1lbnQgPT0gMCBvciBib3Jyb3dlcl9pbmNyZW1lbnQgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgIyBtYXJrZXQgZGVwb3NpdCBpbmRleCB1cGRhdGUgZGVwZW5kcyBvbiBkZXBvc2l0b3IgcG9ydGlvbiBvZiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICsgZGVwb3NpdG9yX2luY3JlbWVudAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIG1hcmtldCBib3Jyb3cgaW5kZXggdXBkYXRlIGRlcGVuZHMgb24gZnVsbCBpbnRlcmVzdCBhbW91bnQKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPiAwOgogICAgLy8gICAgICAgICBtYXJrZXQuYm9ycm93X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgKyBib3Jyb3dlcl9pbmNyZW1lbnQKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBtYXJrZXQgdG90YWwgc2NhbGVkIGJvcnJvd3MgdXBkYXRlIGRlcGVuZHMgb24gZnVsbCBpbnRlcmVzdCBhbW91bnQKICAgIC8vICAgICAjIENvbnZlcnQgaW50ZXJlc3QgdG8gc2NhbGVkIGJvcnJvd3MgdXNpbmcgY3VycmVudCBtYXJrZXQgaW5kZXgKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogZW5zdXJlIGJvcnJvd19pbmRleCBpcyBuZXZlciAwCiAgICAvLyAgICAgYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICBpZiBib3Jyb3dfaW5kZXggPT0gMDoKICAgIC8vICAgICAgICAgYm9ycm93X2luZGV4ID0gQmlnVUludChTQ0FMRSkKICAgIC8vICAgICBpbnRlcmVzdF9zY2FsZWRfYm9ycm93cyA9IChpbnRlcmVzdCAqIFNDQUxFKSAvLyBib3Jyb3dfaW5kZXgKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBpbnRlcmVzdF9zY2FsZWRfYm9ycm93cwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgbWFya2V0IHRvdGFsIHNjYWxlZCBkZXBvc2l0cyB1cGRhdGUgZGVwZW5kcyBvbiBkZXBvc2l0b3IgcG9ydGlvbiBvZiBpbnRlcmVzdAogICAgLy8gICAgICMgQ29udmVydCBkZXBvc2l0b3IgcG9ydGlvbiB0byBzY2FsZWQgZGVwb3NpdHMgdXNpbmcgY3VycmVudCBtYXJrZXQgaW5kZXgKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogZW5zdXJlIGRlcG9zaXRfaW5kZXggaXMgbmV2ZXIgMAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICBpZiBkZXBvc2l0X2luZGV4ID09IDA6CiAgICAvLyAgICAgICAgIGRlcG9zaXRfaW5kZXggPSBCaWdVSW50KFNDQUxFKQogICAgLy8gICAgIGRlcG9zaXRvcl9zY2FsZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICBpbnRlcmVzdF9zcGxpdC5kZXBvc2l0b3JfcG9ydGlvbi5uYXRpdmUgKiBTQ0FMRQogICAgLy8gICAgICkgLy8gZGVwb3NpdF9pbmRleAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgZGVwb3NpdG9yX3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIG1hcmtldCByZXNlcnZlcyB1cGRhdGUgZGVwZW5kcyBvbiBwcm90b2NvbCBwb3J0aW9uIG9mIGludGVyZXN0CiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQucmVzZXJ2ZXMubmF0aXZlICsgaW50ZXJlc3Rfc3BsaXQucHJvdG9jb2xfcG9ydGlvbi5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KGN1cnJlbnRfdGltZSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gIyBUT0RPIGdvdmVybmFuY2U6IGNvbnNpZGVyIGlmIHJlc2VydmUgd2l0aGRyYXdhbCBzaG91bGQgcmVxdWlyZSBhZGRpdGlvbmFsCiAgICAvLyAjICAgICAgZ292ZXJuYW5jZSBtZWNoYW5pc21zCiAgICAvLyAjIFRPRE8gbWluaW11bSByZXNlcnZlIGxldmVsczogbWlnaHQgd2FudCB0byBlbmZvcmNlIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHMgZm9yCiAgICAvLyAjICAgICAgcHJvdG9jb2wgc2FmZXR5CiAgICAvLyAjIFRPRE8gZXZlbnQgZW1pc3Npb246IENvbnNpZGVyIGFkZGluZyBhbiBldmVudCB0byBsb2cgcmVzZXJ2ZSB3aXRoZHJhd2FscyBmb3IKICAgIC8vICMgICAgICB0cmFuc3BhcmVuY3kKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fd2l0aGRyYXdfcmVzZXJ2ZXMobWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX3dpdGhkcmF3X3Jlc2VydmVzX3B1cmUobWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3X3Jlc2VydmVzX3B1cmUoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBtYXJrZXQucmVzZXJ2ZXMubmF0aXZlID49IGFtb3VudCwgIkluc3VmZmljaWVudCByZXNlcnZlcyIKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbigKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50LCBndWFyZF9zdG9rZW46IGJvb2wKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCBhbW91bnQgPiAwLCAiQW1vdW50IG11c3QgYmUgPiAwIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBub3QgbWFya2V0LnBhdXNlZCwgIk1hcmtldCBpcyBwYXVzZWQiCiAgICAvLyAgICAgaWYgZ3VhcmRfc3Rva2VuOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgLy8gICAgICAgICApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGZvciB0aGlzIG9wZXJhdGlvbiIKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUmVzb2x2ZSAoY2xhaW0vY29tcG91bmQpIGFjY3VtdWxhdGVkIGludGVyZXN0IGZvciBhIHVzZXIncyBkZXBvc2l0IHBvc2l0aW9uLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBmdW5jdGlvbiBoYW5kbGVzIHRoZSBpbnRlcmVzdCB0aGF0IGhhcyBhY2NydWVkIHNpbmNlIHRoZSB1c2VyJ3MgbGFzdAogICAgLy8gICAgIGludGVyYWN0aW9uIGJ5IGNvbnZlcnRpbmcgaXQgdG8gYWRkaXRpb25hbCBzY2FsZWQgZGVwb3NpdHMuIFRoaXMgbWFrZXMKICAgIC8vICAgICBzdWJzZXF1ZW50IG9wZXJhdGlvbnMgcHVyZWx5IGFkZGl0aXZlIHNpbmNlIHRoZSBpbnRlcmVzdCBoYXMgYWxyZWFkeSBiZWVuCiAgICAvLyAgICAgInBhaWQgb3V0Ii4KICAgIC8vIAogICAgLy8gICAgIE5vdGU6IFRoaXMgZnVuY3Rpb24gYXNzdW1lcyB0aGF0IGludGVyZXN0IGhhcyBhbHJlYWR5IGJlZW4gYWNjcnVlZCBieSB0aGUKICAgIC8vICAgICBjYWxsZXIgKGUuZy4sIHZpYSBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKSB0byBhdm9pZAogICAgLy8gICAgIGRvdWJsZSBpbnRlcmVzdCBhY2NydWFsLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCAoVUludDY0KTogVGhlIElEIG9mIHRoZSBtYXJrZXQKICAgIC8vICAgICAiIiIKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0X3dpdGhfZGF0YSh1c2VyLCBtYXJrZXQpCiAgICAvLyAgICAgaWYgaW50ZXJlc3QgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuCiAgICAvLyAgICAgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCA9IHNlbGYuX2dldF9tYXJrZXRfc2NhbGVkX2RlcG9zaXQobWFya2V0LCBpbnRlcmVzdCkKICAgIC8vICAgICBpbnRlcmVzdF92YWx1ZSA9IHNlbGYuX2dldF9tYXJrZXRfdmFsdWUobWFya2V0LCBpbnRlcmVzdCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgdXNlcl9pZCwgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwodXNlcl9pZCwgQmlnVUludCgwKSwgaW50ZXJlc3RfdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUmVzb2x2ZSAoY2xhaW0vY29tcG91bmQpIGFjY3VtdWxhdGVkIGludGVyZXN0IGZvciBhIHVzZXIncyBib3Jyb3cgcG9zaXRpb24uCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhKHVzZXIsIG1hcmtldCkKICAgIC8vICAgICBpZiBpbnRlcmVzdCA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vICAgICBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gc2VsZi5fZ2V0X21hcmtldF9zY2FsZWRfYm9ycm93KG1hcmtldCwgaW50ZXJlc3QpCiAgICAvLyAgICAgaW50ZXJlc3RfdmFsdWUgPSBzZWxmLl9nZXRfbWFya2V0X3ZhbHVlKG1hcmtldCwgaW50ZXJlc3QpCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIHVzZXJfaWQsIGludGVyZXN0X3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKHVzZXJfaWQsIEJpZ1VJbnQoMCksIGludGVyZXN0X3ZhbHVlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdHMoc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdF9hbW91bnQoCiAgICAvLyAgICAgICAgIG1hcmtldCwgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzKHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSkgLT4gQmlnVUludDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd19hbW91bnQoCiAgICAvLyAgICAgICAgIG1hcmtldCwgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRfYW1vdW50KAogICAgLy8gICAgIHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dfYW1vdW50KAogICAgLy8gICAgIHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF9zY2FsZWRfZGVwb3NpdCgKICAgIC8vICAgICBzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBlbnN1cmUgZGVwb3NpdF9pbmRleCBpcyBuZXZlciAwIHRvIHByZXZlbnQgZGl2aXNpb24gYnkgemVybwogICAgLy8gICAgICMgSWYgZGVwb3NpdF9pbmRleCBpcyAwLCBpbml0aWFsaXplIGl0IHRvIFNDQUxFICgxLjApCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgIGlmIGRlcG9zaXRfaW5kZXggPT0gMDoKICAgIC8vICAgICAgICAgZGVwb3NpdF9pbmRleCA9IEJpZ1VJbnQoU0NBTEUpCiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBTQ0FMRSkgLy8gZGVwb3NpdF9pbmRleAogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3coc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhLCBhbW91bnQ6IEJpZ1VJbnQpIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGVuc3VyZSBib3Jyb3dfaW5kZXggaXMgbmV2ZXIgMCB0byBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8KICAgIC8vICAgICAjIElmIGJvcnJvd19pbmRleCBpcyAwLCBpbml0aWFsaXplIGl0IHRvIFNDQUxFICgxLjApCiAgICAvLyAgICAgYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICBpZiBib3Jyb3dfaW5kZXggPT0gMDoKICAgIC8vICAgICAgICAgYm9ycm93X2luZGV4ID0gQmlnVUludChTQ0FMRSkKICAgIC8vICAgICByZXR1cm4gKGFtb3VudCAqIFNDQUxFKSAvLyBib3Jyb3dfaW5kZXgKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF92YWx1ZShzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIGFtb3VudDogQmlnVUludCkgLT4gQmlnVUludDoKICAgIC8vICAgICByZXR1cm4gKGFtb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRlcG9zaXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyODAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX2RlcG9zaXQoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVwb3NpdF9wdXJlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBQdXJlIGRlcG9zaXQgb3BlcmF0aW9uIHRoYXQgYWRkcyBuZXcgZnVuZHMgd2l0aG91dCBoYW5kbGluZyBpbnRlcmVzdC4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgZnVuY3Rpb24gYXNzdW1lcyB0aGF0IGFueSBhY2N1bXVsYXRlZCBpbnRlcmVzdCBoYXMgYWxyZWFkeSBiZWVuIHJlc29sdmVkCiAgICAvLyAgICAgYnkgY2FsbGluZyBfcmVzb2x2ZV9hY2N1bXVsYXRlZF9pbnRlcmVzdCgpIGJlZm9yZWhhbmQuIEl0IHBlcmZvcm1zIG9ubHkgdGhlCiAgICAvLyAgICAgZGVwb3NpdCBvcGVyYXRpb24sIG1ha2luZyBpdCBwdXJlbHkgYWRkaXRpdmUuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkIChBY2NvdW50KTogVGhlIGFjY291bnQgSUQgb2YgdGhlIHVzZXIgbWFraW5nIHRoZSBkZXBvc2l0CiAgICAvLyAgICAgICAgIG1hcmtldF9pZCAoVUludDY0KTogVGhlIElEIG9mIHRoZSBtYXJrZXQgdG8gZGVwb3NpdCBpbnRvCiAgICAvLyAgICAgICAgIGFtb3VudCAoQmlnVUludCk6IFRoZSBhbW91bnQgb2YgdW5kZXJseWluZyB0b2tlbnMgdG8gZGVwb3NpdAogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgZGVwb3NpdCBvcGVyYXRpb24KICAgIC8vICAgICAjIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAjICAgICBtYXJrZXRfaWQKICAgIC8vICAgICAjICkuZGVwb3NpdC5uYXRpdmUKICAgIC8vICAgICAjIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICMgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiRGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdHMgPSBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdHMobWFya2V0KQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC5tYXhfdG90YWxfZGVwb3NpdHMubmF0aXZlID49IG1hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRzICsgYW1vdW50CiAgICAvLyAgICAgKSwgIk1hcmtldCBkZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gc2VsZi5fZ2V0X21hcmtldF9zY2FsZWRfZGVwb3NpdChtYXJrZXQsIGFtb3VudCkKICAgIC8vICAgICBkZXBvc2l0X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGFtb3VudCkKICAgIC8vICAgICBzZWxmLl9jb2xsYXRlcmFsX2RlcG9zaXRfcHVyZSgKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgYW1vdW50LAogICAgLy8gICAgICAgICBzY2FsZWRfYW1vdW50LAogICAgLy8gICAgICAgICBkZXBvc2l0X3ZhbHVlLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVwb3NpdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIEludGVybmFsIGRlcG9zaXQgbWV0aG9kIHRoYXQgaGFuZGxlcyB1c2VyIGRlcG9zaXRzIGludG8gYSBsZW5kaW5nIG1hcmtldC4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIHBlcmZvcm1zIGEgY29tcGxldGUgZGVwb3NpdCBvcGVyYXRpb24gd2l0aCBzZXBhcmF0ZWQgY29uY2VybnM6CiAgICAvLyAgICAgMS4gU3luY3MgdXNlciBtYXJrZXQgZm9yIHByaWNlIGNoYW5nZXMgKGFjY3J1ZXMgaW50ZXJlc3QsIHVwZGF0ZXMgZ2xvYmFsIHZhbHVlcywgcmVzb2x2ZXMgaW50ZXJlc3QpCiAgICAvLyAgICAgMi4gUGVyZm9ybXMgcHVyZSBkZXBvc2l0IG9wZXJhdGlvbiAoYWRkcyBuZXcgZnVuZHMgd2l0aG91dCBpbnRlcmVzdCBoYW5kbGluZykKICAgIC8vIAogICAgLy8gICAgIFRoZSBzZXBhcmF0aW9uIGVuc3VyZXM6CiAgICAvLyAgICAgLSBTaW5nbGUgaW50ZXJlc3QgYWNjcnVhbCBwZXIgb3BlcmF0aW9uCiAgICAvLyAgICAgLSBDbGVhbiBzZXBhcmF0aW9uIGJldHdlZW4gaW50ZXJlc3QgcmVzb2x1dGlvbiBhbmQgbmV3IGRlcG9zaXRzCiAgICAvLyAgICAgLSBDb25zaXN0ZW50IHByaWNlIHN5bmNocm9uaXphdGlvbgogICAgLy8gICAgIC0gUHVyZSBhZGRpdGl2ZSBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIG1ha2luZyB0aGUgZGVwb3NpdAogICAgLy8gICAgICAgICBtYXJrZXRfaWQgKFVJbnQ2NCk6IFRoZSBJRCBvZiB0aGUgbWFya2V0IHRvIGRlcG9zaXQgaW50bwogICAgLy8gICAgICAgICBhbW91bnQgKEJpZ1VJbnQpOiBUaGUgYW1vdW50IG9mIHVuZGVybHlpbmcgdG9rZW5zIHRvIGRlcG9zaXQKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIG1hcmtldCB2YWxpZGF0aW9uIGZhaWxzLCBkZXBvc2l0IGNhcCBpcyBleGNlZWRlZCwgb3Igb3RoZXIgY29uc3RyYWludHMgYXJlIHZpb2xhdGVkCiAgICAvLyAKICAgIC8vICAgICBOb3RlOgogICAgLy8gICAgICAgICAtIEFsbCBwcmljZSBjaGFuZ2VzIGFuZCBpbnRlcmVzdCByZXNvbHV0aW9uIGFyZSBoYW5kbGVkIGluIHRoZSBzeW5jIHN0ZXAKICAgIC8vICAgICAgICAgLSBUaGUgZGVwb3NpdCBvcGVyYXRpb24gaXMgcHVyZWx5IGFkZGl0aXZlLCBhZGRpbmcgb25seSB0aGUgbmV3IGFtb3VudAogICAgLy8gICAgICAgICAtIFVzZXIncyBnbG9iYWwgY29sbGF0ZXJhbC9ib3Jyb3cgdmFsdWVzIGFyZSB1cGRhdGVkIHdpdGggY3VycmVudCBwcmljZXMgZHVyaW5nIHN5bmMKICAgIC8vICAgICAiIiIKICAgIC8vICAgICAjIFN5bmMgdXNlciBtYXJrZXQgZm9yIHByaWNlIGNoYW5nZQogICAgLy8gICAgIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIFBlcmZvcm0gcHVyZSBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gICAgIHNlbGYuX2RlcG9zaXRfcHVyZSh1c2VyX2lkLCBtYXJrZXRfaWQsIGFtb3VudCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDcwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBpbnRlcmVzdCIiIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGEodXNlciwgbWFya2V0KQogICAgLy8gICAgIHJldHVybiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGEoCiAgICAvLyAgICAgc2VsZiwgdXNlcjogVXNlckRhdGEsIG1hcmtldDogTWFya2V0RGF0YQogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBpbnRlcmVzdCB1c2luZyBwcmUtZmV0Y2hlZCBkYXRhIiIiCiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIgaGFzIG5vIGRlcG9zaXRzLCByZXR1cm4gMCBpbnRlcmVzdAogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gQmlnVUludCgwKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgY3VycmVudCB1bmRlcmx5aW5nIHZhbHVlCiAgICAvLyAgICAgY3VycmVudF91bmRlcmx5aW5nID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB1bmRlcmx5aW5nIHZhbHVlIGF0IHVzZXIncyBsYXN0IHVwZGF0ZQogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBpZiB1c2VyJ3MgZGVwb3NpdF9pbmRleCBpcyAwIChuZXcgdXNlciksIHVzZSBjdXJyZW50IG1hcmtldCBpbmRleAogICAgLy8gICAgIHVzZXJfZGVwb3NpdF9pbmRleCA9ICgKICAgIC8vICAgICAgICAgdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBsYXN0X3VuZGVybHlpbmcgPSAodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogdXNlcl9kZXBvc2l0X2luZGV4KSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBJbnRlcmVzdCBpcyB0aGUgZGlmZmVyZW5jZQogICAgLy8gICAgIGlmIGN1cnJlbnRfdW5kZXJseWluZyA+IGxhc3RfdW5kZXJseWluZzoKICAgIC8vICAgICAgICAgaW50ZXJlc3QgPSBjdXJyZW50X3VuZGVybHlpbmcgLSBsYXN0X3VuZGVybHlpbmcKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBpbnRlcmVzdCA9IEJpZ1VJbnQoMCkKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgZGVidCBpbnRlcmVzdCIiIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0X3dpdGhfZGF0YSh1c2VyLCBtYXJrZXQpCiAgICAvLyAgICAgcmV0dXJuIGludGVyZXN0CiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhKAogICAgLy8gICAgIHNlbGYsIHVzZXI6IFVzZXJEYXRhLCBtYXJrZXQ6IE1hcmtldERhdGEKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgZGVidCBpbnRlcmVzdCB1c2luZyBwcmUtZmV0Y2hlZCBkYXRhIiIiCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgdW5kZXJseWluZyBkZWJ0IGFtb3VudAogICAgLy8gICAgIHVzZXJfdG90YWxfZGVidCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIG9yaWdpbmFsIHByaW5jaXBhbCBhbW91bnQgdXNpbmcgdXNlcidzIGJvcnJvd19pbmRleAogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBpZiB1c2VyJ3MgYm9ycm93X2luZGV4IGlzIDAsIHVzZSBjdXJyZW50IG1hcmtldCBib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyX2JvcnJvd19pbmRleCA9ICgKICAgIC8vICAgICAgICAgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBvcmlnaW5hbF9wcmluY2lwYWwgPSAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyX2JvcnJvd19pbmRleCkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRvdGFsIGRlYnQgYW5kIG9yaWdpbmFsIHByaW5jaXBhbAogICAgLy8gICAgICMgUHJldmVudCBuZWdhdGl2ZSBpbnRlcmVzdCAodW5kZXJmbG93IHByb3RlY3Rpb24pCiAgICAvLyAgICAgaWYgdXNlcl90b3RhbF9kZWJ0ID49IG9yaWdpbmFsX3ByaW5jaXBhbDoKICAgIC8vICAgICAgICAgZGVidF9pbnRlcmVzdCA9IHVzZXJfdG90YWxfZGVidCAtIG9yaWdpbmFsX3ByaW5jaXBhbAogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlYnRfaW50ZXJlc3QgPSBCaWdVSW50KDApCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gZGVidF9pbnRlcmVzdAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhdyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50MjU2KHNlbGYuX3dpdGhkcmF3KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jb2xsYXRlcmFsX2RlcG9zaXRfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbnRva2VuX2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhiZW5lZmljaWFyeV9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihzY2FsZWRfYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG50b2tlbl9pZCksCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgYmVuZWZpY2lhcnlfaWQsIHNjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9nbG9iYWxfY29sbGF0ZXJhbChiZW5lZmljaWFyeV9pZCwgdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NvbGxhdGVyYWxfd2l0aGRyYXdfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbnRva2VuX2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUHVyZSBjb2xsYXRlcmFsIHdpdGhkcmF3YWwgb3BlcmF0aW9uIHRoYXQgYnVybnMgblRva2VucyBhbmQgdHJhbnNmZXJzIHVuZGVybHlpbmcgdG9rZW5zLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgcGVyZm9ybXMgdGhlIGNvcmUgY29sbGF0ZXJhbCB3aXRoZHJhd2FsIGxvZ2ljIHdpdGhvdXQgaGFuZGxpbmcgaW50ZXJlc3QKICAgIC8vICAgICBjYWxjdWxhdGlvbnMgb3IgdmFsaWRhdGlvbnMuIEl0IGFzc3VtZXMgdGhhdCBhbGwgbmVjZXNzYXJ5IHZhbGlkYXRpb25zIGFuZCBpbnRlcmVzdAogICAgLy8gICAgIGFjY3J1YWxzIGhhdmUgYmVlbiBoYW5kbGVkIGJ5IHRoZSBjYWxsaW5nIG1ldGhvZCBiZWZvcmVoYW5kLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIHdpdGhkcmF3aW5nIGNvbGxhdGVyYWwKICAgIC8vICAgICAgICAgYmVuZWZpY2lhcnlfaWQgKEFjY291bnQpOiBUaGUgYWNjb3VudCBJRCB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgd2l0aGRyYXduIHRva2VucwogICAgLy8gICAgICAgICBtYXJrZXRfaWQgKFVJbnQ2NCk6IFRoZSBJRCBvZiB0aGUgbWFya2V0IGZyb20gd2hpY2ggY29sbGF0ZXJhbCBpcyBiZWluZyB3aXRoZHJhd24KICAgIC8vICAgICAgICAgbnRva2VuX2lkIChVSW50NjQpOiBUaGUgSUQgb2YgdGhlIG5Ub2tlbiBhcHBsaWNhdGlvbiB0byBidXJuIHRva2VucyBmcm9tCiAgICAvLyAgICAgICAgIGFtb3VudCAoQmlnVUludCk6IFRoZSBhY3R1YWwgYW1vdW50IG9mIHVuZGVybHlpbmcgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAvLyAgICAgICAgIHNjYWxlZF9hbW91bnQgKEJpZ1VJbnQpOiBUaGUgc2NhbGVkIGFtb3VudCBvZiBuVG9rZW5zIHRvIGJ1cm4KICAgIC8vICAgICAgICAgdmFsdWUgKEJpZ1VJbnQpOiBUaGUgVVNEIHZhbHVlIG9mIHRoZSBjb2xsYXRlcmFsIGJlaW5nIHdpdGhkcmF3bgogICAgLy8gCiAgICAvLyAgICAgUHJvY2VzczoKICAgIC8vICAgICAgICAgMS4gQnVybnMgdGhlIHNwZWNpZmllZCBzY2FsZWQgYW1vdW50IG9mIG5Ub2tlbnMgZnJvbSB0aGUgdXNlcgogICAgLy8gICAgICAgICAyLiBEZWNyZW1lbnRzIHRoZSB1c2VyJ3Mgc2NhbGVkIGRlcG9zaXQgYmFsYW5jZSBmb3IgdGhlIG1hcmtldAogICAgLy8gICAgICAgICAzLiBEZWNyZW1lbnRzIHRoZSB0b3RhbCBzY2FsZWQgZGVwb3NpdHMgZm9yIHRoZSBtYXJrZXQKICAgIC8vICAgICAgICAgNC4gVHJhbnNmZXJzIHRoZSB1bmRlcmx5aW5nIHRva2VucyB0byB0aGUgYmVuZWZpY2lhcnkKICAgIC8vICAgICAgICAgNS4gRGVjcmVtZW50cyB0aGUgdXNlcidzIGdsb2JhbCBjb2xsYXRlcmFsIHZhbHVlIHRyYWNraW5nCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoc2NhbGVkX2Ftb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihudG9rZW5faWQpLAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3MoYmVuZWZpY2lhcnlfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCB2YWx1ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcHVyZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUHVyZSB3aXRoZHJhdyBvcGVyYXRpb24gdGhhdCBidXJucyBuVG9rZW5zIGFuZCB0cmFuc2ZlcnMgdW5kZXJseWluZyB0b2tlbnMgdG8gdXNlci4KICAgIC8vICAgICAiIiIKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3Igd2l0aGRyYXcgb3BlcmF0aW9uCiAgICAvLyAgICAgIyBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgIyAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgIyApLndpdGhkcmF3Lm5hdGl2ZQogICAgLy8gICAgICMgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgIyAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiV2l0aGRyYXcgY2FwIGV4Y2VlZGVkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGFtb3VudCA8PSB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB0aGUgYWN0dWFsIHVuZGVybHlpbmcgYW1vdW50IHRvIHRyYW5zZmVyIHRvIHVzZXIKICAgIC8vICAgICAjIGFtb3VudCBpcyB0aGUgc2NhbGVkIGFtb3VudCAoblRva2VucyksIHdlIG5lZWQgdG8gY29udmVydCB0byB1bmRlcmx5aW5nCiAgICAvLyAgICAgdW5kZXJseWluZ19hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdF9hbW91bnQobWFya2V0LCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICB1bmRlcmx5aW5nX3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIHVuZGVybHlpbmdfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBoZWFsdGggY2hlY2s6IGVuc3VyZSB3aXRoZHJhdyB3b3VsZCBub3QgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgIGlmIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZSA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICB1bmRlcmx5aW5nX3ZhbHVlIDw9IGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlCiAgICAvLyAgICAgICAgICksICJXaXRoZHJhd2FsIHB1dHMgdXNlciBhdCByaXNrIG9mIGxpcXVpZGF0aW9uIgogICAgLy8gICAgICAgICByZW1haW5pbmdfY29sbGF0ZXJhbCA9ICgKICAgIC8vICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gdW5kZXJseWluZ192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIGFzc2VydCBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIDw9ICgKICAgIC8vICAgICAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsICogQmlnVUludChtYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgLy8gICAgICAgICApIC8vIEJpZ1VJbnQoMTAwMDApLCAiV2l0aGRyYXdhbCBwdXRzIHVzZXIgYXQgcmlzayBvZiBsaXF1aWRhdGlvbiIKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3Igd2l0aGRyYXcgb3BlcmF0aW9uCiAgICAvLyAgICAgIyB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgICMgaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9PSAwOgogICAgLy8gICAgICMgICAgIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCArIDg2NDAwKQogICAgLy8gICAgICMgZWxpZiB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lIDwgR2xvYmFsLmxhdGVzdF90aW1lc3RhbXA6CiAgICAvLyAgICAgIyAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIC8vICAgICAjICAgICB1c2VyX2NhcC50b3RhbF9saXF1aWRhdGlvbnMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIC8vICAgICAjICAgICB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIC8vICAgICAjIGlmIHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgIyAgICAgbmV3X3RvdGFsX3dpdGhkcmF3YWxzID0gdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMubmF0aXZlICsgYW1vdW50X3VzZF92YWx1ZQogICAgLy8gICAgICMgICAgIGFzc2VydCAoCiAgICAvLyAgICAgIyAgICAgICAgIG5ld190b3RhbF93aXRoZHJhd2FscyA8PSB1c2VyX2NhcC5kYWlseV93aXRoZHJhd2Fscy5uYXRpdmUKICAgIC8vICAgICAjICAgICApLCAiVXNlciB3aXRoZHJhdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAgICAgIyAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYobmV3X3RvdGFsX3dpdGhkcmF3YWxzKQogICAgLy8gICAgICMgICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLCB1c2VyX2NhcCkKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2NvbGxhdGVyYWxfd2l0aGRyYXdfcHVyZSgKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgdW5kZXJseWluZ19hbW91bnQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgdW5kZXJseWluZ192YWx1ZSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIEVtaXQgZXZlbnRzCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0V2l0aGRyYXcoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgYXJjNC5VSW50NjQobWFya2V0X2lkKSwgYXJjNC5VSW50MjU2KGFtb3VudCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gdW5kZXJseWluZ19hbW91bnQKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXcoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX3dpdGhkcmF3X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGJvcnJvdyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDI4MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fYm9ycm93KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2JvcnJvd19wdXJlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIGJvcnJvdyBvcGVyYXRpb24KICAgIC8vICAgICAjIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAjICAgICBtYXJrZXRfaWQKICAgIC8vICAgICAjICkuYm9ycm93Lm5hdGl2ZQogICAgLy8gICAgICMgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgIyAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQodXNlcl9pZCkKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSBVSW50NjQoMTAwMDAwKSwgIlBheW1lbnQgYW1vdW50IG11c3QgYmUgPj0gMC4xIgogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGN1cnJlbnQgbWFya2V0IHRvdGFsIGJvcnJvd3MgKGluY2x1ZGluZyBpbnRlcmVzdCkKICAgIC8vICAgICBtYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzID0gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd3MobWFya2V0KQogICAgLy8gCiAgICAvLyAgICAgIyBWYWxpZGF0ZSBhZ2FpbnN0IG1hcmtldC13aWRlIGJvcnJvdyBjYXAKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQubWF4X3RvdGFsX2JvcnJvd3MubmF0aXZlID49IG1hcmtldF91bmRlcmx5aW5nX2JvcnJvd3MgKyBhbW91bnQKICAgIC8vICAgICApLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgY29sbGF0ZXJhbCByZXF1aXJlbWVudHMgLSBleGNsdWRlIHNhbWUgbWFya2V0IGNvbGxhdGVyYWwgdG8gcHJldmVudAogICAgLy8gICAgICMgaW5lZmZpY2llbnQgc2FtZS1hc3NldCBib3Jyb3dpbmcKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgYm9ycm93X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IEJpZ1VJbnQoMCk6CiAgICAvLyAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICAgICAjIFVzZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBleGNsdWRlZF92YWx1ZSA9IChkZXBvc2l0ZWRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgaWYgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgPiBleGNsdWRlZF92YWx1ZToKICAgIC8vICAgICAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gKAogICAgLy8gICAgICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gZXhjbHVkZWRfdmFsdWUKICAgIC8vICAgICAgICAgICAgICkKICAgIC8vICAgICAgICAgZWxzZToKICAgIC8vICAgICAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gQmlnVUludCgwKQogICAgLy8gCiAgICAvLyAgICAgdG90YWxfYm9ycm93X3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSArIGJvcnJvd192YWx1ZQogICAgLy8gICAgIGFzc2VydCB0b3RhbF9ib3Jyb3dfdmFsdWUgPD0gKAogICAgLy8gICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSAqIEJpZ1VJbnQobWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICAgICApIC8vIEJpZ1VJbnQoMTAwMDApLCAiSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgYWNyb3NzIG1hcmtldHMiCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBleHBlY3RlZCBzY2FsZWQgYm9ycm93cwogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3cobWFya2V0LCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9kZWJ0X2JvcnJvd19wdXJlKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgc2NhbGVkX2Ftb3VudCwKICAgIC8vICAgICAgICAgYm9ycm93X3ZhbHVlLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgRW1pdCBldmVudAogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldEJvcnJvdygKICAgIC8vICAgICAjICAgICAgICAgdXNlcj1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHRva2VuX2lkPWFyYzQuVUludDY0KG1hcmtldF9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIGFtb3VudD1hcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2JvcnJvdyhzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgc2VsZi5fYm9ycm93X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHJlcGF5KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICBzZWxmLl9yZXBheShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWJ0X3JlcGF5bWVudF9wdXJlKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgcGF5ZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MocGF5ZXJfaWQpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKHBheWVyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAjIGFkanVzdCB1c2VyJ3Mgc2NhbGVkIGJvcnJvd3MKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgYmVuZWZpY2lhcnlfaWQsIHNjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhZGp1c3QgbWFya2V0J3MgdG90YWwgc2NhbGVkIGJvcnJvd3MKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICAjIGFkanVzdCBnbG9iYWwgYm9ycm93IHZhbHVlCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X2dsb2JhbF9ib3Jyb3dzKGJlbmVmaWNpYXJ5X2lkLCB2YWx1ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXlfcHVyZShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFJlcGF5IGJvcnJvd2VkIHRva2VucyBmb3IgYSBzcGVjaWZpYyBtYXJrZXQuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBoYW5kbGVzIHRoZSByZXBheW1lbnQgb2YgYm9ycm93ZWQgdG9rZW5zLiBJdCBzdXBwb3J0cyBib3RoCiAgICAvLyAgICAgc1Rva2VuIChidXJuKSBhbmQgYVRva2VuICh0cmFuc2ZlcikgbWFya2V0cy4gVGhlIGFjdHVhbCB0b2tlbiBvcGVyYXRpb25zCiAgICAvLyAgICAgYXJlIGRlbGVnYXRlZCB0byBfZGVidF9yZXBheW1lbnRfcHVyZSgpIHdoaWNoIGNvcnJlY3RseSBoYW5kbGVzIHRoZQogICAgLy8gICAgIGNyaXRpY2FsIHRva2VuIGJ1cm4vdHJhbnNmZXIgbG9naWMuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgdXNlciBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIG1hcmtldF9pZDogVGhlIG1hcmtldCBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIGFtb3VudDogVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gcmVwYXkgKG11c3Qgbm90IGV4Y2VlZCB0b3RhbCBkZWJ0KQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgbWFya2V0IHZhbGlkYXRpb24gZmFpbHMsIHJlcGF5IGFtb3VudCBleGNlZWRzIHRvdGFsIGRlYnQsCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgb3IgcHJpbmNpcGFsIHJlcGF5bWVudCBleGNlZWRzIHNjYWxlZCBkZWJ0CiAgICAvLyAKICAgIC8vICAgICBQcm9jZXNzOgogICAgLy8gICAgICAgICAxLiBWYWxpZGF0ZXMgbWFya2V0IG9wZXJhdGlvbiBhbmQgYWNjcnVlcyBpbnRlcmVzdAogICAgLy8gICAgICAgICAyLiBHZXRzIHVzZXIgYW5kIG1hcmtldCBzdGF0ZQogICAgLy8gICAgICAgICAzLiBDYWxjdWxhdGVzIHRvdGFsIHVuZGVybHlpbmcgYm9ycm93cyBmb3IgdmFsaWRhdGlvbgogICAgLy8gICAgICAgICA0LiBWYWxpZGF0ZXMgcmVwYXkgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vICAgICAgICAgNS4gQ2FsY3VsYXRlcyBzY2FsZWQgYW1vdW50IGZvciBwcmluY2lwYWwgcmVwYXltZW50CiAgICAvLyAgICAgICAgIDYuIFZhbGlkYXRlcyBzY2FsZWQgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHVzZXIncyBzY2FsZWQgZGVidAogICAgLy8gICAgICAgICA3LiBDYWxjdWxhdGVzIHJlcGF5IHZhbHVlIGZvciBnbG9iYWwgdHJhY2tpbmcKICAgIC8vICAgICAgICAgOC4gRGVsZWdhdGVzIHRvIF9kZWJ0X3JlcGF5bWVudF9wdXJlKCkgZm9yOgogICAgLy8gICAgICAgICAgICAgLSBUb2tlbiBidXJuIChzVG9rZW4pIG9yIHRyYW5zZmVyIChhVG9rZW4pIGZyb20gdXNlcgogICAgLy8gICAgICAgICAgICAgLSBVc2VyIGFuZCBtYXJrZXQgc2NhbGVkIGJvcnJvdyB1cGRhdGVzCiAgICAvLyAgICAgICAgICAgICAtIEdsb2JhbCBib3Jyb3cgdmFsdWUgdHJhY2tpbmcKICAgIC8vIAogICAgLy8gICAgIFNlY3VyaXR5IE5vdGU6CiAgICAvLyAgICAgICAgIFRoaXMgbWV0aG9kIGNvcnJlY3RseSBidXJucyBzVG9rZW5zIGZyb20gdGhlIHVzZXIncyBhZGRyZXNzIChub3QgdGhlCiAgICAvLyAgICAgICAgIHByb3RvY29sIGFkZHJlc3MpIGFzIHBlciB0aGUgZml4IGZvciBERi1BVUQtMDIuCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB0b3RhbF91bmRlcmx5aW5nX2JvcnJvd3MgPSBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfYm9ycm93cyhtYXJrZXQpCiAgICAvLyAgICAgYXNzZXJ0IGFtb3VudCA8PSB0b3RhbF91bmRlcmx5aW5nX2JvcnJvd3MsICJSZXBheSBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0IgogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3cobWFya2V0LCBhbW91bnQpCiAgICAvLyAgICAgYXNzZXJ0IHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IHNjYWxlZF9hbW91bnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyBkZWJ0IgogICAgLy8gICAgIHJlcGF5X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGFtb3VudCkKICAgIC8vICAgICBzZWxmLl9kZWJ0X3JlcGF5bWVudF9wdXJlKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgc2NhbGVkX2Ftb3VudCwKICAgIC8vICAgICAgICAgcmVwYXlfdmFsdWUsCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBFbWl0IGV2ZW50CiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0UmVwYXkoCiAgICAvLyAgICAgIyAgICAgICAgIHVzZXI9YXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQobWFya2V0X2lkKSwKICAgIC8vICAgICAjICAgICAgICAgYW1vdW50PWFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX3JlcGF5X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgc2VsZi5fcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBzZWxmLl9yZXNvbHZlX2FjY3VtdWxhdGVkX2JvcnJvd19pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmV2aW91c19wcmljZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2xhc3RfcHJpY2U6IEJpZ1VJbnQsIG1hcmtldF9wcmljZTogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHJldHVybiB1c2VyX2xhc3RfcHJpY2UgaWYgdXNlcl9sYXN0X3ByaWNlID4gMCBlbHNlIG1hcmtldF9wcmljZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfdXNlcl9tYXJrZXRfY29sbGF0ZXJhKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXI6IFVzZXJEYXRhLCBtYXJrZXQ6IE1hcmtldERhdGEKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBVcGRhdGUgYSB1c2VyJ3MgbWFya2V0IGNvbGxhdGVyYWwgdmFsdWVzIHdoZW4gbWFya2V0IHByaWNlcyBjaGFuZ2UuCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybgogICAgLy8gCiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIncyBkZXBvc2l0X2luZGV4IGlzIDAgKG5ldyB1c2VyKSwgdXNlIGN1cnJlbnQgbWFya2V0IGluZGV4CiAgICAvLyAgICAgdXNlcl9kZXBvc2l0X2luZGV4ID0gKAogICAgLy8gICAgICAgICB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXJfZGVwb3NpdF9pbmRleCkgLy8gU0NBTEUKICAgIC8vICAgICBuZXdfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vICAgICBwcmljZV9mb3Jfb2xkID0gc2VsZi5fZ2V0X3ByZXZpb3VzX3ByaWNlKAogICAgLy8gICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlLCBtYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIG9sZF9kZXBvc2l0X3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2RlcG9zaXRfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwodXNlcl9pZCwgb2xkX2RlcG9zaXRfdmFsdWUsIG5ld19kZXBvc2l0X3ZhbHVlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfdXNlcl9tYXJrZXRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyOiBVc2VyRGF0YSwgbWFya2V0OiBNYXJrZXREYXRhCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgVXBkYXRlIGEgdXNlcidzIG1hcmtldCBib3Jyb3cgdmFsdWVzIHdoZW4gbWFya2V0IHByaWNlcyBjaGFuZ2UuCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuCiAgICAvLyAgICAgb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIHByaWNlX2Zvcl9vbGQgPSBzZWxmLl9nZXRfcHJldmlvdXNfcHJpY2UoCiAgICAvLyAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUsIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgb2xkX2JvcnJvd192YWx1ZSA9IChvbGRfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2JvcnJvd192YWx1ZSA9IChuZXdfYm9ycm93X2Ftb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKHVzZXJfaWQsIG9sZF9ib3Jyb3dfdmFsdWUsIG5ld19ib3Jyb3dfdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFVwZGF0ZSBhIHVzZXIncyBnbG9iYWwgdmFsdWVzIHdoZW4gbWFya2V0IHByaWNlcyBjaGFuZ2UuCiAgICAvLyAgICAgIiIiCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKS5jb3B5KCkKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9PSAwIGFuZCB1c2VyLnNjYWxlZF9ib3Jyb3dzID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9tYXJrZXRfY29sbGF0ZXJhKHVzZXJfaWQsIHVzZXIsIG1hcmtldCkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9tYXJrZXRfYm9ycm93cyh1c2VyX2lkLCB1c2VyLCBtYXJrZXQpCiAgICAvLyAKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfZ2xvYmFsX3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBHbG9iYWxVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfZ2xvYmFsX3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gR2xvYmFsVXNlckRhdGE6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLmdsb2JhbF91c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X2dsb2JhbF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gZ2xvYmFsX3VzZXIKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBhbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBCaWdVSW50KDApLAogICAgLy8gICAgICAgICBhbW91bnQsCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGFtb3VudDogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgQmlnVUludCgwKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gICAgIGlmIG9sZF92YWx1ZSA+IGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlOgogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlID0gYXJjNC5VSW50MjU2KG5ld192YWx1ZSkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXSA9IGdsb2JhbF91c2VyLmNvcHkoKQogICAgLy8gICAgIGhlYWx0aCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2hlYWx0aCgKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUsCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUsCiAgICAvLyAgICAgICAgIFVJbnQ2NCg4MDAwKSwgICMgODAlIGxpcXVpZGF0aW9uIHRocmVzaG9sZAogICAgLy8gICAgICkKICAgIC8vICAgICBhcmM0LmVtaXQoCiAgICAvLyAgICAgICAgIFVzZXJIZWFsdGgoCiAgICAvLyAgICAgICAgICAgICB1c2VyX2lkPWFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGhlYWx0aF9mYWN0b3I9YXJjNC5VSW50MjU2KGhlYWx0aCksCiAgICAvLyAgICAgICAgICAgICB0b3RhbF9jb2xsYXRlcmFsX3ZhbHVlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgICAgIHRvdGFsX2JvcnJvd192YWx1ZT1hcmM0LlVJbnQyNTYoZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cyh1c2VyX2lkLCBCaWdVSW50KDApLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cyh1c2VyX2lkLCBhbW91bnQsIEJpZ1VJbnQoMCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gICAgIGlmIG9sZF92YWx1ZSA+IGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmU6CiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZSA9IGFyYzQuVUludDI1NihuZXdfdmFsdWUpCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSAtIG9sZF92YWx1ZSArIG5ld192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGxpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHVzZXI6IGFyYzQuQWRkcmVzcywKICAgIC8vICAgICBkZWJ0X2Ftb3VudDogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBhcmM0LlVJbnQyNTYsCiAgICAvLyApIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDQ5MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChkZWJ0X21hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgICAgIHVzZXIubmF0aXZlLCBkZWJ0X21hcmtldF9pZC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfZGVwb3NpdF9pbnRlcmVzdCh1c2VyLm5hdGl2ZSwgZGVidF9tYXJrZXRfaWQubmF0aXZlKQogICAgLy8gICAgIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0KHVzZXIubmF0aXZlLCBkZWJ0X21hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5fcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0KAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0KAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIHNlbGYuX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfcHVyZSgKICAgIC8vICAgICAgICAgICAgIGRlYnRfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIFR4bi5zZW5kZXIsCiAgICAvLyAgICAgICAgICAgICB1c2VyLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIGRlYnRfYW1vdW50Lm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVidF9ib3Jyb3dfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5taW50LAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKGJlbmVmaWNpYXJ5X2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICAgICAgcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgLy8gICAgICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyhiZW5lZmljaWFyeV9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfZ2xvYmFsX2JvcnJvd3ModXNlcl9pZCwgdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2hlYWx0aCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIGNvbGxhdGVyYWxfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyAgICAgYm9ycm93X3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogVUludDY0LAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIGlmIGJvcnJvd192YWx1ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gQmlnVUludCgxMDAwMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICByZXR1cm4gKAogICAgLy8gICAgICAgICAgICAgY29sbGF0ZXJhbF92YWx1ZSAqIEJpZ1VJbnQobGlxdWlkYXRpb25fdGhyZXNob2xkKSAqIEJpZ1VJbnQoMTAwMDApCiAgICAvLyAgICAgICAgICkgLy8gKGJvcnJvd192YWx1ZSAqIEJpZ1VJbnQoMTAwMDApKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X3B1cmUoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRvcl9pZDogQWNjb3VudCwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIHJlcGF5X2Ftb3VudDogQmlnVUludCwKICAgIC8vICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogQmlnVUludCwKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBMaXF1aWRhdGUgYSB1c2VyJ3MgdW5kZXJjb2xsYXRlcmFsaXplZCBwb3NpdGlvbiBhY3Jvc3MgZGlmZmVyZW50IG1hcmtldHMuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBhbGxvd3MgYSBsaXF1aWRhdG9yIHRvIHJlcGF5IGEgcG9ydGlvbiBvZiBhIHVzZXIncyBkZWJ0IGluIG9uZSBtYXJrZXQKICAgIC8vICAgICBhbmQgcmVjZWl2ZSBjb2xsYXRlcmFsIGZyb20gYW5vdGhlciBtYXJrZXQgYXMgY29tcGVuc2F0aW9uLiBUaGUgbGlxdWlkYXRpb24gaW5jbHVkZXMKICAgIC8vICAgICBhIGJvbnVzIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzIGFuZCBoZWxwcyBtYWludGFpbiBwcm90b2NvbCBoZWFsdGggYnkgcmVtb3ZpbmcKICAgIC8vICAgICB1bmRlcmNvbGxhdGVyYWxpemVkIHBvc2l0aW9ucy4KICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIGRlYnRfbWFya2V0X2lkOiBUaGUgbWFya2V0IElEIHdoZXJlIHRoZSBkZWJ0IHRvIGJlIHJlcGFpZCBleGlzdHMKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IFRoZSBtYXJrZXQgSUQgd2hlcmUgY29sbGF0ZXJhbCB3aWxsIGJlIHNlaXplZCBmcm9tCiAgICAvLyAgICAgICAgIGxpcXVpZGF0b3JfaWQ6IFRoZSBhY2NvdW50IHBlcmZvcm1pbmcgdGhlIGxpcXVpZGF0aW9uCiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSBhY2NvdW50IGJlaW5nIGxpcXVpZGF0ZWQKICAgIC8vICAgICAgICAgZGVidF9hbW91bnQ6IFRoZSBhbW91bnQgb2YgZGVidCB0byByZXBheSAobXVzdCBpbmNsdWRlIGFjY3J1ZWQgaW50ZXJlc3QpCiAgICAvLyAgICAgICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBNaW5pbXVtIGNvbGxhdGVyYWwgYW1vdW50IHRoZSBsaXF1aWRhdG9yIGV4cGVjdHMgdG8gcmVjZWl2ZQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgYW55IHZhbGlkYXRpb24gZmFpbHMsIGluY2x1ZGluZzoKICAgIC8vICAgICAgICAgICAgIC0gVXNpbmcgc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIChib3Jyb3ctb25seSBtYXJrZXQpCiAgICAvLyAgICAgICAgICAgICAtIEF0dGVtcHRpbmcgc2VsZi1saXF1aWRhdGlvbgogICAgLy8gICAgICAgICAgICAgLSBNYXJrZXQgZG9lc24ndCBleGlzdCBvciBpcyBwYXVzZWQKICAgIC8vICAgICAgICAgICAgIC0gUG9zaXRpb24gaXMgbm90IGxpcXVpZGF0YWJsZSAoaGVhbHRoIGZhY3RvciA+PSAxLjApCiAgICAvLyAgICAgICAgICAgICAtIExpcXVpZGF0aW9uIGFtb3VudCBleGNlZWRzIG1heGltdW0gYWxsb3dlZCBvciB0b3RhbCBkZWJ0CiAgICAvLyAgICAgICAgICAgICAtIEluc3VmZmljaWVudCBjb2xsYXRlcmFsIHRvIHNlaXplCiAgICAvLyAgICAgICAgICAgICAtIENvbGxhdGVyYWwgcmVjZWl2ZWQgYmVsb3cgbWluaW11bSB0aHJlc2hvbGQKICAgIC8vIAogICAgLy8gICAgIE5vdGVzOgogICAgLy8gICAgICAgICAtIFVzZXMgdGhlIGNvbGxhdGVyYWwgbWFya2V0J3MgbGlxdWlkYXRpb24gdGhyZXNob2xkIGZvciBoZWFsdGggY2FsY3VsYXRpb24KICAgIC8vICAgICAgICAgLSBMaXF1aWRhdGlvbiBib251cyBpcyBhcHBsaWVkIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzCiAgICAvLyAgICAgICAgIC0gQWNjcnVlZCBpbnRlcmVzdCBvbiBib3RoIGRlYnQgYW5kIGNvbGxhdGVyYWwgcG9zaXRpb25zIGlzIGluY2x1ZGVkCiAgICAvLyAgICAgICAgIC0gSGFuZGxlcyBkaWZmZXJlbnQgdG9rZW4gdHlwZXMgKEFSQzIwMCB2cyBTVG9rZW4pIGFwcHJvcHJpYXRlbHkKICAgIC8vICAgICAgICAgLSBVcGRhdGVzIGdsb2JhbCBib3Jyb3cgYW5kIGNvbGxhdGVyYWwgdmFsdWVzIGZvciB0aGUgdXNlcgogICAgLy8gICAgICIiIgogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgbGlxdWlkYXRlIG9wZXJhdGlvbgogICAgLy8gICAgICMgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICMgICAgIGRlYnRfbWFya2V0X2lkCiAgICAvLyAgICAgIyApLmxpcXVpZGF0ZS5uYXRpdmUKICAgIC8vICAgICAjIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICMgICAgIGFzc2VydCBkZWJ0X2Ftb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiTGlxdWlkYXRlIGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIFJFTSBwcmV2ZW50IHVzaW5nIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCBpbiBsaXF1aWRhdGlvbiBiZWNhdXNlIHN0b2tlbgogICAgLy8gICAgICMgUkVNIG1hcmtldCBjb2xsYXRlcmFsIGRvZXMgbm90IGV4aXN0CiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQgIT0gc2VsZi5zdG9rZW5fYXBwX2lkCiAgICAvLyAgICAgKSwgIkNhbm5vdCB1c2Ugc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIChib3Jyb3ctb25seSBtYXJrZXQpIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBSRU0gcHJldmVudCBzZWxmIGxpcXVpZGF0aW9uCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgYXNzZXJ0IHVzZXJfaWQgIT0gbGlxdWlkYXRvcl9pZCwgIkNhbm5vdCBsaXF1aWRhdGUgc2VsZiIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCBkZWJ0X21hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJEZWJ0IG1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIHN3YXAKICAgIGNvbmNhdAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3NDEKICAgIC8vIGFzc2VydCBkZWJ0X21hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJEZWJ0IG1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGFzc2VydCAvLyBEZWJ0IG1hcmtldCBkb2VzIG5vdCBleGlzdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyLTI3NDIKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICAjIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIC8vICAgICAgICAgbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgU2NhbGUgdGhlIHByaWNlIGJ5IFNDQUxFIGludGVybmFsbHkgZm9yIHN0b3JhZ2UKICAgIC8vICAgICBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRQcmljZVNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihwcmljZSkpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBmZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9mZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAxMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHBheW1lbnQgPD0gMTAwMDAwMAogICAgLy8gICAgICksICJwYXltZW50IGV4Y2VlZHMgbWF4aW11bSBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNgogICAgLy8gICAgIGFwcCA9IEFwcGxpY2F0aW9uKHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAgICAgaXR4bi5QYXltZW50KHJlY2VpdmVyPWFwcC5hZGRyZXNzLCBhbW91bnQ9cGF5bWVudCwgZmVlPTApLnN1Ym1pdCgpCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFByaWNlRmVlZFByb3ZpZGVySW50ZXJmYWNlLmdldF9wcmljZV93aXRoX3RpbWVzdGFtcCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICAgICAgPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgKToKICAgIC8vICAgICAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICAvLyAgICAgICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC5jb3B5KCkKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLCBwcmljZV93aXRoX3RpbWVzdGFtcC5wcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3BhdXNlX21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIHBhdXNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdLnBhdXNlZCA9IGFyYzQuQm9vbChwYXVzZSA9PSBVSW50NjQoMSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfbWFya2V0KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91dGlsaXphdGlvbihzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIG1hcmtldF9pZDogVUludDY0KSAtPiBCaWdVSW50OgogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBCaWdVSW50KDEwMDAwKSAgIyAxMDAlIHV0aWxpemF0aW9uIGZvciBib3Jyb3ctb25seSBtYXJrZXQKICAgIC8vICAgICBlbGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBCaWdVSW50KDApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgIyBBZGRpdGlvbmFsIHNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8KICAgIC8vICAgICAgICAgdG90YWxfZGVwb3NpdHMgPSBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB0b3RhbF9kZXBvc2l0cyA9PSAwOgogICAgLy8gICAgICAgICAgICAgcmV0dXJuIEJpZ1VJbnQoMCkKICAgIC8vICAgICAgICAgcmV0dXJuIChtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDApIC8vIHRvdGFsX2RlcG9zaXRzCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV9pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIHV0aWxpemF0aW9uOiBCaWdVSW50LCB0aW1lX2RlbHRhOiBVSW50NjQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBCaWdVSW50KDApCiAgICAvLyAgICAgcmF0ZSA9IG1hcmtldC5ib3Jyb3dfcmF0ZS5uYXRpdmUgKyAobWFya2V0LnNsb3BlLm5hdGl2ZSAqIHV0aWxpemF0aW9uKSAvLyAxMDAwMAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGludGVyZXN0IGJhc2VkIG9uIFNDQUxFRCBib3Jyb3dzLCBub3QgdW5kZXJseWluZwogICAgLy8gICAgICMgVGhpcyBwcmV2ZW50cyBkb3VibGUgY29tcG91bmRpbmcgYW5kIG1haW50YWlucyBjb25zaXN0ZW5jeSB3aXRoIHRoZSBhY2NvdW50aW5nIHN5c3RlbQogICAgLy8gICAgIHJldHVybiAocmF0ZSAqIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB0aW1lX2RlbHRhKSAvLyAoCiAgICAvLyAgICAgICAgIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfaW50ZXJlc3Rfc3BsaXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBtYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBzdG9rZW5fYXBwX2lkOiBVSW50NjQsCiAgICAvLyAgICAgaW50ZXJlc3Q6IEJpZ1VJbnQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IFVJbnQ2NCwKICAgIC8vICkgLT4gSW50ZXJlc3RTcGxpdDoKICAgIC8vICAgICAjIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHN0b2tlbiBtYXJrZXQgLSBhbGwgaW50ZXJlc3QgZ29lcyB0byByZXNlcnZlcwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IGludGVyZXN0CiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IChpbnRlcmVzdCAqIHJlc2VydmVfZmFjdG9yKSAvLyAxMDAwMAogICAgLy8gICAgICAgICBpZiBwcm90b2NvbF9wb3J0aW9uID4gaW50ZXJlc3Q6CiAgICAvLyAgICAgICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gaW50ZXJlc3QKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBpbnRlcmVzdCAtIHByb3RvY29sX3BvcnRpb24KICAgIC8vICAgICByZXR1cm4gSW50ZXJlc3RTcGxpdCgKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb249YXJjNC5VSW50MjU2KGRlcG9zaXRvcl9wb3J0aW9uKSwKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbj1hcmM0LlVJbnQyNTYocHJvdG9jb2xfcG9ydGlvbiksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hY2NydWVfaW50ZXJlc3Qoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgQWNjcnVlIGludGVyZXN0IGZvciBhIG1hcmtldCBiYXNlZCBvbiB0aW1lIGVsYXBzZWQgYW5kIHV0aWxpemF0aW9uLgogICAgLy8gICAgICIiIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGN1cnJlbnRfdGltZSA9IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wCiAgICAvLyAgICAgdGltZV9kZWx0YSA9IGN1cnJlbnRfdGltZSAtIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lLm5hdGl2ZQogICAgLy8gICAgIGlmIHRpbWVfZGVsdGEgPD0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgdXRpbGl6YXRpb24gPSBzZWxmLl9jYWxjdWxhdGVfdXRpbGl6YXRpb24obWFya2V0LCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXRpbGl6YXRpb24gPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfaW50ZXJlc3QobWFya2V0LCB1dGlsaXphdGlvbiwgdGltZV9kZWx0YSkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgSW50ZXJlc3QgZGlzdHJpYnV0aW9uCiAgICAvLyAgICAgaW50ZXJlc3Rfc3BsaXQgPSBzZWxmLl9jYWxjdWxhdGVfaW50ZXJlc3Rfc3BsaXQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgc2VsZi5zdG9rZW5fYXBwX2lkLCBpbnRlcmVzdCwgbWFya2V0LnJlc2VydmVfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgaWYgdXNlciBpbmRleGVzIGNhbiBncm93IG1lYW5pbmdmdWxseQogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8gZm9yIGZpcnN0IGRlcG9zaXRzL2JvcnJvd3MKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICBkZXBvc2l0b3JfaW5jcmVtZW50ID0gQmlnVUludCgwKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9pbmNyZW1lbnQgPSAoaW50ZXJlc3Rfc3BsaXQuZGVwb3NpdG9yX3BvcnRpb24ubmF0aXZlICogU0NBTEUpIC8vICgKICAgIC8vICAgICAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgYm9ycm93ZXJfaW5jcmVtZW50ID0gQmlnVUludCgwKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJvcnJvd2VyX2luY3JlbWVudCA9IChpbnRlcmVzdCAqIFNDQUxFKSAvLyAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIGlmIGRlcG9zaXRvcl9pbmNyZW1lbnQgPT0gMCBvciBib3Jyb3dlcl9pbmNyZW1lbnQgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgIyBtYXJrZXQgZGVwb3NpdCBpbmRleCB1cGRhdGUgZGVwZW5kcyBvbiBkZXBvc2l0b3IgcG9ydGlvbiBvZiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICsgZGVwb3NpdG9yX2luY3JlbWVudAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIG1hcmtldCBib3Jyb3cgaW5kZXggdXBkYXRlIGRlcGVuZHMgb24gZnVsbCBpbnRlcmVzdCBhbW91bnQKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPiAwOgogICAgLy8gICAgICAgICBtYXJrZXQuYm9ycm93X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgKyBib3Jyb3dlcl9pbmNyZW1lbnQKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBtYXJrZXQgdG90YWwgc2NhbGVkIGJvcnJvd3MgdXBkYXRlIGRlcGVuZHMgb24gZnVsbCBpbnRlcmVzdCBhbW91bnQKICAgIC8vICAgICAjIENvbnZlcnQgaW50ZXJlc3QgdG8gc2NhbGVkIGJvcnJvd3MgdXNpbmcgY3VycmVudCBtYXJrZXQgaW5kZXgKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogZW5zdXJlIGJvcnJvd19pbmRleCBpcyBuZXZlciAwCiAgICAvLyAgICAgYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICBpZiBib3Jyb3dfaW5kZXggPT0gMDoKICAgIC8vICAgICAgICAgYm9ycm93X2luZGV4ID0gQmlnVUludChTQ0FMRSkKICAgIC8vICAgICBpbnRlcmVzdF9zY2FsZWRfYm9ycm93cyA9IChpbnRlcmVzdCAqIFNDQUxFKSAvLyBib3Jyb3dfaW5kZXgKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBpbnRlcmVzdF9zY2FsZWRfYm9ycm93cwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgbWFya2V0IHRvdGFsIHNjYWxlZCBkZXBvc2l0cyB1cGRhdGUgZGVwZW5kcyBvbiBkZXBvc2l0b3IgcG9ydGlvbiBvZiBpbnRlcmVzdAogICAgLy8gICAgICMgQ29udmVydCBkZXBvc2l0b3IgcG9ydGlvbiB0byBzY2FsZWQgZGVwb3NpdHMgdXNpbmcgY3VycmVudCBtYXJrZXQgaW5kZXgKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogZW5zdXJlIGRlcG9zaXRfaW5kZXggaXMgbmV2ZXIgMAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICBpZiBkZXBvc2l0X2luZGV4ID09IDA6CiAgICAvLyAgICAgICAgIGRlcG9zaXRfaW5kZXggPSBCaWdVSW50KFNDQUxFKQogICAgLy8gICAgIGRlcG9zaXRvcl9zY2FsZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICBpbnRlcmVzdF9zcGxpdC5kZXBvc2l0b3JfcG9ydGlvbi5uYXRpdmUgKiBTQ0FMRQogICAgLy8gICAgICkgLy8gZGVwb3NpdF9pbmRleAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgZGVwb3NpdG9yX3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIG1hcmtldCByZXNlcnZlcyB1cGRhdGUgZGVwZW5kcyBvbiBwcm90b2NvbCBwb3J0aW9uIG9mIGludGVyZXN0CiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQucmVzZXJ2ZXMubmF0aXZlICsgaW50ZXJlc3Rfc3BsaXQucHJvdG9jb2xfcG9ydGlvbi5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KGN1cnJlbnRfdGltZSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gIyBUT0RPIGdvdmVybmFuY2U6IGNvbnNpZGVyIGlmIHJlc2VydmUgd2l0aGRyYXdhbCBzaG91bGQgcmVxdWlyZSBhZGRpdGlvbmFsCiAgICAvLyAjICAgICAgZ292ZXJuYW5jZSBtZWNoYW5pc21zCiAgICAvLyAjIFRPRE8gbWluaW11bSByZXNlcnZlIGxldmVsczogbWlnaHQgd2FudCB0byBlbmZvcmNlIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHMgZm9yCiAgICAvLyAjICAgICAgcHJvdG9jb2wgc2FmZXR5CiAgICAvLyAjIFRPRE8gZXZlbnQgZW1pc3Npb246IENvbnNpZGVyIGFkZGluZyBhbiBldmVudCB0byBsb2cgcmVzZXJ2ZSB3aXRoZHJhd2FscyBmb3IKICAgIC8vICMgICAgICB0cmFuc3BhcmVuY3kKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fd2l0aGRyYXdfcmVzZXJ2ZXMobWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX3dpdGhkcmF3X3Jlc2VydmVzX3B1cmUobWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3X3Jlc2VydmVzX3B1cmUoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBtYXJrZXQucmVzZXJ2ZXMubmF0aXZlID49IGFtb3VudCwgIkluc3VmZmljaWVudCByZXNlcnZlcyIKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbigKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50LCBndWFyZF9zdG9rZW46IGJvb2wKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCBhbW91bnQgPiAwLCAiQW1vdW50IG11c3QgYmUgPiAwIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBub3QgbWFya2V0LnBhdXNlZCwgIk1hcmtldCBpcyBwYXVzZWQiCiAgICAvLyAgICAgaWYgZ3VhcmRfc3Rva2VuOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgLy8gICAgICAgICApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGZvciB0aGlzIG9wZXJhdGlvbiIKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUmVzb2x2ZSAoY2xhaW0vY29tcG91bmQpIGFjY3VtdWxhdGVkIGludGVyZXN0IGZvciBhIHVzZXIncyBkZXBvc2l0IHBvc2l0aW9uLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBmdW5jdGlvbiBoYW5kbGVzIHRoZSBpbnRlcmVzdCB0aGF0IGhhcyBhY2NydWVkIHNpbmNlIHRoZSB1c2VyJ3MgbGFzdAogICAgLy8gICAgIGludGVyYWN0aW9uIGJ5IGNvbnZlcnRpbmcgaXQgdG8gYWRkaXRpb25hbCBzY2FsZWQgZGVwb3NpdHMuIFRoaXMgbWFrZXMKICAgIC8vICAgICBzdWJzZXF1ZW50IG9wZXJhdGlvbnMgcHVyZWx5IGFkZGl0aXZlIHNpbmNlIHRoZSBpbnRlcmVzdCBoYXMgYWxyZWFkeSBiZWVuCiAgICAvLyAgICAgInBhaWQgb3V0Ii4KICAgIC8vIAogICAgLy8gICAgIE5vdGU6IFRoaXMgZnVuY3Rpb24gYXNzdW1lcyB0aGF0IGludGVyZXN0IGhhcyBhbHJlYWR5IGJlZW4gYWNjcnVlZCBieSB0aGUKICAgIC8vICAgICBjYWxsZXIgKGUuZy4sIHZpYSBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKSB0byBhdm9pZAogICAgLy8gICAgIGRvdWJsZSBpbnRlcmVzdCBhY2NydWFsLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCAoVUludDY0KTogVGhlIElEIG9mIHRoZSBtYXJrZXQKICAgIC8vICAgICAiIiIKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0X3dpdGhfZGF0YSh1c2VyLCBtYXJrZXQpCiAgICAvLyAgICAgaWYgaW50ZXJlc3QgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuCiAgICAvLyAgICAgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCA9IHNlbGYuX2dldF9tYXJrZXRfc2NhbGVkX2RlcG9zaXQobWFya2V0LCBpbnRlcmVzdCkKICAgIC8vICAgICBpbnRlcmVzdF92YWx1ZSA9IHNlbGYuX2dldF9tYXJrZXRfdmFsdWUobWFya2V0LCBpbnRlcmVzdCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgdXNlcl9pZCwgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwodXNlcl9pZCwgQmlnVUludCgwKSwgaW50ZXJlc3RfdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUmVzb2x2ZSAoY2xhaW0vY29tcG91bmQpIGFjY3VtdWxhdGVkIGludGVyZXN0IGZvciBhIHVzZXIncyBib3Jyb3cgcG9zaXRpb24uCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhKHVzZXIsIG1hcmtldCkKICAgIC8vICAgICBpZiBpbnRlcmVzdCA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vICAgICBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gc2VsZi5fZ2V0X21hcmtldF9zY2FsZWRfYm9ycm93KG1hcmtldCwgaW50ZXJlc3QpCiAgICAvLyAgICAgaW50ZXJlc3RfdmFsdWUgPSBzZWxmLl9nZXRfbWFya2V0X3ZhbHVlKG1hcmtldCwgaW50ZXJlc3QpCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIHVzZXJfaWQsIGludGVyZXN0X3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKHVzZXJfaWQsIEJpZ1VJbnQoMCksIGludGVyZXN0X3ZhbHVlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdHMoc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdF9hbW91bnQoCiAgICAvLyAgICAgICAgIG1hcmtldCwgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzKHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSkgLT4gQmlnVUludDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd19hbW91bnQoCiAgICAvLyAgICAgICAgIG1hcmtldCwgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRfYW1vdW50KAogICAgLy8gICAgIHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dfYW1vdW50KAogICAgLy8gICAgIHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF9zY2FsZWRfZGVwb3NpdCgKICAgIC8vICAgICBzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBlbnN1cmUgZGVwb3NpdF9pbmRleCBpcyBuZXZlciAwIHRvIHByZXZlbnQgZGl2aXNpb24gYnkgemVybwogICAgLy8gICAgICMgSWYgZGVwb3NpdF9pbmRleCBpcyAwLCBpbml0aWFsaXplIGl0IHRvIFNDQUxFICgxLjApCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgIGlmIGRlcG9zaXRfaW5kZXggPT0gMDoKICAgIC8vICAgICAgICAgZGVwb3NpdF9pbmRleCA9IEJpZ1VJbnQoU0NBTEUpCiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBTQ0FMRSkgLy8gZGVwb3NpdF9pbmRleAogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3coc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhLCBhbW91bnQ6IEJpZ1VJbnQpIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGVuc3VyZSBib3Jyb3dfaW5kZXggaXMgbmV2ZXIgMCB0byBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8KICAgIC8vICAgICAjIElmIGJvcnJvd19pbmRleCBpcyAwLCBpbml0aWFsaXplIGl0IHRvIFNDQUxFICgxLjApCiAgICAvLyAgICAgYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICBpZiBib3Jyb3dfaW5kZXggPT0gMDoKICAgIC8vICAgICAgICAgYm9ycm93X2luZGV4ID0gQmlnVUludChTQ0FMRSkKICAgIC8vICAgICByZXR1cm4gKGFtb3VudCAqIFNDQUxFKSAvLyBib3Jyb3dfaW5kZXgKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF92YWx1ZShzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIGFtb3VudDogQmlnVUludCkgLT4gQmlnVUludDoKICAgIC8vICAgICByZXR1cm4gKGFtb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRlcG9zaXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyODAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX2RlcG9zaXQoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVwb3NpdF9wdXJlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBQdXJlIGRlcG9zaXQgb3BlcmF0aW9uIHRoYXQgYWRkcyBuZXcgZnVuZHMgd2l0aG91dCBoYW5kbGluZyBpbnRlcmVzdC4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgZnVuY3Rpb24gYXNzdW1lcyB0aGF0IGFueSBhY2N1bXVsYXRlZCBpbnRlcmVzdCBoYXMgYWxyZWFkeSBiZWVuIHJlc29sdmVkCiAgICAvLyAgICAgYnkgY2FsbGluZyBfcmVzb2x2ZV9hY2N1bXVsYXRlZF9pbnRlcmVzdCgpIGJlZm9yZWhhbmQuIEl0IHBlcmZvcm1zIG9ubHkgdGhlCiAgICAvLyAgICAgZGVwb3NpdCBvcGVyYXRpb24sIG1ha2luZyBpdCBwdXJlbHkgYWRkaXRpdmUuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkIChBY2NvdW50KTogVGhlIGFjY291bnQgSUQgb2YgdGhlIHVzZXIgbWFraW5nIHRoZSBkZXBvc2l0CiAgICAvLyAgICAgICAgIG1hcmtldF9pZCAoVUludDY0KTogVGhlIElEIG9mIHRoZSBtYXJrZXQgdG8gZGVwb3NpdCBpbnRvCiAgICAvLyAgICAgICAgIGFtb3VudCAoQmlnVUludCk6IFRoZSBhbW91bnQgb2YgdW5kZXJseWluZyB0b2tlbnMgdG8gZGVwb3NpdAogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgZGVwb3NpdCBvcGVyYXRpb24KICAgIC8vICAgICAjIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAjICAgICBtYXJrZXRfaWQKICAgIC8vICAgICAjICkuZGVwb3NpdC5uYXRpdmUKICAgIC8vICAgICAjIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICMgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiRGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdHMgPSBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdHMobWFya2V0KQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC5tYXhfdG90YWxfZGVwb3NpdHMubmF0aXZlID49IG1hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRzICsgYW1vdW50CiAgICAvLyAgICAgKSwgIk1hcmtldCBkZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gc2VsZi5fZ2V0X21hcmtldF9zY2FsZWRfZGVwb3NpdChtYXJrZXQsIGFtb3VudCkKICAgIC8vICAgICBkZXBvc2l0X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGFtb3VudCkKICAgIC8vICAgICBzZWxmLl9jb2xsYXRlcmFsX2RlcG9zaXRfcHVyZSgKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgYW1vdW50LAogICAgLy8gICAgICAgICBzY2FsZWRfYW1vdW50LAogICAgLy8gICAgICAgICBkZXBvc2l0X3ZhbHVlLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVwb3NpdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIEludGVybmFsIGRlcG9zaXQgbWV0aG9kIHRoYXQgaGFuZGxlcyB1c2VyIGRlcG9zaXRzIGludG8gYSBsZW5kaW5nIG1hcmtldC4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIHBlcmZvcm1zIGEgY29tcGxldGUgZGVwb3NpdCBvcGVyYXRpb24gd2l0aCBzZXBhcmF0ZWQgY29uY2VybnM6CiAgICAvLyAgICAgMS4gU3luY3MgdXNlciBtYXJrZXQgZm9yIHByaWNlIGNoYW5nZXMgKGFjY3J1ZXMgaW50ZXJlc3QsIHVwZGF0ZXMgZ2xvYmFsIHZhbHVlcywgcmVzb2x2ZXMgaW50ZXJlc3QpCiAgICAvLyAgICAgMi4gUGVyZm9ybXMgcHVyZSBkZXBvc2l0IG9wZXJhdGlvbiAoYWRkcyBuZXcgZnVuZHMgd2l0aG91dCBpbnRlcmVzdCBoYW5kbGluZykKICAgIC8vIAogICAgLy8gICAgIFRoZSBzZXBhcmF0aW9uIGVuc3VyZXM6CiAgICAvLyAgICAgLSBTaW5nbGUgaW50ZXJlc3QgYWNjcnVhbCBwZXIgb3BlcmF0aW9uCiAgICAvLyAgICAgLSBDbGVhbiBzZXBhcmF0aW9uIGJldHdlZW4gaW50ZXJlc3QgcmVzb2x1dGlvbiBhbmQgbmV3IGRlcG9zaXRzCiAgICAvLyAgICAgLSBDb25zaXN0ZW50IHByaWNlIHN5bmNocm9uaXphdGlvbgogICAgLy8gICAgIC0gUHVyZSBhZGRpdGl2ZSBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIG1ha2luZyB0aGUgZGVwb3NpdAogICAgLy8gICAgICAgICBtYXJrZXRfaWQgKFVJbnQ2NCk6IFRoZSBJRCBvZiB0aGUgbWFya2V0IHRvIGRlcG9zaXQgaW50bwogICAgLy8gICAgICAgICBhbW91bnQgKEJpZ1VJbnQpOiBUaGUgYW1vdW50IG9mIHVuZGVybHlpbmcgdG9rZW5zIHRvIGRlcG9zaXQKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIG1hcmtldCB2YWxpZGF0aW9uIGZhaWxzLCBkZXBvc2l0IGNhcCBpcyBleGNlZWRlZCwgb3Igb3RoZXIgY29uc3RyYWludHMgYXJlIHZpb2xhdGVkCiAgICAvLyAKICAgIC8vICAgICBOb3RlOgogICAgLy8gICAgICAgICAtIEFsbCBwcmljZSBjaGFuZ2VzIGFuZCBpbnRlcmVzdCByZXNvbHV0aW9uIGFyZSBoYW5kbGVkIGluIHRoZSBzeW5jIHN0ZXAKICAgIC8vICAgICAgICAgLSBUaGUgZGVwb3NpdCBvcGVyYXRpb24gaXMgcHVyZWx5IGFkZGl0aXZlLCBhZGRpbmcgb25seSB0aGUgbmV3IGFtb3VudAogICAgLy8gICAgICAgICAtIFVzZXIncyBnbG9iYWwgY29sbGF0ZXJhbC9ib3Jyb3cgdmFsdWVzIGFyZSB1cGRhdGVkIHdpdGggY3VycmVudCBwcmljZXMgZHVyaW5nIHN5bmMKICAgIC8vICAgICAiIiIKICAgIC8vICAgICAjIFN5bmMgdXNlciBtYXJrZXQgZm9yIHByaWNlIGNoYW5nZQogICAgLy8gICAgIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIFBlcmZvcm0gcHVyZSBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gICAgIHNlbGYuX2RlcG9zaXRfcHVyZSh1c2VyX2lkLCBtYXJrZXRfaWQsIGFtb3VudCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDcwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBpbnRlcmVzdCIiIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGEodXNlciwgbWFya2V0KQogICAgLy8gICAgIHJldHVybiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGEoCiAgICAvLyAgICAgc2VsZiwgdXNlcjogVXNlckRhdGEsIG1hcmtldDogTWFya2V0RGF0YQogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBpbnRlcmVzdCB1c2luZyBwcmUtZmV0Y2hlZCBkYXRhIiIiCiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIgaGFzIG5vIGRlcG9zaXRzLCByZXR1cm4gMCBpbnRlcmVzdAogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gQmlnVUludCgwKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgY3VycmVudCB1bmRlcmx5aW5nIHZhbHVlCiAgICAvLyAgICAgY3VycmVudF91bmRlcmx5aW5nID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB1bmRlcmx5aW5nIHZhbHVlIGF0IHVzZXIncyBsYXN0IHVwZGF0ZQogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBpZiB1c2VyJ3MgZGVwb3NpdF9pbmRleCBpcyAwIChuZXcgdXNlciksIHVzZSBjdXJyZW50IG1hcmtldCBpbmRleAogICAgLy8gICAgIHVzZXJfZGVwb3NpdF9pbmRleCA9ICgKICAgIC8vICAgICAgICAgdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBsYXN0X3VuZGVybHlpbmcgPSAodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogdXNlcl9kZXBvc2l0X2luZGV4KSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBJbnRlcmVzdCBpcyB0aGUgZGlmZmVyZW5jZQogICAgLy8gICAgIGlmIGN1cnJlbnRfdW5kZXJseWluZyA+IGxhc3RfdW5kZXJseWluZzoKICAgIC8vICAgICAgICAgaW50ZXJlc3QgPSBjdXJyZW50X3VuZGVybHlpbmcgLSBsYXN0X3VuZGVybHlpbmcKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBpbnRlcmVzdCA9IEJpZ1VJbnQoMCkKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgZGVidCBpbnRlcmVzdCIiIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0X3dpdGhfZGF0YSh1c2VyLCBtYXJrZXQpCiAgICAvLyAgICAgcmV0dXJuIGludGVyZXN0CiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhKAogICAgLy8gICAgIHNlbGYsIHVzZXI6IFVzZXJEYXRhLCBtYXJrZXQ6IE1hcmtldERhdGEKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgZGVidCBpbnRlcmVzdCB1c2luZyBwcmUtZmV0Y2hlZCBkYXRhIiIiCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgdW5kZXJseWluZyBkZWJ0IGFtb3VudAogICAgLy8gICAgIHVzZXJfdG90YWxfZGVidCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIG9yaWdpbmFsIHByaW5jaXBhbCBhbW91bnQgdXNpbmcgdXNlcidzIGJvcnJvd19pbmRleAogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBpZiB1c2VyJ3MgYm9ycm93X2luZGV4IGlzIDAsIHVzZSBjdXJyZW50IG1hcmtldCBib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyX2JvcnJvd19pbmRleCA9ICgKICAgIC8vICAgICAgICAgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBvcmlnaW5hbF9wcmluY2lwYWwgPSAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyX2JvcnJvd19pbmRleCkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRvdGFsIGRlYnQgYW5kIG9yaWdpbmFsIHByaW5jaXBhbAogICAgLy8gICAgICMgUHJldmVudCBuZWdhdGl2ZSBpbnRlcmVzdCAodW5kZXJmbG93IHByb3RlY3Rpb24pCiAgICAvLyAgICAgaWYgdXNlcl90b3RhbF9kZWJ0ID49IG9yaWdpbmFsX3ByaW5jaXBhbDoKICAgIC8vICAgICAgICAgZGVidF9pbnRlcmVzdCA9IHVzZXJfdG90YWxfZGVidCAtIG9yaWdpbmFsX3ByaW5jaXBhbAogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlYnRfaW50ZXJlc3QgPSBCaWdVSW50KDApCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gZGVidF9pbnRlcmVzdAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhdyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50MjU2KHNlbGYuX3dpdGhkcmF3KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jb2xsYXRlcmFsX2RlcG9zaXRfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbnRva2VuX2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhiZW5lZmljaWFyeV9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihzY2FsZWRfYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG50b2tlbl9pZCksCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgYmVuZWZpY2lhcnlfaWQsIHNjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9nbG9iYWxfY29sbGF0ZXJhbChiZW5lZmljaWFyeV9pZCwgdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NvbGxhdGVyYWxfd2l0aGRyYXdfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbnRva2VuX2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUHVyZSBjb2xsYXRlcmFsIHdpdGhkcmF3YWwgb3BlcmF0aW9uIHRoYXQgYnVybnMgblRva2VucyBhbmQgdHJhbnNmZXJzIHVuZGVybHlpbmcgdG9rZW5zLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgcGVyZm9ybXMgdGhlIGNvcmUgY29sbGF0ZXJhbCB3aXRoZHJhd2FsIGxvZ2ljIHdpdGhvdXQgaGFuZGxpbmcgaW50ZXJlc3QKICAgIC8vICAgICBjYWxjdWxhdGlvbnMgb3IgdmFsaWRhdGlvbnMuIEl0IGFzc3VtZXMgdGhhdCBhbGwgbmVjZXNzYXJ5IHZhbGlkYXRpb25zIGFuZCBpbnRlcmVzdAogICAgLy8gICAgIGFjY3J1YWxzIGhhdmUgYmVlbiBoYW5kbGVkIGJ5IHRoZSBjYWxsaW5nIG1ldGhvZCBiZWZvcmVoYW5kLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIHdpdGhkcmF3aW5nIGNvbGxhdGVyYWwKICAgIC8vICAgICAgICAgYmVuZWZpY2lhcnlfaWQgKEFjY291bnQpOiBUaGUgYWNjb3VudCBJRCB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgd2l0aGRyYXduIHRva2VucwogICAgLy8gICAgICAgICBtYXJrZXRfaWQgKFVJbnQ2NCk6IFRoZSBJRCBvZiB0aGUgbWFya2V0IGZyb20gd2hpY2ggY29sbGF0ZXJhbCBpcyBiZWluZyB3aXRoZHJhd24KICAgIC8vICAgICAgICAgbnRva2VuX2lkIChVSW50NjQpOiBUaGUgSUQgb2YgdGhlIG5Ub2tlbiBhcHBsaWNhdGlvbiB0byBidXJuIHRva2VucyBmcm9tCiAgICAvLyAgICAgICAgIGFtb3VudCAoQmlnVUludCk6IFRoZSBhY3R1YWwgYW1vdW50IG9mIHVuZGVybHlpbmcgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAvLyAgICAgICAgIHNjYWxlZF9hbW91bnQgKEJpZ1VJbnQpOiBUaGUgc2NhbGVkIGFtb3VudCBvZiBuVG9rZW5zIHRvIGJ1cm4KICAgIC8vICAgICAgICAgdmFsdWUgKEJpZ1VJbnQpOiBUaGUgVVNEIHZhbHVlIG9mIHRoZSBjb2xsYXRlcmFsIGJlaW5nIHdpdGhkcmF3bgogICAgLy8gCiAgICAvLyAgICAgUHJvY2VzczoKICAgIC8vICAgICAgICAgMS4gQnVybnMgdGhlIHNwZWNpZmllZCBzY2FsZWQgYW1vdW50IG9mIG5Ub2tlbnMgZnJvbSB0aGUgdXNlcgogICAgLy8gICAgICAgICAyLiBEZWNyZW1lbnRzIHRoZSB1c2VyJ3Mgc2NhbGVkIGRlcG9zaXQgYmFsYW5jZSBmb3IgdGhlIG1hcmtldAogICAgLy8gICAgICAgICAzLiBEZWNyZW1lbnRzIHRoZSB0b3RhbCBzY2FsZWQgZGVwb3NpdHMgZm9yIHRoZSBtYXJrZXQKICAgIC8vICAgICAgICAgNC4gVHJhbnNmZXJzIHRoZSB1bmRlcmx5aW5nIHRva2VucyB0byB0aGUgYmVuZWZpY2lhcnkKICAgIC8vICAgICAgICAgNS4gRGVjcmVtZW50cyB0aGUgdXNlcidzIGdsb2JhbCBjb2xsYXRlcmFsIHZhbHVlIHRyYWNraW5nCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoc2NhbGVkX2Ftb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihudG9rZW5faWQpLAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3MoYmVuZWZpY2lhcnlfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCB2YWx1ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcHVyZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUHVyZSB3aXRoZHJhdyBvcGVyYXRpb24gdGhhdCBidXJucyBuVG9rZW5zIGFuZCB0cmFuc2ZlcnMgdW5kZXJseWluZyB0b2tlbnMgdG8gdXNlci4KICAgIC8vICAgICAiIiIKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3Igd2l0aGRyYXcgb3BlcmF0aW9uCiAgICAvLyAgICAgIyBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgIyAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgIyApLndpdGhkcmF3Lm5hdGl2ZQogICAgLy8gICAgICMgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgIyAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiV2l0aGRyYXcgY2FwIGV4Y2VlZGVkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGFtb3VudCA8PSB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB0aGUgYWN0dWFsIHVuZGVybHlpbmcgYW1vdW50IHRvIHRyYW5zZmVyIHRvIHVzZXIKICAgIC8vICAgICAjIGFtb3VudCBpcyB0aGUgc2NhbGVkIGFtb3VudCAoblRva2VucyksIHdlIG5lZWQgdG8gY29udmVydCB0byB1bmRlcmx5aW5nCiAgICAvLyAgICAgdW5kZXJseWluZ19hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdF9hbW91bnQobWFya2V0LCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICB1bmRlcmx5aW5nX3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIHVuZGVybHlpbmdfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBoZWFsdGggY2hlY2s6IGVuc3VyZSB3aXRoZHJhdyB3b3VsZCBub3QgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgIGlmIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZSA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICB1bmRlcmx5aW5nX3ZhbHVlIDw9IGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlCiAgICAvLyAgICAgICAgICksICJXaXRoZHJhd2FsIHB1dHMgdXNlciBhdCByaXNrIG9mIGxpcXVpZGF0aW9uIgogICAgLy8gICAgICAgICByZW1haW5pbmdfY29sbGF0ZXJhbCA9ICgKICAgIC8vICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gdW5kZXJseWluZ192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIGFzc2VydCBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIDw9ICgKICAgIC8vICAgICAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsICogQmlnVUludChtYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgLy8gICAgICAgICApIC8vIEJpZ1VJbnQoMTAwMDApLCAiV2l0aGRyYXdhbCBwdXRzIHVzZXIgYXQgcmlzayBvZiBsaXF1aWRhdGlvbiIKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3Igd2l0aGRyYXcgb3BlcmF0aW9uCiAgICAvLyAgICAgIyB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgICMgaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9PSAwOgogICAgLy8gICAgICMgICAgIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCArIDg2NDAwKQogICAgLy8gICAgICMgZWxpZiB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lIDwgR2xvYmFsLmxhdGVzdF90aW1lc3RhbXA6CiAgICAvLyAgICAgIyAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIC8vICAgICAjICAgICB1c2VyX2NhcC50b3RhbF9saXF1aWRhdGlvbnMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIC8vICAgICAjICAgICB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIC8vICAgICAjIGlmIHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgIyAgICAgbmV3X3RvdGFsX3dpdGhkcmF3YWxzID0gdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMubmF0aXZlICsgYW1vdW50X3VzZF92YWx1ZQogICAgLy8gICAgICMgICAgIGFzc2VydCAoCiAgICAvLyAgICAgIyAgICAgICAgIG5ld190b3RhbF93aXRoZHJhd2FscyA8PSB1c2VyX2NhcC5kYWlseV93aXRoZHJhd2Fscy5uYXRpdmUKICAgIC8vICAgICAjICAgICApLCAiVXNlciB3aXRoZHJhdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAgICAgIyAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYobmV3X3RvdGFsX3dpdGhkcmF3YWxzKQogICAgLy8gICAgICMgICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLCB1c2VyX2NhcCkKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2NvbGxhdGVyYWxfd2l0aGRyYXdfcHVyZSgKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgdW5kZXJseWluZ19hbW91bnQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgdW5kZXJseWluZ192YWx1ZSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIEVtaXQgZXZlbnRzCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0V2l0aGRyYXcoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgYXJjNC5VSW50NjQobWFya2V0X2lkKSwgYXJjNC5VSW50MjU2KGFtb3VudCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gdW5kZXJseWluZ19hbW91bnQKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXcoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX3dpdGhkcmF3X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGJvcnJvdyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDI4MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fYm9ycm93KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2JvcnJvd19wdXJlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIGJvcnJvdyBvcGVyYXRpb24KICAgIC8vICAgICAjIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAjICAgICBtYXJrZXRfaWQKICAgIC8vICAgICAjICkuYm9ycm93Lm5hdGl2ZQogICAgLy8gICAgICMgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgIyAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQodXNlcl9pZCkKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSBVSW50NjQoMTAwMDAwKSwgIlBheW1lbnQgYW1vdW50IG11c3QgYmUgPj0gMC4xIgogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGN1cnJlbnQgbWFya2V0IHRvdGFsIGJvcnJvd3MgKGluY2x1ZGluZyBpbnRlcmVzdCkKICAgIC8vICAgICBtYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzID0gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd3MobWFya2V0KQogICAgLy8gCiAgICAvLyAgICAgIyBWYWxpZGF0ZSBhZ2FpbnN0IG1hcmtldC13aWRlIGJvcnJvdyBjYXAKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQubWF4X3RvdGFsX2JvcnJvd3MubmF0aXZlID49IG1hcmtldF91bmRlcmx5aW5nX2JvcnJvd3MgKyBhbW91bnQKICAgIC8vICAgICApLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgY29sbGF0ZXJhbCByZXF1aXJlbWVudHMgLSBleGNsdWRlIHNhbWUgbWFya2V0IGNvbGxhdGVyYWwgdG8gcHJldmVudAogICAgLy8gICAgICMgaW5lZmZpY2llbnQgc2FtZS1hc3NldCBib3Jyb3dpbmcKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgYm9ycm93X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IEJpZ1VJbnQoMCk6CiAgICAvLyAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICAgICAjIFVzZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBleGNsdWRlZF92YWx1ZSA9IChkZXBvc2l0ZWRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgaWYgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgPiBleGNsdWRlZF92YWx1ZToKICAgIC8vICAgICAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gKAogICAgLy8gICAgICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gZXhjbHVkZWRfdmFsdWUKICAgIC8vICAgICAgICAgICAgICkKICAgIC8vICAgICAgICAgZWxzZToKICAgIC8vICAgICAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gQmlnVUludCgwKQogICAgLy8gCiAgICAvLyAgICAgdG90YWxfYm9ycm93X3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSArIGJvcnJvd192YWx1ZQogICAgLy8gICAgIGFzc2VydCB0b3RhbF9ib3Jyb3dfdmFsdWUgPD0gKAogICAgLy8gICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSAqIEJpZ1VJbnQobWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICAgICApIC8vIEJpZ1VJbnQoMTAwMDApLCAiSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgYWNyb3NzIG1hcmtldHMiCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBleHBlY3RlZCBzY2FsZWQgYm9ycm93cwogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3cobWFya2V0LCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9kZWJ0X2JvcnJvd19wdXJlKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgc2NhbGVkX2Ftb3VudCwKICAgIC8vICAgICAgICAgYm9ycm93X3ZhbHVlLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgRW1pdCBldmVudAogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldEJvcnJvdygKICAgIC8vICAgICAjICAgICAgICAgdXNlcj1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHRva2VuX2lkPWFyYzQuVUludDY0KG1hcmtldF9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIGFtb3VudD1hcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2JvcnJvdyhzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgc2VsZi5fYm9ycm93X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHJlcGF5KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICBzZWxmLl9yZXBheShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWJ0X3JlcGF5bWVudF9wdXJlKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgcGF5ZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MocGF5ZXJfaWQpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKHBheWVyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAjIGFkanVzdCB1c2VyJ3Mgc2NhbGVkIGJvcnJvd3MKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgYmVuZWZpY2lhcnlfaWQsIHNjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhZGp1c3QgbWFya2V0J3MgdG90YWwgc2NhbGVkIGJvcnJvd3MKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICAjIGFkanVzdCBnbG9iYWwgYm9ycm93IHZhbHVlCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X2dsb2JhbF9ib3Jyb3dzKGJlbmVmaWNpYXJ5X2lkLCB2YWx1ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXlfcHVyZShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFJlcGF5IGJvcnJvd2VkIHRva2VucyBmb3IgYSBzcGVjaWZpYyBtYXJrZXQuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBoYW5kbGVzIHRoZSByZXBheW1lbnQgb2YgYm9ycm93ZWQgdG9rZW5zLiBJdCBzdXBwb3J0cyBib3RoCiAgICAvLyAgICAgc1Rva2VuIChidXJuKSBhbmQgYVRva2VuICh0cmFuc2ZlcikgbWFya2V0cy4gVGhlIGFjdHVhbCB0b2tlbiBvcGVyYXRpb25zCiAgICAvLyAgICAgYXJlIGRlbGVnYXRlZCB0byBfZGVidF9yZXBheW1lbnRfcHVyZSgpIHdoaWNoIGNvcnJlY3RseSBoYW5kbGVzIHRoZQogICAgLy8gICAgIGNyaXRpY2FsIHRva2VuIGJ1cm4vdHJhbnNmZXIgbG9naWMuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgdXNlciBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIG1hcmtldF9pZDogVGhlIG1hcmtldCBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIGFtb3VudDogVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gcmVwYXkgKG11c3Qgbm90IGV4Y2VlZCB0b3RhbCBkZWJ0KQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgbWFya2V0IHZhbGlkYXRpb24gZmFpbHMsIHJlcGF5IGFtb3VudCBleGNlZWRzIHRvdGFsIGRlYnQsCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgb3IgcHJpbmNpcGFsIHJlcGF5bWVudCBleGNlZWRzIHNjYWxlZCBkZWJ0CiAgICAvLyAKICAgIC8vICAgICBQcm9jZXNzOgogICAgLy8gICAgICAgICAxLiBWYWxpZGF0ZXMgbWFya2V0IG9wZXJhdGlvbiBhbmQgYWNjcnVlcyBpbnRlcmVzdAogICAgLy8gICAgICAgICAyLiBHZXRzIHVzZXIgYW5kIG1hcmtldCBzdGF0ZQogICAgLy8gICAgICAgICAzLiBDYWxjdWxhdGVzIHRvdGFsIHVuZGVybHlpbmcgYm9ycm93cyBmb3IgdmFsaWRhdGlvbgogICAgLy8gICAgICAgICA0LiBWYWxpZGF0ZXMgcmVwYXkgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vICAgICAgICAgNS4gQ2FsY3VsYXRlcyBzY2FsZWQgYW1vdW50IGZvciBwcmluY2lwYWwgcmVwYXltZW50CiAgICAvLyAgICAgICAgIDYuIFZhbGlkYXRlcyBzY2FsZWQgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHVzZXIncyBzY2FsZWQgZGVidAogICAgLy8gICAgICAgICA3LiBDYWxjdWxhdGVzIHJlcGF5IHZhbHVlIGZvciBnbG9iYWwgdHJhY2tpbmcKICAgIC8vICAgICAgICAgOC4gRGVsZWdhdGVzIHRvIF9kZWJ0X3JlcGF5bWVudF9wdXJlKCkgZm9yOgogICAgLy8gICAgICAgICAgICAgLSBUb2tlbiBidXJuIChzVG9rZW4pIG9yIHRyYW5zZmVyIChhVG9rZW4pIGZyb20gdXNlcgogICAgLy8gICAgICAgICAgICAgLSBVc2VyIGFuZCBtYXJrZXQgc2NhbGVkIGJvcnJvdyB1cGRhdGVzCiAgICAvLyAgICAgICAgICAgICAtIEdsb2JhbCBib3Jyb3cgdmFsdWUgdHJhY2tpbmcKICAgIC8vIAogICAgLy8gICAgIFNlY3VyaXR5IE5vdGU6CiAgICAvLyAgICAgICAgIFRoaXMgbWV0aG9kIGNvcnJlY3RseSBidXJucyBzVG9rZW5zIGZyb20gdGhlIHVzZXIncyBhZGRyZXNzIChub3QgdGhlCiAgICAvLyAgICAgICAgIHByb3RvY29sIGFkZHJlc3MpIGFzIHBlciB0aGUgZml4IGZvciBERi1BVUQtMDIuCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB0b3RhbF91bmRlcmx5aW5nX2JvcnJvd3MgPSBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfYm9ycm93cyhtYXJrZXQpCiAgICAvLyAgICAgYXNzZXJ0IGFtb3VudCA8PSB0b3RhbF91bmRlcmx5aW5nX2JvcnJvd3MsICJSZXBheSBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0IgogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3cobWFya2V0LCBhbW91bnQpCiAgICAvLyAgICAgYXNzZXJ0IHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IHNjYWxlZF9hbW91bnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyBkZWJ0IgogICAgLy8gICAgIHJlcGF5X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGFtb3VudCkKICAgIC8vICAgICBzZWxmLl9kZWJ0X3JlcGF5bWVudF9wdXJlKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgc2NhbGVkX2Ftb3VudCwKICAgIC8vICAgICAgICAgcmVwYXlfdmFsdWUsCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBFbWl0IGV2ZW50CiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0UmVwYXkoCiAgICAvLyAgICAgIyAgICAgICAgIHVzZXI9YXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQobWFya2V0X2lkKSwKICAgIC8vICAgICAjICAgICAgICAgYW1vdW50PWFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX3JlcGF5X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgc2VsZi5fcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBzZWxmLl9yZXNvbHZlX2FjY3VtdWxhdGVkX2JvcnJvd19pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmV2aW91c19wcmljZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2xhc3RfcHJpY2U6IEJpZ1VJbnQsIG1hcmtldF9wcmljZTogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHJldHVybiB1c2VyX2xhc3RfcHJpY2UgaWYgdXNlcl9sYXN0X3ByaWNlID4gMCBlbHNlIG1hcmtldF9wcmljZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfdXNlcl9tYXJrZXRfY29sbGF0ZXJhKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXI6IFVzZXJEYXRhLCBtYXJrZXQ6IE1hcmtldERhdGEKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBVcGRhdGUgYSB1c2VyJ3MgbWFya2V0IGNvbGxhdGVyYWwgdmFsdWVzIHdoZW4gbWFya2V0IHByaWNlcyBjaGFuZ2UuCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybgogICAgLy8gCiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIncyBkZXBvc2l0X2luZGV4IGlzIDAgKG5ldyB1c2VyKSwgdXNlIGN1cnJlbnQgbWFya2V0IGluZGV4CiAgICAvLyAgICAgdXNlcl9kZXBvc2l0X2luZGV4ID0gKAogICAgLy8gICAgICAgICB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXJfZGVwb3NpdF9pbmRleCkgLy8gU0NBTEUKICAgIC8vICAgICBuZXdfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vICAgICBwcmljZV9mb3Jfb2xkID0gc2VsZi5fZ2V0X3ByZXZpb3VzX3ByaWNlKAogICAgLy8gICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlLCBtYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIG9sZF9kZXBvc2l0X3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2RlcG9zaXRfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwodXNlcl9pZCwgb2xkX2RlcG9zaXRfdmFsdWUsIG5ld19kZXBvc2l0X3ZhbHVlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfdXNlcl9tYXJrZXRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyOiBVc2VyRGF0YSwgbWFya2V0OiBNYXJrZXREYXRhCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgVXBkYXRlIGEgdXNlcidzIG1hcmtldCBib3Jyb3cgdmFsdWVzIHdoZW4gbWFya2V0IHByaWNlcyBjaGFuZ2UuCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuCiAgICAvLyAgICAgb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIHByaWNlX2Zvcl9vbGQgPSBzZWxmLl9nZXRfcHJldmlvdXNfcHJpY2UoCiAgICAvLyAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUsIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgb2xkX2JvcnJvd192YWx1ZSA9IChvbGRfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2JvcnJvd192YWx1ZSA9IChuZXdfYm9ycm93X2Ftb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKHVzZXJfaWQsIG9sZF9ib3Jyb3dfdmFsdWUsIG5ld19ib3Jyb3dfdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFVwZGF0ZSBhIHVzZXIncyBnbG9iYWwgdmFsdWVzIHdoZW4gbWFya2V0IHByaWNlcyBjaGFuZ2UuCiAgICAvLyAgICAgIiIiCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKS5jb3B5KCkKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9PSAwIGFuZCB1c2VyLnNjYWxlZF9ib3Jyb3dzID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9tYXJrZXRfY29sbGF0ZXJhKHVzZXJfaWQsIHVzZXIsIG1hcmtldCkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9tYXJrZXRfYm9ycm93cyh1c2VyX2lkLCB1c2VyLCBtYXJrZXQpCiAgICAvLyAKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfZ2xvYmFsX3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBHbG9iYWxVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfZ2xvYmFsX3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gR2xvYmFsVXNlckRhdGE6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLmdsb2JhbF91c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X2dsb2JhbF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gZ2xvYmFsX3VzZXIKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBhbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBCaWdVSW50KDApLAogICAgLy8gICAgICAgICBhbW91bnQsCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGFtb3VudDogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgQmlnVUludCgwKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gICAgIGlmIG9sZF92YWx1ZSA+IGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlOgogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlID0gYXJjNC5VSW50MjU2KG5ld192YWx1ZSkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXSA9IGdsb2JhbF91c2VyLmNvcHkoKQogICAgLy8gICAgIGhlYWx0aCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2hlYWx0aCgKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUsCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUsCiAgICAvLyAgICAgICAgIFVJbnQ2NCg4MDAwKSwgICMgODAlIGxpcXVpZGF0aW9uIHRocmVzaG9sZAogICAgLy8gICAgICkKICAgIC8vICAgICBhcmM0LmVtaXQoCiAgICAvLyAgICAgICAgIFVzZXJIZWFsdGgoCiAgICAvLyAgICAgICAgICAgICB1c2VyX2lkPWFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGhlYWx0aF9mYWN0b3I9YXJjNC5VSW50MjU2KGhlYWx0aCksCiAgICAvLyAgICAgICAgICAgICB0b3RhbF9jb2xsYXRlcmFsX3ZhbHVlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgICAgIHRvdGFsX2JvcnJvd192YWx1ZT1hcmM0LlVJbnQyNTYoZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cyh1c2VyX2lkLCBCaWdVSW50KDApLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cyh1c2VyX2lkLCBhbW91bnQsIEJpZ1VJbnQoMCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gICAgIGlmIG9sZF92YWx1ZSA+IGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmU6CiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZSA9IGFyYzQuVUludDI1NihuZXdfdmFsdWUpCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSAtIG9sZF92YWx1ZSArIG5ld192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGxpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHVzZXI6IGFyYzQuQWRkcmVzcywKICAgIC8vICAgICBkZWJ0X2Ftb3VudDogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBhcmM0LlVJbnQyNTYsCiAgICAvLyApIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDQ5MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChkZWJ0X21hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgICAgIHVzZXIubmF0aXZlLCBkZWJ0X21hcmtldF9pZC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfZGVwb3NpdF9pbnRlcmVzdCh1c2VyLm5hdGl2ZSwgZGVidF9tYXJrZXRfaWQubmF0aXZlKQogICAgLy8gICAgIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0KHVzZXIubmF0aXZlLCBkZWJ0X21hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5fcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0KAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0KAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIHNlbGYuX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfcHVyZSgKICAgIC8vICAgICAgICAgICAgIGRlYnRfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIFR4bi5zZW5kZXIsCiAgICAvLyAgICAgICAgICAgICB1c2VyLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIGRlYnRfYW1vdW50Lm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVidF9ib3Jyb3dfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5taW50LAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKGJlbmVmaWNpYXJ5X2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICAgICAgcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgLy8gICAgICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyhiZW5lZmljaWFyeV9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfZ2xvYmFsX2JvcnJvd3ModXNlcl9pZCwgdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2hlYWx0aCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIGNvbGxhdGVyYWxfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyAgICAgYm9ycm93X3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogVUludDY0LAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIGlmIGJvcnJvd192YWx1ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gQmlnVUludCgxMDAwMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICByZXR1cm4gKAogICAgLy8gICAgICAgICAgICAgY29sbGF0ZXJhbF92YWx1ZSAqIEJpZ1VJbnQobGlxdWlkYXRpb25fdGhyZXNob2xkKSAqIEJpZ1VJbnQoMTAwMDApCiAgICAvLyAgICAgICAgICkgLy8gKGJvcnJvd192YWx1ZSAqIEJpZ1VJbnQoMTAwMDApKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X3B1cmUoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRvcl9pZDogQWNjb3VudCwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIHJlcGF5X2Ftb3VudDogQmlnVUludCwKICAgIC8vICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogQmlnVUludCwKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBMaXF1aWRhdGUgYSB1c2VyJ3MgdW5kZXJjb2xsYXRlcmFsaXplZCBwb3NpdGlvbiBhY3Jvc3MgZGlmZmVyZW50IG1hcmtldHMuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBhbGxvd3MgYSBsaXF1aWRhdG9yIHRvIHJlcGF5IGEgcG9ydGlvbiBvZiBhIHVzZXIncyBkZWJ0IGluIG9uZSBtYXJrZXQKICAgIC8vICAgICBhbmQgcmVjZWl2ZSBjb2xsYXRlcmFsIGZyb20gYW5vdGhlciBtYXJrZXQgYXMgY29tcGVuc2F0aW9uLiBUaGUgbGlxdWlkYXRpb24gaW5jbHVkZXMKICAgIC8vICAgICBhIGJvbnVzIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzIGFuZCBoZWxwcyBtYWludGFpbiBwcm90b2NvbCBoZWFsdGggYnkgcmVtb3ZpbmcKICAgIC8vICAgICB1bmRlcmNvbGxhdGVyYWxpemVkIHBvc2l0aW9ucy4KICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIGRlYnRfbWFya2V0X2lkOiBUaGUgbWFya2V0IElEIHdoZXJlIHRoZSBkZWJ0IHRvIGJlIHJlcGFpZCBleGlzdHMKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IFRoZSBtYXJrZXQgSUQgd2hlcmUgY29sbGF0ZXJhbCB3aWxsIGJlIHNlaXplZCBmcm9tCiAgICAvLyAgICAgICAgIGxpcXVpZGF0b3JfaWQ6IFRoZSBhY2NvdW50IHBlcmZvcm1pbmcgdGhlIGxpcXVpZGF0aW9uCiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSBhY2NvdW50IGJlaW5nIGxpcXVpZGF0ZWQKICAgIC8vICAgICAgICAgZGVidF9hbW91bnQ6IFRoZSBhbW91bnQgb2YgZGVidCB0byByZXBheSAobXVzdCBpbmNsdWRlIGFjY3J1ZWQgaW50ZXJlc3QpCiAgICAvLyAgICAgICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBNaW5pbXVtIGNvbGxhdGVyYWwgYW1vdW50IHRoZSBsaXF1aWRhdG9yIGV4cGVjdHMgdG8gcmVjZWl2ZQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgYW55IHZhbGlkYXRpb24gZmFpbHMsIGluY2x1ZGluZzoKICAgIC8vICAgICAgICAgICAgIC0gVXNpbmcgc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIChib3Jyb3ctb25seSBtYXJrZXQpCiAgICAvLyAgICAgICAgICAgICAtIEF0dGVtcHRpbmcgc2VsZi1saXF1aWRhdGlvbgogICAgLy8gICAgICAgICAgICAgLSBNYXJrZXQgZG9lc24ndCBleGlzdCBvciBpcyBwYXVzZWQKICAgIC8vICAgICAgICAgICAgIC0gUG9zaXRpb24gaXMgbm90IGxpcXVpZGF0YWJsZSAoaGVhbHRoIGZhY3RvciA+PSAxLjApCiAgICAvLyAgICAgICAgICAgICAtIExpcXVpZGF0aW9uIGFtb3VudCBleGNlZWRzIG1heGltdW0gYWxsb3dlZCBvciB0b3RhbCBkZWJ0CiAgICAvLyAgICAgICAgICAgICAtIEluc3VmZmljaWVudCBjb2xsYXRlcmFsIHRvIHNlaXplCiAgICAvLyAgICAgICAgICAgICAtIENvbGxhdGVyYWwgcmVjZWl2ZWQgYmVsb3cgbWluaW11bSB0aHJlc2hvbGQKICAgIC8vIAogICAgLy8gICAgIE5vdGVzOgogICAgLy8gICAgICAgICAtIFVzZXMgdGhlIGNvbGxhdGVyYWwgbWFya2V0J3MgbGlxdWlkYXRpb24gdGhyZXNob2xkIGZvciBoZWFsdGggY2FsY3VsYXRpb24KICAgIC8vICAgICAgICAgLSBMaXF1aWRhdGlvbiBib251cyBpcyBhcHBsaWVkIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzCiAgICAvLyAgICAgICAgIC0gQWNjcnVlZCBpbnRlcmVzdCBvbiBib3RoIGRlYnQgYW5kIGNvbGxhdGVyYWwgcG9zaXRpb25zIGlzIGluY2x1ZGVkCiAgICAvLyAgICAgICAgIC0gSGFuZGxlcyBkaWZmZXJlbnQgdG9rZW4gdHlwZXMgKEFSQzIwMCB2cyBTVG9rZW4pIGFwcHJvcHJpYXRlbHkKICAgIC8vICAgICAgICAgLSBVcGRhdGVzIGdsb2JhbCBib3Jyb3cgYW5kIGNvbGxhdGVyYWwgdmFsdWVzIGZvciB0aGUgdXNlcgogICAgLy8gICAgICIiIgogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgbGlxdWlkYXRlIG9wZXJhdGlvbgogICAgLy8gICAgICMgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICMgICAgIGRlYnRfbWFya2V0X2lkCiAgICAvLyAgICAgIyApLmxpcXVpZGF0ZS5uYXRpdmUKICAgIC8vICAgICAjIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICMgICAgIGFzc2VydCBkZWJ0X2Ftb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiTGlxdWlkYXRlIGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIFJFTSBwcmV2ZW50IHVzaW5nIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCBpbiBsaXF1aWRhdGlvbiBiZWNhdXNlIHN0b2tlbgogICAgLy8gICAgICMgUkVNIG1hcmtldCBjb2xsYXRlcmFsIGRvZXMgbm90IGV4aXN0CiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQgIT0gc2VsZi5zdG9rZW5fYXBwX2lkCiAgICAvLyAgICAgKSwgIkNhbm5vdCB1c2Ugc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIChib3Jyb3ctb25seSBtYXJrZXQpIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBSRU0gcHJldmVudCBzZWxmIGxpcXVpZGF0aW9uCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgYXNzZXJ0IHVzZXJfaWQgIT0gbGlxdWlkYXRvcl9pZCwgIkNhbm5vdCBsaXF1aWRhdGUgc2VsZiIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCBkZWJ0X21hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJEZWJ0IG1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgY29sbGF0ZXJhbF9tYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiQ29sbGF0ZXJhbCBtYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBmcmFtZV9kaWcgLTUKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzMgogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMyLTI3NDIKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAjICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAjICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gIyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gIyAgICAgZWxzZToKICAgIC8vICMgICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gIyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAjICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAjICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICMgICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gIyApIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICMgICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAjICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAjICkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICAjIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIC8vICAgICAgICAgbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgU2NhbGUgdGhlIHByaWNlIGJ5IFNDQUxFIGludGVybmFsbHkgZm9yIHN0b3JhZ2UKICAgIC8vICAgICBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRQcmljZVNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihwcmljZSkpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBmZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9mZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAxMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHBheW1lbnQgPD0gMTAwMDAwMAogICAgLy8gICAgICksICJwYXltZW50IGV4Y2VlZHMgbWF4aW11bSBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNgogICAgLy8gICAgIGFwcCA9IEFwcGxpY2F0aW9uKHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAgICAgaXR4bi5QYXltZW50KHJlY2VpdmVyPWFwcC5hZGRyZXNzLCBhbW91bnQ9cGF5bWVudCwgZmVlPTApLnN1Ym1pdCgpCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFByaWNlRmVlZFByb3ZpZGVySW50ZXJmYWNlLmdldF9wcmljZV93aXRoX3RpbWVzdGFtcCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICAgICAgPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgKToKICAgIC8vICAgICAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICAvLyAgICAgICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC5jb3B5KCkKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLCBwcmljZV93aXRoX3RpbWVzdGFtcC5wcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3BhdXNlX21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIHBhdXNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdLnBhdXNlZCA9IGFyYzQuQm9vbChwYXVzZSA9PSBVSW50NjQoMSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfbWFya2V0KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91dGlsaXphdGlvbihzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIG1hcmtldF9pZDogVUludDY0KSAtPiBCaWdVSW50OgogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBCaWdVSW50KDEwMDAwKSAgIyAxMDAlIHV0aWxpemF0aW9uIGZvciBib3Jyb3ctb25seSBtYXJrZXQKICAgIC8vICAgICBlbGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBCaWdVSW50KDApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgIyBBZGRpdGlvbmFsIHNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8KICAgIC8vICAgICAgICAgdG90YWxfZGVwb3NpdHMgPSBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB0b3RhbF9kZXBvc2l0cyA9PSAwOgogICAgLy8gICAgICAgICAgICAgcmV0dXJuIEJpZ1VJbnQoMCkKICAgIC8vICAgICAgICAgcmV0dXJuIChtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDApIC8vIHRvdGFsX2RlcG9zaXRzCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV9pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIHV0aWxpemF0aW9uOiBCaWdVSW50LCB0aW1lX2RlbHRhOiBVSW50NjQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBCaWdVSW50KDApCiAgICAvLyAgICAgcmF0ZSA9IG1hcmtldC5ib3Jyb3dfcmF0ZS5uYXRpdmUgKyAobWFya2V0LnNsb3BlLm5hdGl2ZSAqIHV0aWxpemF0aW9uKSAvLyAxMDAwMAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGludGVyZXN0IGJhc2VkIG9uIFNDQUxFRCBib3Jyb3dzLCBub3QgdW5kZXJseWluZwogICAgLy8gICAgICMgVGhpcyBwcmV2ZW50cyBkb3VibGUgY29tcG91bmRpbmcgYW5kIG1haW50YWlucyBjb25zaXN0ZW5jeSB3aXRoIHRoZSBhY2NvdW50aW5nIHN5c3RlbQogICAgLy8gICAgIHJldHVybiAocmF0ZSAqIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB0aW1lX2RlbHRhKSAvLyAoCiAgICAvLyAgICAgICAgIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfaW50ZXJlc3Rfc3BsaXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBtYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBzdG9rZW5fYXBwX2lkOiBVSW50NjQsCiAgICAvLyAgICAgaW50ZXJlc3Q6IEJpZ1VJbnQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IFVJbnQ2NCwKICAgIC8vICkgLT4gSW50ZXJlc3RTcGxpdDoKICAgIC8vICAgICAjIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHN0b2tlbiBtYXJrZXQgLSBhbGwgaW50ZXJlc3QgZ29lcyB0byByZXNlcnZlcwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IGludGVyZXN0CiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IChpbnRlcmVzdCAqIHJlc2VydmVfZmFjdG9yKSAvLyAxMDAwMAogICAgLy8gICAgICAgICBpZiBwcm90b2NvbF9wb3J0aW9uID4gaW50ZXJlc3Q6CiAgICAvLyAgICAgICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gaW50ZXJlc3QKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBpbnRlcmVzdCAtIHByb3RvY29sX3BvcnRpb24KICAgIC8vICAgICByZXR1cm4gSW50ZXJlc3RTcGxpdCgKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb249YXJjNC5VSW50MjU2KGRlcG9zaXRvcl9wb3J0aW9uKSwKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbj1hcmM0LlVJbnQyNTYocHJvdG9jb2xfcG9ydGlvbiksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hY2NydWVfaW50ZXJlc3Qoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgQWNjcnVlIGludGVyZXN0IGZvciBhIG1hcmtldCBiYXNlZCBvbiB0aW1lIGVsYXBzZWQgYW5kIHV0aWxpemF0aW9uLgogICAgLy8gICAgICIiIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGN1cnJlbnRfdGltZSA9IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wCiAgICAvLyAgICAgdGltZV9kZWx0YSA9IGN1cnJlbnRfdGltZSAtIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lLm5hdGl2ZQogICAgLy8gICAgIGlmIHRpbWVfZGVsdGEgPD0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgdXRpbGl6YXRpb24gPSBzZWxmLl9jYWxjdWxhdGVfdXRpbGl6YXRpb24obWFya2V0LCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXRpbGl6YXRpb24gPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfaW50ZXJlc3QobWFya2V0LCB1dGlsaXphdGlvbiwgdGltZV9kZWx0YSkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgSW50ZXJlc3QgZGlzdHJpYnV0aW9uCiAgICAvLyAgICAgaW50ZXJlc3Rfc3BsaXQgPSBzZWxmLl9jYWxjdWxhdGVfaW50ZXJlc3Rfc3BsaXQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgc2VsZi5zdG9rZW5fYXBwX2lkLCBpbnRlcmVzdCwgbWFya2V0LnJlc2VydmVfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgaWYgdXNlciBpbmRleGVzIGNhbiBncm93IG1lYW5pbmdmdWxseQogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8gZm9yIGZpcnN0IGRlcG9zaXRzL2JvcnJvd3MKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICBkZXBvc2l0b3JfaW5jcmVtZW50ID0gQmlnVUludCgwKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9pbmNyZW1lbnQgPSAoaW50ZXJlc3Rfc3BsaXQuZGVwb3NpdG9yX3BvcnRpb24ubmF0aXZlICogU0NBTEUpIC8vICgKICAgIC8vICAgICAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgYm9ycm93ZXJfaW5jcmVtZW50ID0gQmlnVUludCgwKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJvcnJvd2VyX2luY3JlbWVudCA9IChpbnRlcmVzdCAqIFNDQUxFKSAvLyAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIGlmIGRlcG9zaXRvcl9pbmNyZW1lbnQgPT0gMCBvciBib3Jyb3dlcl9pbmNyZW1lbnQgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgIyBtYXJrZXQgZGVwb3NpdCBpbmRleCB1cGRhdGUgZGVwZW5kcyBvbiBkZXBvc2l0b3IgcG9ydGlvbiBvZiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICsgZGVwb3NpdG9yX2luY3JlbWVudAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIG1hcmtldCBib3Jyb3cgaW5kZXggdXBkYXRlIGRlcGVuZHMgb24gZnVsbCBpbnRlcmVzdCBhbW91bnQKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPiAwOgogICAgLy8gICAgICAgICBtYXJrZXQuYm9ycm93X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgKyBib3Jyb3dlcl9pbmNyZW1lbnQKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBtYXJrZXQgdG90YWwgc2NhbGVkIGJvcnJvd3MgdXBkYXRlIGRlcGVuZHMgb24gZnVsbCBpbnRlcmVzdCBhbW91bnQKICAgIC8vICAgICAjIENvbnZlcnQgaW50ZXJlc3QgdG8gc2NhbGVkIGJvcnJvd3MgdXNpbmcgY3VycmVudCBtYXJrZXQgaW5kZXgKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogZW5zdXJlIGJvcnJvd19pbmRleCBpcyBuZXZlciAwCiAgICAvLyAgICAgYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICBpZiBib3Jyb3dfaW5kZXggPT0gMDoKICAgIC8vICAgICAgICAgYm9ycm93X2luZGV4ID0gQmlnVUludChTQ0FMRSkKICAgIC8vICAgICBpbnRlcmVzdF9zY2FsZWRfYm9ycm93cyA9IChpbnRlcmVzdCAqIFNDQUxFKSAvLyBib3Jyb3dfaW5kZXgKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBpbnRlcmVzdF9zY2FsZWRfYm9ycm93cwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgbWFya2V0IHRvdGFsIHNjYWxlZCBkZXBvc2l0cyB1cGRhdGUgZGVwZW5kcyBvbiBkZXBvc2l0b3IgcG9ydGlvbiBvZiBpbnRlcmVzdAogICAgLy8gICAgICMgQ29udmVydCBkZXBvc2l0b3IgcG9ydGlvbiB0byBzY2FsZWQgZGVwb3NpdHMgdXNpbmcgY3VycmVudCBtYXJrZXQgaW5kZXgKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogZW5zdXJlIGRlcG9zaXRfaW5kZXggaXMgbmV2ZXIgMAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICBpZiBkZXBvc2l0X2luZGV4ID09IDA6CiAgICAvLyAgICAgICAgIGRlcG9zaXRfaW5kZXggPSBCaWdVSW50KFNDQUxFKQogICAgLy8gICAgIGRlcG9zaXRvcl9zY2FsZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICBpbnRlcmVzdF9zcGxpdC5kZXBvc2l0b3JfcG9ydGlvbi5uYXRpdmUgKiBTQ0FMRQogICAgLy8gICAgICkgLy8gZGVwb3NpdF9pbmRleAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgZGVwb3NpdG9yX3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIG1hcmtldCByZXNlcnZlcyB1cGRhdGUgZGVwZW5kcyBvbiBwcm90b2NvbCBwb3J0aW9uIG9mIGludGVyZXN0CiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQucmVzZXJ2ZXMubmF0aXZlICsgaW50ZXJlc3Rfc3BsaXQucHJvdG9jb2xfcG9ydGlvbi5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KGN1cnJlbnRfdGltZSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gIyBUT0RPIGdvdmVybmFuY2U6IGNvbnNpZGVyIGlmIHJlc2VydmUgd2l0aGRyYXdhbCBzaG91bGQgcmVxdWlyZSBhZGRpdGlvbmFsCiAgICAvLyAjICAgICAgZ292ZXJuYW5jZSBtZWNoYW5pc21zCiAgICAvLyAjIFRPRE8gbWluaW11bSByZXNlcnZlIGxldmVsczogbWlnaHQgd2FudCB0byBlbmZvcmNlIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHMgZm9yCiAgICAvLyAjICAgICAgcHJvdG9jb2wgc2FmZXR5CiAgICAvLyAjIFRPRE8gZXZlbnQgZW1pc3Npb246IENvbnNpZGVyIGFkZGluZyBhbiBldmVudCB0byBsb2cgcmVzZXJ2ZSB3aXRoZHJhd2FscyBmb3IKICAgIC8vICMgICAgICB0cmFuc3BhcmVuY3kKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fd2l0aGRyYXdfcmVzZXJ2ZXMobWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX3dpdGhkcmF3X3Jlc2VydmVzX3B1cmUobWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3X3Jlc2VydmVzX3B1cmUoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBtYXJrZXQucmVzZXJ2ZXMubmF0aXZlID49IGFtb3VudCwgIkluc3VmZmljaWVudCByZXNlcnZlcyIKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbigKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50LCBndWFyZF9zdG9rZW46IGJvb2wKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCBhbW91bnQgPiAwLCAiQW1vdW50IG11c3QgYmUgPiAwIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBub3QgbWFya2V0LnBhdXNlZCwgIk1hcmtldCBpcyBwYXVzZWQiCiAgICAvLyAgICAgaWYgZ3VhcmRfc3Rva2VuOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgLy8gICAgICAgICApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGZvciB0aGlzIG9wZXJhdGlvbiIKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUmVzb2x2ZSAoY2xhaW0vY29tcG91bmQpIGFjY3VtdWxhdGVkIGludGVyZXN0IGZvciBhIHVzZXIncyBkZXBvc2l0IHBvc2l0aW9uLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBmdW5jdGlvbiBoYW5kbGVzIHRoZSBpbnRlcmVzdCB0aGF0IGhhcyBhY2NydWVkIHNpbmNlIHRoZSB1c2VyJ3MgbGFzdAogICAgLy8gICAgIGludGVyYWN0aW9uIGJ5IGNvbnZlcnRpbmcgaXQgdG8gYWRkaXRpb25hbCBzY2FsZWQgZGVwb3NpdHMuIFRoaXMgbWFrZXMKICAgIC8vICAgICBzdWJzZXF1ZW50IG9wZXJhdGlvbnMgcHVyZWx5IGFkZGl0aXZlIHNpbmNlIHRoZSBpbnRlcmVzdCBoYXMgYWxyZWFkeSBiZWVuCiAgICAvLyAgICAgInBhaWQgb3V0Ii4KICAgIC8vIAogICAgLy8gICAgIE5vdGU6IFRoaXMgZnVuY3Rpb24gYXNzdW1lcyB0aGF0IGludGVyZXN0IGhhcyBhbHJlYWR5IGJlZW4gYWNjcnVlZCBieSB0aGUKICAgIC8vICAgICBjYWxsZXIgKGUuZy4sIHZpYSBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKSB0byBhdm9pZAogICAgLy8gICAgIGRvdWJsZSBpbnRlcmVzdCBhY2NydWFsLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCAoVUludDY0KTogVGhlIElEIG9mIHRoZSBtYXJrZXQKICAgIC8vICAgICAiIiIKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0X3dpdGhfZGF0YSh1c2VyLCBtYXJrZXQpCiAgICAvLyAgICAgaWYgaW50ZXJlc3QgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuCiAgICAvLyAgICAgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCA9IHNlbGYuX2dldF9tYXJrZXRfc2NhbGVkX2RlcG9zaXQobWFya2V0LCBpbnRlcmVzdCkKICAgIC8vICAgICBpbnRlcmVzdF92YWx1ZSA9IHNlbGYuX2dldF9tYXJrZXRfdmFsdWUobWFya2V0LCBpbnRlcmVzdCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgdXNlcl9pZCwgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwodXNlcl9pZCwgQmlnVUludCgwKSwgaW50ZXJlc3RfdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUmVzb2x2ZSAoY2xhaW0vY29tcG91bmQpIGFjY3VtdWxhdGVkIGludGVyZXN0IGZvciBhIHVzZXIncyBib3Jyb3cgcG9zaXRpb24uCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhKHVzZXIsIG1hcmtldCkKICAgIC8vICAgICBpZiBpbnRlcmVzdCA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vICAgICBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gc2VsZi5fZ2V0X21hcmtldF9zY2FsZWRfYm9ycm93KG1hcmtldCwgaW50ZXJlc3QpCiAgICAvLyAgICAgaW50ZXJlc3RfdmFsdWUgPSBzZWxmLl9nZXRfbWFya2V0X3ZhbHVlKG1hcmtldCwgaW50ZXJlc3QpCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIHVzZXJfaWQsIGludGVyZXN0X3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKHVzZXJfaWQsIEJpZ1VJbnQoMCksIGludGVyZXN0X3ZhbHVlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdHMoc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdF9hbW91bnQoCiAgICAvLyAgICAgICAgIG1hcmtldCwgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzKHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSkgLT4gQmlnVUludDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd19hbW91bnQoCiAgICAvLyAgICAgICAgIG1hcmtldCwgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRfYW1vdW50KAogICAgLy8gICAgIHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dfYW1vdW50KAogICAgLy8gICAgIHNlbGYsIG1hcmtldDogTWFya2V0RGF0YSwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF9zY2FsZWRfZGVwb3NpdCgKICAgIC8vICAgICBzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBlbnN1cmUgZGVwb3NpdF9pbmRleCBpcyBuZXZlciAwIHRvIHByZXZlbnQgZGl2aXNpb24gYnkgemVybwogICAgLy8gICAgICMgSWYgZGVwb3NpdF9pbmRleCBpcyAwLCBpbml0aWFsaXplIGl0IHRvIFNDQUxFICgxLjApCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgIGlmIGRlcG9zaXRfaW5kZXggPT0gMDoKICAgIC8vICAgICAgICAgZGVwb3NpdF9pbmRleCA9IEJpZ1VJbnQoU0NBTEUpCiAgICAvLyAgICAgcmV0dXJuIChhbW91bnQgKiBTQ0FMRSkgLy8gZGVwb3NpdF9pbmRleAogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3coc2VsZiwgbWFya2V0OiBNYXJrZXREYXRhLCBhbW91bnQ6IEJpZ1VJbnQpIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGVuc3VyZSBib3Jyb3dfaW5kZXggaXMgbmV2ZXIgMCB0byBwcmV2ZW50IGRpdmlzaW9uIGJ5IHplcm8KICAgIC8vICAgICAjIElmIGJvcnJvd19pbmRleCBpcyAwLCBpbml0aWFsaXplIGl0IHRvIFNDQUxFICgxLjApCiAgICAvLyAgICAgYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICBpZiBib3Jyb3dfaW5kZXggPT0gMDoKICAgIC8vICAgICAgICAgYm9ycm93X2luZGV4ID0gQmlnVUludChTQ0FMRSkKICAgIC8vICAgICByZXR1cm4gKGFtb3VudCAqIFNDQUxFKSAvLyBib3Jyb3dfaW5kZXgKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF92YWx1ZShzZWxmLCBtYXJrZXQ6IE1hcmtldERhdGEsIGFtb3VudDogQmlnVUludCkgLT4gQmlnVUludDoKICAgIC8vICAgICByZXR1cm4gKGFtb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRlcG9zaXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyODAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX2RlcG9zaXQoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVwb3NpdF9wdXJlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBQdXJlIGRlcG9zaXQgb3BlcmF0aW9uIHRoYXQgYWRkcyBuZXcgZnVuZHMgd2l0aG91dCBoYW5kbGluZyBpbnRlcmVzdC4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgZnVuY3Rpb24gYXNzdW1lcyB0aGF0IGFueSBhY2N1bXVsYXRlZCBpbnRlcmVzdCBoYXMgYWxyZWFkeSBiZWVuIHJlc29sdmVkCiAgICAvLyAgICAgYnkgY2FsbGluZyBfcmVzb2x2ZV9hY2N1bXVsYXRlZF9pbnRlcmVzdCgpIGJlZm9yZWhhbmQuIEl0IHBlcmZvcm1zIG9ubHkgdGhlCiAgICAvLyAgICAgZGVwb3NpdCBvcGVyYXRpb24sIG1ha2luZyBpdCBwdXJlbHkgYWRkaXRpdmUuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkIChBY2NvdW50KTogVGhlIGFjY291bnQgSUQgb2YgdGhlIHVzZXIgbWFraW5nIHRoZSBkZXBvc2l0CiAgICAvLyAgICAgICAgIG1hcmtldF9pZCAoVUludDY0KTogVGhlIElEIG9mIHRoZSBtYXJrZXQgdG8gZGVwb3NpdCBpbnRvCiAgICAvLyAgICAgICAgIGFtb3VudCAoQmlnVUludCk6IFRoZSBhbW91bnQgb2YgdW5kZXJseWluZyB0b2tlbnMgdG8gZGVwb3NpdAogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgZGVwb3NpdCBvcGVyYXRpb24KICAgIC8vICAgICAjIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAjICAgICBtYXJrZXRfaWQKICAgIC8vICAgICAjICkuZGVwb3NpdC5uYXRpdmUKICAgIC8vICAgICAjIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICMgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiRGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdHMgPSBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdHMobWFya2V0KQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC5tYXhfdG90YWxfZGVwb3NpdHMubmF0aXZlID49IG1hcmtldF91bmRlcmx5aW5nX2RlcG9zaXRzICsgYW1vdW50CiAgICAvLyAgICAgKSwgIk1hcmtldCBkZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gc2VsZi5fZ2V0X21hcmtldF9zY2FsZWRfZGVwb3NpdChtYXJrZXQsIGFtb3VudCkKICAgIC8vICAgICBkZXBvc2l0X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGFtb3VudCkKICAgIC8vICAgICBzZWxmLl9jb2xsYXRlcmFsX2RlcG9zaXRfcHVyZSgKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgYW1vdW50LAogICAgLy8gICAgICAgICBzY2FsZWRfYW1vdW50LAogICAgLy8gICAgICAgICBkZXBvc2l0X3ZhbHVlLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVwb3NpdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIEludGVybmFsIGRlcG9zaXQgbWV0aG9kIHRoYXQgaGFuZGxlcyB1c2VyIGRlcG9zaXRzIGludG8gYSBsZW5kaW5nIG1hcmtldC4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIHBlcmZvcm1zIGEgY29tcGxldGUgZGVwb3NpdCBvcGVyYXRpb24gd2l0aCBzZXBhcmF0ZWQgY29uY2VybnM6CiAgICAvLyAgICAgMS4gU3luY3MgdXNlciBtYXJrZXQgZm9yIHByaWNlIGNoYW5nZXMgKGFjY3J1ZXMgaW50ZXJlc3QsIHVwZGF0ZXMgZ2xvYmFsIHZhbHVlcywgcmVzb2x2ZXMgaW50ZXJlc3QpCiAgICAvLyAgICAgMi4gUGVyZm9ybXMgcHVyZSBkZXBvc2l0IG9wZXJhdGlvbiAoYWRkcyBuZXcgZnVuZHMgd2l0aG91dCBpbnRlcmVzdCBoYW5kbGluZykKICAgIC8vIAogICAgLy8gICAgIFRoZSBzZXBhcmF0aW9uIGVuc3VyZXM6CiAgICAvLyAgICAgLSBTaW5nbGUgaW50ZXJlc3QgYWNjcnVhbCBwZXIgb3BlcmF0aW9uCiAgICAvLyAgICAgLSBDbGVhbiBzZXBhcmF0aW9uIGJldHdlZW4gaW50ZXJlc3QgcmVzb2x1dGlvbiBhbmQgbmV3IGRlcG9zaXRzCiAgICAvLyAgICAgLSBDb25zaXN0ZW50IHByaWNlIHN5bmNocm9uaXphdGlvbgogICAgLy8gICAgIC0gUHVyZSBhZGRpdGl2ZSBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIG1ha2luZyB0aGUgZGVwb3NpdAogICAgLy8gICAgICAgICBtYXJrZXRfaWQgKFVJbnQ2NCk6IFRoZSBJRCBvZiB0aGUgbWFya2V0IHRvIGRlcG9zaXQgaW50bwogICAgLy8gICAgICAgICBhbW91bnQgKEJpZ1VJbnQpOiBUaGUgYW1vdW50IG9mIHVuZGVybHlpbmcgdG9rZW5zIHRvIGRlcG9zaXQKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIG1hcmtldCB2YWxpZGF0aW9uIGZhaWxzLCBkZXBvc2l0IGNhcCBpcyBleGNlZWRlZCwgb3Igb3RoZXIgY29uc3RyYWludHMgYXJlIHZpb2xhdGVkCiAgICAvLyAKICAgIC8vICAgICBOb3RlOgogICAgLy8gICAgICAgICAtIEFsbCBwcmljZSBjaGFuZ2VzIGFuZCBpbnRlcmVzdCByZXNvbHV0aW9uIGFyZSBoYW5kbGVkIGluIHRoZSBzeW5jIHN0ZXAKICAgIC8vICAgICAgICAgLSBUaGUgZGVwb3NpdCBvcGVyYXRpb24gaXMgcHVyZWx5IGFkZGl0aXZlLCBhZGRpbmcgb25seSB0aGUgbmV3IGFtb3VudAogICAgLy8gICAgICAgICAtIFVzZXIncyBnbG9iYWwgY29sbGF0ZXJhbC9ib3Jyb3cgdmFsdWVzIGFyZSB1cGRhdGVkIHdpdGggY3VycmVudCBwcmljZXMgZHVyaW5nIHN5bmMKICAgIC8vICAgICAiIiIKICAgIC8vICAgICAjIFN5bmMgdXNlciBtYXJrZXQgZm9yIHByaWNlIGNoYW5nZQogICAgLy8gICAgIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIFBlcmZvcm0gcHVyZSBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gICAgIHNlbGYuX2RlcG9zaXRfcHVyZSh1c2VyX2lkLCBtYXJrZXRfaWQsIGFtb3VudCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDcwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBpbnRlcmVzdCIiIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGEodXNlciwgbWFya2V0KQogICAgLy8gICAgIHJldHVybiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdF93aXRoX2RhdGEoCiAgICAvLyAgICAgc2VsZiwgdXNlcjogVXNlckRhdGEsIG1hcmtldDogTWFya2V0RGF0YQogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBpbnRlcmVzdCB1c2luZyBwcmUtZmV0Y2hlZCBkYXRhIiIiCiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIgaGFzIG5vIGRlcG9zaXRzLCByZXR1cm4gMCBpbnRlcmVzdAogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gQmlnVUludCgwKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgY3VycmVudCB1bmRlcmx5aW5nIHZhbHVlCiAgICAvLyAgICAgY3VycmVudF91bmRlcmx5aW5nID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB1bmRlcmx5aW5nIHZhbHVlIGF0IHVzZXIncyBsYXN0IHVwZGF0ZQogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBpZiB1c2VyJ3MgZGVwb3NpdF9pbmRleCBpcyAwIChuZXcgdXNlciksIHVzZSBjdXJyZW50IG1hcmtldCBpbmRleAogICAgLy8gICAgIHVzZXJfZGVwb3NpdF9pbmRleCA9ICgKICAgIC8vICAgICAgICAgdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBsYXN0X3VuZGVybHlpbmcgPSAodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogdXNlcl9kZXBvc2l0X2luZGV4KSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBJbnRlcmVzdCBpcyB0aGUgZGlmZmVyZW5jZQogICAgLy8gICAgIGlmIGN1cnJlbnRfdW5kZXJseWluZyA+IGxhc3RfdW5kZXJseWluZzoKICAgIC8vICAgICAgICAgaW50ZXJlc3QgPSBjdXJyZW50X3VuZGVybHlpbmcgLSBsYXN0X3VuZGVybHlpbmcKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBpbnRlcmVzdCA9IEJpZ1VJbnQoMCkKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgZGVidCBpbnRlcmVzdCIiIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0X3dpdGhfZGF0YSh1c2VyLCBtYXJrZXQpCiAgICAvLyAgICAgcmV0dXJuIGludGVyZXN0CiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3Rfd2l0aF9kYXRhKAogICAgLy8gICAgIHNlbGYsIHVzZXI6IFVzZXJEYXRhLCBtYXJrZXQ6IE1hcmtldERhdGEKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgZGVidCBpbnRlcmVzdCB1c2luZyBwcmUtZmV0Y2hlZCBkYXRhIiIiCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgdW5kZXJseWluZyBkZWJ0IGFtb3VudAogICAgLy8gICAgIHVzZXJfdG90YWxfZGVidCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIG9yaWdpbmFsIHByaW5jaXBhbCBhbW91bnQgdXNpbmcgdXNlcidzIGJvcnJvd19pbmRleAogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBpZiB1c2VyJ3MgYm9ycm93X2luZGV4IGlzIDAsIHVzZSBjdXJyZW50IG1hcmtldCBib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyX2JvcnJvd19pbmRleCA9ICgKICAgIC8vICAgICAgICAgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBvcmlnaW5hbF9wcmluY2lwYWwgPSAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyX2JvcnJvd19pbmRleCkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRvdGFsIGRlYnQgYW5kIG9yaWdpbmFsIHByaW5jaXBhbAogICAgLy8gICAgICMgUHJldmVudCBuZWdhdGl2ZSBpbnRlcmVzdCAodW5kZXJmbG93IHByb3RlY3Rpb24pCiAgICAvLyAgICAgaWYgdXNlcl90b3RhbF9kZWJ0ID49IG9yaWdpbmFsX3ByaW5jaXBhbDoKICAgIC8vICAgICAgICAgZGVidF9pbnRlcmVzdCA9IHVzZXJfdG90YWxfZGVidCAtIG9yaWdpbmFsX3ByaW5jaXBhbAogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlYnRfaW50ZXJlc3QgPSBCaWdVSW50KDApCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gZGVidF9pbnRlcmVzdAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhdyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50MjU2KHNlbGYuX3dpdGhkcmF3KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jb2xsYXRlcmFsX2RlcG9zaXRfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbnRva2VuX2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhiZW5lZmljaWFyeV9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihzY2FsZWRfYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG50b2tlbl9pZCksCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgYmVuZWZpY2lhcnlfaWQsIHNjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9nbG9iYWxfY29sbGF0ZXJhbChiZW5lZmljaWFyeV9pZCwgdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NvbGxhdGVyYWxfd2l0aGRyYXdfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbnRva2VuX2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUHVyZSBjb2xsYXRlcmFsIHdpdGhkcmF3YWwgb3BlcmF0aW9uIHRoYXQgYnVybnMgblRva2VucyBhbmQgdHJhbnNmZXJzIHVuZGVybHlpbmcgdG9rZW5zLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgcGVyZm9ybXMgdGhlIGNvcmUgY29sbGF0ZXJhbCB3aXRoZHJhd2FsIGxvZ2ljIHdpdGhvdXQgaGFuZGxpbmcgaW50ZXJlc3QKICAgIC8vICAgICBjYWxjdWxhdGlvbnMgb3IgdmFsaWRhdGlvbnMuIEl0IGFzc3VtZXMgdGhhdCBhbGwgbmVjZXNzYXJ5IHZhbGlkYXRpb25zIGFuZCBpbnRlcmVzdAogICAgLy8gICAgIGFjY3J1YWxzIGhhdmUgYmVlbiBoYW5kbGVkIGJ5IHRoZSBjYWxsaW5nIG1ldGhvZCBiZWZvcmVoYW5kLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIHdpdGhkcmF3aW5nIGNvbGxhdGVyYWwKICAgIC8vICAgICAgICAgYmVuZWZpY2lhcnlfaWQgKEFjY291bnQpOiBUaGUgYWNjb3VudCBJRCB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgd2l0aGRyYXduIHRva2VucwogICAgLy8gICAgICAgICBtYXJrZXRfaWQgKFVJbnQ2NCk6IFRoZSBJRCBvZiB0aGUgbWFya2V0IGZyb20gd2hpY2ggY29sbGF0ZXJhbCBpcyBiZWluZyB3aXRoZHJhd24KICAgIC8vICAgICAgICAgbnRva2VuX2lkIChVSW50NjQpOiBUaGUgSUQgb2YgdGhlIG5Ub2tlbiBhcHBsaWNhdGlvbiB0byBidXJuIHRva2VucyBmcm9tCiAgICAvLyAgICAgICAgIGFtb3VudCAoQmlnVUludCk6IFRoZSBhY3R1YWwgYW1vdW50IG9mIHVuZGVybHlpbmcgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAvLyAgICAgICAgIHNjYWxlZF9hbW91bnQgKEJpZ1VJbnQpOiBUaGUgc2NhbGVkIGFtb3VudCBvZiBuVG9rZW5zIHRvIGJ1cm4KICAgIC8vICAgICAgICAgdmFsdWUgKEJpZ1VJbnQpOiBUaGUgVVNEIHZhbHVlIG9mIHRoZSBjb2xsYXRlcmFsIGJlaW5nIHdpdGhkcmF3bgogICAgLy8gCiAgICAvLyAgICAgUHJvY2VzczoKICAgIC8vICAgICAgICAgMS4gQnVybnMgdGhlIHNwZWNpZmllZCBzY2FsZWQgYW1vdW50IG9mIG5Ub2tlbnMgZnJvbSB0aGUgdXNlcgogICAgLy8gICAgICAgICAyLiBEZWNyZW1lbnRzIHRoZSB1c2VyJ3Mgc2NhbGVkIGRlcG9zaXQgYmFsYW5jZSBmb3IgdGhlIG1hcmtldAogICAgLy8gICAgICAgICAzLiBEZWNyZW1lbnRzIHRoZSB0b3RhbCBzY2FsZWQgZGVwb3NpdHMgZm9yIHRoZSBtYXJrZXQKICAgIC8vICAgICAgICAgNC4gVHJhbnNmZXJzIHRoZSB1bmRlcmx5aW5nIHRva2VucyB0byB0aGUgYmVuZWZpY2lhcnkKICAgIC8vICAgICAgICAgNS4gRGVjcmVtZW50cyB0aGUgdXNlcidzIGdsb2JhbCBjb2xsYXRlcmFsIHZhbHVlIHRyYWNraW5nCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoc2NhbGVkX2Ftb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihudG9rZW5faWQpLAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3MoYmVuZWZpY2lhcnlfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCB2YWx1ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcHVyZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUHVyZSB3aXRoZHJhdyBvcGVyYXRpb24gdGhhdCBidXJucyBuVG9rZW5zIGFuZCB0cmFuc2ZlcnMgdW5kZXJseWluZyB0b2tlbnMgdG8gdXNlci4KICAgIC8vICAgICAiIiIKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3Igd2l0aGRyYXcgb3BlcmF0aW9uCiAgICAvLyAgICAgIyBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgIyAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgIyApLndpdGhkcmF3Lm5hdGl2ZQogICAgLy8gICAgICMgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgIyAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiV2l0aGRyYXcgY2FwIGV4Y2VlZGVkIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGFtb3VudCA8PSB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB0aGUgYWN0dWFsIHVuZGVybHlpbmcgYW1vdW50IHRvIHRyYW5zZmVyIHRvIHVzZXIKICAgIC8vICAgICAjIGFtb3VudCBpcyB0aGUgc2NhbGVkIGFtb3VudCAoblRva2VucyksIHdlIG5lZWQgdG8gY29udmVydCB0byB1bmRlcmx5aW5nCiAgICAvLyAgICAgdW5kZXJseWluZ19hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfZGVwb3NpdF9hbW91bnQobWFya2V0LCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICB1bmRlcmx5aW5nX3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIHVuZGVybHlpbmdfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBoZWFsdGggY2hlY2s6IGVuc3VyZSB3aXRoZHJhdyB3b3VsZCBub3QgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgIGlmIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZSA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICB1bmRlcmx5aW5nX3ZhbHVlIDw9IGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlCiAgICAvLyAgICAgICAgICksICJXaXRoZHJhd2FsIHB1dHMgdXNlciBhdCByaXNrIG9mIGxpcXVpZGF0aW9uIgogICAgLy8gICAgICAgICByZW1haW5pbmdfY29sbGF0ZXJhbCA9ICgKICAgIC8vICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gdW5kZXJseWluZ192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIGFzc2VydCBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIDw9ICgKICAgIC8vICAgICAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsICogQmlnVUludChtYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgLy8gICAgICAgICApIC8vIEJpZ1VJbnQoMTAwMDApLCAiV2l0aGRyYXdhbCBwdXRzIHVzZXIgYXQgcmlzayBvZiBsaXF1aWRhdGlvbiIKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3Igd2l0aGRyYXcgb3BlcmF0aW9uCiAgICAvLyAgICAgIyB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgICMgaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9PSAwOgogICAgLy8gICAgICMgICAgIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCArIDg2NDAwKQogICAgLy8gICAgICMgZWxpZiB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lIDwgR2xvYmFsLmxhdGVzdF90aW1lc3RhbXA6CiAgICAvLyAgICAgIyAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIC8vICAgICAjICAgICB1c2VyX2NhcC50b3RhbF9saXF1aWRhdGlvbnMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIC8vICAgICAjICAgICB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIC8vICAgICAjIGlmIHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgIyAgICAgbmV3X3RvdGFsX3dpdGhkcmF3YWxzID0gdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMubmF0aXZlICsgYW1vdW50X3VzZF92YWx1ZQogICAgLy8gICAgICMgICAgIGFzc2VydCAoCiAgICAvLyAgICAgIyAgICAgICAgIG5ld190b3RhbF93aXRoZHJhd2FscyA8PSB1c2VyX2NhcC5kYWlseV93aXRoZHJhd2Fscy5uYXRpdmUKICAgIC8vICAgICAjICAgICApLCAiVXNlciB3aXRoZHJhdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAgICAgIyAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYobmV3X3RvdGFsX3dpdGhkcmF3YWxzKQogICAgLy8gICAgICMgICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLCB1c2VyX2NhcCkKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2NvbGxhdGVyYWxfd2l0aGRyYXdfcHVyZSgKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgdW5kZXJseWluZ19hbW91bnQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgdW5kZXJseWluZ192YWx1ZSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIEVtaXQgZXZlbnRzCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0V2l0aGRyYXcoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgYXJjNC5VSW50NjQobWFya2V0X2lkKSwgYXJjNC5VSW50MjU2KGFtb3VudCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gdW5kZXJseWluZ19hbW91bnQKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXcoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX3dpdGhkcmF3X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGJvcnJvdyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDI4MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fYm9ycm93KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2JvcnJvd19wdXJlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIGJvcnJvdyBvcGVyYXRpb24KICAgIC8vICAgICAjIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAjICAgICBtYXJrZXRfaWQKICAgIC8vICAgICAjICkuYm9ycm93Lm5hdGl2ZQogICAgLy8gICAgICMgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgIyAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQodXNlcl9pZCkKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSBVSW50NjQoMTAwMDAwKSwgIlBheW1lbnQgYW1vdW50IG11c3QgYmUgPj0gMC4xIgogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGN1cnJlbnQgbWFya2V0IHRvdGFsIGJvcnJvd3MgKGluY2x1ZGluZyBpbnRlcmVzdCkKICAgIC8vICAgICBtYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dzID0gc2VsZi5fZ2V0X21hcmtldF91bmRlcmx5aW5nX2JvcnJvd3MobWFya2V0KQogICAgLy8gCiAgICAvLyAgICAgIyBWYWxpZGF0ZSBhZ2FpbnN0IG1hcmtldC13aWRlIGJvcnJvdyBjYXAKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQubWF4X3RvdGFsX2JvcnJvd3MubmF0aXZlID49IG1hcmtldF91bmRlcmx5aW5nX2JvcnJvd3MgKyBhbW91bnQKICAgIC8vICAgICApLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgY29sbGF0ZXJhbCByZXF1aXJlbWVudHMgLSBleGNsdWRlIHNhbWUgbWFya2V0IGNvbGxhdGVyYWwgdG8gcHJldmVudAogICAgLy8gICAgICMgaW5lZmZpY2llbnQgc2FtZS1hc3NldCBib3Jyb3dpbmcKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgYm9ycm93X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IEJpZ1VJbnQoMCk6CiAgICAvLyAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICAgICAjIFVzZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBleGNsdWRlZF92YWx1ZSA9IChkZXBvc2l0ZWRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgaWYgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgPiBleGNsdWRlZF92YWx1ZToKICAgIC8vICAgICAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gKAogICAgLy8gICAgICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gZXhjbHVkZWRfdmFsdWUKICAgIC8vICAgICAgICAgICAgICkKICAgIC8vICAgICAgICAgZWxzZToKICAgIC8vICAgICAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gQmlnVUludCgwKQogICAgLy8gCiAgICAvLyAgICAgdG90YWxfYm9ycm93X3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSArIGJvcnJvd192YWx1ZQogICAgLy8gICAgIGFzc2VydCB0b3RhbF9ib3Jyb3dfdmFsdWUgPD0gKAogICAgLy8gICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSAqIEJpZ1VJbnQobWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICAgICApIC8vIEJpZ1VJbnQoMTAwMDApLCAiSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgYWNyb3NzIG1hcmtldHMiCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBleHBlY3RlZCBzY2FsZWQgYm9ycm93cwogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3cobWFya2V0LCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9kZWJ0X2JvcnJvd19wdXJlKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgc2NhbGVkX2Ftb3VudCwKICAgIC8vICAgICAgICAgYm9ycm93X3ZhbHVlLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgRW1pdCBldmVudAogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldEJvcnJvdygKICAgIC8vICAgICAjICAgICAgICAgdXNlcj1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHRva2VuX2lkPWFyYzQuVUludDY0KG1hcmtldF9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIGFtb3VudD1hcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2JvcnJvdyhzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgc2VsZi5fYm9ycm93X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHJlcGF5KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICBzZWxmLl9yZXBheShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWJ0X3JlcGF5bWVudF9wdXJlKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgcGF5ZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MocGF5ZXJfaWQpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKHBheWVyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAjIGFkanVzdCB1c2VyJ3Mgc2NhbGVkIGJvcnJvd3MKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgYmVuZWZpY2lhcnlfaWQsIHNjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhZGp1c3QgbWFya2V0J3MgdG90YWwgc2NhbGVkIGJvcnJvd3MKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICAjIGFkanVzdCBnbG9iYWwgYm9ycm93IHZhbHVlCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X2dsb2JhbF9ib3Jyb3dzKGJlbmVmaWNpYXJ5X2lkLCB2YWx1ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXlfcHVyZShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFJlcGF5IGJvcnJvd2VkIHRva2VucyBmb3IgYSBzcGVjaWZpYyBtYXJrZXQuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBoYW5kbGVzIHRoZSByZXBheW1lbnQgb2YgYm9ycm93ZWQgdG9rZW5zLiBJdCBzdXBwb3J0cyBib3RoCiAgICAvLyAgICAgc1Rva2VuIChidXJuKSBhbmQgYVRva2VuICh0cmFuc2ZlcikgbWFya2V0cy4gVGhlIGFjdHVhbCB0b2tlbiBvcGVyYXRpb25zCiAgICAvLyAgICAgYXJlIGRlbGVnYXRlZCB0byBfZGVidF9yZXBheW1lbnRfcHVyZSgpIHdoaWNoIGNvcnJlY3RseSBoYW5kbGVzIHRoZQogICAgLy8gICAgIGNyaXRpY2FsIHRva2VuIGJ1cm4vdHJhbnNmZXIgbG9naWMuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgdXNlciBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIG1hcmtldF9pZDogVGhlIG1hcmtldCBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIGFtb3VudDogVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gcmVwYXkgKG11c3Qgbm90IGV4Y2VlZCB0b3RhbCBkZWJ0KQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgbWFya2V0IHZhbGlkYXRpb24gZmFpbHMsIHJlcGF5IGFtb3VudCBleGNlZWRzIHRvdGFsIGRlYnQsCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgb3IgcHJpbmNpcGFsIHJlcGF5bWVudCBleGNlZWRzIHNjYWxlZCBkZWJ0CiAgICAvLyAKICAgIC8vICAgICBQcm9jZXNzOgogICAgLy8gICAgICAgICAxLiBWYWxpZGF0ZXMgbWFya2V0IG9wZXJhdGlvbiBhbmQgYWNjcnVlcyBpbnRlcmVzdAogICAgLy8gICAgICAgICAyLiBHZXRzIHVzZXIgYW5kIG1hcmtldCBzdGF0ZQogICAgLy8gICAgICAgICAzLiBDYWxjdWxhdGVzIHRvdGFsIHVuZGVybHlpbmcgYm9ycm93cyBmb3IgdmFsaWRhdGlvbgogICAgLy8gICAgICAgICA0LiBWYWxpZGF0ZXMgcmVwYXkgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vICAgICAgICAgNS4gQ2FsY3VsYXRlcyBzY2FsZWQgYW1vdW50IGZvciBwcmluY2lwYWwgcmVwYXltZW50CiAgICAvLyAgICAgICAgIDYuIFZhbGlkYXRlcyBzY2FsZWQgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHVzZXIncyBzY2FsZWQgZGVidAogICAgLy8gICAgICAgICA3LiBDYWxjdWxhdGVzIHJlcGF5IHZhbHVlIGZvciBnbG9iYWwgdHJhY2tpbmcKICAgIC8vICAgICAgICAgOC4gRGVsZWdhdGVzIHRvIF9kZWJ0X3JlcGF5bWVudF9wdXJlKCkgZm9yOgogICAgLy8gICAgICAgICAgICAgLSBUb2tlbiBidXJuIChzVG9rZW4pIG9yIHRyYW5zZmVyIChhVG9rZW4pIGZyb20gdXNlcgogICAgLy8gICAgICAgICAgICAgLSBVc2VyIGFuZCBtYXJrZXQgc2NhbGVkIGJvcnJvdyB1cGRhdGVzCiAgICAvLyAgICAgICAgICAgICAtIEdsb2JhbCBib3Jyb3cgdmFsdWUgdHJhY2tpbmcKICAgIC8vIAogICAgLy8gICAgIFNlY3VyaXR5IE5vdGU6CiAgICAvLyAgICAgICAgIFRoaXMgbWV0aG9kIGNvcnJlY3RseSBidXJucyBzVG9rZW5zIGZyb20gdGhlIHVzZXIncyBhZGRyZXNzIChub3QgdGhlCiAgICAvLyAgICAgICAgIHByb3RvY29sIGFkZHJlc3MpIGFzIHBlciB0aGUgZml4IGZvciBERi1BVUQtMDIuCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB0b3RhbF91bmRlcmx5aW5nX2JvcnJvd3MgPSBzZWxmLl9nZXRfbWFya2V0X3VuZGVybHlpbmdfYm9ycm93cyhtYXJrZXQpCiAgICAvLyAgICAgYXNzZXJ0IGFtb3VudCA8PSB0b3RhbF91bmRlcmx5aW5nX2JvcnJvd3MsICJSZXBheSBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0IgogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSBzZWxmLl9nZXRfbWFya2V0X3NjYWxlZF9ib3Jyb3cobWFya2V0LCBhbW91bnQpCiAgICAvLyAgICAgYXNzZXJ0IHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IHNjYWxlZF9hbW91bnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyBkZWJ0IgogICAgLy8gICAgIHJlcGF5X3ZhbHVlID0gc2VsZi5fZ2V0X21hcmtldF92YWx1ZShtYXJrZXQsIGFtb3VudCkKICAgIC8vICAgICBzZWxmLl9kZWJ0X3JlcGF5bWVudF9wdXJlKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgc2NhbGVkX2Ftb3VudCwKICAgIC8vICAgICAgICAgcmVwYXlfdmFsdWUsCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBFbWl0IGV2ZW50CiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0UmVwYXkoCiAgICAvLyAgICAgIyAgICAgICAgIHVzZXI9YXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQobWFya2V0X2lkKSwKICAgIC8vICAgICAjICAgICAgICAgYW1vdW50PWFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX3JlcGF5X3B1cmUodXNlcl9pZCwgbWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgc2VsZi5fcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBzZWxmLl9yZXNvbHZlX2FjY3VtdWxhdGVkX2JvcnJvd19pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmV2aW91c19wcmljZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2xhc3RfcHJpY2U6IEJpZ1VJbnQsIG1hcmtldF9wcmljZTogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIHJldHVybiB1c2VyX2xhc3RfcHJpY2UgaWYgdXNlcl9sYXN0X3ByaWNlID4gMCBlbHNlIG1hcmtldF9wcmljZQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfdXNlcl9tYXJrZXRfY29sbGF0ZXJhKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXI6IFVzZXJEYXRhLCBtYXJrZXQ6IE1hcmtldERhdGEKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBVcGRhdGUgYSB1c2VyJ3MgbWFya2V0IGNvbGxhdGVyYWwgdmFsdWVzIHdoZW4gbWFya2V0IHByaWNlcyBjaGFuZ2UuCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybgogICAgLy8gCiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIncyBkZXBvc2l0X2luZGV4IGlzIDAgKG5ldyB1c2VyKSwgdXNlIGN1cnJlbnQgbWFya2V0IGluZGV4CiAgICAvLyAgICAgdXNlcl9kZXBvc2l0X2luZGV4ID0gKAogICAgLy8gICAgICAgICB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXJfZGVwb3NpdF9pbmRleCkgLy8gU0NBTEUKICAgIC8vICAgICBuZXdfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vICAgICBwcmljZV9mb3Jfb2xkID0gc2VsZi5fZ2V0X3ByZXZpb3VzX3ByaWNlKAogICAgLy8gICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlLCBtYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIG9sZF9kZXBvc2l0X3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2RlcG9zaXRfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwodXNlcl9pZCwgb2xkX2RlcG9zaXRfdmFsdWUsIG5ld19kZXBvc2l0X3ZhbHVlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfdXNlcl9tYXJrZXRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyOiBVc2VyRGF0YSwgbWFya2V0OiBNYXJrZXREYXRhCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgVXBkYXRlIGEgdXNlcidzIG1hcmtldCBib3Jyb3cgdmFsdWVzIHdoZW4gbWFya2V0IHByaWNlcyBjaGFuZ2UuCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuCiAgICAvLyAgICAgb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIHByaWNlX2Zvcl9vbGQgPSBzZWxmLl9nZXRfcHJldmlvdXNfcHJpY2UoCiAgICAvLyAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUsIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgb2xkX2JvcnJvd192YWx1ZSA9IChvbGRfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2JvcnJvd192YWx1ZSA9IChuZXdfYm9ycm93X2Ftb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKHVzZXJfaWQsIG9sZF9ib3Jyb3dfdmFsdWUsIG5ld19ib3Jyb3dfdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFVwZGF0ZSBhIHVzZXIncyBnbG9iYWwgdmFsdWVzIHdoZW4gbWFya2V0IHByaWNlcyBjaGFuZ2UuCiAgICAvLyAgICAgIiIiCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKS5jb3B5KCkKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9PSAwIGFuZCB1c2VyLnNjYWxlZF9ib3Jyb3dzID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9tYXJrZXRfY29sbGF0ZXJhKHVzZXJfaWQsIHVzZXIsIG1hcmtldCkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9tYXJrZXRfYm9ycm93cyh1c2VyX2lkLCB1c2VyLCBtYXJrZXQpCiAgICAvLyAKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfZ2xvYmFsX3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBHbG9iYWxVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfZ2xvYmFsX3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gR2xvYmFsVXNlckRhdGE6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLmdsb2JhbF91c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X2dsb2JhbF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gZ2xvYmFsX3VzZXIKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBhbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBCaWdVSW50KDApLAogICAgLy8gICAgICAgICBhbW91bnQsCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGFtb3VudDogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIGFtb3VudCwKICAgIC8vICAgICAgICAgQmlnVUludCgwKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gICAgIGlmIG9sZF92YWx1ZSA+IGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlOgogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlID0gYXJjNC5VSW50MjU2KG5ld192YWx1ZSkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXSA9IGdsb2JhbF91c2VyLmNvcHkoKQogICAgLy8gICAgIGhlYWx0aCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2hlYWx0aCgKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUsCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUsCiAgICAvLyAgICAgICAgIFVJbnQ2NCg4MDAwKSwgICMgODAlIGxpcXVpZGF0aW9uIHRocmVzaG9sZAogICAgLy8gICAgICkKICAgIC8vICAgICBhcmM0LmVtaXQoCiAgICAvLyAgICAgICAgIFVzZXJIZWFsdGgoCiAgICAvLyAgICAgICAgICAgICB1c2VyX2lkPWFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGhlYWx0aF9mYWN0b3I9YXJjNC5VSW50MjU2KGhlYWx0aCksCiAgICAvLyAgICAgICAgICAgICB0b3RhbF9jb2xsYXRlcmFsX3ZhbHVlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgICAgIHRvdGFsX2JvcnJvd192YWx1ZT1hcmM0LlVJbnQyNTYoZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cyh1c2VyX2lkLCBCaWdVSW50KDApLCBhbW91bnQpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cyh1c2VyX2lkLCBhbW91bnQsIEJpZ1VJbnQoMCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gICAgIGlmIG9sZF92YWx1ZSA+IGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmU6CiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZSA9IGFyYzQuVUludDI1NihuZXdfdmFsdWUpCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSAtIG9sZF92YWx1ZSArIG5ld192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGxpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHVzZXI6IGFyYzQuQWRkcmVzcywKICAgIC8vICAgICBkZWJ0X2Ftb3VudDogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBhcmM0LlVJbnQyNTYsCiAgICAvLyApIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDQ5MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChkZWJ0X21hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgICAgIHVzZXIubmF0aXZlLCBkZWJ0X21hcmtldF9pZC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfZGVwb3NpdF9pbnRlcmVzdCh1c2VyLm5hdGl2ZSwgZGVidF9tYXJrZXRfaWQubmF0aXZlKQogICAgLy8gICAgIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0KHVzZXIubmF0aXZlLCBkZWJ0X21hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5fcmVzb2x2ZV9hY2N1bXVsYXRlZF9kZXBvc2l0X2ludGVyZXN0KAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX3Jlc29sdmVfYWNjdW11bGF0ZWRfYm9ycm93X2ludGVyZXN0KAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIHNlbGYuX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfcHVyZSgKICAgIC8vICAgICAgICAgICAgIGRlYnRfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIFR4bi5zZW5kZXIsCiAgICAvLyAgICAgICAgICAgICB1c2VyLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIGRlYnRfYW1vdW50Lm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVidF9ib3Jyb3dfcHVyZSgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgYmVuZWZpY2lhcnlfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5taW50LAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKGJlbmVmaWNpYXJ5X2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICAgICAgcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgLy8gICAgICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyhiZW5lZmljaWFyeV9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfZ2xvYmFsX2JvcnJvd3ModXNlcl9pZCwgdmFsdWUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2hlYWx0aCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIGNvbGxhdGVyYWxfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyAgICAgYm9ycm93X3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogVUludDY0LAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgIGlmIGJvcnJvd192YWx1ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gQmlnVUludCgxMDAwMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICByZXR1cm4gKAogICAgLy8gICAgICAgICAgICAgY29sbGF0ZXJhbF92YWx1ZSAqIEJpZ1VJbnQobGlxdWlkYXRpb25fdGhyZXNob2xkKSAqIEJpZ1VJbnQoMTAwMDApCiAgICAvLyAgICAgICAgICkgLy8gKGJvcnJvd192YWx1ZSAqIEJpZ1VJbnQoMTAwMDApKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X3B1cmUoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRvcl9pZDogQWNjb3VudCwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIHJlcGF5X2Ftb3VudDogQmlnVUludCwKICAgIC8vICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogQmlnVUludCwKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBMaXF1aWRhdGUgYSB1c2VyJ3MgdW5kZXJjb2xsYXRlcmFsaXplZCBwb3NpdGlvbiBhY3Jvc3MgZGlmZmVyZW50IG1hcmtldHMuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBhbGxvd3MgYSBsaXF1aWRhdG9yIHRvIHJlcGF5IGEgcG9ydGlvbiBvZiBhIHVzZXIncyBkZWJ0IGluIG9uZSBtYXJrZXQKICAgIC8vICAgICBhbmQgcmVjZWl2ZSBjb2xsYXRlcmFsIGZyb20gYW5vdGhlciBtYXJrZXQgYXMgY29tcGVuc2F0aW9uLiBUaGUgbGlxdWlkYXRpb24gaW5jbHVkZXMKICAgIC8vICAgICBhIGJvbnVzIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzIGFuZCBoZWxwcyBtYWludGFpbiBwcm90b2NvbCBoZWFsdGggYnkgcmVtb3ZpbmcKICAgIC8vICAgICB1bmRlcmNvbGxhdGVyYWxpemVkIHBvc2l0aW9ucy4KICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIGRlYnRfbWFya2V0X2lkOiBUaGUgbWFya2V0IElEIHdoZXJlIHRoZSBkZWJ0IHRvIGJlIHJlcGFpZCBleGlzdHMKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IFRoZSBtYXJrZXQgSUQgd2hlcmUgY29sbGF0ZXJhbCB3aWxsIGJlIHNlaXplZCBmcm9tCiAgICAvLyAgICAgICAgIGxpcXVpZGF0b3JfaWQ6IFRoZSBhY2NvdW50IHBlcmZvcm1pbmcgdGhlIGxpcXVpZGF0aW9uCiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSBhY2NvdW50IGJlaW5nIGxpcXVpZGF0ZWQKICAgIC8vICAgICAgICAgZGVidF9hbW91bnQ6IFRoZSBhbW91bnQgb2YgZGVidCB0byByZXBheSAobXVzdCBpbmNsdWRlIGFjY3J1ZWQgaW50ZXJlc3QpCiAgICAvLyAgICAgICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBNaW5pbXVtIGNvbGxhdGVyYWwgYW1vdW50IHRoZSBsaXF1aWRhdG9yIGV4cGVjdHMgdG8gcmVjZWl2ZQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgYW55IHZhbGlkYXRpb24gZmFpbHMsIGluY2x1ZGluZzoKICAgIC8vICAgICAgICAgICAgIC0gVXNpbmcgc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIChib3Jyb3ctb25seSBtYXJrZXQpCiAgICAvLyAgICAgICAgICAgICAtIEF0dGVtcHRpbmcgc2VsZi1saXF1aWRhdGlvbgogICAgLy8gICAgICAgICAgICAgLSBNYXJrZXQgZG9lc24ndCBleGlzdCBvciBpcyBwYXVzZWQKICAgIC8vICAgICAgICAgICAgIC0gUG9zaXRpb24gaXMgbm90IGxpcXVpZGF0YWJsZSAoaGVhbHRoIGZhY3RvciA+PSAxLjApCiAgICAvLyAgICAgICAgICAgICAtIExpcXVpZGF0aW9uIGFtb3VudCBleGNlZWRzIG1heGltdW0gYWxsb3dlZCBvciB0b3RhbCBkZWJ0CiAgICAvLyAgICAgICAgICAgICAtIEluc3VmZmljaWVudCBjb2xsYXRlcmFsIHRvIHNlaXplCiAgICAvLyAgICAgICAgICAgICAtIENvbGxhdGVyYWwgcmVjZWl2ZWQgYmVsb3cgbWluaW11bSB0aHJlc2hvbGQKICAgIC8vIAogICAgLy8gICAgIE5vdGVzOgogICAgLy8gICAgICAgICAtIFVzZXMgdGhlIGNvbGxhdGVyYWwgbWFya2V0J3MgbGlxdWlkYXRpb24gdGhyZXNob2xkIGZvciBoZWFsdGggY2FsY3VsYXRpb24KICAgIC8vICAgICAgICAgLSBMaXF1aWRhdGlvbiBib251cyBpcyBhcHBsaWVkIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzCiAgICAvLyAgICAgICAgIC0gQWNjcnVlZCBpbnRlcmVzdCBvbiBib3RoIGRlYnQgYW5kIGNvbGxhdGVyYWwgcG9zaXRpb25zIGlzIGluY2x1ZGVkCiAgICAvLyAgICAgICAgIC0gSGFuZGxlcyBkaWZmZXJlbnQgdG9rZW4gdHlwZXMgKEFSQzIwMCB2cyBTVG9rZW4pIGFwcHJvcHJpYXRlbHkKICAgIC8vICAgICAgICAgLSBVcGRhdGVzIGdsb2JhbCBib3Jyb3cgYW5kIGNvbGxhdGVyYWwgdmFsdWVzIGZvciB0aGUgdXNlcgogICAgLy8gICAgICIiIgogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgbGlxdWlkYXRlIG9wZXJhdGlvbgogICAgLy8gICAgICMgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICMgICAgIGRlYnRfbWFya2V0X2lkCiAgICAvLyAgICAgIyApLmxpcXVpZGF0ZS5uYXRpdmUKICAgIC8vICAgICAjIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICMgICAgIGFzc2VydCBkZWJ0X2Ftb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiTGlxdWlkYXRlIGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIFJFTSBwcmV2ZW50IHVzaW5nIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCBpbiBsaXF1aWRhdGlvbiBiZWNhdXNlIHN0b2tlbgogICAgLy8gICAgICMgUkVNIG1hcmtldCBjb2xsYXRlcmFsIGRvZXMgbm90IGV4aXN0CiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQgIT0gc2VsZi5zdG9rZW5fYXBwX2lkCiAgICAvLyAgICAgKSwgIkNhbm5vdCB1c2Ugc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIChib3Jyb3ctb25seSBtYXJrZXQpIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBSRU0gcHJldmVudCBzZWxmIGxpcXVpZGF0aW9uCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgYXNzZXJ0IHVzZXJfaWQgIT0gbGlxdWlkYXRvcl9pZCwgIkNhbm5vdCBsaXF1aWRhdGUgc2VsZiIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCBkZWJ0X21hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJEZWJ0IG1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgY29sbGF0ZXJhbF9tYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiQ29sbGF0ZXJhbCBtYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBzd2FwCiAgICBjb25jYXQKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzQyCiAgICAvLyBhc3NlcnQgY29sbGF0ZXJhbF9tYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiQ29sbGF0ZXJhbCBtYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBhc3NlcnQgLy8gQ29sbGF0ZXJhbCBtYXJrZXQgZG9lcyBub3QgZXhpc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6Mjc0MwogICAgLy8gYXNzZXJ0IHJlcGF5X2Ftb3VudCA+IDAsICJSZXBheSBhbW91bnQgbXVzdCBiZSA+IDAiCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ5dGUgMHgKICAgIGI+CiAgICBhc3NlcnQgLy8gUmVwYXkgYW1vdW50IG11c3QgYmUgPiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3NDUKICAgIC8vIGRlYnRfbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChkZWJ0X21hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtNgogICAgY2FsbHN1YiBfZ2V0X21hcmtldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzQ2CiAgICAvLyBjb2xsYXRlcmFsX21hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQoY29sbGF0ZXJhbF9tYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTUKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6Mjc0OAogICAgLy8gZGVidF91c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgZGVidF9tYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtNgogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIGNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6Mjc0OQogICAgLy8gY29sbGF0ZXJhbF91c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgY29sbGF0ZXJhbF9tYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtNQogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIGNvdmVyIDMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6Mjc1MQogICAgLy8gYXNzZXJ0IG5vdCBkZWJ0X21hcmtldC5wYXVzZWQsICJEZWJ0IG1hcmtldCBpcyBwYXVzZWQiCiAgICBkdXAKICAgIGludCAwCiAgICBnZXRiaXQKICAgIGJ5dGUgMHgwMAogICAgaW50IDAKICAgIHVuY292ZXIgMgogICAgc2V0Yml0CiAgICBieXRlIDB4MDAKICAgID09CiAgICBhc3NlcnQgLy8gRGVidCBtYXJrZXQgaXMgcGF1c2VkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3NTIKICAgIC8vIGFzc2VydCBub3QgY29sbGF0ZXJhbF9tYXJrZXQucGF1c2VkLCAiQ29sbGF0ZXJhbCBtYXJrZXQgaXMgcGF1c2VkIgogICAgZGlnIDEKICAgIGludCAwCiAgICBnZXRiaXQKICAgIGJ5dGUgMHgwMAogICAgaW50IDAKICAgIHVuY292ZXIgMgogICAgc2V0Yml0CiAgICBieXRlIDB4MDAKICAgID09CiAgICBhc3NlcnQgLy8gQ29sbGF0ZXJhbCBtYXJrZXQgaXMgcGF1c2VkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3NTQKICAgIC8vIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF9nbG9iYWxfdXNlcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzU2CiAgICAvLyBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlID4gMAogICAgZHVwCiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBieXRlIDB4CiAgICBiPgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzU1LTI3NTcKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSA+IDAKICAgIC8vICksICJVc2VyIGhhcyBubyBkZWJ0IHRvIGxpcXVpZGF0ZSIKICAgIGFzc2VydCAvLyBVc2VyIGhhcyBubyBkZWJ0IHRvIGxpcXVpZGF0ZQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzYwCiAgICAvLyBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSwKICAgIHN3YXAKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6Mjc2MgogICAgLy8gY29sbGF0ZXJhbF9tYXJrZXQubGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSwKICAgIGRpZyAzCiAgICBleHRyYWN0IDgxIDggLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3NTktMjc2MwogICAgLy8gaGVhbHRoID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaGVhbHRoKAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlLAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXQubGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSwKICAgIC8vICkKICAgIHN3YXAKICAgIGNvdmVyIDIKICAgIGNhbGxzdWIgX2NhbGN1bGF0ZV91c2VyX2hlYWx0aAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzY0CiAgICAvLyBhc3NlcnQgaGVhbHRoIDwgMTAwMDAsICJQb3NpdGlvbiBpcyBub3QgbGlxdWlkYXRhYmxlIgogICAgYnl0ZSAweDI3MTAKICAgIGI8CiAgICBhc3NlcnQgLy8gUG9zaXRpb24gaXMgbm90IGxpcXVpZGF0YWJsZQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzY3CiAgICAvLyBkZWJ0X21hcmtldCwgZGVidF91c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgdW5jb3ZlciAyCiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzY2LTI3NjgKICAgIC8vIHRvdGFsX2RlYnRfdW5kZXJseWluZyA9IHNlbGYuX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dfYW1vdW50KAogICAgLy8gICAgIGRlYnRfbWFya2V0LCBkZWJ0X3VzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyApCiAgICBkdXAKICAgIGNvdmVyIDIKICAgIGNhbGxzdWIgX2dldF9tYXJrZXRfdW5kZXJseWluZ19ib3Jyb3dfYW1vdW50CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3NzAKICAgIC8vIHRvdGFsX2RlYnRfdW5kZXJseWluZyAqIEJpZ1VJbnQoZGVidF9tYXJrZXQuY2xvc2VfZmFjdG9yLm5hdGl2ZSkKICAgIGR1cAogICAgaW50IDMyMQogICAgaW50IDgKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgaXRvYgogICAgZGlnIDIKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3NzEKICAgIC8vICkgLy8gQmlnVUludCgxMDAwMCkKICAgIGJ5dGUgMHgyNzEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3NjktMjc3MQogICAgLy8gbWF4X2xpcXVpZGF0YWJsZSA9ICgKICAgIC8vICAgICB0b3RhbF9kZWJ0X3VuZGVybHlpbmcgKiBCaWdVSW50KGRlYnRfbWFya2V0LmNsb3NlX2ZhY3Rvci5uYXRpdmUpCiAgICAvLyApIC8vIEJpZ1VJbnQoMTAwMDApCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzczCiAgICAvLyByZXBheV9hbW91bnQgPD0gbWF4X2xpcXVpZGF0YWJsZQogICAgZnJhbWVfZGlnIC0yCiAgICBiPj0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6Mjc3Mi0yNzc0CiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIHJlcGF5X2Ftb3VudCA8PSBtYXhfbGlxdWlkYXRhYmxlCiAgICAvLyApLCAiQW1vdW50IGV4Y2VlZHMgbWF4aW11bSBsaXF1aWRhdGFibGUgYW1vdW50IgogICAgYXNzZXJ0IC8vIEFtb3VudCBleGNlZWRzIG1heGltdW0gbGlxdWlkYXRhYmxlIGFtb3VudAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzc4CiAgICAvLyByZXBheV9hbW91bnQgPD0gdG90YWxfZGVidF91bmRlcmx5aW5nCiAgICBmcmFtZV9kaWcgLTIKICAgIHVuY292ZXIgMgogICAgYjw9CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3NzYtMjc3OQogICAgLy8gIyBWYWxpZGF0ZSBsaXF1aWRhdGlvbiBhbW91bnQgZG9lc24ndCBleGNlZWQgdG90YWwgZGVidAogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICByZXBheV9hbW91bnQgPD0gdG90YWxfZGVidF91bmRlcmx5aW5nCiAgICAvLyApLCAiTGlxdWlkYXRpb24gYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidCIKICAgIGFzc2VydCAvLyBMaXF1aWRhdGlvbiBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3ODEtMjc4MgogICAgLy8gIyBDYWxjdWxhdGUgc2NhbGVkIGFtb3VudCBmb3IgcHJpbmNpcGFsIHJlcGF5bWVudCBvbmx5CiAgICAvLyBzY2FsZWRfcmVwYXlfYW1vdW50ID0gKHJlcGF5X2Ftb3VudCAqIFNDQUxFKSAvLyBkZWJ0X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiKgogICAgZGlnIDEKICAgIGV4dHJhY3QgMjA5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6Mjc4NAogICAgLy8gc2NhbGVkX3JlcGF5X2Ftb3VudCA8PSBkZWJ0X3VzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICBkdXAKICAgIHVuY292ZXIgMwogICAgYjw9CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3ODMtMjc4NQogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBzY2FsZWRfcmVwYXlfYW1vdW50IDw9IGRlYnRfdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUKICAgIC8vICksICJSZXBheW1lbnQgYW1vdW50IGV4Y2VlZHMgZGVidCIKICAgIGFzc2VydCAvLyBSZXBheW1lbnQgYW1vdW50IGV4Y2VlZHMgZGVidAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzg3CiAgICAvLyByZXBheV92YWx1ZSA9IChyZXBheV9hbW91bnQgKiBkZWJ0X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICBzd2FwCiAgICBpbnQgMjgxCiAgICBpbnQgMzIKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIC0yCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3OTAKICAgIC8vIHJlcGF5X3ZhbHVlICogQmlnVUludChjb2xsYXRlcmFsX21hcmtldC5saXF1aWRhdGlvbl9ib251cy5uYXRpdmUpCiAgICBkaWcgMgogICAgZXh0cmFjdCA2NSA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgaXRvYgogICAgZGlnIDEKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3OTEKICAgIC8vICkgLy8gQmlnVUludCgxMDAwMCkKICAgIGJ5dGUgMHgyNzEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3ODktMjc5MQogICAgLy8gYm9udXNfdmFsdWUgPSAoCiAgICAvLyAgICAgcmVwYXlfdmFsdWUgKiBCaWdVSW50KGNvbGxhdGVyYWxfbWFya2V0LmxpcXVpZGF0aW9uX2JvbnVzLm5hdGl2ZSkKICAgIC8vICkgLy8gQmlnVUludCgxMDAwMCkKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3OTMKICAgIC8vIGNvbGxhdGVyYWxfdmFsdWUgPSByZXBheV92YWx1ZSArIGJvbnVzX3ZhbHVlCiAgICBkaWcgMQogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6Mjc5NS0yNzk2CiAgICAvLyAjIGNhbGN1bGF0ZSBjb2xsYXRlcmFsIGFtb3VudCBiYXNlZCBvbiB1c2QgdmFsdWUgaW5jbHVkaW5nIGJvbnVzCiAgICAvLyBjb2xsYXRlcmFsX2Ftb3VudCA9IChjb2xsYXRlcmFsX3ZhbHVlICogU0NBTEUpIC8vIGNvbGxhdGVyYWxfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgZHVwCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYioKICAgIGRpZyA0CiAgICBpbnQgMjgxCiAgICBpbnQgMzIKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6Mjc5OQogICAgLy8gY29sbGF0ZXJhbF9hbW91bnQgKiBTQ0FMRQogICAgZHVwCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjgwMAogICAgLy8gKSAvLyBjb2xsYXRlcmFsX21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgZGlnIDUKICAgIGV4dHJhY3QgMTc3IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzk4LTI4MDAKICAgIC8vIHNjYWxlZF9jb2xsYXRlcmFsX2Ftb3VudCA9ICgKICAgIC8vICAgICBjb2xsYXRlcmFsX2Ftb3VudCAqIFNDQUxFCiAgICAvLyApIC8vIGNvbGxhdGVyYWxfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyODIzCiAgICAvLyBzY2FsZWRfY29sbGF0ZXJhbF9hbW91bnQgPD0gY29sbGF0ZXJhbF91c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIHVuY292ZXIgNgogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZGlnIDEKICAgIGI+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyODIyLTI4MjQKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgc2NhbGVkX2NvbGxhdGVyYWxfYW1vdW50IDw9IGNvbGxhdGVyYWxfdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyApLCAiSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgdG8gc2VpemUiCiAgICBhc3NlcnQgLy8gSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgdG8gc2VpemUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjgyOAogICAgLy8gY29sbGF0ZXJhbF9hbW91bnQgPj0gbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQKICAgIGRpZyAxCiAgICBmcmFtZV9kaWcgLTEKICAgIGI+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyODI2LTI4MjkKICAgIC8vICMgY29sbGF0ZXJhbCByZWNlaXZlZCBzbGlwcGFnZSBwcm90ZWN0aW9uCiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIGNvbGxhdGVyYWxfYW1vdW50ID49IG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkCiAgICAvLyApLCAiSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgcmVjZWl2ZWQiCiAgICBhc3NlcnQgLy8gSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgcmVjZWl2ZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjgzMS0yODM4CiAgICAvLyBzZWxmLl9kZWJ0X3JlcGF5bWVudF9wdXJlKAogICAgLy8gICAgIGxpcXVpZGF0b3JfaWQsCiAgICAvLyAgICAgdXNlcl9pZCwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZCwKICAgIC8vICAgICByZXBheV9hbW91bnQsCiAgICAvLyAgICAgc2NhbGVkX3JlcGF5X2Ftb3VudCwKICAgIC8vICAgICByZXBheV92YWx1ZSwKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtNAogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTYKICAgIGZyYW1lX2RpZyAtMgogICAgdW5jb3ZlciA4CiAgICB1bmNvdmVyIDgKICAgIGNhbGxzdWIgX2RlYnRfcmVwYXltZW50X3B1cmUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6Mjg0NAogICAgLy8gY29sbGF0ZXJhbF9tYXJrZXQubnRva2VuX2lkLm5hdGl2ZSwKICAgIHVuY292ZXIgMwogICAgaW50IDMxMwogICAgaW50IDgKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyODQwLTI4NDgKICAgIC8vIHNlbGYuX2NvbGxhdGVyYWxfd2l0aGRyYXdfcHVyZSgKICAgIC8vICAgICB1c2VyX2lkLAogICAgLy8gICAgIGxpcXVpZGF0b3JfaWQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXQubnRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICBjb2xsYXRlcmFsX2Ftb3VudCwKICAgIC8vICAgICBzY2FsZWRfY29sbGF0ZXJhbF9hbW91bnQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF92YWx1ZSwKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC00CiAgICBmcmFtZV9kaWcgLTUKICAgIHVuY292ZXIgMwogICAgZGlnIDUKICAgIHVuY292ZXIgNQogICAgdW5jb3ZlciA3CiAgICBjYWxsc3ViIF9jb2xsYXRlcmFsX3dpdGhkcmF3X3B1cmUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6Mjg1MAogICAgLy8gcmV0dXJuIGNvbGxhdGVyYWxfYW1vdW50CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5VcGdyYWRlYWJsZS5zZXRfdmVyc2lvbihjb250cmFjdF92ZXJzaW9uOiBieXRlcywgZGVwbG95bWVudF92ZXJzaW9uOiBieXRlcykgLT4gdm9pZDoKc2V0X3ZlcnNpb246CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NC0xNDcKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF92ZXJzaW9uKAogICAgLy8gICAgIHNlbGYsIGNvbnRyYWN0X3ZlcnNpb246IGFyYzQuVUludDY0LCBkZXBsb3ltZW50X3ZlcnNpb246IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ4CiAgICAvLyBhcmM0LmVtaXQoVmVyc2lvblVwZGF0ZWQoY29udHJhY3RfdmVyc2lvbiwgZGVwbG95bWVudF92ZXJzaW9uKSkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBjb25jYXQKICAgIG1ldGhvZCAiVmVyc2lvblVwZGF0ZWQodWludDY0LHVpbnQ2NCkiCiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDkKICAgIC8vIHNlbGYuY29udHJhY3RfdmVyc2lvbiA9IGNvbnRyYWN0X3ZlcnNpb24ubmF0aXZlCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAwCiAgICAvLyBzZWxmLmNvbnRyYWN0X3ZlcnNpb24gPSBVSW50NjQoKQogICAgYnl0ZSAiY29udHJhY3RfdmVyc2lvbiIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ5CiAgICAvLyBzZWxmLmNvbnRyYWN0X3ZlcnNpb24gPSBjb250cmFjdF92ZXJzaW9uLm5hdGl2ZQogICAgc3dhcAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUwCiAgICAvLyBzZWxmLmRlcGxveW1lbnRfdmVyc2lvbiA9IGRlcGxveW1lbnRfdmVyc2lvbi5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDEKICAgIC8vIHNlbGYuZGVwbG95bWVudF92ZXJzaW9uID0gVUludDY0KCkKICAgIGJ5dGUgImRlcGxveW1lbnRfdmVyc2lvbiIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUwCiAgICAvLyBzZWxmLmRlcGxveW1lbnRfdmVyc2lvbiA9IGRlcGxveW1lbnRfdmVyc2lvbi5uYXRpdmUKICAgIHN3YXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5VcGdyYWRlYWJsZS5ncmFudF91cGdyYWRlcih1cGdyYWRlcjogYnl0ZXMpIC0+IHZvaWQ6CmdyYW50X3VwZ3JhZGVyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjgtMTY5CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBncmFudF91cGdyYWRlcihzZWxmLCB1cGdyYWRlcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgcHJvdG8gMSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MAogICAgLy8gYXNzZXJ0IFR4bi5zZW5kZXIgPT0gR2xvYmFsLmNyZWF0b3JfYWRkcmVzcywgIm11c3QgYmUgY3JlYXRvciIKICAgIHR4biBTZW5kZXIKICAgIGdsb2JhbCBDcmVhdG9yQWRkcmVzcwogICAgPT0KICAgIGFzc2VydCAvLyBtdXN0IGJlIGNyZWF0b3IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcxCiAgICAvLyBhcmM0LmVtaXQoVXBncmFkZXJHcmFudGVkKGFyYzQuQWRkcmVzcyhzZWxmLnVwZ3JhZGVyKSwgdXBncmFkZXIpKQogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzCiAgICAvLyBzZWxmLnVwZ3JhZGVyID0gQWNjb3VudCgpCiAgICBieXRlICJ1cGdyYWRlciIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcxCiAgICAvLyBhcmM0LmVtaXQoVXBncmFkZXJHcmFudGVkKGFyYzQuQWRkcmVzcyhzZWxmLnVwZ3JhZGVyKSwgdXBncmFkZXIpKQogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnVwZ3JhZGVyIGV4aXN0cwogICAgZnJhbWVfZGlnIC0xCiAgICBjb25jYXQKICAgIG1ldGhvZCAiVXBncmFkZXJHcmFudGVkKGFkZHJlc3MsYWRkcmVzcykiCiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMKICAgIC8vIHNlbGYudXBncmFkZXIgPSBBY2NvdW50KCkKICAgIGJ5dGUgInVwZ3JhZGVyIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzIKICAgIC8vIHNlbGYudXBncmFkZXIgPSB1cGdyYWRlci5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMQogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkFjY2Vzc0NvbnRyb2wuc2V0X3JvbGUocm9sZTogYnl0ZXMsIGFsbG93OiBieXRlcykgLT4gdm9pZDoKc2V0X3JvbGU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjUyLTUzCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfcm9sZShzZWxmLCByb2xlOiBCeXRlczMyLCBhbGxvdzogYXJjNC5Cb29sKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjU0CiAgICAvLyBzZWxmLl9zZXRfcm9sZShyb2xlLmJ5dGVzLCBhbGxvdy5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGludCAwCiAgICBnZXRiaXQKICAgIGZyYW1lX2RpZyAtMgogICAgc3dhcAogICAgY2FsbHN1YiBfc2V0X3JvbGUKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkFjY2Vzc0NvbnRyb2wuX3NldF9yb2xlKHJvbGU6IGJ5dGVzLCBhbGxvdzogdWludDY0KSAtPiB2b2lkOgpfc2V0X3JvbGU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjU2LTU3CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfcm9sZShzZWxmLCByb2xlOiBCeXRlcywgYWxsb3c6IGJvb2wpIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NTAKICAgIC8vIHNlbGYuYWRkcmVzc19yb2xlcyA9IEJveE1hcChCeXRlczMyLCBib29sKQogICAgYnl0ZSAiYWRkcmVzc19yb2xlcyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NTgKICAgIC8vIHNlbGYuYWRkcmVzc19yb2xlc1tCeXRlczMyLmZyb21fYnl0ZXMocm9sZSldID0gYWxsb3cKICAgIGZyYW1lX2RpZyAtMgogICAgY29uY2F0CiAgICBmcmFtZV9kaWcgLTEKICAgIGl0b2IKICAgIGJveF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkFjY2Vzc0NvbnRyb2wuaGFzX3JvbGUocm9sZTogYnl0ZXMpIC0+IGJ5dGVzOgpoYXNfcm9sZToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NjAtNjEKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGhhc19yb2xlKHNlbGYsIHJvbGU6IEJ5dGVzMzIpIC0+IGFyYzQuQm9vbDoKICAgIHByb3RvIDEgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo2MgogICAgLy8gcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9oYXNfcm9sZShyb2xlLmJ5dGVzKSkKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfaGFzX3JvbGUKICAgIGJ5dGUgMHgwMAogICAgaW50IDAKICAgIHVuY292ZXIgMgogICAgc2V0Yml0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5VcGdyYWRlYWJsZS5vbl91cGRhdGUoKSAtPiB2b2lkOgpvbl91cGRhdGU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1Mi0xNTMKICAgIC8vIEBhcmM0LmJhcmVtZXRob2QoYWxsb3dfYWN0aW9ucz1bIlVwZGF0ZUFwcGxpY2F0aW9uIl0pCiAgICAvLyBkZWYgb25fdXBkYXRlKHNlbGYpIC0+IE5vbmU6CiAgICBwcm90byAwIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU0LTE1NwogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjIFdBUk5JTkc6IFRoaXMgYXBwIGNhbiBiZSB1cGRhdGVkIGJ5IHRoZSBjcmVhdG9yCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYudXBncmFkZXIsICJtdXN0IGJlIHVwZ3JhZGVyIgogICAgdHhuIFNlbmRlcgogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzCiAgICAvLyBzZWxmLnVwZ3JhZGVyID0gQWNjb3VudCgpCiAgICBieXRlICJ1cGdyYWRlciIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU0LTE1NwogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjIFdBUk5JTkc6IFRoaXMgYXBwIGNhbiBiZSB1cGRhdGVkIGJ5IHRoZSBjcmVhdG9yCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYudXBncmFkZXIsICJtdXN0IGJlIHVwZ3JhZGVyIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnVwZ3JhZGVyIGV4aXN0cwogICAgPT0KICAgIGFzc2VydCAvLyBtdXN0IGJlIHVwZ3JhZGVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1OAogICAgLy8gYXNzZXJ0IHNlbGYudXBkYXRhYmxlID09IFVJbnQ2NCgxKSwgIm5vdCBhcHByb3ZlZCIKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMgogICAgLy8gc2VsZi51cGRhdGFibGUgPSBib29sKDEpCiAgICBieXRlICJ1cGRhdGFibGUiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1OAogICAgLy8gYXNzZXJ0IHNlbGYudXBkYXRhYmxlID09IFVJbnQ2NCgxKSwgIm5vdCBhcHByb3ZlZCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi51cGRhdGFibGUgZXhpc3RzCiAgICBpbnQgMQogICAgPT0KICAgIGFzc2VydCAvLyBub3QgYXBwcm92ZWQKICAgIHJldHN1Ygo=",
    "clear": "I3ByYWdtYSB2ZXJzaW9uIDEwCgpjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5jbGVhcl9zdGF0ZV9wcm9ncmFtOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzUxCiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgaW50IDEKICAgIHJldHVybgo="
  },
  "state": {
    "global": {
      "num_byte_slices": 2,
      "num_uints": 6
    },
    "local": {
      "num_byte_slices": 0,
      "num_uints": 0
    }
  },
  "schema": {
    "global": {
      "declared": {
        "contract_version": {
          "type": "uint64",
          "key": "contract_version"
        },
        "deployment_version": {
          "type": "uint64",
          "key": "deployment_version"
        },
        "owner": {
          "type": "bytes",
          "key": "owner"
        },
        "paused": {
          "type": "uint64",
          "key": "paused"
        },
        "seconds_per_year": {
          "type": "uint64",
          "key": "seconds_per_year"
        },
        "stoken_app_id": {
          "type": "uint64",
          "key": "stoken_app_id"
        },
        "updatable": {
          "type": "uint64",
          "key": "updatable"
        },
        "upgrader": {
          "type": "bytes",
          "key": "upgrader"
        }
      },
      "reserved": {}
    },
    "local": {
      "declared": {},
      "reserved": {}
    }
  },
  "contract": {
    "name": "DorkFiLendingPool",
    "methods": [
      {
        "name": "post_update",
        "args": [],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_role_key",
        "args": [
          {
            "type": "address",
            "name": "account"
          },
          {
            "type": "byte[3]",
            "name": "role"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "byte[32]"
        }
      },
      {
        "name": "set_market_price",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "price"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "set_market",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)",
            "name": "market_data"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "attach_price_feed",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "uint64",
            "name": "provider_app_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "detach_price_feed",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_owner",
        "args": [],
        "readonly": true,
        "returns": {
          "type": "address"
        }
      },
      {
        "name": "transfer_ownership",
        "args": [
          {
            "type": "address",
            "name": "new_owner"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "set_storage_app_id",
        "args": [
          {
            "type": "uint64",
            "name": "storage_app_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "is_paused",
        "args": [],
        "readonly": false,
        "returns": {
          "type": "bool"
        }
      },
      {
        "name": "pause",
        "args": [
          {
            "type": "uint64",
            "name": "pause"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "set_stoken_app_id",
        "args": [
          {
            "type": "uint64",
            "name": "stoken_app_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_user",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          },
          {
            "type": "uint64",
            "name": "market_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "(uint256,uint256,uint256,uint256,uint64,uint256)"
        }
      },
      {
        "name": "create_market",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "uint64",
            "name": "collateral_factor"
          },
          {
            "type": "uint64",
            "name": "liquidation_threshold"
          },
          {
            "type": "uint64",
            "name": "reserve_factor"
          },
          {
            "type": "uint64",
            "name": "borrow_rate"
          },
          {
            "type": "uint64",
            "name": "slope"
          },
          {
            "type": "uint256",
            "name": "max_total_deposits"
          },
          {
            "type": "uint256",
            "name": "max_total_borrows"
          },
          {
            "type": "uint64",
            "name": "liquidation_bonus"
          },
          {
            "type": "uint64",
            "name": "close_factor"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "uint64"
        }
      },
      {
        "name": "get_market",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": true,
        "returns": {
          "type": "(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)"
        }
      },
      {
        "name": "get_price_feed",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "(uint64,uint64,(uint256,uint64))"
        }
      },
      {
        "name": "fetch_price_feed",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "pause_market",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "uint64",
            "name": "pause"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "sync_market",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "withdraw_reserves",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "deposit",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "calculate_user_interest",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          },
          {
            "type": "uint64",
            "name": "market_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "uint256"
        }
      },
      {
        "name": "calculate_user_debt_interest",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          },
          {
            "type": "uint64",
            "name": "market_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "uint256"
        }
      },
      {
        "name": "withdraw",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "uint256"
        }
      },
      {
        "name": "borrow",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "repay",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "sync_user_market_for_price_change",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          },
          {
            "type": "uint64",
            "name": "market_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_global_user",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "(uint256,uint256,uint64)"
        }
      },
      {
        "name": "liquidate_cross_market",
        "args": [
          {
            "type": "uint64",
            "name": "debt_market_id"
          },
          {
            "type": "uint64",
            "name": "collateral_market_id"
          },
          {
            "type": "address",
            "name": "user"
          },
          {
            "type": "uint256",
            "name": "debt_amount"
          },
          {
            "type": "uint256",
            "name": "min_collateral_received"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "uint256"
        }
      },
      {
        "name": "set_version",
        "args": [
          {
            "type": "uint64",
            "name": "contract_version"
          },
          {
            "type": "uint64",
            "name": "deployment_version"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "grant_upgrader",
        "args": [
          {
            "type": "address",
            "name": "upgrader"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "approve_update",
        "args": [
          {
            "type": "bool",
            "name": "approval"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        },
        "desc": "Approve update."
      },
      {
        "name": "set_role",
        "args": [
          {
            "type": "byte[32]",
            "name": "role"
          },
          {
            "type": "bool",
            "name": "allow"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "has_role",
        "args": [
          {
            "type": "byte[32]",
            "name": "role"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "bool"
        }
      }
    ],
    "networks": {}
  },
  "bare_call_config": {
    "update_application": "CALL",
    "no_op": "CREATE"
  }
}

/**
 * Defines an onCompletionAction of 'no_op'
 */
export type OnCompleteNoOp =  { onCompleteAction?: 'no_op' | OnApplicationComplete.NoOpOC }
/**
 * Defines an onCompletionAction of 'opt_in'
 */
export type OnCompleteOptIn =  { onCompleteAction: 'opt_in' | OnApplicationComplete.OptInOC }
/**
 * Defines an onCompletionAction of 'close_out'
 */
export type OnCompleteCloseOut =  { onCompleteAction: 'close_out' | OnApplicationComplete.CloseOutOC }
/**
 * Defines an onCompletionAction of 'delete_application'
 */
export type OnCompleteDelApp =  { onCompleteAction: 'delete_application' | OnApplicationComplete.DeleteApplicationOC }
/**
 * Defines an onCompletionAction of 'update_application'
 */
export type OnCompleteUpdApp =  { onCompleteAction: 'update_application' | OnApplicationComplete.UpdateApplicationOC }
/**
 * A state record containing a single unsigned integer
 */
export type IntegerState = {
  /**
   * Gets the state value as a BigInt.
   */
  asBigInt(): bigint
  /**
   * Gets the state value as a number.
   */
  asNumber(): number
}
/**
 * A state record containing binary data
 */
export type BinaryState = {
  /**
   * Gets the state value as a Uint8Array
   */
  asByteArray(): Uint8Array
  /**
   * Gets the state value as a string
   */
  asString(): string
}

export type AppCreateCallTransactionResult = AppCallTransactionResult & Partial<AppCompilationResult> & AppReference
export type AppUpdateCallTransactionResult = AppCallTransactionResult & Partial<AppCompilationResult>

export type AppClientComposeCallCoreParams = Omit<AppClientCallCoreParams, 'sendParams'> & {
  sendParams?: Omit<SendTransactionParams, 'skipSending' | 'atc' | 'skipWaiting' | 'maxRoundsToWaitForConfirmation' | 'populateAppCallResources'>
}
export type AppClientComposeExecuteParams = Pick<SendTransactionParams, 'skipWaiting' | 'maxRoundsToWaitForConfirmation' | 'populateAppCallResources' | 'suppressLog'>

/**
 * Defines the types of available calls and state of the DorkFiLendingPool smart contract.
 */
export type DorkFiLendingPool = {
  /**
   * Maps method signatures / names to their argument and return types.
   */
  methods:
    & Record<'post_update()void' | 'post_update', {
      argsObj: {
      }
      argsTuple: []
      returns: void
    }>
    & Record<'get_role_key(address,byte[3])byte[32]' | 'get_role_key', {
      argsObj: {
        account: string
        role: Uint8Array
      }
      argsTuple: [account: string, role: Uint8Array]
      returns: Uint8Array
    }>
    & Record<'set_market_price(uint64,uint256)void' | 'set_market_price', {
      argsObj: {
        marketId: bigint | number
        price: bigint | number
      }
      argsTuple: [marketId: bigint | number, price: bigint | number]
      returns: void
    }>
    & Record<'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void' | 'set_market', {
      argsObj: {
        tokenId: bigint | number
        marketData: [boolean, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number]
      }
      argsTuple: [tokenId: bigint | number, marketData: [boolean, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number]]
      returns: void
    }>
    & Record<'attach_price_feed(uint64,uint64)void' | 'attach_price_feed', {
      argsObj: {
        tokenId: bigint | number
        providerAppId: bigint | number
      }
      argsTuple: [tokenId: bigint | number, providerAppId: bigint | number]
      returns: void
    }>
    & Record<'detach_price_feed(uint64)void' | 'detach_price_feed', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: void
    }>
    & Record<'get_owner()address' | 'get_owner', {
      argsObj: {
      }
      argsTuple: []
      returns: string
    }>
    & Record<'transfer_ownership(address)void' | 'transfer_ownership', {
      argsObj: {
        newOwner: string
      }
      argsTuple: [newOwner: string]
      returns: void
    }>
    & Record<'set_storage_app_id(uint64)void' | 'set_storage_app_id', {
      argsObj: {
        storageAppId: bigint | number
      }
      argsTuple: [storageAppId: bigint | number]
      returns: void
    }>
    & Record<'is_paused()bool' | 'is_paused', {
      argsObj: {
      }
      argsTuple: []
      returns: boolean
    }>
    & Record<'pause(uint64)void' | 'pause', {
      argsObj: {
        pause: bigint | number
      }
      argsTuple: [pause: bigint | number]
      returns: void
    }>
    & Record<'set_stoken_app_id(uint64)void' | 'set_stoken_app_id', {
      argsObj: {
        stokenAppId: bigint | number
      }
      argsTuple: [stokenAppId: bigint | number]
      returns: void
    }>
    & Record<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)' | 'get_user', {
      argsObj: {
        userId: string
        marketId: bigint | number
      }
      argsTuple: [userId: string, marketId: bigint | number]
      returns: UserData
    }>
    & Record<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64' | 'create_market', {
      argsObj: {
        tokenId: bigint | number
        collateralFactor: bigint | number
        liquidationThreshold: bigint | number
        reserveFactor: bigint | number
        borrowRate: bigint | number
        slope: bigint | number
        maxTotalDeposits: bigint | number
        maxTotalBorrows: bigint | number
        liquidationBonus: bigint | number
        closeFactor: bigint | number
      }
      argsTuple: [tokenId: bigint | number, collateralFactor: bigint | number, liquidationThreshold: bigint | number, reserveFactor: bigint | number, borrowRate: bigint | number, slope: bigint | number, maxTotalDeposits: bigint | number, maxTotalBorrows: bigint | number, liquidationBonus: bigint | number, closeFactor: bigint | number]
      returns: bigint
    }>
    & Record<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)' | 'get_market', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: MarketData
    }>
    & Record<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))' | 'get_price_feed', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: PriceFeed
    }>
    & Record<'fetch_price_feed(uint64)void' | 'fetch_price_feed', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: void
    }>
    & Record<'pause_market(uint64,uint64)void' | 'pause_market', {
      argsObj: {
        tokenId: bigint | number
        pause: bigint | number
      }
      argsTuple: [tokenId: bigint | number, pause: bigint | number]
      returns: void
    }>
    & Record<'sync_market(uint64)void' | 'sync_market', {
      argsObj: {
        marketId: bigint | number
      }
      argsTuple: [marketId: bigint | number]
      returns: void
    }>
    & Record<'withdraw_reserves(uint64,uint256)void' | 'withdraw_reserves', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: void
    }>
    & Record<'deposit(uint64,uint256)void' | 'deposit', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: void
    }>
    & Record<'calculate_user_interest(address,uint64)uint256' | 'calculate_user_interest', {
      argsObj: {
        userId: string
        marketId: bigint | number
      }
      argsTuple: [userId: string, marketId: bigint | number]
      returns: bigint
    }>
    & Record<'calculate_user_debt_interest(address,uint64)uint256' | 'calculate_user_debt_interest', {
      argsObj: {
        userId: string
        marketId: bigint | number
      }
      argsTuple: [userId: string, marketId: bigint | number]
      returns: bigint
    }>
    & Record<'withdraw(uint64,uint256)uint256' | 'withdraw', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: bigint
    }>
    & Record<'borrow(uint64,uint256)void' | 'borrow', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: void
    }>
    & Record<'repay(uint64,uint256)void' | 'repay', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: void
    }>
    & Record<'sync_user_market_for_price_change(address,uint64)void' | 'sync_user_market_for_price_change', {
      argsObj: {
        userId: string
        marketId: bigint | number
      }
      argsTuple: [userId: string, marketId: bigint | number]
      returns: void
    }>
    & Record<'get_global_user(address)(uint256,uint256,uint64)' | 'get_global_user', {
      argsObj: {
        userId: string
      }
      argsTuple: [userId: string]
      returns: GlobalUserData
    }>
    & Record<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)uint256' | 'liquidate_cross_market', {
      argsObj: {
        debtMarketId: bigint | number
        collateralMarketId: bigint | number
        user: string
        debtAmount: bigint | number
        minCollateralReceived: bigint | number
      }
      argsTuple: [debtMarketId: bigint | number, collateralMarketId: bigint | number, user: string, debtAmount: bigint | number, minCollateralReceived: bigint | number]
      returns: bigint
    }>
    & Record<'set_version(uint64,uint64)void' | 'set_version', {
      argsObj: {
        contractVersion: bigint | number
        deploymentVersion: bigint | number
      }
      argsTuple: [contractVersion: bigint | number, deploymentVersion: bigint | number]
      returns: void
    }>
    & Record<'grant_upgrader(address)void' | 'grant_upgrader', {
      argsObj: {
        upgrader: string
      }
      argsTuple: [upgrader: string]
      returns: void
    }>
    & Record<'approve_update(bool)void' | 'approve_update', {
      argsObj: {
        approval: boolean
      }
      argsTuple: [approval: boolean]
      returns: void
    }>
    & Record<'set_role(byte[32],bool)void' | 'set_role', {
      argsObj: {
        role: Uint8Array
        allow: boolean
      }
      argsTuple: [role: Uint8Array, allow: boolean]
      returns: void
    }>
    & Record<'has_role(byte[32])bool' | 'has_role', {
      argsObj: {
        role: Uint8Array
      }
      argsTuple: [role: Uint8Array]
      returns: boolean
    }>
  /**
   * Defines the shape of the global and local state of the application.
   */
  state: {
    global: {
      contractVersion?: IntegerState
      deploymentVersion?: IntegerState
      owner?: BinaryState
      paused?: IntegerState
      secondsPerYear?: IntegerState
      stokenAppId?: IntegerState
      updatable?: IntegerState
      upgrader?: BinaryState
    }
  }
}
/**
 * Defines the possible abi call signatures
 */
export type DorkFiLendingPoolSig = keyof DorkFiLendingPool['methods']
/**
 * Defines an object containing all relevant parameters for a single call to the contract. Where TSignature is undefined, a bare call is made
 */
export type TypedCallParams<TSignature extends DorkFiLendingPoolSig | undefined> = {
  method: TSignature
  methodArgs: TSignature extends undefined ? undefined : Array<ABIAppCallArg | undefined>
} & AppClientCallCoreParams & CoreAppCallArgs
/**
 * Defines the arguments required for a bare call
 */
export type BareCallArgs = Omit<RawAppCallArgs, keyof CoreAppCallArgs>
/**
 * Represents a MarketData result as a struct
 */
export type MarketData = {
  paused: boolean
  maxTotalDeposits: bigint
  maxTotalBorrows: bigint
  liquidationBonus: bigint
  collateralFactor: bigint
  liquidationThreshold: bigint
  reserveFactor: bigint
  borrowRate: bigint
  slope: bigint
  totalScaledDeposits: bigint
  totalScaledBorrows: bigint
  depositIndex: bigint
  borrowIndex: bigint
  lastUpdateTime: bigint
  reserves: bigint
  price: bigint
  ntokenId: bigint
  closeFactor: bigint
}
/**
 * Converts the tuple representation of a MarketData to the struct representation
 */
export function MarketData([paused, maxTotalDeposits, maxTotalBorrows, liquidationBonus, collateralFactor, liquidationThreshold, reserveFactor, borrowRate, slope, totalScaledDeposits, totalScaledBorrows, depositIndex, borrowIndex, lastUpdateTime, reserves, price, ntokenId, closeFactor]: [boolean, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint] ) {
  return {
    paused,
    maxTotalDeposits,
    maxTotalBorrows,
    liquidationBonus,
    collateralFactor,
    liquidationThreshold,
    reserveFactor,
    borrowRate,
    slope,
    totalScaledDeposits,
    totalScaledBorrows,
    depositIndex,
    borrowIndex,
    lastUpdateTime,
    reserves,
    price,
    ntokenId,
    closeFactor,
  }
}
/**
 * Represents a UserData result as a struct
 */
export type UserData = {
  scaledDeposits: bigint
  scaledBorrows: bigint
  depositIndex: bigint
  borrowIndex: bigint
  lastUpdateTime: bigint
  lastPrice: bigint
}
/**
 * Converts the tuple representation of a UserData to the struct representation
 */
export function UserData([scaledDeposits, scaledBorrows, depositIndex, borrowIndex, lastUpdateTime, lastPrice]: [bigint, bigint, bigint, bigint, bigint, bigint] ) {
  return {
    scaledDeposits,
    scaledBorrows,
    depositIndex,
    borrowIndex,
    lastUpdateTime,
    lastPrice,
  }
}
/**
 * Represents a MarketData result as a struct
 */
/**
 * Converts the tuple representation of a MarketData to the struct representation
 */
/**
 * Represents a PriceFeed result as a struct
 */
export type PriceFeed = {
  marketId: bigint
  providerAppId: bigint
  priceWithTimestamp: [bigint, bigint]
}
/**
 * Converts the tuple representation of a PriceFeed to the struct representation
 */
export function PriceFeed([marketId, providerAppId, priceWithTimestamp]: [bigint, bigint, [bigint, bigint]] ) {
  return {
    marketId,
    providerAppId,
    priceWithTimestamp,
  }
}
/**
 * Represents a GlobalUserData result as a struct
 */
export type GlobalUserData = {
  totalCollateralValue: bigint
  totalBorrowValue: bigint
  lastUpdateTime: bigint
}
/**
 * Converts the tuple representation of a GlobalUserData to the struct representation
 */
export function GlobalUserData([totalCollateralValue, totalBorrowValue, lastUpdateTime]: [bigint, bigint, bigint] ) {
  return {
    totalCollateralValue,
    totalBorrowValue,
    lastUpdateTime,
  }
}
/**
 * Maps a method signature from the DorkFiLendingPool smart contract to the method's arguments in either tuple of struct form
 */
export type MethodArgs<TSignature extends DorkFiLendingPoolSig> = DorkFiLendingPool['methods'][TSignature]['argsObj' | 'argsTuple']
/**
 * Maps a method signature from the DorkFiLendingPool smart contract to the method's return type
 */
export type MethodReturn<TSignature extends DorkFiLendingPoolSig> = DorkFiLendingPool['methods'][TSignature]['returns']

/**
 * A factory for available 'create' calls
 */
export type DorkFiLendingPoolCreateCalls = (typeof DorkFiLendingPoolCallFactory)['create']
/**
 * Defines supported create methods for this smart contract
 */
export type DorkFiLendingPoolCreateCallParams =
  | (TypedCallParams<undefined> & (OnCompleteNoOp))
/**
 * A factory for available 'update' calls
 */
export type DorkFiLendingPoolUpdateCalls = (typeof DorkFiLendingPoolCallFactory)['update']
/**
 * Defines supported update methods for this smart contract
 */
export type DorkFiLendingPoolUpdateCallParams =
  | TypedCallParams<undefined>
/**
 * Defines arguments required for the deploy method.
 */
export type DorkFiLendingPoolDeployArgs = {
  deployTimeParams?: TealTemplateParams
  /**
   * A delegate which takes a create call factory and returns the create call params for this smart contract
   */
  createCall?: (callFactory: DorkFiLendingPoolCreateCalls) => DorkFiLendingPoolCreateCallParams
  /**
   * A delegate which takes a update call factory and returns the update call params for this smart contract
   */
  updateCall?: (callFactory: DorkFiLendingPoolUpdateCalls) => DorkFiLendingPoolUpdateCallParams
}


/**
 * Exposes methods for constructing all available smart contract calls
 */
export abstract class DorkFiLendingPoolCallFactory {
  /**
   * Gets available create call factories
   */
  static get create() {
    return {
      /**
       * Constructs a create call for the DorkFiLendingPool smart contract using a bare call
       *
       * @param params Any parameters for the call
       * @returns A TypedCallParams object for the call
       */
      bare(params: BareCallArgs & AppClientCallCoreParams & CoreAppCallArgs & AppClientCompilationParams & (OnCompleteNoOp) = {}) {
        return {
          method: undefined,
          methodArgs: undefined,
          ...params,
        }
      },
    }
  }

  /**
   * Gets available update call factories
   */
  static get update() {
    return {
      /**
       * Constructs an update call for the DorkFiLendingPool smart contract using a bare call
       *
       * @param params Any parameters for the call
       * @returns A TypedCallParams object for the call
       */
      bare(params: BareCallArgs & AppClientCallCoreParams & CoreAppCallArgs & AppClientCompilationParams = {}) {
        return {
          method: undefined,
          methodArgs: undefined,
          ...params,
        }
      },
    }
  }

  /**
   * Constructs a no op call for the post_update()void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static postUpdate(args: MethodArgs<'post_update()void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'post_update()void' as const,
      methodArgs: Array.isArray(args) ? args : [],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_role_key(address,byte[3])byte[32] ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getRoleKey(args: MethodArgs<'get_role_key(address,byte[3])byte[32]'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_role_key(address,byte[3])byte[32]' as const,
      methodArgs: Array.isArray(args) ? args : [args.account, args.role],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_market_price(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setMarketPrice(args: MethodArgs<'set_market_price(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_market_price(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.price],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setMarket(args: MethodArgs<'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.marketData],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the attach_price_feed(uint64,uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static attachPriceFeed(args: MethodArgs<'attach_price_feed(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'attach_price_feed(uint64,uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.providerAppId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the detach_price_feed(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static detachPriceFeed(args: MethodArgs<'detach_price_feed(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'detach_price_feed(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_owner()address ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getOwner(args: MethodArgs<'get_owner()address'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_owner()address' as const,
      methodArgs: Array.isArray(args) ? args : [],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the transfer_ownership(address)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static transferOwnership(args: MethodArgs<'transfer_ownership(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'transfer_ownership(address)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.newOwner],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_storage_app_id(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setStorageAppId(args: MethodArgs<'set_storage_app_id(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_storage_app_id(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.storageAppId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the is_paused()bool ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static isPaused(args: MethodArgs<'is_paused()bool'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'is_paused()bool' as const,
      methodArgs: Array.isArray(args) ? args : [],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the pause(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static pause(args: MethodArgs<'pause(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'pause(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.pause],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_stoken_app_id(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setStokenAppId(args: MethodArgs<'set_stoken_app_id(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_stoken_app_id(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.stokenAppId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getUser(args: MethodArgs<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId, args.marketId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64 ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static createMarket(args: MethodArgs<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.collateralFactor, args.liquidationThreshold, args.reserveFactor, args.borrowRate, args.slope, args.maxTotalDeposits, args.maxTotalBorrows, args.liquidationBonus, args.closeFactor],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getMarket(args: MethodArgs<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_price_feed(uint64)(uint64,uint64,(uint256,uint64)) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getPriceFeed(args: MethodArgs<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the fetch_price_feed(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static fetchPriceFeed(args: MethodArgs<'fetch_price_feed(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'fetch_price_feed(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the pause_market(uint64,uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static pauseMarket(args: MethodArgs<'pause_market(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'pause_market(uint64,uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.pause],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the sync_market(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static syncMarket(args: MethodArgs<'sync_market(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'sync_market(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the withdraw_reserves(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static withdrawReserves(args: MethodArgs<'withdraw_reserves(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'withdraw_reserves(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the deposit(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static deposit(args: MethodArgs<'deposit(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'deposit(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the calculate_user_interest(address,uint64)uint256 ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static calculateUserInterest(args: MethodArgs<'calculate_user_interest(address,uint64)uint256'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'calculate_user_interest(address,uint64)uint256' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId, args.marketId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the calculate_user_debt_interest(address,uint64)uint256 ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static calculateUserDebtInterest(args: MethodArgs<'calculate_user_debt_interest(address,uint64)uint256'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'calculate_user_debt_interest(address,uint64)uint256' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId, args.marketId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the withdraw(uint64,uint256)uint256 ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static withdraw(args: MethodArgs<'withdraw(uint64,uint256)uint256'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'withdraw(uint64,uint256)uint256' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the borrow(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static borrow(args: MethodArgs<'borrow(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'borrow(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the repay(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static repay(args: MethodArgs<'repay(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'repay(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the sync_user_market_for_price_change(address,uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static syncUserMarketForPriceChange(args: MethodArgs<'sync_user_market_for_price_change(address,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'sync_user_market_for_price_change(address,uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId, args.marketId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_global_user(address)(uint256,uint256,uint64) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getGlobalUser(args: MethodArgs<'get_global_user(address)(uint256,uint256,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_global_user(address)(uint256,uint256,uint64)' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the liquidate_cross_market(uint64,uint64,address,uint256,uint256)uint256 ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static liquidateCrossMarket(args: MethodArgs<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)uint256'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'liquidate_cross_market(uint64,uint64,address,uint256,uint256)uint256' as const,
      methodArgs: Array.isArray(args) ? args : [args.debtMarketId, args.collateralMarketId, args.user, args.debtAmount, args.minCollateralReceived],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_version(uint64,uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setVersion(args: MethodArgs<'set_version(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_version(uint64,uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.contractVersion, args.deploymentVersion],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the grant_upgrader(address)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static grantUpgrader(args: MethodArgs<'grant_upgrader(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'grant_upgrader(address)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.upgrader],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the approve_update(bool)void ABI method
   *
   * Approve update.
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static approveUpdate(args: MethodArgs<'approve_update(bool)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'approve_update(bool)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.approval],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_role(byte[32],bool)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setRole(args: MethodArgs<'set_role(byte[32],bool)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_role(byte[32],bool)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.role, args.allow],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the has_role(byte[32])bool ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static hasRole(args: MethodArgs<'has_role(byte[32])bool'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'has_role(byte[32])bool' as const,
      methodArgs: Array.isArray(args) ? args : [args.role],
      ...params,
    }
  }
}

/**
 * A client to make calls to the DorkFiLendingPool smart contract
 */
export class DorkFiLendingPoolClient {
  /**
   * The underlying `ApplicationClient` for when you want to have more flexibility
   */
  public readonly appClient: ApplicationClient

  private readonly sender: SendTransactionFrom | undefined

  /**
   * Creates a new instance of `DorkFiLendingPoolClient`
   *
   * @param appDetails appDetails The details to identify the app to deploy
   * @param algod An algod client instance
   */
  constructor(appDetails: AppDetails, private algod: Algodv2) {
    this.sender = appDetails.sender
    this.appClient = algokit.getAppClient({
      ...appDetails,
      app: APP_SPEC
    }, algod)
  }

  /**
   * Checks for decode errors on the AppCallTransactionResult and maps the return value to the specified generic type
   *
   * @param result The AppCallTransactionResult to be mapped
   * @param returnValueFormatter An optional delegate to format the return value if required
   * @returns The smart contract response with an updated return value
   */
  protected mapReturnValue<TReturn, TResult extends AppCallTransactionResult = AppCallTransactionResult>(result: AppCallTransactionResult, returnValueFormatter?: (value: any) => TReturn): AppCallTransactionResultOfType<TReturn> & TResult {
    if(result.return?.decodeError) {
      throw result.return.decodeError
    }
    const returnValue = result.return?.returnValue !== undefined && returnValueFormatter !== undefined
      ? returnValueFormatter(result.return.returnValue)
      : result.return?.returnValue as TReturn | undefined
      return { ...result, return: returnValue } as AppCallTransactionResultOfType<TReturn> & TResult
  }

  /**
   * Calls the ABI method with the matching signature using an onCompletion code of NO_OP
   *
   * @param typedCallParams An object containing the method signature, args, and any other relevant parameters
   * @param returnValueFormatter An optional delegate which when provided will be used to map non-undefined return values to the target type
   * @returns The result of the smart contract call
   */
  public async call<TSignature extends keyof DorkFiLendingPool['methods']>(typedCallParams: TypedCallParams<TSignature>, returnValueFormatter?: (value: any) => MethodReturn<TSignature>) {
    return this.mapReturnValue<MethodReturn<TSignature>>(await this.appClient.call(typedCallParams), returnValueFormatter)
  }

  /**
   * Idempotently deploys the DorkFiLendingPool smart contract.
   *
   * @param params The arguments for the contract calls and any additional parameters for the call
   * @returns The deployment result
   */
  public deploy(params: DorkFiLendingPoolDeployArgs & AppClientDeployCoreParams = {}): ReturnType<ApplicationClient['deploy']> {
    const createArgs = params.createCall?.(DorkFiLendingPoolCallFactory.create)
    const updateArgs = params.updateCall?.(DorkFiLendingPoolCallFactory.update)
    return this.appClient.deploy({
      ...params,
      updateArgs,
      createArgs,
      createOnCompleteAction: createArgs?.onCompleteAction,
    })
  }

  /**
   * Gets available create methods
   */
  public get create() {
    const $this = this
    return {
      /**
       * Creates a new instance of the DorkFiLendingPool smart contract using a bare call.
       *
       * @param args The arguments for the bare call
       * @returns The create result
       */
      async bare(args: BareCallArgs & AppClientCallCoreParams & AppClientCompilationParams & CoreAppCallArgs & (OnCompleteNoOp) = {}) {
        return $this.mapReturnValue<undefined, AppCreateCallTransactionResult>(await $this.appClient.create(args))
      },
    }
  }

  /**
   * Gets available update methods
   */
  public get update() {
    const $this = this
    return {
      /**
       * Updates an existing instance of the DorkFiLendingPool smart contract using a bare call.
       *
       * @param args The arguments for the bare call
       * @returns The update result
       */
      async bare(args: BareCallArgs & AppClientCallCoreParams & AppClientCompilationParams & CoreAppCallArgs = {}) {
        return $this.mapReturnValue<undefined, AppUpdateCallTransactionResult>(await $this.appClient.update(args))
      },
    }
  }

  /**
   * Makes a clear_state call to an existing instance of the DorkFiLendingPool smart contract.
   *
   * @param args The arguments for the bare call
   * @returns The clear_state result
   */
  public clearState(args: BareCallArgs & AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.appClient.clearState(args)
  }

  /**
   * Calls the post_update()void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public postUpdate(args: MethodArgs<'post_update()void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.postUpdate(args, params))
  }

  /**
   * Calls the get_role_key(address,byte[3])byte[32] ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getRoleKey(args: MethodArgs<'get_role_key(address,byte[3])byte[32]'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getRoleKey(args, params))
  }

  /**
   * Calls the set_market_price(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setMarketPrice(args: MethodArgs<'set_market_price(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setMarketPrice(args, params))
  }

  /**
   * Calls the set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setMarket(args: MethodArgs<'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setMarket(args, params))
  }

  /**
   * Calls the attach_price_feed(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public attachPriceFeed(args: MethodArgs<'attach_price_feed(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.attachPriceFeed(args, params))
  }

  /**
   * Calls the detach_price_feed(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public detachPriceFeed(args: MethodArgs<'detach_price_feed(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.detachPriceFeed(args, params))
  }

  /**
   * Calls the get_owner()address ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getOwner(args: MethodArgs<'get_owner()address'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getOwner(args, params))
  }

  /**
   * Calls the transfer_ownership(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public transferOwnership(args: MethodArgs<'transfer_ownership(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.transferOwnership(args, params))
  }

  /**
   * Calls the set_storage_app_id(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setStorageAppId(args: MethodArgs<'set_storage_app_id(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setStorageAppId(args, params))
  }

  /**
   * Calls the is_paused()bool ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public isPaused(args: MethodArgs<'is_paused()bool'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.isPaused(args, params))
  }

  /**
   * Calls the pause(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public pause(args: MethodArgs<'pause(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.pause(args, params))
  }

  /**
   * Calls the set_stoken_app_id(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setStokenAppId(args: MethodArgs<'set_stoken_app_id(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setStokenAppId(args, params))
  }

  /**
   * Calls the get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getUser(args: MethodArgs<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getUser(args, params), UserData)
  }

  /**
   * Calls the create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public createMarket(args: MethodArgs<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.createMarket(args, params))
  }

  /**
   * Calls the get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getMarket(args: MethodArgs<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getMarket(args, params), MarketData)
  }

  /**
   * Calls the get_price_feed(uint64)(uint64,uint64,(uint256,uint64)) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getPriceFeed(args: MethodArgs<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getPriceFeed(args, params), PriceFeed)
  }

  /**
   * Calls the fetch_price_feed(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public fetchPriceFeed(args: MethodArgs<'fetch_price_feed(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.fetchPriceFeed(args, params))
  }

  /**
   * Calls the pause_market(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public pauseMarket(args: MethodArgs<'pause_market(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.pauseMarket(args, params))
  }

  /**
   * Calls the sync_market(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public syncMarket(args: MethodArgs<'sync_market(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.syncMarket(args, params))
  }

  /**
   * Calls the withdraw_reserves(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public withdrawReserves(args: MethodArgs<'withdraw_reserves(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.withdrawReserves(args, params))
  }

  /**
   * Calls the deposit(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public deposit(args: MethodArgs<'deposit(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.deposit(args, params))
  }

  /**
   * Calls the calculate_user_interest(address,uint64)uint256 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public calculateUserInterest(args: MethodArgs<'calculate_user_interest(address,uint64)uint256'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.calculateUserInterest(args, params))
  }

  /**
   * Calls the calculate_user_debt_interest(address,uint64)uint256 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public calculateUserDebtInterest(args: MethodArgs<'calculate_user_debt_interest(address,uint64)uint256'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.calculateUserDebtInterest(args, params))
  }

  /**
   * Calls the withdraw(uint64,uint256)uint256 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public withdraw(args: MethodArgs<'withdraw(uint64,uint256)uint256'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.withdraw(args, params))
  }

  /**
   * Calls the borrow(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public borrow(args: MethodArgs<'borrow(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.borrow(args, params))
  }

  /**
   * Calls the repay(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public repay(args: MethodArgs<'repay(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.repay(args, params))
  }

  /**
   * Calls the sync_user_market_for_price_change(address,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public syncUserMarketForPriceChange(args: MethodArgs<'sync_user_market_for_price_change(address,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.syncUserMarketForPriceChange(args, params))
  }

  /**
   * Calls the get_global_user(address)(uint256,uint256,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getGlobalUser(args: MethodArgs<'get_global_user(address)(uint256,uint256,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getGlobalUser(args, params), GlobalUserData)
  }

  /**
   * Calls the liquidate_cross_market(uint64,uint64,address,uint256,uint256)uint256 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public liquidateCrossMarket(args: MethodArgs<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)uint256'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.liquidateCrossMarket(args, params))
  }

  /**
   * Calls the set_version(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setVersion(args: MethodArgs<'set_version(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setVersion(args, params))
  }

  /**
   * Calls the grant_upgrader(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public grantUpgrader(args: MethodArgs<'grant_upgrader(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.grantUpgrader(args, params))
  }

  /**
   * Calls the approve_update(bool)void ABI method.
   *
   * Approve update.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public approveUpdate(args: MethodArgs<'approve_update(bool)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.approveUpdate(args, params))
  }

  /**
   * Calls the set_role(byte[32],bool)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setRole(args: MethodArgs<'set_role(byte[32],bool)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setRole(args, params))
  }

  /**
   * Calls the has_role(byte[32])bool ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public hasRole(args: MethodArgs<'has_role(byte[32])bool'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.hasRole(args, params))
  }

  /**
   * Extracts a binary state value out of an AppState dictionary
   *
   * @param state The state dictionary containing the state value
   * @param key The key of the state value
   * @returns A BinaryState instance containing the state value, or undefined if the key was not found
   */
  private static getBinaryState(state: AppState, key: string): BinaryState | undefined {
    const value = state[key]
    if (!value) return undefined
    if (!('valueRaw' in value))
      throw new Error(`Failed to parse state value for ${key}; received an int when expected a byte array`)
    return {
      asString(): string {
        return value.value
      },
      asByteArray(): Uint8Array {
        return value.valueRaw
      }
    }
  }

  /**
   * Extracts a integer state value out of an AppState dictionary
   *
   * @param state The state dictionary containing the state value
   * @param key The key of the state value
   * @returns An IntegerState instance containing the state value, or undefined if the key was not found
   */
  private static getIntegerState(state: AppState, key: string): IntegerState | undefined {
    const value = state[key]
    if (!value) return undefined
    if ('valueRaw' in value)
      throw new Error(`Failed to parse state value for ${key}; received a byte array when expected a number`)
    return {
      asBigInt() {
        return typeof value.value === 'bigint' ? value.value : BigInt(value.value)
      },
      asNumber(): number {
        return typeof value.value === 'bigint' ? Number(value.value) : value.value
      },
    }
  }

  /**
   * Returns the smart contract's global state wrapped in a strongly typed accessor with options to format the stored value
   */
  public async getGlobalState(): Promise<DorkFiLendingPool['state']['global']> {
    const state = await this.appClient.getGlobalState()
    return {
      get contractVersion() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'contract_version')
      },
      get deploymentVersion() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'deployment_version')
      },
      get owner() {
        return DorkFiLendingPoolClient.getBinaryState(state, 'owner')
      },
      get paused() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'paused')
      },
      get secondsPerYear() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'seconds_per_year')
      },
      get stokenAppId() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'stoken_app_id')
      },
      get updatable() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'updatable')
      },
      get upgrader() {
        return DorkFiLendingPoolClient.getBinaryState(state, 'upgrader')
      },
    }
  }

  public compose(): DorkFiLendingPoolComposer {
    const client = this
    const atc = new AtomicTransactionComposer()
    let promiseChain:Promise<unknown> = Promise.resolve()
    const resultMappers: Array<undefined | ((x: any) => any)> = []
    return {
      postUpdate(args: MethodArgs<'post_update()void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.postUpdate(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getRoleKey(args: MethodArgs<'get_role_key(address,byte[3])byte[32]'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getRoleKey(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setMarketPrice(args: MethodArgs<'set_market_price(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setMarketPrice(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setMarket(args: MethodArgs<'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      attachPriceFeed(args: MethodArgs<'attach_price_feed(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.attachPriceFeed(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      detachPriceFeed(args: MethodArgs<'detach_price_feed(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.detachPriceFeed(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getOwner(args: MethodArgs<'get_owner()address'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getOwner(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      transferOwnership(args: MethodArgs<'transfer_ownership(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.transferOwnership(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setStorageAppId(args: MethodArgs<'set_storage_app_id(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setStorageAppId(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      isPaused(args: MethodArgs<'is_paused()bool'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.isPaused(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      pause(args: MethodArgs<'pause(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.pause(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setStokenAppId(args: MethodArgs<'set_stoken_app_id(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setStokenAppId(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getUser(args: MethodArgs<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getUser(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(UserData)
        return this
      },
      createMarket(args: MethodArgs<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.createMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getMarket(args: MethodArgs<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(MarketData)
        return this
      },
      getPriceFeed(args: MethodArgs<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getPriceFeed(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(PriceFeed)
        return this
      },
      fetchPriceFeed(args: MethodArgs<'fetch_price_feed(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.fetchPriceFeed(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      pauseMarket(args: MethodArgs<'pause_market(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.pauseMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      syncMarket(args: MethodArgs<'sync_market(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.syncMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      withdrawReserves(args: MethodArgs<'withdraw_reserves(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.withdrawReserves(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      deposit(args: MethodArgs<'deposit(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.deposit(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      calculateUserInterest(args: MethodArgs<'calculate_user_interest(address,uint64)uint256'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.calculateUserInterest(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      calculateUserDebtInterest(args: MethodArgs<'calculate_user_debt_interest(address,uint64)uint256'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.calculateUserDebtInterest(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      withdraw(args: MethodArgs<'withdraw(uint64,uint256)uint256'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.withdraw(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      borrow(args: MethodArgs<'borrow(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.borrow(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      repay(args: MethodArgs<'repay(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.repay(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      syncUserMarketForPriceChange(args: MethodArgs<'sync_user_market_for_price_change(address,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.syncUserMarketForPriceChange(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getGlobalUser(args: MethodArgs<'get_global_user(address)(uint256,uint256,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getGlobalUser(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(GlobalUserData)
        return this
      },
      liquidateCrossMarket(args: MethodArgs<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)uint256'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.liquidateCrossMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setVersion(args: MethodArgs<'set_version(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setVersion(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      grantUpgrader(args: MethodArgs<'grant_upgrader(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.grantUpgrader(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      approveUpdate(args: MethodArgs<'approve_update(bool)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.approveUpdate(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setRole(args: MethodArgs<'set_role(byte[32],bool)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setRole(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      hasRole(args: MethodArgs<'has_role(byte[32])bool'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.hasRole(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      get update() {
        const $this = this
        return {
          bare(args?: BareCallArgs & AppClientComposeCallCoreParams & AppClientCompilationParams & CoreAppCallArgs) {
            promiseChain = promiseChain.then(() => client.update.bare({...args, sendParams: {...args?.sendParams, skipSending: true, atc}}))
            resultMappers.push(undefined)
            return $this
          },
        }
      },
      clearState(args?: BareCallArgs & AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.clearState({...args, sendParams: {...args?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      addTransaction(txn: TransactionWithSigner | TransactionToSign | Transaction | Promise<SendTransactionResult>, defaultSender?: SendTransactionFrom) {
        promiseChain = promiseChain.then(async () => atc.addTransaction(await algokit.getTransactionWithSigner(txn, defaultSender ?? client.sender)))
        return this
      },
      async atc() {
        await promiseChain
        return atc
      },
      async simulate(options?: SimulateOptions) {
        await promiseChain
        const result = await atc.simulate(client.algod, new modelsv2.SimulateRequest({ txnGroups: [], ...options }))
        return {
          ...result,
          returns: result.methodResults?.map((val, i) => resultMappers[i] !== undefined ? resultMappers[i]!(val.returnValue) : val.returnValue)
        }
      },
      async execute(sendParams?: AppClientComposeExecuteParams) {
        await promiseChain
        const result = await algokit.sendAtomicTransactionComposer({ atc, sendParams }, client.algod)
        return {
          ...result,
          returns: result.returns?.map((val, i) => resultMappers[i] !== undefined ? resultMappers[i]!(val.returnValue) : val.returnValue)
        }
      }
    } as unknown as DorkFiLendingPoolComposer
  }
}
export type DorkFiLendingPoolComposer<TReturns extends [...any[]] = []> = {
  /**
   * Calls the post_update()void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  postUpdate(args: MethodArgs<'post_update()void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'post_update()void'>]>

  /**
   * Calls the get_role_key(address,byte[3])byte[32] ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getRoleKey(args: MethodArgs<'get_role_key(address,byte[3])byte[32]'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_role_key(address,byte[3])byte[32]'>]>

  /**
   * Calls the set_market_price(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setMarketPrice(args: MethodArgs<'set_market_price(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_market_price(uint64,uint256)void'>]>

  /**
   * Calls the set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setMarket(args: MethodArgs<'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void'>]>

  /**
   * Calls the attach_price_feed(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  attachPriceFeed(args: MethodArgs<'attach_price_feed(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'attach_price_feed(uint64,uint64)void'>]>

  /**
   * Calls the detach_price_feed(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  detachPriceFeed(args: MethodArgs<'detach_price_feed(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'detach_price_feed(uint64)void'>]>

  /**
   * Calls the get_owner()address ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getOwner(args: MethodArgs<'get_owner()address'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_owner()address'>]>

  /**
   * Calls the transfer_ownership(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  transferOwnership(args: MethodArgs<'transfer_ownership(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'transfer_ownership(address)void'>]>

  /**
   * Calls the set_storage_app_id(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setStorageAppId(args: MethodArgs<'set_storage_app_id(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_storage_app_id(uint64)void'>]>

  /**
   * Calls the is_paused()bool ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  isPaused(args: MethodArgs<'is_paused()bool'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'is_paused()bool'>]>

  /**
   * Calls the pause(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  pause(args: MethodArgs<'pause(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'pause(uint64)void'>]>

  /**
   * Calls the set_stoken_app_id(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setStokenAppId(args: MethodArgs<'set_stoken_app_id(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_stoken_app_id(uint64)void'>]>

  /**
   * Calls the get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getUser(args: MethodArgs<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>]>

  /**
   * Calls the create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  createMarket(args: MethodArgs<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>]>

  /**
   * Calls the get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getMarket(args: MethodArgs<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>]>

  /**
   * Calls the get_price_feed(uint64)(uint64,uint64,(uint256,uint64)) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getPriceFeed(args: MethodArgs<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>]>

  /**
   * Calls the fetch_price_feed(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  fetchPriceFeed(args: MethodArgs<'fetch_price_feed(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'fetch_price_feed(uint64)void'>]>

  /**
   * Calls the pause_market(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  pauseMarket(args: MethodArgs<'pause_market(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'pause_market(uint64,uint64)void'>]>

  /**
   * Calls the sync_market(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  syncMarket(args: MethodArgs<'sync_market(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'sync_market(uint64)void'>]>

  /**
   * Calls the withdraw_reserves(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  withdrawReserves(args: MethodArgs<'withdraw_reserves(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'withdraw_reserves(uint64,uint256)void'>]>

  /**
   * Calls the deposit(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  deposit(args: MethodArgs<'deposit(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'deposit(uint64,uint256)void'>]>

  /**
   * Calls the calculate_user_interest(address,uint64)uint256 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  calculateUserInterest(args: MethodArgs<'calculate_user_interest(address,uint64)uint256'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'calculate_user_interest(address,uint64)uint256'>]>

  /**
   * Calls the calculate_user_debt_interest(address,uint64)uint256 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  calculateUserDebtInterest(args: MethodArgs<'calculate_user_debt_interest(address,uint64)uint256'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'calculate_user_debt_interest(address,uint64)uint256'>]>

  /**
   * Calls the withdraw(uint64,uint256)uint256 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  withdraw(args: MethodArgs<'withdraw(uint64,uint256)uint256'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'withdraw(uint64,uint256)uint256'>]>

  /**
   * Calls the borrow(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  borrow(args: MethodArgs<'borrow(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'borrow(uint64,uint256)void'>]>

  /**
   * Calls the repay(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  repay(args: MethodArgs<'repay(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'repay(uint64,uint256)void'>]>

  /**
   * Calls the sync_user_market_for_price_change(address,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  syncUserMarketForPriceChange(args: MethodArgs<'sync_user_market_for_price_change(address,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'sync_user_market_for_price_change(address,uint64)void'>]>

  /**
   * Calls the get_global_user(address)(uint256,uint256,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getGlobalUser(args: MethodArgs<'get_global_user(address)(uint256,uint256,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_global_user(address)(uint256,uint256,uint64)'>]>

  /**
   * Calls the liquidate_cross_market(uint64,uint64,address,uint256,uint256)uint256 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  liquidateCrossMarket(args: MethodArgs<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)uint256'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)uint256'>]>

  /**
   * Calls the set_version(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setVersion(args: MethodArgs<'set_version(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_version(uint64,uint64)void'>]>

  /**
   * Calls the grant_upgrader(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  grantUpgrader(args: MethodArgs<'grant_upgrader(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'grant_upgrader(address)void'>]>

  /**
   * Calls the approve_update(bool)void ABI method.
   *
   * Approve update.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  approveUpdate(args: MethodArgs<'approve_update(bool)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'approve_update(bool)void'>]>

  /**
   * Calls the set_role(byte[32],bool)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setRole(args: MethodArgs<'set_role(byte[32],bool)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_role(byte[32],bool)void'>]>

  /**
   * Calls the has_role(byte[32])bool ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  hasRole(args: MethodArgs<'has_role(byte[32])bool'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'has_role(byte[32])bool'>]>

  /**
   * Gets available update methods
   */
  readonly update: {
    /**
     * Updates an existing instance of the DorkFiLendingPool smart contract using a bare call.
     *
     * @param args The arguments for the bare call
     * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
     */
    bare(args?: BareCallArgs & AppClientComposeCallCoreParams & AppClientCompilationParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, undefined]>
  }

  /**
   * Makes a clear_state call to an existing instance of the DorkFiLendingPool smart contract.
   *
   * @param args The arguments for the bare call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  clearState(args?: BareCallArgs & AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, undefined]>

  /**
   * Adds a transaction to the composer
   *
   * @param txn One of: A TransactionWithSigner object (returned as is), a TransactionToSign object (signer is obtained from the signer property), a Transaction object (signer is extracted from the defaultSender parameter), an async SendTransactionResult returned by one of algokit utils helpers (signer is obtained from the defaultSender parameter)
   * @param defaultSender The default sender to be used to obtain a signer where the object provided to the transaction parameter does not include a signer.
   */
  addTransaction(txn: TransactionWithSigner | TransactionToSign | Transaction | Promise<SendTransactionResult>, defaultSender?: SendTransactionFrom): DorkFiLendingPoolComposer<TReturns>
  /**
   * Returns the underlying AtomicTransactionComposer instance
   */
  atc(): Promise<AtomicTransactionComposer>
  /**
   * Simulates the transaction group and returns the result
   */
  simulate(options?: SimulateOptions): Promise<DorkFiLendingPoolComposerSimulateResult<TReturns>>
  /**
   * Executes the transaction group and returns the results
   */
  execute(sendParams?: AppClientComposeExecuteParams): Promise<DorkFiLendingPoolComposerResults<TReturns>>
}
export type SimulateOptions = Omit<ConstructorParameters<typeof modelsv2.SimulateRequest>[0], 'txnGroups'>
export type DorkFiLendingPoolComposerSimulateResult<TReturns extends [...any[]]> = {
  returns: TReturns
  methodResults: ABIResult[]
  simulateResponse: modelsv2.SimulateResponse
}
export type DorkFiLendingPoolComposerResults<TReturns extends [...any[]]> = {
  returns: TReturns
  groupId: string
  txIds: string[]
  transactions: Transaction[]
}
