/* eslint-disable */
/**
 * This file was automatically generated by @algorandfoundation/algokit-client-generator.
 * DO NOT MODIFY IT BY HAND.
 * requires: @algorandfoundation/algokit-utils: ^2
 */
import * as algokit from '@algorandfoundation/algokit-utils'
import type {
  ABIAppCallArg,
  AppCallTransactionResult,
  AppCallTransactionResultOfType,
  AppCompilationResult,
  AppReference,
  AppState,
  CoreAppCallArgs,
  RawAppCallArgs,
  TealTemplateParams,
} from '@algorandfoundation/algokit-utils/types/app'
import type {
  AppClientCallCoreParams,
  AppClientCompilationParams,
  AppClientDeployCoreParams,
  AppDetails,
  ApplicationClient,
} from '@algorandfoundation/algokit-utils/types/app-client'
import type { AppSpec } from '@algorandfoundation/algokit-utils/types/app-spec'
import type { SendTransactionResult, TransactionToSign, SendTransactionFrom, SendTransactionParams } from '@algorandfoundation/algokit-utils/types/transaction'
import type { ABIResult, TransactionWithSigner } from 'algosdk'
import { Algodv2, OnApplicationComplete, Transaction, AtomicTransactionComposer, modelsv2 } from 'algosdk'
export const APP_SPEC: AppSpec = {
  "hints": {
    "post_update()void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_role_key(address,byte[3])byte[32]": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_market_price(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "market_data": {
          "name": "MarketData",
          "elements": [
            [
              "paused",
              "bool"
            ],
            [
              "max_total_deposits",
              "uint256"
            ],
            [
              "max_total_borrows",
              "uint256"
            ],
            [
              "liquidation_bonus",
              "uint64"
            ],
            [
              "collateral_factor",
              "uint64"
            ],
            [
              "liquidation_threshold",
              "uint64"
            ],
            [
              "reserve_factor",
              "uint64"
            ],
            [
              "borrow_rate",
              "uint64"
            ],
            [
              "slope",
              "uint64"
            ],
            [
              "total_scaled_deposits",
              "uint256"
            ],
            [
              "total_scaled_borrows",
              "uint256"
            ],
            [
              "deposit_index",
              "uint256"
            ],
            [
              "borrow_index",
              "uint256"
            ],
            [
              "last_update_time",
              "uint64"
            ],
            [
              "reserves",
              "uint256"
            ],
            [
              "price",
              "uint256"
            ],
            [
              "ntoken_id",
              "uint64"
            ],
            [
              "close_factor",
              "uint64"
            ]
          ]
        }
      }
    },
    "attach_price_feed(uint64,uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "detach_price_feed(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_owner()address": {
      "read_only": true,
      "call_config": {
        "no_op": "CALL"
      }
    },
    "transfer_ownership(address)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_storage_app_id(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "is_paused()bool": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "pause(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_stoken_app_id(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "UserData",
          "elements": [
            [
              "scaled_deposits",
              "uint256"
            ],
            [
              "scaled_borrows",
              "uint256"
            ],
            [
              "deposit_index",
              "uint256"
            ],
            [
              "borrow_index",
              "uint256"
            ],
            [
              "last_update_time",
              "uint64"
            ],
            [
              "last_price",
              "uint256"
            ]
          ]
        }
      }
    },
    "create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)": {
      "read_only": true,
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "MarketData",
          "elements": [
            [
              "paused",
              "bool"
            ],
            [
              "max_total_deposits",
              "uint256"
            ],
            [
              "max_total_borrows",
              "uint256"
            ],
            [
              "liquidation_bonus",
              "uint64"
            ],
            [
              "collateral_factor",
              "uint64"
            ],
            [
              "liquidation_threshold",
              "uint64"
            ],
            [
              "reserve_factor",
              "uint64"
            ],
            [
              "borrow_rate",
              "uint64"
            ],
            [
              "slope",
              "uint64"
            ],
            [
              "total_scaled_deposits",
              "uint256"
            ],
            [
              "total_scaled_borrows",
              "uint256"
            ],
            [
              "deposit_index",
              "uint256"
            ],
            [
              "borrow_index",
              "uint256"
            ],
            [
              "last_update_time",
              "uint64"
            ],
            [
              "reserves",
              "uint256"
            ],
            [
              "price",
              "uint256"
            ],
            [
              "ntoken_id",
              "uint64"
            ],
            [
              "close_factor",
              "uint64"
            ]
          ]
        }
      }
    },
    "get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "MarketTransactionCap",
          "elements": [
            [
              "deposit",
              "uint256"
            ],
            [
              "withdraw",
              "uint256"
            ],
            [
              "borrow",
              "uint256"
            ],
            [
              "liquidate",
              "uint256"
            ]
          ]
        }
      }
    },
    "get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "UserCap",
          "elements": [
            [
              "total_deposits",
              "uint256"
            ],
            [
              "total_borrows",
              "uint256"
            ],
            [
              "total_liquidations",
              "uint256"
            ],
            [
              "total_withdrawals",
              "uint256"
            ],
            [
              "daily_liquidations",
              "uint256"
            ],
            [
              "daily_withdrawals",
              "uint256"
            ],
            [
              "daily_reset_time",
              "uint64"
            ]
          ]
        }
      }
    },
    "set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "user_cap": {
          "name": "UserCap",
          "elements": [
            [
              "total_deposits",
              "uint256"
            ],
            [
              "total_borrows",
              "uint256"
            ],
            [
              "total_liquidations",
              "uint256"
            ],
            [
              "total_withdrawals",
              "uint256"
            ],
            [
              "daily_liquidations",
              "uint256"
            ],
            [
              "daily_withdrawals",
              "uint256"
            ],
            [
              "daily_reset_time",
              "uint64"
            ]
          ]
        }
      }
    },
    "set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "transaction_cap": {
          "name": "MarketTransactionCap",
          "elements": [
            [
              "deposit",
              "uint256"
            ],
            [
              "withdraw",
              "uint256"
            ],
            [
              "borrow",
              "uint256"
            ],
            [
              "liquidate",
              "uint256"
            ]
          ]
        }
      }
    },
    "get_price_feed(uint64)(uint64,uint64,(uint256,uint64))": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "PriceFeed",
          "elements": [
            [
              "market_id",
              "uint64"
            ],
            [
              "provider_app_id",
              "uint64"
            ],
            [
              "price_with_timestamp",
              "(uint256,uint64)"
            ]
          ]
        }
      }
    },
    "fetch_price_feed(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "pause_market(uint64,uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "sync_market(uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "withdraw_reserves(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "deposit(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "withdraw(uint64,uint256)uint256": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "borrow(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "repay(uint64,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "sync_user_market_for_price_change(address,uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "get_global_user(address)(uint256,uint256,uint64)": {
      "call_config": {
        "no_op": "CALL"
      },
      "structs": {
        "output": {
          "name": "GlobalUserData",
          "elements": [
            [
              "total_collateral_value",
              "uint256"
            ],
            [
              "total_borrow_value",
              "uint256"
            ],
            [
              "last_update_time",
              "uint64"
            ]
          ]
        }
      }
    },
    "liquidate_cross_market(uint64,uint64,address,uint256,uint256)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_version(uint64,uint64)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "grant_upgrader(address)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "approve_update(bool)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "set_role(byte[32],bool)void": {
      "call_config": {
        "no_op": "CALL"
      }
    },
    "has_role(byte[32])bool": {
      "call_config": {
        "no_op": "CALL"
      }
    }
  },
  "source": {
    "approval": "I3ByYWdtYSB2ZXJzaW9uIDEwCgpjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5hcHByb3ZhbF9wcm9ncmFtOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjI0CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuIE51bUFwcEFyZ3MKICAgIGJ6IG1haW5fYmFyZV9yb3V0aW5nQDQwCiAgICBtZXRob2QgInBvc3RfdXBkYXRlKCl2b2lkIgogICAgbWV0aG9kICJnZXRfcm9sZV9rZXkoYWRkcmVzcyxieXRlWzNdKWJ5dGVbMzJdIgogICAgbWV0aG9kICJzZXRfbWFya2V0X3ByaWNlKHVpbnQ2NCx1aW50MjU2KXZvaWQiCiAgICBtZXRob2QgInNldF9tYXJrZXQodWludDY0LChib29sLHVpbnQyNTYsdWludDI1Nix1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQ2NCx1aW50MjU2LHVpbnQyNTYsdWludDY0LHVpbnQ2NCkpdm9pZCIKICAgIG1ldGhvZCAiYXR0YWNoX3ByaWNlX2ZlZWQodWludDY0LHVpbnQ2NCl2b2lkIgogICAgbWV0aG9kICJkZXRhY2hfcHJpY2VfZmVlZCh1aW50NjQpdm9pZCIKICAgIG1ldGhvZCAiZ2V0X293bmVyKClhZGRyZXNzIgogICAgbWV0aG9kICJ0cmFuc2Zlcl9vd25lcnNoaXAoYWRkcmVzcyl2b2lkIgogICAgbWV0aG9kICJzZXRfc3RvcmFnZV9hcHBfaWQodWludDY0KXZvaWQiCiAgICBtZXRob2QgImlzX3BhdXNlZCgpYm9vbCIKICAgIG1ldGhvZCAicGF1c2UodWludDY0KXZvaWQiCiAgICBtZXRob2QgInNldF9zdG9rZW5fYXBwX2lkKHVpbnQ2NCl2b2lkIgogICAgbWV0aG9kICJnZXRfdXNlcihhZGRyZXNzLHVpbnQ2NCkodWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50NjQsdWludDI1NikiCiAgICBtZXRob2QgImNyZWF0ZV9tYXJrZXQodWludDY0LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50NjQsdWludDI1Nix1aW50MjU2LHVpbnQ2NCx1aW50NjQpdWludDY0IgogICAgbWV0aG9kICJnZXRfbWFya2V0KHVpbnQ2NCkoYm9vbCx1aW50MjU2LHVpbnQyNTYsdWludDY0LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50NjQsdWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50NjQsdWludDI1Nix1aW50MjU2LHVpbnQ2NCx1aW50NjQpIgogICAgbWV0aG9kICJnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh1aW50NjQpKHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYpIgogICAgbWV0aG9kICJnZXRfdXNlcl9jYXAoYWRkcmVzcykodWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDY0KSIKICAgIG1ldGhvZCAic2V0X3VzZXJfY2FwKGFkZHJlc3MsKHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQ2NCkpdm9pZCIKICAgIG1ldGhvZCAic2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodWludDY0LCh1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2KSl2b2lkIgogICAgbWV0aG9kICJnZXRfcHJpY2VfZmVlZCh1aW50NjQpKHVpbnQ2NCx1aW50NjQsKHVpbnQyNTYsdWludDY0KSkiCiAgICBtZXRob2QgImZldGNoX3ByaWNlX2ZlZWQodWludDY0KXZvaWQiCiAgICBtZXRob2QgInBhdXNlX21hcmtldCh1aW50NjQsdWludDY0KXZvaWQiCiAgICBtZXRob2QgInN5bmNfbWFya2V0KHVpbnQ2NCl2b2lkIgogICAgbWV0aG9kICJ3aXRoZHJhd19yZXNlcnZlcyh1aW50NjQsdWludDI1Nil2b2lkIgogICAgbWV0aG9kICJkZXBvc2l0KHVpbnQ2NCx1aW50MjU2KXZvaWQiCiAgICBtZXRob2QgIndpdGhkcmF3KHVpbnQ2NCx1aW50MjU2KXVpbnQyNTYiCiAgICBtZXRob2QgImJvcnJvdyh1aW50NjQsdWludDI1Nil2b2lkIgogICAgbWV0aG9kICJyZXBheSh1aW50NjQsdWludDI1Nil2b2lkIgogICAgbWV0aG9kICJzeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UoYWRkcmVzcyx1aW50NjQpdm9pZCIKICAgIG1ldGhvZCAiZ2V0X2dsb2JhbF91c2VyKGFkZHJlc3MpKHVpbnQyNTYsdWludDI1Nix1aW50NjQpIgogICAgbWV0aG9kICJsaXF1aWRhdGVfY3Jvc3NfbWFya2V0KHVpbnQ2NCx1aW50NjQsYWRkcmVzcyx1aW50MjU2LHVpbnQyNTYpdm9pZCIKICAgIG1ldGhvZCAic2V0X3ZlcnNpb24odWludDY0LHVpbnQ2NCl2b2lkIgogICAgbWV0aG9kICJncmFudF91cGdyYWRlcihhZGRyZXNzKXZvaWQiCiAgICBtZXRob2QgImFwcHJvdmVfdXBkYXRlKGJvb2wpdm9pZCIKICAgIG1ldGhvZCAic2V0X3JvbGUoYnl0ZVszMl0sYm9vbCl2b2lkIgogICAgbWV0aG9kICJoYXNfcm9sZShieXRlWzMyXSlib29sIgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMAogICAgbWF0Y2ggbWFpbl9wb3N0X3VwZGF0ZV9yb3V0ZUAyIG1haW5fZ2V0X3JvbGVfa2V5X3JvdXRlQDMgbWFpbl9zZXRfbWFya2V0X3ByaWNlX3JvdXRlQDQgbWFpbl9zZXRfbWFya2V0X3JvdXRlQDUgbWFpbl9hdHRhY2hfcHJpY2VfZmVlZF9yb3V0ZUA2IG1haW5fZGV0YWNoX3ByaWNlX2ZlZWRfcm91dGVANyBtYWluX2dldF9vd25lcl9yb3V0ZUA4IG1haW5fdHJhbnNmZXJfb3duZXJzaGlwX3JvdXRlQDkgbWFpbl9zZXRfc3RvcmFnZV9hcHBfaWRfcm91dGVAMTAgbWFpbl9pc19wYXVzZWRfcm91dGVAMTEgbWFpbl9wYXVzZV9yb3V0ZUAxMiBtYWluX3NldF9zdG9rZW5fYXBwX2lkX3JvdXRlQDEzIG1haW5fZ2V0X3VzZXJfcm91dGVAMTQgbWFpbl9jcmVhdGVfbWFya2V0X3JvdXRlQDE1IG1haW5fZ2V0X21hcmtldF9yb3V0ZUAxNiBtYWluX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX3JvdXRlQDE3IG1haW5fZ2V0X3VzZXJfY2FwX3JvdXRlQDE4IG1haW5fc2V0X3VzZXJfY2FwX3JvdXRlQDE5IG1haW5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfcm91dGVAMjAgbWFpbl9nZXRfcHJpY2VfZmVlZF9yb3V0ZUAyMSBtYWluX2ZldGNoX3ByaWNlX2ZlZWRfcm91dGVAMjIgbWFpbl9wYXVzZV9tYXJrZXRfcm91dGVAMjMgbWFpbl9zeW5jX21hcmtldF9yb3V0ZUAyNCBtYWluX3dpdGhkcmF3X3Jlc2VydmVzX3JvdXRlQDI1IG1haW5fZGVwb3NpdF9yb3V0ZUAyNiBtYWluX3dpdGhkcmF3X3JvdXRlQDI3IG1haW5fYm9ycm93X3JvdXRlQDI4IG1haW5fcmVwYXlfcm91dGVAMjkgbWFpbl9zeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2Vfcm91dGVAMzAgbWFpbl9nZXRfZ2xvYmFsX3VzZXJfcm91dGVAMzEgbWFpbl9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X3JvdXRlQDMyIG1haW5fc2V0X3ZlcnNpb25fcm91dGVAMzMgbWFpbl9ncmFudF91cGdyYWRlcl9yb3V0ZUAzNCBtYWluX2FwcHJvdmVfdXBkYXRlX3JvdXRlQDM1IG1haW5fc2V0X3JvbGVfcm91dGVAMzYgbWFpbl9oYXNfcm9sZV9yb3V0ZUAzNwogICAgZXJyIC8vIHJlamVjdCB0cmFuc2FjdGlvbgoKbWFpbl9wb3N0X3VwZGF0ZV9yb3V0ZUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjM5CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIGNhbGxzdWIgcG9zdF91cGRhdGUKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fZ2V0X3JvbGVfa2V5X3JvdXRlQDM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyNDkKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjI0CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjQ5CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgZ2V0X3JvbGVfa2V5CiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX3NldF9tYXJrZXRfcHJpY2Vfcm91dGVANDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzI4NC0zMjg1CiAgICAvLyAjIG92ZXJyaWRlCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzI4NC0zMjg1CiAgICAvLyAjIG92ZXJyaWRlCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgc2V0X21hcmtldF9wcmljZQogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9zZXRfbWFya2V0X3JvdXRlQDU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyOTAtMzI5MQogICAgLy8gIyBvdmVycmlkZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMjQKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyOTAtMzI5MQogICAgLy8gIyBvdmVycmlkZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHNldF9tYXJrZXQKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fYXR0YWNoX3ByaWNlX2ZlZWRfcm91dGVANjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzI5Ni0zMjk3CiAgICAvLyAjIG92ZXJyaWRlCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzI5Ni0zMjk3CiAgICAvLyAjIG92ZXJyaWRlCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgYXR0YWNoX3ByaWNlX2ZlZWQKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fZGV0YWNoX3ByaWNlX2ZlZWRfcm91dGVANzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzMwNC0zMzA1CiAgICAvLyAjIG92ZXJyaWRlCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzMwNC0zMzA1CiAgICAvLyAjIG92ZXJyaWRlCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgZGV0YWNoX3ByaWNlX2ZlZWQKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fZ2V0X293bmVyX3JvdXRlQDg6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzgKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgY2FsbHN1YiBnZXRfb3duZXIKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgc3dhcAogICAgY29uY2F0CiAgICBsb2cKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fdHJhbnNmZXJfb3duZXJzaGlwX3JvdXRlQDk6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNDIKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjI0CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDQyCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgdHJhbnNmZXJfb3duZXJzaGlwCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX3NldF9zdG9yYWdlX2FwcF9pZF9yb3V0ZUAxMDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA2MAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMjQKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNjAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBzZXRfc3RvcmFnZV9hcHBfaWQKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5faXNfcGF1c2VkX3JvdXRlQDExOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDcyCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIGNhbGxzdWIgaXNfcGF1c2VkCiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX3BhdXNlX3JvdXRlQDEyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDgwCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA4MAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHBhdXNlCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX3NldF9zdG9rZW5fYXBwX2lkX3JvdXRlQDEzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDkyCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA5MgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHNldF9zdG9rZW5fYXBwX2lkCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2dldF91c2VyX3JvdXRlQDE0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTIwCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEyMAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGdldF91c2VyCiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2NyZWF0ZV9tYXJrZXRfcm91dGVAMTU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExOTUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjI0CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMwogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgNAogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgNQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgNgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgNwogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgOAogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgOQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMTAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE5NQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGNyZWF0ZV9tYXJrZXQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgc3dhcAogICAgY29uY2F0CiAgICBsb2cKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fZ2V0X21hcmtldF9yb3V0ZUAxNjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI2NAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMjQKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNjQKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgY2FsbHN1YiBnZXRfbWFya2V0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX3JvdXRlQDE3OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjgwCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI4MAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2dldF91c2VyX2NhcF9yb3V0ZUAxODoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI5NgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMjQKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyOTYKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBnZXRfdXNlcl9jYXAKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgc3dhcAogICAgY29uY2F0CiAgICBsb2cKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fc2V0X3VzZXJfY2FwX3JvdXRlQDE5OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzEyCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMxMgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHNldF91c2VyX2NhcAogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9yb3V0ZUAyMDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMyMgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMjQKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMjIKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9nZXRfcHJpY2VfZmVlZF9yb3V0ZUAyMToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM1NgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMjQKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNTYKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBnZXRfcHJpY2VfZmVlZAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9mZXRjaF9wcmljZV9mZWVkX3JvdXRlQDIyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDQwCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ0MAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGZldGNoX3ByaWNlX2ZlZWQKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fcGF1c2VfbWFya2V0X3JvdXRlQDIzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTIwCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUyMAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHBhdXNlX21hcmtldAogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9zeW5jX21hcmtldF9yb3V0ZUAyNDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUzMAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMjQKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MzAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBzeW5jX21hcmtldAogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl93aXRoZHJhd19yZXNlcnZlc19yb3V0ZUAyNToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYwMS0xNjAyCiAgICAvLyAjIFJFTSBpbnRlbnRpb25hbGx5IHNraXBwaW5nIHN1YnJvdXRpbmUgdG8gcmVkdWNlIGNvbnRyYWN0IHNpemUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjI0CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjAxLTE2MDIKICAgIC8vICMgUkVNIGludGVudGlvbmFsbHkgc2tpcHBpbmcgc3Vicm91dGluZSB0byByZWR1Y2UgY29udHJhY3Qgc2l6ZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHdpdGhkcmF3X3Jlc2VydmVzCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2RlcG9zaXRfcm91dGVAMjY6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NDIKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjI0CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjQyCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgZGVwb3NpdAogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl93aXRoZHJhd19yb3V0ZUAyNzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTgzMAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMjQKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MzAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiB3aXRoZHJhdwogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9ib3Jyb3dfcm91dGVAMjg6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5NjUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjI0CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTY1CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIGNhbGxzdWIgYm9ycm93CiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX3JlcGF5X3JvdXRlQDI5OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTA1CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjEwNQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHJlcGF5CiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX3N5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZV9yb3V0ZUAzMDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMwNQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMjQKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMDUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBzeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fZ2V0X2dsb2JhbF91c2VyX3JvdXRlQDMxOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzYxCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM2MQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGdldF9nbG9iYWxfdXNlcgogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X3JvdXRlQDMyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDExCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDMKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDQKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQxMQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGxpcXVpZGF0ZV9jcm9zc19tYXJrZXQKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fc2V0X3ZlcnNpb25fcm91dGVAMzM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMjQKICAgIC8vIGNsYXNzIERvcmtGaUxlbmRpbmdQb29sKExlbmRpbmdQb29sLCBVcGdyYWRlYWJsZSwgQWNjZXNzQ29udHJvbCk6CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIHNldF92ZXJzaW9uCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2dyYW50X3VwZ3JhZGVyX3JvdXRlQDM0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjgKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjI0CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjgKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBncmFudF91cGdyYWRlcgogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9hcHByb3ZlX3VwZGF0ZV9yb3V0ZUAzNToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIxCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIGludCAxCiAgICByZXR1cm4KCm1haW5fc2V0X3JvbGVfcm91dGVAMzY6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjUyCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBpcyBub3QgY3JlYXRpbmcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NTIKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgY2FsbHN1YiBzZXRfcm9sZQogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9oYXNfcm9sZV9yb3V0ZUAzNzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NjAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGlzIG5vdCBjcmVhdGluZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjI0CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo2MAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICBjYWxsc3ViIGhhc19yb2xlCiAgICBieXRlIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnQgMQogICAgcmV0dXJuCgptYWluX2JhcmVfcm91dGluZ0A0MDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzIyNAogICAgLy8gY2xhc3MgRG9ya0ZpTGVuZGluZ1Bvb2woTGVuZGluZ1Bvb2wsIFVwZ3JhZGVhYmxlLCBBY2Nlc3NDb250cm9sKToKICAgIGludCAwCiAgICBpbnQgNAogICAgdHhuIE9uQ29tcGxldGlvbgogICAgbWF0Y2ggbWFpbl9jcmVhdGVANDEgbWFpbl9vbl91cGRhdGVANDIKICAgIGVyciAvLyByZWplY3QgdHJhbnNhY3Rpb24KCm1haW5fY3JlYXRlQDQxOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjI0CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgICEKICAgIGFzc2VydCAvLyBpcyBjcmVhdGluZwogICAgaW50IDEKICAgIHJldHVybgoKbWFpbl9vbl91cGRhdGVANDI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MgogICAgLy8gQGFyYzQuYmFyZW1ldGhvZChhbGxvd19hY3Rpb25zPVsiVXBkYXRlQXBwbGljYXRpb24iXSkKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gaXMgbm90IGNyZWF0aW5nCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1Mi0xNTMKICAgIC8vIEBhcmM0LmJhcmVtZXRob2QoYWxsb3dfYWN0aW9ucz1bIlVwZGF0ZUFwcGxpY2F0aW9uIl0pCiAgICAvLyBkZWYgb25fdXBkYXRlKHNlbGYpIC0+IE5vbmU6CiAgICBjYWxsc3ViIG9uX3VwZGF0ZQogICAgaW50IDEKICAgIHJldHVybgoKCi8vIGNvbnRyYWN0LkRvcmtGaUxlbmRpbmdQb29sLnBvc3RfdXBkYXRlKCkgLT4gdm9pZDoKcG9zdF91cGRhdGU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyMzktMzI0MAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcG9zdF91cGRhdGUoc2VsZikgLT4gTm9uZToKICAgIHByb3RvIDAgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjQxCiAgICAvLyBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLnVwZ3JhZGVyLCAibXVzdCBiZSB1cGdyYWRlciIKICAgIHR4biBTZW5kZXIKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMwogICAgLy8gc2VsZi51cGdyYWRlciA9IEFjY291bnQoKQogICAgYnl0ZSAidXBncmFkZXIiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyNDEKICAgIC8vIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYudXBncmFkZXIsICJtdXN0IGJlIHVwZ3JhZGVyIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnVwZ3JhZGVyIGV4aXN0cwogICAgPT0KICAgIGFzc2VydCAvLyBtdXN0IGJlIHVwZ3JhZGVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMAogICAgLy8gc2VsZi5jb250cmFjdF92ZXJzaW9uID0gVUludDY0KCkKICAgIGJ5dGUgImNvbnRyYWN0X3ZlcnNpb24iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyNDIKICAgIC8vIHNlbGYuY29udHJhY3RfdmVyc2lvbiA9IFVJbnQ2NCgwKQogICAgaW50IDAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMQogICAgLy8gc2VsZi5kZXBsb3ltZW50X3ZlcnNpb24gPSBVSW50NjQoKQogICAgYnl0ZSAiZGVwbG95bWVudF92ZXJzaW9uIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjQzCiAgICAvLyBzZWxmLmRlcGxveW1lbnRfdmVyc2lvbiA9IFVJbnQ2NCg0KQogICAgaW50IDQKICAgIGFwcF9nbG9iYWxfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5nZXRfcm9sZV9rZXkoYWNjb3VudDogYnl0ZXMsIHJvbGU6IGJ5dGVzKSAtPiBieXRlczoKZ2V0X3JvbGVfa2V5OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjQ5LTMyNTAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9yb2xlX2tleShzZWxmLCBhY2NvdW50OiBhcmM0LkFkZHJlc3MsIHJvbGU6IEJ5dGVzMykgLT4gQnl0ZXMzMjoKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjUxCiAgICAvLyByZXR1cm4gQnl0ZXMzMi5mcm9tX2J5dGVzKHNlbGYuX3JvbGVfa2V5KGFjY291bnQubmF0aXZlLCByb2xlLmJ5dGVzKSkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9yb2xlX2tleQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuRG9ya0ZpTGVuZGluZ1Bvb2wuX3JvbGVfa2V5KGFjY291bnQ6IGJ5dGVzLCByb2xlOiBieXRlcykgLT4gYnl0ZXM6Cl9yb2xlX2tleToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzI1My0zMjU0CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9yb2xlX2tleShzZWxmLCBhY2NvdW50OiBBY2NvdW50LCByb2xlOiBCeXRlcykgLT4gQnl0ZXM6CiAgICBwcm90byAyIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzI1NQogICAgLy8gcmV0dXJuIG9wLnNoYTI1NihhY2NvdW50LmJ5dGVzICsgcm9sZSkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBjb25jYXQKICAgIHNoYTI1NgogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuRG9ya0ZpTGVuZGluZ1Bvb2wuc2V0X21hcmtldF9wcmljZShtYXJrZXRfaWQ6IGJ5dGVzLCBwcmljZTogYnl0ZXMpIC0+IHZvaWQ6CnNldF9tYXJrZXRfcHJpY2U6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyODQtMzI4NgogICAgLy8gIyBvdmVycmlkZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyODcKICAgIC8vIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcmFjbGUoKQogICAgY2FsbHN1YiBfb25seV9hdXRob3JpemVkX3ByaWNlX29yYWNsZQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjg4CiAgICAvLyBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKG1hcmtldF9pZC5uYXRpdmUsIHByaWNlLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMgogICAgYnRvaQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9zZXRfbWFya2V0X3ByaWNlCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5fb25seV9hdXRob3JpemVkX3ByaWNlX29yYWNsZSgpIC0+IHZvaWQ6Cl9vbmx5X2F1dGhvcml6ZWRfcHJpY2Vfb3JhY2xlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjY3LTMyNjgKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfYXV0aG9yaXplZF9wcmljZV9vcmFjbGUoc2VsZikgLT4gTm9uZToKICAgIHByb3RvIDAgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjY5CiAgICAvLyBzZWxmLl9vbmx5X2F1dGhvcml6ZWRfcm9sZShCeXRlcyhST0xFX1BSSUNFX09SQUNMRSkpCiAgICBieXRlIDB4NzI3MDZmCiAgICBjYWxsc3ViIF9vbmx5X2F1dGhvcml6ZWRfcm9sZQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuRG9ya0ZpTGVuZGluZ1Bvb2wuX29ubHlfYXV0aG9yaXplZF9yb2xlKHJvbGU6IGJ5dGVzKSAtPiB2b2lkOgpfb25seV9hdXRob3JpemVkX3JvbGU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyNTctMzI1OAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9hdXRob3JpemVkX3JvbGUoc2VsZiwgcm9sZTogQnl0ZXMpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzI1OQogICAgLy8gYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciBvciBzZWxmLl9oYXNfcm9sZSgKICAgIHR4biBTZW5kZXIKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMTYKICAgIC8vIHNlbGYub3duZXIgPSBBY2NvdW50KCkKICAgIGJ5dGUgIm93bmVyIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjU5CiAgICAvLyBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyIG9yIHNlbGYuX2hhc19yb2xlKAogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLm93bmVyIGV4aXN0cwogICAgPT0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzI1OS0zMjYxCiAgICAvLyBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyIG9yIHNlbGYuX2hhc19yb2xlKAogICAgLy8gICAgIHNlbGYuX3JvbGVfa2V5KFR4bi5zZW5kZXIsIHJvbGUpCiAgICAvLyApLCAib25seSBhdXRob3JpemVkIHJvbGUgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIGJueiBfb25seV9hdXRob3JpemVkX3JvbGVfYm9vbF90cnVlQDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzI2MAogICAgLy8gc2VsZi5fcm9sZV9rZXkoVHhuLnNlbmRlciwgcm9sZSkKICAgIHR4biBTZW5kZXIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfcm9sZV9rZXkKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzI1OS0zMjYxCiAgICAvLyBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyIG9yIHNlbGYuX2hhc19yb2xlKAogICAgLy8gICAgIHNlbGYuX3JvbGVfa2V5KFR4bi5zZW5kZXIsIHJvbGUpCiAgICAvLyApLCAib25seSBhdXRob3JpemVkIHJvbGUgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIGNhbGxzdWIgX2hhc19yb2xlCiAgICBieiBfb25seV9hdXRob3JpemVkX3JvbGVfYm9vbF9mYWxzZUAzCgpfb25seV9hdXRob3JpemVkX3JvbGVfYm9vbF90cnVlQDI6CiAgICBpbnQgMQogICAgYiBfb25seV9hdXRob3JpemVkX3JvbGVfYm9vbF9tZXJnZUA0Cgpfb25seV9hdXRob3JpemVkX3JvbGVfYm9vbF9mYWxzZUAzOgogICAgaW50IDAKCl9vbmx5X2F1dGhvcml6ZWRfcm9sZV9ib29sX21lcmdlQDQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyNTktMzI2MQogICAgLy8gYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciBvciBzZWxmLl9oYXNfcm9sZSgKICAgIC8vICAgICBzZWxmLl9yb2xlX2tleShUeG4uc2VuZGVyLCByb2xlKQogICAgLy8gKSwgIm9ubHkgYXV0aG9yaXplZCByb2xlIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICBhc3NlcnQgLy8gb25seSBhdXRob3JpemVkIHJvbGUgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbgogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuQWNjZXNzQ29udHJvbC5faGFzX3JvbGUocm9sZTogYnl0ZXMpIC0+IHVpbnQ2NDoKX2hhc19yb2xlOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo2NC02NQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaGFzX3JvbGUoc2VsZiwgcm9sZTogQnl0ZXMpIC0+IGJvb2w6CiAgICBwcm90byAxIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NTAKICAgIC8vIHNlbGYuYWRkcmVzc19yb2xlcyA9IEJveE1hcChCeXRlczMyLCBib29sKQogICAgYnl0ZSAiYWRkcmVzc19yb2xlcyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NjYKICAgIC8vIHJldHVybiBzZWxmLmFkZHJlc3Nfcm9sZXMuZ2V0KEJ5dGVzMzIuZnJvbV9ieXRlcyhyb2xlKSwgZGVmYXVsdD1GYWxzZSkKICAgIGZyYW1lX2RpZyAtMQogICAgY29uY2F0CiAgICBib3hfZ2V0CiAgICBzd2FwCiAgICBidG9pCiAgICBpbnQgMAogICAgc3dhcAogICAgdW5jb3ZlciAyCiAgICBzZWxlY3QKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkOiB1aW50NjQsIHByaWNlOiBieXRlcykgLT4gdm9pZDoKX3NldF9tYXJrZXRfcHJpY2U6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MjAtMTQyMQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcmljZTogQmlnVUludCkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDIyCiAgICAvLyBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgY2FsbHN1YiBfaXNfcGF1c2VkCiAgICAhCiAgICBhc3NlcnQgLy8gUHJvdG9jb2wgaXMgcGF1c2VkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAtMTQyMwogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBkZWwgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWREZXRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgZnJhbWVfZGlnIC0yCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAKICAgIC8vIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgYnl0ZSAibWFya2V0cyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMC0xNDIzCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9kYXRhLnByaWNlID09IG1hcmtldC5wcmljZSwgIlByaWNlIG1pc21hdGNoIgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc3VtZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXSA9IFByaWNlRmVlZCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wPVByaWNlV2l0aFRpbWVzdGFtcCgKICAgIC8vICAgICAgICAgICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICksCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZEF0dGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZC5uYXRpdmUsIHByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcmljZTogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBzd2FwCiAgICBjb25jYXQKICAgIGR1cG4gMgogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MjMKICAgIC8vIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBhc3NlcnQgLy8gTWFya2V0IGRvZXMgbm90IGV4aXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MjQtMTQyNQogICAgLy8gIyBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIGZyYW1lX2RpZyAtMQogICAgYnl0ZSAweAogICAgYj4KICAgIGFzc2VydCAvLyBQcmljZSBtdXN0IGJlIHBvc2l0aXZlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MjcKICAgIC8vIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICBib3hfZ2V0CiAgICBzd2FwCiAgICBkdXAKICAgIHVuY292ZXIgMgogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYubWFya2V0cyBlbnRyeSBleGlzdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQyOS0xNDMwCiAgICAvLyAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vIGlmIG1hcmtldC5wYXVzZWQgYW5kIG1hcmtldC5wcmljZSA9PSAwOgogICAgZHVwCiAgICBpbnQgMAogICAgZ2V0Yml0CiAgICBieXRlIDB4MDAKICAgIGludCAwCiAgICB1bmNvdmVyIDIKICAgIHNldGJpdAogICAgYnl0ZSAweDAwCiAgICAhPQogICAgYnogX3NldF9tYXJrZXRfcHJpY2VfYWZ0ZXJfaWZfZWxzZUAzCiAgICBmcmFtZV9kaWcgMQogICAgZHVwCiAgICBpbnQgMjgxCiAgICBpbnQgMzIKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAKICAgIGI9PQogICAgc3dhcAogICAgZnJhbWVfYnVyeSAyCiAgICBieiBfc2V0X21hcmtldF9wcmljZV9hZnRlcl9pZl9lbHNlQDMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQzMQogICAgLy8gbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIGZyYW1lX2RpZyAxCiAgICBpbnQgMAogICAgZHVwCiAgICBzZXRiaXQKICAgIGZyYW1lX2J1cnkgMgoKX3NldF9tYXJrZXRfcHJpY2VfYWZ0ZXJfaWZfZWxzZUAzOgogICAgZnJhbWVfZGlnIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQzMy0xNDM0CiAgICAvLyAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIGZyYW1lX2RpZyAtMQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIqCiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBifAogICAgaW50IDI4MQogICAgc3dhcAogICAgcmVwbGFjZTMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQzNgogICAgLy8gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIGZyYW1lX2RpZyAwCiAgICBzd2FwCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5faXNfcGF1c2VkKCkgLT4gdWludDY0OgpfaXNfcGF1c2VkOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDc2LTEwNzcKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgcHJvdG8gMCAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNzgKICAgIC8vIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMTcKICAgIC8vIHNlbGYucGF1c2VkID0gVUludDY0KCkKICAgIGJ5dGUgInBhdXNlZCIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA3OAogICAgLy8gcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnBhdXNlZCBleGlzdHMKICAgIGludCAxCiAgICA9PQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuRG9ya0ZpTGVuZGluZ1Bvb2wuc2V0X21hcmtldCh0b2tlbl9pZDogYnl0ZXMsIG1hcmtldF9kYXRhOiBieXRlcykgLT4gdm9pZDoKc2V0X21hcmtldDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzI5MC0zMjkyCiAgICAvLyAjIG92ZXJyaWRlCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzI5MwogICAgLy8gc2VsZi5fb25seV9hdXRob3JpemVkX21hcmtldF9jb250cm9sbGVyKCkKICAgIGNhbGxzdWIgX29ubHlfYXV0aG9yaXplZF9tYXJrZXRfY29udHJvbGxlcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjk0CiAgICAvLyBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ0b2kKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfc2V0X21hcmtldAogICAgZnJhbWVfYnVyeSAtMQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuRG9ya0ZpTGVuZGluZ1Bvb2wuX29ubHlfYXV0aG9yaXplZF9tYXJrZXRfY29udHJvbGxlcigpIC0+IHZvaWQ6Cl9vbmx5X2F1dGhvcml6ZWRfbWFya2V0X2NvbnRyb2xsZXI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyNjMtMzI2NAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9hdXRob3JpemVkX21hcmtldF9jb250cm9sbGVyKHNlbGYpIC0+IE5vbmU6CiAgICBwcm90byAwIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MzI2NQogICAgLy8gc2VsZi5fb25seV9hdXRob3JpemVkX3JvbGUoQnl0ZXMoUk9MRV9NQVJLRVRfQ09OVFJPTExFUikpCiAgICBieXRlIDB4NzI2ZDYzCiAgICBjYWxsc3ViIF9vbmx5X2F1dGhvcml6ZWRfcm9sZQogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3NldF9tYXJrZXQodG9rZW5faWQ6IHVpbnQ2NCwgbWFya2V0X2RhdGE6IGJ5dGVzKSAtPiBieXRlczoKX3NldF9tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNDUtMTM0NgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzQ3CiAgICAvLyBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgZnJhbWVfZGlnIC0yCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAKICAgIC8vIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgYnl0ZSAibWFya2V0cyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM0NwogICAgLy8gbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIHN3YXAKICAgIGNvbmNhdAogICAgZHVwCiAgICBib3hfZ2V0CiAgICBzd2FwCiAgICBjb3ZlciAyCiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5tYXJrZXRzIGVudHJ5IGV4aXN0cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIwLTEzNDgKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNDgKICAgIC8vIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICBhc3NlcnQgLy8gTWFya2V0IGFscmVhZHkgZXhpc3RzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNDkKICAgIC8vIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIGZyYW1lX2RpZyAtMQogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHVuY292ZXIgMgogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGI9PQogICAgYXNzZXJ0IC8vIFByaWNlIG1pc21hdGNoCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNTAKICAgIC8vIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIGZyYW1lX2RpZyAtMQogICAgYm94X3B1dAogICAgZnJhbWVfZGlnIC0xCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZDogYnl0ZXMsIHByb3ZpZGVyX2FwcF9pZDogYnl0ZXMpIC0+IHZvaWQ6CmF0dGFjaF9wcmljZV9mZWVkOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjk2LTMzMDAKICAgIC8vICMgb3ZlcnJpZGUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzMDEKICAgIC8vIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9mZWVkX21hbmFnZXIoKQogICAgY2FsbHN1YiBfb25seV9hdXRob3JpemVkX3ByaWNlX2ZlZWRfbWFuYWdlcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzAyCiAgICAvLyBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ0b2kKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgY2FsbHN1YiBfYXR0YWNoX3ByaWNlX2ZlZWQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkRvcmtGaUxlbmRpbmdQb29sLl9vbmx5X2F1dGhvcml6ZWRfcHJpY2VfZmVlZF9tYW5hZ2VyKCkgLT4gdm9pZDoKX29ubHlfYXV0aG9yaXplZF9wcmljZV9mZWVkX21hbmFnZXI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyNzEtMzI3MgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9hdXRob3JpemVkX3ByaWNlX2ZlZWRfbWFuYWdlcihzZWxmKSAtPiBOb25lOgogICAgcHJvdG8gMCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMyNzMKICAgIC8vIHNlbGYuX29ubHlfYXV0aG9yaXplZF9yb2xlKEJ5dGVzKFJPTEVfUFJJQ0VfRkVFRF9NQU5BR0VSKSkKICAgIGJ5dGUgMHg3MjcwNmQKICAgIGNhbGxzdWIgX29ubHlfYXV0aG9yaXplZF9yb2xlCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQ6IHVpbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiB1aW50NjQpIC0+IHZvaWQ6Cl9hdHRhY2hfcHJpY2VfZmVlZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM3OS0xMzgwCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIwLTEzODEKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgZnJhbWVfZGlnIC0yCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAKICAgIC8vIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgYnl0ZSAibWFya2V0cyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMC0xMzgxCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9kYXRhLnByaWNlID09IG1hcmtldC5wcmljZSwgIlByaWNlIG1pc21hdGNoIgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc3VtZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIGRpZyAxCiAgICBjb25jYXQKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzgxCiAgICAvLyBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIGFzc2VydCAvLyBNYXJrZXQgZXhpc3RzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjcKICAgIC8vIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICBieXRlICJwcmljZV9mZWVkcyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyNy0xMzgyCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9kYXRhLnByaWNlID09IG1hcmtldC5wcmljZSwgIlByaWNlIG1pc21hdGNoIgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc3VtZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICBkaWcgMQogICAgY29uY2F0CiAgICBkdXAKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgIQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzgyCiAgICAvLyBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICBhc3NlcnQgLy8gUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzODMKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM4NgogICAgLy8gcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICBmcmFtZV9kaWcgLTEKICAgIGl0b2IKICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM4OAogICAgLy8gcHJpY2U9bWFya2V0LnByaWNlLAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM4OQogICAgLy8gdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM4Ny0xMzkwCiAgICAvLyBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyApLAogICAgY29uY2F0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzODQtMTM5MQogICAgLy8gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICApLAogICAgLy8gKQogICAgdW5jb3ZlciAzCiAgICB1bmNvdmVyIDIKICAgIGNvbmNhdAogICAgc3dhcAogICAgY29uY2F0CiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZ2V0X21hcmtldCh0b2tlbl9pZDogdWludDY0KSAtPiBieXRlczoKX2dldF9tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNjgtMTI2OQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAtMTI3MAogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIGZyYW1lX2RpZyAtMQogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIwCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAtMTI3MAogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIHN3YXAKICAgIGNvbmNhdAogICAgZHVwCiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI3MAogICAgLy8gaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgYnogX2dldF9tYXJrZXRfZWxzZV9ib2R5QDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI3MQogICAgLy8gcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIGZyYW1lX2RpZyAwCiAgICBib3hfZ2V0CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5tYXJrZXRzIGVudHJ5IGV4aXN0cwogICAgc3dhcAogICAgcmV0c3ViCgpfZ2V0X21hcmtldF9lbHNlX2JvZHlAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI3MwogICAgLy8gYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIGJ5dGUgMHg3MwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjc0CiAgICAvLyBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIEJveCBleGlzdHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI3NS0xMjc3CiAgICAvLyBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICBtZXRob2QgImdldF9tYXJrZXRfZGVmYXVsdCgpKGJvb2wsdWludDI1Nix1aW50MjU2LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDY0LHVpbnQyNTYsdWludDI1Nix1aW50NjQsdWludDY0KSIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgaXR4biBMYXN0TG9nCiAgICBkdXAKICAgIGV4dHJhY3QgNCAwCiAgICBzd2FwCiAgICBleHRyYWN0IDAgNAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICA9PQogICAgYXNzZXJ0IC8vIEFSQzQgcHJlZml4IGlzIHZhbGlkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNzgKICAgIC8vIHJldHVybiBtYXJrZXQKICAgIHN3YXAKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkRvcmtGaUxlbmRpbmdQb29sLmRldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkOiBieXRlcykgLT4gdm9pZDoKZGV0YWNoX3ByaWNlX2ZlZWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzMDQtMzMwNgogICAgLy8gIyBvdmVycmlkZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgcHJvdG8gMSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjMzMDcKICAgIC8vIHNlbGYuX29ubHlfYXV0aG9yaXplZF9wcmljZV9mZWVkX21hbmFnZXIoKQogICAgY2FsbHN1YiBfb25seV9hdXRob3JpemVkX3ByaWNlX2ZlZWRfbWFuYWdlcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMzA4CiAgICAvLyBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ0b2kKICAgIGNhbGxzdWIgX2RldGFjaF9wcmljZV9mZWVkCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQ6IHVpbnQ2NCkgLT4gdm9pZDoKX2RldGFjaF9wcmljZV9mZWVkOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDA0LTE0MDUKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMC0xNDA2CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9kYXRhLnByaWNlID09IG1hcmtldC5wcmljZSwgIlByaWNlIG1pc21hdGNoIgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc3VtZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXSA9IFByaWNlRmVlZCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wPVByaWNlV2l0aFRpbWVzdGFtcCgKICAgIC8vICAgICAgICAgICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICksCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZEF0dGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGZyYW1lX2RpZyAtMQogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIwCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAtMTQwNgogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBkaWcgMQogICAgY29uY2F0CiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQwNgogICAgLy8gYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGFzc2VydCAvLyBNYXJrZXQgZG9lcyBub3QgZXhpc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyNwogICAgLy8gc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIGJ5dGUgInByaWNlX2ZlZWRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDI3LTE0MDcKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICBzd2FwCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0MDcKICAgIC8vIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICBhc3NlcnQgLy8gUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQwOAogICAgLy8gZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICBib3hfZGVsCiAgICBwb3AKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLmdldF9vd25lcigpIC0+IGJ5dGVzOgpnZXRfb3duZXI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMzgtMTAzOQogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIHByb3RvIDAgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDQwCiAgICAvLyByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDE2CiAgICAvLyBzZWxmLm93bmVyID0gQWNjb3VudCgpCiAgICBieXRlICJvd25lciIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA0MAogICAgLy8gcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLm93bmVyIGV4aXN0cwogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wudHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lcjogYnl0ZXMpIC0+IHZvaWQ6CnRyYW5zZmVyX293bmVyc2hpcDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA0Mi0xMDQzCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA0NAogICAgLy8gc2VsZi5fb25seV9vd25lcigpCiAgICBjYWxsc3ViIF9vbmx5X293bmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMTYKICAgIC8vIHNlbGYub3duZXIgPSBBY2NvdW50KCkKICAgIGJ5dGUgIm93bmVyIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDQ1LTEwNDYKICAgIC8vICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgZnJhbWVfZGlnIC0xCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX29ubHlfb3duZXIoKSAtPiB2b2lkOgpfb25seV9vd25lcjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzNC0xMDM1CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICBwcm90byAwIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzNgogICAgLy8gYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICB0eG4gU2VuZGVyCiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDE2CiAgICAvLyBzZWxmLm93bmVyID0gQWNjb3VudCgpCiAgICBieXRlICJvd25lciIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzNgogICAgLy8gYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYub3duZXIgZXhpc3RzCiAgICA9PQogICAgYXNzZXJ0IC8vIG9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24KICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLnNldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZDogYnl0ZXMpIC0+IHZvaWQ6CnNldF9zdG9yYWdlX2FwcF9pZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA2MC0xMDYxCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgcHJvdG8gMSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNjIKICAgIC8vIHNlbGYuX29ubHlfb3duZXIoKQogICAgY2FsbHN1YiBfb25seV9vd25lcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDYzCiAgICAvLyBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBjYWxsc3ViIF9zZXRfc3RvcmFnZV9hcHBfaWQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQ6IHVpbnQ2NCkgLT4gdm9pZDoKX3NldF9zdG9yYWdlX2FwcF9pZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA2NS0xMDY2CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIHByb3RvIDEgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDY4CiAgICAvLyBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgZnJhbWVfZGlnIC0xCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNjcKICAgIC8vIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgYnl0ZSAweDczCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwNjgKICAgIC8vIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICBzd2FwCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5pc19wYXVzZWQoKSAtPiBieXRlczoKaXNfcGF1c2VkOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDcyLTEwNzMKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICBwcm90byAwIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA3NAogICAgLy8gcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIGNhbGxzdWIgX2lzX3BhdXNlZAogICAgYnl0ZSAweDAwCiAgICBpbnQgMAogICAgdW5jb3ZlciAyCiAgICBzZXRiaXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLnBhdXNlKHBhdXNlOiBieXRlcykgLT4gdm9pZDoKcGF1c2U6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwODAtMTA4MQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgcHJvdG8gMSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwODIKICAgIC8vIHNlbGYuX29ubHlfb3duZXIoKQogICAgY2FsbHN1YiBfb25seV9vd25lcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDgzLTEwODQKICAgIC8vICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDE3CiAgICAvLyBzZWxmLnBhdXNlZCA9IFVJbnQ2NCgpCiAgICBieXRlICJwYXVzZWQiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwODMtMTA4NAogICAgLy8gIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgc3dhcAogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLnNldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQ6IGJ5dGVzKSAtPiB2b2lkOgpzZXRfc3Rva2VuX2FwcF9pZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA5Mi0xMDkzCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIHByb3RvIDEgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDk0CiAgICAvLyBzZWxmLl9vbmx5X293bmVyKCkKICAgIGNhbGxzdWIgX29ubHlfb3duZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTA5NS0xMDk2CiAgICAvLyAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ0b2kKICAgIGNhbGxzdWIgX3NldF9zdG9rZW5fYXBwX2lkCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZDogdWludDY0KSAtPiB2b2lkOgpfc2V0X3N0b2tlbl9hcHBfaWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwOTgtMTA5OQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgcHJvdG8gMSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMDEKICAgIC8vIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgZ2xvYmFsIEN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEwMi0xMTA1CiAgICAvLyAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyApCiAgICBpdHhuX2JlZ2luCiAgICBmcmFtZV9kaWcgLTEKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgbWV0aG9kICJpc19taW50ZXIoYWRkcmVzcylib29sIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgaXR4biBMYXN0TG9nCiAgICBkdXAKICAgIGV4dHJhY3QgNCAwCiAgICBzd2FwCiAgICBleHRyYWN0IDAgNAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICA9PQogICAgYXNzZXJ0IC8vIEFSQzQgcHJlZml4IGlzIHZhbGlkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMDgKICAgIC8vIGlzX2FwcHJvdmVkX21pbnRlcgogICAgYnl0ZSAweDAwCiAgICAhPQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTA2LTExMDkKICAgIC8vICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICBhc3NlcnQgLy8gTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDE4CiAgICAvLyBzZWxmLnN0b2tlbl9hcHBfaWQgPSBVSW50NjQoKSAgIyBzdGFibGUgbWFya2V0CiAgICBieXRlICJzdG9rZW5fYXBwX2lkIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTEwCiAgICAvLyBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICBmcmFtZV9kaWcgLTEKICAgIGFwcF9nbG9iYWxfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5nZXRfdXNlcih1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiBieXRlcykgLT4gYnl0ZXM6CmdldF91c2VyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTIwLTExMjEKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICBwcm90byAyIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEyMgogICAgLy8gcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTIKICAgIHN3YXAKICAgIGNhbGxzdWIgX2dldF91c2VyCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZ2V0X3VzZXIodXNlcl9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0KSAtPiBieXRlczoKX2dldF91c2VyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTI0LTExMjUKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTI2CiAgICAvLyB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X3VzZXJfa2V5CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjEKICAgIC8vIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgYnl0ZSAidXNlcnMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjEtMTEyNwogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIHN3YXAKICAgIGNvbmNhdAogICAgZHVwCiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTEyNwogICAgLy8gaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIGJ6IF9nZXRfdXNlcl9lbHNlX2JvZHlAMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTI4CiAgICAvLyByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIGZyYW1lX2RpZyAwCiAgICBib3hfZ2V0CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi51c2VycyBlbnRyeSBleGlzdHMKICAgIHN3YXAKICAgIHJldHN1YgoKX2dldF91c2VyX2Vsc2VfYm9keUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTMwCiAgICAvLyBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgYnl0ZSAweDczCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMzEKICAgIC8vIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICBib3hfZ2V0CiAgICBhc3NlcnQgLy8gY2hlY2sgQm94IGV4aXN0cwogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTMyCiAgICAvLyB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgaXR4bl9iZWdpbgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICBtZXRob2QgImdldF91c2VyX2RlZmF1bHQoKSh1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQ2NCx1aW50MjU2KSIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgaXR4biBMYXN0TG9nCiAgICBkdXAKICAgIGV4dHJhY3QgNCAwCiAgICBzd2FwCiAgICBleHRyYWN0IDAgNAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICA9PQogICAgYXNzZXJ0IC8vIEFSQzQgcHJlZml4IGlzIHZhbGlkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMzMKICAgIC8vIHJldHVybiB1c2VyCiAgICBzd2FwCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCkgLT4gYnl0ZXM6Cl9nZXRfdXNlcl9rZXk6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMTQtMTExNQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgcHJvdG8gMiAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMTcKICAgIC8vIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIGZyYW1lX2RpZyAtMQogICAgaXRvYgogICAgZnJhbWVfZGlnIC0yCiAgICBzd2FwCiAgICBjb25jYXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTExNi0xMTE4CiAgICAvLyByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICkKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLmNyZWF0ZV9tYXJrZXQodG9rZW5faWQ6IGJ5dGVzLCBjb2xsYXRlcmFsX2ZhY3RvcjogYnl0ZXMsIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYnl0ZXMsIHJlc2VydmVfZmFjdG9yOiBieXRlcywgYm9ycm93X3JhdGU6IGJ5dGVzLCBzbG9wZTogYnl0ZXMsIG1heF90b3RhbF9kZXBvc2l0czogYnl0ZXMsIG1heF90b3RhbF9ib3Jyb3dzOiBieXRlcywgbGlxdWlkYXRpb25fYm9udXM6IGJ5dGVzLCBjbG9zZV9mYWN0b3I6IGJ5dGVzKSAtPiBieXRlczoKY3JlYXRlX21hcmtldDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE5NS0xMjA4CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgcHJvdG8gMTAgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjA5CiAgICAvLyBzZWxmLl9vbmx5X293bmVyKCkKICAgIGNhbGxzdWIgX29ubHlfb3duZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIxMAogICAgLy8gYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIGNhbGxzdWIgX2lzX3BhdXNlZAogICAgIQogICAgYXNzZXJ0IC8vIFByb3RvY29sIGlzIHBhdXNlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjE0CiAgICAvLyBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICBmcmFtZV9kaWcgLTgKICAgIGJ0b2kKICAgIGZyYW1lX2RpZyAtOQogICAgYnRvaQogICAgPgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjEyLTEyMTUKICAgIC8vICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgYXNzZXJ0IC8vIExpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIxOAogICAgLy8gdG9rZW5faWQubmF0aXZlLAogICAgZnJhbWVfZGlnIC0xMAogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjMzCiAgICAvLyBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIyMAogICAgLy8gcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgYnl0ZSAweDgwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMTktMTI0MAogICAgLy8gTWFya2V0RGF0YSgKICAgIC8vICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAwCiAgICAvLyAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICksCiAgICBmcmFtZV9kaWcgLTQKICAgIGNvbmNhdAogICAgZnJhbWVfZGlnIC0zCiAgICBjb25jYXQKICAgIGZyYW1lX2RpZyAtMgogICAgY29uY2F0CiAgICBmcmFtZV9kaWcgLTkKICAgIGNvbmNhdAogICAgZnJhbWVfZGlnIC04CiAgICBjb25jYXQKICAgIGZyYW1lX2RpZyAtNwogICAgY29uY2F0CiAgICBmcmFtZV9kaWcgLTYKICAgIGNvbmNhdAogICAgZnJhbWVfZGlnIC01CiAgICBjb25jYXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIyOQogICAgLy8gdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMTktMTI0MAogICAgLy8gTWFya2V0RGF0YSgKICAgIC8vICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAwCiAgICAvLyAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICksCiAgICBjb25jYXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIzMAogICAgLy8gdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIxOS0xMjQwCiAgICAvLyBNYXJrZXREYXRhKAogICAgLy8gICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIDAKICAgIC8vICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gKSwKICAgIGNvbmNhdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjMxCiAgICAvLyBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMGRlMGI2YjNhNzY0MDAwMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjE5LTEyNDAKICAgIC8vIE1hcmtldERhdGEoCiAgICAvLyAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgMAogICAgLy8gICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyApLAogICAgY29uY2F0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMzIKICAgIC8vIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIxOS0xMjQwCiAgICAvLyBNYXJrZXREYXRhKAogICAgLy8gICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIDAKICAgIC8vICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gKSwKICAgIGNvbmNhdAogICAgc3dhcAogICAgY29uY2F0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMzQKICAgIC8vIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyMTktMTI0MAogICAgLy8gTWFya2V0RGF0YSgKICAgIC8vICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAwCiAgICAvLyAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICksCiAgICBjb25jYXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIzNS0xMjM3CiAgICAvLyBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgMAogICAgLy8gKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIxOS0xMjQwCiAgICAvLyBNYXJrZXREYXRhKAogICAgLy8gICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIDAKICAgIC8vICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gKSwKICAgIGNvbmNhdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjM4CiAgICAvLyBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIxOS0xMjQwCiAgICAvLyBNYXJrZXREYXRhKAogICAgLy8gICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIDAKICAgIC8vICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gKSwKICAgIGNvbmNhdAogICAgZnJhbWVfZGlnIC0xCiAgICBjb25jYXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTIxNy0xMjQxCiAgICAvLyBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgMAogICAgLy8gICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgKSwKICAgIC8vICkKICAgIGNhbGxzdWIgX2NyZWF0ZV9tYXJrZXQKICAgIHBvcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjE2LTEyNDIKICAgIC8vIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICkKICAgIGl0b2IKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9jcmVhdGVfbWFya2V0KHRva2VuX2lkOiB1aW50NjQsIG1hcmtldF9kYXRhOiBieXRlcykgLT4gdWludDY0LCBieXRlczoKX2NyZWF0ZV9tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNDQtMTI0NQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgcHJvdG8gMiAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAtMTI0NgogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIGZyYW1lX2RpZyAtMgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIwCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAtMTI0NgogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIGRpZyAxCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAhCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNDYKICAgIC8vIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgYXNzZXJ0IC8vIE1hcmtldCBhbHJlYWR5IGV4aXN0cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjQ3CiAgICAvLyBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICB0eG4gU2VuZGVyCiAgICBjYWxsc3ViIHJlcXVpcmVfcGF5bWVudAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjQ4CiAgICAvLyBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICBpbnQgMjAwMDAwMAogICAgPj0KICAgIGFzc2VydCAvLyBpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjUwCiAgICAvLyBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI0OQogICAgLy8gY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgaW50IDYKICAgIGl0eG5fZmllbGQgR2xvYmFsTnVtVWludAogICAgaW50IDYKICAgIGl0eG5fZmllbGQgR2xvYmFsTnVtQnl0ZVNsaWNlCiAgICBieXRlIGJhc2U2NCBDb0VCUXc9PQogICAgaXR4bl9maWVsZCBDbGVhclN0YXRlUHJvZ3JhbVBhZ2VzCiAgICBieXRlIGJhc2U2NCBDaUFFQUFFZ0JpWVRCQlVmZkhVTGRHOTBZV3hUZFhCd2JIa0ZiM2R1WlhJQUNHSmhiR0Z1WTJWekNIVndaM0poWkdWeUNIUnZhMlZ1WDJsa0JHNWhiV1VHYzNsdFltOXNDR1JsWTJsdFlXeHpCSG1EdzF3QkFBUmxmUlBzQkxhdUdpVUVoT3dUMVJCamIyNTBjbUZqZEY5MlpYSnphVzl1RW1SbGNHeHZlVzFsYm5SZmRtVnljMmx2Ymdsd1lYSmxiblJmYVdRSmRYQmtZWFJoWW14bE1SaEFBQU9JQkpJeEcwRUJ1SUlIQktheTAvc0V0WlhzRXdUeFVGVW5CUE40TndFRTJuQWx1UVJLbG8rUEJMVkNJU1VuRENjTkp3NkNDQVRzbVdCQkJJTGxjOFFFdTdNWjh3VC9LNlhGQklVbVRYNEVlTHlaMUFUVWxyOURCR3NMai9nMkdnQ09FZ0FCQUJBQUlnQXhBRU1BV1FCeUFJZ0FtQUNvQUxnQXlBRGJBUEVCQVFFUUFTSUJNUUF4R1JSRU1SaEVOaG9CaUFGSkkwTXhHUlJFTVJoRU5ob0JOaG9DaUFISkkwTXhHUlJFTVJoRU5ob0JpQUlWSTBNeEdSUkVNUmhFTmhvQk5ob0NpQUpVSTBNeEdSUkVNUmhFTmhvQk5ob0NpQUtpS0V4UXNDTkRNUmtVUkRFWVJEWWFBVFlhQWpZYUE0Z0NqeWhNVUxBalF6RVpGRVF4R0VRMkdnRTJHZ0tJQW44b1RGQ3dJME14R1JSRU1SaEVpQUoxS0V4UXNDTkRNUmtVUkRFWVJJZ0NiaWhNVUxBalF6RVpGRVF4R0VTSUFtY29URkN3STBNeEdSUkVNUmhFaUFKa0tFeFFzQ05ETVJrVVJERVlSRFlhQVlnQ1lTaE1VTEFqUXpFWkZFUXhHRVEyR2dFMkdnS0lBbHdvVEZDd0kwTXhHUlJFTVJoRWlBSjdLRXhRc0NORE1Sa1VSREVZUkRZYUFZZ0NjQ05ETVJrVVJERVlSRFlhQVRZYUFvZ0NqaU5ETVJrVVJERVlSRFlhQVlnQ255TkRNUmtVUkRFWVJDTkRJb0VFTVJtT0FnQUJBQW9BTVJnVVJJZ0NvU05ETVJoRWlBS2xJME9LQVFBaUp3WmxSQlJFaS84WGlBQUJpWW9CQUxHTC83SVlKdzZ5R2lXeUVDS3lBYk8wUGtsWEJBQk1Wd0FFS0JKRXNZdi9zaGduRExJYUpiSVFJcklCczdRK1NWY0VBRXhYQUFRb0VrU3hpLyt5R0NjTnNob2xzaEFpc2dHenRENUpWd1FBVEZjQUJDZ1NSSUFIUkc5eWEwWnBJRThDVUNjSFRHZUFBVzVNVUNjSVRHY1hKd2xNWnlrclp5Y0dpLzluaVlvQ0FERUFJaXBsUkJKRWkvNkwvNGdBQVltS0FnQWlLV1ZFaS8rZ0tVeG5pLzZJQUNnbkJJditVRXlMLzZCTVNieElUTDh5QTR2L0ZTUU9SQ1N2aS8rclRJditVRXhRSndwTVVMQ0ppZ0VCSndTTC8xQytLMDRDVFltS0FRQWlLbVZFTVFBU1JJdi9pQUFCaVlvQkFERUFpUC9aU1l2L3AwUW5CREVBVUV5TC82Rk1TYnhJVEw4aUtXVkVpLytoS1V4bk1RQXlBNHYvRlNRT1JDU3ZpLytyVGdKUVRGQW5Da3hRc0ltS0FnQWlLbVZFTVFBU1JJditpLytJQUFHSmlnSUFpLzZJLzRhTC95dWxSRW1MLzZkRUlpbGxSSXYvcDBRbkJJditVRXlMLzZGTVNieElUTDhpS1dWRWkvK2hLVXhuTWdPTC94VWtEa1FrcjR2L3E0ditUd0pRVEZBbkNreFFzSW1LQWdFbkM0bUtBd0VuQzRtS0FnRW5DNG1LQUFFaUp3ZGxSSW1LQUFFaUp3aGxSSW1LQUFFaUp3bGxSQlpYQndHSmlnQUJJaWxsUkVrVkpBNUVKSytyaVlvQkFZdi9pUDc0U1JVa0RrUWtyNnVKaWdJQmkvNkwvNGdBQ1VrVkpBNUVKSytyaVlvQ0FZditpLzlRQVlBSllYQndjbTkyWVd4elRGQytLMDRDVFltS0FBRWlLbVZFaVlvQkFJZ0FCb3YvaUFBTmlZb0FBREVBSWlwbFJCSkVpWW9CQUNJcVpVUXFpLzluaS85UWdBU2FJajc3VEZDd2lZb0NBSXYraS85UWdBU01qUG5OVEZDd2kvNFhKdzlNWjR2L0Z5Y1FUR2VKaWdFQU1RQXlDUkpFSWljRlpVU0wvMUNBQkszMTRyaE1VTEFuQll2L1o0bUtBQUF5RFVsRUp4Rk1aNG1LQUFBeEFDSW5CV1ZFRWtRaUp4SmxSQ01TUkltS0FBQW5CeXRuSndnclp5Y0pJbWNwSzJjbkVTSm5Kd1lpWnlveUNXY25EeUpuSnhBaVp5Y1NJMmNuQlRJSlo0az0KICAgIGl0eG5fZmllbGQgQXBwcm92YWxQcm9ncmFtUGFnZXMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI1MAogICAgLy8gYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgaXR4biBDcmVhdGVkQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjUxLTEyNTMKICAgIC8vIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyApLnN1Ym1pdCgpCiAgICBpdHhuX2JlZ2luCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNTIKICAgIC8vIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIGR1cAogICAgYXBwX3BhcmFtc19nZXQgQXBwQWRkcmVzcwogICAgYXNzZXJ0IC8vIGFwcGxpY2F0aW9uIGV4aXN0cwogICAgaW50IDEwMDAwMDAKICAgIGl0eG5fZmllbGQgQW1vdW50CiAgICBpdHhuX2ZpZWxkIFJlY2VpdmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNTEKICAgIC8vIGl0eG4uUGF5bWVudCgKICAgIGludCBwYXkKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI1MgogICAgLy8gcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNTEtMTI1MwogICAgLy8gaXR4bi5QYXltZW50KAogICAgLy8gICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICkuc3VibWl0KCkKICAgIGl0eG5fc3VibWl0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNTQtMTI1OAogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIGR1cAogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICBtZXRob2QgImJvb3RzdHJhcDY0KHVpbnQ2NCl2b2lkIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGRpZyAyCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI1OQogICAgLy8gbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICBkdXAKICAgIGl0b2IKICAgIGZyYW1lX2RpZyAtMQogICAgaW50IDMxMwogICAgdW5jb3ZlciAyCiAgICByZXBsYWNlMwogICAgZnJhbWVfYnVyeSAtMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjYwCiAgICAvLyBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICBzd2FwCiAgICBmcmFtZV9kaWcgLTEKICAgIGJveF9wdXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI2MQogICAgLy8gYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIG1ldGhvZCAiTWFya2V0Q3JlYXRlZCh1aW50NjQpIgogICAgdW5jb3ZlciAyCiAgICBjb25jYXQKICAgIGxvZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjYyCiAgICAvLyByZXR1cm4gYmFzZV9hcHAuaWQKICAgIGZyYW1lX2RpZyAtMQogICAgcmV0c3ViCgoKLy8gb3BlbnN1Ym1hcmluZS51dGlscy5hbGdvcmFuZC5yZXF1aXJlX3BheW1lbnQod2hvOiBieXRlcykgLT4gdWludDY0OgpyZXF1aXJlX3BheW1lbnQ6CiAgICAvLyB1c3IvbG9jYWwvbGliL3B5dGhvbjMuMTIvc2l0ZS1wYWNrYWdlcy9vcGVuc3VibWFyaW5lL3V0aWxzL2FsZ29yYW5kLnB5OjE1LTIzCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjIGZ1bmN0aW9uOiByZXF1aXJlX3BheW1lbnQgKGludGVybmFsKQogICAgLy8gIyBhcmd1bWVudHM6IE5vbmUKICAgIC8vICMgcHVycG9zZTogY2hlY2sgcGF5bWVudAogICAgLy8gIyBwcmUtY29uZGl0aW9uczogTm9uZQogICAgLy8gIyBwb3N0LWNvbmRpdGlvbnM6IE5vbmUKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgcmVxdWlyZV9wYXltZW50KHdobzogQWNjb3VudCkgLT4gVUludDY0OgogICAgcHJvdG8gMSAxCiAgICAvLyB1c3IvbG9jYWwvbGliL3B5dGhvbjMuMTIvc2l0ZS1wYWNrYWdlcy9vcGVuc3VibWFyaW5lL3V0aWxzL2FsZ29yYW5kLnB5OjI0CiAgICAvLyByZWZfZ3JvdXBfaW5kZXggPSBUeG4uZ3JvdXBfaW5kZXgKICAgIHR4biBHcm91cEluZGV4CiAgICAvLyB1c3IvbG9jYWwvbGliL3B5dGhvbjMuMTIvc2l0ZS1wYWNrYWdlcy9vcGVuc3VibWFyaW5lL3V0aWxzL2FsZ29yYW5kLnB5OjI1CiAgICAvLyBhc3NlcnQgcmVmX2dyb3VwX2luZGV4ID4gMCwgImdyb3VwIGluZGV4IGdyZWF0ZXIgdGhhbiB6ZXJvIgogICAgZHVwCiAgICBhc3NlcnQgLy8gZ3JvdXAgaW5kZXggZ3JlYXRlciB0aGFuIHplcm8KICAgIC8vIHVzci9sb2NhbC9saWIvcHl0aG9uMy4xMi9zaXRlLXBhY2thZ2VzL29wZW5zdWJtYXJpbmUvdXRpbHMvYWxnb3JhbmQucHk6MjYKICAgIC8vIHBheW1lbnRfZ3JvdXBfaW5kZXggPSByZWZfZ3JvdXBfaW5kZXggLSAxCiAgICBpbnQgMQogICAgLQogICAgLy8gdXNyL2xvY2FsL2xpYi9weXRob24zLjEyL3NpdGUtcGFja2FnZXMvb3BlbnN1Ym1hcmluZS91dGlscy9hbGdvcmFuZC5weToyOAogICAgLy8gZ3R4bi5QYXltZW50VHJhbnNhY3Rpb24ocGF5bWVudF9ncm91cF9pbmRleCkuc2VuZGVyID09IHdobwogICAgZHVwCiAgICBndHhucyBUeXBlRW51bQogICAgaW50IHBheQogICAgPT0KICAgIGFzc2VydCAvLyB0cmFuc2FjdGlvbiB0eXBlIGlzIHBheQogICAgZHVwCiAgICBndHhucyBTZW5kZXIKICAgIGZyYW1lX2RpZyAtMQogICAgPT0KICAgIC8vIHVzci9sb2NhbC9saWIvcHl0aG9uMy4xMi9zaXRlLXBhY2thZ2VzL29wZW5zdWJtYXJpbmUvdXRpbHMvYWxnb3JhbmQucHk6MjctMjkKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgZ3R4bi5QYXltZW50VHJhbnNhY3Rpb24ocGF5bWVudF9ncm91cF9pbmRleCkuc2VuZGVyID09IHdobwogICAgLy8gKSwgInBheW1lbnQgc2VuZGVyIGFjY3VyYXRlIgogICAgYXNzZXJ0IC8vIHBheW1lbnQgc2VuZGVyIGFjY3VyYXRlCiAgICAvLyB1c3IvbG9jYWwvbGliL3B5dGhvbjMuMTIvc2l0ZS1wYWNrYWdlcy9vcGVuc3VibWFyaW5lL3V0aWxzL2FsZ29yYW5kLnB5OjMxCiAgICAvLyBndHhuLlBheW1lbnRUcmFuc2FjdGlvbihwYXltZW50X2dyb3VwX2luZGV4KS5yZWNlaXZlcgogICAgZHVwCiAgICBndHhucyBSZWNlaXZlcgogICAgLy8gdXNyL2xvY2FsL2xpYi9weXRob24zLjEyL3NpdGUtcGFja2FnZXMvb3BlbnN1Ym1hcmluZS91dGlscy9hbGdvcmFuZC5weTozMgogICAgLy8gPT0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgZ2xvYmFsIEN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MKICAgIC8vIHVzci9sb2NhbC9saWIvcHl0aG9uMy4xMi9zaXRlLXBhY2thZ2VzL29wZW5zdWJtYXJpbmUvdXRpbHMvYWxnb3JhbmQucHk6MzEtMzIKICAgIC8vIGd0eG4uUGF5bWVudFRyYW5zYWN0aW9uKHBheW1lbnRfZ3JvdXBfaW5kZXgpLnJlY2VpdmVyCiAgICAvLyA9PSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICA9PQogICAgLy8gdXNyL2xvY2FsL2xpYi9weXRob24zLjEyL3NpdGUtcGFja2FnZXMvb3BlbnN1Ym1hcmluZS91dGlscy9hbGdvcmFuZC5weTozMC0zMwogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBndHhuLlBheW1lbnRUcmFuc2FjdGlvbihwYXltZW50X2dyb3VwX2luZGV4KS5yZWNlaXZlcgogICAgLy8gICAgID09IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICksICJwYXltZW50IHJlY2VpdmVyIGFjY3VyYXRlIgogICAgYXNzZXJ0IC8vIHBheW1lbnQgcmVjZWl2ZXIgYWNjdXJhdGUKICAgIC8vIHVzci9sb2NhbC9saWIvcHl0aG9uMy4xMi9zaXRlLXBhY2thZ2VzL29wZW5zdWJtYXJpbmUvdXRpbHMvYWxnb3JhbmQucHk6MzQKICAgIC8vIHJldHVybiBndHhuLlBheW1lbnRUcmFuc2FjdGlvbihwYXltZW50X2dyb3VwX2luZGV4KS5hbW91bnQKICAgIGd0eG5zIEFtb3VudAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuZ2V0X21hcmtldCh0b2tlbl9pZDogYnl0ZXMpIC0+IGJ5dGVzOgpnZXRfbWFya2V0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjY0LTEyNjUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyNjYKICAgIC8vIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgY2FsbHN1YiBfZ2V0X21hcmtldAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQ6IGJ5dGVzKSAtPiBieXRlczoKZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXA6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyODAtMTI4MQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIHByb3RvIDEgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjgyCiAgICAvLyByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkOiB1aW50NjQpIC0+IGJ5dGVzOgpfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXA6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyODQtMTI4NQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICBwcm90byAxIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMy0xMjg2CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIGZyYW1lX2RpZyAtMQogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIzCiAgICAvLyBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgYnl0ZSAibWFya2V0X3RyYW5zYWN0aW9uX2NhcHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjMtMTI4NgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyODYKICAgIC8vIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICBieiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZWxzZV9ib2R5QDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI4NwogICAgLy8gcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICBmcmFtZV9kaWcgMAogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgZW50cnkgZXhpc3RzCiAgICBzd2FwCiAgICByZXRzdWIKCl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9lbHNlX2JvZHlAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI4OQogICAgLy8gYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIGJ5dGUgMHg3MwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMjkwCiAgICAvLyBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIEJveCBleGlzdHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI5MS0xMjkzCiAgICAvLyBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyApCiAgICBpdHhuX2JlZ2luCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIG1ldGhvZCAiZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCgpKHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYpIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGR1cAogICAgZXh0cmFjdCA0IDAKICAgIHN3YXAKICAgIGV4dHJhY3QgMCA0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgID09CiAgICBhc3NlcnQgLy8gQVJDNCBwcmVmaXggaXMgdmFsaWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI5NAogICAgLy8gcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIHN3YXAKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLmdldF91c2VyX2NhcCh1c2VyX2lkOiBieXRlcykgLT4gYnl0ZXM6CmdldF91c2VyX2NhcDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTI5Ni0xMjk3CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEyOTgKICAgIC8vIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2dldF91c2VyX2NhcAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2dldF91c2VyX2NhcCh1c2VyX2lkOiBieXRlcykgLT4gYnl0ZXM6Cl9nZXRfdXNlcl9jYXA6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMDAtMTMwMQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICBwcm90byAxIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyNgogICAgLy8gc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgYnl0ZSAidXNlcl9jYXBzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDI2LTEzMDIKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgZnJhbWVfZGlnIC0xCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMDIKICAgIC8vIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICBieiBfZ2V0X3VzZXJfY2FwX2Vsc2VfYm9keUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMDMKICAgIC8vIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgZnJhbWVfZGlnIDAKICAgIGJveF9nZXQKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnVzZXJfY2FwcyBlbnRyeSBleGlzdHMKICAgIHN3YXAKICAgIHJldHN1YgoKX2dldF91c2VyX2NhcF9lbHNlX2JvZHlAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMwNQogICAgLy8gYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIGJ5dGUgMHg3MwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzA2CiAgICAvLyBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIEJveCBleGlzdHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMwNy0xMzA5CiAgICAvLyB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgbWV0aG9kICJnZXRfdXNlcl9jYXBfZGVmYXVsdCgpKHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQ2NCkiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZHVwCiAgICBleHRyYWN0IDQgMAogICAgc3dhcAogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzEwCiAgICAvLyByZXR1cm4gdXNlcl9jYXAKICAgIHN3YXAKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLnNldF91c2VyX2NhcCh1c2VyX2lkOiBieXRlcywgdXNlcl9jYXA6IGJ5dGVzKSAtPiB2b2lkOgpzZXRfdXNlcl9jYXA6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMTItMTMxMwogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMxNAogICAgLy8gc2VsZi5fb25seV9vd25lcigpCiAgICBjYWxsc3ViIF9vbmx5X293bmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMTUKICAgIC8vIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfc2V0X3VzZXJfY2FwCiAgICBmcmFtZV9idXJ5IC0xCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fc2V0X3VzZXJfY2FwKHVzZXJfaWQ6IGJ5dGVzLCB1c2VyX2NhcDogYnl0ZXMpIC0+IGJ5dGVzOgpfc2V0X3VzZXJfY2FwOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzE3LTEzMTgKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDI2CiAgICAvLyBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICBieXRlICJ1c2VyX2NhcHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMTkKICAgIC8vIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICBmcmFtZV9kaWcgLTIKICAgIGNvbmNhdAogICAgZnJhbWVfZGlnIC0xCiAgICBib3hfcHV0CiAgICBmcmFtZV9kaWcgLTEKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLnNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkOiBieXRlcywgdHJhbnNhY3Rpb25fY2FwOiBieXRlcykgLT4gdm9pZDoKc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXA6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMjItMTMyNQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMyNgogICAgLy8gc2VsZi5fb25seV9vd25lcigpCiAgICBjYWxsc3ViIF9vbmx5X293bmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzMjcKICAgIC8vIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICBmcmFtZV9idXJ5IC0xCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQ6IHVpbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBieXRlcykgLT4gYnl0ZXM6Cl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMyOS0xMzMyCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAyIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTMzMwogICAgLy8gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICBmcmFtZV9kaWcgLTIKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMwogICAgLy8gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIGJ5dGUgIm1hcmtldF90cmFuc2FjdGlvbl9jYXBzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzMzCiAgICAvLyBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIHN3YXAKICAgIGNvbmNhdAogICAgZnJhbWVfZGlnIC0xCiAgICBib3hfcHV0CiAgICBmcmFtZV9kaWcgLTEKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLmdldF9wcmljZV9mZWVkKHRva2VuX2lkOiBieXRlcykgLT4gYnl0ZXM6CmdldF9wcmljZV9mZWVkOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzU2LTEzNTcKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNTgKICAgIC8vIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ0b2kKICAgIGNhbGxzdWIgX2dldF9wcmljZV9mZWVkCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQ6IHVpbnQ2NCkgLT4gYnl0ZXM6Cl9nZXRfcHJpY2VfZmVlZDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM2MC0xMzYxCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICBwcm90byAxIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyNy0xMzYyCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9kYXRhLnByaWNlID09IG1hcmtldC5wcmljZSwgIlByaWNlIG1pc21hdGNoIgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc3VtZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIGZyYW1lX2RpZyAtMQogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDI3CiAgICAvLyBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgYnl0ZSAicHJpY2VfZmVlZHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjctMTM2MgogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEzNjIKICAgIC8vIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICBieiBfZ2V0X3ByaWNlX2ZlZWRfZWxzZV9ib2R5QDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM2MwogICAgLy8gcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICBmcmFtZV9kaWcgMAogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYucHJpY2VfZmVlZHMgZW50cnkgZXhpc3RzCiAgICBzd2FwCiAgICByZXRzdWIKCl9nZXRfcHJpY2VfZmVlZF9lbHNlX2JvZHlAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM2NQogICAgLy8gYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIGJ5dGUgMHg3MwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzY2CiAgICAvLyBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIEJveCBleGlzdHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTM2Ny0xMzY5CiAgICAvLyBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyApCiAgICBpdHhuX2JlZ2luCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIG1ldGhvZCAiZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCgpKHVpbnQ2NCx1aW50NjQsKHVpbnQyNTYsdWludDY0KSkiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZHVwCiAgICBleHRyYWN0IDQgMAogICAgc3dhcAogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMzcwCiAgICAvLyByZXR1cm4gcHJpY2VfZmVlZAogICAgc3dhcAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuZmV0Y2hfcHJpY2VfZmVlZCh0b2tlbl9pZDogYnl0ZXMpIC0+IHZvaWQ6CmZldGNoX3ByaWNlX2ZlZWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NDAtMTQ0MQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAxIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ0MgogICAgLy8gYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIGNhbGxzdWIgX2lzX3BhdXNlZAogICAgIQogICAgYXNzZXJ0IC8vIFByb3RvY29sIGlzIHBhdXNlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDQzCiAgICAvLyBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgY2FsbHN1YiBfZmV0Y2hfcHJpY2VfZmVlZAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQ6IHVpbnQ2NCkgLT4gdm9pZDoKX2ZldGNoX3ByaWNlX2ZlZWQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NDUtMTQ0NgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgcHJvdG8gMSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAtMTQ0NwogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBkZWwgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWREZXRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgICMgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIGFzc2VydCBwcmljZSA+IDAsICJQcmljZSBtdXN0IGJlIHBvc2l0aXZlIgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgVW5wYXVzZSB0aGUgbWFya2V0IG9uIGZpcnN0IHByaWNlIHNldAogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQgYW5kIG1hcmtldC5wcmljZSA9PSAwOgogICAgLy8gICAgICAgICBtYXJrZXQucGF1c2VkID0gYXJjNC5Cb29sKEZhbHNlKQogICAgLy8gCiAgICAvLyAgICAgIyBTY2FsZSB0aGUgcHJpY2UgYnkgU0NBTEUgaW50ZXJuYWxseSBmb3Igc3RvcmFnZQogICAgLy8gICAgIG1hcmtldC5wcmljZSA9IGFyYzQuVUludDI1NihwcmljZSAqIFNDQUxFKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFByaWNlU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KHByaWNlKSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgc2VsZi5fZmV0Y2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2ZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgZnJhbWVfZGlnIC0xCiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAKICAgIC8vIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgYnl0ZSAibWFya2V0cyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMC0xNDQ3CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9kYXRhLnByaWNlID09IG1hcmtldC5wcmljZSwgIlByaWNlIG1pc21hdGNoIgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc3VtZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXSA9IFByaWNlRmVlZCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wPVByaWNlV2l0aFRpbWVzdGFtcCgKICAgIC8vICAgICAgICAgICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICksCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZEF0dGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZC5uYXRpdmUsIHByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcmljZTogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgIyBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBkaWcgMQogICAgY29uY2F0CiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ0NwogICAgLy8gYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGFzc2VydCAvLyBNYXJrZXQgZG9lcyBub3QgZXhpc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyNwogICAgLy8gc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIGJ5dGUgInByaWNlX2ZlZWRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDI3LTE0NDgKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICAjIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIC8vICAgICAgICAgbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgU2NhbGUgdGhlIHByaWNlIGJ5IFNDQUxFIGludGVybmFsbHkgZm9yIHN0b3JhZ2UKICAgIC8vICAgICBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRQcmljZVNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihwcmljZSkpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBmZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9mZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgZGlnIDEKICAgIGNvbmNhdAogICAgZHVwCiAgICBjb3ZlciAyCiAgICBkdXAKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDQ4CiAgICAvLyBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgYXNzZXJ0IC8vIFByaWNlIGZlZWQgbm90IGF0dGFjaGVkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NDkKICAgIC8vIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIHR4biBTZW5kZXIKICAgIGNhbGxzdWIgcmVxdWlyZV9wYXltZW50CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NTAKICAgIC8vIGFzc2VydCBwYXltZW50ID49IDEwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS01CiAgICBkdXAKICAgIGludCAxMDAwMDAKICAgID49CiAgICBhc3NlcnQgLy8gaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGZldGNoIHByaWNlIGZlZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ1MgogICAgLy8gcGF5bWVudCA8PSAxMDAwMDAwCiAgICBkdXAKICAgIGludCAxMDAwMDAwCiAgICA8PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDUxLTE0NTMKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgcGF5bWVudCA8PSAxMDAwMDAwCiAgICAvLyApLCAicGF5bWVudCBleGNlZWRzIG1heGltdW0gZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTYKICAgIGFzc2VydCAvLyBwYXltZW50IGV4Y2VlZHMgbWF4aW11bSBmb3IgZmV0Y2ggcHJpY2UgZmVlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDU0CiAgICAvLyBhcHAgPSBBcHBsaWNhdGlvbihzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgZGlnIDEKICAgIGJveF9nZXQKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnByaWNlX2ZlZWRzIGVudHJ5IGV4aXN0cwogICAgZXh0cmFjdCA4IDggLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NTUKICAgIC8vIGl0eG4uUGF5bWVudChyZWNlaXZlcj1hcHAuYWRkcmVzcywgYW1vdW50PXBheW1lbnQsIGZlZT0wKS5zdWJtaXQoKQogICAgaXR4bl9iZWdpbgogICAgZHVwCiAgICBhcHBfcGFyYW1zX2dldCBBcHBBZGRyZXNzCiAgICBhc3NlcnQgLy8gYXBwbGljYXRpb24gZXhpc3RzCiAgICB1bmNvdmVyIDIKICAgIGl0eG5fZmllbGQgQW1vdW50CiAgICBpdHhuX2ZpZWxkIFJlY2VpdmVyCiAgICBpbnQgcGF5CiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NTYtMTQ2MAogICAgLy8gcHJpY2Vfd2l0aF90aW1lc3RhbXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgUHJpY2VGZWVkUHJvdmlkZXJJbnRlcmZhY2UuZ2V0X3ByaWNlX3dpdGhfdGltZXN0YW1wLAogICAgLy8gICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICBhcHBfaWQ9YXBwLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICBtZXRob2QgImdldF9wcmljZV93aXRoX3RpbWVzdGFtcCh1aW50NjQpKHVpbnQyNTYsdWludDY0KSIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBzd2FwCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZHVwCiAgICBleHRyYWN0IDQgMAogICAgZHVwCiAgICBjb3ZlciAyCiAgICBjb3ZlciAzCiAgICBleHRyYWN0IDAgNAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICA9PQogICAgYXNzZXJ0IC8vIEFSQzQgcHJlZml4IGlzIHZhbGlkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NjIKICAgIC8vIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIGV4dHJhY3QgMzIgOCAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ2MwogICAgLy8gPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICBzd2FwCiAgICBib3hfZ2V0CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5wcmljZV9mZWVkcyBlbnRyeSBleGlzdHMKICAgIGV4dHJhY3QgMTYgNDAgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBleHRyYWN0IDMyIDggLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NjItMTQ2MwogICAgLy8gcHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICA+CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NjEtMTQ2NAogICAgLy8gaWYgKAogICAgLy8gICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICA+IHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICk6CiAgICBieiBfZmV0Y2hfcHJpY2VfZmVlZF9hZnRlcl9pZl9lbHNlQDQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ2NQogICAgLy8gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICBmcmFtZV9kaWcgMAogICAgZHVwCiAgICBib3hfZ2V0CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5wcmljZV9mZWVkcyBlbnRyeSBleGlzdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ2NS0xNDY3CiAgICAvLyBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcCA9ICgKICAgIC8vICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC5jb3B5KCkKICAgIC8vICkKICAgIGZyYW1lX2RpZyAxCiAgICBkdXAKICAgIGNvdmVyIDIKICAgIHJlcGxhY2UyIDE2CiAgICB1bmNvdmVyIDIKICAgIHN3YXAKICAgIGJveF9wdXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ2OAogICAgLy8gc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZCwgcHJpY2Vfd2l0aF90aW1lc3RhbXAucHJpY2UubmF0aXZlKQogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIC0xCiAgICBzd2FwCiAgICBjYWxsc3ViIF9zZXRfbWFya2V0X3ByaWNlCgpfZmV0Y2hfcHJpY2VfZmVlZF9hZnRlcl9pZl9lbHNlQDQ6CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5wYXVzZV9tYXJrZXQodG9rZW5faWQ6IGJ5dGVzLCBwYXVzZTogYnl0ZXMpIC0+IHZvaWQ6CnBhdXNlX21hcmtldDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUyMC0xNTIxCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUyMgogICAgLy8gc2VsZi5fb25seV9vd25lcigpCiAgICBjYWxsc3ViIF9vbmx5X293bmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MjMKICAgIC8vIHNlbGYuX3BhdXNlX21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIHBhdXNlLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMgogICAgYnRvaQogICAgZnJhbWVfZGlnIC0xCiAgICBidG9pCiAgICBjYWxsc3ViIF9wYXVzZV9tYXJrZXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9wYXVzZV9tYXJrZXQodG9rZW5faWQ6IHVpbnQ2NCwgcGF1c2U6IHVpbnQ2NCkgLT4gdm9pZDoKX3BhdXNlX21hcmtldDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUyNS0xNTI2CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9wYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIwLTE1MjcKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICAjIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIC8vICAgICAgICAgbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgU2NhbGUgdGhlIHByaWNlIGJ5IFNDQUxFIGludGVybmFsbHkgZm9yIHN0b3JhZ2UKICAgIC8vICAgICBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRQcmljZVNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihwcmljZSkpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBmZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9mZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAxMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHBheW1lbnQgPD0gMTAwMDAwMAogICAgLy8gICAgICksICJwYXltZW50IGV4Y2VlZHMgbWF4aW11bSBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNgogICAgLy8gICAgIGFwcCA9IEFwcGxpY2F0aW9uKHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAgICAgaXR4bi5QYXltZW50KHJlY2VpdmVyPWFwcC5hZGRyZXNzLCBhbW91bnQ9cGF5bWVudCwgZmVlPTApLnN1Ym1pdCgpCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFByaWNlRmVlZFByb3ZpZGVySW50ZXJmYWNlLmdldF9wcmljZV93aXRoX3RpbWVzdGFtcCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICAgICAgPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgKToKICAgIC8vICAgICAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICAvLyAgICAgICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC5jb3B5KCkKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLCBwcmljZV93aXRoX3RpbWVzdGFtcC5wcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3BhdXNlX21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIHBhdXNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGZyYW1lX2RpZyAtMgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIwCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAtMTUyNwogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBkZWwgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWREZXRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgICMgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIGFzc2VydCBwcmljZSA+IDAsICJQcmljZSBtdXN0IGJlIHBvc2l0aXZlIgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgVW5wYXVzZSB0aGUgbWFya2V0IG9uIGZpcnN0IHByaWNlIHNldAogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQgYW5kIG1hcmtldC5wcmljZSA9PSAwOgogICAgLy8gICAgICAgICBtYXJrZXQucGF1c2VkID0gYXJjNC5Cb29sKEZhbHNlKQogICAgLy8gCiAgICAvLyAgICAgIyBTY2FsZSB0aGUgcHJpY2UgYnkgU0NBTEUgaW50ZXJuYWxseSBmb3Igc3RvcmFnZQogICAgLy8gICAgIG1hcmtldC5wcmljZSA9IGFyYzQuVUludDI1NihwcmljZSAqIFNDQUxFKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFByaWNlU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KHByaWNlKSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgc2VsZi5fZmV0Y2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2ZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDEwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS01CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgcGF5bWVudCA8PSAxMDAwMDAwCiAgICAvLyAgICAgKSwgInBheW1lbnQgZXhjZWVkcyBtYXhpbXVtIGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS02CiAgICAvLyAgICAgYXBwID0gQXBwbGljYXRpb24oc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vICAgICBpdHhuLlBheW1lbnQocmVjZWl2ZXI9YXBwLmFkZHJlc3MsIGFtb3VudD1wYXltZW50LCBmZWU9MCkuc3VibWl0KCkKICAgIC8vICAgICBwcmljZV93aXRoX3RpbWVzdGFtcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgUHJpY2VGZWVkUHJvdmlkZXJJbnRlcmZhY2UuZ2V0X3ByaWNlX3dpdGhfdGltZXN0YW1wLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIGlmICgKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICAgICA+IHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICApOgogICAgLy8gICAgICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcCA9ICgKICAgIC8vICAgICAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLmNvcHkoKQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQsIHByaWNlX3dpdGhfdGltZXN0YW1wLnByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fcGF1c2VfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgcGF1c2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9wYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgc3dhcAogICAgY29uY2F0CiAgICBkdXAKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTI3CiAgICAvLyBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgYXNzZXJ0IC8vIE1hcmtldCBkb2VzIG5vdCBleGlzdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTI4CiAgICAvLyBzZWxmLm1hcmtldHNbdG9rZW5faWRdLnBhdXNlZCA9IGFyYzQuQm9vbChwYXVzZSA9PSBVSW50NjQoMSkpCiAgICBmcmFtZV9kaWcgLTEKICAgIGludCAxCiAgICA9PQogICAgYnl0ZSAweDAwCiAgICBpbnQgMAogICAgdW5jb3ZlciAyCiAgICBzZXRiaXQKICAgIGRpZyAxCiAgICBib3hfZ2V0CiAgICBzd2FwCiAgICBjb3ZlciAyCiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5tYXJrZXRzIGVudHJ5IGV4aXN0cwogICAgaW50IDAKICAgIGdldGJpdAogICAgaW50IDAKICAgIHN3YXAKICAgIHNldGJpdAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuc3luY19tYXJrZXQobWFya2V0X2lkOiBieXRlcykgLT4gdm9pZDoKc3luY19tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MzAtMTUzMQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY19tYXJrZXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIHByb3RvIDEgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTMyCiAgICAvLyBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgY2FsbHN1YiBfYWNjcnVlX2ludGVyZXN0CiAgICBwb3AKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkOiB1aW50NjQpIC0+IGJ5dGVzOgpfYWNjcnVlX2ludGVyZXN0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTM0LTE1MzUKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2FjY3J1ZV9pbnRlcmVzdChzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIHByb3RvIDEgMQogICAgaW50IDAKICAgIGR1cG4gNgogICAgYnl0ZSAiIgogICAgZHVwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MzYKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICBkdXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUzNwogICAgLy8gaWYgbWFya2V0LnBhdXNlZDoKICAgIGludCAwCiAgICBnZXRiaXQKICAgIGJ5dGUgMHgwMAogICAgaW50IDAKICAgIHVuY292ZXIgMgogICAgc2V0Yml0CiAgICBieXRlIDB4MDAKICAgICE9CiAgICBieiBfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTM4CiAgICAvLyByZXR1cm4gbWFya2V0CiAgICBmcmFtZV9kaWcgOQogICAgZnJhbWVfYnVyeSAwCiAgICByZXRzdWIKCl9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTQwCiAgICAvLyBjdXJyZW50X3RpbWUgPSBHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcAogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgZHVwCiAgICBmcmFtZV9idXJ5IDcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU0MQogICAgLy8gdGltZV9kZWx0YSA9IGN1cnJlbnRfdGltZSAtIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lLm5hdGl2ZQogICAgZnJhbWVfZGlnIDkKICAgIGV4dHJhY3QgMjQxIDggLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICAtCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgOAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTQyCiAgICAvLyBpZiB0aW1lX2RlbHRhIDw9IDA6CiAgICBpbnQgMAogICAgPD0KICAgIGJ6IF9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUA0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NDMKICAgIC8vIHJldHVybiBtYXJrZXQKICAgIGZyYW1lX2RpZyA5CiAgICBmcmFtZV9idXJ5IDAKICAgIHJldHN1YgoKX2FjY3J1ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NDUtMTU0NgogICAgLy8gIyBGb3Igc3Rva2VuIG1hcmtldCAoYm9ycm93LW9ubHkpLCB1c2UgYSBmaXhlZCB1dGlsaXphdGlvbiByYXRlIHNpbmNlIHRoZXJlIGFyZSBubyBkZXBvc2l0cwogICAgLy8gaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMTgKICAgIC8vIHNlbGYuc3Rva2VuX2FwcF9pZCA9IFVJbnQ2NCgpICAjIHN0YWJsZSBtYXJrZXQKICAgIGJ5dGUgInN0b2tlbl9hcHBfaWQiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NDUtMTU0NgogICAgLy8gIyBGb3Igc3Rva2VuIG1hcmtldCAoYm9ycm93LW9ubHkpLCB1c2UgYSBmaXhlZCB1dGlsaXphdGlvbiByYXRlIHNpbmNlIHRoZXJlIGFyZSBubyBkZXBvc2l0cwogICAgLy8gaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5zdG9rZW5fYXBwX2lkIGV4aXN0cwogICAgZnJhbWVfZGlnIC0xCiAgICA9PQogICAgYnogX2FjY3J1ZV9pbnRlcmVzdF9lbHNlX2JvZHlANgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTQ3CiAgICAvLyB1dGlsaXphdGlvbiA9IEJpZ1VJbnQoMTAwMDApICAjIDEwMCUgdXRpbGl6YXRpb24gZm9yIGJvcnJvdy1vbmx5IG1hcmtldAogICAgYnl0ZSAweDI3MTAKICAgIGIgX2FjY3J1ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDEwCgpfYWNjcnVlX2ludGVyZXN0X2Vsc2VfYm9keUA2OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTQ4CiAgICAvLyBlbGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICBmcmFtZV9kaWcgOQogICAgZXh0cmFjdCAxMTMgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgNgogICAgYnl0ZSAweAogICAgYj09CiAgICBieiBfYWNjcnVlX2ludGVyZXN0X2Vsc2VfYm9keUA4CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NDkKICAgIC8vIHJldHVybiBtYXJrZXQKICAgIGZyYW1lX2RpZyA5CiAgICBmcmFtZV9idXJ5IDAKICAgIHJldHN1YgoKX2FjY3J1ZV9pbnRlcmVzdF9lbHNlX2JvZHlAODoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU1MgogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIDEwMDAwCiAgICBmcmFtZV9kaWcgOQogICAgZXh0cmFjdCAxNDUgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBieXRlIDB4MjcxMAogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU1MS0xNTUzCiAgICAvLyB1dGlsaXphdGlvbiA9ICgKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDAKICAgIC8vICkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIGZyYW1lX2RpZyA2CiAgICBiLwoKX2FjY3J1ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDEwOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTU0CiAgICAvLyByYXRlID0gbWFya2V0LmJvcnJvd19yYXRlLm5hdGl2ZSArIChtYXJrZXQuc2xvcGUubmF0aXZlICogdXRpbGl6YXRpb24pIC8vIDEwMDAwCiAgICBmcmFtZV9kaWcgOQogICAgZHVwCiAgICBleHRyYWN0IDk3IDggLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICBpdG9iCiAgICBzd2FwCiAgICBkdXAKICAgIGV4dHJhY3QgMTA1IDggLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICBpdG9iCiAgICB1bmNvdmVyIDMKICAgIGIqCiAgICBieXRlIDB4MjcxMAogICAgYi8KICAgIHVuY292ZXIgMgogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU1NQogICAgLy8gaW50ZXJlc3QgPSAocmF0ZSAqIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB0aW1lX2RlbHRhKSAvLyAoCiAgICBzd2FwCiAgICBleHRyYWN0IDE0NSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGIqCiAgICBmcmFtZV9kaWcgOAogICAgaXRvYgogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU1NgogICAgLy8gc2VsZi5zZWNvbmRzX3Blcl95ZWFyICogMTAwMDAKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMTkKICAgIC8vIHNlbGYuc2Vjb25kc19wZXJfeWVhciA9IFVJbnQ2NCgpICAjIHNlY29uZHMgcGVyIHllYXIKICAgIGJ5dGUgInNlY29uZHNfcGVyX3llYXIiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NTYKICAgIC8vIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYuc2Vjb25kc19wZXJfeWVhciBleGlzdHMKICAgIGludCAxMDAwMAogICAgKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTU1LTE1NTcKICAgIC8vIGludGVyZXN0ID0gKHJhdGUgKiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdGltZV9kZWx0YSkgLy8gKAogICAgLy8gICAgIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICAvLyApCiAgICBpdG9iCiAgICBiLwogICAgZnJhbWVfYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NTktMTU2MAogICAgLy8gIyBTcGVjaWFsIGhhbmRsaW5nIGZvciBzdG9rZW4gbWFya2V0IC0gYWxsIGludGVyZXN0IGdvZXMgdG8gcmVzZXJ2ZXMKICAgIC8vIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDE4CiAgICAvLyBzZWxmLnN0b2tlbl9hcHBfaWQgPSBVSW50NjQoKSAgIyBzdGFibGUgbWFya2V0CiAgICBieXRlICJzdG9rZW5fYXBwX2lkIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTU5LTE1NjAKICAgIC8vICMgU3BlY2lhbCBoYW5kbGluZyBmb3Igc3Rva2VuIG1hcmtldCAtIGFsbCBpbnRlcmVzdCBnb2VzIHRvIHJlc2VydmVzCiAgICAvLyBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnN0b2tlbl9hcHBfaWQgZXhpc3RzCiAgICBmcmFtZV9kaWcgLTEKICAgID09CiAgICBieiBfYWNjcnVlX2ludGVyZXN0X2Vsc2VfYm9keUAxMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTYyCiAgICAvLyBkZXBvc2l0b3JfcG9ydGlvbiA9IEJpZ1VJbnQoMCkKICAgIGJ5dGUgMHgKICAgIGZyYW1lX2J1cnkgMAogICAgZnJhbWVfZGlnIDEKICAgIGZyYW1lX2J1cnkgMwogICAgYiBfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMTUKCl9hY2NydWVfaW50ZXJlc3RfZWxzZV9ib2R5QDEyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTY1CiAgICAvLyBpbnRlcmVzdCAqIGFyYzQuVUludDI1Ni5mcm9tX2J5dGVzKG1hcmtldC5yZXNlcnZlX2ZhY3Rvci5ieXRlcykubmF0aXZlCiAgICBmcmFtZV9kaWcgOQogICAgZXh0cmFjdCA4OSA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIDEKICAgIGR1cAogICAgdW5jb3ZlciAyCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTY2CiAgICAvLyApIC8vIDEwMDAwCiAgICBieXRlIDB4MjcxMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTY0LTE1NjYKICAgIC8vIHByb3RvY29sX3BvcnRpb24gPSAoCiAgICAvLyAgICAgaW50ZXJlc3QgKiBhcmM0LlVJbnQyNTYuZnJvbV9ieXRlcyhtYXJrZXQucmVzZXJ2ZV9mYWN0b3IuYnl0ZXMpLm5hdGl2ZQogICAgLy8gKSAvLyAxMDAwMAogICAgYi8KICAgIGR1cAogICAgZnJhbWVfYnVyeSAzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NjcKICAgIC8vIGlmIHByb3RvY29sX3BvcnRpb24gPiBpbnRlcmVzdDoKICAgIGI8CiAgICBieiBfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMTQKICAgIGZyYW1lX2RpZyAxCiAgICBmcmFtZV9idXJ5IDMKCl9hY2NydWVfaW50ZXJlc3RfYWZ0ZXJfaWZfZWxzZUAxNDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU2OQogICAgLy8gZGVwb3NpdG9yX3BvcnRpb24gPSBpbnRlcmVzdCAtIHByb3RvY29sX3BvcnRpb24KICAgIGZyYW1lX2RpZyAxCiAgICBmcmFtZV9kaWcgMwogICAgYi0KICAgIGZyYW1lX2J1cnkgMAoKX2FjY3J1ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDE1OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTcxCiAgICAvLyBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID4gMDoKICAgIGZyYW1lX2RpZyA5CiAgICBkdXAKICAgIGV4dHJhY3QgMTEzIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDQKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICBiPgogICAgc3dhcAogICAgZnJhbWVfYnVyeSAyCiAgICBieiBfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMTcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU3MwogICAgLy8gbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICBmcmFtZV9kaWcgOQogICAgZHVwCiAgICBleHRyYWN0IDE3NyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU3NAogICAgLy8gKyAoZGVwb3NpdG9yX3BvcnRpb24gKiBTQ0FMRSkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIGZyYW1lX2RpZyAwCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYioKICAgIGZyYW1lX2RpZyA0CiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTczLTE1NzQKICAgIC8vIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gKyAoZGVwb3NpdG9yX3BvcnRpb24gKiBTQ0FMRSkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NzItMTU3NQogICAgLy8gbWFya2V0LmRlcG9zaXRfaW5kZXggPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKyAoZGVwb3NpdG9yX3BvcnRpb24gKiBTQ0FMRSkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXBsYWNlMiAxNzcKICAgIGZyYW1lX2J1cnkgMgoKX2FjY3J1ZV9pbnRlcmVzdF9hZnRlcl9pZl9lbHNlQDE3OgogICAgZnJhbWVfZGlnIDIKICAgIGR1cAogICAgZnJhbWVfYnVyeSA5CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1NzYKICAgIC8vIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA+IDA6CiAgICBkdXAKICAgIGV4dHJhY3QgMTQ1IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDUKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICBiPgogICAgc3dhcAogICAgZnJhbWVfYnVyeSAyCiAgICBieiBfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMTkKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU3OAogICAgLy8gbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyA5CiAgICBkdXAKICAgIGV4dHJhY3QgMjA5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTc5CiAgICAvLyArIChpbnRlcmVzdCAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICBmcmFtZV9kaWcgMQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIqCiAgICBmcmFtZV9kaWcgNQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU3OC0xNTc5CiAgICAvLyBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gKyAoaW50ZXJlc3QgKiBTQ0FMRSkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU3Ny0xNTgwCiAgICAvLyBtYXJrZXQuYm9ycm93X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKyAoaW50ZXJlc3QgKiBTQ0FMRSkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gKQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDIwOQogICAgZnJhbWVfYnVyeSAyCgpfYWNjcnVlX2ludGVyZXN0X2FmdGVyX2lmX2Vsc2VAMTk6CiAgICBmcmFtZV9kaWcgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTgzCiAgICAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgaW50ZXJlc3QKICAgIGR1cAogICAgZXh0cmFjdCAxNDUgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgMQogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU4Mi0xNTg0CiAgICAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGludGVyZXN0CiAgICAvLyApCiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBkdXAKICAgIGNvdmVyIDMKICAgIGJ8CiAgICByZXBsYWNlMiAxNDUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU4NgogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBkZXBvc2l0b3JfcG9ydGlvbgogICAgZHVwCiAgICBleHRyYWN0IDExMyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAwCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTg1LTE1ODcKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBkZXBvc2l0b3JfcG9ydGlvbgogICAgLy8gKQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgZGlnIDIKICAgIGJ8CiAgICByZXBsYWNlMiAxMTMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU4OAogICAgLy8gbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgKyBwcm90b2NvbF9wb3J0aW9uKQogICAgZHVwCiAgICBleHRyYWN0IDI0OSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAzCiAgICBiKwogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgdW5jb3ZlciAyCiAgICBifAogICAgcmVwbGFjZTIgMjQ5CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1ODkKICAgIC8vIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoY3VycmVudF90aW1lKQogICAgZnJhbWVfZGlnIDcKICAgIGl0b2IKICAgIHJlcGxhY2UyIDI0MQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTkxCiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIGZyYW1lX2RpZyAtMQogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIwCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1OTEKICAgIC8vIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgc3dhcAogICAgY29uY2F0CiAgICBkaWcgMQogICAgYm94X3B1dAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTkyCiAgICAvLyByZXR1cm4gbWFya2V0LmNvcHkoKQogICAgZnJhbWVfYnVyeSAwCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC53aXRoZHJhd19yZXNlcnZlcyhtYXJrZXRfaWQ6IGJ5dGVzLCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgp3aXRoZHJhd19yZXNlcnZlczoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYwMS0xNjAzCiAgICAvLyAjIFJFTSBpbnRlbnRpb25hbGx5IHNraXBwaW5nIHN1YnJvdXRpbmUgdG8gcmVkdWNlIGNvbnRyYWN0IHNpemUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHdpdGhkcmF3X3Jlc2VydmVzKHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MDQKICAgIC8vIHNlbGYuX29ubHlfb3duZXIoKQogICAgY2FsbHN1YiBfb25seV9vd25lcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjA1CiAgICAvLyBzZWxmLl93aXRoZHJhd19yZXNlcnZlcyhtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX3dpdGhkcmF3X3Jlc2VydmVzCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fd2l0aGRyYXdfcmVzZXJ2ZXMobWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl93aXRoZHJhd19yZXNlcnZlczoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYwNy0xNjA4CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MDkKICAgIC8vIHNlbGYuX29ubHlfb3duZXIoKQogICAgY2FsbHN1YiBfb25seV9vd25lcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjEwCiAgICAvLyBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgY2FsbHN1YiBfaXNfcGF1c2VkCiAgICAhCiAgICBhc3NlcnQgLy8gUHJvdG9jb2wgaXMgcGF1c2VkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MTItMTYxMwogICAgLy8gIyBBY2NydWUgaW50ZXJlc3QgZmlyc3QgdG8gZ2V0IHVwLXRvLWRhdGUgcmVzZXJ2ZXMKICAgIC8vIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2FjY3J1ZV9pbnRlcmVzdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjE0CiAgICAvLyBhc3NlcnQgbWFya2V0LnJlc2VydmVzLm5hdGl2ZSA+PSBhbW91bnQsICJJbnN1ZmZpY2llbnQgcmVzZXJ2ZXMiCiAgICBkdXAKICAgIGV4dHJhY3QgMjQ5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9kaWcgLTEKICAgIGI+PQogICAgYXNzZXJ0IC8vIEluc3VmZmljaWVudCByZXNlcnZlcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjE2LTE2MjIKICAgIC8vICMgVHJhbnNmZXIgcmVzZXJ2ZXMgdG8gdGhlIG93bmVyIChub3QgdG8gdGhlIGNvbnRyYWN0IGl0c2VsZikKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYxOQogICAgLy8gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpLAogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAxNgogICAgLy8gc2VsZi5vd25lciA9IEFjY291bnQoKQogICAgYnl0ZSAib3duZXIiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MTkKICAgIC8vIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSwKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5vd25lciBleGlzdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYyMAogICAgLy8gYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICBmcmFtZV9kaWcgLTEKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBmcmFtZV9kaWcgLTEKICAgIGRpZyAxCiAgICBifAogICAgZnJhbWVfZGlnIC0yCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYxNi0xNjIyCiAgICAvLyAjIFRyYW5zZmVyIHJlc2VydmVzIHRvIHRoZSBvd25lciAobm90IHRvIHRoZSBjb250cmFjdCBpdHNlbGYpCiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICBhcmM0LkFkZHJlc3Moc2VsZi5vd25lciksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyApCiAgICBtZXRob2QgImFyYzIwMF90cmFuc2ZlcihhZGRyZXNzLHVpbnQyNTYpYm9vbCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICB1bmNvdmVyIDIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjI0LTE2MjUKICAgIC8vICMgVXBkYXRlIHJlc2VydmVzCiAgICAvLyBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIHN3YXAKICAgIGZyYW1lX2RpZyAtMQogICAgYi0KICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGJ8CiAgICByZXBsYWNlMiAyNDkKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYyNgogICAgLy8gc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBmcmFtZV9kaWcgLTIKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMAogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjI2CiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIHN3YXAKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuZGVwb3NpdChtYXJrZXRfaWQ6IGJ5dGVzLCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpkZXBvc2l0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjQyLTE2NDMKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRlcG9zaXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY0NAogICAgLy8gc2VsZi5fZGVwb3NpdChUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgdHhuIFNlbmRlcgogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2RlcG9zaXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9kZXBvc2l0KHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2RlcG9zaXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2NTAtMTY1MQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVwb3NpdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgcHJvdG8gMyAwCiAgICBpbnQgMAogICAgZHVwbiA5CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2ODEKICAgIC8vIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgaW50IDEKICAgIGNhbGxzdWIgX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTY4My0xNjg2CiAgICAvLyAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIG1hcmtldF9pZAogICAgLy8gKS5kZXBvc2l0Lm5hdGl2ZQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2ODcKICAgIC8vIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgYnl0ZSAweAogICAgYj4KICAgIGJ6IF9kZXBvc2l0X2FmdGVyX2lmX2Vsc2VAMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjg4CiAgICAvLyBhc3NlcnQgYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJEZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIGZyYW1lX2RpZyAtMQogICAgZnJhbWVfZGlnIDEwCiAgICBiPD0KICAgIGFzc2VydCAvLyBEZXBvc2l0IGNhcCBleGNlZWRlZAoKX2RlcG9zaXRfYWZ0ZXJfaWZfZWxzZUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjkwLTE2OTYKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjkzCiAgICAvLyBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICBnbG9iYWwgQ3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjk0CiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMQogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGR1cAogICAgZnJhbWVfYnVyeSAwCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ8CiAgICBmcmFtZV9kaWcgLTIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjkwLTE2OTYKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgbWV0aG9kICJhcmMyMDBfdHJhbnNmZXJGcm9tKGFkZHJlc3MsYWRkcmVzcyx1aW50MjU2KWJvb2wiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgZnJhbWVfZGlnIC0zCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgc3dhcAogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgaXR4biBMYXN0TG9nCiAgICBleHRyYWN0IDAgNAogICAgYnl0ZSAweDE1MWY3Yzc1CiAgICA9PQogICAgYXNzZXJ0IC8vIEFSQzQgcHJlZml4IGlzIHZhbGlkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2OTgKICAgIC8vIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIGZyYW1lX2J1cnkgOQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjk5LTE3MDEKICAgIC8vIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QoCiAgICAvLyAgICAgbWFya2V0X2lkCiAgICAvLyApICAjIEdldCB1cGRhdGVkIG1hcmtldCB3aXRoIGFjY3J1ZWQgaW50ZXJlc3QKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfYWNjcnVlX2ludGVyZXN0CiAgICBmcmFtZV9idXJ5IDQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcwMwogICAgLy8gaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MDUtMTcwNgogICAgLy8gIyBBZGQgZWFybmVkIGludGVyZXN0IHRvIHVzZXIncyBwb3NpdGlvbiBhcyBhZGRpdGlvbmFsIHNjYWxlZCBkZXBvc2l0cwogICAgLy8gaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCA9IEJpZ1VJbnQoMCkKICAgIGJ5dGUgMHgKICAgIGZyYW1lX2J1cnkgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzA3CiAgICAvLyBpZiBpbnRlcmVzdCA+IDA6CiAgICBieXRlIDB4CiAgICBiPgogICAgYnogX2RlcG9zaXRfYWZ0ZXJfaWZfZWxzZUA1CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MDkKICAgIC8vIGludGVyZXN0ICogU0NBTEUKICAgIGZyYW1lX2RpZyAxCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcxMAogICAgLy8gKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICBmcmFtZV9kaWcgNAogICAgZXh0cmFjdCAxNzcgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MDgtMTcxMAogICAgLy8gaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICAgICBpbnRlcmVzdCAqIFNDQUxFCiAgICAvLyApIC8vIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIGIvCiAgICBmcmFtZV9idXJ5IDIKCl9kZXBvc2l0X2FmdGVyX2lmX2Vsc2VANToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcxMwogICAgLy8gYW1vdW50ICogU0NBTEUKICAgIGZyYW1lX2RpZyAtMQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MTQKICAgIC8vICkgLy8gbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZSAgIyBDYWxjdWxhdGUgd2l0aCBuZXcgaW5kZXgKICAgIGZyYW1lX2RpZyA0CiAgICBkdXAKICAgIGNvdmVyIDIKICAgIGV4dHJhY3QgMTc3IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzEyLTE3MTQKICAgIC8vIHNjYWxlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgYW1vdW50ICogU0NBTEUKICAgIC8vICkgLy8gbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZSAgIyBDYWxjdWxhdGUgd2l0aCBuZXcgaW5kZXgKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MTYKICAgIC8vIHRvdGFsX3NjYWxlZF9hbW91bnQgPSBzY2FsZWRfYW1vdW50ICsgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudAogICAgZnJhbWVfZGlnIDIKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MTkKICAgIC8vIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyA5CiAgICBkdXAKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHN3YXAKICAgIGR1cAogICAgZXh0cmFjdCA2NCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHVuY292ZXIgMgogICAgYioKICAgIGNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcyMwogICAgLy8gbmV3X21hcmtldC5tYXhfdG90YWxfZGVwb3NpdHMubmF0aXZlCiAgICBkaWcgMwogICAgZXh0cmFjdCAxIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzI0CiAgICAvLyA+PSBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyB0b3RhbF9zY2FsZWRfYW1vdW50CiAgICBkaWcgNAogICAgZXh0cmFjdCAxMTMgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkaWcgMwogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcyMy0xNzI0CiAgICAvLyBuZXdfbWFya2V0Lm1heF90b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vID49IG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIHRvdGFsX3NjYWxlZF9hbW91bnQKICAgIHVuY292ZXIgMgogICAgYjw9CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MjItMTcyNQogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBuZXdfbWFya2V0Lm1heF90b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICA+PSBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyB0b3RhbF9zY2FsZWRfYW1vdW50CiAgICAvLyApLCAiTWFya2V0IGRlcG9zaXQgY2FwIGV4Y2VlZGVkIgogICAgYXNzZXJ0IC8vIE1hcmtldCBkZXBvc2l0IGNhcCBleGNlZWRlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzI3LTE3MjkKICAgIC8vIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgbWFya2V0X2lkLCB1c2VyX2lkLCB0b3RhbF9zY2FsZWRfYW1vdW50CiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMwogICAgZGlnIDMKICAgIGNhbGxzdWIgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTczMQogICAgLy8gc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCB0b3RhbF9zY2FsZWRfYW1vdW50KQogICAgZnJhbWVfZGlnIC0yCiAgICB1bmNvdmVyIDIKICAgIGNhbGxzdWIgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MzMtMTczOAogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBOVG9rZW4ubWludCwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTczNgogICAgLy8gYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIGZyYW1lX2RpZyAtMQogICAgZnJhbWVfZGlnIDEKICAgIGR1cAogICAgY292ZXIgMwogICAgYisKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGZyYW1lX2RpZyAwCiAgICBifAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzM3CiAgICAvLyBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIHVuY292ZXIgNAogICAgaW50IDMxMwogICAgaW50IDgKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MzMtMTczOAogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBOVG9rZW4ubWludCwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICkKICAgIG1ldGhvZCAibWludChhZGRyZXNzLHVpbnQyNTYpdm9pZCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTMKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc0MC0xNzQyCiAgICAvLyBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gKSAvLyBTQ0FMRQogICAgdW5jb3ZlciAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3NDIKICAgIC8vICkgLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3NDAtMTc0MgogICAgLy8gb2xkX2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICkgLy8gU0NBTEUKICAgIGIvCiAgICBkdXAKICAgIGNvdmVyIDMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc0MwogICAgLy8gbmV3X2RlcG9zaXRfYW1vdW50ID0gb2xkX2RlcG9zaXRfYW1vdW50ICsgYW1vdW50ICsgaW50ZXJlc3QKICAgIGZyYW1lX2RpZyAtMQogICAgYisKICAgIHVuY292ZXIgMgogICAgYisKICAgIGZyYW1lX2J1cnkgMwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzQ1CiAgICAvLyBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID09IDA6CiAgICBleHRyYWN0IDEzNiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA3CiAgICBieXRlIDB4CiAgICBiPT0KICAgIGJ6IF9kZXBvc2l0X2Vsc2VfYm9keUA4CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3NDYtMTc0NwogICAgLy8gIyBGYWxsYmFjazogVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIHRvIHByZXZlbnQgbmVnYXRpdmUgY29sbGF0ZXJhbAogICAgLy8gb2xkX3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDQKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBzd2FwCiAgICBkaWcgMQogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgZnJhbWVfYnVyeSA2CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3NDgKICAgIC8vIG5ld192YWx1ZSA9IChuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIGZyYW1lX2RpZyAzCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICBmcmFtZV9idXJ5IDUKICAgIGIgX2RlcG9zaXRfYWZ0ZXJfaWZfZWxzZUA5CgpfZGVwb3NpdF9lbHNlX2JvZHlAODoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc1MC0xNzUxCiAgICAvLyAjIE5vcm1hbCBjYXNlOiBVc2UgdXNlcidzIGxhc3QgcmVjb3JkZWQgcHJpY2UgZm9yIGFjY3VyYXRlIGNvbGxhdGVyYWwgcmVkdWN0aW9uCiAgICAvLyBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIGZyYW1lX2RpZyA3CiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICBmcmFtZV9idXJ5IDYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc1MgogICAgLy8gbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDQKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgMwogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgZnJhbWVfYnVyeSA1CgpfZGVwb3NpdF9hZnRlcl9pZl9lbHNlQDk6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3NTQtMTc1NQogICAgLy8gIyBERi1BVUQtMDk6IFZhbGlkYXRlIHVzZXIgY2FwIGZvciBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X3VzZXJfY2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3NTYKICAgIC8vIGlmIHVzZXJfY2FwLnRvdGFsX2RlcG9zaXRzLm5hdGl2ZSA+IDA6CiAgICBleHRyYWN0IDAgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgOAogICAgYnl0ZSAweAogICAgYj4KICAgIGJ6IF9kZXBvc2l0X2FmdGVyX2lmX2Vsc2VAMTEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc1OAogICAgLy8gbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgZnJhbWVfZGlnIDUKICAgIGZyYW1lX2RpZyA4CiAgICBiPD0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc1Ny0xNzU5CiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIG5ld192YWx1ZSA8PSB1c2VyX2NhcC50b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICksICJVc2VyIGRlcG9zaXQgY2FwIGV4Y2VlZGVkIgogICAgYXNzZXJ0IC8vIFVzZXIgZGVwb3NpdCBjYXAgZXhjZWVkZWQKCl9kZXBvc2l0X2FmdGVyX2lmX2Vsc2VAMTE6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3NjEKICAgIC8vIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF92YWx1ZSwgbmV3X3ZhbHVlKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyA2CiAgICBmcmFtZV9kaWcgNQogICAgY2FsbHN1YiBfdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcywgZ3VhcmRfc3Rva2VuOiB1aW50NjQpIC0+IHZvaWQ6Cl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjI4LTE2MzEKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24oCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCwgZ3VhcmRfc3Rva2VuOiBib29sCiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAzIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYzMgogICAgLy8gYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIGNhbGxzdWIgX2lzX3BhdXNlZAogICAgIQogICAgYXNzZXJ0IC8vIFByb3RvY29sIGlzIHBhdXNlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIwLTE2MzMKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICAjIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIC8vICAgICAgICAgbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgU2NhbGUgdGhlIHByaWNlIGJ5IFNDQUxFIGludGVybmFsbHkgZm9yIHN0b3JhZ2UKICAgIC8vICAgICBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRQcmljZVNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihwcmljZSkpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBmZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9mZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAxMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHBheW1lbnQgPD0gMTAwMDAwMAogICAgLy8gICAgICksICJwYXltZW50IGV4Y2VlZHMgbWF4aW11bSBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNgogICAgLy8gICAgIGFwcCA9IEFwcGxpY2F0aW9uKHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAgICAgaXR4bi5QYXltZW50KHJlY2VpdmVyPWFwcC5hZGRyZXNzLCBhbW91bnQ9cGF5bWVudCwgZmVlPTApLnN1Ym1pdCgpCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFByaWNlRmVlZFByb3ZpZGVySW50ZXJmYWNlLmdldF9wcmljZV93aXRoX3RpbWVzdGFtcCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICAgICAgPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgKToKICAgIC8vICAgICAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICAvLyAgICAgICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC5jb3B5KCkKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLCBwcmljZV93aXRoX3RpbWVzdGFtcC5wcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3BhdXNlX21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIHBhdXNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdLnBhdXNlZCA9IGFyYzQuQm9vbChwYXVzZSA9PSBVSW50NjQoMSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfbWFya2V0KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2FjY3J1ZV9pbnRlcmVzdChzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICAgICBjdXJyZW50X3RpbWUgPSBHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcAogICAgLy8gICAgIHRpbWVfZGVsdGEgPSBjdXJyZW50X3RpbWUgLSBtYXJrZXQubGFzdF91cGRhdGVfdGltZS5uYXRpdmUKICAgIC8vICAgICBpZiB0aW1lX2RlbHRhIDw9IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgICMgRm9yIHN0b2tlbiBtYXJrZXQgKGJvcnJvdy1vbmx5KSwgdXNlIGEgZml4ZWQgdXRpbGl6YXRpb24gcmF0ZSBzaW5jZSB0aGVyZSBhcmUgbm8gZGVwb3NpdHMKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICB1dGlsaXphdGlvbiA9IEJpZ1VJbnQoMTAwMDApICAjIDEwMCUgdXRpbGl6YXRpb24gZm9yIGJvcnJvdy1vbmx5IG1hcmtldAogICAgLy8gICAgIGVsaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIHV0aWxpemF0aW9uID0gKAogICAgLy8gICAgICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIDEwMDAwCiAgICAvLyAgICAgICAgICkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICByYXRlID0gbWFya2V0LmJvcnJvd19yYXRlLm5hdGl2ZSArIChtYXJrZXQuc2xvcGUubmF0aXZlICogdXRpbGl6YXRpb24pIC8vIDEwMDAwCiAgICAvLyAgICAgaW50ZXJlc3QgPSAocmF0ZSAqIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB0aW1lX2RlbHRhKSAvLyAoCiAgICAvLyAgICAgICAgIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBTcGVjaWFsIGhhbmRsaW5nIGZvciBzdG9rZW4gbWFya2V0IC0gYWxsIGludGVyZXN0IGdvZXMgdG8gcmVzZXJ2ZXMKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gaW50ZXJlc3QKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBCaWdVSW50KDApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9ICgKICAgIC8vICAgICAgICAgICAgIGludGVyZXN0ICogYXJjNC5VSW50MjU2LmZyb21fYnl0ZXMobWFya2V0LnJlc2VydmVfZmFjdG9yLmJ5dGVzKS5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyAxMDAwMAogICAgLy8gICAgICAgICBpZiBwcm90b2NvbF9wb3J0aW9uID4gaW50ZXJlc3Q6CiAgICAvLyAgICAgICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gaW50ZXJlc3QKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBpbnRlcmVzdCAtIHByb3RvY29sX3BvcnRpb24KICAgIC8vIAogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPiAwOgogICAgLy8gICAgICAgICBtYXJrZXQuZGVwb3NpdF9pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgKyAoZGVwb3NpdG9yX3BvcnRpb24gKiBTQ0FMRSkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXggPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgKyAoaW50ZXJlc3QgKiBTQ0FMRSkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBpbnRlcmVzdAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGRlcG9zaXRvcl9wb3J0aW9uCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5yZXNlcnZlcyA9IGFyYzQuVUludDI1NihtYXJrZXQucmVzZXJ2ZXMubmF0aXZlICsgcHJvdG9jb2xfcG9ydGlvbikKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KGN1cnJlbnRfdGltZSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gICAgIHJldHVybiBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICMgVE9ETyBnb3Zlcm5hbmNlOiBjb25zaWRlciBpZiByZXNlcnZlIHdpdGhkcmF3YWwgc2hvdWxkIHJlcXVpcmUgYWRkaXRpb25hbAogICAgLy8gIyAgICAgIGdvdmVybmFuY2UgbWVjaGFuaXNtcwogICAgLy8gIyBUT0RPIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHM6IG1pZ2h0IHdhbnQgdG8gZW5mb3JjZSBtaW5pbXVtIHJlc2VydmUgbGV2ZWxzIGZvcgogICAgLy8gIyAgICAgIHByb3RvY29sIHNhZmV0eQogICAgLy8gIyBUT0RPIGV2ZW50IGVtaXNzaW9uOiBDb25zaWRlciBhZGRpbmcgYW4gZXZlbnQgdG8gbG9nIHJlc2VydmUgd2l0aGRyYXdhbHMgZm9yCiAgICAvLyAjICAgICAgdHJhbnNwYXJlbmN5CiAgICAvLyAKICAgIC8vICMgUkVNIGludGVudGlvbmFsbHkgc2tpcHBpbmcgc3Vicm91dGluZSB0byByZWR1Y2UgY29udHJhY3Qgc2l6ZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fd2l0aGRyYXdfcmVzZXJ2ZXMobWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBBY2NydWUgaW50ZXJlc3QgZmlyc3QgdG8gZ2V0IHVwLXRvLWRhdGUgcmVzZXJ2ZXMKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBtYXJrZXQucmVzZXJ2ZXMubmF0aXZlID49IGFtb3VudCwgIkluc3VmZmljaWVudCByZXNlcnZlcyIKICAgIC8vIAogICAgLy8gICAgICMgVHJhbnNmZXIgcmVzZXJ2ZXMgdG8gdGhlIG93bmVyIChub3QgdG8gdGhlIGNvbnRyYWN0IGl0c2VsZikKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgVXBkYXRlIHJlc2VydmVzCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24oCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCwgZ3VhcmRfc3Rva2VuOiBib29sCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGZyYW1lX2RpZyAtMwogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIwCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAtMTYzMwogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBkZWwgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWREZXRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgICMgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIGFzc2VydCBwcmljZSA+IDAsICJQcmljZSBtdXN0IGJlIHBvc2l0aXZlIgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgVW5wYXVzZSB0aGUgbWFya2V0IG9uIGZpcnN0IHByaWNlIHNldAogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQgYW5kIG1hcmtldC5wcmljZSA9PSAwOgogICAgLy8gICAgICAgICBtYXJrZXQucGF1c2VkID0gYXJjNC5Cb29sKEZhbHNlKQogICAgLy8gCiAgICAvLyAgICAgIyBTY2FsZSB0aGUgcHJpY2UgYnkgU0NBTEUgaW50ZXJuYWxseSBmb3Igc3RvcmFnZQogICAgLy8gICAgIG1hcmtldC5wcmljZSA9IGFyYzQuVUludDI1NihwcmljZSAqIFNDQUxFKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFByaWNlU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KHByaWNlKSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgc2VsZi5fZmV0Y2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2ZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDEwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS01CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgcGF5bWVudCA8PSAxMDAwMDAwCiAgICAvLyAgICAgKSwgInBheW1lbnQgZXhjZWVkcyBtYXhpbXVtIGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS02CiAgICAvLyAgICAgYXBwID0gQXBwbGljYXRpb24oc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vICAgICBpdHhuLlBheW1lbnQocmVjZWl2ZXI9YXBwLmFkZHJlc3MsIGFtb3VudD1wYXltZW50LCBmZWU9MCkuc3VibWl0KCkKICAgIC8vICAgICBwcmljZV93aXRoX3RpbWVzdGFtcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgUHJpY2VGZWVkUHJvdmlkZXJJbnRlcmZhY2UuZ2V0X3ByaWNlX3dpdGhfdGltZXN0YW1wLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIGlmICgKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICAgICA+IHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICApOgogICAgLy8gICAgICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcCA9ICgKICAgIC8vICAgICAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLmNvcHkoKQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQsIHByaWNlX3dpdGhfdGltZXN0YW1wLnByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fcGF1c2VfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgcGF1c2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9wYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0ucGF1c2VkID0gYXJjNC5Cb29sKHBhdXNlID09IFVJbnQ2NCgxKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY19tYXJrZXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYWNjcnVlX2ludGVyZXN0KHNlbGYsIG1hcmtldF9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGN1cnJlbnRfdGltZSA9IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wCiAgICAvLyAgICAgdGltZV9kZWx0YSA9IGN1cnJlbnRfdGltZSAtIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lLm5hdGl2ZQogICAgLy8gICAgIGlmIHRpbWVfZGVsdGEgPD0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgIyBGb3Igc3Rva2VuIG1hcmtldCAoYm9ycm93LW9ubHkpLCB1c2UgYSBmaXhlZCB1dGlsaXphdGlvbiByYXRlIHNpbmNlIHRoZXJlIGFyZSBubyBkZXBvc2l0cwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHV0aWxpemF0aW9uID0gQmlnVUludCgxMDAwMCkgICMgMTAwJSB1dGlsaXphdGlvbiBmb3IgYm9ycm93LW9ubHkgbWFya2V0CiAgICAvLyAgICAgZWxpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgdXRpbGl6YXRpb24gPSAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDAKICAgIC8vICAgICAgICAgKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgIHJhdGUgPSBtYXJrZXQuYm9ycm93X3JhdGUubmF0aXZlICsgKG1hcmtldC5zbG9wZS5uYXRpdmUgKiB1dGlsaXphdGlvbikgLy8gMTAwMDAKICAgIC8vICAgICBpbnRlcmVzdCA9IChyYXRlICogbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHRpbWVfZGVsdGEpIC8vICgKICAgIC8vICAgICAgICAgc2VsZi5zZWNvbmRzX3Blcl95ZWFyICogMTAwMDAKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHN0b2tlbiBtYXJrZXQgLSBhbGwgaW50ZXJlc3QgZ29lcyB0byByZXNlcnZlcwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBhcmM0LlVJbnQyNTYuZnJvbV9ieXRlcyhtYXJrZXQucmVzZXJ2ZV9mYWN0b3IuYnl0ZXMpLm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIDEwMDAwCiAgICAvLyAgICAgICAgIGlmIHByb3RvY29sX3BvcnRpb24gPiBpbnRlcmVzdDoKICAgIC8vICAgICAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IGludGVyZXN0IC0gcHJvdG9jb2xfcG9ydGlvbgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChkZXBvc2l0b3JfcG9ydGlvbiAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID4gMDoKICAgIC8vICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChpbnRlcmVzdCAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGludGVyZXN0CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgZGVwb3NpdG9yX3BvcnRpb24KICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgKyBwcm90b2NvbF9wb3J0aW9uKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoY3VycmVudF90aW1lKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAgICAgcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gIyBUT0RPIGdvdmVybmFuY2U6IGNvbnNpZGVyIGlmIHJlc2VydmUgd2l0aGRyYXdhbCBzaG91bGQgcmVxdWlyZSBhZGRpdGlvbmFsCiAgICAvLyAjICAgICAgZ292ZXJuYW5jZSBtZWNoYW5pc21zCiAgICAvLyAjIFRPRE8gbWluaW11bSByZXNlcnZlIGxldmVsczogbWlnaHQgd2FudCB0byBlbmZvcmNlIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHMgZm9yCiAgICAvLyAjICAgICAgcHJvdG9jb2wgc2FmZXR5CiAgICAvLyAjIFRPRE8gZXZlbnQgZW1pc3Npb246IENvbnNpZGVyIGFkZGluZyBhbiBldmVudCB0byBsb2cgcmVzZXJ2ZSB3aXRoZHJhd2FscyBmb3IKICAgIC8vICMgICAgICB0cmFuc3BhcmVuY3kKICAgIC8vIAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBza2lwcGluZyBzdWJyb3V0aW5lIHRvIHJlZHVjZSBjb250cmFjdCBzaXplCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl93aXRoZHJhd19yZXNlcnZlcyhtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIEFjY3J1ZSBpbnRlcmVzdCBmaXJzdCB0byBnZXQgdXAtdG8tZGF0ZSByZXNlcnZlcwogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgPj0gYW1vdW50LCAiSW5zdWZmaWNpZW50IHJlc2VydmVzIgogICAgLy8gCiAgICAvLyAgICAgIyBUcmFuc2ZlciByZXNlcnZlcyB0byB0aGUgb3duZXIgKG5vdCB0byB0aGUgY29udHJhY3QgaXRzZWxmKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVcGRhdGUgcmVzZXJ2ZXMKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbigKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50LCBndWFyZF9zdG9rZW46IGJvb2wKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgc3dhcAogICAgY29uY2F0CiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTYzMwogICAgLy8gYXNzZXJ0IG1hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICBhc3NlcnQgLy8gTWFya2V0IGRvZXMgbm90IGV4aXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MzQKICAgIC8vIGFzc2VydCBhbW91bnQgPiAwLCAiQW1vdW50IG11c3QgYmUgPiAwIgogICAgZnJhbWVfZGlnIC0yCiAgICBieXRlIDB4CiAgICBiPgogICAgYXNzZXJ0IC8vIEFtb3VudCBtdXN0IGJlID4gMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjM1CiAgICAvLyBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X21hcmtldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjM2CiAgICAvLyBhc3NlcnQgbm90IG1hcmtldC5wYXVzZWQsICJNYXJrZXQgaXMgcGF1c2VkIgogICAgaW50IDAKICAgIGdldGJpdAogICAgYnl0ZSAweDAwCiAgICBpbnQgMAogICAgdW5jb3ZlciAyCiAgICBzZXRiaXQKICAgIGJ5dGUgMHgwMAogICAgPT0KICAgIGFzc2VydCAvLyBNYXJrZXQgaXMgcGF1c2VkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MzcKICAgIC8vIGlmIGd1YXJkX3N0b2tlbjoKICAgIGZyYW1lX2RpZyAtMQogICAgYnogX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb25fYWZ0ZXJfaWZfZWxzZUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MzkKICAgIC8vIHNlbGYuc3Rva2VuX2FwcF9pZCAhPSBtYXJrZXRfaWQKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMTgKICAgIC8vIHNlbGYuc3Rva2VuX2FwcF9pZCA9IFVJbnQ2NCgpICAjIHN0YWJsZSBtYXJrZXQKICAgIGJ5dGUgInN0b2tlbl9hcHBfaWQiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE2MzkKICAgIC8vIHNlbGYuc3Rva2VuX2FwcF9pZCAhPSBtYXJrZXRfaWQKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5zdG9rZW5fYXBwX2lkIGV4aXN0cwogICAgZnJhbWVfZGlnIC0zCiAgICAhPQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjM4LTE2NDAKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgLy8gKSwgIkNhbm5vdCB1c2Ugc3Rva2VuIG1hcmtldCBmb3IgdGhpcyBvcGVyYXRpb24iCiAgICBhc3NlcnQgLy8gQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGZvciB0aGlzIG9wZXJhdGlvbgoKX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb25fYWZ0ZXJfaWZfZWxzZUAyOgogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCkgLT4gYnl0ZXM6Cl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc3OC0xNzc5CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQmlnVUludDoKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzgxCiAgICAvLyBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfYWNjcnVlX2ludGVyZXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3ODIKICAgIC8vIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc4NgogICAgLy8gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgc3dhcAogICAgZXh0cmFjdCAxNzcgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkaWcgMQogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc4NwogICAgLy8gKSAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTc4NC0xNzg3CiAgICAvLyAjIENhbGN1bGF0ZSB0b3RhbCB1bmRlcmx5aW5nIGFtb3VudAogICAgLy8gdXNlcl90b3RhbF91bmRlcmx5aW5nID0gKAogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICkgLy8gU0NBTEUKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3ODktMTc5MAogICAgLy8gIyBJbnRlcmVzdCBpcyB0aGUgZGlmZmVyZW5jZSBmcm9tIHRoZSBzY2FsZWQgZGVwb3NpdHMgKHdoaWNoIHJlcHJlc2VudCB0aGUgImJhc2UiIGFtb3VudCkKICAgIC8vIGludGVyZXN0ID0gdXNlcl90b3RhbF91bmRlcmx5aW5nIC0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICBzd2FwCiAgICBiLQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzkyCiAgICAvLyByZXR1cm4gaW50ZXJlc3QKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZDogdWludDY0LCB1c2VyX2lkOiBieXRlcywgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExMzctMTE0MAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAzIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE0MQogICAgLy8gbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF9tYXJrZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE0MgogICAgLy8gdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfdXNlcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTQzCiAgICAvLyB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X3VzZXJfa2V5CiAgICBjb3ZlciAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNDQKICAgIC8vIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIGR1cAogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIC0xCiAgICBiKwogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE0NQogICAgLy8gdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIGRpZyAxCiAgICBleHRyYWN0IDE3NyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHJlcGxhY2UyIDY0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNDYKICAgIC8vIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgaXRvYgogICAgcmVwbGFjZTIgMTI4CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNDcKICAgIC8vIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIHN3YXAKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICByZXBsYWNlMiAxMzYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMQogICAgLy8gc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICBieXRlICJ1c2VycyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE0OAogICAgLy8gc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgdW5jb3ZlciAyCiAgICBjb25jYXQKICAgIHN3YXAKICAgIGJveF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDcyLTE0NzUKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDc2CiAgICAvLyBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfZ2V0X21hcmtldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDc4CiAgICAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudAogICAgZHVwCiAgICBleHRyYWN0IDExMyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAtMQogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ3Ny0xNDc5CiAgICAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50CiAgICAvLyApCiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBifAogICAgcmVwbGFjZTIgMTEzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0ODAKICAgIC8vIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICByZXBsYWNlMiAyNDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ4MQogICAgLy8gc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBmcmFtZV9kaWcgLTIKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMAogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDgxCiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIHN3YXAKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQsIG9sZF92YWx1ZTogYnl0ZXMsIG5ld192YWx1ZTogYnl0ZXMpIC0+IHZvaWQ6Cl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWw6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNzctMjM4NAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBtYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBvbGRfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyAgICAgbmV3X3ZhbHVlOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gNCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzODUKICAgIC8vIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICBmcmFtZV9kaWcgLTQKICAgIGNhbGxzdWIgX2dldF9nbG9iYWxfdXNlcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzg4CiAgICAvLyBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIG9sZF92YWx1ZSArIG5ld192YWx1ZQogICAgZHVwCiAgICBleHRyYWN0IDAgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgLTIKICAgIGItCiAgICBmcmFtZV9kaWcgLTEKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzODctMjM4OQogICAgLy8gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZSA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIG9sZF92YWx1ZSArIG5ld192YWx1ZQogICAgLy8gKQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM5MAogICAgLy8gZ2xvYmFsX3VzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgaXRvYgogICAgcmVwbGFjZTIgNjQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMgogICAgLy8gc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICBieXRlICJnbG9iYWxfdXNlcnMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzOTIKICAgIC8vIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICBmcmFtZV9kaWcgLTQKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkOiBieXRlcykgLT4gYnl0ZXM6Cl9nZXRfZ2xvYmFsX3VzZXI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNjUtMjM2NgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IEdsb2JhbFVzZXJEYXRhOgogICAgcHJvdG8gMSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjIKICAgIC8vIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgYnl0ZSAiZ2xvYmFsX3VzZXJzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIyLTIzNjcKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICAjIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIC8vICAgICAgICAgbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgU2NhbGUgdGhlIHByaWNlIGJ5IFNDQUxFIGludGVybmFsbHkgZm9yIHN0b3JhZ2UKICAgIC8vICAgICBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRQcmljZVNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihwcmljZSkpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBmZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9mZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAxMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHBheW1lbnQgPD0gMTAwMDAwMAogICAgLy8gICAgICksICJwYXltZW50IGV4Y2VlZHMgbWF4aW11bSBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNgogICAgLy8gICAgIGFwcCA9IEFwcGxpY2F0aW9uKHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAgICAgaXR4bi5QYXltZW50KHJlY2VpdmVyPWFwcC5hZGRyZXNzLCBhbW91bnQ9cGF5bWVudCwgZmVlPTApLnN1Ym1pdCgpCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFByaWNlRmVlZFByb3ZpZGVySW50ZXJmYWNlLmdldF9wcmljZV93aXRoX3RpbWVzdGFtcCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICAgICAgPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgKToKICAgIC8vICAgICAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICAvLyAgICAgICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC5jb3B5KCkKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLCBwcmljZV93aXRoX3RpbWVzdGFtcC5wcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3BhdXNlX21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIHBhdXNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdLnBhdXNlZCA9IGFyYzQuQm9vbChwYXVzZSA9PSBVSW50NjQoMSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfbWFya2V0KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2FjY3J1ZV9pbnRlcmVzdChzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICAgICBjdXJyZW50X3RpbWUgPSBHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcAogICAgLy8gICAgIHRpbWVfZGVsdGEgPSBjdXJyZW50X3RpbWUgLSBtYXJrZXQubGFzdF91cGRhdGVfdGltZS5uYXRpdmUKICAgIC8vICAgICBpZiB0aW1lX2RlbHRhIDw9IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgICMgRm9yIHN0b2tlbiBtYXJrZXQgKGJvcnJvdy1vbmx5KSwgdXNlIGEgZml4ZWQgdXRpbGl6YXRpb24gcmF0ZSBzaW5jZSB0aGVyZSBhcmUgbm8gZGVwb3NpdHMKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICB1dGlsaXphdGlvbiA9IEJpZ1VJbnQoMTAwMDApICAjIDEwMCUgdXRpbGl6YXRpb24gZm9yIGJvcnJvdy1vbmx5IG1hcmtldAogICAgLy8gICAgIGVsaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIHV0aWxpemF0aW9uID0gKAogICAgLy8gICAgICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIDEwMDAwCiAgICAvLyAgICAgICAgICkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICByYXRlID0gbWFya2V0LmJvcnJvd19yYXRlLm5hdGl2ZSArIChtYXJrZXQuc2xvcGUubmF0aXZlICogdXRpbGl6YXRpb24pIC8vIDEwMDAwCiAgICAvLyAgICAgaW50ZXJlc3QgPSAocmF0ZSAqIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB0aW1lX2RlbHRhKSAvLyAoCiAgICAvLyAgICAgICAgIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBTcGVjaWFsIGhhbmRsaW5nIGZvciBzdG9rZW4gbWFya2V0IC0gYWxsIGludGVyZXN0IGdvZXMgdG8gcmVzZXJ2ZXMKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gaW50ZXJlc3QKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBCaWdVSW50KDApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9ICgKICAgIC8vICAgICAgICAgICAgIGludGVyZXN0ICogYXJjNC5VSW50MjU2LmZyb21fYnl0ZXMobWFya2V0LnJlc2VydmVfZmFjdG9yLmJ5dGVzKS5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyAxMDAwMAogICAgLy8gICAgICAgICBpZiBwcm90b2NvbF9wb3J0aW9uID4gaW50ZXJlc3Q6CiAgICAvLyAgICAgICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gaW50ZXJlc3QKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBpbnRlcmVzdCAtIHByb3RvY29sX3BvcnRpb24KICAgIC8vIAogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPiAwOgogICAgLy8gICAgICAgICBtYXJrZXQuZGVwb3NpdF9pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgKyAoZGVwb3NpdG9yX3BvcnRpb24gKiBTQ0FMRSkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXggPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgKyAoaW50ZXJlc3QgKiBTQ0FMRSkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBpbnRlcmVzdAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGRlcG9zaXRvcl9wb3J0aW9uCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5yZXNlcnZlcyA9IGFyYzQuVUludDI1NihtYXJrZXQucmVzZXJ2ZXMubmF0aXZlICsgcHJvdG9jb2xfcG9ydGlvbikKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KGN1cnJlbnRfdGltZSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gICAgIHJldHVybiBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICMgVE9ETyBnb3Zlcm5hbmNlOiBjb25zaWRlciBpZiByZXNlcnZlIHdpdGhkcmF3YWwgc2hvdWxkIHJlcXVpcmUgYWRkaXRpb25hbAogICAgLy8gIyAgICAgIGdvdmVybmFuY2UgbWVjaGFuaXNtcwogICAgLy8gIyBUT0RPIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHM6IG1pZ2h0IHdhbnQgdG8gZW5mb3JjZSBtaW5pbXVtIHJlc2VydmUgbGV2ZWxzIGZvcgogICAgLy8gIyAgICAgIHByb3RvY29sIHNhZmV0eQogICAgLy8gIyBUT0RPIGV2ZW50IGVtaXNzaW9uOiBDb25zaWRlciBhZGRpbmcgYW4gZXZlbnQgdG8gbG9nIHJlc2VydmUgd2l0aGRyYXdhbHMgZm9yCiAgICAvLyAjICAgICAgdHJhbnNwYXJlbmN5CiAgICAvLyAKICAgIC8vICMgUkVNIGludGVudGlvbmFsbHkgc2tpcHBpbmcgc3Vicm91dGluZSB0byByZWR1Y2UgY29udHJhY3Qgc2l6ZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fd2l0aGRyYXdfcmVzZXJ2ZXMobWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBBY2NydWUgaW50ZXJlc3QgZmlyc3QgdG8gZ2V0IHVwLXRvLWRhdGUgcmVzZXJ2ZXMKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBtYXJrZXQucmVzZXJ2ZXMubmF0aXZlID49IGFtb3VudCwgIkluc3VmZmljaWVudCByZXNlcnZlcyIKICAgIC8vIAogICAgLy8gICAgICMgVHJhbnNmZXIgcmVzZXJ2ZXMgdG8gdGhlIG93bmVyIChub3QgdG8gdGhlIGNvbnRyYWN0IGl0c2VsZikKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgVXBkYXRlIHJlc2VydmVzCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24oCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCwgZ3VhcmRfc3Rva2VuOiBib29sCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgYW1vdW50ID4gMCwgIkFtb3VudCBtdXN0IGJlID4gMCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgbm90IG1hcmtldC5wYXVzZWQsICJNYXJrZXQgaXMgcGF1c2VkIgogICAgLy8gICAgIGlmIGd1YXJkX3N0b2tlbjoKICAgIC8vICAgICAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgICAgIHNlbGYuc3Rva2VuX2FwcF9pZCAhPSBtYXJrZXRfaWQKICAgIC8vICAgICAgICAgKSwgIkNhbm5vdCB1c2Ugc3Rva2VuIG1hcmtldCBmb3IgdGhpcyBvcGVyYXRpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRlcG9zaXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fZGVwb3NpdChUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIFJFTSBtYXkgYWRkIHByb3RlY3Rpb24gZm9yIGxvdyB1dGlsaXNhdGlvbiBpbiBmdXR1cmUKICAgIC8vICMgUkVNIGxvd2VyIG1heCBkZXBvc2l0IGFtb3VudCBmb3IgbG93IHV0aWxpc2F0aW9uCiAgICAvLyAjIFJFTSBoaWdoIG1heCBkZXBvc2l0IGFtb3VudCBmb3IgaGlnaCB1dGlsaXNhdGlvbgogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXBvc2l0KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgSW50ZXJuYWwgZGVwb3NpdCBtZXRob2QgdGhhdCBoYW5kbGVzIHVzZXIgZGVwb3NpdHMgaW50byBhIGxlbmRpbmcgbWFya2V0LgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgcGVyZm9ybXMgYSBjb21wbGV0ZSBkZXBvc2l0IG9wZXJhdGlvbiBpbmNsdWRpbmc6CiAgICAvLyAgICAgMS4gVmFsaWRhdGluZyB0aGUgbWFya2V0IG9wZXJhdGlvbiAocHJvdG9jb2wgbm90IHBhdXNlZCwgbWFya2V0IGV4aXN0cywgYW1vdW50ID4gMCwgbWFya2V0IG5vdCBwYXVzZWQpCiAgICAvLyAgICAgMi4gVHJhbnNmZXJyaW5nIEFSQzIwMCB0b2tlbnMgZnJvbSB1c2VyIHRvIHRoZSBsZW5kaW5nIHBvb2wgY29udHJhY3QKICAgIC8vICAgICAzLiBBY2NydWluZyBpbnRlcmVzdCBvbiB0aGUgbWFya2V0IHRvIGdldCB1cGRhdGVkIGRlcG9zaXQgaW5kZXgKICAgIC8vICAgICA0LiBDYWxjdWxhdGluZyBhbmQgYWRkaW5nIGVhcm5lZCBpbnRlcmVzdCB0byB0aGUgdXNlcidzIHBvc2l0aW9uCiAgICAvLyAgICAgNS4gQ29udmVydGluZyBkZXBvc2l0IGFtb3VudCB0byBzY2FsZWQgZGVwb3NpdHMgdXNpbmcgY3VycmVudCBkZXBvc2l0IGluZGV4CiAgICAvLyAgICAgNi4gQ2hlY2tpbmcgZGVwb3NpdCBjYXAgY29uc3RyYWludHMKICAgIC8vICAgICA3LiBVcGRhdGluZyB1c2VyIGFuZCBtYXJrZXQgc2NhbGVkIGRlcG9zaXQgYmFsYW5jZXMKICAgIC8vICAgICA4LiBNaW50aW5nIE5Ub2tlbnMgdG8gcmVwcmVzZW50IHRoZSB1c2VyJ3MgZGVwb3NpdCBwb3NpdGlvbgogICAgLy8gICAgIDkuIFVwZGF0aW5nIGdsb2JhbCBjb2xsYXRlcmFsIGNhbGN1bGF0aW9ucyBmb3IgdGhlIHVzZXIKICAgIC8vICAgICAxMC4gRW1pdHRpbmcgYSBNYXJrZXREZXBvc2l0IGV2ZW50CiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkIChBY2NvdW50KTogVGhlIGFjY291bnQgSUQgb2YgdGhlIHVzZXIgbWFraW5nIHRoZSBkZXBvc2l0CiAgICAvLyAgICAgICAgIG1hcmtldF9pZCAoVUludDY0KTogVGhlIElEIG9mIHRoZSBtYXJrZXQgdG8gZGVwb3NpdCBpbnRvCiAgICAvLyAgICAgICAgIGFtb3VudCAoQmlnVUludCk6IFRoZSBhbW91bnQgb2YgdW5kZXJseWluZyB0b2tlbnMgdG8gZGVwb3NpdAogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgbWFya2V0IHZhbGlkYXRpb24gZmFpbHMsIGRlcG9zaXQgY2FwIGlzIGV4Y2VlZGVkLCBvciBvdGhlciBjb25zdHJhaW50cyBhcmUgdmlvbGF0ZWQKICAgIC8vIAogICAgLy8gICAgIE5vdGU6CiAgICAvLyAgICAgICAgIC0gSW50ZXJlc3QgZWFybmVkIHNpbmNlIGxhc3QgaW50ZXJhY3Rpb24gaXMgYXV0b21hdGljYWxseSBhZGRlZCB0byB0aGUgZGVwb3NpdAogICAgLy8gICAgICAgICAtIFNjYWxlZCBkZXBvc2l0cyBhcmUgdXNlZCB0byB0cmFjayB1c2VyIHBvc2l0aW9ucyBhbmQgY2FsY3VsYXRlIGludGVyZXN0CiAgICAvLyAgICAgICAgIC0gQ29sbGF0ZXJhbCB2YWx1ZSBpcyB1cGRhdGVkIHVzaW5nIGVpdGhlciB1c2VyJ3MgbGFzdCByZWNvcmRlZCBwcmljZSBvciBjdXJyZW50IG1hcmtldCBwcmljZQogICAgLy8gICAgICAgICAtIE5Ub2tlbnMgYXJlIG1pbnRlZCB0byByZXByZXNlbnQgdGhlIHVzZXIncyBkZXBvc2l0IHBvc2l0aW9uIChhbW91bnQgKyBpbnRlcmVzdCkKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgZGVwb3NpdCBvcGVyYXRpb24KICAgIC8vICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gICAgICkuZGVwb3NpdC5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiRGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgKSAgIyBHZXQgdXBkYXRlZCBtYXJrZXQgd2l0aCBhY2NydWVkIGludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQWRkIGVhcm5lZCBpbnRlcmVzdCB0byB1c2VyJ3MgcG9zaXRpb24gYXMgYWRkaXRpb25hbCBzY2FsZWQgZGVwb3NpdHMKICAgIC8vICAgICBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gQmlnVUludCgwKQogICAgLy8gICAgIGlmIGludGVyZXN0ID4gMDoKICAgIC8vICAgICAgICAgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgICAgIGludGVyZXN0ICogU0NBTEUKICAgIC8vICAgICAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICBhbW91bnQgKiBTQ0FMRQogICAgLy8gICAgICkgLy8gbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZSAgIyBDYWxjdWxhdGUgd2l0aCBuZXcgaW5kZXgKICAgIC8vIAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9hbW91bnQgPSBzY2FsZWRfYW1vdW50ICsgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudAogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbmV3X21hcmtldC5tYXhfdG90YWxfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgICAgID49IG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIHRvdGFsX3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApLCAiTWFya2V0IGRlcG9zaXQgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICAgICAgbWFya2V0X2lkLCB1c2VyX2lkLCB0b3RhbF9zY2FsZWRfYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCB0b3RhbF9zY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG5ld19tYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19kZXBvc2l0X2Ftb3VudCA9IG9sZF9kZXBvc2l0X2Ftb3VudCArIGFtb3VudCArIGludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgICMgRmFsbGJhY2s6IFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSB0byBwcmV2ZW50IG5lZ2F0aXZlIGNvbGxhdGVyYWwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgIyBOb3JtYWwgY2FzZTogVXNlIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIGZvciBhY2N1cmF0ZSBjb2xsYXRlcmFsIHJlZHVjdGlvbgogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHVzZXIgY2FwIGZvciBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gICAgIHVzZXJfY2FwID0gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9jYXAudG90YWxfZGVwb3NpdHMubmF0aXZlID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgICAgIG5ld192YWx1ZSA8PSB1c2VyX2NhcC50b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgKSwgIlVzZXIgZGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwodXNlcl9pZCwgbWFya2V0X2lkLCBvbGRfdmFsdWUsIG5ld192YWx1ZSkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldERlcG9zaXQoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgYXJjNC5VSW50NjQobWFya2V0X2lkKSwgYXJjNC5VSW50MjU2KGFtb3VudCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBjYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCgKICAgIC8vICMgICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gIyApIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICMgICAgIGVuc3VyZV9idWRnZXQoNzAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gIyAgICAgcmV0dXJuIGFyYzQuVUludDI1NigKICAgIC8vICMgICAgICAgICBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3Qoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIiIiQ2FsY3VsYXRlIHVzZXIncyBhY2NydWVkIGludGVyZXN0IiIiCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIHVuZGVybHlpbmcgYW1vdW50CiAgICAvLyAgICAgdXNlcl90b3RhbF91bmRlcmx5aW5nID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBJbnRlcmVzdCBpcyB0aGUgZGlmZmVyZW5jZSBmcm9tIHRoZSBzY2FsZWQgZGVwb3NpdHMgKHdoaWNoIHJlcHJlc2VudCB0aGUgImJhc2UiIGFtb3VudCkKICAgIC8vICAgICBpbnRlcmVzdCA9IHVzZXJfdG90YWxfdW5kZXJseWluZyAtIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIGludGVyZXN0CiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBjYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KAogICAgLy8gIyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyAjICkgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAjICAgICByZXR1cm4gYXJjNC5VSW50MjU2KAogICAgLy8gIyAgICAgICAgIHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgZGVidCBpbnRlcmVzdCIiIgogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB0b3RhbCB1bmRlcmx5aW5nIGRlYnQgYW1vdW50CiAgICAvLyAgICAgdXNlcl90b3RhbF9kZWJ0ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIG9yaWdpbmFsIHByaW5jaXBhbCBhbW91bnQgdXNpbmcgdXNlcidzIGJvcnJvd19pbmRleAogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBpZiB1c2VyJ3MgYm9ycm93X2luZGV4IGlzIDAsIHVzZSBjdXJyZW50IG1hcmtldCBib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyX2JvcnJvd19pbmRleCA9ICgKICAgIC8vICAgICAgICAgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgb3JpZ2luYWxfcHJpbmNpcGFsID0gKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlcl9ib3Jyb3dfaW5kZXgpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIEludGVyZXN0IGlzIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gY3VycmVudCB0b3RhbCBkZWJ0IGFuZCBvcmlnaW5hbCBwcmluY2lwYWwKICAgIC8vICAgICBkZWJ0X2ludGVyZXN0ID0gdXNlcl90b3RhbF9kZWJ0IC0gb3JpZ2luYWxfcHJpbmNpcGFsCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gZGVidF9pbnRlcmVzdAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhdyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMjEwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vIAogICAgLy8gICAgICMgU3luYyB0aGUgbWFya2V0IGJlaW5nIHdpdGhkcmF3biBmcm9tIHRvIHVwZGF0ZSBnbG9iYWwgdmFsdWVzIHdpdGggaW50ZXJlc3QKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQyNTYoc2VsZi5fd2l0aGRyYXcoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBXaXRoZHJhdyB0b2tlbnMgZnJvbSBhIGxlbmRpbmcgbWFya2V0IGJ5IGJ1cm5pbmcgblRva2Vucy4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIGhhbmRsZXMgdGhlIHdpdGhkcmF3YWwgcHJvY2VzcyBieToKICAgIC8vICAgICAxLiBWYWxpZGF0aW5nIHRoZSBtYXJrZXQgb3BlcmF0aW9uIGFuZCB1c2VyIGJhbGFuY2UKICAgIC8vICAgICAyLiBBY2NydWluZyBpbnRlcmVzdCB0byBnZXQgdGhlIGxhdGVzdCBtYXJrZXQgc3RhdGUKICAgIC8vICAgICAzLiBDYWxjdWxhdGluZyB1c2VyJ3MgYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gICAgIDQuIFBlcmZvcm1pbmcgaGVhbHRoIGNoZWNrcyB0byBlbnN1cmUgd2l0aGRyYXdhbCBkb2Vzbid0IHB1dCBib3Jyb3dzIGF0IHJpc2sKICAgIC8vICAgICA1LiBCdXJuaW5nIG5Ub2tlbnMgYW5kIHRyYW5zZmVycmluZyB1bmRlcmx5aW5nIHRva2VucyB0byB1c2VyCiAgICAvLyAgICAgNi4gVXBkYXRpbmcgZ2xvYmFsIGNvbGxhdGVyYWwgdmFsdWVzCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgYWNjb3VudCBJRCBvZiB0aGUgdXNlciB3aXRoZHJhd2luZyB0b2tlbnMKICAgIC8vICAgICAgICAgbWFya2V0X2lkOiBUaGUgSUQgb2YgdGhlIG1hcmtldCB0byB3aXRoZHJhdyBmcm9tCiAgICAvLyAgICAgICAgIGFtb3VudDogVGhlIGFtb3VudCBvZiBuVG9rZW5zIHRvIGJ1cm4gKG5vdCB0aGUgdW5kZXJseWluZyB0b2tlbiBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBSZXR1cm5zOgogICAgLy8gICAgICAgICBCaWdVSW50OiBUaGUgdG90YWwgYW1vdW50IG9mIHVuZGVybHlpbmcgdG9rZW5zIHRyYW5zZmVycmVkIHRvIHRoZSB1c2VyCiAgICAvLyAgICAgICAgICAgICAgICAgKGluY2x1ZGVzIGJvdGggdGhlIHdpdGhkcmF3biBhbW91bnQgYW5kIGFjY3J1ZWQgaW50ZXJlc3QpCiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiB1c2VyIGhhcyBpbnN1ZmZpY2llbnQgYmFsYW5jZSBvciB3aXRoZHJhd2FsIHdvdWxkIHB1dCBib3Jyb3dzIGF0IHJpc2sKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3Igd2l0aGRyYXcgb3BlcmF0aW9uCiAgICAvLyAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApLndpdGhkcmF3Lm5hdGl2ZQogICAgLy8gICAgIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJXaXRoZHJhdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIGFtb3VudCBpcyB0aGUgYW1vdW50IG9mIG5Ub2tlbnMgYmVpbmcgYnVybmVkCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgYW1vdW50IDw9IHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vIAogICAgLy8gICAgIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIGhlYWx0aCBjaGVjazogZW5zdXJlIHdpdGhkcmF3IHdvdWxkIG5vdCBwdXQgYm9ycm93cyBhdCByaXNrCiAgICAvLyAgICAgaWYgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlID4gMDoKICAgIC8vICAgICAgICAgIyB2YWx1ZSBvZiB1bmRlcmx5aW5nIGFtb3VudCB0byB3aXRoZHJhdyB1c2luZyBuZXcgbWFya2V0IHByaWNlCiAgICAvLyAgICAgICAgIHdpdGhkcmF3X3ZhbHVlID0gKGFtb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICByZW1haW5pbmdfY29sbGF0ZXJhbCA9ICgKICAgIC8vICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gd2l0aGRyYXdfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBhc3NlcnQgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSA8PSAoCiAgICAvLyAgICAgICAgICAgICByZW1haW5pbmdfY29sbGF0ZXJhbCAqIEJpZ1VJbnQobmV3X21hcmtldC5jb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUpCiAgICAvLyAgICAgICAgICkgLy8gQmlnVUludCgxMDAwMCksICJXaXRoZHJhd2FsIHdvdWxkIHB1dCBib3Jyb3dzIGF0IHJpc2siCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgdXNlcl9pZCwgYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG5ld19tYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQgKyBpbnRlcmVzdCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIG9sZF9kZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vICAgICBuZXdfZGVwb3NpdF9hbW91bnQgPSBvbGRfZGVwb3NpdF9hbW91bnQgKyBpbnRlcmVzdCAtIGFtb3VudAogICAgLy8gCiAgICAvLyAgICAgYW1vdW50X3VzZF92YWx1ZSA9IChhbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3Igd2l0aGRyYXcgb3BlcmF0aW9uCiAgICAvLyAgICAgdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID09IDA6CiAgICAvLyAgICAgICAgIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCArIDg2NDAwKQogICAgLy8gICAgIGVsaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA8IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wOgogICAgLy8gICAgICAgICB1c2VyX2NhcC50b3RhbF93aXRoZHJhd2FscyA9IGFyYzQuVUludDI1NigwKQogICAgLy8gICAgICAgICB1c2VyX2NhcC50b3RhbF9saXF1aWRhdGlvbnMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIC8vICAgICAgICAgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wICsgODY0MDApCiAgICAvLyAgICAgaWYgdXNlcl9jYXAuZGFpbHlfd2l0aGRyYXdhbHMubmF0aXZlID4gMDoKICAgIC8vICAgICAgICAgbmV3X3RvdGFsX3dpdGhkcmF3YWxzID0gdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMubmF0aXZlICsgYW1vdW50X3VzZF92YWx1ZQogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3RvdGFsX3dpdGhkcmF3YWxzIDw9IHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZQogICAgLy8gICAgICAgICApLCAiVXNlciB3aXRoZHJhdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KG5ld190b3RhbF93aXRoZHJhd2FscykKICAgIC8vICAgICAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICAjIEZhbGxiYWNrOiBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgdG8gcHJldmVudCBuZWdhdGl2ZSBjb2xsYXRlcmFsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgICMgTm9ybWFsIGNhc2U6IFVzZSB1c2VyJ3MgbGFzdCByZWNvcmRlZCBwcmljZSBmb3IgYWNjdXJhdGUgY29sbGF0ZXJhbCByZWR1Y3Rpb24KICAgIC8vICAgICAgICAgb2xkX3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIHVzZXIubGFzdF9wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSA9IChuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBvbGRfdmFsdWUsICAjIG9sZCBVU0QgdmFsdWUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlLCAgIyBuZXcgVVNEIHZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBFbWl0IGV2ZW50cwogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldFdpdGhkcmF3KAogICAgLy8gICAgICMgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksIGFyYzQuVUludDY0KG1hcmtldF9pZCksIGFyYzQuVUludDI1NihhbW91bnQpCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIGFtb3VudCArIGludGVyZXN0CiAgICAvLyAKICAgIC8vICMgd2l0aGRyYXcgY29zdCA5MDAwMDAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYm9ycm93KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vIAogICAgLy8gICAgICMgU3luYyB0aGUgbWFya2V0IGJlaW5nIGJvcnJvd2VkIGZyb20gdG8gdXBkYXRlIGdsb2JhbCB2YWx1ZXMgd2l0aCBpbnRlcmVzdAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fYm9ycm93KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2JvcnJvdyhzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIEZhbHNlKQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgYm9ycm93IG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgKS5ib3Jyb3cubmF0aXZlCiAgICAvLyAgICAgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIkJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudCh1c2VyX2lkKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IFVJbnQ2NCgxMDAwMDApLCAiUGF5bWVudCBhbW91bnQgbXVzdCBiZSA+PSAwLjEiCiAgICAvLyAKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHVzZXIncyBjdXJyZW50IGRlYnQgaW50ZXJlc3QKICAgIC8vICAgICBkZWJ0X2ludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBjdXJyZW50IG1hcmtldCB0b3RhbCBib3Jyb3dzIChpbmNsdWRpbmcgaW50ZXJlc3QpCiAgICAvLyAgICAgY3VycmVudF9tYXJrZXRfdG90YWxfYm9ycm93cyA9ICgKICAgIC8vICAgICAgICAgbmV3X21hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB0b3RhbCBhbW91bnQgYmVpbmcgYWRkZWQgKG5ldyBib3Jyb3cgKyBkZWJ0IGludGVyZXN0KQogICAgLy8gICAgICMgZGVidCBpbnRlcmVzdCBhZGRlZCBhdCB0aGlzIHBvaW50IHRvIHByZXZlbnQgdW5uZWNlc3NhcnkgZGVidCByZXNldAogICAgLy8gICAgIHRvdGFsX2Ftb3VudF90b19hZGQgPSBhbW91bnQgKyBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIFZhbGlkYXRlIGFnYWluc3QgbWFya2V0LXdpZGUgYm9ycm93IGNhcAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG5ld19tYXJrZXQubWF4X3RvdGFsX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgID49IGN1cnJlbnRfbWFya2V0X3RvdGFsX2JvcnJvd3MgKyB0b3RhbF9hbW91bnRfdG9fYWRkCiAgICAvLyAgICAgKSwgIkJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICAjIENoZWNrIGNvbGxhdGVyYWwgcmVxdWlyZW1lbnRzIC0gZXhjbHVkZSBzYW1lIG1hcmtldCBjb2xsYXRlcmFsIHRvIHByZXZlbnQKICAgIC8vICAgICAjIGluZWZmaWNpZW50IHNhbWUtYXNzZXQgYm9ycm93aW5nCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgIG5ld19ib3Jyb3dfdmFsdWUgPSAodG90YWxfYW1vdW50X3RvX2FkZCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgIHRvdGFsX2JvcnJvd192YWx1ZSA9IGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgKyBuZXdfYm9ycm93X3ZhbHVlCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSBCaWdVSW50KDApOgogICAgLy8gICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSA9IGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlCiAgICAvLyAgICAgIyBVc2UgZWZmZWN0aXZlIGNvbGxhdGVyYWwgdmFsdWUgKGV4Y2x1ZGluZyBzYW1lLW1hcmtldCBkZXBvc2l0cykKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBkZXBvc2l0ZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIGV4Y2x1ZGVkX3ZhbHVlID0gKGRlcG9zaXRlZF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgaWYgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgPiBleGNsdWRlZF92YWx1ZToKICAgIC8vICAgICAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gKAogICAgLy8gICAgICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gZXhjbHVkZWRfdmFsdWUKICAgIC8vICAgICAgICAgICAgICkKICAgIC8vICAgICAgICAgZWxzZToKICAgIC8vICAgICAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gQmlnVUludCgwKQogICAgLy8gCiAgICAvLyAgICAgYXNzZXJ0IHRvdGFsX2JvcnJvd192YWx1ZSA8PSAoCiAgICAvLyAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlICogQmlnVUludChuZXdfbWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICAgICApIC8vIEJpZ1VJbnQoMTAwMDApLCAiSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgYWNyb3NzIG1hcmtldHMiCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBzY2FsZWQgYW1vdW50IGZvciB0aGUgdG90YWwKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gKHRvdGFsX2Ftb3VudF90b19hZGQgKiBTQ0FMRSkgLy8gbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCB1c2VyX2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gICAgIG5ld19ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgICAgICAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAvLyBTQ0FMRQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICBwcmljZV9mb3Jfb2xkID0gKAogICAgLy8gICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgcHJpY2VfZm9yX25ldyA9IG5ld19tYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICBvbGRfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld192YWx1ZSA9IChuZXdfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9uZXcpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIGJvcnJvdyBvcGVyYXRpb24KICAgIC8vICAgICB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgIGlmIHVzZXJfY2FwLnRvdGFsX2JvcnJvd3MubmF0aXZlID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgICAgIG5ld192YWx1ZSA8PSB1c2VyX2NhcC50b3RhbF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICAgICApLCAiVXNlciBib3Jyb3cgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGlmIHN0b2tlbiwgbWludCBzdG9rZW4KICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgU1Rva2VuLm1pbnQsCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgICAgIHJlY2VpdmVyPUFwcGxpY2F0aW9uKG1hcmtldF9pZCkuYWRkcmVzcywgYW1vdW50PTEwMDAwMCwgZmVlPTAKICAgIC8vICAgICAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgICMgaWYgYVRva2VuLCB0cmFuc2ZlciBhVG9rZW4KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0Qm9ycm93KAogICAgLy8gICAgICMgICAgICAgICB1c2VyPWFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgdG9rZW5faWQ9YXJjNC5VSW50NjQobWFya2V0X2lkKSwKICAgIC8vICAgICAjICAgICAgICAgYW1vdW50PWFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcmVwYXkoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX3JlcGF5KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3JlcGF5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUmVwYXkgYm9ycm93ZWQgdG9rZW5zIGZvciBhIHNwZWNpZmljIG1hcmtldC4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIGhhbmRsZXMgdGhlIHJlcGF5bWVudCBvZiBib3Jyb3dlZCB0b2tlbnMgd2l0aCBhIG1pbmltdW0gaW50ZXJlc3QKICAgIC8vICAgICByZXF1aXJlbWVudC4gSXQgc3VwcG9ydHMgYm90aCBzVG9rZW4gKGJ1cm4pIGFuZCBhVG9rZW4gKHRyYW5zZmVyKSBtYXJrZXRzLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZDogVGhlIHVzZXIgSUQgdG8gcmVwYXkgdG9rZW5zIGZvcgogICAgLy8gICAgICAgICBtYXJrZXRfaWQ6IFRoZSBtYXJrZXQgSUQgdG8gcmVwYXkgdG9rZW5zIGZvcgogICAgLy8gICAgICAgICBhbW91bnQ6IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIHJlcGF5IChtdXN0IGJlID49IGFjY3J1ZWQgaW50ZXJlc3QpCiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiBtYXJrZXQgdmFsaWRhdGlvbiBmYWlscywgcmVwYXkgYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidCwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICByZXBheSBhbW91bnQgaXMgbGVzcyB0aGFuIGFjY3J1ZWQgaW50ZXJlc3QsIG9yIHByaW5jaXBhbAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgIHJlcGF5bWVudCBleGNlZWRzIHNjYWxlZCBkZWJ0CiAgICAvLyAKICAgIC8vICAgICBQcm9jZXNzOgogICAgLy8gICAgICAgICAxLiBWYWxpZGF0ZXMgbWFya2V0IG9wZXJhdGlvbiBhbmQgYWNjcnVlcyBpbnRlcmVzdAogICAgLy8gICAgICAgICAyLiBDYWxjdWxhdGVzIHRvdGFsIGRlYnQgaW5jbHVkaW5nIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICAgICAgICAgMy4gVmFsaWRhdGVzIHJlcGF5IGFtb3VudCBkb2Vzbid0IGV4Y2VlZCB0b3RhbCBkZWJ0CiAgICAvLyAgICAgICAgIDQuIFJlcXVpcmVzIG1pbmltdW0gcmVwYXltZW50IG9mIGF0IGxlYXN0IHRoZSBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgICAgIDUuIENhbGN1bGF0ZXMgcHJpbmNpcGFsIHJlcGF5bWVudCAoYW1vdW50IC0gaW50ZXJlc3QpCiAgICAvLyAgICAgICAgIDYuIEJ1cm5zIHNUb2tlbnMgb3IgdHJhbnNmZXJzIGFUb2tlbnMgZnJvbSB1c2VyCiAgICAvLyAgICAgICAgIDcuIFVwZGF0ZXMgdXNlciBhbmQgbWFya2V0IHNjYWxlZCBib3Jyb3cgYW1vdW50cyAocHJpbmNpcGFsIG9ubHkpCiAgICAvLyAgICAgICAgIDguIFVwZGF0ZXMgZ2xvYmFsIGJvcnJvdyB2YWx1ZSB0cmFja2luZyB3aXRoIHByb3BlciBwcmljZSBoYW5kbGluZwogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIEZhbHNlKQogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHVzZXIncyBjdXJyZW50IGRlYnQgaW50ZXJlc3QKICAgIC8vICAgICBkZWJ0X2ludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB0b3RhbCBkZWJ0IGluY2x1ZGluZyBpbnRlcmVzdAogICAgLy8gICAgIHVuc2NhbGVkX2JvcnJvd3MgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIHRvdGFsX2RlYnQgPSB1bnNjYWxlZF9ib3Jyb3dzICsgZGVidF9pbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgIyBWYWxpZGF0ZSByZXBheSBhbW91bnQgZG9lc24ndCBleGNlZWQgdG90YWwgZGVidAogICAgLy8gICAgIGFzc2VydCBhbW91bnQgPD0gdG90YWxfZGVidCwgIlJlcGF5IGFtb3VudCBleGNlZWRzIHRvdGFsIGRlYnQiCiAgICAvLyAKICAgIC8vICAgICAjIFJlcXVpcmUgbWluaW11bSByZXBheW1lbnQgb2YgYXQgbGVhc3QgdGhlIGRlYnQgaW50ZXJlc3QKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBhbW91bnQgPj0gZGVidF9pbnRlcmVzdAogICAgLy8gICAgICksICJSZXBheSBhbW91bnQgbXVzdCBiZSBhdCBsZWFzdCB0aGUgYWNjcnVlZCBpbnRlcmVzdCIKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGhvdyBtdWNoIGdvZXMgdG93YXJkIHByaW5jaXBhbCByZXBheW1lbnQKICAgIC8vICAgICBwcmluY2lwYWxfcmVwYXltZW50ID0gYW1vdW50IC0gZGVidF9pbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgc2NhbGVkIGFtb3VudCBmb3IgcHJpbmNpcGFsIHJlcGF5bWVudCBvbmx5CiAgICAvLyAgICAgc2NhbGVkX2Ftb3VudCA9IChwcmluY2lwYWxfcmVwYXltZW50ICogU0NBTEUpIC8vIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgIGFzc2VydCB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBzY2FsZWRfYW1vdW50LCAiUmVwYXkgYW1vdW50IGV4Y2VlZHMgZGVidCIKICAgIC8vIAogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBTVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vIAogICAgLy8gICAgIG9sZF9ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZSAvLyBTQ0FMRQogICAgLy8gICAgICkKICAgIC8vICAgICBuZXdfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICAgICAgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgLy8gU0NBTEUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSBpZiB1c2VyIGRvZXNuJ3QgaGF2ZSBhIHByZXZpb3VzIHByaWNlCiAgICAvLyAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG5ld19tYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHByaWNlX2Zvcl9uZXcgPSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAgICAgb2xkX3ZhbHVlID0gKG9sZF9ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX29sZCkgLy8gU0NBTEUKICAgIC8vICAgICBuZXdfdmFsdWUgPSAobmV3X2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3JfbmV3KSAvLyBTQ0FMRQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBvbGRfdmFsdWUsICAjIG9sZCBVU0QgdmFsdWUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlLCAgIyBuZXcgVVNEIHZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0UmVwYXkoCiAgICAvLyAgICAgIyAgICAgICAgIHVzZXI9YXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQobWFya2V0X2lkKSwKICAgIC8vICAgICAjICAgICAgICAgYW1vdW50PWFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gIyBtaW50L3JlZGVlbSByZWxhdGVkIGNvZGUKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHJlZGVlbShzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICMgICAgIGVuc3VyZV9idWRnZXQoMTQwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICMgICAgIHNlbGYuX3JlZGVlbShtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcmVkZWVtKHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgLy8gCiAgICAvLyAjICAgICBhc3NlcnQgbm90IHNlbGYuX2hhc19wb3NpdGlvbigKICAgIC8vICMgICAgICAgICBUeG4uc2VuZGVyLCBtYXJrZXRfaWQKICAgIC8vICMgICAgICksICJDYW5ub3QgbWludC9yZWRlZW0gd2hlbiB1c2VyIGhhcyB0cmFja2VkIGRlcG9zaXQgcG9zaXRpb24iCiAgICAvLyAKICAgIC8vICMgICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgTlRva2VuLmJ1cm5fZnJvbSwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksCiAgICAvLyAjICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAjICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gIyAgICAgc2NhbGVkX2Ftb3VudCA9IChhbW91bnQgKiBTQ0FMRSkgLy8gbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAjICAgICBhc3NlcnQgKAogICAgLy8gIyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IHNjYWxlZF9hbW91bnQKICAgIC8vICMgICAgICksICJJbnN1ZmZpY2llbnQgbWFya2V0IGRlcG9zaXRzIHRvIHJlZGVlbSIKICAgIC8vICMgICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gIyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgbWludChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX21pbnQobWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX21pbnQoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICMgICAgIGFzc2VydCBub3Qgc2VsZi5faGFzX3Bvc2l0aW9uKAogICAgLy8gIyAgICAgICAgIFR4bi5zZW5kZXIsIG1hcmtldF9pZAogICAgLy8gIyAgICAgKSwgIkNhbm5vdCBtaW50L3JlZGVlbSB3aGVuIHVzZXIgaGFzIHRyYWNrZWQgZGVwb3NpdCBwb3NpdGlvbiIKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAjICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAjICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vICMgICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QoCiAgICAvLyAjICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAjICAgICApICAjIEdldCB1cGRhdGVkIG1hcmtldCB3aXRoIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICMgICAgIHNjYWxlZF9hbW91bnQgPSAoCiAgICAvLyAjICAgICAgICAgYW1vdW50ICogU0NBTEUKICAgIC8vICMgICAgICkgLy8gbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZSAgIyBDYWxjdWxhdGUgd2l0aCBuZXcgaW5kZXgKICAgIC8vIAogICAgLy8gIyAgICAgYXNzZXJ0ICgKICAgIC8vICMgICAgICAgICBuZXdfbWFya2V0Lm1heF90b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICMgICAgICAgICA+PSBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBzY2FsZWRfYW1vdW50CiAgICAvLyAjICAgICApLCAiRGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICMgICAgICMgT25seSBpbmNyZW1lbnQgbWFya2V0IHRvdGFsIGRlcG9zaXRzLCBub3QgdXNlciBkZXBvc2l0cyBzaW5jZSBwb3NpdGlvbiBpcyBub3QgdHJhY2tlZAogICAgLy8gIyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIE5Ub2tlbi5taW50LAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgICAgIE1pbnRFdmVudCgKICAgIC8vICMgICAgICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLCBhcmM0LlVJbnQyNTYoYW1vdW50KSwgYXJjNC5VSW50NjQobWFya2V0X2lkKQogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMTQwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgICAgIHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vIAogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpLmNvcHkoKQogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzID09IDAgYW5kIHVzZXIuc2NhbGVkX2JvcnJvd3MgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID4gMDoKICAgIC8vICAgICAgICAgZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICAjIFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSBpZiB1c2VyIGRvZXNuJ3QgaGF2ZSBhIHByZXZpb3VzIHByaWNlCiAgICAvLyAgICAgICAgIHByaWNlX2Zvcl9vbGQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgLy8gICAgICAgICAgICAgZWxzZSBtYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgb2xkX2RlcG9zaXRfdmFsdWUgPSAoZGVwb3NpdF9hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfZGVwb3NpdF92YWx1ZSA9IChkZXBvc2l0X2Ftb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICAgICAgICAgIHVzZXJfaWQsIG1hcmtldF9pZCwgb2xkX2RlcG9zaXRfdmFsdWUsIG5ld19kZXBvc2l0X3ZhbHVlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID4gMDoKICAgIC8vICAgICAgICAgYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICAjIFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSBpZiB1c2VyIGRvZXNuJ3QgaGF2ZSBhIHByZXZpb3VzIHByaWNlCiAgICAvLyAgICAgICAgIHByaWNlX2Zvcl9vbGQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgLy8gICAgICAgICAgICAgZWxzZSBtYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgb2xkX2JvcnJvd192YWx1ZSA9IChib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX29sZCkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X2JvcnJvd192YWx1ZSA9IChib3Jyb3dfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgICAgICAgICAgdXNlcl9pZCwgbWFya2V0X2lkLCBvbGRfYm9ycm93X3ZhbHVlLCBuZXdfYm9ycm93X3ZhbHVlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9nbG9iYWxfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IEdsb2JhbFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9nbG9iYWxfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBHbG9iYWxVc2VyRGF0YToKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYuZ2xvYmFsX3VzZXJzOgogICAgZnJhbWVfZGlnIC0xCiAgICBjb25jYXQKICAgIGR1cAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNjcKICAgIC8vIGlmIHVzZXJfaWQgaW4gc2VsZi5nbG9iYWxfdXNlcnM6CiAgICBieiBfZ2V0X2dsb2JhbF91c2VyX2Vsc2VfYm9keUAyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNjgKICAgIC8vIHJldHVybiBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXQogICAgZnJhbWVfZGlnIDAKICAgIGJveF9nZXQKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLmdsb2JhbF91c2VycyBlbnRyeSBleGlzdHMKICAgIHN3YXAKICAgIHJldHN1YgoKX2dldF9nbG9iYWxfdXNlcl9lbHNlX2JvZHlAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM3MAogICAgLy8gYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIGJ5dGUgMHg3MwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzcxCiAgICAvLyBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIGNoZWNrIEJveCBleGlzdHMKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM3Mi0yMzc0CiAgICAvLyBnbG9iYWxfdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X2dsb2JhbF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgbWV0aG9kICJnZXRfZ2xvYmFsX3VzZXJfZGVmYXVsdCgpKHVpbnQyNTYsdWludDI1Nix1aW50NjQpIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGR1cAogICAgZXh0cmFjdCA0IDAKICAgIHN3YXAKICAgIGV4dHJhY3QgMCA0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgID09CiAgICBhc3NlcnQgLy8gQVJDNCBwcmVmaXggaXMgdmFsaWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM3NQogICAgLy8gcmV0dXJuIGdsb2JhbF91c2VyCiAgICBzd2FwCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC53aXRoZHJhdyhtYXJrZXRfaWQ6IGJ5dGVzLCBhbW91bnQ6IGJ5dGVzKSAtPiBieXRlczoKd2l0aGRyYXc6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MzAtMTgzMQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgd2l0aGRyYXcoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IGFyYzQuVUludDI1NjoKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODMyCiAgICAvLyBlbnN1cmVfYnVkZ2V0KDIxMDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICBpbnQgMjEwMAogICAgaW50IDAKICAgIGNhbGxzdWIgZW5zdXJlX2J1ZGdldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODM0LTE4MzUKICAgIC8vICMgU3luYyB0aGUgbWFya2V0IGJlaW5nIHdpdGhkcmF3biBmcm9tIHRvIHVwZGF0ZSBnbG9iYWwgdmFsdWVzIHdpdGggaW50ZXJlc3QKICAgIC8vIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlKQogICAgdHhuIFNlbmRlcgogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICBkdXAKICAgIGNvdmVyIDIKICAgIGNhbGxzdWIgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODM3CiAgICAvLyByZXR1cm4gYXJjNC5VSW50MjU2KHNlbGYuX3dpdGhkcmF3KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpKQogICAgdHhuIFNlbmRlcgogICAgc3dhcAogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF93aXRoZHJhdwogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJldHN1YgoKCi8vIGFsZ29weS5lbnN1cmVfYnVkZ2V0KHJlcXVpcmVkX2J1ZGdldDogdWludDY0LCBmZWVfc291cmNlOiB1aW50NjQpIC0+IHZvaWQ6CmVuc3VyZV9idWRnZXQ6CiAgICAvLyA8YWxnb3B5Pi9hbGdvcHkucHk6MTEtMTcKICAgIHByb3RvIDIgMAogICAgLy8gPGFsZ29weT4vYWxnb3B5LnB5OjE4CiAgICBmcmFtZV9kaWcgLTIKICAgIGludCAxMAogICAgKwoKZW5zdXJlX2J1ZGdldF93aGlsZV90b3BAMToKICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weToxOQogICAgZnJhbWVfZGlnIDAKICAgIGdsb2JhbCBPcGNvZGVCdWRnZXQKICAgID4KICAgIGJ6IGVuc3VyZV9idWRnZXRfYWZ0ZXJfd2hpbGVANwogICAgLy8gPGFsZ29weT4vYWxnb3B5LnB5OjIwCiAgICBpdHhuX2JlZ2luCiAgICAvLyA8YWxnb3B5Pi9hbGdvcHkucHk6MjEKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICAvLyA8YWxnb3B5Pi9hbGdvcHkucHk6MjIKICAgIGludCBEZWxldGVBcHBsaWNhdGlvbgogICAgaXR4bl9maWVsZCBPbkNvbXBsZXRpb24KICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weToyMwogICAgYnl0ZSAweDA2ODEwMQogICAgaXR4bl9maWVsZCBBcHByb3ZhbFByb2dyYW0KICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weToyNAogICAgYnl0ZSAweDA2ODEwMQogICAgaXR4bl9maWVsZCBDbGVhclN0YXRlUHJvZ3JhbQogICAgLy8gPGFsZ29weT4vYWxnb3B5LnB5OjI1LTI5CiAgICBmcmFtZV9kaWcgLTEKICAgIHN3aXRjaCBlbnN1cmVfYnVkZ2V0X3N3aXRjaF9jYXNlXzBAMyBlbnN1cmVfYnVkZ2V0X3N3aXRjaF9jYXNlXzFANAogICAgYiBlbnN1cmVfYnVkZ2V0X3N3aXRjaF9jYXNlX25leHRANgoKZW5zdXJlX2J1ZGdldF9zd2l0Y2hfY2FzZV8wQDM6CiAgICAvLyA8YWxnb3B5Pi9hbGdvcHkucHk6MjcKICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgYiBlbnN1cmVfYnVkZ2V0X3N3aXRjaF9jYXNlX25leHRANgoKZW5zdXJlX2J1ZGdldF9zd2l0Y2hfY2FzZV8xQDQ6CiAgICAvLyA8YWxnb3B5Pi9hbGdvcHkucHk6MjkKICAgIGdsb2JhbCBNaW5UeG5GZWUKICAgIGl0eG5fZmllbGQgRmVlCgplbnN1cmVfYnVkZ2V0X3N3aXRjaF9jYXNlX25leHRANjoKICAgIC8vIDxhbGdvcHk+L2FsZ29weS5weTozMAogICAgaXR4bl9zdWJtaXQKICAgIGIgZW5zdXJlX2J1ZGdldF93aGlsZV90b3BAMQoKZW5zdXJlX2J1ZGdldF9hZnRlcl93aGlsZUA3OgogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQpIC0+IHZvaWQ6Cl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2U6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMTQtMjMxNwogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIGludCAwCiAgICBkdXBuIDUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMxOQogICAgLy8gdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkuY29weSgpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIGR1cAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzIwCiAgICAvLyBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9PSAwIGFuZCB1c2VyLnNjYWxlZF9ib3Jyb3dzID09IDA6CiAgICBleHRyYWN0IDAgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICBiPT0KICAgIGJ6IF91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2VfYWZ0ZXJfaWZfZWxzZUAzCiAgICBmcmFtZV9kaWcgNgogICAgZXh0cmFjdCAzMiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICBiPT0KICAgIGJ6IF91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2VfYWZ0ZXJfaWZfZWxzZUAzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMjEKICAgIC8vIHJldHVybgogICAgcmV0c3ViCgpfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlX2FmdGVyX2lmX2Vsc2VAMzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMyMwogICAgLy8gbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfYWNjcnVlX2ludGVyZXN0CiAgICBmcmFtZV9idXJ5IDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMyNQogICAgLy8gaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID4gMDoKICAgIGZyYW1lX2RpZyA3CiAgICBieXRlIDB4CiAgICBiPgogICAgYnogX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZV9hZnRlcl9pZl9lbHNlQDgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMyNwogICAgLy8gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICBmcmFtZV9kaWcgMgogICAgZXh0cmFjdCAxNzcgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgNwogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMyOAogICAgLy8gKSAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMyNi0yMzI4CiAgICAvLyBkZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICkgLy8gU0NBTEUKICAgIGIvCiAgICBmcmFtZV9idXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMzMgogICAgLy8gaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIGZyYW1lX2RpZyA2CiAgICBleHRyYWN0IDEzNiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA1CiAgICBieXRlIDB4CiAgICBiPgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzMxLTIzMzMKICAgIC8vIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIGJ6IF91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2VfdGVybmFyeV9mYWxzZUA2CiAgICBmcmFtZV9kaWcgNQogICAgYiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlX3Rlcm5hcnlfbWVyZ2VANwoKX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZV90ZXJuYXJ5X2ZhbHNlQDY6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMzMKICAgIC8vIGVsc2UgbWFya2V0LnByaWNlLm5hdGl2ZQogICAgZnJhbWVfZGlnIDIKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCgpfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlX3Rlcm5hcnlfbWVyZ2VANzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMzNQogICAgLy8gb2xkX2RlcG9zaXRfdmFsdWUgPSAoZGVwb3NpdF9hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDEKICAgIGR1cAogICAgdW5jb3ZlciAyCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMzYKICAgIC8vIG5ld19kZXBvc2l0X3ZhbHVlID0gKGRlcG9zaXRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIGZyYW1lX2RpZyAyCiAgICBpbnQgMjgxCiAgICBpbnQgMzIKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzM3LTIzMzkKICAgIC8vIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICB1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF9kZXBvc2l0X3ZhbHVlLCBuZXdfZGVwb3NpdF92YWx1ZQogICAgLy8gKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIHVuY292ZXIgMwogICAgdW5jb3ZlciAzCiAgICBjYWxsc3ViIF91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwKCl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2VfYWZ0ZXJfaWZfZWxzZUA4OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzQxCiAgICAvLyBpZiB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+IDA6CiAgICBmcmFtZV9kaWcgNgogICAgZXh0cmFjdCAzMiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSAzCiAgICBieXRlIDB4CiAgICBiPgogICAgYnogX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZV9hZnRlcl9pZl9lbHNlQDEzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNDMKICAgIC8vIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyAyCiAgICBleHRyYWN0IDIwOSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAzCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzQ0CiAgICAvLyApIC8vIFNDQUxFCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzQyLTIzNDQKICAgIC8vIGJvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gKSAvLyBTQ0FMRQogICAgYi8KICAgIGZyYW1lX2J1cnkgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzQ4CiAgICAvLyBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgZnJhbWVfZGlnIDYKICAgIGV4dHJhY3QgMTM2IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDQKICAgIGJ5dGUgMHgKICAgIGI+CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNDctMjM0OQogICAgLy8gdXNlci5sYXN0X3ByaWNlLm5hdGl2ZQogICAgLy8gaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vIGVsc2UgbWFya2V0LnByaWNlLm5hdGl2ZQogICAgYnogX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZV90ZXJuYXJ5X2ZhbHNlQDExCiAgICBmcmFtZV9kaWcgNAogICAgYiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlX3Rlcm5hcnlfbWVyZ2VAMTIKCl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2VfdGVybmFyeV9mYWxzZUAxMToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM0OQogICAgLy8gZWxzZSBtYXJrZXQucHJpY2UubmF0aXZlCiAgICBmcmFtZV9kaWcgMgogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKCl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2VfdGVybmFyeV9tZXJnZUAxMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM1MQogICAgLy8gb2xkX2JvcnJvd192YWx1ZSA9IChib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX29sZCkgLy8gU0NBTEUKICAgIGZyYW1lX2RpZyAwCiAgICBkdXAKICAgIHVuY292ZXIgMgogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzUyCiAgICAvLyBuZXdfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDIKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNTMtMjM1NQogICAgLy8gc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgIHVzZXJfaWQsIG1hcmtldF9pZCwgb2xkX2JvcnJvd192YWx1ZSwgbmV3X2JvcnJvd192YWx1ZQogICAgLy8gKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIHVuY292ZXIgMwogICAgdW5jb3ZlciAzCiAgICBjYWxsc3ViIF91cGRhdGVfZ2xvYmFsX2JvcnJvd3MKCl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2VfYWZ0ZXJfaWZfZWxzZUAxMzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM1NwogICAgLy8gdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2dldF91c2VyX2tleQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzU4CiAgICAvLyB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIGZyYW1lX2RpZyAyCiAgICBpbnQgMjgxCiAgICBpbnQgMzIKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIDYKICAgIHN3YXAKICAgIHJlcGxhY2UyIDEzNgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIxCiAgICAvLyBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIGJ5dGUgInVzZXJzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMzU5CiAgICAvLyBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICB1bmNvdmVyIDIKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cyh1c2VyX2lkOiBieXRlcywgbWFya2V0X2lkOiB1aW50NjQsIG9sZF92YWx1ZTogYnl0ZXMsIG5ld192YWx1ZTogYnl0ZXMpIC0+IHZvaWQ6Cl91cGRhdGVfZ2xvYmFsX2JvcnJvd3M6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzOTQtMjQwMQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBtYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBvbGRfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyAgICAgbmV3X3ZhbHVlOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gNCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MDIKICAgIC8vIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICBmcmFtZV9kaWcgLTQKICAgIGNhbGxzdWIgX2dldF9nbG9iYWxfdXNlcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDA1CiAgICAvLyBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIC0gb2xkX3ZhbHVlICsgbmV3X3ZhbHVlCiAgICBkdXAKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgLTIKICAgIGItCiAgICBmcmFtZV9kaWcgLTEKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MDQtMjQwNgogICAgLy8gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXBsYWNlMiAzMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDA3CiAgICAvLyBnbG9iYWxfdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICByZXBsYWNlMiA2NAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIyCiAgICAvLyBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIGJ5dGUgImdsb2JhbF91c2VycyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQwOQogICAgLy8gc2VsZi5nbG9iYWxfdXNlcnNbdXNlcl9pZF0gPSBnbG9iYWxfdXNlci5jb3B5KCkKICAgIGZyYW1lX2RpZyAtNAogICAgY29uY2F0CiAgICBzd2FwCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fd2l0aGRyYXcodXNlcl9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0LCBhbW91bnQ6IGJ5dGVzKSAtPiBieXRlczoKX3dpdGhkcmF3OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODM5LTE4NDIKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIHByb3RvIDMgMQogICAgaW50IDAKICAgIGR1cG4gMTcKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg2NgogICAgLy8gc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBpbnQgMQogICAgY2FsbHN1YiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODY4LTE4NzEKICAgIC8vICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIHdpdGhkcmF3IG9wZXJhdGlvbgogICAgLy8gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIG1hcmtldF9pZAogICAgLy8gKS53aXRoZHJhdy5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg3MgogICAgLy8gaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICBieXRlIDB4CiAgICBiPgogICAgYnogX3dpdGhkcmF3X2FmdGVyX2lmX2Vsc2VAMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODczCiAgICAvLyBhc3NlcnQgYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJXaXRoZHJhdyBjYXAgZXhjZWVkZWQiCiAgICBmcmFtZV9kaWcgLTEKICAgIGZyYW1lX2RpZyAxOAogICAgYjw9CiAgICBhc3NlcnQgLy8gV2l0aGRyYXcgY2FwIGV4Y2VlZGVkCgpfd2l0aGRyYXdfYWZ0ZXJfaWZfZWxzZUAyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODc1CiAgICAvLyBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfYWNjcnVlX2ludGVyZXN0CiAgICBmcmFtZV9idXJ5IDUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg3NgogICAgLy8gdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfdXNlcgogICAgZHVwCiAgICBmcmFtZV9idXJ5IDE1CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4NzgKICAgIC8vIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0CiAgICBmcmFtZV9idXJ5IDMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg4MgogICAgLy8gYW1vdW50IDw9IHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEzCiAgICBmcmFtZV9kaWcgLTEKICAgIGI+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODgwLTE4ODMKICAgIC8vICMgYW1vdW50IGlzIHRoZSBhbW91bnQgb2YgblRva2VucyBiZWluZyBidXJuZWQKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgYW1vdW50IDw9IHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgYXNzZXJ0IC8vIEluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4ODUKICAgIC8vIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF9nbG9iYWxfdXNlcgogICAgZHVwCiAgICBmcmFtZV9idXJ5IDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg4Ny0xODg4CiAgICAvLyAjIGhlYWx0aCBjaGVjazogZW5zdXJlIHdpdGhkcmF3IHdvdWxkIG5vdCBwdXQgYm9ycm93cyBhdCByaXNrCiAgICAvLyBpZiBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPiAwOgogICAgZXh0cmFjdCAzMiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA4CiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAogICAgYj4KICAgIGJ6IF93aXRoZHJhd19hZnRlcl9pZl9lbHNlQDQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg4OS0xODkwCiAgICAvLyAjIHZhbHVlIG9mIHVuZGVybHlpbmcgYW1vdW50IHRvIHdpdGhkcmF3IHVzaW5nIG5ldyBtYXJrZXQgcHJpY2UKICAgIC8vIHdpdGhkcmF3X3ZhbHVlID0gKGFtb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDUKICAgIGR1cAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyAtMQogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODkyCiAgICAvLyBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIHdpdGhkcmF3X3ZhbHVlCiAgICBmcmFtZV9kaWcgMgogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODkxLTE4OTMKICAgIC8vIHJlbWFpbmluZ19jb2xsYXRlcmFsID0gKAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gd2l0aGRyYXdfdmFsdWUKICAgIC8vICkKICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg5MgogICAgLy8gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSB3aXRoZHJhd192YWx1ZQogICAgYi0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg5NQogICAgLy8gcmVtYWluaW5nX2NvbGxhdGVyYWwgKiBCaWdVSW50KG5ld19tYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgc3dhcAogICAgZXh0cmFjdCA3MyA4IC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYnRvaQogICAgaXRvYgogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg5NgogICAgLy8gKSAvLyBCaWdVSW50KDEwMDAwKSwgIldpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzayIKICAgIGJ5dGUgMHgyNzEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4OTQtMTg5NgogICAgLy8gYXNzZXJ0IGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgPD0gKAogICAgLy8gICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsICogQmlnVUludChuZXdfbWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICkgLy8gQmlnVUludCgxMDAwMCksICJXaXRoZHJhd2FsIHdvdWxkIHB1dCBib3Jyb3dzIGF0IHJpc2siCiAgICBiLwogICAgZnJhbWVfZGlnIDgKICAgIGI+PQogICAgYXNzZXJ0IC8vIFdpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzawoKX3dpdGhkcmF3X2FmdGVyX2lmX2Vsc2VANDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg5OAogICAgLy8gc2VsZi5fZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHVzZXJfaWQsIGFtb3VudCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTg5OQogICAgLy8gc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBhbW91bnQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkwMS0xOTA2CiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIE5Ub2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTA0CiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMQogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGR1cAogICAgZnJhbWVfYnVyeSAxCiAgICBmcmFtZV9kaWcgLTEKICAgIGRpZyAxCiAgICBifAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTA1CiAgICAvLyBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIGZyYW1lX2RpZyA1CiAgICBkdXAKICAgIGNvdmVyIDMKICAgIGludCAzMTMKICAgIGludCA4CiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ0b2kKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTAxLTE5MDYKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgTlRva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG5ld19tYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyApCiAgICBtZXRob2QgImJ1cm5fZnJvbShhZGRyZXNzLHVpbnQyNTYpdm9pZCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTMKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkwOC0xOTEzCiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkxMQogICAgLy8gYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIGZyYW1lX2RpZyAtMQogICAgZnJhbWVfZGlnIDMKICAgIGR1cAogICAgY292ZXIgMwogICAgYisKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxMAogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgYnwKICAgIGZyYW1lX2RpZyAtMgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MDgtMTkxMwogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQgKyBpbnRlcmVzdCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyApCiAgICBtZXRob2QgImFyYzIwMF90cmFuc2ZlcihhZGRyZXNzLHVpbnQyNTYpYm9vbCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTMKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTE2CiAgICAvLyB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICBmcmFtZV9kaWcgMTUKICAgIGV4dHJhY3QgNjQgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgMTMKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MTcKICAgIC8vICkgLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MTUtMTkxNwogICAgLy8gb2xkX2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICkgLy8gU0NBTEUKICAgIGIvCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgNwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTE4CiAgICAvLyBuZXdfZGVwb3NpdF9hbW91bnQgPSBvbGRfZGVwb3NpdF9hbW91bnQgKyBpbnRlcmVzdCAtIGFtb3VudAogICAgYisKICAgIGZyYW1lX2RpZyAtMQogICAgYi0KICAgIGZyYW1lX2J1cnkgNAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTIwCiAgICAvLyBhbW91bnRfdXNkX3ZhbHVlID0gKGFtb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxMQogICAgZnJhbWVfZGlnIC0xCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICBmcmFtZV9idXJ5IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkyMi0xOTIzCiAgICAvLyAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIHdpdGhkcmF3IG9wZXJhdGlvbgogICAgLy8gdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X3VzZXJfY2FwCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMTYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkyNAogICAgLy8gaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9PSAwOgogICAgZXh0cmFjdCAxOTIgOCAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA5CiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMAogICAgYj09CiAgICBieiBfd2l0aGRyYXdfZWxzZV9ib2R5QDgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkyNQogICAgLy8gdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wICsgODY0MDApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpbnQgODY0MDAKICAgICsKICAgIGl0b2IKICAgIGZyYW1lX2RpZyAxNgogICAgc3dhcAogICAgcmVwbGFjZTIgMTkyCiAgICBmcmFtZV9idXJ5IDE2CiAgICBiIF93aXRoZHJhd19hZnRlcl9pZl9lbHNlQDExCgpfd2l0aGRyYXdfZWxzZV9ib2R5QDg6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MjYKICAgIC8vIGVsaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA8IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wOgogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgaXRvYgogICAgZnJhbWVfZGlnIDkKICAgIGI+CiAgICBmcmFtZV9kaWcgMTYKICAgIGZyYW1lX2J1cnkgMTcKICAgIGJ6IF93aXRoZHJhd19hZnRlcl9pZl9lbHNlQDEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MjcKICAgIC8vIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KDApCiAgICBmcmFtZV9kaWcgMTYKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICByZXBsYWNlMiA5NgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTI4CiAgICAvLyB1c2VyX2NhcC50b3RhbF9saXF1aWRhdGlvbnMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIGJ5dGUgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICByZXBsYWNlMiA2NAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTI5CiAgICAvLyB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGludCA4NjQwMAogICAgKwogICAgaXRvYgogICAgcmVwbGFjZTIgMTkyCiAgICBmcmFtZV9idXJ5IDE3Cgpfd2l0aGRyYXdfYWZ0ZXJfaWZfZWxzZUAxMDoKICAgIGZyYW1lX2RpZyAxNwogICAgZnJhbWVfYnVyeSAxNgoKX3dpdGhkcmF3X2FmdGVyX2lmX2Vsc2VAMTE6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MzAKICAgIC8vIGlmIHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZSA+IDA6CiAgICBmcmFtZV9kaWcgMTYKICAgIGV4dHJhY3QgMTYwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEyCiAgICBieXRlIDB4CiAgICBiPgogICAgYnogX3dpdGhkcmF3X2FmdGVyX2lmX2Vsc2VAMTMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkzMQogICAgLy8gbmV3X3RvdGFsX3dpdGhkcmF3YWxzID0gdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMubmF0aXZlICsgYW1vdW50X3VzZF92YWx1ZQogICAgZnJhbWVfZGlnIDE2CiAgICBkdXAKICAgIGV4dHJhY3QgOTYgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgMAogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkzMwogICAgLy8gbmV3X3RvdGFsX3dpdGhkcmF3YWxzIDw9IHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZQogICAgZHVwCiAgICBmcmFtZV9kaWcgMTIKICAgIGI8PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTMyLTE5MzQKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgbmV3X3RvdGFsX3dpdGhkcmF3YWxzIDw9IHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZQogICAgLy8gKSwgIlVzZXIgd2l0aGRyYXcgY2FwIGV4Y2VlZGVkIgogICAgYXNzZXJ0IC8vIFVzZXIgd2l0aGRyYXcgY2FwIGV4Y2VlZGVkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MzUKICAgIC8vIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KG5ld190b3RhbF93aXRoZHJhd2FscykKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGZyYW1lX2RpZyAxCiAgICBifAogICAgcmVwbGFjZTIgOTYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTkzNgogICAgLy8gc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQsIHVzZXJfY2FwKQogICAgZnJhbWVfZGlnIC0zCiAgICBzd2FwCiAgICBjYWxsc3ViIF9zZXRfdXNlcl9jYXAKICAgIHBvcAoKX3dpdGhkcmF3X2FmdGVyX2lmX2Vsc2VAMTM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5MzgKICAgIC8vIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPT0gMDoKICAgIGZyYW1lX2RpZyAxNQogICAgZXh0cmFjdCAxMzYgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMTQKICAgIGJ5dGUgMHgKICAgIGI9PQogICAgYnogX3dpdGhkcmF3X2Vsc2VfYm9keUAxNQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTM5LTE5NDAKICAgIC8vICMgRmFsbGJhY2s6IFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSB0byBwcmV2ZW50IG5lZ2F0aXZlIGNvbGxhdGVyYWwKICAgIC8vIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIGZyYW1lX2RpZyA3CiAgICBmcmFtZV9kaWcgMTEKICAgIGR1cAogICAgY292ZXIgMgogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTQxCiAgICAvLyBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICBmcmFtZV9kaWcgNAogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgZnJhbWVfYnVyeSA2CiAgICBiIF93aXRoZHJhd19hZnRlcl9pZl9lbHNlQDE2Cgpfd2l0aGRyYXdfZWxzZV9ib2R5QDE1OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTQzLTE5NDQKICAgIC8vICMgTm9ybWFsIGNhc2U6IFVzZSB1c2VyJ3MgbGFzdCByZWNvcmRlZCBwcmljZSBmb3IgYWNjdXJhdGUgY29sbGF0ZXJhbCByZWR1Y3Rpb24KICAgIC8vIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDcKICAgIGZyYW1lX2RpZyAxNAogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTQ1CiAgICAvLyBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICBmcmFtZV9kaWcgNAogICAgZnJhbWVfZGlnIDExCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICBmcmFtZV9idXJ5IDYKCl93aXRoZHJhd19hZnRlcl9pZl9lbHNlQDE2OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTQ3LTE5NTIKICAgIC8vIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICB1c2VyX2lkLAogICAgLy8gICAgIG1hcmtldF9pZCwKICAgIC8vICAgICBvbGRfdmFsdWUsICAjIG9sZCBVU0QgdmFsdWUKICAgIC8vICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC0yCiAgICB1bmNvdmVyIDIKICAgIGZyYW1lX2RpZyA2CiAgICBjYWxsc3ViIF91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk2MQogICAgLy8gcmV0dXJuIGFtb3VudCArIGludGVyZXN0CiAgICBmcmFtZV9kaWcgMTAKICAgIGZyYW1lX2J1cnkgMAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkOiB1aW50NjQsIHVzZXJfaWQ6IGJ5dGVzLCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0czoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE2My0xMTY2CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTY3CiAgICAvLyBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X21hcmtldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTY4CiAgICAvLyB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF91c2VyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNjkKICAgIC8vIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfdXNlcl9rZXkKICAgIGNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE3MQogICAgLy8gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgZHVwCiAgICBleHRyYWN0IDAgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2RpZyAtMQogICAgYj49CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNzAtMTE3MgogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICBhc3NlcnQgLy8gSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE3MwogICAgLy8gdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgZnJhbWVfZGlnIC0xCiAgICBiLQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE3NAogICAgLy8gdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIGRpZyAxCiAgICBleHRyYWN0IDE3NyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHJlcGxhY2UyIDY0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNzUKICAgIC8vIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgaXRvYgogICAgcmVwbGFjZTIgMTI4CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNzYKICAgIC8vIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIHN3YXAKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICByZXBsYWNlMiAxMzYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMQogICAgLy8gc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICBieXRlICJ1c2VycyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE3NwogICAgLy8gc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgdW5jb3ZlciAyCiAgICBjb25jYXQKICAgIHN3YXAKICAgIGJveF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDgzLTE0ODYKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDg3CiAgICAvLyBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfZ2V0X21hcmtldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDg5CiAgICAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIGR1cAogICAgZXh0cmFjdCAxMTMgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2RpZyAtMQogICAgYj49CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0ODgtMTQ5MAogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIGFzc2VydCAvLyBJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDkyCiAgICAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudAogICAgZnJhbWVfZGlnIC0xCiAgICBiLQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDkxLTE0OTMKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXBsYWNlMiAxMTMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ5NAogICAgLy8gc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBmcmFtZV9kaWcgLTIKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMAogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDk0CiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIHN3YXAKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuYm9ycm93KG1hcmtldF9pZDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6CmJvcnJvdzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk2NS0xOTY2CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBib3Jyb3coc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk2NwogICAgLy8gZW5zdXJlX2J1ZGdldCgyODAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgaW50IDI4MDAKICAgIGludCAwCiAgICBjYWxsc3ViIGVuc3VyZV9idWRnZXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk2OS0xOTcwCiAgICAvLyAjIFN5bmMgdGhlIG1hcmtldCBiZWluZyBib3Jyb3dlZCBmcm9tIHRvIHVwZGF0ZSBnbG9iYWwgdmFsdWVzIHdpdGggaW50ZXJlc3QKICAgIC8vIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlKQogICAgdHhuIFNlbmRlcgogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICBkdXAKICAgIGNvdmVyIDIKICAgIGNhbGxzdWIgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTcyCiAgICAvLyBzZWxmLl9ib3Jyb3coVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIHR4biBTZW5kZXIKICAgIHN3YXAKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfYm9ycm93CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fYm9ycm93KHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCwgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2JvcnJvdzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk3NC0xOTc1CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9ib3Jyb3coc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgaW50IDAKICAgIGR1cG4gMTQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk3NgogICAgLy8gc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgaW50IDAKICAgIGNhbGxzdWIgX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk3OC0xOTgxCiAgICAvLyAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBib3Jyb3cgb3BlcmF0aW9uCiAgICAvLyBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgbWFya2V0X2lkCiAgICAvLyApLmJvcnJvdy5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIGV4dHJhY3QgNjQgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk4MgogICAgLy8gaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICBieXRlIDB4CiAgICBiPgogICAgYnogX2JvcnJvd19hZnRlcl9pZl9lbHNlQDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk4MwogICAgLy8gYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIGZyYW1lX2RpZyAtMQogICAgZnJhbWVfZGlnIDE1CiAgICBiPD0KICAgIGFzc2VydCAvLyBCb3Jyb3cgY2FwIGV4Y2VlZGVkCgpfYm9ycm93X2FmdGVyX2lmX2Vsc2VAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk4NQogICAgLy8gdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfdXNlcgogICAgZHVwCiAgICBmcmFtZV9idXJ5IDE0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE5ODcKICAgIC8vIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQodXNlcl9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiByZXF1aXJlX3BheW1lbnQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk4OAogICAgLy8gYXNzZXJ0IHBheW1lbnQgPj0gVUludDY0KDEwMDAwMCksICJQYXltZW50IGFtb3VudCBtdXN0IGJlID49IDAuMSIKICAgIGludCAxMDAwMDAKICAgID49CiAgICBhc3NlcnQgLy8gUGF5bWVudCBhbW91bnQgbXVzdCBiZSA+PSAwLjEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk5MAogICAgLy8gbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2FjY3J1ZV9pbnRlcmVzdAogICAgZHVwCiAgICBmcmFtZV9idXJ5IDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk5Mi0xOTkzCiAgICAvLyAjIENhbGN1bGF0ZSB1c2VyJ3MgY3VycmVudCBkZWJ0IGludGVyZXN0CiAgICAvLyBkZWJ0X2ludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdAogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxOTk3CiAgICAvLyBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgZHVwCiAgICBleHRyYWN0IDE0NSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHN3YXAKICAgIGR1cAogICAgZXh0cmFjdCAyMDkgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMTEKICAgIHVuY292ZXIgMgogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk5OAogICAgLy8gKSAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTk5NS0xOTk4CiAgICAvLyAjIENhbGN1bGF0ZSBjdXJyZW50IG1hcmtldCB0b3RhbCBib3Jyb3dzIChpbmNsdWRpbmcgaW50ZXJlc3QpCiAgICAvLyBjdXJyZW50X21hcmtldF90b3RhbF9ib3Jyb3dzID0gKAogICAgLy8gICAgIG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyApIC8vIFNDQUxFCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDAwLTIwMDIKICAgIC8vICMgQ2FsY3VsYXRlIHRvdGFsIGFtb3VudCBiZWluZyBhZGRlZCAobmV3IGJvcnJvdyArIGRlYnQgaW50ZXJlc3QpCiAgICAvLyAjIGRlYnQgaW50ZXJlc3QgYWRkZWQgYXQgdGhpcyBwb2ludCB0byBwcmV2ZW50IHVubmVjZXNzYXJ5IGRlYnQgcmVzZXQKICAgIC8vIHRvdGFsX2Ftb3VudF90b19hZGQgPSBhbW91bnQgKyBkZWJ0X2ludGVyZXN0CiAgICBmcmFtZV9kaWcgLTEKICAgIHVuY292ZXIgMwogICAgYisKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDA2CiAgICAvLyBuZXdfbWFya2V0Lm1heF90b3RhbF9ib3Jyb3dzLm5hdGl2ZQogICAgZGlnIDIKICAgIGV4dHJhY3QgMzMgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMDcKICAgIC8vID49IGN1cnJlbnRfbWFya2V0X3RvdGFsX2JvcnJvd3MgKyB0b3RhbF9hbW91bnRfdG9fYWRkCiAgICB1bmNvdmVyIDIKICAgIGRpZyAxCiAgICBiKwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDA2LTIwMDcKICAgIC8vIG5ld19tYXJrZXQubWF4X3RvdGFsX2JvcnJvd3MubmF0aXZlCiAgICAvLyA+PSBjdXJyZW50X21hcmtldF90b3RhbF9ib3Jyb3dzICsgdG90YWxfYW1vdW50X3RvX2FkZAogICAgdW5jb3ZlciAyCiAgICBiPD0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAwNC0yMDA4CiAgICAvLyAjIFZhbGlkYXRlIGFnYWluc3QgbWFya2V0LXdpZGUgYm9ycm93IGNhcAogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBuZXdfbWFya2V0Lm1heF90b3RhbF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgID49IGN1cnJlbnRfbWFya2V0X3RvdGFsX2JvcnJvd3MgKyB0b3RhbF9hbW91bnRfdG9fYWRkCiAgICAvLyApLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIGFzc2VydCAvLyBCb3Jyb3cgY2FwIGV4Y2VlZGVkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMTAtMjAxMgogICAgLy8gIyBDaGVjayBjb2xsYXRlcmFsIHJlcXVpcmVtZW50cyAtIGV4Y2x1ZGUgc2FtZSBtYXJrZXQgY29sbGF0ZXJhbCB0byBwcmV2ZW50CiAgICAvLyAjIGluZWZmaWNpZW50IHNhbWUtYXNzZXQgYm9ycm93aW5nCiAgICAvLyBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfZ2xvYmFsX3VzZXIKICAgIGR1cAogICAgY292ZXIgNAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDE0CiAgICAvLyBuZXdfYm9ycm93X3ZhbHVlID0gKHRvdGFsX2Ftb3VudF90b19hZGQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIHVuY292ZXIgMgogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA2CiAgICB1bmNvdmVyIDIKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAxNQogICAgLy8gdG90YWxfYm9ycm93X3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSArIG5ld19ib3Jyb3dfdmFsdWUKICAgIHN3YXAKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBiKwogICAgZnJhbWVfYnVyeSAxMwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDE3LTIwMTgKICAgIC8vICMgQ2FsY3VsYXRlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gQmlnVUludCgwKToKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA3CiAgICBieXRlIDB4CiAgICBiPT0KICAgIGJ6IF9ib3Jyb3dfZWxzZV9ib2R5QDQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAxOQogICAgLy8gZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZQogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgYiBfYm9ycm93X2FmdGVyX2lmX2Vsc2VAOAoKX2JvcnJvd19lbHNlX2JvZHlANDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAyMwogICAgLy8gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgZnJhbWVfZGlnIDIKICAgIGV4dHJhY3QgMTc3IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIDcKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMjQKICAgIC8vICkgLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMjItMjAyNAogICAgLy8gZGVwb3NpdGVkX2Ftb3VudCA9ICgKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyApIC8vIFNDQUxFCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDI1CiAgICAvLyBleGNsdWRlZF92YWx1ZSA9IChkZXBvc2l0ZWRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICBmcmFtZV9kaWcgNgogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAyNgogICAgLy8gaWYgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgPiBleGNsdWRlZF92YWx1ZToKICAgIHN3YXAKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSA4CiAgICBiPAogICAgYnogX2JvcnJvd19lbHNlX2JvZHlANgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDI3LTIwMjkKICAgIC8vIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gKAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gZXhjbHVkZWRfdmFsdWUKICAgIC8vICkKICAgIGZyYW1lX2RpZyA4CiAgICBmcmFtZV9kaWcgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDI4CiAgICAvLyBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIGV4Y2x1ZGVkX3ZhbHVlCiAgICBiLQogICAgYiBfYm9ycm93X2FmdGVyX2lmX2Vsc2VAOAoKX2JvcnJvd19lbHNlX2JvZHlANjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAzMQogICAgLy8gZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSBCaWdVSW50KDApCiAgICBieXRlIDB4CgpfYm9ycm93X2FmdGVyX2lmX2Vsc2VAODoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAzNAogICAgLy8gZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgKiBCaWdVSW50KG5ld19tYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgZnJhbWVfZGlnIDIKICAgIGV4dHJhY3QgNzMgOCAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ0b2kKICAgIGl0b2IKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMzUKICAgIC8vICkgLy8gQmlnVUludCgxMDAwMCksICJJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCBhY3Jvc3MgbWFya2V0cyIKICAgIGJ5dGUgMHgyNzEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwMzMtMjAzNQogICAgLy8gYXNzZXJ0IHRvdGFsX2JvcnJvd192YWx1ZSA8PSAoCiAgICAvLyAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgKiBCaWdVSW50KG5ld19tYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgLy8gKSAvLyBCaWdVSW50KDEwMDAwKSwgIkluc3VmZmljaWVudCBjb2xsYXRlcmFsIGFjcm9zcyBtYXJrZXRzIgogICAgYi8KICAgIGZyYW1lX2RpZyAxMwogICAgYj49CiAgICBhc3NlcnQgLy8gSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgYWNyb3NzIG1hcmtldHMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjAzNy0yMDM4CiAgICAvLyAjIENhbGN1bGF0ZSBzY2FsZWQgYW1vdW50IGZvciB0aGUgdG90YWwKICAgIC8vIHNjYWxlZF9hbW91bnQgPSAodG90YWxfYW1vdW50X3RvX2FkZCAqIFNDQUxFKSAvLyBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyAxMgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIqCiAgICBmcmFtZV9kaWcgMTEKICAgIGR1cAogICAgY292ZXIgMgogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA0MAogICAgLy8gc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0zCiAgICBkaWcgMgogICAgY2FsbHN1YiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNDEKICAgIC8vIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgZnJhbWVfZGlnIC0yCiAgICBkaWcgMQogICAgY2FsbHN1YiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDQ0CiAgICAvLyB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDE0CiAgICBkdXAKICAgIGNvdmVyIDMKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGRpZyAzCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNDMtMjA0NQogICAgLy8gb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgLy8gU0NBTEUKICAgIC8vICkKICAgIGZyYW1lX2J1cnkgNAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDQ3CiAgICAvLyAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBzY2FsZWRfYW1vdW50KQogICAgYisKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA0Ny0yMDQ4CiAgICAvLyAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBzY2FsZWRfYW1vdW50KQogICAgLy8gKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNDkKICAgIC8vIC8vIFNDQUxFCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDQ3LTIwNDkKICAgIC8vICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQpCiAgICAvLyAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gLy8gU0NBTEUKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNDYtMjA1MAogICAgLy8gbmV3X2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgIC8vIFNDQUxFCiAgICAvLyApCiAgICBmcmFtZV9idXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA1NQogICAgLy8gaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIGV4dHJhY3QgMTM2IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDkKICAgIGJ5dGUgMHgKICAgIGI+CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNTQtMjA1NgogICAgLy8gdXNlci5sYXN0X3ByaWNlLm5hdGl2ZQogICAgLy8gaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vIGVsc2UgbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIGJ6IF9ib3Jyb3dfdGVybmFyeV9mYWxzZUAxMAogICAgZnJhbWVfZGlnIDkKICAgIGIgX2JvcnJvd190ZXJuYXJ5X21lcmdlQDExCgpfYm9ycm93X3Rlcm5hcnlfZmFsc2VAMTA6CiAgICBmcmFtZV9kaWcgNgoKX2JvcnJvd190ZXJuYXJ5X21lcmdlQDExOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDYwCiAgICAvLyBvbGRfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDQKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIGZyYW1lX2J1cnkgNQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDYxCiAgICAvLyBuZXdfdmFsdWUgPSAobmV3X2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3JfbmV3KSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDEKICAgIGZyYW1lX2RpZyA2CiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICBmcmFtZV9idXJ5IDMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA2My0yMDY0CiAgICAvLyAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIGJvcnJvdyBvcGVyYXRpb24KICAgIC8vIHVzZXJfY2FwID0gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF91c2VyX2NhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDY1CiAgICAvLyBpZiB1c2VyX2NhcC50b3RhbF9ib3Jyb3dzLm5hdGl2ZSA+IDA6CiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEwCiAgICBieXRlIDB4CiAgICBiPgogICAgYnogX2JvcnJvd19hZnRlcl9pZl9lbHNlQDEzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNjcKICAgIC8vIG5ld192YWx1ZSA8PSB1c2VyX2NhcC50b3RhbF9ib3Jyb3dzLm5hdGl2ZQogICAgZnJhbWVfZGlnIDMKICAgIGZyYW1lX2RpZyAxMAogICAgYjw9CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNjYtMjA2OAogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBuZXdfdmFsdWUgPD0gdXNlcl9jYXAudG90YWxfYm9ycm93cy5uYXRpdmUKICAgIC8vICksICJVc2VyIGJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICBhc3NlcnQgLy8gVXNlciBib3Jyb3cgY2FwIGV4Y2VlZGVkCgpfYm9ycm93X2FmdGVyX2lmX2Vsc2VAMTM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNzAtMjA3NQogICAgLy8gc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgIHVzZXJfaWQsCiAgICAvLyAgICAgbWFya2V0X2lkLAogICAgLy8gICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgIG5ld192YWx1ZSwgICMgbmV3IFVTRCB2YWx1ZQogICAgLy8gKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyA1CiAgICBmcmFtZV9kaWcgMwogICAgY2FsbHN1YiBfdXBkYXRlX2dsb2JhbF9ib3Jyb3dzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNzctMjA3OAogICAgLy8gIyBpZiBzdG9rZW4sIG1pbnQgc3Rva2VuCiAgICAvLyBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAxOAogICAgLy8gc2VsZi5zdG9rZW5fYXBwX2lkID0gVUludDY0KCkgICMgc3RhYmxlIG1hcmtldAogICAgYnl0ZSAic3Rva2VuX2FwcF9pZCIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA3Ny0yMDc4CiAgICAvLyAjIGlmIHN0b2tlbiwgbWludCBzdG9rZW4KICAgIC8vIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYuc3Rva2VuX2FwcF9pZCBleGlzdHMKICAgIGZyYW1lX2RpZyAtMgogICAgPT0KICAgIGJ6IF9ib3Jyb3dfZWxzZV9ib2R5QDE3CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwNzktMjA4NAogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBTVG9rZW4ubWludCwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyApCiAgICBpdHhuX2JlZ2luCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwODIKICAgIC8vIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgZnJhbWVfZGlnIC0xCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgZnJhbWVfZGlnIC0xCiAgICBifAogICAgZnJhbWVfZGlnIC0yCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA3OS0yMDg0CiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIFNUb2tlbi5taW50LAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICkKICAgIG1ldGhvZCAibWludChhZGRyZXNzLHVpbnQyNTYpdm9pZCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTMKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA4NS0yMDg3CiAgICAvLyBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgLy8gKS5zdWJtaXQoKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDg2CiAgICAvLyByZWNlaXZlcj1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAsIGZlZT0wCiAgICBmcmFtZV9kaWcgLTIKICAgIGFwcF9wYXJhbXNfZ2V0IEFwcEFkZHJlc3MKICAgIGFzc2VydCAvLyBhcHBsaWNhdGlvbiBleGlzdHMKICAgIGludCAxMDAwMDAKICAgIGl0eG5fZmllbGQgQW1vdW50CiAgICBpdHhuX2ZpZWxkIFJlY2VpdmVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwODUKICAgIC8vIGl0eG4uUGF5bWVudCgKICAgIGludCBwYXkKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjA4NgogICAgLy8gcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwODUtMjA4NwogICAgLy8gaXR4bi5QYXltZW50KAogICAgLy8gICAgIHJlY2VpdmVyPUFwcGxpY2F0aW9uKG1hcmtldF9pZCkuYWRkcmVzcywgYW1vdW50PTEwMDAwMCwgZmVlPTAKICAgIC8vICkuc3VibWl0KCkKICAgIGl0eG5fc3VibWl0CiAgICBiIF9ib3Jyb3dfYWZ0ZXJfaWZfZWxzZUAxOQoKX2JvcnJvd19lbHNlX2JvZHlAMTc6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwOTAtMjA5NQogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMDkzCiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMQogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGZyYW1lX2RpZyAtMQogICAgYnwKICAgIGZyYW1lX2RpZyAtMgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIwOTAtMjA5NQogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgbWV0aG9kICJhcmMyMDBfdHJhbnNmZXIoYWRkcmVzcyx1aW50MjU2KWJvb2wiCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgZnJhbWVfZGlnIC0zCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGV4dHJhY3QgMCA0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgID09CiAgICBhc3NlcnQgLy8gQVJDNCBwcmVmaXggaXMgdmFsaWQKCl9ib3Jyb3dfYWZ0ZXJfaWZfZWxzZUAxOToKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkxlbmRpbmdQb29sLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IHVpbnQ2NCkgLT4gYnl0ZXM6Cl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODAzLTE4MDYKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIHByb3RvIDIgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODA4CiAgICAvLyBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfYWNjcnVlX2ludGVyZXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MDkKICAgIC8vIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTgxMwogICAgLy8gdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIGR1cAogICAgZXh0cmFjdCAzMiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgY292ZXIgMwogICAgdW5jb3ZlciAyCiAgICBleHRyYWN0IDIwOSAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgY292ZXIgMwogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTgxNAogICAgLy8gKSAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTgxMS0xODE0CiAgICAvLyAjIENhbGN1bGF0ZSB0b3RhbCB1bmRlcmx5aW5nIGRlYnQgYW1vdW50CiAgICAvLyB1c2VyX3RvdGFsX2RlYnQgPSAoCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICkgLy8gU0NBTEUKICAgIGIvCiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MjAKICAgIC8vIGlmIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZSA+IDAKICAgIGV4dHJhY3QgOTYgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGJ5dGUgMHgKICAgIGI+CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MTktMTgyMQogICAgLy8gdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyBpZiB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUgPiAwCiAgICAvLyBlbHNlIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgYnogX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3RfdGVybmFyeV9mYWxzZUAyCiAgICBmcmFtZV9kaWcgMwogICAgYiBfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdF90ZXJuYXJ5X21lcmdlQDMKCl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0X3Rlcm5hcnlfZmFsc2VAMjoKICAgIGZyYW1lX2RpZyAxCgpfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdF90ZXJuYXJ5X21lcmdlQDM6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE4MjMKICAgIC8vIG9yaWdpbmFsX3ByaW5jaXBhbCA9ICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHVzZXJfYm9ycm93X2luZGV4KSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDAKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTgyNS0xODI2CiAgICAvLyAjIEludGVyZXN0IGlzIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gY3VycmVudCB0b3RhbCBkZWJ0IGFuZCBvcmlnaW5hbCBwcmluY2lwYWwKICAgIC8vIGRlYnRfaW50ZXJlc3QgPSB1c2VyX3RvdGFsX2RlYnQgLSBvcmlnaW5hbF9wcmluY2lwYWwKICAgIGZyYW1lX2RpZyAyCiAgICBzd2FwCiAgICBiLQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxODI4CiAgICAvLyByZXR1cm4gZGVidF9pbnRlcmVzdAogICAgZnJhbWVfYnVyeSAwCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZDogdWludDY0LCB1c2VyX2lkOiBieXRlcywgYW1vdW50OiBieXRlcykgLT4gdm9pZDoKX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93czoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE1MC0xMTUzCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMyAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNTQKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNTUKICAgIC8vIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE1NgogICAgLy8gdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF91c2VyX2tleQogICAgY292ZXIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTU3CiAgICAvLyB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgZHVwCiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZnJhbWVfZGlnIC0xCiAgICBiKwogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDMyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNTgKICAgIC8vIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgZGlnIDEKICAgIGV4dHJhY3QgMjA5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgcmVwbGFjZTIgOTYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE1OQogICAgLy8gdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICByZXBsYWNlMiAxMjgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE2MAogICAgLy8gdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgc3dhcAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHJlcGxhY2UyIDEzNgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIxCiAgICAvLyBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIGJ5dGUgInVzZXJzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTYxCiAgICAvLyBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICB1bmNvdmVyIDIKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDk2LTE0OTkKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MDAKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MDIKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQKICAgIGR1cAogICAgZXh0cmFjdCAxNDUgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgLTEKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MDEtMTUwMwogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXBsYWNlMiAxNDUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUwNAogICAgLy8gbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGl0b2IKICAgIHJlcGxhY2UyIDI0MQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTA1CiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIGZyYW1lX2RpZyAtMgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIwCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MDUKICAgIC8vIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgc3dhcAogICAgY29uY2F0CiAgICBzd2FwCiAgICBib3hfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5yZXBheShtYXJrZXRfaWQ6IGJ5dGVzLCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpyZXBheToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjEwNS0yMTA2CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiByZXBheShzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIHByb3RvIDIgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTA3CiAgICAvLyBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICBpbnQgMTQwMAogICAgaW50IDAKICAgIGNhbGxzdWIgZW5zdXJlX2J1ZGdldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTA4CiAgICAvLyBzZWxmLl9yZXBheShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgdHhuIFNlbmRlcgogICAgZnJhbWVfZGlnIC0yCiAgICBidG9pCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgX3JlcGF5CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fcmVwYXkodXNlcl9pZDogYnl0ZXMsIG1hcmtldF9pZDogdWludDY0LCBhbW91bnQ6IGJ5dGVzKSAtPiB2b2lkOgpfcmVwYXk6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxMTAtMjExMQogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgaW50IDAKICAgIGR1cG4gMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTM4CiAgICAvLyBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBGYWxzZSkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBpbnQgMAogICAgY2FsbHN1YiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTQwCiAgICAvLyB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2dldF91c2VyCiAgICBkdXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE0MQogICAgLy8gbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGNhbGxzdWIgX2FjY3J1ZV9pbnRlcmVzdAogICAgZHVwCiAgICB1bmNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE0My0yMTQ0CiAgICAvLyAjIENhbGN1bGF0ZSB1c2VyJ3MgY3VycmVudCBkZWJ0IGludGVyZXN0CiAgICAvLyBkZWJ0X2ludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgY2FsbHN1YiBfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdAogICAgY292ZXIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTQ4CiAgICAvLyB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgZXh0cmFjdCAzMiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgY292ZXIgMwogICAgc3dhcAogICAgZXh0cmFjdCAyMDkgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGNvdmVyIDMKICAgIGR1cDIKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNDkKICAgIC8vICkgLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNDYtMjE0OQogICAgLy8gIyBDYWxjdWxhdGUgdG90YWwgZGVidCBpbmNsdWRpbmcgaW50ZXJlc3QKICAgIC8vIHVuc2NhbGVkX2JvcnJvd3MgPSAoCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICkgLy8gU0NBTEUKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNTAKICAgIC8vIHRvdGFsX2RlYnQgPSB1bnNjYWxlZF9ib3Jyb3dzICsgZGVidF9pbnRlcmVzdAogICAgZGlnIDMKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNTItMjE1MwogICAgLy8gIyBWYWxpZGF0ZSByZXBheSBhbW91bnQgZG9lc24ndCBleGNlZWQgdG90YWwgZGVidAogICAgLy8gYXNzZXJ0IGFtb3VudCA8PSB0b3RhbF9kZWJ0LCAiUmVwYXkgYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidCIKICAgIGZyYW1lX2RpZyAtMQogICAgYj49CiAgICBhc3NlcnQgLy8gUmVwYXkgYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTU3CiAgICAvLyBhbW91bnQgPj0gZGVidF9pbnRlcmVzdAogICAgZnJhbWVfZGlnIC0xCiAgICBkaWcgMwogICAgYj49CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNTUtMjE1OAogICAgLy8gIyBSZXF1aXJlIG1pbmltdW0gcmVwYXltZW50IG9mIGF0IGxlYXN0IHRoZSBkZWJ0IGludGVyZXN0CiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIGFtb3VudCA+PSBkZWJ0X2ludGVyZXN0CiAgICAvLyApLCAiUmVwYXkgYW1vdW50IG11c3QgYmUgYXQgbGVhc3QgdGhlIGFjY3J1ZWQgaW50ZXJlc3QiCiAgICBhc3NlcnQgLy8gUmVwYXkgYW1vdW50IG11c3QgYmUgYXQgbGVhc3QgdGhlIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE2MC0yMTYxCiAgICAvLyAjIENhbGN1bGF0ZSBob3cgbXVjaCBnb2VzIHRvd2FyZCBwcmluY2lwYWwgcmVwYXltZW50CiAgICAvLyBwcmluY2lwYWxfcmVwYXltZW50ID0gYW1vdW50IC0gZGVidF9pbnRlcmVzdAogICAgZnJhbWVfZGlnIC0xCiAgICB1bmNvdmVyIDMKICAgIGItCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNjMtMjE2NAogICAgLy8gIyBDYWxjdWxhdGUgc2NhbGVkIGFtb3VudCBmb3IgcHJpbmNpcGFsIHJlcGF5bWVudCBvbmx5CiAgICAvLyBzY2FsZWRfYW1vdW50ID0gKHByaW5jaXBhbF9yZXBheW1lbnQgKiBTQ0FMRSkgLy8gbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYioKICAgIHN3YXAKICAgIGIvCiAgICBkdXAKICAgIGNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE2NQogICAgLy8gYXNzZXJ0IHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IHNjYWxlZF9hbW91bnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyBkZWJ0IgogICAgYj49CiAgICBhc3NlcnQgLy8gUmVwYXkgYW1vdW50IGV4Y2VlZHMgZGVidAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTY3CiAgICAvLyBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAxOAogICAgLy8gc2VsZi5zdG9rZW5fYXBwX2lkID0gVUludDY0KCkgICMgc3RhYmxlIG1hcmtldAogICAgYnl0ZSAic3Rva2VuX2FwcF9pZCIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE2NwogICAgLy8gaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5zdG9rZW5fYXBwX2lkIGV4aXN0cwogICAgZnJhbWVfZGlnIC0yCiAgICA9PQogICAgYnogX3JlcGF5X2Vsc2VfYm9keUAzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNjgtMjE3MwogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBTVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE3MQogICAgLy8gYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICBmcmFtZV9kaWcgLTEKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ8CiAgICBmcmFtZV9kaWcgLTIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTY4LTIxNzMKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgU1Rva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyApCiAgICBtZXRob2QgImJ1cm5fZnJvbShhZGRyZXNzLHVpbnQyNTYpdm9pZCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTMKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGIgX3JlcGF5X2FmdGVyX2lmX2Vsc2VANQoKX3JlcGF5X2Vsc2VfYm9keUAzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTc1LTIxODEKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTc4CiAgICAvLyBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICBnbG9iYWwgQ3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTc5CiAgICAvLyBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIGZyYW1lX2RpZyAtMQogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGZyYW1lX2RpZyAtMQogICAgYnwKICAgIGZyYW1lX2RpZyAtMgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxNzUtMjE4MQogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyApCiAgICBtZXRob2QgImFyYzIwMF90cmFuc2ZlckZyb20oYWRkcmVzcyxhZGRyZXNzLHVpbnQyNTYpYm9vbCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTMKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBzd2FwCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGV4dHJhY3QgMCA0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgID09CiAgICBhc3NlcnQgLy8gQVJDNCBwcmVmaXggaXMgdmFsaWQKCl9yZXBheV9hZnRlcl9pZl9lbHNlQDU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxODMKICAgIC8vIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICBmcmFtZV9kaWcgLTIKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIDcKICAgIGR1cAogICAgY292ZXIgMwogICAgY2FsbHN1YiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxODQKICAgIC8vIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgZnJhbWVfZGlnIC0yCiAgICBkaWcgMQogICAgY2FsbHN1YiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTg3CiAgICAvLyB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDMKICAgIGR1cAogICAgY292ZXIgMgogICAgZXh0cmFjdCA5NiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGZyYW1lX2RpZyA1CiAgICBkdXAKICAgIHVuY292ZXIgMgogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTg2LTIxODgKICAgIC8vIG9sZF9ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlIC8vIFNDQUxFCiAgICAvLyApCiAgICBmcmFtZV9idXJ5IDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE5MAogICAgLy8gKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gc2NhbGVkX2Ftb3VudCkKICAgIHN3YXAKICAgIGItCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxOTAtMjE5MQogICAgLy8gKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gc2NhbGVkX2Ftb3VudCkKICAgIC8vICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICBmcmFtZV9kaWcgNgogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE5MgogICAgLy8gLy8gU0NBTEUKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIxOTAtMjE5MgogICAgLy8gKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gc2NhbGVkX2Ftb3VudCkKICAgIC8vICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAvLyBTQ0FMRQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE4OS0yMTkzCiAgICAvLyBuZXdfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgLy8gU0NBTEUKICAgIC8vICkKICAgIGZyYW1lX2J1cnkgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMTk4CiAgICAvLyBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgZXh0cmFjdCAxMzYgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMgogICAgYnl0ZSAweAogICAgYj4KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE5Ny0yMTk5CiAgICAvLyB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgLy8gZWxzZSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgYnogX3JlcGF5X3Rlcm5hcnlfZmFsc2VANwogICAgZnJhbWVfZGlnIDIKICAgIGIgX3JlcGF5X3Rlcm5hcnlfbWVyZ2VAOAoKX3JlcGF5X3Rlcm5hcnlfZmFsc2VANzoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjE5OQogICAgLy8gZWxzZSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgZnJhbWVfZGlnIDQKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCgpfcmVwYXlfdGVybmFyeV9tZXJnZUA4OgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjAxCiAgICAvLyBwcmljZV9mb3JfbmV3ID0gbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIGZyYW1lX2RpZyA0CiAgICBpbnQgMjgxCiAgICBpbnQgMzIKICAgIGV4dHJhY3QzIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjAzCiAgICAvLyBvbGRfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDEKICAgIHVuY292ZXIgMgogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyMjA0CiAgICAvLyBuZXdfdmFsdWUgPSAobmV3X2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3JfbmV3KSAvLyBTQ0FMRQogICAgZnJhbWVfZGlnIDAKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjIwNS0yMjEwCiAgICAvLyBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgdXNlcl9pZCwKICAgIC8vICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgb2xkX3ZhbHVlLCAgIyBvbGQgVVNEIHZhbHVlCiAgICAvLyAgICAgbmV3X3ZhbHVlLCAgIyBuZXcgVVNEIHZhbHVlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgdW5jb3ZlciAzCiAgICB1bmNvdmVyIDMKICAgIGNhbGxzdWIgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cwogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQ6IHVpbnQ2NCwgdXNlcl9pZDogYnl0ZXMsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3M6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExNzktMTE4MgogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDMgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTgzCiAgICAvLyBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgY2FsbHN1YiBfZ2V0X21hcmtldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTg0CiAgICAvLyB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF91c2VyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExODUKICAgIC8vIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0zCiAgICBjYWxsc3ViIF9nZXRfdXNlcl9rZXkKICAgIGNvdmVyIDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE4NwogICAgLy8gdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICBkdXAKICAgIGV4dHJhY3QgMzIgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2RpZyAtMQogICAgYj49CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExODYtMTE4OAogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIGFzc2VydCAvLyBJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTg5CiAgICAvLyB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgZnJhbWVfZGlnIC0xCiAgICBiLQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDMyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjExOTAKICAgIC8vIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgZGlnIDEKICAgIGV4dHJhY3QgMjA5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgcmVwbGFjZTIgOTYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE5MQogICAgLy8gdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICByZXBsYWNlMiAxMjgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTE5MgogICAgLy8gdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgc3dhcAogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHJlcGxhY2UyIDEzNgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIxCiAgICAvLyBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIGJ5dGUgInVzZXJzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMTkzCiAgICAvLyBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICB1bmNvdmVyIDIKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkOiB1aW50NjQsIGFtb3VudDogYnl0ZXMpIC0+IHZvaWQ6Cl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTA3LTE1MTAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MTEKICAgIC8vIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC0yCiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MTMKICAgIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICBkdXAKICAgIGV4dHJhY3QgMTQ1IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9kaWcgLTEKICAgIGI+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTEyLTE1MTQKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIGFzc2VydCAvLyBJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTE2CiAgICAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50CiAgICBmcmFtZV9kaWcgLTEKICAgIGItCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1MTUtMTUxNwogICAgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICkKICAgIGR1cAogICAgbGVuCiAgICBpbnQgMzIKICAgIDw9CiAgICBhc3NlcnQgLy8gb3ZlcmZsb3cKICAgIGludCAzMgogICAgYnplcm8KICAgIGJ8CiAgICByZXBsYWNlMiAxNDUKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUxOAogICAgLy8gc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICBmcmFtZV9kaWcgLTIKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMAogICAgLy8gc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICBieXRlICJtYXJrZXRzIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNTE4CiAgICAvLyBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIHN3YXAKICAgIGNvbmNhdAogICAgc3dhcAogICAgYm94X3B1dAogICAgcmV0c3ViCgoKLy8gY29udHJhY3QuTGVuZGluZ1Bvb2wuc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKHVzZXJfaWQ6IGJ5dGVzLCBtYXJrZXRfaWQ6IGJ5dGVzKSAtPiB2b2lkOgpzeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2U6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMDUtMjMwOAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMDkKICAgIC8vIGVuc3VyZV9idWRnZXQoMTQwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIGludCAxNDAwCiAgICBpbnQgMAogICAgY2FsbHN1YiBlbnN1cmVfYnVkZ2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzMTEKICAgIC8vIHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlCiAgICBmcmFtZV9kaWcgLTEKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjMxMC0yMzEyCiAgICAvLyBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgdXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMgogICAgc3dhcAogICAgY2FsbHN1YiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZDogYnl0ZXMpIC0+IGJ5dGVzOgpnZXRfZ2xvYmFsX3VzZXI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjIzNjEtMjM2MgogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gR2xvYmFsVXNlckRhdGE6CiAgICBwcm90byAxIDEKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjM2MwogICAgLy8gcmV0dXJuIHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkLm5hdGl2ZSkKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfZ2V0X2dsb2JhbF91c2VyCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5saXF1aWRhdGVfY3Jvc3NfbWFya2V0KGRlYnRfbWFya2V0X2lkOiBieXRlcywgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IGJ5dGVzLCB1c2VyOiBieXRlcywgZGVidF9hbW91bnQ6IGJ5dGVzLCBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogYnl0ZXMpIC0+IHZvaWQ6CmxpcXVpZGF0ZV9jcm9zc19tYXJrZXQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MTEtMjQxOQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgbGlxdWlkYXRlX2Nyb3NzX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIGRlYnRfbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgdXNlcjogYXJjNC5BZGRyZXNzLAogICAgLy8gICAgIGRlYnRfYW1vdW50OiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQ6IGFyYzQuVUludDI1NiwKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDUgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDIwCiAgICAvLyBlbnN1cmVfYnVkZ2V0KDQ5MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICBpbnQgNDkwMAogICAgaW50IDAKICAgIGNhbGxzdWIgZW5zdXJlX2J1ZGdldAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDIxCiAgICAvLyBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgY2FsbHN1YiBfaXNfcGF1c2VkCiAgICAhCiAgICBhc3NlcnQgLy8gUHJvdG9jb2wgaXMgcGF1c2VkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MjUKICAgIC8vIHVzZXIubmF0aXZlLCBkZWJ0X21hcmtldF9pZC5uYXRpdmUKICAgIGZyYW1lX2RpZyAtNQogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDIzLTI0MjYKICAgIC8vICMgU3luYyBnbG9iYWwgdXNlciB2YWx1ZXMgZm9yIGJvdGggbWFya2V0cyB0byBpbmNsdWRlIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICB1c2VyLm5hdGl2ZSwgZGVidF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTMKICAgIGRpZyAxCiAgICBjYWxsc3ViIF91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQyOAogICAgLy8gdXNlci5uYXRpdmUsIGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZQogICAgZnJhbWVfZGlnIC00CiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI0MjctMjQyOQogICAgLy8gc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgIHVzZXIubmF0aXZlLCBjb2xsYXRlcmFsX21hcmtldF9pZC5uYXRpdmUKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMwogICAgZGlnIDEKICAgIGNhbGxzdWIgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDM0CiAgICAvLyBUeG4uc2VuZGVyLAogICAgdHhuIFNlbmRlcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDMxLTI0MzgKICAgIC8vIHNlbGYuX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgZGVidF9tYXJrZXRfaWQubmF0aXZlLAogICAgLy8gICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICBUeG4uc2VuZGVyLAogICAgLy8gICAgIHVzZXIubmF0aXZlLAogICAgLy8gICAgIGRlYnRfYW1vdW50Lm5hdGl2ZSwKICAgIC8vICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZC5uYXRpdmUsCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIF9saXF1aWRhdGVfY3Jvc3NfbWFya2V0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5MZW5kaW5nUG9vbC5fbGlxdWlkYXRlX2Nyb3NzX21hcmtldChkZWJ0X21hcmtldF9pZDogdWludDY0LCBjb2xsYXRlcmFsX21hcmtldF9pZDogdWludDY0LCBsaXF1aWRhdG9yX2lkOiBieXRlcywgdXNlcl9pZDogYnl0ZXMsIGRlYnRfYW1vdW50OiBieXRlcywgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQ6IGJ5dGVzKSAtPiB2b2lkOgpfbGlxdWlkYXRlX2Nyb3NzX21hcmtldDoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ0MC0yNDQ5CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9saXF1aWRhdGVfY3Jvc3NfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgZGVidF9tYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0b3JfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBkZWJ0X2Ftb3VudDogQmlnVUludCwKICAgIC8vICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIHByb3RvIDYgMAogICAgaW50IDAKICAgIGR1cG4gMTYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ4NC0yNDg3CiAgICAvLyAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBsaXF1aWRhdGUgb3BlcmF0aW9uCiAgICAvLyBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgZGVidF9tYXJrZXRfaWQKICAgIC8vICkubGlxdWlkYXRlLm5hdGl2ZQogICAgZnJhbWVfZGlnIC02CiAgICBjYWxsc3ViIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgZXh0cmFjdCA5NiAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDg4CiAgICAvLyBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIGJ5dGUgMHgKICAgIGI+CiAgICBieiBfbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9hZnRlcl9pZl9lbHNlQDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ4OQogICAgLy8gYXNzZXJ0IGRlYnRfYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJMaXF1aWRhdGUgY2FwIGV4Y2VlZGVkIgogICAgZnJhbWVfZGlnIC0yCiAgICBmcmFtZV9kaWcgMTcKICAgIGI8PQogICAgYXNzZXJ0IC8vIExpcXVpZGF0ZSBjYXAgZXhjZWVkZWQKCl9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X2FmdGVyX2lmX2Vsc2VAMjoKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjQ5NgogICAgLy8gY29sbGF0ZXJhbF9tYXJrZXRfaWQgIT0gc2VsZi5zdG9rZW5fYXBwX2lkCiAgICBpbnQgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDE4CiAgICAvLyBzZWxmLnN0b2tlbl9hcHBfaWQgPSBVSW50NjQoKSAgIyBzdGFibGUgbWFya2V0CiAgICBieXRlICJzdG9rZW5fYXBwX2lkIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDk2CiAgICAvLyBjb2xsYXRlcmFsX21hcmtldF9pZCAhPSBzZWxmLnN0b2tlbl9hcHBfaWQKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi5zdG9rZW5fYXBwX2lkIGV4aXN0cwogICAgZnJhbWVfZGlnIC01CiAgICAhPQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNDkxLTI0OTcKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIyBSRU0gcHJldmVudCB1c2luZyBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgaW4gbGlxdWlkYXRpb24gYmVjYXVzZSBzdG9rZW4KICAgIC8vICMgUkVNIG1hcmtldCBjb2xsYXRlcmFsIGRvZXMgbm90IGV4aXN0CiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQgIT0gc2VsZi5zdG9rZW5fYXBwX2lkCiAgICAvLyApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgKGJvcnJvdy1vbmx5IG1hcmtldCkiCiAgICBhc3NlcnQgLy8gQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgKGJvcnJvdy1vbmx5IG1hcmtldCkKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUwMC0yNTAzCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICMgUkVNIHByZXZlbnQgc2VsZiBsaXF1aWRhdGlvbgogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyBhc3NlcnQgdXNlcl9pZCAhPSBsaXF1aWRhdG9yX2lkLCAiQ2Fubm90IGxpcXVpZGF0ZSBzZWxmIgogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTQKICAgICE9CiAgICBhc3NlcnQgLy8gQ2Fubm90IGxpcXVpZGF0ZSBzZWxmCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAtMjUwNgogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBkZWwgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWREZXRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgICMgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIGFzc2VydCBwcmljZSA+IDAsICJQcmljZSBtdXN0IGJlIHBvc2l0aXZlIgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgVW5wYXVzZSB0aGUgbWFya2V0IG9uIGZpcnN0IHByaWNlIHNldAogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQgYW5kIG1hcmtldC5wcmljZSA9PSAwOgogICAgLy8gICAgICAgICBtYXJrZXQucGF1c2VkID0gYXJjNC5Cb29sKEZhbHNlKQogICAgLy8gCiAgICAvLyAgICAgIyBTY2FsZSB0aGUgcHJpY2UgYnkgU0NBTEUgaW50ZXJuYWxseSBmb3Igc3RvcmFnZQogICAgLy8gICAgIG1hcmtldC5wcmljZSA9IGFyYzQuVUludDI1NihwcmljZSAqIFNDQUxFKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFByaWNlU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KHByaWNlKSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgc2VsZi5fZmV0Y2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2ZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDEwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS01CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgcGF5bWVudCA8PSAxMDAwMDAwCiAgICAvLyAgICAgKSwgInBheW1lbnQgZXhjZWVkcyBtYXhpbXVtIGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS02CiAgICAvLyAgICAgYXBwID0gQXBwbGljYXRpb24oc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vICAgICBpdHhuLlBheW1lbnQocmVjZWl2ZXI9YXBwLmFkZHJlc3MsIGFtb3VudD1wYXltZW50LCBmZWU9MCkuc3VibWl0KCkKICAgIC8vICAgICBwcmljZV93aXRoX3RpbWVzdGFtcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgUHJpY2VGZWVkUHJvdmlkZXJJbnRlcmZhY2UuZ2V0X3ByaWNlX3dpdGhfdGltZXN0YW1wLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIGlmICgKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICAgICA+IHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICApOgogICAgLy8gICAgICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcCA9ICgKICAgIC8vICAgICAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLmNvcHkoKQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQsIHByaWNlX3dpdGhfdGltZXN0YW1wLnByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fcGF1c2VfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgcGF1c2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9wYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0ucGF1c2VkID0gYXJjNC5Cb29sKHBhdXNlID09IFVJbnQ2NCgxKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY19tYXJrZXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYWNjcnVlX2ludGVyZXN0KHNlbGYsIG1hcmtldF9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGN1cnJlbnRfdGltZSA9IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wCiAgICAvLyAgICAgdGltZV9kZWx0YSA9IGN1cnJlbnRfdGltZSAtIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lLm5hdGl2ZQogICAgLy8gICAgIGlmIHRpbWVfZGVsdGEgPD0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgIyBGb3Igc3Rva2VuIG1hcmtldCAoYm9ycm93LW9ubHkpLCB1c2UgYSBmaXhlZCB1dGlsaXphdGlvbiByYXRlIHNpbmNlIHRoZXJlIGFyZSBubyBkZXBvc2l0cwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHV0aWxpemF0aW9uID0gQmlnVUludCgxMDAwMCkgICMgMTAwJSB1dGlsaXphdGlvbiBmb3IgYm9ycm93LW9ubHkgbWFya2V0CiAgICAvLyAgICAgZWxpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgdXRpbGl6YXRpb24gPSAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDAKICAgIC8vICAgICAgICAgKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgIHJhdGUgPSBtYXJrZXQuYm9ycm93X3JhdGUubmF0aXZlICsgKG1hcmtldC5zbG9wZS5uYXRpdmUgKiB1dGlsaXphdGlvbikgLy8gMTAwMDAKICAgIC8vICAgICBpbnRlcmVzdCA9IChyYXRlICogbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHRpbWVfZGVsdGEpIC8vICgKICAgIC8vICAgICAgICAgc2VsZi5zZWNvbmRzX3Blcl95ZWFyICogMTAwMDAKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHN0b2tlbiBtYXJrZXQgLSBhbGwgaW50ZXJlc3QgZ29lcyB0byByZXNlcnZlcwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBhcmM0LlVJbnQyNTYuZnJvbV9ieXRlcyhtYXJrZXQucmVzZXJ2ZV9mYWN0b3IuYnl0ZXMpLm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIDEwMDAwCiAgICAvLyAgICAgICAgIGlmIHByb3RvY29sX3BvcnRpb24gPiBpbnRlcmVzdDoKICAgIC8vICAgICAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IGludGVyZXN0IC0gcHJvdG9jb2xfcG9ydGlvbgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChkZXBvc2l0b3JfcG9ydGlvbiAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID4gMDoKICAgIC8vICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChpbnRlcmVzdCAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGludGVyZXN0CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgZGVwb3NpdG9yX3BvcnRpb24KICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgKyBwcm90b2NvbF9wb3J0aW9uKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoY3VycmVudF90aW1lKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAgICAgcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gIyBUT0RPIGdvdmVybmFuY2U6IGNvbnNpZGVyIGlmIHJlc2VydmUgd2l0aGRyYXdhbCBzaG91bGQgcmVxdWlyZSBhZGRpdGlvbmFsCiAgICAvLyAjICAgICAgZ292ZXJuYW5jZSBtZWNoYW5pc21zCiAgICAvLyAjIFRPRE8gbWluaW11bSByZXNlcnZlIGxldmVsczogbWlnaHQgd2FudCB0byBlbmZvcmNlIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHMgZm9yCiAgICAvLyAjICAgICAgcHJvdG9jb2wgc2FmZXR5CiAgICAvLyAjIFRPRE8gZXZlbnQgZW1pc3Npb246IENvbnNpZGVyIGFkZGluZyBhbiBldmVudCB0byBsb2cgcmVzZXJ2ZSB3aXRoZHJhd2FscyBmb3IKICAgIC8vICMgICAgICB0cmFuc3BhcmVuY3kKICAgIC8vIAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBza2lwcGluZyBzdWJyb3V0aW5lIHRvIHJlZHVjZSBjb250cmFjdCBzaXplCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl93aXRoZHJhd19yZXNlcnZlcyhtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIEFjY3J1ZSBpbnRlcmVzdCBmaXJzdCB0byBnZXQgdXAtdG8tZGF0ZSByZXNlcnZlcwogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgPj0gYW1vdW50LCAiSW5zdWZmaWNpZW50IHJlc2VydmVzIgogICAgLy8gCiAgICAvLyAgICAgIyBUcmFuc2ZlciByZXNlcnZlcyB0byB0aGUgb3duZXIgKG5vdCB0byB0aGUgY29udHJhY3QgaXRzZWxmKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVcGRhdGUgcmVzZXJ2ZXMKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbigKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50LCBndWFyZF9zdG9rZW46IGJvb2wKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCBhbW91bnQgPiAwLCAiQW1vdW50IG11c3QgYmUgPiAwIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBub3QgbWFya2V0LnBhdXNlZCwgIk1hcmtldCBpcyBwYXVzZWQiCiAgICAvLyAgICAgaWYgZ3VhcmRfc3Rva2VuOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgLy8gICAgICAgICApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGZvciB0aGlzIG9wZXJhdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGVwb3NpdChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9kZXBvc2l0KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgUkVNIG1heSBhZGQgcHJvdGVjdGlvbiBmb3IgbG93IHV0aWxpc2F0aW9uIGluIGZ1dHVyZQogICAgLy8gIyBSRU0gbG93ZXIgbWF4IGRlcG9zaXQgYW1vdW50IGZvciBsb3cgdXRpbGlzYXRpb24KICAgIC8vICMgUkVNIGhpZ2ggbWF4IGRlcG9zaXQgYW1vdW50IGZvciBoaWdoIHV0aWxpc2F0aW9uCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlcG9zaXQoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBJbnRlcm5hbCBkZXBvc2l0IG1ldGhvZCB0aGF0IGhhbmRsZXMgdXNlciBkZXBvc2l0cyBpbnRvIGEgbGVuZGluZyBtYXJrZXQuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBwZXJmb3JtcyBhIGNvbXBsZXRlIGRlcG9zaXQgb3BlcmF0aW9uIGluY2x1ZGluZzoKICAgIC8vICAgICAxLiBWYWxpZGF0aW5nIHRoZSBtYXJrZXQgb3BlcmF0aW9uIChwcm90b2NvbCBub3QgcGF1c2VkLCBtYXJrZXQgZXhpc3RzLCBhbW91bnQgPiAwLCBtYXJrZXQgbm90IHBhdXNlZCkKICAgIC8vICAgICAyLiBUcmFuc2ZlcnJpbmcgQVJDMjAwIHRva2VucyBmcm9tIHVzZXIgdG8gdGhlIGxlbmRpbmcgcG9vbCBjb250cmFjdAogICAgLy8gICAgIDMuIEFjY3J1aW5nIGludGVyZXN0IG9uIHRoZSBtYXJrZXQgdG8gZ2V0IHVwZGF0ZWQgZGVwb3NpdCBpbmRleAogICAgLy8gICAgIDQuIENhbGN1bGF0aW5nIGFuZCBhZGRpbmcgZWFybmVkIGludGVyZXN0IHRvIHRoZSB1c2VyJ3MgcG9zaXRpb24KICAgIC8vICAgICA1LiBDb252ZXJ0aW5nIGRlcG9zaXQgYW1vdW50IHRvIHNjYWxlZCBkZXBvc2l0cyB1c2luZyBjdXJyZW50IGRlcG9zaXQgaW5kZXgKICAgIC8vICAgICA2LiBDaGVja2luZyBkZXBvc2l0IGNhcCBjb25zdHJhaW50cwogICAgLy8gICAgIDcuIFVwZGF0aW5nIHVzZXIgYW5kIG1hcmtldCBzY2FsZWQgZGVwb3NpdCBiYWxhbmNlcwogICAgLy8gICAgIDguIE1pbnRpbmcgTlRva2VucyB0byByZXByZXNlbnQgdGhlIHVzZXIncyBkZXBvc2l0IHBvc2l0aW9uCiAgICAvLyAgICAgOS4gVXBkYXRpbmcgZ2xvYmFsIGNvbGxhdGVyYWwgY2FsY3VsYXRpb25zIGZvciB0aGUgdXNlcgogICAgLy8gICAgIDEwLiBFbWl0dGluZyBhIE1hcmtldERlcG9zaXQgZXZlbnQKICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQgKEFjY291bnQpOiBUaGUgYWNjb3VudCBJRCBvZiB0aGUgdXNlciBtYWtpbmcgdGhlIGRlcG9zaXQKICAgIC8vICAgICAgICAgbWFya2V0X2lkIChVSW50NjQpOiBUaGUgSUQgb2YgdGhlIG1hcmtldCB0byBkZXBvc2l0IGludG8KICAgIC8vICAgICAgICAgYW1vdW50IChCaWdVSW50KTogVGhlIGFtb3VudCBvZiB1bmRlcmx5aW5nIHRva2VucyB0byBkZXBvc2l0CiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiBtYXJrZXQgdmFsaWRhdGlvbiBmYWlscywgZGVwb3NpdCBjYXAgaXMgZXhjZWVkZWQsIG9yIG90aGVyIGNvbnN0cmFpbnRzIGFyZSB2aW9sYXRlZAogICAgLy8gCiAgICAvLyAgICAgTm90ZToKICAgIC8vICAgICAgICAgLSBJbnRlcmVzdCBlYXJuZWQgc2luY2UgbGFzdCBpbnRlcmFjdGlvbiBpcyBhdXRvbWF0aWNhbGx5IGFkZGVkIHRvIHRoZSBkZXBvc2l0CiAgICAvLyAgICAgICAgIC0gU2NhbGVkIGRlcG9zaXRzIGFyZSB1c2VkIHRvIHRyYWNrIHVzZXIgcG9zaXRpb25zIGFuZCBjYWxjdWxhdGUgaW50ZXJlc3QKICAgIC8vICAgICAgICAgLSBDb2xsYXRlcmFsIHZhbHVlIGlzIHVwZGF0ZWQgdXNpbmcgZWl0aGVyIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIG9yIGN1cnJlbnQgbWFya2V0IHByaWNlCiAgICAvLyAgICAgICAgIC0gTlRva2VucyBhcmUgbWludGVkIHRvIHJlcHJlc2VudCB0aGUgdXNlcidzIGRlcG9zaXQgcG9zaXRpb24gKGFtb3VudCArIGludGVyZXN0KQogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgKS5kZXBvc2l0Lm5hdGl2ZQogICAgLy8gICAgIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJEZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApICAjIEdldCB1cGRhdGVkIG1hcmtldCB3aXRoIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBBZGQgZWFybmVkIGludGVyZXN0IHRvIHVzZXIncyBwb3NpdGlvbiBhcyBhZGRpdGlvbmFsIHNjYWxlZCBkZXBvc2l0cwogICAgLy8gICAgIGludGVyZXN0X3NjYWxlZF9hbW91bnQgPSBCaWdVSW50KDApCiAgICAvLyAgICAgaWYgaW50ZXJlc3QgPiAwOgogICAgLy8gICAgICAgICBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBTQ0FMRQogICAgLy8gICAgICAgICApIC8vIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIGFtb3VudCAqIFNDQUxFCiAgICAvLyAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgLy8gCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2Ftb3VudCA9IHNjYWxlZF9hbW91bnQgKyBpbnRlcmVzdF9zY2FsZWRfYW1vdW50CiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0Lm1heF90b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgPj0gbmV3X21hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgdG90YWxfc2NhbGVkX2Ftb3VudAogICAgLy8gICAgICksICJNYXJrZXQgZGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIHVzZXJfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50ICsgaW50ZXJlc3QpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2RlcG9zaXRfYW1vdW50ID0gb2xkX2RlcG9zaXRfYW1vdW50ICsgYW1vdW50ICsgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgIyBGYWxsYmFjazogVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIHRvIHByZXZlbnQgbmVnYXRpdmUgY29sbGF0ZXJhbAogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSA9IChuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICAjIE5vcm1hbCBjYXNlOiBVc2UgdXNlcidzIGxhc3QgcmVjb3JkZWQgcHJpY2UgZm9yIGFjY3VyYXRlIGNvbGxhdGVyYWwgcmVkdWN0aW9uCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIGRlcG9zaXQgb3BlcmF0aW9uCiAgICAvLyAgICAgdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC50b3RhbF9kZXBvc2l0cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApLCAiVXNlciBkZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF92YWx1ZSwgbmV3X3ZhbHVlKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0RGVwb3NpdCgKICAgIC8vICAgICAjICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLCBhcmM0LlVJbnQyNTYoYW1vdW50KQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGNhbGN1bGF0ZV91c2VyX2ludGVyZXN0KAogICAgLy8gIyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyAjICkgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAjICAgICByZXR1cm4gYXJjNC5VSW50MjU2KAogICAgLy8gIyAgICAgICAgIHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgaW50ZXJlc3QiIiIKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgdW5kZXJseWluZyBhbW91bnQKICAgIC8vICAgICB1c2VyX3RvdGFsX3VuZGVybHlpbmcgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIEludGVyZXN0IGlzIHRoZSBkaWZmZXJlbmNlIGZyb20gdGhlIHNjYWxlZCBkZXBvc2l0cyAod2hpY2ggcmVwcmVzZW50IHRoZSAiYmFzZSIgYW1vdW50KQogICAgLy8gICAgIGludGVyZXN0ID0gdXNlcl90b3RhbF91bmRlcmx5aW5nIC0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gaW50ZXJlc3QKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGNhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAjICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICMgKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAjICAgICBlbnN1cmVfYnVkZ2V0KDcwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICMgICAgIHJldHVybiBhcmM0LlVJbnQyNTYoCiAgICAvLyAjICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBkZWJ0IGludGVyZXN0IiIiCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIHVuZGVybHlpbmcgZGVidCBhbW91bnQKICAgIC8vICAgICB1c2VyX3RvdGFsX2RlYnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgb3JpZ2luYWwgcHJpbmNpcGFsIGFtb3VudCB1c2luZyB1c2VyJ3MgYm9ycm93X2luZGV4CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIncyBib3Jyb3dfaW5kZXggaXMgMCwgdXNlIGN1cnJlbnQgbWFya2V0IGJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXJfYm9ycm93X2luZGV4ID0gKAogICAgLy8gICAgICAgICB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBvcmlnaW5hbF9wcmluY2lwYWwgPSAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyX2JvcnJvd19pbmRleCkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRvdGFsIGRlYnQgYW5kIG9yaWdpbmFsIHByaW5jaXBhbAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSB1c2VyX3RvdGFsX2RlYnQgLSBvcmlnaW5hbF9wcmluY2lwYWwKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHdpdGhkcmF3KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyMTAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gCiAgICAvLyAgICAgIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgd2l0aGRyYXduIGZyb20gdG8gdXBkYXRlIGdsb2JhbCB2YWx1ZXMgd2l0aCBpbnRlcmVzdAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDI1NihzZWxmLl93aXRoZHJhdyhUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXcoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFdpdGhkcmF3IHRva2VucyBmcm9tIGEgbGVuZGluZyBtYXJrZXQgYnkgYnVybmluZyBuVG9rZW5zLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgaGFuZGxlcyB0aGUgd2l0aGRyYXdhbCBwcm9jZXNzIGJ5OgogICAgLy8gICAgIDEuIFZhbGlkYXRpbmcgdGhlIG1hcmtldCBvcGVyYXRpb24gYW5kIHVzZXIgYmFsYW5jZQogICAgLy8gICAgIDIuIEFjY3J1aW5nIGludGVyZXN0IHRvIGdldCB0aGUgbGF0ZXN0IG1hcmtldCBzdGF0ZQogICAgLy8gICAgIDMuIENhbGN1bGF0aW5nIHVzZXIncyBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgNC4gUGVyZm9ybWluZyBoZWFsdGggY2hlY2tzIHRvIGVuc3VyZSB3aXRoZHJhd2FsIGRvZXNuJ3QgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgIDUuIEJ1cm5pbmcgblRva2VucyBhbmQgdHJhbnNmZXJyaW5nIHVuZGVybHlpbmcgdG9rZW5zIHRvIHVzZXIKICAgIC8vICAgICA2LiBVcGRhdGluZyBnbG9iYWwgY29sbGF0ZXJhbCB2YWx1ZXMKICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIHdpdGhkcmF3aW5nIHRva2VucwogICAgLy8gICAgICAgICBtYXJrZXRfaWQ6IFRoZSBJRCBvZiB0aGUgbWFya2V0IHRvIHdpdGhkcmF3IGZyb20KICAgIC8vICAgICAgICAgYW1vdW50OiBUaGUgYW1vdW50IG9mIG5Ub2tlbnMgdG8gYnVybiAobm90IHRoZSB1bmRlcmx5aW5nIHRva2VuIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAgIFJldHVybnM6CiAgICAvLyAgICAgICAgIEJpZ1VJbnQ6IFRoZSB0b3RhbCBhbW91bnQgb2YgdW5kZXJseWluZyB0b2tlbnMgdHJhbnNmZXJyZWQgdG8gdGhlIHVzZXIKICAgIC8vICAgICAgICAgICAgICAgICAoaW5jbHVkZXMgYm90aCB0aGUgd2l0aGRyYXduIGFtb3VudCBhbmQgYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIHVzZXIgaGFzIGluc3VmZmljaWVudCBiYWxhbmNlIG9yIHdpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciB3aXRoZHJhdyBvcGVyYXRpb24KICAgIC8vICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gICAgICkud2l0aGRyYXcubmF0aXZlCiAgICAvLyAgICAgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIldpdGhkcmF3IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgYW1vdW50IGlzIHRoZSBhbW91bnQgb2YgblRva2VucyBiZWluZyBidXJuZWQKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBhbW91bnQgPD0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgICMgaGVhbHRoIGNoZWNrOiBlbnN1cmUgd2l0aGRyYXcgd291bGQgbm90IHB1dCBib3Jyb3dzIGF0IHJpc2sKICAgIC8vICAgICBpZiBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPiAwOgogICAgLy8gICAgICAgICAjIHZhbHVlIG9mIHVuZGVybHlpbmcgYW1vdW50IHRvIHdpdGhkcmF3IHVzaW5nIG5ldyBtYXJrZXQgcHJpY2UKICAgIC8vICAgICAgICAgd2l0aGRyYXdfdmFsdWUgPSAoYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsID0gKAogICAgLy8gICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSB3aXRoZHJhd192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIGFzc2VydCBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIDw9ICgKICAgIC8vICAgICAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsICogQmlnVUludChuZXdfbWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICAgICAgICAgKSAvLyBCaWdVSW50KDEwMDAwKSwgIldpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzayIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCB1c2VyX2lkLCBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19kZXBvc2l0X2Ftb3VudCA9IG9sZF9kZXBvc2l0X2Ftb3VudCArIGludGVyZXN0IC0gYW1vdW50CiAgICAvLyAKICAgIC8vICAgICBhbW91bnRfdXNkX3ZhbHVlID0gKGFtb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHVzZXIgY2FwIGZvciB3aXRoZHJhdyBvcGVyYXRpb24KICAgIC8vICAgICB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgIGlmIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPT0gMDoKICAgIC8vICAgICAgICAgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wICsgODY0MDApCiAgICAvLyAgICAgZWxpZiB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lIDwgR2xvYmFsLmxhdGVzdF90aW1lc3RhbXA6CiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KDApCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX2xpcXVpZGF0aW9ucyA9IGFyYzQuVUludDI1NigwKQogICAgLy8gICAgICAgICB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC5kYWlseV93aXRoZHJhd2Fscy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBuZXdfdG90YWxfd2l0aGRyYXdhbHMgPSB1c2VyX2NhcC50b3RhbF93aXRoZHJhd2Fscy5uYXRpdmUgKyBhbW91bnRfdXNkX3ZhbHVlCiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICBuZXdfdG90YWxfd2l0aGRyYXdhbHMgPD0gdXNlcl9jYXAuZGFpbHlfd2l0aGRyYXdhbHMubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIHdpdGhkcmF3IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYobmV3X3RvdGFsX3dpdGhkcmF3YWxzKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZCwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgICMgRmFsbGJhY2s6IFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSB0byBwcmV2ZW50IG5lZ2F0aXZlIGNvbGxhdGVyYWwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgIyBOb3JtYWwgY2FzZTogVXNlIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIGZvciBhY2N1cmF0ZSBjb2xsYXRlcmFsIHJlZHVjdGlvbgogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIEVtaXQgZXZlbnRzCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0V2l0aGRyYXcoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgYXJjNC5VSW50NjQobWFya2V0X2lkKSwgYXJjNC5VSW50MjU2KGFtb3VudCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gYW1vdW50ICsgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gIyB3aXRoZHJhdyBjb3N0IDkwMDAwMAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBib3Jyb3coc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyODAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gCiAgICAvLyAgICAgIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgYm9ycm93ZWQgZnJvbSB0byB1cGRhdGUgZ2xvYmFsIHZhbHVlcyB3aXRoIGludGVyZXN0CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9ib3Jyb3coVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYm9ycm93KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBib3Jyb3cgb3BlcmF0aW9uCiAgICAvLyAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApLmJvcnJvdy5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KHVzZXJfaWQpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gVUludDY0KDEwMDAwMCksICJQYXltZW50IGFtb3VudCBtdXN0IGJlID49IDAuMSIKICAgIC8vIAogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGN1cnJlbnQgbWFya2V0IHRvdGFsIGJvcnJvd3MgKGluY2x1ZGluZyBpbnRlcmVzdCkKICAgIC8vICAgICBjdXJyZW50X21hcmtldF90b3RhbF9ib3Jyb3dzID0gKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIGFtb3VudCBiZWluZyBhZGRlZCAobmV3IGJvcnJvdyArIGRlYnQgaW50ZXJlc3QpCiAgICAvLyAgICAgIyBkZWJ0IGludGVyZXN0IGFkZGVkIGF0IHRoaXMgcG9pbnQgdG8gcHJldmVudCB1bm5lY2Vzc2FyeSBkZWJ0IHJlc2V0CiAgICAvLyAgICAgdG90YWxfYW1vdW50X3RvX2FkZCA9IGFtb3VudCArIGRlYnRfaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgICMgVmFsaWRhdGUgYWdhaW5zdCBtYXJrZXQtd2lkZSBib3Jyb3cgY2FwCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbmV3X21hcmtldC5tYXhfdG90YWxfYm9ycm93cy5uYXRpdmUKICAgIC8vICAgICAgICAgPj0gY3VycmVudF9tYXJrZXRfdG90YWxfYm9ycm93cyArIHRvdGFsX2Ftb3VudF90b19hZGQKICAgIC8vICAgICApLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgY29sbGF0ZXJhbCByZXF1aXJlbWVudHMgLSBleGNsdWRlIHNhbWUgbWFya2V0IGNvbGxhdGVyYWwgdG8gcHJldmVudAogICAgLy8gICAgICMgaW5lZmZpY2llbnQgc2FtZS1hc3NldCBib3Jyb3dpbmcKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgbmV3X2JvcnJvd192YWx1ZSA9ICh0b3RhbF9hbW91bnRfdG9fYWRkICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgdG90YWxfYm9ycm93X3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSArIG5ld19ib3Jyb3dfdmFsdWUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IEJpZ1VJbnQoMCk6CiAgICAvLyAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICAgICAjIFVzZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgZXhjbHVkZWRfdmFsdWUgPSAoZGVwb3NpdGVkX2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBpZiBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSA+IGV4Y2x1ZGVkX3ZhbHVlOgogICAgLy8gICAgICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSAoCiAgICAvLyAgICAgICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBleGNsdWRlZF92YWx1ZQogICAgLy8gICAgICAgICAgICAgKQogICAgLy8gICAgICAgICBlbHNlOgogICAgLy8gICAgICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSBCaWdVSW50KDApCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgdG90YWxfYm9ycm93X3ZhbHVlIDw9ICgKICAgIC8vICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgKiBCaWdVSW50KG5ld19tYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgLy8gICAgICkgLy8gQmlnVUludCgxMDAwMCksICJJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCBhY3Jvc3MgbWFya2V0cyIKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHNjYWxlZCBhbW91bnQgZm9yIHRoZSB0b3RhbAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAodG90YWxfYW1vdW50X3RvX2FkZCAqIFNDQUxFKSAvLyBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBvbGRfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgLy8gU0NBTEUKICAgIC8vICAgICApCiAgICAvLyAgICAgbmV3X2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgICAgICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgaWYgdXNlciBkb2Vzbid0IGhhdmUgYSBwcmV2aW91cyBwcmljZQogICAgLy8gICAgIHByaWNlX2Zvcl9vbGQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBwcmljZV9mb3JfbmV3ID0gbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIG9sZF92YWx1ZSA9IChvbGRfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X3ZhbHVlID0gKG5ld19ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX25ldykgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3IgYm9ycm93IG9wZXJhdGlvbgogICAgLy8gICAgIHVzZXJfY2FwID0gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9jYXAudG90YWxfYm9ycm93cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIGJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlLCAgIyBvbGQgVVNEIHZhbHVlCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSwgICMgbmV3IFVTRCB2YWx1ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgaWYgc3Rva2VuLCBtaW50IHN0b2tlbgogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBTVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICAgICAgcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgLy8gICAgICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgIyBpZiBhVG9rZW4sIHRyYW5zZmVyIGFUb2tlbgogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRCb3Jyb3coCiAgICAvLyAgICAgIyAgICAgICAgIHVzZXI9YXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICMgICAgICAgICB0b2tlbl9pZD1hcmM0LlVJbnQ2NChtYXJrZXRfaWQpLAogICAgLy8gICAgICMgICAgICAgICBhbW91bnQ9YXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiByZXBheShzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fcmVwYXkoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBSZXBheSBib3Jyb3dlZCB0b2tlbnMgZm9yIGEgc3BlY2lmaWMgbWFya2V0LgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgaGFuZGxlcyB0aGUgcmVwYXltZW50IG9mIGJvcnJvd2VkIHRva2VucyB3aXRoIGEgbWluaW11bSBpbnRlcmVzdAogICAgLy8gICAgIHJlcXVpcmVtZW50LiBJdCBzdXBwb3J0cyBib3RoIHNUb2tlbiAoYnVybikgYW5kIGFUb2tlbiAodHJhbnNmZXIpIG1hcmtldHMuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgdXNlciBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIG1hcmtldF9pZDogVGhlIG1hcmtldCBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIGFtb3VudDogVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gcmVwYXkgKG11c3QgYmUgPj0gYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIG1hcmtldCB2YWxpZGF0aW9uIGZhaWxzLCByZXBheSBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0LAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgIHJlcGF5IGFtb3VudCBpcyBsZXNzIHRoYW4gYWNjcnVlZCBpbnRlcmVzdCwgb3IgcHJpbmNpcGFsCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgcmVwYXltZW50IGV4Y2VlZHMgc2NhbGVkIGRlYnQKICAgIC8vIAogICAgLy8gICAgIFByb2Nlc3M6CiAgICAvLyAgICAgICAgIDEuIFZhbGlkYXRlcyBtYXJrZXQgb3BlcmF0aW9uIGFuZCBhY2NydWVzIGludGVyZXN0CiAgICAvLyAgICAgICAgIDIuIENhbGN1bGF0ZXMgdG90YWwgZGVidCBpbmNsdWRpbmcgYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gICAgICAgICAzLiBWYWxpZGF0ZXMgcmVwYXkgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vICAgICAgICAgNC4gUmVxdWlyZXMgbWluaW11bSByZXBheW1lbnQgb2YgYXQgbGVhc3QgdGhlIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICAgICAgICAgNS4gQ2FsY3VsYXRlcyBwcmluY2lwYWwgcmVwYXltZW50IChhbW91bnQgLSBpbnRlcmVzdCkKICAgIC8vICAgICAgICAgNi4gQnVybnMgc1Rva2VucyBvciB0cmFuc2ZlcnMgYVRva2VucyBmcm9tIHVzZXIKICAgIC8vICAgICAgICAgNy4gVXBkYXRlcyB1c2VyIGFuZCBtYXJrZXQgc2NhbGVkIGJvcnJvdyBhbW91bnRzIChwcmluY2lwYWwgb25seSkKICAgIC8vICAgICAgICAgOC4gVXBkYXRlcyBnbG9iYWwgYm9ycm93IHZhbHVlIHRyYWNraW5nIHdpdGggcHJvcGVyIHByaWNlIGhhbmRsaW5nCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIGRlYnQgaW5jbHVkaW5nIGludGVyZXN0CiAgICAvLyAgICAgdW5zY2FsZWRfYm9ycm93cyA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgdG90YWxfZGVidCA9IHVuc2NhbGVkX2JvcnJvd3MgKyBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIFZhbGlkYXRlIHJlcGF5IGFtb3VudCBkb2Vzbid0IGV4Y2VlZCB0b3RhbCBkZWJ0CiAgICAvLyAgICAgYXNzZXJ0IGFtb3VudCA8PSB0b3RhbF9kZWJ0LCAiUmVwYXkgYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidCIKICAgIC8vIAogICAgLy8gICAgICMgUmVxdWlyZSBtaW5pbXVtIHJlcGF5bWVudCBvZiBhdCBsZWFzdCB0aGUgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGFtb3VudCA+PSBkZWJ0X2ludGVyZXN0CiAgICAvLyAgICAgKSwgIlJlcGF5IGFtb3VudCBtdXN0IGJlIGF0IGxlYXN0IHRoZSBhY2NydWVkIGludGVyZXN0IgogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgaG93IG11Y2ggZ29lcyB0b3dhcmQgcHJpbmNpcGFsIHJlcGF5bWVudAogICAgLy8gICAgIHByaW5jaXBhbF9yZXBheW1lbnQgPSBhbW91bnQgLSBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBzY2FsZWQgYW1vdW50IGZvciBwcmluY2lwYWwgcmVwYXltZW50IG9ubHkKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gKHByaW5jaXBhbF9yZXBheW1lbnQgKiBTQ0FMRSkgLy8gbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgYXNzZXJ0IHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IHNjYWxlZF9hbW91bnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyBkZWJ0IgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCB1c2VyX2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gICAgIG5ld19ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgICAgICAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAvLyBTQ0FMRQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICBwcmljZV9mb3Jfb2xkID0gKAogICAgLy8gICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgcHJpY2VfZm9yX25ldyA9IG5ld19tYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICBvbGRfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld192YWx1ZSA9IChuZXdfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9uZXcpIC8vIFNDQUxFCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRSZXBheSgKICAgIC8vICAgICAjICAgICAgICAgdXNlcj1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NChtYXJrZXRfaWQpLAogICAgLy8gICAgICMgICAgICAgICBhbW91bnQ9YXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyAjIG1pbnQvcmVkZWVtIHJlbGF0ZWQgY29kZQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgcmVkZWVtKHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gIyAgICAgc2VsZi5fcmVkZWVtKG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9yZWRlZW0oc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICMgICAgIGFzc2VydCBub3Qgc2VsZi5faGFzX3Bvc2l0aW9uKAogICAgLy8gIyAgICAgICAgIFR4bi5zZW5kZXIsIG1hcmtldF9pZAogICAgLy8gIyAgICAgKSwgIkNhbm5vdCBtaW50L3JlZGVlbSB3aGVuIHVzZXIgaGFzIHRyYWNrZWQgZGVwb3NpdCBwb3NpdGlvbiIKICAgIC8vIAogICAgLy8gIyAgICAgbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBzY2FsZWRfYW1vdW50ID0gKGFtb3VudCAqIFNDQUxFKSAvLyBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICMgICAgIGFzc2VydCAoCiAgICAvLyAjICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gc2NhbGVkX2Ftb3VudAogICAgLy8gIyAgICAgKSwgIkluc3VmZmljaWVudCBtYXJrZXQgZGVwb3NpdHMgdG8gcmVkZWVtIgogICAgLy8gIyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksCiAgICAvLyAjICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAjICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBtaW50KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fbWludChtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfbWludChzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIC8vIAogICAgLy8gIyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9oYXNfcG9zaXRpb24oCiAgICAvLyAjICAgICAgICAgVHhuLnNlbmRlciwgbWFya2V0X2lkCiAgICAvLyAjICAgICApLCAiQ2Fubm90IG1pbnQvcmVkZWVtIHdoZW4gdXNlciBoYXMgdHJhY2tlZCBkZXBvc2l0IHBvc2l0aW9uIgogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gIyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdCgKICAgIC8vICMgICAgICAgICBtYXJrZXRfaWQKICAgIC8vICMgICAgICkgICMgR2V0IHVwZGF0ZWQgbWFya2V0IHdpdGggYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gIyAgICAgc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICMgICAgICAgICBhbW91bnQgKiBTQ0FMRQogICAgLy8gIyAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgLy8gCiAgICAvLyAjICAgICBhc3NlcnQgKAogICAgLy8gIyAgICAgICAgIG5ld19tYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gIyAgICAgICAgID49IG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQKICAgIC8vICMgICAgICksICJEZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gIyAgICAgIyBPbmx5IGluY3JlbWVudCBtYXJrZXQgdG90YWwgZGVwb3NpdHMsIG5vdCB1c2VyIGRlcG9zaXRzIHNpbmNlIHBvc2l0aW9uIGlzIG5vdCB0cmFja2VkCiAgICAvLyAjICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gIyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAgICAgTWludEV2ZW50KAogICAgLy8gIyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksIGFyYzQuVUludDI1NihhbW91bnQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICAgICAgdXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkuY29weSgpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMgPT0gMCBhbmQgdXNlci5zY2FsZWRfYm9ycm93cyA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBkZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgICAgICBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBvbGRfZGVwb3NpdF92YWx1ZSA9IChkZXBvc2l0X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld19kZXBvc2l0X3ZhbHVlID0gKGRlcG9zaXRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICAgICAgdXNlcl9pZCwgbWFya2V0X2lkLCBvbGRfZGVwb3NpdF92YWx1ZSwgbmV3X2RlcG9zaXRfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgICAgICBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBvbGRfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgICAgICB1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF9ib3Jyb3dfdmFsdWUsIG5ld19ib3Jyb3dfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gR2xvYmFsVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IEdsb2JhbFVzZXJEYXRhOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi5nbG9iYWxfdXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9nbG9iYWxfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIGdsb2JhbF91c2VyCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZSA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnNbdXNlcl9pZF0gPSBnbG9iYWxfdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBtYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBvbGRfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyAgICAgbmV3X3ZhbHVlOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICAvLyAKICAgIC8vICAgICBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnNbdXNlcl9pZF0gPSBnbG9iYWxfdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgbGlxdWlkYXRlX2Nyb3NzX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIGRlYnRfbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgdXNlcjogYXJjNC5BZGRyZXNzLAogICAgLy8gICAgIGRlYnRfYW1vdW50OiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQ6IGFyYzQuVUludDI1NiwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDQ5MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgU3luYyBnbG9iYWwgdXNlciB2YWx1ZXMgZm9yIGJvdGggbWFya2V0cyB0byBpbmNsdWRlIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgICAgIHVzZXIubmF0aXZlLCBkZWJ0X21hcmtldF9pZC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fbGlxdWlkYXRlX2Nyb3NzX21hcmtldCgKICAgIC8vICAgICAgICAgZGVidF9tYXJrZXRfaWQubmF0aXZlLAogICAgLy8gICAgICAgICBjb2xsYXRlcmFsX21hcmtldF9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgIFR4bi5zZW5kZXIsCiAgICAvLyAgICAgICAgIHVzZXIubmF0aXZlLAogICAgLy8gICAgICAgICBkZWJ0X2Ftb3VudC5uYXRpdmUsCiAgICAvLyAgICAgICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkLm5hdGl2ZSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRvcl9pZDogQWNjb3VudCwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGRlYnRfYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIExpcXVpZGF0ZSBhIHVzZXIncyB1bmRlcmNvbGxhdGVyYWxpemVkIHBvc2l0aW9uIGFjcm9zcyBkaWZmZXJlbnQgbWFya2V0cy4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIGFsbG93cyBhIGxpcXVpZGF0b3IgdG8gcmVwYXkgYSBwb3J0aW9uIG9mIGEgdXNlcidzIGRlYnQgaW4gb25lIG1hcmtldAogICAgLy8gICAgIGFuZCByZWNlaXZlIGNvbGxhdGVyYWwgZnJvbSBhbm90aGVyIG1hcmtldCBhcyBjb21wZW5zYXRpb24uIFRoZSBsaXF1aWRhdGlvbiBpbmNsdWRlcwogICAgLy8gICAgIGEgYm9udXMgdG8gaW5jZW50aXZpemUgbGlxdWlkYXRvcnMgYW5kIGhlbHBzIG1haW50YWluIHByb3RvY29sIGhlYWx0aCBieSByZW1vdmluZwogICAgLy8gICAgIHVuZGVyY29sbGF0ZXJhbGl6ZWQgcG9zaXRpb25zLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgZGVidF9tYXJrZXRfaWQ6IFRoZSBtYXJrZXQgSUQgd2hlcmUgdGhlIGRlYnQgdG8gYmUgcmVwYWlkIGV4aXN0cwogICAgLy8gICAgICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogVGhlIG1hcmtldCBJRCB3aGVyZSBjb2xsYXRlcmFsIHdpbGwgYmUgc2VpemVkIGZyb20KICAgIC8vICAgICAgICAgbGlxdWlkYXRvcl9pZDogVGhlIGFjY291bnQgcGVyZm9ybWluZyB0aGUgbGlxdWlkYXRpb24KICAgIC8vICAgICAgICAgdXNlcl9pZDogVGhlIGFjY291bnQgYmVpbmcgbGlxdWlkYXRlZAogICAgLy8gICAgICAgICBkZWJ0X2Ftb3VudDogVGhlIGFtb3VudCBvZiBkZWJ0IHRvIHJlcGF5IChtdXN0IGluY2x1ZGUgYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vICAgICAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQ6IE1pbmltdW0gY29sbGF0ZXJhbCBhbW91bnQgdGhlIGxpcXVpZGF0b3IgZXhwZWN0cyB0byByZWNlaXZlCiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiBhbnkgdmFsaWRhdGlvbiBmYWlscywgaW5jbHVkaW5nOgogICAgLy8gICAgICAgICAgICAgLSBVc2luZyBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgKGJvcnJvdy1vbmx5IG1hcmtldCkKICAgIC8vICAgICAgICAgICAgIC0gQXR0ZW1wdGluZyBzZWxmLWxpcXVpZGF0aW9uCiAgICAvLyAgICAgICAgICAgICAtIE1hcmtldCBkb2Vzbid0IGV4aXN0IG9yIGlzIHBhdXNlZAogICAgLy8gICAgICAgICAgICAgLSBQb3NpdGlvbiBpcyBub3QgbGlxdWlkYXRhYmxlIChoZWFsdGggZmFjdG9yID49IDEuMCkKICAgIC8vICAgICAgICAgICAgIC0gTGlxdWlkYXRpb24gYW1vdW50IGV4Y2VlZHMgbWF4aW11bSBhbGxvd2VkIG9yIHRvdGFsIGRlYnQKICAgIC8vICAgICAgICAgICAgIC0gSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgdG8gc2VpemUKICAgIC8vICAgICAgICAgICAgIC0gQ29sbGF0ZXJhbCByZWNlaXZlZCBiZWxvdyBtaW5pbXVtIHRocmVzaG9sZAogICAgLy8gCiAgICAvLyAgICAgTm90ZXM6CiAgICAvLyAgICAgICAgIC0gVXNlcyB0aGUgY29sbGF0ZXJhbCBtYXJrZXQncyBsaXF1aWRhdGlvbiB0aHJlc2hvbGQgZm9yIGhlYWx0aCBjYWxjdWxhdGlvbgogICAgLy8gICAgICAgICAtIExpcXVpZGF0aW9uIGJvbnVzIGlzIGFwcGxpZWQgdG8gaW5jZW50aXZpemUgbGlxdWlkYXRvcnMKICAgIC8vICAgICAgICAgLSBBY2NydWVkIGludGVyZXN0IG9uIGJvdGggZGVidCBhbmQgY29sbGF0ZXJhbCBwb3NpdGlvbnMgaXMgaW5jbHVkZWQKICAgIC8vICAgICAgICAgLSBIYW5kbGVzIGRpZmZlcmVudCB0b2tlbiB0eXBlcyAoQVJDMjAwIHZzIFNUb2tlbikgYXBwcm9wcmlhdGVseQogICAgLy8gICAgICAgICAtIFVwZGF0ZXMgZ2xvYmFsIGJvcnJvdyBhbmQgY29sbGF0ZXJhbCB2YWx1ZXMgZm9yIHRoZSB1c2VyCiAgICAvLyAgICAgIiIiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBsaXF1aWRhdGUgb3BlcmF0aW9uCiAgICAvLyAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICAgICBkZWJ0X21hcmtldF9pZAogICAgLy8gICAgICkubGlxdWlkYXRlLm5hdGl2ZQogICAgLy8gICAgIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgZGVidF9hbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIkxpcXVpZGF0ZSBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIFJFTSBwcmV2ZW50IHVzaW5nIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCBpbiBsaXF1aWRhdGlvbiBiZWNhdXNlIHN0b2tlbgogICAgLy8gICAgICMgUkVNIG1hcmtldCBjb2xsYXRlcmFsIGRvZXMgbm90IGV4aXN0CiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQgIT0gc2VsZi5zdG9rZW5fYXBwX2lkCiAgICAvLyAgICAgKSwgIkNhbm5vdCB1c2Ugc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIChib3Jyb3ctb25seSBtYXJrZXQpIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBSRU0gcHJldmVudCBzZWxmIGxpcXVpZGF0aW9uCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgYXNzZXJ0IHVzZXJfaWQgIT0gbGlxdWlkYXRvcl9pZCwgIkNhbm5vdCBsaXF1aWRhdGUgc2VsZiIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCBkZWJ0X21hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJEZWJ0IG1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGZyYW1lX2RpZyAtNgogICAgaXRvYgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIwCiAgICAvLyBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIGJ5dGUgIm1hcmtldHMiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAtMjUwNgogICAgLy8gICAgIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgLy8gICAgIHNlbGYudXNlcnMgPSBCb3hNYXAoQnl0ZXM0MCwgVXNlckRhdGEpICAjIFBlci1tYXJrZXQgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzID0gQm94TWFwKEFjY291bnQsIEdsb2JhbFVzZXJEYXRhKSAgIyBHbG9iYWwgdXNlciBzdGF0ZQogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHMgPSBCb3hNYXAoCiAgICAvLyAgICAgICAgIFVJbnQ2NCwgTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICAgICApICAjIE1hcmtldCB0cmFuc2FjdGlvbiBjYXBzCiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHMgPSBCb3hNYXAoQWNjb3VudCwgVXNlckNhcCkgICMgUGVyLXVzZXIgY2FwcwogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHMgPSBCb3hNYXAoVUludDY0LCBQcmljZUZlZWQpICAjIFByaWNlIGZlZWRzCiAgICAvLyAgICAgIyBzZWxmLm1hcmtldF9jb250cm9sbGVycyA9IEJveE1hcChBY2NvdW50LCBib29sKSAgIyBNYXJrZXQgY29udHJvbGxlcnMKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIE93bmFibGUKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9vbmx5X293bmVyKHNlbGYpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IFR4bi5zZW5kZXIgPT0gc2VsZi5vd25lciwgIm9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9vd25lcihzZWxmKSAtPiBhcmM0LkFkZHJlc3M6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB0cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBhcmM0LkFkZHJlc3MpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl90cmFuc2Zlcl9vd25lcnNoaXAobmV3X293bmVyLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogQWNjb3VudCkgLT4gTm9uZToKICAgIC8vICMgICAgICMgcHJldmlvdXNfb3duZXIgPSBzZWxmLm93bmVyCiAgICAvLyAjICAgICBzZWxmLm93bmVyID0gbmV3X293bmVyCiAgICAvLyAjICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICMgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGFyYzQuQWRkcmVzcyhwcmV2aW91c19vd25lciksIGFyYzQuQWRkcmVzcyhuZXdfb3duZXIpKQogICAgLy8gIyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBTdG9yYWdlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfc3RvcmFnZV9hcHBfaWQoc3RvcmFnZV9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICBib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUgPSBzdG9yYWdlX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgaXNfcGF1c2VkKHNlbGYpIC0+IGFyYzQuQm9vbDoKICAgIC8vICAgICByZXR1cm4gYXJjNC5Cb29sKHNlbGYuX2lzX3BhdXNlZCgpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pc19wYXVzZWQoc2VsZikgLT4gYm9vbDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5wYXVzZWQgPT0gVUludDY0KDEpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlKHNlbGYsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3BhdXNlKHBhdXNlLm5hdGl2ZSkKICAgIC8vICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcGF1c2Uoc2VsZiwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYucGF1c2VkID0gcGF1c2UKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgVmVyaWZ5IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlciBvbiB0aGUgU1Rva2VuIGNvbnRyYWN0CiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b2tlbl9hcHBfaWQoc3Rva2VuX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9rZW5fYXBwX2lkKHNlbGYsIHN0b2tlbl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzdG9rZW5fYXBwID0gQXBwbGljYXRpb24oc3Rva2VuX2FwcF9pZCkKICAgIC8vICAgICBsZW5kaW5nX3Bvb2xfYWRkcmVzcyA9IEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MKICAgIC8vICAgICAjIENoZWNrIGlmIExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGlzX2FwcHJvdmVkX21pbnRlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgU1Rva2VuLmlzX21pbnRlciwgYXJjNC5BZGRyZXNzKGxlbmRpbmdfcG9vbF9hZGRyZXNzKSwgYXBwX2lkPXN0b2tlbl9hcHAKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBBc3NlcnQgdGhhdCBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBpc19hcHByb3ZlZF9taW50ZXIKICAgIC8vICAgICApLCAiTGVuZGluZ1Bvb2wgbXVzdCBiZSBhcHByb3ZlZCBhcyBTVG9rZW4gbWludGVyIGJlZm9yZSBzZXR0aW5nIGFwcCBJRCIKICAgIC8vICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgPSBzdG9rZW5fYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9rZXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJ5dGVzNDA6CiAgICAvLyAgICAgcmV0dXJuIEJ5dGVzNDAuZnJvbV9ieXRlcygKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLmJ5dGVzICsgYXJjNC5VSW50NjQobWFya2V0X2lkKS5ieXRlcwogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBVc2VyRGF0YToKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9rZXkgaW4gc2VsZi51c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcnNbdXNlcl9rZXldCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbChMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcCkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXIKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmRlcG9zaXRfaW5kZXggPSBtYXJrZXQuZGVwb3NpdF9pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHJlcGF5IHRoaXMgYW1vdW50IgogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgY3JlYXRlX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICByZXNlcnZlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgYm9ycm93X3JhdGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHNsb3BlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBtYXhfdG90YWxfZGVwb3NpdHM6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtYXhfdG90YWxfYm9ycm93czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX2JvbnVzOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjbG9zZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gKSAtPiBhcmM0LlVJbnQ2NDoKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMTEgRml4OiBFbnN1cmUgbGlxdWlkYXRpb25fdGhyZXNob2xkID4gY29sbGF0ZXJhbF9mYWN0b3IKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQubmF0aXZlID4gY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlCiAgICAvLyAgICAgKSwgIkxpcXVpZGF0aW9uIHRocmVzaG9sZCBtdXN0IGJlID4gY29sbGF0ZXJhbCBmYWN0b3IiCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDY0KAogICAgLy8gICAgICAgICBzZWxmLl9jcmVhdGVfbWFya2V0KAogICAgLy8gICAgICAgICAgICAgdG9rZW5faWQubmF0aXZlLAogICAgLy8gICAgICAgICAgICAgTWFya2V0RGF0YSgKICAgIC8vICAgICAgICAgICAgICAgICBwYXVzZWQ9YXJjNC5Cb29sKFRydWUpLCAgIyBTdGFydCBwYXVzZWQgdW50aWwgcHJpY2UgaXMgc2V0CiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2RlcG9zaXRzPW1heF90b3RhbF9kZXBvc2l0cywKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfYm9ycm93cz1tYXhfdG90YWxfYm9ycm93cywKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl9ib251cz1saXF1aWRhdGlvbl9ib251cywKICAgIC8vICAgICAgICAgICAgICAgICBjb2xsYXRlcmFsX2ZhY3Rvcj1jb2xsYXRlcmFsX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ9bGlxdWlkYXRpb25fdGhyZXNob2xkLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVfZmFjdG9yPXJlc2VydmVfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19yYXRlPWJvcnJvd19yYXRlLAogICAgLy8gICAgICAgICAgICAgICAgIHNsb3BlPXNsb3BlLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9kZXBvc2l0cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2JvcnJvd3M9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIGRlcG9zaXRfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfaW5kZXg9YXJjNC5VSW50MjU2KFNDQUxFKSwgICMgU3RhcnQgYXQgU0NBTEUgKDEuMCkKICAgIC8vICAgICAgICAgICAgICAgICBsYXN0X3VwZGF0ZV90aW1lPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlcz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgcHJpY2U9YXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgICAgICAgICAwCiAgICAvLyAgICAgICAgICAgICAgICAgKSwgICMgUHJpY2UgbXVzdCBiZSBzZXQgYmVmb3JlIG1hcmtldCBjYW4gYmUgdXNlZAogICAgLy8gICAgICAgICAgICAgICAgIG50b2tlbl9pZD1hcmM0LlVJbnQ2NCgwKSwgICMgV2lsbCBiZSBzZXQgZHVyaW5nIHRva2VuIGluaXRpYWxpemF0aW9uCiAgICAvLyAgICAgICAgICAgICAgICAgY2xvc2VfZmFjdG9yPWNsb3NlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NyZWF0ZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IFVJbnQ2NDoKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMjAwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBjcmVhdGUgbWFya2V0IgogICAgLy8gICAgIGNvbXBpbGVkID0gY29tcGlsZV9jb250cmFjdChOVG9rZW4sIGV4dHJhX3Byb2dyYW1fcGFnZXM9MCkgICMgbm8gZXh0cmEgcGFnZXMKICAgIC8vICAgICBiYXNlX2FwcCA9IGFyYzQuYXJjNF9jcmVhdGUoTlRva2VuLCBjb21waWxlZD1jb21waWxlZCkuY3JlYXRlZF9hcHAKICAgIC8vICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgIHJlY2VpdmVyPWJhc2VfYXBwLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAwLCBmZWU9MCAgIyBtaW4gMTA4OTAwIHNlbmRzIDEwMDAwMDAKICAgIC8vICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJvb3RzdHJhcDY0LAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1iYXNlX2FwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0X2RhdGEubnRva2VuX2lkID0gYXJjNC5VSW50NjQoYmFzZV9hcHAuaWQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gICAgIGFyYzQuZW1pdChNYXJrZXRDcmVhdGVkKGFyYzQuVUludDY0KHRva2VuX2lkKSkpCiAgICAvLyAgICAgcmV0dXJuIGJhc2VfYXBwLmlkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZChyZWFkb25seT1UcnVlKQogICAgLy8gZGVmIGdldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0czoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0c1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldFRyYW5zYWN0aW9uQ2FwOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IFVzZXJDYXA6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLnVzZXJfY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgdXNlcl9jYXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3VzZXJfY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzW3VzZXJfaWRdID0gdXNlcl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoVXNlckNhcFNldChhcmM0LkFkZHJlc3ModXNlcl9pZCksIHVzZXJfY2FwKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlLCB0cmFuc2FjdGlvbl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzW3Rva2VuX2lkXSA9IHRyYW5zYWN0aW9uX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRUcmFuc2FjdGlvbkNhcFNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIHRyYW5zYWN0aW9uX2NhcCkpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBtYXJrZXQgY29udHJvbGxlcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgbWFya2V0X2RhdGEpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfZGF0YS5wcmljZSA9PSBtYXJrZXQucHJpY2UsICJQcmljZSBtaXNtYXRjaCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBwcmljZSBmZWVkIGNvbnN1bWVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIGlmIHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHByaWNlX2ZlZWQsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X3ByaWNlX2ZlZWRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBwcmljZV9mZWVkCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGF0dGFjaF9wcmljZV9mZWVkKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2F0dGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSwgcHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYXR0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJvdmlkZXJfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQpCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0gPSBQcmljZUZlZWQoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcD1QcmljZVdpdGhUaW1lc3RhbXAoCiAgICAvLyAgICAgICAgICAgICBwcmljZT1tYXJrZXQucHJpY2UsCiAgICAvLyAgICAgICAgICAgICB0aW1lc3RhbXA9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICApLAogICAgLy8gICAgICkKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWRBdHRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fZGV0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBkZWwgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBQcmljZUZlZWREZXRhY2hlZCgKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcmljZTogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQubmF0aXZlLCBwcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9tYXJrZXRfcHJpY2Uoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcHJpY2U6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgICMgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBhbHJlYWR5IGF0dGFjaGVkIgogICAgLy8gICAgIGFzc2VydCBwcmljZSA+IDAsICJQcmljZSBtdXN0IGJlIHBvc2l0aXZlIgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgVW5wYXVzZSB0aGUgbWFya2V0IG9uIGZpcnN0IHByaWNlIHNldAogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQgYW5kIG1hcmtldC5wcmljZSA9PSAwOgogICAgLy8gICAgICAgICBtYXJrZXQucGF1c2VkID0gYXJjNC5Cb29sKEZhbHNlKQogICAgLy8gCiAgICAvLyAgICAgIyBTY2FsZSB0aGUgcHJpY2UgYnkgU0NBTEUgaW50ZXJuYWxseSBmb3Igc3RvcmFnZQogICAgLy8gICAgIG1hcmtldC5wcmljZSA9IGFyYzQuVUludDI1NihwcmljZSAqIFNDQUxFKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFByaWNlU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgYXJjNC5VSW50MjU2KHByaWNlKSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgc2VsZi5fZmV0Y2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2ZldGNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDEwMDAwMCwgImluc3VmZmljaWVudCBwYXltZW50IGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS01CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgcGF5bWVudCA8PSAxMDAwMDAwCiAgICAvLyAgICAgKSwgInBheW1lbnQgZXhjZWVkcyBtYXhpbXVtIGZvciBmZXRjaCBwcmljZSBmZWVkIiAgIyAxZS02CiAgICAvLyAgICAgYXBwID0gQXBwbGljYXRpb24oc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJvdmlkZXJfYXBwX2lkLm5hdGl2ZSkKICAgIC8vICAgICBpdHhuLlBheW1lbnQocmVjZWl2ZXI9YXBwLmFkZHJlc3MsIGFtb3VudD1wYXltZW50LCBmZWU9MCkuc3VibWl0KCkKICAgIC8vICAgICBwcmljZV93aXRoX3RpbWVzdGFtcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgUHJpY2VGZWVkUHJvdmlkZXJJbnRlcmZhY2UuZ2V0X3ByaWNlX3dpdGhfdGltZXN0YW1wLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIGlmICgKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICAgICA+IHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICApOgogICAgLy8gICAgICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcCA9ICgKICAgIC8vICAgICAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLmNvcHkoKQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHNlbGYuX3NldF9tYXJrZXRfcHJpY2UodG9rZW5faWQsIHByaWNlX3dpdGhfdGltZXN0YW1wLnByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fcGF1c2VfbWFya2V0KHRva2VuX2lkLm5hdGl2ZSwgcGF1c2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9wYXVzZV9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgcGF1c2U6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0ucGF1c2VkID0gYXJjNC5Cb29sKHBhdXNlID09IFVJbnQ2NCgxKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY19tYXJrZXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYWNjcnVlX2ludGVyZXN0KHNlbGYsIG1hcmtldF9pZDogVUludDY0KSAtPiBNYXJrZXREYXRhOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGlmIG1hcmtldC5wYXVzZWQ6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgIGN1cnJlbnRfdGltZSA9IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wCiAgICAvLyAgICAgdGltZV9kZWx0YSA9IGN1cnJlbnRfdGltZSAtIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lLm5hdGl2ZQogICAgLy8gICAgIGlmIHRpbWVfZGVsdGEgPD0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgIyBGb3Igc3Rva2VuIG1hcmtldCAoYm9ycm93LW9ubHkpLCB1c2UgYSBmaXhlZCB1dGlsaXphdGlvbiByYXRlIHNpbmNlIHRoZXJlIGFyZSBubyBkZXBvc2l0cwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHV0aWxpemF0aW9uID0gQmlnVUludCgxMDAwMCkgICMgMTAwJSB1dGlsaXphdGlvbiBmb3IgYm9ycm93LW9ubHkgbWFya2V0CiAgICAvLyAgICAgZWxpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgdXRpbGl6YXRpb24gPSAoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogMTAwMDAKICAgIC8vICAgICAgICAgKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgIHJhdGUgPSBtYXJrZXQuYm9ycm93X3JhdGUubmF0aXZlICsgKG1hcmtldC5zbG9wZS5uYXRpdmUgKiB1dGlsaXphdGlvbikgLy8gMTAwMDAKICAgIC8vICAgICBpbnRlcmVzdCA9IChyYXRlICogbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHRpbWVfZGVsdGEpIC8vICgKICAgIC8vICAgICAgICAgc2VsZi5zZWNvbmRzX3Blcl95ZWFyICogMTAwMDAKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHN0b2tlbiBtYXJrZXQgLSBhbGwgaW50ZXJlc3QgZ29lcyB0byByZXNlcnZlcwogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBhcmM0LlVJbnQyNTYuZnJvbV9ieXRlcyhtYXJrZXQucmVzZXJ2ZV9mYWN0b3IuYnl0ZXMpLm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIDEwMDAwCiAgICAvLyAgICAgICAgIGlmIHByb3RvY29sX3BvcnRpb24gPiBpbnRlcmVzdDoKICAgIC8vICAgICAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSBpbnRlcmVzdAogICAgLy8gICAgICAgICBkZXBvc2l0b3JfcG9ydGlvbiA9IGludGVyZXN0IC0gcHJvdG9jb2xfcG9ydGlvbgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChkZXBvc2l0b3JfcG9ydGlvbiAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID4gMDoKICAgIC8vICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICAgICArIChpbnRlcmVzdCAqIFNDQUxFKSAvLyBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGludGVyZXN0CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgZGVwb3NpdG9yX3BvcnRpb24KICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgKyBwcm90b2NvbF9wb3J0aW9uKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoY3VycmVudF90aW1lKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAgICAgcmV0dXJuIG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gIyBUT0RPIGdvdmVybmFuY2U6IGNvbnNpZGVyIGlmIHJlc2VydmUgd2l0aGRyYXdhbCBzaG91bGQgcmVxdWlyZSBhZGRpdGlvbmFsCiAgICAvLyAjICAgICAgZ292ZXJuYW5jZSBtZWNoYW5pc21zCiAgICAvLyAjIFRPRE8gbWluaW11bSByZXNlcnZlIGxldmVsczogbWlnaHQgd2FudCB0byBlbmZvcmNlIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHMgZm9yCiAgICAvLyAjICAgICAgcHJvdG9jb2wgc2FmZXR5CiAgICAvLyAjIFRPRE8gZXZlbnQgZW1pc3Npb246IENvbnNpZGVyIGFkZGluZyBhbiBldmVudCB0byBsb2cgcmVzZXJ2ZSB3aXRoZHJhd2FscyBmb3IKICAgIC8vICMgICAgICB0cmFuc3BhcmVuY3kKICAgIC8vIAogICAgLy8gIyBSRU0gaW50ZW50aW9uYWxseSBza2lwcGluZyBzdWJyb3V0aW5lIHRvIHJlZHVjZSBjb250cmFjdCBzaXplCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl93aXRoZHJhd19yZXNlcnZlcyhtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhd19yZXNlcnZlcyhzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIEFjY3J1ZSBpbnRlcmVzdCBmaXJzdCB0byBnZXQgdXAtdG8tZGF0ZSByZXNlcnZlcwogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgPj0gYW1vdW50LCAiSW5zdWZmaWNpZW50IHJlc2VydmVzIgogICAgLy8gCiAgICAvLyAgICAgIyBUcmFuc2ZlciByZXNlcnZlcyB0byB0aGUgb3duZXIgKG5vdCB0byB0aGUgY29udHJhY3QgaXRzZWxmKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVcGRhdGUgcmVzZXJ2ZXMKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbigKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50LCBndWFyZF9zdG9rZW46IGJvb2wKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCBtYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCBhbW91bnQgPiAwLCAiQW1vdW50IG11c3QgYmUgPiAwIgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBub3QgbWFya2V0LnBhdXNlZCwgIk1hcmtldCBpcyBwYXVzZWQiCiAgICAvLyAgICAgaWYgZ3VhcmRfc3Rva2VuOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgc2VsZi5zdG9rZW5fYXBwX2lkICE9IG1hcmtldF9pZAogICAgLy8gICAgICAgICApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGZvciB0aGlzIG9wZXJhdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGVwb3NpdChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9kZXBvc2l0KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgUkVNIG1heSBhZGQgcHJvdGVjdGlvbiBmb3IgbG93IHV0aWxpc2F0aW9uIGluIGZ1dHVyZQogICAgLy8gIyBSRU0gbG93ZXIgbWF4IGRlcG9zaXQgYW1vdW50IGZvciBsb3cgdXRpbGlzYXRpb24KICAgIC8vICMgUkVNIGhpZ2ggbWF4IGRlcG9zaXQgYW1vdW50IGZvciBoaWdoIHV0aWxpc2F0aW9uCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlcG9zaXQoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBJbnRlcm5hbCBkZXBvc2l0IG1ldGhvZCB0aGF0IGhhbmRsZXMgdXNlciBkZXBvc2l0cyBpbnRvIGEgbGVuZGluZyBtYXJrZXQuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBwZXJmb3JtcyBhIGNvbXBsZXRlIGRlcG9zaXQgb3BlcmF0aW9uIGluY2x1ZGluZzoKICAgIC8vICAgICAxLiBWYWxpZGF0aW5nIHRoZSBtYXJrZXQgb3BlcmF0aW9uIChwcm90b2NvbCBub3QgcGF1c2VkLCBtYXJrZXQgZXhpc3RzLCBhbW91bnQgPiAwLCBtYXJrZXQgbm90IHBhdXNlZCkKICAgIC8vICAgICAyLiBUcmFuc2ZlcnJpbmcgQVJDMjAwIHRva2VucyBmcm9tIHVzZXIgdG8gdGhlIGxlbmRpbmcgcG9vbCBjb250cmFjdAogICAgLy8gICAgIDMuIEFjY3J1aW5nIGludGVyZXN0IG9uIHRoZSBtYXJrZXQgdG8gZ2V0IHVwZGF0ZWQgZGVwb3NpdCBpbmRleAogICAgLy8gICAgIDQuIENhbGN1bGF0aW5nIGFuZCBhZGRpbmcgZWFybmVkIGludGVyZXN0IHRvIHRoZSB1c2VyJ3MgcG9zaXRpb24KICAgIC8vICAgICA1LiBDb252ZXJ0aW5nIGRlcG9zaXQgYW1vdW50IHRvIHNjYWxlZCBkZXBvc2l0cyB1c2luZyBjdXJyZW50IGRlcG9zaXQgaW5kZXgKICAgIC8vICAgICA2LiBDaGVja2luZyBkZXBvc2l0IGNhcCBjb25zdHJhaW50cwogICAgLy8gICAgIDcuIFVwZGF0aW5nIHVzZXIgYW5kIG1hcmtldCBzY2FsZWQgZGVwb3NpdCBiYWxhbmNlcwogICAgLy8gICAgIDguIE1pbnRpbmcgTlRva2VucyB0byByZXByZXNlbnQgdGhlIHVzZXIncyBkZXBvc2l0IHBvc2l0aW9uCiAgICAvLyAgICAgOS4gVXBkYXRpbmcgZ2xvYmFsIGNvbGxhdGVyYWwgY2FsY3VsYXRpb25zIGZvciB0aGUgdXNlcgogICAgLy8gICAgIDEwLiBFbWl0dGluZyBhIE1hcmtldERlcG9zaXQgZXZlbnQKICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQgKEFjY291bnQpOiBUaGUgYWNjb3VudCBJRCBvZiB0aGUgdXNlciBtYWtpbmcgdGhlIGRlcG9zaXQKICAgIC8vICAgICAgICAgbWFya2V0X2lkIChVSW50NjQpOiBUaGUgSUQgb2YgdGhlIG1hcmtldCB0byBkZXBvc2l0IGludG8KICAgIC8vICAgICAgICAgYW1vdW50IChCaWdVSW50KTogVGhlIGFtb3VudCBvZiB1bmRlcmx5aW5nIHRva2VucyB0byBkZXBvc2l0CiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiBtYXJrZXQgdmFsaWRhdGlvbiBmYWlscywgZGVwb3NpdCBjYXAgaXMgZXhjZWVkZWQsIG9yIG90aGVyIGNvbnN0cmFpbnRzIGFyZSB2aW9sYXRlZAogICAgLy8gCiAgICAvLyAgICAgTm90ZToKICAgIC8vICAgICAgICAgLSBJbnRlcmVzdCBlYXJuZWQgc2luY2UgbGFzdCBpbnRlcmFjdGlvbiBpcyBhdXRvbWF0aWNhbGx5IGFkZGVkIHRvIHRoZSBkZXBvc2l0CiAgICAvLyAgICAgICAgIC0gU2NhbGVkIGRlcG9zaXRzIGFyZSB1c2VkIHRvIHRyYWNrIHVzZXIgcG9zaXRpb25zIGFuZCBjYWxjdWxhdGUgaW50ZXJlc3QKICAgIC8vICAgICAgICAgLSBDb2xsYXRlcmFsIHZhbHVlIGlzIHVwZGF0ZWQgdXNpbmcgZWl0aGVyIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIG9yIGN1cnJlbnQgbWFya2V0IHByaWNlCiAgICAvLyAgICAgICAgIC0gTlRva2VucyBhcmUgbWludGVkIHRvIHJlcHJlc2VudCB0aGUgdXNlcidzIGRlcG9zaXQgcG9zaXRpb24gKGFtb3VudCArIGludGVyZXN0KQogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgKS5kZXBvc2l0Lm5hdGl2ZQogICAgLy8gICAgIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJEZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApICAjIEdldCB1cGRhdGVkIG1hcmtldCB3aXRoIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBBZGQgZWFybmVkIGludGVyZXN0IHRvIHVzZXIncyBwb3NpdGlvbiBhcyBhZGRpdGlvbmFsIHNjYWxlZCBkZXBvc2l0cwogICAgLy8gICAgIGludGVyZXN0X3NjYWxlZF9hbW91bnQgPSBCaWdVSW50KDApCiAgICAvLyAgICAgaWYgaW50ZXJlc3QgPiAwOgogICAgLy8gICAgICAgICBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgaW50ZXJlc3QgKiBTQ0FMRQogICAgLy8gICAgICAgICApIC8vIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIGFtb3VudCAqIFNDQUxFCiAgICAvLyAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgLy8gCiAgICAvLyAgICAgdG90YWxfc2NhbGVkX2Ftb3VudCA9IHNjYWxlZF9hbW91bnQgKyBpbnRlcmVzdF9zY2FsZWRfYW1vdW50CiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0Lm1heF90b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgPj0gbmV3X21hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgdG90YWxfc2NhbGVkX2Ftb3VudAogICAgLy8gICAgICksICJNYXJrZXQgZGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsIHVzZXJfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHRvdGFsX3NjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50ICsgaW50ZXJlc3QpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2RlcG9zaXRfYW1vdW50ID0gb2xkX2RlcG9zaXRfYW1vdW50ICsgYW1vdW50ICsgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgIyBGYWxsYmFjazogVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIHRvIHByZXZlbnQgbmVnYXRpdmUgY29sbGF0ZXJhbAogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSA9IChuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICAjIE5vcm1hbCBjYXNlOiBVc2UgdXNlcidzIGxhc3QgcmVjb3JkZWQgcHJpY2UgZm9yIGFjY3VyYXRlIGNvbGxhdGVyYWwgcmVkdWN0aW9uCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIGRlcG9zaXQgb3BlcmF0aW9uCiAgICAvLyAgICAgdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC50b3RhbF9kZXBvc2l0cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICApLCAiVXNlciBkZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCh1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF92YWx1ZSwgbmV3X3ZhbHVlKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0RGVwb3NpdCgKICAgIC8vICAgICAjICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLCBhcmM0LlVJbnQyNTYoYW1vdW50KQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGNhbGN1bGF0ZV91c2VyX2ludGVyZXN0KAogICAgLy8gIyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyAjICkgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAjICAgICByZXR1cm4gYXJjNC5VSW50MjU2KAogICAgLy8gIyAgICAgICAgIHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgaW50ZXJlc3QiIiIKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgdW5kZXJseWluZyBhbW91bnQKICAgIC8vICAgICB1c2VyX3RvdGFsX3VuZGVybHlpbmcgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIEludGVyZXN0IGlzIHRoZSBkaWZmZXJlbmNlIGZyb20gdGhlIHNjYWxlZCBkZXBvc2l0cyAod2hpY2ggcmVwcmVzZW50IHRoZSAiYmFzZSIgYW1vdW50KQogICAgLy8gICAgIGludGVyZXN0ID0gdXNlcl90b3RhbF91bmRlcmx5aW5nIC0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gaW50ZXJlc3QKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIGNhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAjICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICMgKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAjICAgICBlbnN1cmVfYnVkZ2V0KDcwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICMgICAgIHJldHVybiBhcmM0LlVJbnQyNTYoCiAgICAvLyAjICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBkZWJ0IGludGVyZXN0IiIiCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIHVuZGVybHlpbmcgZGVidCBhbW91bnQKICAgIC8vICAgICB1c2VyX3RvdGFsX2RlYnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgb3JpZ2luYWwgcHJpbmNpcGFsIGFtb3VudCB1c2luZyB1c2VyJ3MgYm9ycm93X2luZGV4CiAgICAvLyAgICAgIyBTYWZldHkgY2hlY2s6IGlmIHVzZXIncyBib3Jyb3dfaW5kZXggaXMgMCwgdXNlIGN1cnJlbnQgbWFya2V0IGJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXJfYm9ycm93X2luZGV4ID0gKAogICAgLy8gICAgICAgICB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBvcmlnaW5hbF9wcmluY2lwYWwgPSAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyX2JvcnJvd19pbmRleCkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRvdGFsIGRlYnQgYW5kIG9yaWdpbmFsIHByaW5jaXBhbAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSB1c2VyX3RvdGFsX2RlYnQgLSBvcmlnaW5hbF9wcmluY2lwYWwKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHdpdGhkcmF3KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyMTAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gCiAgICAvLyAgICAgIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgd2l0aGRyYXduIGZyb20gdG8gdXBkYXRlIGdsb2JhbCB2YWx1ZXMgd2l0aCBpbnRlcmVzdAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIGFyYzQuVUludDI1NihzZWxmLl93aXRoZHJhdyhUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXcoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFdpdGhkcmF3IHRva2VucyBmcm9tIGEgbGVuZGluZyBtYXJrZXQgYnkgYnVybmluZyBuVG9rZW5zLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgaGFuZGxlcyB0aGUgd2l0aGRyYXdhbCBwcm9jZXNzIGJ5OgogICAgLy8gICAgIDEuIFZhbGlkYXRpbmcgdGhlIG1hcmtldCBvcGVyYXRpb24gYW5kIHVzZXIgYmFsYW5jZQogICAgLy8gICAgIDIuIEFjY3J1aW5nIGludGVyZXN0IHRvIGdldCB0aGUgbGF0ZXN0IG1hcmtldCBzdGF0ZQogICAgLy8gICAgIDMuIENhbGN1bGF0aW5nIHVzZXIncyBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgNC4gUGVyZm9ybWluZyBoZWFsdGggY2hlY2tzIHRvIGVuc3VyZSB3aXRoZHJhd2FsIGRvZXNuJ3QgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgIDUuIEJ1cm5pbmcgblRva2VucyBhbmQgdHJhbnNmZXJyaW5nIHVuZGVybHlpbmcgdG9rZW5zIHRvIHVzZXIKICAgIC8vICAgICA2LiBVcGRhdGluZyBnbG9iYWwgY29sbGF0ZXJhbCB2YWx1ZXMKICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIHdpdGhkcmF3aW5nIHRva2VucwogICAgLy8gICAgICAgICBtYXJrZXRfaWQ6IFRoZSBJRCBvZiB0aGUgbWFya2V0IHRvIHdpdGhkcmF3IGZyb20KICAgIC8vICAgICAgICAgYW1vdW50OiBUaGUgYW1vdW50IG9mIG5Ub2tlbnMgdG8gYnVybiAobm90IHRoZSB1bmRlcmx5aW5nIHRva2VuIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAgIFJldHVybnM6CiAgICAvLyAgICAgICAgIEJpZ1VJbnQ6IFRoZSB0b3RhbCBhbW91bnQgb2YgdW5kZXJseWluZyB0b2tlbnMgdHJhbnNmZXJyZWQgdG8gdGhlIHVzZXIKICAgIC8vICAgICAgICAgICAgICAgICAoaW5jbHVkZXMgYm90aCB0aGUgd2l0aGRyYXduIGFtb3VudCBhbmQgYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIHVzZXIgaGFzIGluc3VmZmljaWVudCBiYWxhbmNlIG9yIHdpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciB3aXRoZHJhdyBvcGVyYXRpb24KICAgIC8vICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gICAgICkud2l0aGRyYXcubmF0aXZlCiAgICAvLyAgICAgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIldpdGhkcmF3IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgYW1vdW50IGlzIHRoZSBhbW91bnQgb2YgblRva2VucyBiZWluZyBidXJuZWQKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBhbW91bnQgPD0gdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgICMgaGVhbHRoIGNoZWNrOiBlbnN1cmUgd2l0aGRyYXcgd291bGQgbm90IHB1dCBib3Jyb3dzIGF0IHJpc2sKICAgIC8vICAgICBpZiBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPiAwOgogICAgLy8gICAgICAgICAjIHZhbHVlIG9mIHVuZGVybHlpbmcgYW1vdW50IHRvIHdpdGhkcmF3IHVzaW5nIG5ldyBtYXJrZXQgcHJpY2UKICAgIC8vICAgICAgICAgd2l0aGRyYXdfdmFsdWUgPSAoYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsID0gKAogICAgLy8gICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSB3aXRoZHJhd192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIGFzc2VydCBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIDw9ICgKICAgIC8vICAgICAgICAgICAgIHJlbWFpbmluZ19jb2xsYXRlcmFsICogQmlnVUludChuZXdfbWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICAgICAgICAgKSAvLyBCaWdVSW50KDEwMDAwKSwgIldpdGhkcmF3YWwgd291bGQgcHV0IGJvcnJvd3MgYXQgcmlzayIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCB1c2VyX2lkLCBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19kZXBvc2l0X2Ftb3VudCA9IG9sZF9kZXBvc2l0X2Ftb3VudCArIGludGVyZXN0IC0gYW1vdW50CiAgICAvLyAKICAgIC8vICAgICBhbW91bnRfdXNkX3ZhbHVlID0gKGFtb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHVzZXIgY2FwIGZvciB3aXRoZHJhdyBvcGVyYXRpb24KICAgIC8vICAgICB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgIGlmIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPT0gMDoKICAgIC8vICAgICAgICAgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wICsgODY0MDApCiAgICAvLyAgICAgZWxpZiB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lIDwgR2xvYmFsLmxhdGVzdF90aW1lc3RhbXA6CiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KDApCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX2xpcXVpZGF0aW9ucyA9IGFyYzQuVUludDI1NigwKQogICAgLy8gICAgICAgICB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC5kYWlseV93aXRoZHJhd2Fscy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBuZXdfdG90YWxfd2l0aGRyYXdhbHMgPSB1c2VyX2NhcC50b3RhbF93aXRoZHJhd2Fscy5uYXRpdmUgKyBhbW91bnRfdXNkX3ZhbHVlCiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICBuZXdfdG90YWxfd2l0aGRyYXdhbHMgPD0gdXNlcl9jYXAuZGFpbHlfd2l0aGRyYXdhbHMubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIHdpdGhkcmF3IGNhcCBleGNlZWRlZCIKICAgIC8vICAgICAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYobmV3X3RvdGFsX3dpdGhkcmF3YWxzKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZCwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgICMgRmFsbGJhY2s6IFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSB0byBwcmV2ZW50IG5lZ2F0aXZlIGNvbGxhdGVyYWwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgIyBOb3JtYWwgY2FzZTogVXNlIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIGZvciBhY2N1cmF0ZSBjb2xsYXRlcmFsIHJlZHVjdGlvbgogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIEVtaXQgZXZlbnRzCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0V2l0aGRyYXcoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgYXJjNC5VSW50NjQobWFya2V0X2lkKSwgYXJjNC5VSW50MjU2KGFtb3VudCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gYW1vdW50ICsgaW50ZXJlc3QKICAgIC8vIAogICAgLy8gIyB3aXRoZHJhdyBjb3N0IDkwMDAwMAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBib3Jyb3coc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgyODAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gCiAgICAvLyAgICAgIyBTeW5jIHRoZSBtYXJrZXQgYmVpbmcgYm9ycm93ZWQgZnJvbSB0byB1cGRhdGUgZ2xvYmFsIHZhbHVlcyB3aXRoIGludGVyZXN0CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9ib3Jyb3coVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfYm9ycm93KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBib3Jyb3cgb3BlcmF0aW9uCiAgICAvLyAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApLmJvcnJvdy5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KHVzZXJfaWQpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gVUludDY0KDEwMDAwMCksICJQYXltZW50IGFtb3VudCBtdXN0IGJlID49IDAuMSIKICAgIC8vIAogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGN1cnJlbnQgbWFya2V0IHRvdGFsIGJvcnJvd3MgKGluY2x1ZGluZyBpbnRlcmVzdCkKICAgIC8vICAgICBjdXJyZW50X21hcmtldF90b3RhbF9ib3Jyb3dzID0gKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIGFtb3VudCBiZWluZyBhZGRlZCAobmV3IGJvcnJvdyArIGRlYnQgaW50ZXJlc3QpCiAgICAvLyAgICAgIyBkZWJ0IGludGVyZXN0IGFkZGVkIGF0IHRoaXMgcG9pbnQgdG8gcHJldmVudCB1bm5lY2Vzc2FyeSBkZWJ0IHJlc2V0CiAgICAvLyAgICAgdG90YWxfYW1vdW50X3RvX2FkZCA9IGFtb3VudCArIGRlYnRfaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgICMgVmFsaWRhdGUgYWdhaW5zdCBtYXJrZXQtd2lkZSBib3Jyb3cgY2FwCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbmV3X21hcmtldC5tYXhfdG90YWxfYm9ycm93cy5uYXRpdmUKICAgIC8vICAgICAgICAgPj0gY3VycmVudF9tYXJrZXRfdG90YWxfYm9ycm93cyArIHRvdGFsX2Ftb3VudF90b19hZGQKICAgIC8vICAgICApLCAiQm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgICMgQ2hlY2sgY29sbGF0ZXJhbCByZXF1aXJlbWVudHMgLSBleGNsdWRlIHNhbWUgbWFya2V0IGNvbGxhdGVyYWwgdG8gcHJldmVudAogICAgLy8gICAgICMgaW5lZmZpY2llbnQgc2FtZS1hc3NldCBib3Jyb3dpbmcKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgbmV3X2JvcnJvd192YWx1ZSA9ICh0b3RhbF9hbW91bnRfdG9fYWRkICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgdG90YWxfYm9ycm93X3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSArIG5ld19ib3Jyb3dfdmFsdWUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IEJpZ1VJbnQoMCk6CiAgICAvLyAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICAgICAjIFVzZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGRlcG9zaXRlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgZXhjbHVkZWRfdmFsdWUgPSAoZGVwb3NpdGVkX2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBpZiBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSA+IGV4Y2x1ZGVkX3ZhbHVlOgogICAgLy8gICAgICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSAoCiAgICAvLyAgICAgICAgICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBleGNsdWRlZF92YWx1ZQogICAgLy8gICAgICAgICAgICAgKQogICAgLy8gICAgICAgICBlbHNlOgogICAgLy8gICAgICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSBCaWdVSW50KDApCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgdG90YWxfYm9ycm93X3ZhbHVlIDw9ICgKICAgIC8vICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgKiBCaWdVSW50KG5ld19tYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgLy8gICAgICkgLy8gQmlnVUludCgxMDAwMCksICJJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCBhY3Jvc3MgbWFya2V0cyIKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHNjYWxlZCBhbW91bnQgZm9yIHRoZSB0b3RhbAogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAodG90YWxfYW1vdW50X3RvX2FkZCAqIFNDQUxFKSAvLyBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBvbGRfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUgLy8gU0NBTEUKICAgIC8vICAgICApCiAgICAvLyAgICAgbmV3X2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgICAgICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgaWYgdXNlciBkb2Vzbid0IGhhdmUgYSBwcmV2aW91cyBwcmljZQogICAgLy8gICAgIHByaWNlX2Zvcl9vbGQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBwcmljZV9mb3JfbmV3ID0gbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIG9sZF92YWx1ZSA9IChvbGRfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X3ZhbHVlID0gKG5ld19ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX25ldykgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3IgYm9ycm93IG9wZXJhdGlvbgogICAgLy8gICAgIHVzZXJfY2FwID0gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9jYXAudG90YWxfYm9ycm93cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3ZhbHVlIDw9IHVzZXJfY2FwLnRvdGFsX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIGJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlLCAgIyBvbGQgVVNEIHZhbHVlCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSwgICMgbmV3IFVTRCB2YWx1ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgaWYgc3Rva2VuLCBtaW50IHN0b2tlbgogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBTVG9rZW4ubWludCwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICAgICAgcmVjZWl2ZXI9QXBwbGljYXRpb24obWFya2V0X2lkKS5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwLCBmZWU9MAogICAgLy8gICAgICAgICApLnN1Ym1pdCgpCiAgICAvLyAgICAgIyBpZiBhVG9rZW4sIHRyYW5zZmVyIGFUb2tlbgogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRCb3Jyb3coCiAgICAvLyAgICAgIyAgICAgICAgIHVzZXI9YXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICMgICAgICAgICB0b2tlbl9pZD1hcmM0LlVJbnQ2NChtYXJrZXRfaWQpLAogICAgLy8gICAgICMgICAgICAgICBhbW91bnQ9YXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiByZXBheShzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fcmVwYXkoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcmVwYXkoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBSZXBheSBib3Jyb3dlZCB0b2tlbnMgZm9yIGEgc3BlY2lmaWMgbWFya2V0LgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgaGFuZGxlcyB0aGUgcmVwYXltZW50IG9mIGJvcnJvd2VkIHRva2VucyB3aXRoIGEgbWluaW11bSBpbnRlcmVzdAogICAgLy8gICAgIHJlcXVpcmVtZW50LiBJdCBzdXBwb3J0cyBib3RoIHNUb2tlbiAoYnVybikgYW5kIGFUb2tlbiAodHJhbnNmZXIpIG1hcmtldHMuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgdXNlciBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIG1hcmtldF9pZDogVGhlIG1hcmtldCBJRCB0byByZXBheSB0b2tlbnMgZm9yCiAgICAvLyAgICAgICAgIGFtb3VudDogVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gcmVwYXkgKG11c3QgYmUgPj0gYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIG1hcmtldCB2YWxpZGF0aW9uIGZhaWxzLCByZXBheSBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0LAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgIHJlcGF5IGFtb3VudCBpcyBsZXNzIHRoYW4gYWNjcnVlZCBpbnRlcmVzdCwgb3IgcHJpbmNpcGFsCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgcmVwYXltZW50IGV4Y2VlZHMgc2NhbGVkIGRlYnQKICAgIC8vIAogICAgLy8gICAgIFByb2Nlc3M6CiAgICAvLyAgICAgICAgIDEuIFZhbGlkYXRlcyBtYXJrZXQgb3BlcmF0aW9uIGFuZCBhY2NydWVzIGludGVyZXN0CiAgICAvLyAgICAgICAgIDIuIENhbGN1bGF0ZXMgdG90YWwgZGVidCBpbmNsdWRpbmcgYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gICAgICAgICAzLiBWYWxpZGF0ZXMgcmVwYXkgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vICAgICAgICAgNC4gUmVxdWlyZXMgbWluaW11bSByZXBheW1lbnQgb2YgYXQgbGVhc3QgdGhlIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICAgICAgICAgNS4gQ2FsY3VsYXRlcyBwcmluY2lwYWwgcmVwYXltZW50IChhbW91bnQgLSBpbnRlcmVzdCkKICAgIC8vICAgICAgICAgNi4gQnVybnMgc1Rva2VucyBvciB0cmFuc2ZlcnMgYVRva2VucyBmcm9tIHVzZXIKICAgIC8vICAgICAgICAgNy4gVXBkYXRlcyB1c2VyIGFuZCBtYXJrZXQgc2NhbGVkIGJvcnJvdyBhbW91bnRzIChwcmluY2lwYWwgb25seSkKICAgIC8vICAgICAgICAgOC4gVXBkYXRlcyBnbG9iYWwgYm9ycm93IHZhbHVlIHRyYWNraW5nIHdpdGggcHJvcGVyIHByaWNlIGhhbmRsaW5nCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdXNlcidzIGN1cnJlbnQgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGRlYnRfaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIGRlYnQgaW5jbHVkaW5nIGludGVyZXN0CiAgICAvLyAgICAgdW5zY2FsZWRfYm9ycm93cyA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgdG90YWxfZGVidCA9IHVuc2NhbGVkX2JvcnJvd3MgKyBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIFZhbGlkYXRlIHJlcGF5IGFtb3VudCBkb2Vzbid0IGV4Y2VlZCB0b3RhbCBkZWJ0CiAgICAvLyAgICAgYXNzZXJ0IGFtb3VudCA8PSB0b3RhbF9kZWJ0LCAiUmVwYXkgYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidCIKICAgIC8vIAogICAgLy8gICAgICMgUmVxdWlyZSBtaW5pbXVtIHJlcGF5bWVudCBvZiBhdCBsZWFzdCB0aGUgZGVidCBpbnRlcmVzdAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGFtb3VudCA+PSBkZWJ0X2ludGVyZXN0CiAgICAvLyAgICAgKSwgIlJlcGF5IGFtb3VudCBtdXN0IGJlIGF0IGxlYXN0IHRoZSBhY2NydWVkIGludGVyZXN0IgogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgaG93IG11Y2ggZ29lcyB0b3dhcmQgcHJpbmNpcGFsIHJlcGF5bWVudAogICAgLy8gICAgIHByaW5jaXBhbF9yZXBheW1lbnQgPSBhbW91bnQgLSBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBzY2FsZWQgYW1vdW50IGZvciBwcmluY2lwYWwgcmVwYXltZW50IG9ubHkKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gKHByaW5jaXBhbF9yZXBheW1lbnQgKiBTQ0FMRSkgLy8gbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgYXNzZXJ0IHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IHNjYWxlZF9hbW91bnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyBkZWJ0IgogICAgLy8gCiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCB1c2VyX2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gICAgIG5ld19ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgICAgICAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAvLyBTQ0FMRQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICBwcmljZV9mb3Jfb2xkID0gKAogICAgLy8gICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgcHJpY2VfZm9yX25ldyA9IG5ld19tYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICBvbGRfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld192YWx1ZSA9IChuZXdfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9uZXcpIC8vIFNDQUxFCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRSZXBheSgKICAgIC8vICAgICAjICAgICAgICAgdXNlcj1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NChtYXJrZXRfaWQpLAogICAgLy8gICAgICMgICAgICAgICBhbW91bnQ9YXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyAjIG1pbnQvcmVkZWVtIHJlbGF0ZWQgY29kZQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgcmVkZWVtKHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gIyAgICAgc2VsZi5fcmVkZWVtKG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9yZWRlZW0oc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICMgICAgIGFzc2VydCBub3Qgc2VsZi5faGFzX3Bvc2l0aW9uKAogICAgLy8gIyAgICAgICAgIFR4bi5zZW5kZXIsIG1hcmtldF9pZAogICAgLy8gIyAgICAgKSwgIkNhbm5vdCBtaW50L3JlZGVlbSB3aGVuIHVzZXIgaGFzIHRyYWNrZWQgZGVwb3NpdCBwb3NpdGlvbiIKICAgIC8vIAogICAgLy8gIyAgICAgbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICBOVG9rZW4uYnVybl9mcm9tLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBzY2FsZWRfYW1vdW50ID0gKGFtb3VudCAqIFNDQUxFKSAvLyBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICMgICAgIGFzc2VydCAoCiAgICAvLyAjICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gc2NhbGVkX2Ftb3VudAogICAgLy8gIyAgICAgKSwgIkluc3VmZmljaWVudCBtYXJrZXQgZGVwb3NpdHMgdG8gcmVkZWVtIgogICAgLy8gIyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksCiAgICAvLyAjICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAjICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBtaW50KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fbWludChtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfbWludChzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIC8vIAogICAgLy8gIyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9oYXNfcG9zaXRpb24oCiAgICAvLyAjICAgICAgICAgVHhuLnNlbmRlciwgbWFya2V0X2lkCiAgICAvLyAjICAgICApLCAiQ2Fubm90IG1pbnQvcmVkZWVtIHdoZW4gdXNlciBoYXMgdHJhY2tlZCBkZXBvc2l0IHBvc2l0aW9uIgogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gIyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdCgKICAgIC8vICMgICAgICAgICBtYXJrZXRfaWQKICAgIC8vICMgICAgICkgICMgR2V0IHVwZGF0ZWQgbWFya2V0IHdpdGggYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gIyAgICAgc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICMgICAgICAgICBhbW91bnQgKiBTQ0FMRQogICAgLy8gIyAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlICAjIENhbGN1bGF0ZSB3aXRoIG5ldyBpbmRleAogICAgLy8gCiAgICAvLyAjICAgICBhc3NlcnQgKAogICAgLy8gIyAgICAgICAgIG5ld19tYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gIyAgICAgICAgID49IG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIHNjYWxlZF9hbW91bnQKICAgIC8vICMgICAgICksICJEZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gIyAgICAgIyBPbmx5IGluY3JlbWVudCBtYXJrZXQgdG90YWwgZGVwb3NpdHMsIG5vdCB1c2VyIGRlcG9zaXRzIHNpbmNlIHBvc2l0aW9uIGlzIG5vdCB0cmFja2VkCiAgICAvLyAjICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gIyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAgICAgTWludEV2ZW50KAogICAgLy8gIyAgICAgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksIGFyYzQuVUludDI1NihhbW91bnQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpCiAgICAvLyAjICAgICAgICAgKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzeW5jX3VzZXJfbWFya2V0X2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICAgICAgdXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkuY29weSgpCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMgPT0gMCBhbmQgdXNlci5zY2FsZWRfYm9ycm93cyA9PSAwOgogICAgLy8gICAgICAgICByZXR1cm4KICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBkZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgICAgICBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBvbGRfZGVwb3NpdF92YWx1ZSA9IChkZXBvc2l0X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld19kZXBvc2l0X3ZhbHVlID0gKGRlcG9zaXRfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgICAgICAgICAgdXNlcl9pZCwgbWFya2V0X2lkLCBvbGRfZGVwb3NpdF92YWx1ZSwgbmV3X2RlcG9zaXRfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPiAwOgogICAgLy8gICAgICAgICBib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgICAgICBlbHNlIG1hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBvbGRfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfYm9ycm93X3ZhbHVlID0gKGJvcnJvd19hbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgICAgICB1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF9ib3Jyb3dfdmFsdWUsIG5ld19ib3Jyb3dfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gR2xvYmFsVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X2dsb2JhbF91c2VyKHNlbGYsIHVzZXJfaWQ6IEFjY291bnQpIC0+IEdsb2JhbFVzZXJEYXRhOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi5nbG9iYWxfdXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9nbG9iYWxfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIGdsb2JhbF91c2VyCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZSA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnNbdXNlcl9pZF0gPSBnbG9iYWxfdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBtYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBvbGRfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyAgICAgbmV3X3ZhbHVlOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICAvLyAKICAgIC8vICAgICBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgLSBvbGRfdmFsdWUgKyBuZXdfdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnNbdXNlcl9pZF0gPSBnbG9iYWxfdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgbGlxdWlkYXRlX2Nyb3NzX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIGRlYnRfbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgdXNlcjogYXJjNC5BZGRyZXNzLAogICAgLy8gICAgIGRlYnRfYW1vdW50OiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQ6IGFyYzQuVUludDI1NiwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDQ5MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgU3luYyBnbG9iYWwgdXNlciB2YWx1ZXMgZm9yIGJvdGggbWFya2V0cyB0byBpbmNsdWRlIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgICAgIHVzZXIubmF0aXZlLCBkZWJ0X21hcmtldF9pZC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fbGlxdWlkYXRlX2Nyb3NzX21hcmtldCgKICAgIC8vICAgICAgICAgZGVidF9tYXJrZXRfaWQubmF0aXZlLAogICAgLy8gICAgICAgICBjb2xsYXRlcmFsX21hcmtldF9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgIFR4bi5zZW5kZXIsCiAgICAvLyAgICAgICAgIHVzZXIubmF0aXZlLAogICAgLy8gICAgICAgICBkZWJ0X2Ftb3VudC5uYXRpdmUsCiAgICAvLyAgICAgICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkLm5hdGl2ZSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgbGlxdWlkYXRvcl9pZDogQWNjb3VudCwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIGRlYnRfYW1vdW50OiBCaWdVSW50LAogICAgLy8gICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIExpcXVpZGF0ZSBhIHVzZXIncyB1bmRlcmNvbGxhdGVyYWxpemVkIHBvc2l0aW9uIGFjcm9zcyBkaWZmZXJlbnQgbWFya2V0cy4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIGFsbG93cyBhIGxpcXVpZGF0b3IgdG8gcmVwYXkgYSBwb3J0aW9uIG9mIGEgdXNlcidzIGRlYnQgaW4gb25lIG1hcmtldAogICAgLy8gICAgIGFuZCByZWNlaXZlIGNvbGxhdGVyYWwgZnJvbSBhbm90aGVyIG1hcmtldCBhcyBjb21wZW5zYXRpb24uIFRoZSBsaXF1aWRhdGlvbiBpbmNsdWRlcwogICAgLy8gICAgIGEgYm9udXMgdG8gaW5jZW50aXZpemUgbGlxdWlkYXRvcnMgYW5kIGhlbHBzIG1haW50YWluIHByb3RvY29sIGhlYWx0aCBieSByZW1vdmluZwogICAgLy8gICAgIHVuZGVyY29sbGF0ZXJhbGl6ZWQgcG9zaXRpb25zLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgZGVidF9tYXJrZXRfaWQ6IFRoZSBtYXJrZXQgSUQgd2hlcmUgdGhlIGRlYnQgdG8gYmUgcmVwYWlkIGV4aXN0cwogICAgLy8gICAgICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogVGhlIG1hcmtldCBJRCB3aGVyZSBjb2xsYXRlcmFsIHdpbGwgYmUgc2VpemVkIGZyb20KICAgIC8vICAgICAgICAgbGlxdWlkYXRvcl9pZDogVGhlIGFjY291bnQgcGVyZm9ybWluZyB0aGUgbGlxdWlkYXRpb24KICAgIC8vICAgICAgICAgdXNlcl9pZDogVGhlIGFjY291bnQgYmVpbmcgbGlxdWlkYXRlZAogICAgLy8gICAgICAgICBkZWJ0X2Ftb3VudDogVGhlIGFtb3VudCBvZiBkZWJ0IHRvIHJlcGF5IChtdXN0IGluY2x1ZGUgYWNjcnVlZCBpbnRlcmVzdCkKICAgIC8vICAgICAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQ6IE1pbmltdW0gY29sbGF0ZXJhbCBhbW91bnQgdGhlIGxpcXVpZGF0b3IgZXhwZWN0cyB0byByZWNlaXZlCiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiBhbnkgdmFsaWRhdGlvbiBmYWlscywgaW5jbHVkaW5nOgogICAgLy8gICAgICAgICAgICAgLSBVc2luZyBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgKGJvcnJvdy1vbmx5IG1hcmtldCkKICAgIC8vICAgICAgICAgICAgIC0gQXR0ZW1wdGluZyBzZWxmLWxpcXVpZGF0aW9uCiAgICAvLyAgICAgICAgICAgICAtIE1hcmtldCBkb2Vzbid0IGV4aXN0IG9yIGlzIHBhdXNlZAogICAgLy8gICAgICAgICAgICAgLSBQb3NpdGlvbiBpcyBub3QgbGlxdWlkYXRhYmxlIChoZWFsdGggZmFjdG9yID49IDEuMCkKICAgIC8vICAgICAgICAgICAgIC0gTGlxdWlkYXRpb24gYW1vdW50IGV4Y2VlZHMgbWF4aW11bSBhbGxvd2VkIG9yIHRvdGFsIGRlYnQKICAgIC8vICAgICAgICAgICAgIC0gSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgdG8gc2VpemUKICAgIC8vICAgICAgICAgICAgIC0gQ29sbGF0ZXJhbCByZWNlaXZlZCBiZWxvdyBtaW5pbXVtIHRocmVzaG9sZAogICAgLy8gCiAgICAvLyAgICAgTm90ZXM6CiAgICAvLyAgICAgICAgIC0gVXNlcyB0aGUgY29sbGF0ZXJhbCBtYXJrZXQncyBsaXF1aWRhdGlvbiB0aHJlc2hvbGQgZm9yIGhlYWx0aCBjYWxjdWxhdGlvbgogICAgLy8gICAgICAgICAtIExpcXVpZGF0aW9uIGJvbnVzIGlzIGFwcGxpZWQgdG8gaW5jZW50aXZpemUgbGlxdWlkYXRvcnMKICAgIC8vICAgICAgICAgLSBBY2NydWVkIGludGVyZXN0IG9uIGJvdGggZGVidCBhbmQgY29sbGF0ZXJhbCBwb3NpdGlvbnMgaXMgaW5jbHVkZWQKICAgIC8vICAgICAgICAgLSBIYW5kbGVzIGRpZmZlcmVudCB0b2tlbiB0eXBlcyAoQVJDMjAwIHZzIFNUb2tlbikgYXBwcm9wcmlhdGVseQogICAgLy8gICAgICAgICAtIFVwZGF0ZXMgZ2xvYmFsIGJvcnJvdyBhbmQgY29sbGF0ZXJhbCB2YWx1ZXMgZm9yIHRoZSB1c2VyCiAgICAvLyAgICAgIiIiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdHJhbnNhY3Rpb24gY2FwIGZvciBsaXF1aWRhdGUgb3BlcmF0aW9uCiAgICAvLyAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICAgICBkZWJ0X21hcmtldF9pZAogICAgLy8gICAgICkubGlxdWlkYXRlLm5hdGl2ZQogICAgLy8gICAgIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgZGVidF9hbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIkxpcXVpZGF0ZSBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIFJFTSBwcmV2ZW50IHVzaW5nIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCBpbiBsaXF1aWRhdGlvbiBiZWNhdXNlIHN0b2tlbgogICAgLy8gICAgICMgUkVNIG1hcmtldCBjb2xsYXRlcmFsIGRvZXMgbm90IGV4aXN0CiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQgIT0gc2VsZi5zdG9rZW5fYXBwX2lkCiAgICAvLyAgICAgKSwgIkNhbm5vdCB1c2Ugc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIChib3Jyb3ctb25seSBtYXJrZXQpIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBSRU0gcHJldmVudCBzZWxmIGxpcXVpZGF0aW9uCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgYXNzZXJ0IHVzZXJfaWQgIT0gbGlxdWlkYXRvcl9pZCwgIkNhbm5vdCBsaXF1aWRhdGUgc2VsZiIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCBkZWJ0X21hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJEZWJ0IG1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIHN3YXAKICAgIGNvbmNhdAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MDYKICAgIC8vIGFzc2VydCBkZWJ0X21hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJEZWJ0IG1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGFzc2VydCAvLyBEZWJ0IG1hcmtldCBkb2VzIG5vdCBleGlzdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDIwLTI1MDcKICAgIC8vICAgICBzZWxmLm1hcmtldHMgPSBCb3hNYXAoVUludDY0LCBNYXJrZXREYXRhKSAgIyBNYXJrZXQgc3RhdGUKICAgIC8vICAgICBzZWxmLnVzZXJzID0gQm94TWFwKEJ5dGVzNDAsIFVzZXJEYXRhKSAgIyBQZXItbWFya2V0IHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2VycyA9IEJveE1hcChBY2NvdW50LCBHbG9iYWxVc2VyRGF0YSkgICMgR2xvYmFsIHVzZXIgc3RhdGUKICAgIC8vICAgICBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzID0gQm94TWFwKAogICAgLy8gICAgICAgICBVSW50NjQsIE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyAgICAgKSAgIyBNYXJrZXQgdHJhbnNhY3Rpb24gY2FwcwogICAgLy8gICAgIHNlbGYudXNlcl9jYXBzID0gQm94TWFwKEFjY291bnQsIFVzZXJDYXApICAjIFBlci11c2VyIGNhcHMKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzID0gQm94TWFwKFVJbnQ2NCwgUHJpY2VGZWVkKSAgIyBQcmljZSBmZWVkcwogICAgLy8gICAgICMgc2VsZi5tYXJrZXRfY29udHJvbGxlcnMgPSBCb3hNYXAoQWNjb3VudCwgYm9vbCkgICMgTWFya2V0IGNvbnRyb2xsZXJzCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gIyBPd25hYmxlCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfb25seV9vd25lcihzZWxmKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYub3duZXIsICJvbmx5IHRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfb3duZXIoc2VsZikgLT4gYXJjNC5BZGRyZXNzOgogICAgLy8gICAgIHJldHVybiBhcmM0LkFkZHJlc3Moc2VsZi5vd25lcikKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgdHJhbnNmZXJfb3duZXJzaGlwKHNlbGYsIG5ld19vd25lcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fdHJhbnNmZXJfb3duZXJzaGlwKG5ld19vd25lci5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lci5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3RyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IEFjY291bnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICAjIHByZXZpb3VzX293bmVyID0gc2VsZi5vd25lcgogICAgLy8gIyAgICAgc2VsZi5vd25lciA9IG5ld19vd25lcgogICAgLy8gIyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAjICAgICAjICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChhcmM0LkFkZHJlc3MocHJldmlvdXNfb3duZXIpLCBhcmM0LkFkZHJlc3MobmV3X293bmVyKSkKICAgIC8vICMgICAgICMgKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgU3RvcmFnZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X3N0b3JhZ2VfYXBwX2lkKHN0b3JhZ2VfYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b3JhZ2VfYXBwX2lkKHNlbGYsIHN0b3JhZ2VfYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KFVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlID0gc3RvcmFnZV9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGlzX3BhdXNlZChzZWxmKSAtPiBhcmM0LkJvb2w6CiAgICAvLyAgICAgcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9pc19wYXVzZWQoKSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaXNfcGF1c2VkKHNlbGYpIC0+IGJvb2w6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYucGF1c2VkID09IFVJbnQ2NCgxKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBwYXVzZShzZWxmLCBwYXVzZTogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBzZWxmLl9wYXVzZShwYXVzZS5uYXRpdmUpCiAgICAvLyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZS5uYXRpdmUKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3BhdXNlKHNlbGYsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLnBhdXNlZCA9IHBhdXNlCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIFZlcmlmeSBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIgb24gdGhlIFNUb2tlbiBjb250cmFjdAogICAgLy8gICAgIHNlbGYuX3NldF9zdG9rZW5fYXBwX2lkKHN0b2tlbl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfc3Rva2VuX2FwcF9pZChzZWxmLCBzdG9rZW5fYXBwX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc3Rva2VuX2FwcCA9IEFwcGxpY2F0aW9uKHN0b2tlbl9hcHBfaWQpCiAgICAvLyAgICAgbGVuZGluZ19wb29sX2FkZHJlc3MgPSBHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzCiAgICAvLyAgICAgIyBDaGVjayBpZiBMZW5kaW5nUG9vbCBpcyBhcHByb3ZlZCBhcyBtaW50ZXIKICAgIC8vICAgICBpc19hcHByb3ZlZF9taW50ZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFNUb2tlbi5pc19taW50ZXIsIGFyYzQuQWRkcmVzcyhsZW5kaW5nX3Bvb2xfYWRkcmVzcyksIGFwcF9pZD1zdG9rZW5fYXBwCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgQXNzZXJ0IHRoYXQgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgaXNfYXBwcm92ZWRfbWludGVyCiAgICAvLyAgICAgKSwgIkxlbmRpbmdQb29sIG11c3QgYmUgYXBwcm92ZWQgYXMgU1Rva2VuIG1pbnRlciBiZWZvcmUgc2V0dGluZyBhcHAgSUQiCiAgICAvLyAgICAgc2VsZi5zdG9rZW5fYXBwX2lkID0gc3Rva2VuX2FwcF9pZAogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXJfa2V5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCeXRlczQwOgogICAgLy8gICAgIHJldHVybiBCeXRlczQwLmZyb21fYnl0ZXMoCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKS5ieXRlcyArIGFyYzQuVUludDY0KG1hcmtldF9pZCkuYnl0ZXMKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF91c2VyKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF91c2VyKHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gVXNlckRhdGE6CiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGlmIHVzZXJfa2V5IGluIHNlbGYudXNlcnM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJzW3VzZXJfa2V5XQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBhbW91bnQpCiAgICAvLyAgICAgdXNlci5ib3Jyb3dfaW5kZXggPSBtYXJrZXQuYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgdXNlci5kZXBvc2l0X2luZGV4ID0gbWFya2V0LmRlcG9zaXRfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byByZXBheSB0aGlzIGFtb3VudCIKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGNyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB0b2tlbl9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgcmVzZXJ2ZV9mYWN0b3I6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGJvcnJvd19yYXRlOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBzbG9wZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgbWF4X3RvdGFsX2RlcG9zaXRzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbWF4X3RvdGFsX2JvcnJvd3M6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBsaXF1aWRhdGlvbl9ib251czogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY2xvc2VfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICkgLT4gYXJjNC5VSW50NjQ6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTExIEZpeDogRW5zdXJlIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA+IGNvbGxhdGVyYWxfZmFjdG9yCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSA+IGNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZQogICAgLy8gICAgICksICJMaXF1aWRhdGlvbiB0aHJlc2hvbGQgbXVzdCBiZSA+IGNvbGxhdGVyYWwgZmFjdG9yIgogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQ2NCgKICAgIC8vICAgICAgICAgc2VsZi5fY3JlYXRlX21hcmtldCgKICAgIC8vICAgICAgICAgICAgIHRva2VuX2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgICAgIE1hcmtldERhdGEoCiAgICAvLyAgICAgICAgICAgICAgICAgcGF1c2VkPWFyYzQuQm9vbChUcnVlKSwgICMgU3RhcnQgcGF1c2VkIHVudGlsIHByaWNlIGlzIHNldAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9kZXBvc2l0cz1tYXhfdG90YWxfZGVwb3NpdHMsCiAgICAvLyAgICAgICAgICAgICAgICAgbWF4X3RvdGFsX2JvcnJvd3M9bWF4X3RvdGFsX2JvcnJvd3MsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fYm9udXM9bGlxdWlkYXRpb25fYm9udXMsCiAgICAvLyAgICAgICAgICAgICAgICAgY29sbGF0ZXJhbF9mYWN0b3I9Y29sbGF0ZXJhbF9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgbGlxdWlkYXRpb25fdGhyZXNob2xkPWxpcXVpZGF0aW9uX3RocmVzaG9sZCwKICAgIC8vICAgICAgICAgICAgICAgICByZXNlcnZlX2ZhY3Rvcj1yZXNlcnZlX2ZhY3RvciwKICAgIC8vICAgICAgICAgICAgICAgICBib3Jyb3dfcmF0ZT1ib3Jyb3dfcmF0ZSwKICAgIC8vICAgICAgICAgICAgICAgICBzbG9wZT1zbG9wZSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfZGVwb3NpdHM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHRvdGFsX3NjYWxlZF9ib3Jyb3dzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBkZXBvc2l0X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X2luZGV4PWFyYzQuVUludDI1NihTQ0FMRSksICAjIFN0YXJ0IGF0IFNDQUxFICgxLjApCiAgICAvLyAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZT1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZXM9YXJjNC5VSW50MjU2KDApLAogICAgLy8gICAgICAgICAgICAgICAgIHByaWNlPWFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgICAgICAgICAgMAogICAgLy8gICAgICAgICAgICAgICAgICksICAjIFByaWNlIG11c3QgYmUgc2V0IGJlZm9yZSBtYXJrZXQgY2FuIGJlIHVzZWQKICAgIC8vICAgICAgICAgICAgICAgICBudG9rZW5faWQ9YXJjNC5VSW50NjQoMCksICAjIFdpbGwgYmUgc2V0IGR1cmluZyB0b2tlbiBpbml0aWFsaXphdGlvbgogICAgLy8gICAgICAgICAgICAgICAgIGNsb3NlX2ZhY3Rvcj1jbG9zZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICApLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jcmVhdGVfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBVSW50NjQ6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIG5vdCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudChUeG4uc2VuZGVyKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IDIwMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgY3JlYXRlIG1hcmtldCIKICAgIC8vICAgICBjb21waWxlZCA9IGNvbXBpbGVfY29udHJhY3QoTlRva2VuLCBleHRyYV9wcm9ncmFtX3BhZ2VzPTApICAjIG5vIGV4dHJhIHBhZ2VzCiAgICAvLyAgICAgYmFzZV9hcHAgPSBhcmM0LmFyYzRfY3JlYXRlKE5Ub2tlbiwgY29tcGlsZWQ9Y29tcGlsZWQpLmNyZWF0ZWRfYXBwCiAgICAvLyAgICAgaXR4bi5QYXltZW50KAogICAgLy8gICAgICAgICByZWNlaXZlcj1iYXNlX2FwcC5hZGRyZXNzLCBhbW91bnQ9MTAwMDAwMCwgZmVlPTAgICMgbWluIDEwODkwMCBzZW5kcyAxMDAwMDAwCiAgICAvLyAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5ib290c3RyYXA2NCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YmFzZV9hcHAsCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldF9kYXRhLm50b2tlbl9pZCA9IGFyYzQuVUludDY0KGJhc2VfYXBwLmlkKQogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vICAgICBhcmM0LmVtaXQoTWFya2V0Q3JlYXRlZChhcmM0LlVJbnQ2NCh0b2tlbl9pZCkpKQogICAgLy8gICAgIHJldHVybiBiYXNlX2FwcC5pZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QocmVhZG9ubHk9VHJ1ZSkKICAgIC8vIGRlZiBnZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9tYXJrZXQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLm1hcmtldHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0LCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBNYXJrZXRUcmFuc2FjdGlvbkNhcDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldF90cmFuc2FjdGlvbl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0X3RyYW5zYWN0aW9uX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBVc2VyQ2FwOgogICAgLy8gICAgIGlmIHVzZXJfaWQgaW4gc2VsZi51c2VyX2NhcHM6CiAgICAvLyAgICAgICAgIHJldHVybiBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF91c2VyX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHVzZXJfY2FwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIHVzZXJfY2FwOiBVc2VyQ2FwKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLm5hdGl2ZSwgdXNlcl9jYXApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF91c2VyX2NhcChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLnVzZXJfY2Fwc1t1c2VyX2lkXSA9IHVzZXJfY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KFVzZXJDYXBTZXQoYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCB1c2VyX2NhcCkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgIHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSwgdHJhbnNhY3Rpb25fY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogVUludDY0LCB0cmFuc2FjdGlvbl9jYXA6IE1hcmtldFRyYW5zYWN0aW9uQ2FwCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2Fwc1t0b2tlbl9pZF0gPSB0cmFuc2FjdGlvbl9jYXAuY29weSgpCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0VHJhbnNhY3Rpb25DYXBTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCB0cmFuc2FjdGlvbl9jYXApKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgbWFya2V0IGNvbnRyb2xsZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgbWFya2V0X2RhdGE6IE1hcmtldERhdGEpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIG1hcmtldF9kYXRhKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBhbHJlYWR5IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2RhdGEucHJpY2UgPT0gbWFya2V0LnByaWNlLCAiUHJpY2UgbWlzbWF0Y2giCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXSA9IG1hcmtldF9kYXRhLmNvcHkoKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgcHJpY2UgZmVlZCBjb25zdW1lcgogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gUHJpY2VGZWVkOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICBpZiB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBwcmljZV9mZWVkLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgTGVuZGluZ1Bvb2xTdG9yYWdlLmdldF9wcmljZV9mZWVkX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gcHJpY2VfZmVlZAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBhdHRhY2hfcHJpY2VfZmVlZCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9hdHRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUsIHByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2F0dGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByb3ZpZGVyX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZXhpc3RzIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KHRva2VuX2lkKQogICAgLy8gICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdID0gUHJpY2VGZWVkKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXA9UHJpY2VXaXRoVGltZXN0YW1wKAogICAgLy8gICAgICAgICAgICAgcHJpY2U9bWFya2V0LnByaWNlLAogICAgLy8gICAgICAgICAgICAgdGltZXN0YW1wPWFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKSwKICAgIC8vICAgICAgICAgKSwKICAgIC8vICAgICApCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkQXR0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHByb3ZpZGVyX2FwcF9pZD1hcmM0LlVJbnQ2NChwcm92aWRlcl9hcHBfaWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX2RldGFjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGV0YWNoX3ByaWNlX2ZlZWQoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLnByaWNlX2ZlZWRzLCAiUHJpY2UgZmVlZCBub3QgYXR0YWNoZWQiCiAgICAvLyAgICAgZGVsIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgUHJpY2VGZWVkRGV0YWNoZWQoCiAgICAvLyAgICAgIyAgICAgICAgIG1hcmtldF9pZD1hcmM0LlVJbnQ2NCh0b2tlbl9pZCksCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcHJpY2U6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLm5hdGl2ZSwgcHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfbWFya2V0X3ByaWNlKHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHByaWNlOiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICAjIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgYWxyZWFkeSBhdHRhY2hlZCIKICAgIC8vICAgICBhc3NlcnQgcHJpY2UgPiAwLCAiUHJpY2UgbXVzdCBiZSBwb3NpdGl2ZSIKICAgIC8vIAogICAgLy8gICAgIG1hcmtldCA9IHNlbGYubWFya2V0c1t0b2tlbl9pZF0uY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIFVucGF1c2UgdGhlIG1hcmtldCBvbiBmaXJzdCBwcmljZSBzZXQKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkIGFuZCBtYXJrZXQucHJpY2UgPT0gMDoKICAgIC8vICAgICAgICAgbWFya2V0LnBhdXNlZCA9IGFyYzQuQm9vbChGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgU2NhbGUgdGhlIHByaWNlIGJ5IFNDQUxFIGludGVybmFsbHkgZm9yIHN0b3JhZ2UKICAgIC8vICAgICBtYXJrZXQucHJpY2UgPSBhcmM0LlVJbnQyNTYocHJpY2UgKiBTQ0FMRSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdChNYXJrZXRQcmljZVNldChhcmM0LlVJbnQ2NCh0b2tlbl9pZCksIGFyYzQuVUludDI1NihwcmljZSkpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBmZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIHNlbGYuX2ZldGNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9mZXRjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAxMDAwMDAsICJpbnN1ZmZpY2llbnQgcGF5bWVudCBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHBheW1lbnQgPD0gMTAwMDAwMAogICAgLy8gICAgICksICJwYXltZW50IGV4Y2VlZHMgbWF4aW11bSBmb3IgZmV0Y2ggcHJpY2UgZmVlZCIgICMgMWUtNgogICAgLy8gICAgIGFwcCA9IEFwcGxpY2F0aW9uKHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByb3ZpZGVyX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAgICAgaXR4bi5QYXltZW50KHJlY2VpdmVyPWFwcC5hZGRyZXNzLCBhbW91bnQ9cGF5bWVudCwgZmVlPTApLnN1Ym1pdCgpCiAgICAvLyAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIFByaWNlRmVlZFByb3ZpZGVySW50ZXJmYWNlLmdldF9wcmljZV93aXRoX3RpbWVzdGFtcCwKICAgIC8vICAgICAgICAgYXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9YXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLnRpbWVzdGFtcC5uYXRpdmUKICAgIC8vICAgICAgICAgPiBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgKToKICAgIC8vICAgICAgICAgc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAgPSAoCiAgICAvLyAgICAgICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC5jb3B5KCkKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBzZWxmLl9zZXRfbWFya2V0X3ByaWNlKHRva2VuX2lkLCBwcmljZV93aXRoX3RpbWVzdGFtcC5wcmljZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gYW1vdW50CiAgICAvLyAgICAgKSwgIkluc3VmZmljaWVudCBiYWxhbmNlIHRvIHdpdGhkcmF3IHRoaXMgYW1vdW50IgogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3BhdXNlX21hcmtldCh0b2tlbl9pZC5uYXRpdmUsIHBhdXNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfcGF1c2VfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQsIHBhdXNlOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdLnBhdXNlZCA9IGFyYzQuQm9vbChwYXVzZSA9PSBVSW50NjQoMSkpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfbWFya2V0KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2FjY3J1ZV9pbnRlcmVzdChzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gTWFya2V0RGF0YToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBpZiBtYXJrZXQucGF1c2VkOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICAgICBjdXJyZW50X3RpbWUgPSBHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcAogICAgLy8gICAgIHRpbWVfZGVsdGEgPSBjdXJyZW50X3RpbWUgLSBtYXJrZXQubGFzdF91cGRhdGVfdGltZS5uYXRpdmUKICAgIC8vICAgICBpZiB0aW1lX2RlbHRhIDw9IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vIAogICAgLy8gICAgICMgRm9yIHN0b2tlbiBtYXJrZXQgKGJvcnJvdy1vbmx5KSwgdXNlIGEgZml4ZWQgdXRpbGl6YXRpb24gcmF0ZSBzaW5jZSB0aGVyZSBhcmUgbm8gZGVwb3NpdHMKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICB1dGlsaXphdGlvbiA9IEJpZ1VJbnQoMTAwMDApICAjIDEwMCUgdXRpbGl6YXRpb24gZm9yIGJvcnJvdy1vbmx5IG1hcmtldAogICAgLy8gICAgIGVsaWYgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIHV0aWxpemF0aW9uID0gKAogICAgLy8gICAgICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIDEwMDAwCiAgICAvLyAgICAgICAgICkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICByYXRlID0gbWFya2V0LmJvcnJvd19yYXRlLm5hdGl2ZSArIChtYXJrZXQuc2xvcGUubmF0aXZlICogdXRpbGl6YXRpb24pIC8vIDEwMDAwCiAgICAvLyAgICAgaW50ZXJlc3QgPSAocmF0ZSAqIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB0aW1lX2RlbHRhKSAvLyAoCiAgICAvLyAgICAgICAgIHNlbGYuc2Vjb25kc19wZXJfeWVhciAqIDEwMDAwCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBTcGVjaWFsIGhhbmRsaW5nIGZvciBzdG9rZW4gbWFya2V0IC0gYWxsIGludGVyZXN0IGdvZXMgdG8gcmVzZXJ2ZXMKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gaW50ZXJlc3QKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBCaWdVSW50KDApCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9ICgKICAgIC8vICAgICAgICAgICAgIGludGVyZXN0ICogYXJjNC5VSW50MjU2LmZyb21fYnl0ZXMobWFya2V0LnJlc2VydmVfZmFjdG9yLmJ5dGVzKS5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyAxMDAwMAogICAgLy8gICAgICAgICBpZiBwcm90b2NvbF9wb3J0aW9uID4gaW50ZXJlc3Q6CiAgICAvLyAgICAgICAgICAgICBwcm90b2NvbF9wb3J0aW9uID0gaW50ZXJlc3QKICAgIC8vICAgICAgICAgZGVwb3NpdG9yX3BvcnRpb24gPSBpbnRlcmVzdCAtIHByb3RvY29sX3BvcnRpb24KICAgIC8vIAogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPiAwOgogICAgLy8gICAgICAgICBtYXJrZXQuZGVwb3NpdF9pbmRleCA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgICAgIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgKyAoZGVwb3NpdG9yX3BvcnRpb24gKiBTQ0FMRSkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGlmIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA+IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5ib3Jyb3dfaW5kZXggPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgKyAoaW50ZXJlc3QgKiBTQ0FMRSkgLy8gbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBpbnRlcmVzdAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIGRlcG9zaXRvcl9wb3J0aW9uCiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5yZXNlcnZlcyA9IGFyYzQuVUludDI1NihtYXJrZXQucmVzZXJ2ZXMubmF0aXZlICsgcHJvdG9jb2xfcG9ydGlvbikKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KGN1cnJlbnRfdGltZSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gICAgIHJldHVybiBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vICMgVE9ETyBnb3Zlcm5hbmNlOiBjb25zaWRlciBpZiByZXNlcnZlIHdpdGhkcmF3YWwgc2hvdWxkIHJlcXVpcmUgYWRkaXRpb25hbAogICAgLy8gIyAgICAgIGdvdmVybmFuY2UgbWVjaGFuaXNtcwogICAgLy8gIyBUT0RPIG1pbmltdW0gcmVzZXJ2ZSBsZXZlbHM6IG1pZ2h0IHdhbnQgdG8gZW5mb3JjZSBtaW5pbXVtIHJlc2VydmUgbGV2ZWxzIGZvcgogICAgLy8gIyAgICAgIHByb3RvY29sIHNhZmV0eQogICAgLy8gIyBUT0RPIGV2ZW50IGVtaXNzaW9uOiBDb25zaWRlciBhZGRpbmcgYW4gZXZlbnQgdG8gbG9nIHJlc2VydmUgd2l0aGRyYXdhbHMgZm9yCiAgICAvLyAjICAgICAgdHJhbnNwYXJlbmN5CiAgICAvLyAKICAgIC8vICMgUkVNIGludGVudGlvbmFsbHkgc2tpcHBpbmcgc3Vicm91dGluZSB0byByZWR1Y2UgY29udHJhY3Qgc2l6ZQogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fd2l0aGRyYXdfcmVzZXJ2ZXMobWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfd2l0aGRyYXdfcmVzZXJ2ZXMoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBBY2NydWUgaW50ZXJlc3QgZmlyc3QgdG8gZ2V0IHVwLXRvLWRhdGUgcmVzZXJ2ZXMKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCBtYXJrZXQucmVzZXJ2ZXMubmF0aXZlID49IGFtb3VudCwgIkluc3VmZmljaWVudCByZXNlcnZlcyIKICAgIC8vIAogICAgLy8gICAgICMgVHJhbnNmZXIgcmVzZXJ2ZXMgdG8gdGhlIG93bmVyIChub3QgdG8gdGhlIGNvbnRyYWN0IGl0c2VsZikKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhzZWxmLm93bmVyKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgVXBkYXRlIHJlc2VydmVzCiAgICAvLyAgICAgbWFya2V0LnJlc2VydmVzID0gYXJjNC5VSW50MjU2KG1hcmtldC5yZXNlcnZlcy5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24oCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCwgZ3VhcmRfc3Rva2VuOiBib29sCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBhc3NlcnQgbWFya2V0X2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgYW1vdW50ID4gMCwgIkFtb3VudCBtdXN0IGJlID4gMCIKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgbm90IG1hcmtldC5wYXVzZWQsICJNYXJrZXQgaXMgcGF1c2VkIgogICAgLy8gICAgIGlmIGd1YXJkX3N0b2tlbjoKICAgIC8vICAgICAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgICAgIHNlbGYuc3Rva2VuX2FwcF9pZCAhPSBtYXJrZXRfaWQKICAgIC8vICAgICAgICAgKSwgIkNhbm5vdCB1c2Ugc3Rva2VuIG1hcmtldCBmb3IgdGhpcyBvcGVyYXRpb24iCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRlcG9zaXQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fZGVwb3NpdChUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIFJFTSBtYXkgYWRkIHByb3RlY3Rpb24gZm9yIGxvdyB1dGlsaXNhdGlvbiBpbiBmdXR1cmUKICAgIC8vICMgUkVNIGxvd2VyIG1heCBkZXBvc2l0IGFtb3VudCBmb3IgbG93IHV0aWxpc2F0aW9uCiAgICAvLyAjIFJFTSBoaWdoIG1heCBkZXBvc2l0IGFtb3VudCBmb3IgaGlnaCB1dGlsaXNhdGlvbgogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZXBvc2l0KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgSW50ZXJuYWwgZGVwb3NpdCBtZXRob2QgdGhhdCBoYW5kbGVzIHVzZXIgZGVwb3NpdHMgaW50byBhIGxlbmRpbmcgbWFya2V0LgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgcGVyZm9ybXMgYSBjb21wbGV0ZSBkZXBvc2l0IG9wZXJhdGlvbiBpbmNsdWRpbmc6CiAgICAvLyAgICAgMS4gVmFsaWRhdGluZyB0aGUgbWFya2V0IG9wZXJhdGlvbiAocHJvdG9jb2wgbm90IHBhdXNlZCwgbWFya2V0IGV4aXN0cywgYW1vdW50ID4gMCwgbWFya2V0IG5vdCBwYXVzZWQpCiAgICAvLyAgICAgMi4gVHJhbnNmZXJyaW5nIEFSQzIwMCB0b2tlbnMgZnJvbSB1c2VyIHRvIHRoZSBsZW5kaW5nIHBvb2wgY29udHJhY3QKICAgIC8vICAgICAzLiBBY2NydWluZyBpbnRlcmVzdCBvbiB0aGUgbWFya2V0IHRvIGdldCB1cGRhdGVkIGRlcG9zaXQgaW5kZXgKICAgIC8vICAgICA0LiBDYWxjdWxhdGluZyBhbmQgYWRkaW5nIGVhcm5lZCBpbnRlcmVzdCB0byB0aGUgdXNlcidzIHBvc2l0aW9uCiAgICAvLyAgICAgNS4gQ29udmVydGluZyBkZXBvc2l0IGFtb3VudCB0byBzY2FsZWQgZGVwb3NpdHMgdXNpbmcgY3VycmVudCBkZXBvc2l0IGluZGV4CiAgICAvLyAgICAgNi4gQ2hlY2tpbmcgZGVwb3NpdCBjYXAgY29uc3RyYWludHMKICAgIC8vICAgICA3LiBVcGRhdGluZyB1c2VyIGFuZCBtYXJrZXQgc2NhbGVkIGRlcG9zaXQgYmFsYW5jZXMKICAgIC8vICAgICA4LiBNaW50aW5nIE5Ub2tlbnMgdG8gcmVwcmVzZW50IHRoZSB1c2VyJ3MgZGVwb3NpdCBwb3NpdGlvbgogICAgLy8gICAgIDkuIFVwZGF0aW5nIGdsb2JhbCBjb2xsYXRlcmFsIGNhbGN1bGF0aW9ucyBmb3IgdGhlIHVzZXIKICAgIC8vICAgICAxMC4gRW1pdHRpbmcgYSBNYXJrZXREZXBvc2l0IGV2ZW50CiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkIChBY2NvdW50KTogVGhlIGFjY291bnQgSUQgb2YgdGhlIHVzZXIgbWFraW5nIHRoZSBkZXBvc2l0CiAgICAvLyAgICAgICAgIG1hcmtldF9pZCAoVUludDY0KTogVGhlIElEIG9mIHRoZSBtYXJrZXQgdG8gZGVwb3NpdCBpbnRvCiAgICAvLyAgICAgICAgIGFtb3VudCAoQmlnVUludCk6IFRoZSBhbW91bnQgb2YgdW5kZXJseWluZyB0b2tlbnMgdG8gZGVwb3NpdAogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgbWFya2V0IHZhbGlkYXRpb24gZmFpbHMsIGRlcG9zaXQgY2FwIGlzIGV4Y2VlZGVkLCBvciBvdGhlciBjb25zdHJhaW50cyBhcmUgdmlvbGF0ZWQKICAgIC8vIAogICAgLy8gICAgIE5vdGU6CiAgICAvLyAgICAgICAgIC0gSW50ZXJlc3QgZWFybmVkIHNpbmNlIGxhc3QgaW50ZXJhY3Rpb24gaXMgYXV0b21hdGljYWxseSBhZGRlZCB0byB0aGUgZGVwb3NpdAogICAgLy8gICAgICAgICAtIFNjYWxlZCBkZXBvc2l0cyBhcmUgdXNlZCB0byB0cmFjayB1c2VyIHBvc2l0aW9ucyBhbmQgY2FsY3VsYXRlIGludGVyZXN0CiAgICAvLyAgICAgICAgIC0gQ29sbGF0ZXJhbCB2YWx1ZSBpcyB1cGRhdGVkIHVzaW5nIGVpdGhlciB1c2VyJ3MgbGFzdCByZWNvcmRlZCBwcmljZSBvciBjdXJyZW50IG1hcmtldCBwcmljZQogICAgLy8gICAgICAgICAtIE5Ub2tlbnMgYXJlIG1pbnRlZCB0byByZXByZXNlbnQgdGhlIHVzZXIncyBkZXBvc2l0IHBvc2l0aW9uIChhbW91bnQgKyBpbnRlcmVzdCkKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgZGVwb3NpdCBvcGVyYXRpb24KICAgIC8vICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gICAgICkuZGVwb3NpdC5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiRGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgKSAgIyBHZXQgdXBkYXRlZCBtYXJrZXQgd2l0aCBhY2NydWVkIGludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICBpbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQWRkIGVhcm5lZCBpbnRlcmVzdCB0byB1c2VyJ3MgcG9zaXRpb24gYXMgYWRkaXRpb25hbCBzY2FsZWQgZGVwb3NpdHMKICAgIC8vICAgICBpbnRlcmVzdF9zY2FsZWRfYW1vdW50ID0gQmlnVUludCgwKQogICAgLy8gICAgIGlmIGludGVyZXN0ID4gMDoKICAgIC8vICAgICAgICAgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgICAgIGludGVyZXN0ICogU0NBTEUKICAgIC8vICAgICAgICAgKSAvLyBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICBhbW91bnQgKiBTQ0FMRQogICAgLy8gICAgICkgLy8gbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZSAgIyBDYWxjdWxhdGUgd2l0aCBuZXcgaW5kZXgKICAgIC8vIAogICAgLy8gICAgIHRvdGFsX3NjYWxlZF9hbW91bnQgPSBzY2FsZWRfYW1vdW50ICsgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudAogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgbmV3X21hcmtldC5tYXhfdG90YWxfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgICAgID49IG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSArIHRvdGFsX3NjYWxlZF9hbW91bnQKICAgIC8vICAgICApLCAiTWFya2V0IGRlcG9zaXQgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICAgICAgbWFya2V0X2lkLCB1c2VyX2lkLCB0b3RhbF9zY2FsZWRfYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCB0b3RhbF9zY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLm1pbnQsCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCArIGludGVyZXN0KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG5ld19tYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgb2xkX2RlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiB1c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld19kZXBvc2l0X2Ftb3VudCA9IG9sZF9kZXBvc2l0X2Ftb3VudCArIGFtb3VudCArIGludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgICMgRmFsbGJhY2s6IFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSB0byBwcmV2ZW50IG5lZ2F0aXZlIGNvbGxhdGVyYWwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgIyBOb3JtYWwgY2FzZTogVXNlIHVzZXIncyBsYXN0IHJlY29yZGVkIHByaWNlIGZvciBhY2N1cmF0ZSBjb2xsYXRlcmFsIHJlZHVjdGlvbgogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHVzZXIgY2FwIGZvciBkZXBvc2l0IG9wZXJhdGlvbgogICAgLy8gICAgIHVzZXJfY2FwID0gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9jYXAudG90YWxfZGVwb3NpdHMubmF0aXZlID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgICAgIG5ld192YWx1ZSA8PSB1c2VyX2NhcC50b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICAgICAgKSwgIlVzZXIgZGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwodXNlcl9pZCwgbWFya2V0X2lkLCBvbGRfdmFsdWUsIG5ld192YWx1ZSkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldERlcG9zaXQoCiAgICAvLyAgICAgIyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgYXJjNC5VSW50NjQobWFya2V0X2lkKSwgYXJjNC5VSW50MjU2KGFtb3VudCkKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBjYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCgKICAgIC8vICMgICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gIyApIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICMgICAgIGVuc3VyZV9idWRnZXQoNzAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gIyAgICAgcmV0dXJuIGFyYzQuVUludDI1NigKICAgIC8vICMgICAgICAgICBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCh1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3Qoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIiIiQ2FsY3VsYXRlIHVzZXIncyBhY2NydWVkIGludGVyZXN0IiIiCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHRvdGFsIHVuZGVybHlpbmcgYW1vdW50CiAgICAvLyAgICAgdXNlcl90b3RhbF91bmRlcmx5aW5nID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBuZXdfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBJbnRlcmVzdCBpcyB0aGUgZGlmZmVyZW5jZSBmcm9tIHRoZSBzY2FsZWQgZGVwb3NpdHMgKHdoaWNoIHJlcHJlc2VudCB0aGUgImJhc2UiIGFtb3VudCkKICAgIC8vICAgICBpbnRlcmVzdCA9IHVzZXJfdG90YWxfdW5kZXJseWluZyAtIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIGludGVyZXN0CiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiBjYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KAogICAgLy8gIyAgICAgc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0CiAgICAvLyAjICkgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gIyAgICAgZW5zdXJlX2J1ZGdldCg3MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAjICAgICByZXR1cm4gYXJjNC5VSW50MjU2KAogICAgLy8gIyAgICAgICAgIHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiJDYWxjdWxhdGUgdXNlcidzIGFjY3J1ZWQgZGVidCBpbnRlcmVzdCIiIgogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB0b3RhbCB1bmRlcmx5aW5nIGRlYnQgYW1vdW50CiAgICAvLyAgICAgdXNlcl90b3RhbF9kZWJ0ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIG9yaWdpbmFsIHByaW5jaXBhbCBhbW91bnQgdXNpbmcgdXNlcidzIGJvcnJvd19pbmRleAogICAgLy8gICAgICMgU2FmZXR5IGNoZWNrOiBpZiB1c2VyJ3MgYm9ycm93X2luZGV4IGlzIDAsIHVzZSBjdXJyZW50IG1hcmtldCBib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyX2JvcnJvd19pbmRleCA9ICgKICAgIC8vICAgICAgICAgdXNlci5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgb3JpZ2luYWxfcHJpbmNpcGFsID0gKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdXNlcl9ib3Jyb3dfaW5kZXgpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIEludGVyZXN0IGlzIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gY3VycmVudCB0b3RhbCBkZWJ0IGFuZCBvcmlnaW5hbCBwcmluY2lwYWwKICAgIC8vICAgICBkZWJ0X2ludGVyZXN0ID0gdXNlcl90b3RhbF9kZWJ0IC0gb3JpZ2luYWxfcHJpbmNpcGFsCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gZGVidF9pbnRlcmVzdAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiB3aXRoZHJhdyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gYXJjNC5VSW50MjU2OgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMjEwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vIAogICAgLy8gICAgICMgU3luYyB0aGUgbWFya2V0IGJlaW5nIHdpdGhkcmF3biBmcm9tIHRvIHVwZGF0ZSBnbG9iYWwgdmFsdWVzIHdpdGggaW50ZXJlc3QKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBhcmM0LlVJbnQyNTYoc2VsZi5fd2l0aGRyYXcoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gQmlnVUludDoKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBXaXRoZHJhdyB0b2tlbnMgZnJvbSBhIGxlbmRpbmcgbWFya2V0IGJ5IGJ1cm5pbmcgblRva2Vucy4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIGhhbmRsZXMgdGhlIHdpdGhkcmF3YWwgcHJvY2VzcyBieToKICAgIC8vICAgICAxLiBWYWxpZGF0aW5nIHRoZSBtYXJrZXQgb3BlcmF0aW9uIGFuZCB1c2VyIGJhbGFuY2UKICAgIC8vICAgICAyLiBBY2NydWluZyBpbnRlcmVzdCB0byBnZXQgdGhlIGxhdGVzdCBtYXJrZXQgc3RhdGUKICAgIC8vICAgICAzLiBDYWxjdWxhdGluZyB1c2VyJ3MgYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gICAgIDQuIFBlcmZvcm1pbmcgaGVhbHRoIGNoZWNrcyB0byBlbnN1cmUgd2l0aGRyYXdhbCBkb2Vzbid0IHB1dCBib3Jyb3dzIGF0IHJpc2sKICAgIC8vICAgICA1LiBCdXJuaW5nIG5Ub2tlbnMgYW5kIHRyYW5zZmVycmluZyB1bmRlcmx5aW5nIHRva2VucyB0byB1c2VyCiAgICAvLyAgICAgNi4gVXBkYXRpbmcgZ2xvYmFsIGNvbGxhdGVyYWwgdmFsdWVzCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgYWNjb3VudCBJRCBvZiB0aGUgdXNlciB3aXRoZHJhd2luZyB0b2tlbnMKICAgIC8vICAgICAgICAgbWFya2V0X2lkOiBUaGUgSUQgb2YgdGhlIG1hcmtldCB0byB3aXRoZHJhdyBmcm9tCiAgICAvLyAgICAgICAgIGFtb3VudDogVGhlIGFtb3VudCBvZiBuVG9rZW5zIHRvIGJ1cm4gKG5vdCB0aGUgdW5kZXJseWluZyB0b2tlbiBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBSZXR1cm5zOgogICAgLy8gICAgICAgICBCaWdVSW50OiBUaGUgdG90YWwgYW1vdW50IG9mIHVuZGVybHlpbmcgdG9rZW5zIHRyYW5zZmVycmVkIHRvIHRoZSB1c2VyCiAgICAvLyAgICAgICAgICAgICAgICAgKGluY2x1ZGVzIGJvdGggdGhlIHdpdGhkcmF3biBhbW91bnQgYW5kIGFjY3J1ZWQgaW50ZXJlc3QpCiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiB1c2VyIGhhcyBpbnN1ZmZpY2llbnQgYmFsYW5jZSBvciB3aXRoZHJhd2FsIHdvdWxkIHB1dCBib3Jyb3dzIGF0IHJpc2sKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3Igd2l0aGRyYXcgb3BlcmF0aW9uCiAgICAvLyAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApLndpdGhkcmF3Lm5hdGl2ZQogICAgLy8gICAgIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJXaXRoZHJhdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIGFtb3VudCBpcyB0aGUgYW1vdW50IG9mIG5Ub2tlbnMgYmVpbmcgYnVybmVkCiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgYW1vdW50IDw9IHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vIAogICAgLy8gICAgIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIGhlYWx0aCBjaGVjazogZW5zdXJlIHdpdGhkcmF3IHdvdWxkIG5vdCBwdXQgYm9ycm93cyBhdCByaXNrCiAgICAvLyAgICAgaWYgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlID4gMDoKICAgIC8vICAgICAgICAgIyB2YWx1ZSBvZiB1bmRlcmx5aW5nIGFtb3VudCB0byB3aXRoZHJhdyB1c2luZyBuZXcgbWFya2V0IHByaWNlCiAgICAvLyAgICAgICAgIHdpdGhkcmF3X3ZhbHVlID0gKGFtb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICByZW1haW5pbmdfY29sbGF0ZXJhbCA9ICgKICAgIC8vICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gd2l0aGRyYXdfdmFsdWUKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBhc3NlcnQgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSA8PSAoCiAgICAvLyAgICAgICAgICAgICByZW1haW5pbmdfY29sbGF0ZXJhbCAqIEJpZ1VJbnQobmV3X21hcmtldC5jb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUpCiAgICAvLyAgICAgICAgICkgLy8gQmlnVUludCgxMDAwMCksICJXaXRoZHJhd2FsIHdvdWxkIHB1dCBib3Jyb3dzIGF0IHJpc2siCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgdXNlcl9pZCwgYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgTlRva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG5ld19tYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQgKyBpbnRlcmVzdCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIG9sZF9kZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vICAgICBuZXdfZGVwb3NpdF9hbW91bnQgPSBvbGRfZGVwb3NpdF9hbW91bnQgKyBpbnRlcmVzdCAtIGFtb3VudAogICAgLy8gCiAgICAvLyAgICAgYW1vdW50X3VzZF92YWx1ZSA9IChhbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3Igd2l0aGRyYXcgb3BlcmF0aW9uCiAgICAvLyAgICAgdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID09IDA6CiAgICAvLyAgICAgICAgIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCArIDg2NDAwKQogICAgLy8gICAgIGVsaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA8IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wOgogICAgLy8gICAgICAgICB1c2VyX2NhcC50b3RhbF93aXRoZHJhd2FscyA9IGFyYzQuVUludDI1NigwKQogICAgLy8gICAgICAgICB1c2VyX2NhcC50b3RhbF9saXF1aWRhdGlvbnMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIC8vICAgICAgICAgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wICsgODY0MDApCiAgICAvLyAgICAgaWYgdXNlcl9jYXAuZGFpbHlfd2l0aGRyYXdhbHMubmF0aXZlID4gMDoKICAgIC8vICAgICAgICAgbmV3X3RvdGFsX3dpdGhkcmF3YWxzID0gdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMubmF0aXZlICsgYW1vdW50X3VzZF92YWx1ZQogICAgLy8gICAgICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICAgICAgbmV3X3RvdGFsX3dpdGhkcmF3YWxzIDw9IHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZQogICAgLy8gICAgICAgICApLCAiVXNlciB3aXRoZHJhdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzID0gYXJjNC5VSW50MjU2KG5ld190b3RhbF93aXRoZHJhd2FscykKICAgIC8vICAgICAgICAgc2VsZi5fc2V0X3VzZXJfY2FwKHVzZXJfaWQsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICAjIEZhbGxiYWNrOiBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgdG8gcHJldmVudCBuZWdhdGl2ZSBjb2xsYXRlcmFsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgICMgTm9ybWFsIGNhc2U6IFVzZSB1c2VyJ3MgbGFzdCByZWNvcmRlZCBwcmljZSBmb3IgYWNjdXJhdGUgY29sbGF0ZXJhbCByZWR1Y3Rpb24KICAgIC8vICAgICAgICAgb2xkX3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIHVzZXIubGFzdF9wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSA9IChuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBvbGRfdmFsdWUsICAjIG9sZCBVU0QgdmFsdWUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlLCAgIyBuZXcgVVNEIHZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBFbWl0IGV2ZW50cwogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldFdpdGhkcmF3KAogICAgLy8gICAgICMgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksIGFyYzQuVUludDY0KG1hcmtldF9pZCksIGFyYzQuVUludDI1NihhbW91bnQpCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIGFtb3VudCArIGludGVyZXN0CiAgICAvLyAKICAgIC8vICMgd2l0aGRyYXcgY29zdCA5MDAwMDAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYm9ycm93KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMjgwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vIAogICAgLy8gICAgICMgU3luYyB0aGUgbWFya2V0IGJlaW5nIGJvcnJvd2VkIGZyb20gdG8gdXBkYXRlIGdsb2JhbCB2YWx1ZXMgd2l0aCBpbnRlcmVzdAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fYm9ycm93KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2JvcnJvdyhzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIEZhbHNlKQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgYm9ycm93IG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgKS5ib3Jyb3cubmF0aXZlCiAgICAvLyAgICAgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIkJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgcGF5bWVudCA9IHJlcXVpcmVfcGF5bWVudCh1c2VyX2lkKQogICAgLy8gICAgIGFzc2VydCBwYXltZW50ID49IFVJbnQ2NCgxMDAwMDApLCAiUGF5bWVudCBhbW91bnQgbXVzdCBiZSA+PSAwLjEiCiAgICAvLyAKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHVzZXIncyBjdXJyZW50IGRlYnQgaW50ZXJlc3QKICAgIC8vICAgICBkZWJ0X2ludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBjdXJyZW50IG1hcmtldCB0b3RhbCBib3Jyb3dzIChpbmNsdWRpbmcgaW50ZXJlc3QpCiAgICAvLyAgICAgY3VycmVudF9tYXJrZXRfdG90YWxfYm9ycm93cyA9ICgKICAgIC8vICAgICAgICAgbmV3X21hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB0b3RhbCBhbW91bnQgYmVpbmcgYWRkZWQgKG5ldyBib3Jyb3cgKyBkZWJ0IGludGVyZXN0KQogICAgLy8gICAgICMgZGVidCBpbnRlcmVzdCBhZGRlZCBhdCB0aGlzIHBvaW50IHRvIHByZXZlbnQgdW5uZWNlc3NhcnkgZGVidCByZXNldAogICAgLy8gICAgIHRvdGFsX2Ftb3VudF90b19hZGQgPSBhbW91bnQgKyBkZWJ0X2ludGVyZXN0CiAgICAvLyAKICAgIC8vICAgICAjIFZhbGlkYXRlIGFnYWluc3QgbWFya2V0LXdpZGUgYm9ycm93IGNhcAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG5ld19tYXJrZXQubWF4X3RvdGFsX2JvcnJvd3MubmF0aXZlCiAgICAvLyAgICAgICAgID49IGN1cnJlbnRfbWFya2V0X3RvdGFsX2JvcnJvd3MgKyB0b3RhbF9hbW91bnRfdG9fYWRkCiAgICAvLyAgICAgKSwgIkJvcnJvdyBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICAgICAjIENoZWNrIGNvbGxhdGVyYWwgcmVxdWlyZW1lbnRzIC0gZXhjbHVkZSBzYW1lIG1hcmtldCBjb2xsYXRlcmFsIHRvIHByZXZlbnQKICAgIC8vICAgICAjIGluZWZmaWNpZW50IHNhbWUtYXNzZXQgYm9ycm93aW5nCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgIG5ld19ib3Jyb3dfdmFsdWUgPSAodG90YWxfYW1vdW50X3RvX2FkZCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgIHRvdGFsX2JvcnJvd192YWx1ZSA9IGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgKyBuZXdfYm9ycm93X3ZhbHVlCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBlZmZlY3RpdmUgY29sbGF0ZXJhbCB2YWx1ZSAoZXhjbHVkaW5nIHNhbWUtbWFya2V0IGRlcG9zaXRzKQogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA9PSBCaWdVSW50KDApOgogICAgLy8gICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSA9IGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlCiAgICAvLyAgICAgIyBVc2UgZWZmZWN0aXZlIGNvbGxhdGVyYWwgdmFsdWUgKGV4Y2x1ZGluZyBzYW1lLW1hcmtldCBkZXBvc2l0cykKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBkZXBvc2l0ZWRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIGV4Y2x1ZGVkX3ZhbHVlID0gKGRlcG9zaXRlZF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgaWYgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUgPiBleGNsdWRlZF92YWx1ZToKICAgIC8vICAgICAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gKAogICAgLy8gICAgICAgICAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gZXhjbHVkZWRfdmFsdWUKICAgIC8vICAgICAgICAgICAgICkKICAgIC8vICAgICAgICAgZWxzZToKICAgIC8vICAgICAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlID0gQmlnVUludCgwKQogICAgLy8gCiAgICAvLyAgICAgYXNzZXJ0IHRvdGFsX2JvcnJvd192YWx1ZSA8PSAoCiAgICAvLyAgICAgICAgIGVmZmVjdGl2ZV9jb2xsYXRlcmFsX3ZhbHVlICogQmlnVUludChuZXdfbWFya2V0LmNvbGxhdGVyYWxfZmFjdG9yLm5hdGl2ZSkKICAgIC8vICAgICApIC8vIEJpZ1VJbnQoMTAwMDApLCAiSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgYWNyb3NzIG1hcmtldHMiCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBzY2FsZWQgYW1vdW50IGZvciB0aGUgdG90YWwKICAgIC8vICAgICBzY2FsZWRfYW1vdW50ID0gKHRvdGFsX2Ftb3VudF90b19hZGQgKiBTQ0FMRSkgLy8gbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3VzZXJfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCB1c2VyX2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgb2xkX2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gICAgIG5ld19ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAodXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKyBzY2FsZWRfYW1vdW50KQogICAgLy8gICAgICAgICAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICAvLyBTQ0FMRQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIGlmIHVzZXIgZG9lc24ndCBoYXZlIGEgcHJldmlvdXMgcHJpY2UKICAgIC8vICAgICBwcmljZV9mb3Jfb2xkID0gKAogICAgLy8gICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAgICAgcHJpY2VfZm9yX25ldyA9IG5ld19tYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAKICAgIC8vICAgICBvbGRfdmFsdWUgPSAob2xkX2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgIG5ld192YWx1ZSA9IChuZXdfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9uZXcpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIGJvcnJvdyBvcGVyYXRpb24KICAgIC8vICAgICB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgIGlmIHVzZXJfY2FwLnRvdGFsX2JvcnJvd3MubmF0aXZlID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgICAgIG5ld192YWx1ZSA8PSB1c2VyX2NhcC50b3RhbF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICAgICApLCAiVXNlciBib3Jyb3cgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgICAgICB1c2VyX2lkLAogICAgLy8gICAgICAgICBtYXJrZXRfaWQsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSwgICMgb2xkIFVTRCB2YWx1ZQogICAgLy8gICAgICAgICBuZXdfdmFsdWUsICAjIG5ldyBVU0QgdmFsdWUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIGlmIHN0b2tlbiwgbWludCBzdG9rZW4KICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgU1Rva2VuLm1pbnQsCiAgICAvLyAgICAgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgICAgIHJlY2VpdmVyPUFwcGxpY2F0aW9uKG1hcmtldF9pZCkuYWRkcmVzcywgYW1vdW50PTEwMDAwMCwgZmVlPTAKICAgIC8vICAgICAgICAgKS5zdWJtaXQoKQogICAgLy8gICAgICMgaWYgYVRva2VuLCB0cmFuc2ZlciBhVG9rZW4KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0Qm9ycm93KAogICAgLy8gICAgICMgICAgICAgICB1c2VyPWFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgdG9rZW5faWQ9YXJjNC5VSW50NjQobWFya2V0X2lkKSwKICAgIC8vICAgICAjICAgICAgICAgYW1vdW50PWFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcmVwYXkoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCgxNDAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIHNlbGYuX3JlcGF5KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3JlcGF5KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgUmVwYXkgYm9ycm93ZWQgdG9rZW5zIGZvciBhIHNwZWNpZmljIG1hcmtldC4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIGhhbmRsZXMgdGhlIHJlcGF5bWVudCBvZiBib3Jyb3dlZCB0b2tlbnMgd2l0aCBhIG1pbmltdW0gaW50ZXJlc3QKICAgIC8vICAgICByZXF1aXJlbWVudC4gSXQgc3VwcG9ydHMgYm90aCBzVG9rZW4gKGJ1cm4pIGFuZCBhVG9rZW4gKHRyYW5zZmVyKSBtYXJrZXRzLgogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZDogVGhlIHVzZXIgSUQgdG8gcmVwYXkgdG9rZW5zIGZvcgogICAgLy8gICAgICAgICBtYXJrZXRfaWQ6IFRoZSBtYXJrZXQgSUQgdG8gcmVwYXkgdG9rZW5zIGZvcgogICAgLy8gICAgICAgICBhbW91bnQ6IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIHJlcGF5IChtdXN0IGJlID49IGFjY3J1ZWQgaW50ZXJlc3QpCiAgICAvLyAKICAgIC8vICAgICBSYWlzZXM6CiAgICAvLyAgICAgICAgIEFzc2VydGlvbkVycm9yOiBJZiBtYXJrZXQgdmFsaWRhdGlvbiBmYWlscywgcmVwYXkgYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidCwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICByZXBheSBhbW91bnQgaXMgbGVzcyB0aGFuIGFjY3J1ZWQgaW50ZXJlc3QsIG9yIHByaW5jaXBhbAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgIHJlcGF5bWVudCBleGNlZWRzIHNjYWxlZCBkZWJ0CiAgICAvLyAKICAgIC8vICAgICBQcm9jZXNzOgogICAgLy8gICAgICAgICAxLiBWYWxpZGF0ZXMgbWFya2V0IG9wZXJhdGlvbiBhbmQgYWNjcnVlcyBpbnRlcmVzdAogICAgLy8gICAgICAgICAyLiBDYWxjdWxhdGVzIHRvdGFsIGRlYnQgaW5jbHVkaW5nIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICAgICAgICAgMy4gVmFsaWRhdGVzIHJlcGF5IGFtb3VudCBkb2Vzbid0IGV4Y2VlZCB0b3RhbCBkZWJ0CiAgICAvLyAgICAgICAgIDQuIFJlcXVpcmVzIG1pbmltdW0gcmVwYXltZW50IG9mIGF0IGxlYXN0IHRoZSBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgICAgIDUuIENhbGN1bGF0ZXMgcHJpbmNpcGFsIHJlcGF5bWVudCAoYW1vdW50IC0gaW50ZXJlc3QpCiAgICAvLyAgICAgICAgIDYuIEJ1cm5zIHNUb2tlbnMgb3IgdHJhbnNmZXJzIGFUb2tlbnMgZnJvbSB1c2VyCiAgICAvLyAgICAgICAgIDcuIFVwZGF0ZXMgdXNlciBhbmQgbWFya2V0IHNjYWxlZCBib3Jyb3cgYW1vdW50cyAocHJpbmNpcGFsIG9ubHkpCiAgICAvLyAgICAgICAgIDguIFVwZGF0ZXMgZ2xvYmFsIGJvcnJvdyB2YWx1ZSB0cmFja2luZyB3aXRoIHByb3BlciBwcmljZSBoYW5kbGluZwogICAgLy8gICAgICIiIgogICAgLy8gICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIEZhbHNlKQogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHVzZXIncyBjdXJyZW50IGRlYnQgaW50ZXJlc3QKICAgIC8vICAgICBkZWJ0X2ludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB0b3RhbCBkZWJ0IGluY2x1ZGluZyBpbnRlcmVzdAogICAgLy8gICAgIHVuc2NhbGVkX2JvcnJvd3MgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgIHRvdGFsX2RlYnQgPSB1bnNjYWxlZF9ib3Jyb3dzICsgZGVidF9pbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgIyBWYWxpZGF0ZSByZXBheSBhbW91bnQgZG9lc24ndCBleGNlZWQgdG90YWwgZGVidAogICAgLy8gICAgIGFzc2VydCBhbW91bnQgPD0gdG90YWxfZGVidCwgIlJlcGF5IGFtb3VudCBleGNlZWRzIHRvdGFsIGRlYnQiCiAgICAvLyAKICAgIC8vICAgICAjIFJlcXVpcmUgbWluaW11bSByZXBheW1lbnQgb2YgYXQgbGVhc3QgdGhlIGRlYnQgaW50ZXJlc3QKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBhbW91bnQgPj0gZGVidF9pbnRlcmVzdAogICAgLy8gICAgICksICJSZXBheSBhbW91bnQgbXVzdCBiZSBhdCBsZWFzdCB0aGUgYWNjcnVlZCBpbnRlcmVzdCIKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIGhvdyBtdWNoIGdvZXMgdG93YXJkIHByaW5jaXBhbCByZXBheW1lbnQKICAgIC8vICAgICBwcmluY2lwYWxfcmVwYXltZW50ID0gYW1vdW50IC0gZGVidF9pbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgc2NhbGVkIGFtb3VudCBmb3IgcHJpbmNpcGFsIHJlcGF5bWVudCBvbmx5CiAgICAvLyAgICAgc2NhbGVkX2Ftb3VudCA9IChwcmluY2lwYWxfcmVwYXltZW50ICogU0NBTEUpIC8vIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgIGFzc2VydCB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBzY2FsZWRfYW1vdW50LCAiUmVwYXkgYW1vdW50IGV4Y2VlZHMgZGVidCIKICAgIC8vIAogICAgLy8gICAgIGlmIG1hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBTVG9rZW4uYnVybl9mcm9tLAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vIAogICAgLy8gICAgIG9sZF9ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZSAvLyBTQ0FMRQogICAgLy8gICAgICkKICAgIC8vICAgICBuZXdfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICAgICAgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgLy8gU0NBTEUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSBpZiB1c2VyIGRvZXNuJ3QgaGF2ZSBhIHByZXZpb3VzIHByaWNlCiAgICAvLyAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG5ld19tYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHByaWNlX2Zvcl9uZXcgPSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAgICAgb2xkX3ZhbHVlID0gKG9sZF9ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX29sZCkgLy8gU0NBTEUKICAgIC8vICAgICBuZXdfdmFsdWUgPSAobmV3X2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3JfbmV3KSAvLyBTQ0FMRQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBvbGRfdmFsdWUsICAjIG9sZCBVU0QgdmFsdWUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlLCAgIyBuZXcgVVNEIHZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoCiAgICAvLyAgICAgIyAgICAgTWFya2V0UmVwYXkoCiAgICAvLyAgICAgIyAgICAgICAgIHVzZXI9YXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQobWFya2V0X2lkKSwKICAgIC8vICAgICAjICAgICAgICAgYW1vdW50PWFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gIyBtaW50L3JlZGVlbSByZWxhdGVkIGNvZGUKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIHJlZGVlbShzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICMgICAgIGVuc3VyZV9idWRnZXQoMTQwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICMgICAgIHNlbGYuX3JlZGVlbShtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIEBzdWJyb3V0aW5lCiAgICAvLyAjIGRlZiBfcmVkZWVtKHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgLy8gCiAgICAvLyAjICAgICBhc3NlcnQgbm90IHNlbGYuX2hhc19wb3NpdGlvbigKICAgIC8vICMgICAgICAgICBUeG4uc2VuZGVyLCBtYXJrZXRfaWQKICAgIC8vICMgICAgICksICJDYW5ub3QgbWludC9yZWRlZW0gd2hlbiB1c2VyIGhhcyB0cmFja2VkIGRlcG9zaXQgcG9zaXRpb24iCiAgICAvLyAKICAgIC8vICMgICAgIG1hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgTlRva2VuLmJ1cm5fZnJvbSwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksCiAgICAvLyAjICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAjICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gIyAgICAgc2NhbGVkX2Ftb3VudCA9IChhbW91bnQgKiBTQ0FMRSkgLy8gbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAjICAgICBhc3NlcnQgKAogICAgLy8gIyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID49IHNjYWxlZF9hbW91bnQKICAgIC8vICMgICAgICksICJJbnN1ZmZpY2llbnQgbWFya2V0IGRlcG9zaXRzIHRvIHJlZGVlbSIKICAgIC8vICMgICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gIyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgbWludChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX21pbnQobWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX21pbnQoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICMgICAgIHNlbGYuX3ZhbGlkYXRlX21hcmtldF9vcGVyYXRpb24obWFya2V0X2lkLCBhbW91bnQsIFRydWUpCiAgICAvLyAKICAgIC8vICMgICAgIGFzc2VydCBub3Qgc2VsZi5faGFzX3Bvc2l0aW9uKAogICAgLy8gIyAgICAgICAgIFR4bi5zZW5kZXIsIG1hcmtldF9pZAogICAgLy8gIyAgICAgKSwgIkNhbm5vdCBtaW50L3JlZGVlbSB3aGVuIHVzZXIgaGFzIHRyYWNrZWQgZGVwb3NpdCBwb3NpdGlvbiIKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAjICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAjICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vICMgICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QoCiAgICAvLyAjICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAjICAgICApICAjIEdldCB1cGRhdGVkIG1hcmtldCB3aXRoIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICMgICAgIHNjYWxlZF9hbW91bnQgPSAoCiAgICAvLyAjICAgICAgICAgYW1vdW50ICogU0NBTEUKICAgIC8vICMgICAgICkgLy8gbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZSAgIyBDYWxjdWxhdGUgd2l0aCBuZXcgaW5kZXgKICAgIC8vIAogICAgLy8gIyAgICAgYXNzZXJ0ICgKICAgIC8vICMgICAgICAgICBuZXdfbWFya2V0Lm1heF90b3RhbF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICMgICAgICAgICA+PSBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBzY2FsZWRfYW1vdW50CiAgICAvLyAjICAgICApLCAiRGVwb3NpdCBjYXAgZXhjZWVkZWQiCiAgICAvLyAKICAgIC8vICMgICAgICMgT25seSBpbmNyZW1lbnQgbWFya2V0IHRvdGFsIGRlcG9zaXRzLCBub3QgdXNlciBkZXBvc2l0cyBzaW5jZSBwb3NpdGlvbiBpcyBub3QgdHJhY2tlZAogICAgLy8gIyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMobWFya2V0X2lkLCBzY2FsZWRfYW1vdW50KQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIE5Ub2tlbi5taW50LAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgICAgIE1pbnRFdmVudCgKICAgIC8vICMgICAgICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLCBhcmM0LlVJbnQyNTYoYW1vdW50KSwgYXJjNC5VSW50NjQobWFya2V0X2lkKQogICAgLy8gIyAgICAgICAgICkKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc3luY191c2VyX21hcmtldF9mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMTQwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgICAgIHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vIAogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpLmNvcHkoKQogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzID09IDAgYW5kIHVzZXIuc2NhbGVkX2JvcnJvd3MgPT0gMDoKICAgIC8vICAgICAgICAgcmV0dXJuCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgaWYgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlID4gMDoKICAgIC8vICAgICAgICAgZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKiBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICAjIFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSBpZiB1c2VyIGRvZXNuJ3QgaGF2ZSBhIHByZXZpb3VzIHByaWNlCiAgICAvLyAgICAgICAgIHByaWNlX2Zvcl9vbGQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgLy8gICAgICAgICAgICAgZWxzZSBtYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgb2xkX2RlcG9zaXRfdmFsdWUgPSAoZGVwb3NpdF9hbW91bnQgKiBwcmljZV9mb3Jfb2xkKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfZGVwb3NpdF92YWx1ZSA9IChkZXBvc2l0X2Ftb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfY29sbGF0ZXJhbCgKICAgIC8vICAgICAgICAgICAgIHVzZXJfaWQsIG1hcmtldF9pZCwgb2xkX2RlcG9zaXRfdmFsdWUsIG5ld19kZXBvc2l0X3ZhbHVlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlID4gMDoKICAgIC8vICAgICAgICAgYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICAjIFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSBpZiB1c2VyIGRvZXNuJ3QgaGF2ZSBhIHByZXZpb3VzIHByaWNlCiAgICAvLyAgICAgICAgIHByaWNlX2Zvcl9vbGQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgLy8gICAgICAgICAgICAgZWxzZSBtYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgb2xkX2JvcnJvd192YWx1ZSA9IChib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX29sZCkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X2JvcnJvd192YWx1ZSA9IChib3Jyb3dfYW1vdW50ICogbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9ib3Jyb3dzKAogICAgLy8gICAgICAgICAgICAgdXNlcl9pZCwgbWFya2V0X2lkLCBvbGRfYm9ycm93X3ZhbHVlLCBuZXdfYm9ycm93X3ZhbHVlCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9nbG9iYWxfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MpIC0+IEdsb2JhbFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF9nbG9iYWxfdXNlcihzZWxmLCB1c2VyX2lkOiBBY2NvdW50KSAtPiBHbG9iYWxVc2VyRGF0YToKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYuZ2xvYmFsX3VzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5nbG9iYWxfdXNlcnNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICBnbG9iYWxfdXNlciwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfZ2xvYmFsX3VzZXJfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiBnbG9iYWxfdXNlcgogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIG1hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIG9sZF92YWx1ZTogQmlnVUludCwKICAgIC8vICAgICBuZXdfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlIC0gb2xkX3ZhbHVlICsgbmV3X3ZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gICAgIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgb2xkX3ZhbHVlOiBCaWdVSW50LAogICAgLy8gICAgIG5ld192YWx1ZTogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlIC0gb2xkX3ZhbHVlICsgbmV3X3ZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gICAgIGdsb2JhbF91c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdID0gZ2xvYmFsX3VzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGxpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICBkZWJ0X21hcmtldF9pZDogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHVzZXI6IGFyYzQuQWRkcmVzcywKICAgIC8vICAgICBkZWJ0X2Ftb3VudDogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBhcmM0LlVJbnQyNTYsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZW5zdXJlX2J1ZGdldCg0OTAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIFN5bmMgZ2xvYmFsIHVzZXIgdmFsdWVzIGZvciBib3RoIG1hcmtldHMgdG8gaW5jbHVkZSBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwgZGVidF9tYXJrZXRfaWQubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICAgICAgdXNlci5uYXRpdmUsIGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXQoCiAgICAvLyAgICAgICAgIGRlYnRfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQubmF0aXZlLAogICAgLy8gICAgICAgICBUeG4uc2VuZGVyLAogICAgLy8gICAgICAgICB1c2VyLm5hdGl2ZSwKICAgIC8vICAgICAgICAgZGVidF9hbW91bnQubmF0aXZlLAogICAgLy8gICAgICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZC5uYXRpdmUsCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9saXF1aWRhdGVfY3Jvc3NfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgZGVidF9tYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIGxpcXVpZGF0b3JfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBkZWJ0X2Ftb3VudDogQmlnVUludCwKICAgIC8vICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogQmlnVUludCwKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBMaXF1aWRhdGUgYSB1c2VyJ3MgdW5kZXJjb2xsYXRlcmFsaXplZCBwb3NpdGlvbiBhY3Jvc3MgZGlmZmVyZW50IG1hcmtldHMuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBhbGxvd3MgYSBsaXF1aWRhdG9yIHRvIHJlcGF5IGEgcG9ydGlvbiBvZiBhIHVzZXIncyBkZWJ0IGluIG9uZSBtYXJrZXQKICAgIC8vICAgICBhbmQgcmVjZWl2ZSBjb2xsYXRlcmFsIGZyb20gYW5vdGhlciBtYXJrZXQgYXMgY29tcGVuc2F0aW9uLiBUaGUgbGlxdWlkYXRpb24gaW5jbHVkZXMKICAgIC8vICAgICBhIGJvbnVzIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzIGFuZCBoZWxwcyBtYWludGFpbiBwcm90b2NvbCBoZWFsdGggYnkgcmVtb3ZpbmcKICAgIC8vICAgICB1bmRlcmNvbGxhdGVyYWxpemVkIHBvc2l0aW9ucy4KICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIGRlYnRfbWFya2V0X2lkOiBUaGUgbWFya2V0IElEIHdoZXJlIHRoZSBkZWJ0IHRvIGJlIHJlcGFpZCBleGlzdHMKICAgIC8vICAgICAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IFRoZSBtYXJrZXQgSUQgd2hlcmUgY29sbGF0ZXJhbCB3aWxsIGJlIHNlaXplZCBmcm9tCiAgICAvLyAgICAgICAgIGxpcXVpZGF0b3JfaWQ6IFRoZSBhY2NvdW50IHBlcmZvcm1pbmcgdGhlIGxpcXVpZGF0aW9uCiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSBhY2NvdW50IGJlaW5nIGxpcXVpZGF0ZWQKICAgIC8vICAgICAgICAgZGVidF9hbW91bnQ6IFRoZSBhbW91bnQgb2YgZGVidCB0byByZXBheSAobXVzdCBpbmNsdWRlIGFjY3J1ZWQgaW50ZXJlc3QpCiAgICAvLyAgICAgICAgIG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkOiBNaW5pbXVtIGNvbGxhdGVyYWwgYW1vdW50IHRoZSBsaXF1aWRhdG9yIGV4cGVjdHMgdG8gcmVjZWl2ZQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgYW55IHZhbGlkYXRpb24gZmFpbHMsIGluY2x1ZGluZzoKICAgIC8vICAgICAgICAgICAgIC0gVXNpbmcgc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIChib3Jyb3ctb25seSBtYXJrZXQpCiAgICAvLyAgICAgICAgICAgICAtIEF0dGVtcHRpbmcgc2VsZi1saXF1aWRhdGlvbgogICAgLy8gICAgICAgICAgICAgLSBNYXJrZXQgZG9lc24ndCBleGlzdCBvciBpcyBwYXVzZWQKICAgIC8vICAgICAgICAgICAgIC0gUG9zaXRpb24gaXMgbm90IGxpcXVpZGF0YWJsZSAoaGVhbHRoIGZhY3RvciA+PSAxLjApCiAgICAvLyAgICAgICAgICAgICAtIExpcXVpZGF0aW9uIGFtb3VudCBleGNlZWRzIG1heGltdW0gYWxsb3dlZCBvciB0b3RhbCBkZWJ0CiAgICAvLyAgICAgICAgICAgICAtIEluc3VmZmljaWVudCBjb2xsYXRlcmFsIHRvIHNlaXplCiAgICAvLyAgICAgICAgICAgICAtIENvbGxhdGVyYWwgcmVjZWl2ZWQgYmVsb3cgbWluaW11bSB0aHJlc2hvbGQKICAgIC8vIAogICAgLy8gICAgIE5vdGVzOgogICAgLy8gICAgICAgICAtIFVzZXMgdGhlIGNvbGxhdGVyYWwgbWFya2V0J3MgbGlxdWlkYXRpb24gdGhyZXNob2xkIGZvciBoZWFsdGggY2FsY3VsYXRpb24KICAgIC8vICAgICAgICAgLSBMaXF1aWRhdGlvbiBib251cyBpcyBhcHBsaWVkIHRvIGluY2VudGl2aXplIGxpcXVpZGF0b3JzCiAgICAvLyAgICAgICAgIC0gQWNjcnVlZCBpbnRlcmVzdCBvbiBib3RoIGRlYnQgYW5kIGNvbGxhdGVyYWwgcG9zaXRpb25zIGlzIGluY2x1ZGVkCiAgICAvLyAgICAgICAgIC0gSGFuZGxlcyBkaWZmZXJlbnQgdG9rZW4gdHlwZXMgKEFSQzIwMCB2cyBTVG9rZW4pIGFwcHJvcHJpYXRlbHkKICAgIC8vICAgICAgICAgLSBVcGRhdGVzIGdsb2JhbCBib3Jyb3cgYW5kIGNvbGxhdGVyYWwgdmFsdWVzIGZvciB0aGUgdXNlcgogICAgLy8gICAgICIiIgogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHRyYW5zYWN0aW9uIGNhcCBmb3IgbGlxdWlkYXRlIG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgZGVidF9tYXJrZXRfaWQKICAgIC8vICAgICApLmxpcXVpZGF0ZS5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGRlYnRfYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJMaXF1aWRhdGUgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAgICAgIyBSRU0gcHJldmVudCB1c2luZyBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgaW4gbGlxdWlkYXRpb24gYmVjYXVzZSBzdG9rZW4KICAgIC8vICAgICAjIFJFTSBtYXJrZXQgY29sbGF0ZXJhbCBkb2VzIG5vdCBleGlzdAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkICE9IHNlbGYuc3Rva2VuX2FwcF9pZAogICAgLy8gICAgICksICJDYW5ub3QgdXNlIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCAoYm9ycm93LW9ubHkgbWFya2V0KSIKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgUkVNIHByZXZlbnQgc2VsZiBsaXF1aWRhdGlvbgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgIGFzc2VydCB1c2VyX2lkICE9IGxpcXVpZGF0b3JfaWQsICJDYW5ub3QgbGlxdWlkYXRlIHNlbGYiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICBhc3NlcnQgZGVidF9tYXJrZXRfaWQgaW4gc2VsZi5tYXJrZXRzLCAiRGVidCBtYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IGNvbGxhdGVyYWxfbWFya2V0X2lkIGluIHNlbGYubWFya2V0cywgIkNvbGxhdGVyYWwgbWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgZnJhbWVfZGlnIC01CiAgICBpdG9iCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMjAKICAgIC8vIHNlbGYubWFya2V0cyA9IEJveE1hcChVSW50NjQsIE1hcmtldERhdGEpICAjIE1hcmtldCBzdGF0ZQogICAgYnl0ZSAibWFya2V0cyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAyMC0yNTA3CiAgICAvLyAgICAgc2VsZi5tYXJrZXRzID0gQm94TWFwKFVJbnQ2NCwgTWFya2V0RGF0YSkgICMgTWFya2V0IHN0YXRlCiAgICAvLyAgICAgc2VsZi51c2VycyA9IEJveE1hcChCeXRlczQwLCBVc2VyRGF0YSkgICMgUGVyLW1hcmtldCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5nbG9iYWxfdXNlcnMgPSBCb3hNYXAoQWNjb3VudCwgR2xvYmFsVXNlckRhdGEpICAjIEdsb2JhbCB1c2VyIHN0YXRlCiAgICAvLyAgICAgc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwcyA9IEJveE1hcCgKICAgIC8vICAgICAgICAgVUludDY0LCBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gICAgICkgICMgTWFya2V0IHRyYW5zYWN0aW9uIGNhcHMKICAgIC8vICAgICBzZWxmLnVzZXJfY2FwcyA9IEJveE1hcChBY2NvdW50LCBVc2VyQ2FwKSAgIyBQZXItdXNlciBjYXBzCiAgICAvLyAgICAgc2VsZi5wcmljZV9mZWVkcyA9IEJveE1hcChVSW50NjQsIFByaWNlRmVlZCkgICMgUHJpY2UgZmVlZHMKICAgIC8vICAgICAjIHNlbGYubWFya2V0X2NvbnRyb2xsZXJzID0gQm94TWFwKEFjY291bnQsIGJvb2wpICAjIE1hcmtldCBjb250cm9sbGVycwogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICMgT3duYWJsZQogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX29ubHlfb3duZXIoc2VsZikgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgVHhuLnNlbmRlciA9PSBzZWxmLm93bmVyLCAib25seSB0aGUgb3duZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiIKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X293bmVyKHNlbGYpIC0+IGFyYzQuQWRkcmVzczoKICAgIC8vICAgICByZXR1cm4gYXJjNC5BZGRyZXNzKHNlbGYub3duZXIpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHRyYW5zZmVyX293bmVyc2hpcChzZWxmLCBuZXdfb3duZXI6IGFyYzQuQWRkcmVzcykgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICAjIHNlbGYuX3RyYW5zZmVyX293bmVyc2hpcChuZXdfb3duZXIubmF0aXZlKQogICAgLy8gICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF90cmFuc2Zlcl9vd25lcnNoaXAoc2VsZiwgbmV3X293bmVyOiBBY2NvdW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgIyBwcmV2aW91c19vd25lciA9IHNlbGYub3duZXIKICAgIC8vICMgICAgIHNlbGYub3duZXIgPSBuZXdfb3duZXIKICAgIC8vICMgICAgICMgYXJjNC5lbWl0KAogICAgLy8gIyAgICAgIyAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoYXJjNC5BZGRyZXNzKHByZXZpb3VzX293bmVyKSwgYXJjNC5BZGRyZXNzKG5ld19vd25lcikpCiAgICAvLyAjICAgICAjICkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIFN0b3JhZ2UKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfc3RvcmFnZV9hcHBfaWQoc2VsZiwgc3RvcmFnZV9hcHBfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9zdG9yYWdlX2FwcF9pZChzdG9yYWdlX2FwcF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3NldF9zdG9yYWdlX2FwcF9pZChzZWxmLCBzdG9yYWdlX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChVSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgIGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZSA9IHN0b3JhZ2VfYXBwX2lkCiAgICAvLyAKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBpc19wYXVzZWQoc2VsZikgLT4gYXJjNC5Cb29sOgogICAgLy8gICAgIHJldHVybiBhcmM0LkJvb2woc2VsZi5faXNfcGF1c2VkKCkpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2lzX3BhdXNlZChzZWxmKSAtPiBib29sOgogICAgLy8gICAgIHJldHVybiBzZWxmLnBhdXNlZCA9PSBVSW50NjQoMSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgcGF1c2Uoc2VsZiwgcGF1c2U6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgICMgc2VsZi5fcGF1c2UocGF1c2UubmF0aXZlKQogICAgLy8gICAgIHNlbGYucGF1c2VkID0gcGF1c2UubmF0aXZlCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9wYXVzZShzZWxmLCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5wYXVzZWQgPSBwYXVzZQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgIyBWZXJpZnkgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyIG9uIHRoZSBTVG9rZW4gY29udHJhY3QKICAgIC8vICAgICBzZWxmLl9zZXRfc3Rva2VuX2FwcF9pZChzdG9rZW5fYXBwX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X3N0b2tlbl9hcHBfaWQoc2VsZiwgc3Rva2VuX2FwcF9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHN0b2tlbl9hcHAgPSBBcHBsaWNhdGlvbihzdG9rZW5fYXBwX2lkKQogICAgLy8gICAgIGxlbmRpbmdfcG9vbF9hZGRyZXNzID0gR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcwogICAgLy8gICAgICMgQ2hlY2sgaWYgTGVuZGluZ1Bvb2wgaXMgYXBwcm92ZWQgYXMgbWludGVyCiAgICAvLyAgICAgaXNfYXBwcm92ZWRfbWludGVyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBTVG9rZW4uaXNfbWludGVyLCBhcmM0LkFkZHJlc3MobGVuZGluZ19wb29sX2FkZHJlc3MpLCBhcHBfaWQ9c3Rva2VuX2FwcAogICAgLy8gICAgICkKICAgIC8vICAgICAjIEFzc2VydCB0aGF0IExlbmRpbmdQb29sIGlzIGFwcHJvdmVkIGFzIG1pbnRlcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGlzX2FwcHJvdmVkX21pbnRlcgogICAgLy8gICAgICksICJMZW5kaW5nUG9vbCBtdXN0IGJlIGFwcHJvdmVkIGFzIFNUb2tlbiBtaW50ZXIgYmVmb3JlIHNldHRpbmcgYXBwIElEIgogICAgLy8gICAgIHNlbGYuc3Rva2VuX2FwcF9pZCA9IHN0b2tlbl9hcHBfaWQKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2dldF91c2VyX2tleShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCkgLT4gQnl0ZXM0MDoKICAgIC8vICAgICByZXR1cm4gQnl0ZXM0MC5mcm9tX2J5dGVzKAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCkuYnl0ZXMgKyBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLmJ5dGVzCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfdXNlcihzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHJldHVybiBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQpIC0+IFVzZXJEYXRhOgogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBpZiB1c2VyX2tleSBpbiBzZWxmLnVzZXJzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2Vyc1t1c2VyX2tleV0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyLCB0eG4gPSBhcmM0LmFiaV9jYWxsKExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9kZWZhdWx0LCBhcHBfaWQ9YXBwKQogICAgLy8gICAgICAgICByZXR1cm4gdXNlcgogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgdXNlcl9pZDogQWNjb3VudCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgYW1vdW50KQogICAgLy8gICAgIHVzZXIuYm9ycm93X2luZGV4ID0gbWFya2V0LmJvcnJvd19pbmRleAogICAgLy8gICAgIHVzZXIubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHVzZXIubGFzdF9wcmljZSA9IG1hcmtldC5wcmljZSAgIyBVcGRhdGUgdXNlcidzIGxhc3Qga25vd24gcHJpY2UKICAgIC8vICAgICBzZWxmLnVzZXJzW3VzZXJfa2V5XSA9IHVzZXIuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIHVzZXJfaWQ6IEFjY291bnQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlcl9rZXkgPSBzZWxmLl9nZXRfdXNlcl9rZXkodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYodXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHVzZXIuZGVwb3NpdF9pbmRleCA9IG1hcmtldC5kZXBvc2l0X2luZGV4CiAgICAvLyAgICAgdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlICAjIFVwZGF0ZSB1c2VyJ3MgbGFzdCBrbm93biBwcmljZQogICAgLy8gICAgIHNlbGYudXNlcnNbdXNlcl9rZXldID0gdXNlci5jb3B5KCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCB1c2VyX2lkOiBBY2NvdW50LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIHVzZXJfa2V5ID0gc2VsZi5fZ2V0X3VzZXJfa2V5KHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gcmVwYXkgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgdXNlci5zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1Nih1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vICAgICB1c2VyLmJvcnJvd19pbmRleCA9IG1hcmtldC5ib3Jyb3dfaW5kZXgKICAgIC8vICAgICB1c2VyLmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCkKICAgIC8vICAgICB1c2VyLmxhc3RfcHJpY2UgPSBtYXJrZXQucHJpY2UgICMgVXBkYXRlIHVzZXIncyBsYXN0IGtub3duIHByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBjcmVhdGVfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdG9rZW5faWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdGlvbl90aHJlc2hvbGQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIHJlc2VydmVfZmFjdG9yOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICBib3Jyb3dfcmF0ZTogYXJjNC5VSW50NjQsCiAgICAvLyAgICAgc2xvcGU6IGFyYzQuVUludDY0LAogICAgLy8gICAgIG1heF90b3RhbF9kZXBvc2l0czogYXJjNC5VSW50MjU2LAogICAgLy8gICAgIG1heF90b3RhbF9ib3Jyb3dzOiBhcmM0LlVJbnQyNTYsCiAgICAvLyAgICAgbGlxdWlkYXRpb25fYm9udXM6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNsb3NlX2ZhY3RvcjogYXJjNC5VSW50NjQsCiAgICAvLyApIC0+IGFyYzQuVUludDY0OgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0xMSBGaXg6IEVuc3VyZSBsaXF1aWRhdGlvbl90aHJlc2hvbGQgPiBjb2xsYXRlcmFsX2ZhY3RvcgogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUgPiBjb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUKICAgIC8vICAgICApLCAiTGlxdWlkYXRpb24gdGhyZXNob2xkIG11c3QgYmUgPiBjb2xsYXRlcmFsIGZhY3RvciIKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50NjQoCiAgICAvLyAgICAgICAgIHNlbGYuX2NyZWF0ZV9tYXJrZXQoCiAgICAvLyAgICAgICAgICAgICB0b2tlbl9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgICAgICBNYXJrZXREYXRhKAogICAgLy8gICAgICAgICAgICAgICAgIHBhdXNlZD1hcmM0LkJvb2woVHJ1ZSksICAjIFN0YXJ0IHBhdXNlZCB1bnRpbCBwcmljZSBpcyBzZXQKICAgIC8vICAgICAgICAgICAgICAgICBtYXhfdG90YWxfZGVwb3NpdHM9bWF4X3RvdGFsX2RlcG9zaXRzLAogICAgLy8gICAgICAgICAgICAgICAgIG1heF90b3RhbF9ib3Jyb3dzPW1heF90b3RhbF9ib3Jyb3dzLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX2JvbnVzPWxpcXVpZGF0aW9uX2JvbnVzLAogICAgLy8gICAgICAgICAgICAgICAgIGNvbGxhdGVyYWxfZmFjdG9yPWNvbGxhdGVyYWxfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgICAgIGxpcXVpZGF0aW9uX3RocmVzaG9sZD1saXF1aWRhdGlvbl90aHJlc2hvbGQsCiAgICAvLyAgICAgICAgICAgICAgICAgcmVzZXJ2ZV9mYWN0b3I9cmVzZXJ2ZV9mYWN0b3IsCiAgICAvLyAgICAgICAgICAgICAgICAgYm9ycm93X3JhdGU9Ym9ycm93X3JhdGUsCiAgICAvLyAgICAgICAgICAgICAgICAgc2xvcGU9c2xvcGUsCiAgICAvLyAgICAgICAgICAgICAgICAgdG90YWxfc2NhbGVkX2RlcG9zaXRzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICB0b3RhbF9zY2FsZWRfYm9ycm93cz1hcmM0LlVJbnQyNTYoMCksCiAgICAvLyAgICAgICAgICAgICAgICAgZGVwb3NpdF9pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGJvcnJvd19pbmRleD1hcmM0LlVJbnQyNTYoU0NBTEUpLCAgIyBTdGFydCBhdCBTQ0FMRSAoMS4wKQogICAgLy8gICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWU9YXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApLAogICAgLy8gICAgICAgICAgICAgICAgIHJlc2VydmVzPWFyYzQuVUludDI1NigwKSwKICAgIC8vICAgICAgICAgICAgICAgICBwcmljZT1hcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIDAKICAgIC8vICAgICAgICAgICAgICAgICApLCAgIyBQcmljZSBtdXN0IGJlIHNldCBiZWZvcmUgbWFya2V0IGNhbiBiZSB1c2VkCiAgICAvLyAgICAgICAgICAgICAgICAgbnRva2VuX2lkPWFyYzQuVUludDY0KDApLCAgIyBXaWxsIGJlIHNldCBkdXJpbmcgdG9rZW4gaW5pdGlhbGl6YXRpb24KICAgIC8vICAgICAgICAgICAgICAgICBjbG9zZV9mYWN0b3I9Y2xvc2VfZmFjdG9yLAogICAgLy8gICAgICAgICAgICAgKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfY3JlYXRlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gVUludDY0OgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBub3QgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGFscmVhZHkgZXhpc3RzIgogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQoVHhuLnNlbmRlcikKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSAyMDAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGNyZWF0ZSBtYXJrZXQiCiAgICAvLyAgICAgY29tcGlsZWQgPSBjb21waWxlX2NvbnRyYWN0KE5Ub2tlbiwgZXh0cmFfcHJvZ3JhbV9wYWdlcz0wKSAgIyBubyBleHRyYSBwYWdlcwogICAgLy8gICAgIGJhc2VfYXBwID0gYXJjNC5hcmM0X2NyZWF0ZShOVG9rZW4sIGNvbXBpbGVkPWNvbXBpbGVkKS5jcmVhdGVkX2FwcAogICAgLy8gICAgIGl0eG4uUGF5bWVudCgKICAgIC8vICAgICAgICAgcmVjZWl2ZXI9YmFzZV9hcHAuYWRkcmVzcywgYW1vdW50PTEwMDAwMDAsIGZlZT0wICAjIG1pbiAxMDg5MDAgc2VuZHMgMTAwMDAwMAogICAgLy8gICAgICkuc3VibWl0KCkKICAgIC8vICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBOVG9rZW4uYm9vdHN0cmFwNjQsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWJhc2VfYXBwLAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXRfZGF0YS5udG9rZW5faWQgPSBhcmM0LlVJbnQ2NChiYXNlX2FwcC5pZCkKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0X2RhdGEuY29weSgpCiAgICAvLyAgICAgYXJjNC5lbWl0KE1hcmtldENyZWF0ZWQoYXJjNC5VSW50NjQodG9rZW5faWQpKSkKICAgIC8vICAgICByZXR1cm4gYmFzZV9hcHAuaWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kKHJlYWRvbmx5PVRydWUpCiAgICAvLyBkZWYgZ2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfbWFya2V0KHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi5tYXJrZXRzW3Rva2VuX2lkXQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIGJveF9zdG9yYWdlX2FwcF9pZCA9IEJveChhcmM0LlVJbnQ2NCwga2V5PUJPWF9LRVlfU1RPUkFHRV9BUFBfSUQpCiAgICAvLyAgICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uKGJveF9zdG9yYWdlX2FwcF9pZC52YWx1ZS5uYXRpdmUpCiAgICAvLyAgICAgICAgIG1hcmtldCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGdldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgcmV0dXJuIHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCkgLT4gTWFya2V0VHJhbnNhY3Rpb25DYXA6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRfdHJhbnNhY3Rpb25fY2FwczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldF90cmFuc2FjdGlvbl9jYXAKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZ2V0X3VzZXJfY2FwKHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcykgLT4gVXNlckNhcDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gVXNlckNhcDoKICAgIC8vICAgICBpZiB1c2VyX2lkIGluIHNlbGYudXNlcl9jYXBzOgogICAgLy8gICAgICAgICByZXR1cm4gc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0KICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBib3hfc3RvcmFnZV9hcHBfaWQgPSBCb3goYXJjNC5VSW50NjQsIGtleT1CT1hfS0VZX1NUT1JBR0VfQVBQX0lEKQogICAgLy8gICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbihib3hfc3RvcmFnZV9hcHBfaWQudmFsdWUubmF0aXZlKQogICAgLy8gICAgICAgICB1c2VyX2NhcCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfdXNlcl9jYXBfZGVmYXVsdCwgYXBwX2lkPWFwcAogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIHJldHVybiB1c2VyX2NhcAogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzLCB1c2VyX2NhcDogVXNlckNhcCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfdXNlcl9jYXAodXNlcl9pZC5uYXRpdmUsIHVzZXJfY2FwKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfdXNlcl9jYXAoc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgdXNlcl9jYXA6IFVzZXJDYXApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi51c2VyX2NhcHNbdXNlcl9pZF0gPSB1c2VyX2NhcC5jb3B5KCkKICAgIC8vICAgICAjIGFyYzQuZW1pdChVc2VyQ2FwU2V0KGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwgdXNlcl9jYXApKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICBzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHRyYW5zYWN0aW9uX2NhcDogTWFya2V0VHJhbnNhY3Rpb25DYXAKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9zZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCh0b2tlbl9pZC5uYXRpdmUsIHRyYW5zYWN0aW9uX2NhcCkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IFVJbnQ2NCwgdHJhbnNhY3Rpb25fY2FwOiBNYXJrZXRUcmFuc2FjdGlvbkNhcAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYubWFya2V0X3RyYW5zYWN0aW9uX2NhcHNbdG9rZW5faWRdID0gdHJhbnNhY3Rpb25fY2FwLmNvcHkoKQogICAgLy8gICAgICMgYXJjNC5lbWl0KE1hcmtldFRyYW5zYWN0aW9uQ2FwU2V0KGFyYzQuVUludDY0KHRva2VuX2lkKSwgdHJhbnNhY3Rpb25fY2FwKSkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIG1hcmtldCBjb250cm9sbGVyCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIG1hcmtldF9kYXRhOiBNYXJrZXREYXRhKSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3NldF9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBtYXJrZXRfZGF0YSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBtYXJrZXRfZGF0YTogTWFya2V0RGF0YSkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgYWxyZWFkeSBleGlzdHMiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9kYXRhLnByaWNlID09IG1hcmtldC5wcmljZSwgIlByaWNlIG1pc21hdGNoIgogICAgLy8gICAgIHNlbGYubWFya2V0c1t0b2tlbl9pZF0gPSBtYXJrZXRfZGF0YS5jb3B5KCkKICAgIC8vIAogICAgLy8gIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAjIHByaWNlIGZlZWQgY29uc3VtZXIKICAgIC8vICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IFByaWNlRmVlZDoKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBQcmljZUZlZWQ6CiAgICAvLyAgICAgaWYgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgcHJpY2VfZmVlZCwgdHhuID0gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIExlbmRpbmdQb29sU3RvcmFnZS5nZXRfcHJpY2VfZmVlZF9kZWZhdWx0LCBhcHBfaWQ9YXBwCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgcmV0dXJuIHByaWNlX2ZlZWQKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgYXR0YWNoX3ByaWNlX2ZlZWQoCiAgICAvLyAgICAgc2VsZiwgdG9rZW5faWQ6IGFyYzQuVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fYXR0YWNoX3ByaWNlX2ZlZWQodG9rZW5faWQubmF0aXZlLCBwcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hdHRhY2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcm92aWRlcl9hcHBfaWQ6IFVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5tYXJrZXRzLCAiTWFya2V0IGV4aXN0cyIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldCh0b2tlbl9pZCkKICAgIC8vICAgICBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXSA9IFByaWNlRmVlZCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgcHJvdmlkZXJfYXBwX2lkPWFyYzQuVUludDY0KHByb3ZpZGVyX2FwcF9pZCksCiAgICAvLyAgICAgICAgIHByaWNlX3dpdGhfdGltZXN0YW1wPVByaWNlV2l0aFRpbWVzdGFtcCgKICAgIC8vICAgICAgICAgICAgIHByaWNlPW1hcmtldC5wcmljZSwKICAgIC8vICAgICAgICAgICAgIHRpbWVzdGFtcD1hcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCksCiAgICAvLyAgICAgICAgICksCiAgICAvLyAgICAgKQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZEF0dGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICAgICBwcm92aWRlcl9hcHBfaWQ9YXJjNC5VSW50NjQocHJvdmlkZXJfYXBwX2lkKSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGRldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9kZXRhY2hfcHJpY2VfZmVlZCh0b2tlbl9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RldGFjaF9wcmljZV9mZWVkKHNlbGYsIHRva2VuX2lkOiBVSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYubWFya2V0cywgIk1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIC8vICAgICBhc3NlcnQgdG9rZW5faWQgaW4gc2VsZi5wcmljZV9mZWVkcywgIlByaWNlIGZlZWQgbm90IGF0dGFjaGVkIgogICAgLy8gICAgIGRlbCBzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXQogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIFByaWNlRmVlZERldGFjaGVkKAogICAgLy8gICAgICMgICAgICAgICBtYXJrZXRfaWQ9YXJjNC5VSW50NjQodG9rZW5faWQpLAogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHByaWNlOiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZC5uYXRpdmUsIHByaWNlLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfc2V0X21hcmtldF9wcmljZShzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwcmljZTogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgIyBhc3NlcnQgdG9rZW5faWQgbm90IGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIGFscmVhZHkgYXR0YWNoZWQiCiAgICAvLyAgICAgYXNzZXJ0IHByaWNlID4gMCwgIlByaWNlIG11c3QgYmUgcG9zaXRpdmUiCiAgICAvLyAKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLm1hcmtldHNbdG9rZW5faWRdLmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBVbnBhdXNlIHRoZSBtYXJrZXQgb24gZmlyc3QgcHJpY2Ugc2V0CiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZCBhbmQgbWFya2V0LnByaWNlID09IDA6CiAgICAvLyAgICAgICAgIG1hcmtldC5wYXVzZWQgPSBhcmM0LkJvb2woRmFsc2UpCiAgICAvLyAKICAgIC8vICAgICAjIFNjYWxlIHRoZSBwcmljZSBieSBTQ0FMRSBpbnRlcm5hbGx5IGZvciBzdG9yYWdlCiAgICAvLyAgICAgbWFya2V0LnByaWNlID0gYXJjNC5VSW50MjU2KHByaWNlICogU0NBTEUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbdG9rZW5faWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAgICAgIyBhcmM0LmVtaXQoTWFya2V0UHJpY2VTZXQoYXJjNC5VSW50NjQodG9rZW5faWQpLCBhcmM0LlVJbnQyNTYocHJpY2UpKSkKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQpIC0+IE5vbmU6CiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vICAgICBzZWxmLl9mZXRjaF9wcmljZV9mZWVkKHRva2VuX2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZmV0Y2hfcHJpY2VfZmVlZChzZWxmLCB0b2tlbl9pZDogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IHRva2VuX2lkIGluIHNlbGYucHJpY2VfZmVlZHMsICJQcmljZSBmZWVkIG5vdCBhdHRhY2hlZCIKICAgIC8vICAgICBwYXltZW50ID0gcmVxdWlyZV9wYXltZW50KFR4bi5zZW5kZXIpCiAgICAvLyAgICAgYXNzZXJ0IHBheW1lbnQgPj0gMTAwMDAwLCAiaW5zdWZmaWNpZW50IHBheW1lbnQgZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTUKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBwYXltZW50IDw9IDEwMDAwMDAKICAgIC8vICAgICApLCAicGF5bWVudCBleGNlZWRzIG1heGltdW0gZm9yIGZldGNoIHByaWNlIGZlZWQiICAjIDFlLTYKICAgIC8vICAgICBhcHAgPSBBcHBsaWNhdGlvbihzZWxmLnByaWNlX2ZlZWRzW3Rva2VuX2lkXS5wcm92aWRlcl9hcHBfaWQubmF0aXZlKQogICAgLy8gICAgIGl0eG4uUGF5bWVudChyZWNlaXZlcj1hcHAuYWRkcmVzcywgYW1vdW50PXBheW1lbnQsIGZlZT0wKS5zdWJtaXQoKQogICAgLy8gICAgIHByaWNlX3dpdGhfdGltZXN0YW1wLCB0eG4gPSBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICBQcmljZUZlZWRQcm92aWRlckludGVyZmFjZS5nZXRfcHJpY2Vfd2l0aF90aW1lc3RhbXAsCiAgICAvLyAgICAgICAgIGFyYzQuVUludDY0KHRva2VuX2lkKSwKICAgIC8vICAgICAgICAgYXBwX2lkPWFwcCwKICAgIC8vICAgICApCiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgICBwcmljZV93aXRoX3RpbWVzdGFtcC50aW1lc3RhbXAubmF0aXZlCiAgICAvLyAgICAgICAgID4gc2VsZi5wcmljZV9mZWVkc1t0b2tlbl9pZF0ucHJpY2Vfd2l0aF90aW1lc3RhbXAudGltZXN0YW1wLm5hdGl2ZQogICAgLy8gICAgICk6CiAgICAvLyAgICAgICAgIHNlbGYucHJpY2VfZmVlZHNbdG9rZW5faWRdLnByaWNlX3dpdGhfdGltZXN0YW1wID0gKAogICAgLy8gICAgICAgICAgICAgcHJpY2Vfd2l0aF90aW1lc3RhbXAuY29weSgpCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgc2VsZi5fc2V0X21hcmtldF9wcmljZSh0b2tlbl9pZCwgcHJpY2Vfd2l0aF90aW1lc3RhbXAucHJpY2UubmF0aXZlKQogICAgLy8gCiAgICAvLyAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfaW5jcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgYW1vdW50CiAgICAvLyAgICAgKQogICAgLy8gICAgIG1hcmtldC5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBhbW91bnQKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIG1hcmtldCA9IHNlbGYuX2dldF9tYXJrZXQobWFya2V0X2lkKQogICAgLy8gICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzLm5hdGl2ZSArIGFtb3VudAogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQubGFzdF91cGRhdGVfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wKQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBtYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlID49IGFtb3VudAogICAgLy8gICAgICksICJJbnN1ZmZpY2llbnQgYmFsYW5jZSB0byB3aXRoZHJhdyB0aGlzIGFtb3VudCIKICAgIC8vICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICApCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW21hcmtldF9pZF0gPSBtYXJrZXQuY29weSgpCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHBhdXNlX21hcmtldChzZWxmLCB0b2tlbl9pZDogYXJjNC5VSW50NjQsIHBhdXNlOiBhcmM0LlVJbnQ2NCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl9vbmx5X293bmVyKCkKICAgIC8vICAgICBzZWxmLl9wYXVzZV9tYXJrZXQodG9rZW5faWQubmF0aXZlLCBwYXVzZS5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3BhdXNlX21hcmtldChzZWxmLCB0b2tlbl9pZDogVUludDY0LCBwYXVzZTogVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCB0b2tlbl9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgc2VsZi5tYXJrZXRzW3Rva2VuX2lkXS5wYXVzZWQgPSBhcmM0LkJvb2wocGF1c2UgPT0gVUludDY0KDEpKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzeW5jX21hcmtldChzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9hY2NydWVfaW50ZXJlc3Qoc2VsZiwgbWFya2V0X2lkOiBVSW50NjQpIC0+IE1hcmtldERhdGE6CiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgaWYgbWFya2V0LnBhdXNlZDoKICAgIC8vICAgICAgICAgcmV0dXJuIG1hcmtldAogICAgLy8gCiAgICAvLyAgICAgY3VycmVudF90aW1lID0gR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAKICAgIC8vICAgICB0aW1lX2RlbHRhID0gY3VycmVudF90aW1lIC0gbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUubmF0aXZlCiAgICAvLyAgICAgaWYgdGltZV9kZWx0YSA8PSAwOgogICAgLy8gICAgICAgICByZXR1cm4gbWFya2V0CiAgICAvLyAKICAgIC8vICAgICAjIEZvciBzdG9rZW4gbWFya2V0IChib3Jyb3ctb25seSksIHVzZSBhIGZpeGVkIHV0aWxpemF0aW9uIHJhdGUgc2luY2UgdGhlcmUgYXJlIG5vIGRlcG9zaXRzCiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgdXRpbGl6YXRpb24gPSBCaWdVSW50KDEwMDAwKSAgIyAxMDAlIHV0aWxpemF0aW9uIGZvciBib3Jyb3ctb25seSBtYXJrZXQKICAgIC8vICAgICBlbGlmIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybiBtYXJrZXQKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICB1dGlsaXphdGlvbiA9ICgKICAgIC8vICAgICAgICAgICAgIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiAxMDAwMAogICAgLy8gICAgICAgICApIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgcmF0ZSA9IG1hcmtldC5ib3Jyb3dfcmF0ZS5uYXRpdmUgKyAobWFya2V0LnNsb3BlLm5hdGl2ZSAqIHV0aWxpemF0aW9uKSAvLyAxMDAwMAogICAgLy8gICAgIGludGVyZXN0ID0gKHJhdGUgKiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogdGltZV9kZWx0YSkgLy8gKAogICAgLy8gICAgICAgICBzZWxmLnNlY29uZHNfcGVyX3llYXIgKiAxMDAwMAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgU3BlY2lhbCBoYW5kbGluZyBmb3Igc3Rva2VuIG1hcmtldCAtIGFsbCBpbnRlcmVzdCBnb2VzIHRvIHJlc2VydmVzCiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IGludGVyZXN0CiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9wb3J0aW9uID0gQmlnVUludCgwKQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgIHByb3RvY29sX3BvcnRpb24gPSAoCiAgICAvLyAgICAgICAgICAgICBpbnRlcmVzdCAqIGFyYzQuVUludDI1Ni5mcm9tX2J5dGVzKG1hcmtldC5yZXNlcnZlX2ZhY3Rvci5ieXRlcykubmF0aXZlCiAgICAvLyAgICAgICAgICkgLy8gMTAwMDAKICAgIC8vICAgICAgICAgaWYgcHJvdG9jb2xfcG9ydGlvbiA+IGludGVyZXN0OgogICAgLy8gICAgICAgICAgICAgcHJvdG9jb2xfcG9ydGlvbiA9IGludGVyZXN0CiAgICAvLyAgICAgICAgIGRlcG9zaXRvcl9wb3J0aW9uID0gaW50ZXJlc3QgLSBwcm90b2NvbF9wb3J0aW9uCiAgICAvLyAKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzID4gMDoKICAgIC8vICAgICAgICAgbWFya2V0LmRlcG9zaXRfaW5kZXggPSBhcmM0LlVJbnQyNTYoCiAgICAvLyAgICAgICAgICAgICBtYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgICAgICsgKGRlcG9zaXRvcl9wb3J0aW9uICogU0NBTEUpIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICBpZiBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MgPiAwOgogICAgLy8gICAgICAgICBtYXJrZXQuYm9ycm93X2luZGV4ID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICAgICAgbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgICAgICsgKGludGVyZXN0ICogU0NBTEUpIC8vIG1hcmtldC50b3RhbF9zY2FsZWRfYm9ycm93cy5uYXRpdmUKICAgIC8vICAgICAgICAgKQogICAgLy8gCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9ib3Jyb3dzID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgaW50ZXJlc3QKICAgIC8vICAgICApCiAgICAvLyAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cyA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyBkZXBvc2l0b3JfcG9ydGlvbgogICAgLy8gICAgICkKICAgIC8vICAgICBtYXJrZXQucmVzZXJ2ZXMgPSBhcmM0LlVJbnQyNTYobWFya2V0LnJlc2VydmVzLm5hdGl2ZSArIHByb3RvY29sX3BvcnRpb24pCiAgICAvLyAgICAgbWFya2V0Lmxhc3RfdXBkYXRlX3RpbWUgPSBhcmM0LlVJbnQ2NChjdXJyZW50X3RpbWUpCiAgICAvLyAKICAgIC8vICAgICBzZWxmLm1hcmtldHNbbWFya2V0X2lkXSA9IG1hcmtldC5jb3B5KCkKICAgIC8vICAgICByZXR1cm4gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyAjIFRPRE8gZ292ZXJuYW5jZTogY29uc2lkZXIgaWYgcmVzZXJ2ZSB3aXRoZHJhd2FsIHNob3VsZCByZXF1aXJlIGFkZGl0aW9uYWwKICAgIC8vICMgICAgICBnb3Zlcm5hbmNlIG1lY2hhbmlzbXMKICAgIC8vICMgVE9ETyBtaW5pbXVtIHJlc2VydmUgbGV2ZWxzOiBtaWdodCB3YW50IHRvIGVuZm9yY2UgbWluaW11bSByZXNlcnZlIGxldmVscyBmb3IKICAgIC8vICMgICAgICBwcm90b2NvbCBzYWZldHkKICAgIC8vICMgVE9ETyBldmVudCBlbWlzc2lvbjogQ29uc2lkZXIgYWRkaW5nIGFuIGV2ZW50IHRvIGxvZyByZXNlcnZlIHdpdGhkcmF3YWxzIGZvcgogICAgLy8gIyAgICAgIHRyYW5zcGFyZW5jeQogICAgLy8gCiAgICAvLyAjIFJFTSBpbnRlbnRpb25hbGx5IHNraXBwaW5nIHN1YnJvdXRpbmUgdG8gcmVkdWNlIGNvbnRyYWN0IHNpemUKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHdpdGhkcmF3X3Jlc2VydmVzKHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX29ubHlfb3duZXIoKQogICAgLy8gICAgIHNlbGYuX3dpdGhkcmF3X3Jlc2VydmVzKG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX3dpdGhkcmF3X3Jlc2VydmVzKHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAgICAgc2VsZi5fb25seV9vd25lcigpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9pc19wYXVzZWQoKSwgIlByb3RvY29sIGlzIHBhdXNlZCIKICAgIC8vIAogICAgLy8gICAgICMgQWNjcnVlIGludGVyZXN0IGZpcnN0IHRvIGdldCB1cC10by1kYXRlIHJlc2VydmVzCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICBhc3NlcnQgbWFya2V0LnJlc2VydmVzLm5hdGl2ZSA+PSBhbW91bnQsICJJbnN1ZmZpY2llbnQgcmVzZXJ2ZXMiCiAgICAvLyAKICAgIC8vICAgICAjIFRyYW5zZmVyIHJlc2VydmVzIHRvIHRoZSBvd25lciAobm90IHRvIHRoZSBjb250cmFjdCBpdHNlbGYpCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3Moc2VsZi5vd25lciksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFVwZGF0ZSByZXNlcnZlcwogICAgLy8gICAgIG1hcmtldC5yZXNlcnZlcyA9IGFyYzQuVUludDI1NihtYXJrZXQucmVzZXJ2ZXMubmF0aXZlIC0gYW1vdW50KQogICAgLy8gICAgIHNlbGYubWFya2V0c1ttYXJrZXRfaWRdID0gbWFya2V0LmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKAogICAgLy8gICAgIHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQsIGd1YXJkX3N0b2tlbjogYm9vbAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIGFzc2VydCBub3Qgc2VsZi5faXNfcGF1c2VkKCksICJQcm90b2NvbCBpcyBwYXVzZWQiCiAgICAvLyAgICAgYXNzZXJ0IG1hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJNYXJrZXQgZG9lcyBub3QgZXhpc3QiCiAgICAvLyAgICAgYXNzZXJ0IGFtb3VudCA+IDAsICJBbW91bnQgbXVzdCBiZSA+IDAiCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChtYXJrZXRfaWQpCiAgICAvLyAgICAgYXNzZXJ0IG5vdCBtYXJrZXQucGF1c2VkLCAiTWFya2V0IGlzIHBhdXNlZCIKICAgIC8vICAgICBpZiBndWFyZF9zdG9rZW46CiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICBzZWxmLnN0b2tlbl9hcHBfaWQgIT0gbWFya2V0X2lkCiAgICAvLyAgICAgICAgICksICJDYW5ub3QgdXNlIHN0b2tlbiBtYXJrZXQgZm9yIHRoaXMgb3BlcmF0aW9uIgogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBkZXBvc2l0KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIHNlbGYuX2RlcG9zaXQoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBSRU0gbWF5IGFkZCBwcm90ZWN0aW9uIGZvciBsb3cgdXRpbGlzYXRpb24gaW4gZnV0dXJlCiAgICAvLyAjIFJFTSBsb3dlciBtYXggZGVwb3NpdCBhbW91bnQgZm9yIGxvdyB1dGlsaXNhdGlvbgogICAgLy8gIyBSRU0gaGlnaCBtYXggZGVwb3NpdCBhbW91bnQgZm9yIGhpZ2ggdXRpbGlzYXRpb24KICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfZGVwb3NpdChzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIEludGVybmFsIGRlcG9zaXQgbWV0aG9kIHRoYXQgaGFuZGxlcyB1c2VyIGRlcG9zaXRzIGludG8gYSBsZW5kaW5nIG1hcmtldC4KICAgIC8vIAogICAgLy8gICAgIFRoaXMgbWV0aG9kIHBlcmZvcm1zIGEgY29tcGxldGUgZGVwb3NpdCBvcGVyYXRpb24gaW5jbHVkaW5nOgogICAgLy8gICAgIDEuIFZhbGlkYXRpbmcgdGhlIG1hcmtldCBvcGVyYXRpb24gKHByb3RvY29sIG5vdCBwYXVzZWQsIG1hcmtldCBleGlzdHMsIGFtb3VudCA+IDAsIG1hcmtldCBub3QgcGF1c2VkKQogICAgLy8gICAgIDIuIFRyYW5zZmVycmluZyBBUkMyMDAgdG9rZW5zIGZyb20gdXNlciB0byB0aGUgbGVuZGluZyBwb29sIGNvbnRyYWN0CiAgICAvLyAgICAgMy4gQWNjcnVpbmcgaW50ZXJlc3Qgb24gdGhlIG1hcmtldCB0byBnZXQgdXBkYXRlZCBkZXBvc2l0IGluZGV4CiAgICAvLyAgICAgNC4gQ2FsY3VsYXRpbmcgYW5kIGFkZGluZyBlYXJuZWQgaW50ZXJlc3QgdG8gdGhlIHVzZXIncyBwb3NpdGlvbgogICAgLy8gICAgIDUuIENvbnZlcnRpbmcgZGVwb3NpdCBhbW91bnQgdG8gc2NhbGVkIGRlcG9zaXRzIHVzaW5nIGN1cnJlbnQgZGVwb3NpdCBpbmRleAogICAgLy8gICAgIDYuIENoZWNraW5nIGRlcG9zaXQgY2FwIGNvbnN0cmFpbnRzCiAgICAvLyAgICAgNy4gVXBkYXRpbmcgdXNlciBhbmQgbWFya2V0IHNjYWxlZCBkZXBvc2l0IGJhbGFuY2VzCiAgICAvLyAgICAgOC4gTWludGluZyBOVG9rZW5zIHRvIHJlcHJlc2VudCB0aGUgdXNlcidzIGRlcG9zaXQgcG9zaXRpb24KICAgIC8vICAgICA5LiBVcGRhdGluZyBnbG9iYWwgY29sbGF0ZXJhbCBjYWxjdWxhdGlvbnMgZm9yIHRoZSB1c2VyCiAgICAvLyAgICAgMTAuIEVtaXR0aW5nIGEgTWFya2V0RGVwb3NpdCBldmVudAogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZCAoQWNjb3VudCk6IFRoZSBhY2NvdW50IElEIG9mIHRoZSB1c2VyIG1ha2luZyB0aGUgZGVwb3NpdAogICAgLy8gICAgICAgICBtYXJrZXRfaWQgKFVJbnQ2NCk6IFRoZSBJRCBvZiB0aGUgbWFya2V0IHRvIGRlcG9zaXQgaW50bwogICAgLy8gICAgICAgICBhbW91bnQgKEJpZ1VJbnQpOiBUaGUgYW1vdW50IG9mIHVuZGVybHlpbmcgdG9rZW5zIHRvIGRlcG9zaXQKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIG1hcmtldCB2YWxpZGF0aW9uIGZhaWxzLCBkZXBvc2l0IGNhcCBpcyBleGNlZWRlZCwgb3Igb3RoZXIgY29uc3RyYWludHMgYXJlIHZpb2xhdGVkCiAgICAvLyAKICAgIC8vICAgICBOb3RlOgogICAgLy8gICAgICAgICAtIEludGVyZXN0IGVhcm5lZCBzaW5jZSBsYXN0IGludGVyYWN0aW9uIGlzIGF1dG9tYXRpY2FsbHkgYWRkZWQgdG8gdGhlIGRlcG9zaXQKICAgIC8vICAgICAgICAgLSBTY2FsZWQgZGVwb3NpdHMgYXJlIHVzZWQgdG8gdHJhY2sgdXNlciBwb3NpdGlvbnMgYW5kIGNhbGN1bGF0ZSBpbnRlcmVzdAogICAgLy8gICAgICAgICAtIENvbGxhdGVyYWwgdmFsdWUgaXMgdXBkYXRlZCB1c2luZyBlaXRoZXIgdXNlcidzIGxhc3QgcmVjb3JkZWQgcHJpY2Ugb3IgY3VycmVudCBtYXJrZXQgcHJpY2UKICAgIC8vICAgICAgICAgLSBOVG9rZW5zIGFyZSBtaW50ZWQgdG8gcmVwcmVzZW50IHRoZSB1c2VyJ3MgZGVwb3NpdCBwb3NpdGlvbiAoYW1vdW50ICsgaW50ZXJlc3QpCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIGRlcG9zaXQgb3BlcmF0aW9uCiAgICAvLyAgICAgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA9IHNlbGYuX2dldF9tYXJrZXRfdHJhbnNhY3Rpb25fY2FwKAogICAgLy8gICAgICAgICBtYXJrZXRfaWQKICAgIC8vICAgICApLmRlcG9zaXQubmF0aXZlCiAgICAvLyAgICAgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCBhbW91bnQgPD0gbWFya2V0X3RyYW5zYWN0aW9uX2NhcCwgIkRlcG9zaXQgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gICAgICkgICMgR2V0IHVwZGF0ZWQgbWFya2V0IHdpdGggYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgaW50ZXJlc3QgPSBzZWxmLl9jYWxjdWxhdGVfdXNlcl9pbnRlcmVzdCh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIEFkZCBlYXJuZWQgaW50ZXJlc3QgdG8gdXNlcidzIHBvc2l0aW9uIGFzIGFkZGl0aW9uYWwgc2NhbGVkIGRlcG9zaXRzCiAgICAvLyAgICAgaW50ZXJlc3Rfc2NhbGVkX2Ftb3VudCA9IEJpZ1VJbnQoMCkKICAgIC8vICAgICBpZiBpbnRlcmVzdCA+IDA6CiAgICAvLyAgICAgICAgIGludGVyZXN0X3NjYWxlZF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICBpbnRlcmVzdCAqIFNDQUxFCiAgICAvLyAgICAgICAgICkgLy8gbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gCiAgICAvLyAgICAgc2NhbGVkX2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgYW1vdW50ICogU0NBTEUKICAgIC8vICAgICApIC8vIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUgICMgQ2FsY3VsYXRlIHdpdGggbmV3IGluZGV4CiAgICAvLyAKICAgIC8vICAgICB0b3RhbF9zY2FsZWRfYW1vdW50ID0gc2NhbGVkX2Ftb3VudCArIGludGVyZXN0X3NjYWxlZF9hbW91bnQKICAgIC8vIAogICAgLy8gICAgIG9sZF9kZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIG5ld19tYXJrZXQubWF4X3RvdGFsX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICAgICA+PSBuZXdfbWFya2V0LnRvdGFsX3NjYWxlZF9kZXBvc2l0cy5uYXRpdmUgKyB0b3RhbF9zY2FsZWRfYW1vdW50CiAgICAvLyAgICAgKSwgIk1hcmtldCBkZXBvc2l0IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfZGVwb3NpdHMoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwgdXNlcl9pZCwgdG90YWxfc2NhbGVkX2Ftb3VudAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgdG90YWxfc2NhbGVkX2Ftb3VudCkKICAgIC8vIAogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5taW50LAogICAgLy8gICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQgKyBpbnRlcmVzdCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIG9sZF9kZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogdXNlci5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vICAgICBuZXdfZGVwb3NpdF9hbW91bnQgPSBvbGRfZGVwb3NpdF9hbW91bnQgKyBhbW91bnQgKyBpbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA9PSAwOgogICAgLy8gICAgICAgICAjIEZhbGxiYWNrOiBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgdG8gcHJldmVudCBuZWdhdGl2ZSBjb2xsYXRlcmFsCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlID0gKG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19tYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgIGVsc2U6CiAgICAvLyAgICAgICAgICMgTm9ybWFsIGNhc2U6IFVzZSB1c2VyJ3MgbGFzdCByZWNvcmRlZCBwcmljZSBmb3IgYWNjdXJhdGUgY29sbGF0ZXJhbCByZWR1Y3Rpb24KICAgIC8vICAgICAgICAgb2xkX3ZhbHVlID0gKG9sZF9kZXBvc2l0X2Ftb3VudCAqIHVzZXIubGFzdF9wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSA9IChuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3IgZGVwb3NpdCBvcGVyYXRpb24KICAgIC8vICAgICB1c2VyX2NhcCA9IHNlbGYuX2dldF91c2VyX2NhcCh1c2VyX2lkKQogICAgLy8gICAgIGlmIHVzZXJfY2FwLnRvdGFsX2RlcG9zaXRzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICBuZXdfdmFsdWUgPD0gdXNlcl9jYXAudG90YWxfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAgICAgICAgICksICJVc2VyIGRlcG9zaXQgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKHVzZXJfaWQsIG1hcmtldF9pZCwgb2xkX3ZhbHVlLCBuZXdfdmFsdWUpCiAgICAvLyAKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXREZXBvc2l0KAogICAgLy8gICAgICMgICAgICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksIGFyYzQuVUludDY0KG1hcmtldF9pZCksIGFyYzQuVUludDI1NihhbW91bnQpCiAgICAvLyAgICAgIyAgICAgKQogICAgLy8gICAgICMgKQogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QoCiAgICAvLyAjICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICMgKSAtPiBhcmM0LlVJbnQyNTY6CiAgICAvLyAjICAgICBlbnN1cmVfYnVkZ2V0KDcwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICMgICAgIHJldHVybiBhcmM0LlVJbnQyNTYoCiAgICAvLyAjICAgICAgICAgc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZC5uYXRpdmUsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vIEBzdWJyb3V0aW5lCiAgICAvLyBkZWYgX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0KSAtPiBCaWdVSW50OgogICAgLy8gICAgICIiIkNhbGN1bGF0ZSB1c2VyJ3MgYWNjcnVlZCBpbnRlcmVzdCIiIgogICAgLy8gICAgIG5ld19tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB0b3RhbCB1bmRlcmx5aW5nIGFtb3VudAogICAgLy8gICAgIHVzZXJfdG90YWxfdW5kZXJseWluZyA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbmV3X21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vIAogICAgLy8gICAgICMgSW50ZXJlc3QgaXMgdGhlIGRpZmZlcmVuY2UgZnJvbSB0aGUgc2NhbGVkIGRlcG9zaXRzICh3aGljaCByZXByZXNlbnQgdGhlICJiYXNlIiBhbW91bnQpCiAgICAvLyAgICAgaW50ZXJlc3QgPSB1c2VyX3RvdGFsX3VuZGVybHlpbmcgLSB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBpbnRlcmVzdAogICAgLy8gCiAgICAvLyAjIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gIyBkZWYgY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCgKICAgIC8vICMgICAgIHNlbGYsIHVzZXJfaWQ6IGFyYzQuQWRkcmVzcywgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NAogICAgLy8gIyApIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICMgICAgIGVuc3VyZV9idWRnZXQoNzAwLCBPcFVwRmVlU291cmNlLkdyb3VwQ3JlZGl0KQogICAgLy8gIyAgICAgcmV0dXJuIGFyYzQuVUludDI1NigKICAgIC8vICMgICAgICAgICBzZWxmLl9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KHVzZXJfaWQubmF0aXZlLCBtYXJrZXRfaWQubmF0aXZlKQogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0KAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIiIiQ2FsY3VsYXRlIHVzZXIncyBhY2NydWVkIGRlYnQgaW50ZXJlc3QiIiIKICAgIC8vICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgdW5kZXJseWluZyBkZWJ0IGFtb3VudAogICAgLy8gICAgIHVzZXJfdG90YWxfZGVidCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBvcmlnaW5hbCBwcmluY2lwYWwgYW1vdW50IHVzaW5nIHVzZXIncyBib3Jyb3dfaW5kZXgKICAgIC8vICAgICAjIFNhZmV0eSBjaGVjazogaWYgdXNlcidzIGJvcnJvd19pbmRleCBpcyAwLCB1c2UgY3VycmVudCBtYXJrZXQgYm9ycm93X2luZGV4CiAgICAvLyAgICAgdXNlcl9ib3Jyb3dfaW5kZXggPSAoCiAgICAvLyAgICAgICAgIHVzZXIuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUgPiAwCiAgICAvLyAgICAgICAgIGVsc2UgbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIG9yaWdpbmFsX3ByaW5jaXBhbCA9ICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIHVzZXJfYm9ycm93X2luZGV4KSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBJbnRlcmVzdCBpcyB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGN1cnJlbnQgdG90YWwgZGVidCBhbmQgb3JpZ2luYWwgcHJpbmNpcGFsCiAgICAvLyAgICAgZGVidF9pbnRlcmVzdCA9IHVzZXJfdG90YWxfZGVidCAtIG9yaWdpbmFsX3ByaW5jaXBhbAogICAgLy8gCiAgICAvLyAgICAgcmV0dXJuIGRlYnRfaW50ZXJlc3QKICAgIC8vIAogICAgLy8gQGFyYzQuYWJpbWV0aG9kCiAgICAvLyBkZWYgd2l0aGRyYXcoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IGFyYzQuVUludDI1NjoKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDIxMDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAKICAgIC8vICAgICAjIFN5bmMgdGhlIG1hcmtldCBiZWluZyB3aXRoZHJhd24gZnJvbSB0byB1cGRhdGUgZ2xvYmFsIHZhbHVlcyB3aXRoIGludGVyZXN0CiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICAgICByZXR1cm4gYXJjNC5VSW50MjU2KHNlbGYuX3dpdGhkcmF3KFR4bi5zZW5kZXIsIG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF93aXRoZHJhdygKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50CiAgICAvLyApIC0+IEJpZ1VJbnQ6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgV2l0aGRyYXcgdG9rZW5zIGZyb20gYSBsZW5kaW5nIG1hcmtldCBieSBidXJuaW5nIG5Ub2tlbnMuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBoYW5kbGVzIHRoZSB3aXRoZHJhd2FsIHByb2Nlc3MgYnk6CiAgICAvLyAgICAgMS4gVmFsaWRhdGluZyB0aGUgbWFya2V0IG9wZXJhdGlvbiBhbmQgdXNlciBiYWxhbmNlCiAgICAvLyAgICAgMi4gQWNjcnVpbmcgaW50ZXJlc3QgdG8gZ2V0IHRoZSBsYXRlc3QgbWFya2V0IHN0YXRlCiAgICAvLyAgICAgMy4gQ2FsY3VsYXRpbmcgdXNlcidzIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vICAgICA0LiBQZXJmb3JtaW5nIGhlYWx0aCBjaGVja3MgdG8gZW5zdXJlIHdpdGhkcmF3YWwgZG9lc24ndCBwdXQgYm9ycm93cyBhdCByaXNrCiAgICAvLyAgICAgNS4gQnVybmluZyBuVG9rZW5zIGFuZCB0cmFuc2ZlcnJpbmcgdW5kZXJseWluZyB0b2tlbnMgdG8gdXNlcgogICAgLy8gICAgIDYuIFVwZGF0aW5nIGdsb2JhbCBjb2xsYXRlcmFsIHZhbHVlcwogICAgLy8gCiAgICAvLyAgICAgQXJnczoKICAgIC8vICAgICAgICAgdXNlcl9pZDogVGhlIGFjY291bnQgSUQgb2YgdGhlIHVzZXIgd2l0aGRyYXdpbmcgdG9rZW5zCiAgICAvLyAgICAgICAgIG1hcmtldF9pZDogVGhlIElEIG9mIHRoZSBtYXJrZXQgdG8gd2l0aGRyYXcgZnJvbQogICAgLy8gICAgICAgICBhbW91bnQ6IFRoZSBhbW91bnQgb2YgblRva2VucyB0byBidXJuIChub3QgdGhlIHVuZGVybHlpbmcgdG9rZW4gYW1vdW50KQogICAgLy8gCiAgICAvLyAgICAgUmV0dXJuczoKICAgIC8vICAgICAgICAgQmlnVUludDogVGhlIHRvdGFsIGFtb3VudCBvZiB1bmRlcmx5aW5nIHRva2VucyB0cmFuc2ZlcnJlZCB0byB0aGUgdXNlcgogICAgLy8gICAgICAgICAgICAgICAgIChpbmNsdWRlcyBib3RoIHRoZSB3aXRoZHJhd24gYW1vdW50IGFuZCBhY2NydWVkIGludGVyZXN0KQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgdXNlciBoYXMgaW5zdWZmaWNpZW50IGJhbGFuY2Ugb3Igd2l0aGRyYXdhbCB3b3VsZCBwdXQgYm9ycm93cyBhdCByaXNrCiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIHdpdGhkcmF3IG9wZXJhdGlvbgogICAgLy8gICAgIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPSBzZWxmLl9nZXRfbWFya2V0X3RyYW5zYWN0aW9uX2NhcCgKICAgIC8vICAgICAgICAgbWFya2V0X2lkCiAgICAvLyAgICAgKS53aXRoZHJhdy5uYXRpdmUKICAgIC8vICAgICBpZiBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID4gMDoKICAgIC8vICAgICAgICAgYXNzZXJ0IGFtb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiV2l0aGRyYXcgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgIGludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBhbW91bnQgaXMgdGhlIGFtb3VudCBvZiBuVG9rZW5zIGJlaW5nIGJ1cm5lZAogICAgLy8gICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgIGFtb3VudCA8PSB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICAgICApLCAiSW5zdWZmaWNpZW50IGJhbGFuY2UgdG8gd2l0aGRyYXcgdGhpcyBhbW91bnQiCiAgICAvLyAKICAgIC8vICAgICBnbG9iYWxfdXNlciA9IHNlbGYuX2dldF9nbG9iYWxfdXNlcih1c2VyX2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBoZWFsdGggY2hlY2s6IGVuc3VyZSB3aXRoZHJhdyB3b3VsZCBub3QgcHV0IGJvcnJvd3MgYXQgcmlzawogICAgLy8gICAgIGlmIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZSA+IDA6CiAgICAvLyAgICAgICAgICMgdmFsdWUgb2YgdW5kZXJseWluZyBhbW91bnQgdG8gd2l0aGRyYXcgdXNpbmcgbmV3IG1hcmtldCBwcmljZQogICAgLy8gICAgICAgICB3aXRoZHJhd192YWx1ZSA9IChhbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgcmVtYWluaW5nX2NvbGxhdGVyYWwgPSAoCiAgICAvLyAgICAgICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIHdpdGhkcmF3X3ZhbHVlCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgYXNzZXJ0IGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgPD0gKAogICAgLy8gICAgICAgICAgICAgcmVtYWluaW5nX2NvbGxhdGVyYWwgKiBCaWdVSW50KG5ld19tYXJrZXQuY29sbGF0ZXJhbF9mYWN0b3IubmF0aXZlKQogICAgLy8gICAgICAgICApIC8vIEJpZ1VJbnQoMTAwMDApLCAiV2l0aGRyYXdhbCB3b3VsZCBwdXQgYm9ycm93cyBhdCByaXNrIgogICAgLy8gCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHVzZXJfaWQsIGFtb3VudCkKICAgIC8vICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIE5Ub2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihuZXdfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50ICsgaW50ZXJlc3QpLAogICAgLy8gICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBvbGRfZGVwb3NpdF9hbW91bnQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIHVzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICApIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X2RlcG9zaXRfYW1vdW50ID0gb2xkX2RlcG9zaXRfYW1vdW50ICsgaW50ZXJlc3QgLSBhbW91bnQKICAgIC8vIAogICAgLy8gICAgIGFtb3VudF91c2RfdmFsdWUgPSAoYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICAjIERGLUFVRC0wOTogVmFsaWRhdGUgdXNlciBjYXAgZm9yIHdpdGhkcmF3IG9wZXJhdGlvbgogICAgLy8gICAgIHVzZXJfY2FwID0gc2VsZi5fZ2V0X3VzZXJfY2FwKHVzZXJfaWQpCiAgICAvLyAgICAgaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9PSAwOgogICAgLy8gICAgICAgICB1c2VyX2NhcC5kYWlseV9yZXNldF90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXAgKyA4NjQwMCkKICAgIC8vICAgICBlbGlmIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPCBHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcDoKICAgIC8vICAgICAgICAgdXNlcl9jYXAudG90YWxfd2l0aGRyYXdhbHMgPSBhcmM0LlVJbnQyNTYoMCkKICAgIC8vICAgICAgICAgdXNlcl9jYXAudG90YWxfbGlxdWlkYXRpb25zID0gYXJjNC5VSW50MjU2KDApCiAgICAvLyAgICAgICAgIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPSBhcmM0LlVJbnQ2NChHbG9iYWwubGF0ZXN0X3RpbWVzdGFtcCArIDg2NDAwKQogICAgLy8gICAgIGlmIHVzZXJfY2FwLmRhaWx5X3dpdGhkcmF3YWxzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgICAgIG5ld190b3RhbF93aXRoZHJhd2FscyA9IHVzZXJfY2FwLnRvdGFsX3dpdGhkcmF3YWxzLm5hdGl2ZSArIGFtb3VudF91c2RfdmFsdWUKICAgIC8vICAgICAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgICAgIG5ld190b3RhbF93aXRoZHJhd2FscyA8PSB1c2VyX2NhcC5kYWlseV93aXRoZHJhd2Fscy5uYXRpdmUKICAgIC8vICAgICAgICAgKSwgIlVzZXIgd2l0aGRyYXcgY2FwIGV4Y2VlZGVkIgogICAgLy8gICAgICAgICB1c2VyX2NhcC50b3RhbF93aXRoZHJhd2FscyA9IGFyYzQuVUludDI1NihuZXdfdG90YWxfd2l0aGRyYXdhbHMpCiAgICAvLyAgICAgICAgIHNlbGYuX3NldF91c2VyX2NhcCh1c2VyX2lkLCB1c2VyX2NhcCkKICAgIC8vIAogICAgLy8gICAgIGlmIHVzZXIubGFzdF9wcmljZS5uYXRpdmUgPT0gMDoKICAgIC8vICAgICAgICAgIyBGYWxsYmFjazogVXNlIGN1cnJlbnQgbWFya2V0IHByaWNlIHRvIHByZXZlbnQgbmVnYXRpdmUgY29sbGF0ZXJhbAogICAgLy8gICAgICAgICBvbGRfdmFsdWUgPSAob2xkX2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSA9IChuZXdfZGVwb3NpdF9hbW91bnQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICAjIE5vcm1hbCBjYXNlOiBVc2UgdXNlcidzIGxhc3QgcmVjb3JkZWQgcHJpY2UgZm9yIGFjY3VyYXRlIGNvbGxhdGVyYWwgcmVkdWN0aW9uCiAgICAvLyAgICAgICAgIG9sZF92YWx1ZSA9IChvbGRfZGVwb3NpdF9hbW91bnQgKiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBuZXdfdmFsdWUgPSAobmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlLCAgIyBvbGQgVVNEIHZhbHVlCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSwgICMgbmV3IFVTRCB2YWx1ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgRW1pdCBldmVudHMKICAgIC8vICAgICAjIGFyYzQuZW1pdCgKICAgIC8vICAgICAjICAgICBNYXJrZXRXaXRoZHJhdygKICAgIC8vICAgICAjICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLCBhcmM0LlVJbnQ2NChtYXJrZXRfaWQpLCBhcmM0LlVJbnQyNTYoYW1vdW50KQogICAgLy8gICAgICMgICAgICkKICAgIC8vICAgICAjICkKICAgIC8vIAogICAgLy8gICAgIHJldHVybiBhbW91bnQgKyBpbnRlcmVzdAogICAgLy8gCiAgICAvLyAjIHdpdGhkcmF3IGNvc3QgOTAwMDAwCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGJvcnJvdyhzZWxmLCBtYXJrZXRfaWQ6IGFyYzQuVUludDY0LCBhbW91bnQ6IGFyYzQuVUludDI1NikgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDI4MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAKICAgIC8vICAgICAjIFN5bmMgdGhlIG1hcmtldCBiZWluZyBib3Jyb3dlZCBmcm9tIHRvIHVwZGF0ZSBnbG9iYWwgdmFsdWVzIHdpdGggaW50ZXJlc3QKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoVHhuLnNlbmRlciwgbWFya2V0X2lkLm5hdGl2ZSkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2JvcnJvdyhUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9ib3Jyb3coc2VsZiwgdXNlcl9pZDogQWNjb3VudCwgbWFya2V0X2lkOiBVSW50NjQsIGFtb3VudDogQmlnVUludCkgLT4gTm9uZToKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBGYWxzZSkKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIGJvcnJvdyBvcGVyYXRpb24KICAgIC8vICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gICAgICkuYm9ycm93Lm5hdGl2ZQogICAgLy8gICAgIGlmIG1hcmtldF90cmFuc2FjdGlvbl9jYXAgPiAwOgogICAgLy8gICAgICAgICBhc3NlcnQgYW1vdW50IDw9IG1hcmtldF90cmFuc2FjdGlvbl9jYXAsICJCb3Jyb3cgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgdXNlciA9IHNlbGYuX2dldF91c2VyKHVzZXJfaWQsIG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgIHBheW1lbnQgPSByZXF1aXJlX3BheW1lbnQodXNlcl9pZCkKICAgIC8vICAgICBhc3NlcnQgcGF5bWVudCA+PSBVSW50NjQoMTAwMDAwKSwgIlBheW1lbnQgYW1vdW50IG11c3QgYmUgPj0gMC4xIgogICAgLy8gCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB1c2VyJ3MgY3VycmVudCBkZWJ0IGludGVyZXN0CiAgICAvLyAgICAgZGVidF9pbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgY3VycmVudCBtYXJrZXQgdG90YWwgYm9ycm93cyAoaW5jbHVkaW5nIGludGVyZXN0KQogICAgLy8gICAgIGN1cnJlbnRfbWFya2V0X3RvdGFsX2JvcnJvd3MgPSAoCiAgICAvLyAgICAgICAgIG5ld19tYXJrZXQudG90YWxfc2NhbGVkX2JvcnJvd3MubmF0aXZlICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgKSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgYW1vdW50IGJlaW5nIGFkZGVkIChuZXcgYm9ycm93ICsgZGVidCBpbnRlcmVzdCkKICAgIC8vICAgICAjIGRlYnQgaW50ZXJlc3QgYWRkZWQgYXQgdGhpcyBwb2ludCB0byBwcmV2ZW50IHVubmVjZXNzYXJ5IGRlYnQgcmVzZXQKICAgIC8vICAgICB0b3RhbF9hbW91bnRfdG9fYWRkID0gYW1vdW50ICsgZGVidF9pbnRlcmVzdAogICAgLy8gCiAgICAvLyAgICAgIyBWYWxpZGF0ZSBhZ2FpbnN0IG1hcmtldC13aWRlIGJvcnJvdyBjYXAKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBuZXdfbWFya2V0Lm1heF90b3RhbF9ib3Jyb3dzLm5hdGl2ZQogICAgLy8gICAgICAgICA+PSBjdXJyZW50X21hcmtldF90b3RhbF9ib3Jyb3dzICsgdG90YWxfYW1vdW50X3RvX2FkZAogICAgLy8gICAgICksICJCb3Jyb3cgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAgICAgIyBDaGVjayBjb2xsYXRlcmFsIHJlcXVpcmVtZW50cyAtIGV4Y2x1ZGUgc2FtZSBtYXJrZXQgY29sbGF0ZXJhbCB0byBwcmV2ZW50CiAgICAvLyAgICAgIyBpbmVmZmljaWVudCBzYW1lLWFzc2V0IGJvcnJvd2luZwogICAgLy8gICAgIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICAvLyAKICAgIC8vICAgICBuZXdfYm9ycm93X3ZhbHVlID0gKHRvdGFsX2Ftb3VudF90b19hZGQgKiBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIC8vICAgICB0b3RhbF9ib3Jyb3dfdmFsdWUgPSBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlICsgbmV3X2JvcnJvd192YWx1ZQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgZWZmZWN0aXZlIGNvbGxhdGVyYWwgdmFsdWUgKGV4Y2x1ZGluZyBzYW1lLW1hcmtldCBkZXBvc2l0cykKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPT0gQmlnVUludCgwKToKICAgIC8vICAgICAgICAgZWZmZWN0aXZlX2NvbGxhdGVyYWxfdmFsdWUgPSBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZQogICAgLy8gICAgICMgVXNlIGVmZmVjdGl2ZSBjb2xsYXRlcmFsIHZhbHVlIChleGNsdWRpbmcgc2FtZS1tYXJrZXQgZGVwb3NpdHMpCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgZGVwb3NpdGVkX2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgICAgIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAqIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBleGNsdWRlZF92YWx1ZSA9IChkZXBvc2l0ZWRfYW1vdW50ICogbmV3X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIGlmIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlID4gZXhjbHVkZWRfdmFsdWU6CiAgICAvLyAgICAgICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSA9ICgKICAgIC8vICAgICAgICAgICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIGV4Y2x1ZGVkX3ZhbHVlCiAgICAvLyAgICAgICAgICAgICApCiAgICAvLyAgICAgICAgIGVsc2U6CiAgICAvLyAgICAgICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSA9IEJpZ1VJbnQoMCkKICAgIC8vIAogICAgLy8gICAgIGFzc2VydCB0b3RhbF9ib3Jyb3dfdmFsdWUgPD0gKAogICAgLy8gICAgICAgICBlZmZlY3RpdmVfY29sbGF0ZXJhbF92YWx1ZSAqIEJpZ1VJbnQobmV3X21hcmtldC5jb2xsYXRlcmFsX2ZhY3Rvci5uYXRpdmUpCiAgICAvLyAgICAgKSAvLyBCaWdVSW50KDEwMDAwKSwgIkluc3VmZmljaWVudCBjb2xsYXRlcmFsIGFjcm9zcyBtYXJrZXRzIgogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgc2NhbGVkIGFtb3VudCBmb3IgdGhlIHRvdGFsCiAgICAvLyAgICAgc2NhbGVkX2Ftb3VudCA9ICh0b3RhbF9hbW91bnRfdG9fYWRkICogU0NBTEUpIC8vIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gCiAgICAvLyAgICAgc2VsZi5faW5jcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICBzZWxmLl9pbmNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vIAogICAgLy8gICAgIG9sZF9ib3Jyb3dfYW1vdW50ID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZSAvLyBTQ0FMRQogICAgLy8gICAgICkKICAgIC8vICAgICBuZXdfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgKHVzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgc2NhbGVkX2Ftb3VudCkKICAgIC8vICAgICAgICAgKiBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICAgICAgLy8gU0NBTEUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICAjIFVzZSBjdXJyZW50IG1hcmtldCBwcmljZSBpZiB1c2VyIGRvZXNuJ3QgaGF2ZSBhIHByZXZpb3VzIHByaWNlCiAgICAvLyAgICAgcHJpY2VfZm9yX29sZCA9ICgKICAgIC8vICAgICAgICAgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZQogICAgLy8gICAgICAgICBpZiB1c2VyLmxhc3RfcHJpY2UubmF0aXZlID4gMAogICAgLy8gICAgICAgICBlbHNlIG5ld19tYXJrZXQucHJpY2UubmF0aXZlCiAgICAvLyAgICAgKQogICAgLy8gICAgIHByaWNlX2Zvcl9uZXcgPSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gCiAgICAvLyAgICAgb2xkX3ZhbHVlID0gKG9sZF9ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX29sZCkgLy8gU0NBTEUKICAgIC8vICAgICBuZXdfdmFsdWUgPSAobmV3X2JvcnJvd19hbW91bnQgKiBwcmljZV9mb3JfbmV3KSAvLyBTQ0FMRQogICAgLy8gCiAgICAvLyAgICAgIyBERi1BVUQtMDk6IFZhbGlkYXRlIHVzZXIgY2FwIGZvciBib3Jyb3cgb3BlcmF0aW9uCiAgICAvLyAgICAgdXNlcl9jYXAgPSBzZWxmLl9nZXRfdXNlcl9jYXAodXNlcl9pZCkKICAgIC8vICAgICBpZiB1c2VyX2NhcC50b3RhbF9ib3Jyb3dzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCAoCiAgICAvLyAgICAgICAgICAgICBuZXdfdmFsdWUgPD0gdXNlcl9jYXAudG90YWxfYm9ycm93cy5uYXRpdmUKICAgIC8vICAgICAgICAgKSwgIlVzZXIgYm9ycm93IGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICAgICAgdXNlcl9pZCwKICAgIC8vICAgICAgICAgbWFya2V0X2lkLAogICAgLy8gICAgICAgICBvbGRfdmFsdWUsICAjIG9sZCBVU0QgdmFsdWUKICAgIC8vICAgICAgICAgbmV3X3ZhbHVlLCAgIyBuZXcgVVNEIHZhbHVlCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBpZiBzdG9rZW4sIG1pbnQgc3Rva2VuCiAgICAvLyAgICAgaWYgbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIFNUb2tlbi5taW50LAogICAgLy8gICAgICAgICAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAgICAgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICBpdHhuLlBheW1lbnQoCiAgICAvLyAgICAgICAgICAgICByZWNlaXZlcj1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLmFkZHJlc3MsIGFtb3VudD0xMDAwMDAsIGZlZT0wCiAgICAvLyAgICAgICAgICkuc3VibWl0KCkKICAgIC8vICAgICAjIGlmIGFUb2tlbiwgdHJhbnNmZXIgYVRva2VuCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICAgICAgICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlciwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldEJvcnJvdygKICAgIC8vICAgICAjICAgICAgICAgdXNlcj1hcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIHRva2VuX2lkPWFyYzQuVUludDY0KG1hcmtldF9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIGFtb3VudD1hcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHJlcGF5KHNlbGYsIG1hcmtldF9pZDogYXJjNC5VSW50NjQsIGFtb3VudDogYXJjNC5VSW50MjU2KSAtPiBOb25lOgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoMTQwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICBzZWxmLl9yZXBheShUeG4uc2VuZGVyLCBtYXJrZXRfaWQubmF0aXZlLCBhbW91bnQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9yZXBheShzZWxmLCB1c2VyX2lkOiBBY2NvdW50LCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gICAgICIiIgogICAgLy8gICAgIFJlcGF5IGJvcnJvd2VkIHRva2VucyBmb3IgYSBzcGVjaWZpYyBtYXJrZXQuCiAgICAvLyAKICAgIC8vICAgICBUaGlzIG1ldGhvZCBoYW5kbGVzIHRoZSByZXBheW1lbnQgb2YgYm9ycm93ZWQgdG9rZW5zIHdpdGggYSBtaW5pbXVtIGludGVyZXN0CiAgICAvLyAgICAgcmVxdWlyZW1lbnQuIEl0IHN1cHBvcnRzIGJvdGggc1Rva2VuIChidXJuKSBhbmQgYVRva2VuICh0cmFuc2ZlcikgbWFya2V0cy4KICAgIC8vIAogICAgLy8gICAgIEFyZ3M6CiAgICAvLyAgICAgICAgIHVzZXJfaWQ6IFRoZSB1c2VyIElEIHRvIHJlcGF5IHRva2VucyBmb3IKICAgIC8vICAgICAgICAgbWFya2V0X2lkOiBUaGUgbWFya2V0IElEIHRvIHJlcGF5IHRva2VucyBmb3IKICAgIC8vICAgICAgICAgYW1vdW50OiBUaGUgYW1vdW50IG9mIHRva2VucyB0byByZXBheSAobXVzdCBiZSA+PSBhY2NydWVkIGludGVyZXN0KQogICAgLy8gCiAgICAvLyAgICAgUmFpc2VzOgogICAgLy8gICAgICAgICBBc3NlcnRpb25FcnJvcjogSWYgbWFya2V0IHZhbGlkYXRpb24gZmFpbHMsIHJlcGF5IGFtb3VudCBleGNlZWRzIHRvdGFsIGRlYnQsCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgcmVwYXkgYW1vdW50IGlzIGxlc3MgdGhhbiBhY2NydWVkIGludGVyZXN0LCBvciBwcmluY2lwYWwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICByZXBheW1lbnQgZXhjZWVkcyBzY2FsZWQgZGVidAogICAgLy8gCiAgICAvLyAgICAgUHJvY2VzczoKICAgIC8vICAgICAgICAgMS4gVmFsaWRhdGVzIG1hcmtldCBvcGVyYXRpb24gYW5kIGFjY3J1ZXMgaW50ZXJlc3QKICAgIC8vICAgICAgICAgMi4gQ2FsY3VsYXRlcyB0b3RhbCBkZWJ0IGluY2x1ZGluZyBhY2NydWVkIGludGVyZXN0CiAgICAvLyAgICAgICAgIDMuIFZhbGlkYXRlcyByZXBheSBhbW91bnQgZG9lc24ndCBleGNlZWQgdG90YWwgZGVidAogICAgLy8gICAgICAgICA0LiBSZXF1aXJlcyBtaW5pbXVtIHJlcGF5bWVudCBvZiBhdCBsZWFzdCB0aGUgYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gICAgICAgICA1LiBDYWxjdWxhdGVzIHByaW5jaXBhbCByZXBheW1lbnQgKGFtb3VudCAtIGludGVyZXN0KQogICAgLy8gICAgICAgICA2LiBCdXJucyBzVG9rZW5zIG9yIHRyYW5zZmVycyBhVG9rZW5zIGZyb20gdXNlcgogICAgLy8gICAgICAgICA3LiBVcGRhdGVzIHVzZXIgYW5kIG1hcmtldCBzY2FsZWQgYm9ycm93IGFtb3VudHMgKHByaW5jaXBhbCBvbmx5KQogICAgLy8gICAgICAgICA4LiBVcGRhdGVzIGdsb2JhbCBib3Jyb3cgdmFsdWUgdHJhY2tpbmcgd2l0aCBwcm9wZXIgcHJpY2UgaGFuZGxpbmcKICAgIC8vICAgICAiIiIKICAgIC8vICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBGYWxzZSkKICAgIC8vIAogICAgLy8gICAgIHVzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgbmV3X21hcmtldCA9IHNlbGYuX2FjY3J1ZV9pbnRlcmVzdChtYXJrZXRfaWQpCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSB1c2VyJ3MgY3VycmVudCBkZWJ0IGludGVyZXN0CiAgICAvLyAgICAgZGVidF9pbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2RlYnRfaW50ZXJlc3QodXNlcl9pZCwgbWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAgICAgIyBDYWxjdWxhdGUgdG90YWwgZGVidCBpbmNsdWRpbmcgaW50ZXJlc3QKICAgIC8vICAgICB1bnNjYWxlZF9ib3Jyb3dzID0gKAogICAgLy8gICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG5ld19tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgLy8gICAgICkgLy8gU0NBTEUKICAgIC8vICAgICB0b3RhbF9kZWJ0ID0gdW5zY2FsZWRfYm9ycm93cyArIGRlYnRfaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgICMgVmFsaWRhdGUgcmVwYXkgYW1vdW50IGRvZXNuJ3QgZXhjZWVkIHRvdGFsIGRlYnQKICAgIC8vICAgICBhc3NlcnQgYW1vdW50IDw9IHRvdGFsX2RlYnQsICJSZXBheSBhbW91bnQgZXhjZWVkcyB0b3RhbCBkZWJ0IgogICAgLy8gCiAgICAvLyAgICAgIyBSZXF1aXJlIG1pbmltdW0gcmVwYXltZW50IG9mIGF0IGxlYXN0IHRoZSBkZWJ0IGludGVyZXN0CiAgICAvLyAgICAgYXNzZXJ0ICgKICAgIC8vICAgICAgICAgYW1vdW50ID49IGRlYnRfaW50ZXJlc3QKICAgIC8vICAgICApLCAiUmVwYXkgYW1vdW50IG11c3QgYmUgYXQgbGVhc3QgdGhlIGFjY3J1ZWQgaW50ZXJlc3QiCiAgICAvLyAKICAgIC8vICAgICAjIENhbGN1bGF0ZSBob3cgbXVjaCBnb2VzIHRvd2FyZCBwcmluY2lwYWwgcmVwYXltZW50CiAgICAvLyAgICAgcHJpbmNpcGFsX3JlcGF5bWVudCA9IGFtb3VudCAtIGRlYnRfaW50ZXJlc3QKICAgIC8vIAogICAgLy8gICAgICMgQ2FsY3VsYXRlIHNjYWxlZCBhbW91bnQgZm9yIHByaW5jaXBhbCByZXBheW1lbnQgb25seQogICAgLy8gICAgIHNjYWxlZF9hbW91bnQgPSAocHJpbmNpcGFsX3JlcGF5bWVudCAqIFNDQUxFKSAvLyBuZXdfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIC8vICAgICBhc3NlcnQgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gc2NhbGVkX2Ftb3VudCwgIlJlcGF5IGFtb3VudCBleGNlZWRzIGRlYnQiCiAgICAvLyAKICAgIC8vICAgICBpZiBtYXJrZXRfaWQgPT0gc2VsZi5zdG9rZW5fYXBwX2lkOgogICAgLy8gICAgICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgU1Rva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICBlbHNlOgogICAgLy8gICAgICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICAgICAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gICAgICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG1hcmtldF9pZCksCiAgICAvLyAgICAgICAgICkKICAgIC8vIAogICAgLy8gICAgIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdXNlcl9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHVzZXJfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgc2VsZi5fZGVjcmVtZW50X21hcmtldF90b3RhbF9zY2FsZWRfYm9ycm93cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICAgICBvbGRfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICAgICAgdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgKiB1c2VyLmJvcnJvd19pbmRleC5uYXRpdmUgLy8gU0NBTEUKICAgIC8vICAgICApCiAgICAvLyAgICAgbmV3X2JvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICh1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIHNjYWxlZF9hbW91bnQpCiAgICAvLyAgICAgICAgICogbmV3X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgIC8vIFNDQUxFCiAgICAvLyAgICAgKQogICAgLy8gCiAgICAvLyAgICAgIyBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgaWYgdXNlciBkb2Vzbid0IGhhdmUgYSBwcmV2aW91cyBwcmljZQogICAgLy8gICAgIHByaWNlX2Zvcl9vbGQgPSAoCiAgICAvLyAgICAgICAgIHVzZXIubGFzdF9wcmljZS5uYXRpdmUKICAgIC8vICAgICAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgZWxzZSBuZXdfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBwcmljZV9mb3JfbmV3ID0gbmV3X21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vIAogICAgLy8gICAgIG9sZF92YWx1ZSA9IChvbGRfYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgbmV3X3ZhbHVlID0gKG5ld19ib3Jyb3dfYW1vdW50ICogcHJpY2VfZm9yX25ldykgLy8gU0NBTEUKICAgIC8vICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgICAgIHVzZXJfaWQsCiAgICAvLyAgICAgICAgIG1hcmtldF9pZCwKICAgIC8vICAgICAgICAgb2xkX3ZhbHVlLCAgIyBvbGQgVVNEIHZhbHVlCiAgICAvLyAgICAgICAgIG5ld192YWx1ZSwgICMgbmV3IFVTRCB2YWx1ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gICAgICMgYXJjNC5lbWl0KAogICAgLy8gICAgICMgICAgIE1hcmtldFJlcGF5KAogICAgLy8gICAgICMgICAgICAgICB1c2VyPWFyYzQuQWRkcmVzcyh1c2VyX2lkKSwKICAgIC8vICAgICAjICAgICAgICAgbWFya2V0X2lkPWFyYzQuVUludDY0KG1hcmtldF9pZCksCiAgICAvLyAgICAgIyAgICAgICAgIGFtb3VudD1hcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICAgICAjICAgICApCiAgICAvLyAgICAgIyApCiAgICAvLyAKICAgIC8vICMgbWludC9yZWRlZW0gcmVsYXRlZCBjb2RlCiAgICAvLyAKICAgIC8vICMgQGFyYzQuYWJpbWV0aG9kCiAgICAvLyAjIGRlZiByZWRlZW0oc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAjICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAjICAgICBzZWxmLl9yZWRlZW0obWFya2V0X2lkLm5hdGl2ZSwgYW1vdW50Lm5hdGl2ZSkKICAgIC8vIAogICAgLy8gIyBAc3Vicm91dGluZQogICAgLy8gIyBkZWYgX3JlZGVlbShzZWxmLCBtYXJrZXRfaWQ6IFVJbnQ2NCwgYW1vdW50OiBCaWdVSW50KSAtPiBOb25lOgogICAgLy8gIyAgICAgc2VsZi5fdmFsaWRhdGVfbWFya2V0X29wZXJhdGlvbihtYXJrZXRfaWQsIGFtb3VudCwgVHJ1ZSkKICAgIC8vIAogICAgLy8gIyAgICAgYXNzZXJ0IG5vdCBzZWxmLl9oYXNfcG9zaXRpb24oCiAgICAvLyAjICAgICAgICAgVHhuLnNlbmRlciwgbWFya2V0X2lkCiAgICAvLyAjICAgICApLCAiQ2Fubm90IG1pbnQvcmVkZWVtIHdoZW4gdXNlciBoYXMgdHJhY2tlZCBkZXBvc2l0IHBvc2l0aW9uIgogICAgLy8gCiAgICAvLyAjICAgICBtYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QobWFya2V0X2lkKQogICAgLy8gCiAgICAvLyAjICAgICBhcmM0LmFiaV9jYWxsKAogICAgLy8gIyAgICAgICAgIE5Ub2tlbi5idXJuX2Zyb20sCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKFR4bi5zZW5kZXIpLAogICAgLy8gIyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gIyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vICMgICAgIHNjYWxlZF9hbW91bnQgPSAoYW1vdW50ICogU0NBTEUpIC8vIG1hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgLy8gIyAgICAgYXNzZXJ0ICgKICAgIC8vICMgICAgICAgICBtYXJrZXQudG90YWxfc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBzY2FsZWRfYW1vdW50CiAgICAvLyAjICAgICApLCAiSW5zdWZmaWNpZW50IG1hcmtldCBkZXBvc2l0cyB0byByZWRlZW0iCiAgICAvLyAjICAgICBzZWxmLl9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9kZXBvc2l0cyhtYXJrZXRfaWQsIHNjYWxlZF9hbW91bnQpCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyLAogICAgLy8gIyAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwKICAgIC8vICMgICAgICAgICBhcmM0LlVJbnQyNTYoYW1vdW50KSwKICAgIC8vICMgICAgICAgICBhcHBfaWQ9QXBwbGljYXRpb24obWFya2V0X2lkKSwKICAgIC8vICMgICAgICkKICAgIC8vIAogICAgLy8gIyBAYXJjNC5hYmltZXRob2QKICAgIC8vICMgZGVmIG1pbnQoc2VsZiwgbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwgYW1vdW50OiBhcmM0LlVJbnQyNTYpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl9taW50KG1hcmtldF9pZC5uYXRpdmUsIGFtb3VudC5uYXRpdmUpCiAgICAvLyAKICAgIC8vICMgQHN1YnJvdXRpbmUKICAgIC8vICMgZGVmIF9taW50KHNlbGYsIG1hcmtldF9pZDogVUludDY0LCBhbW91bnQ6IEJpZ1VJbnQpIC0+IE5vbmU6CiAgICAvLyAjICAgICBzZWxmLl92YWxpZGF0ZV9tYXJrZXRfb3BlcmF0aW9uKG1hcmtldF9pZCwgYW1vdW50LCBUcnVlKQogICAgLy8gCiAgICAvLyAjICAgICBhc3NlcnQgbm90IHNlbGYuX2hhc19wb3NpdGlvbigKICAgIC8vICMgICAgICAgICBUeG4uc2VuZGVyLCBtYXJrZXRfaWQKICAgIC8vICMgICAgICksICJDYW5ub3QgbWludC9yZWRlZW0gd2hlbiB1c2VyIGhhcyB0cmFja2VkIGRlcG9zaXQgcG9zaXRpb24iCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAjICAgICAgICAgQVJDMjAwVG9rZW5JbnRlcmZhY2UuYXJjMjAwX3RyYW5zZmVyRnJvbSwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksCiAgICAvLyAjICAgICAgICAgYXJjNC5BZGRyZXNzKEdsb2JhbC5jdXJyZW50X2FwcGxpY2F0aW9uX2FkZHJlc3MpLAogICAgLy8gIyAgICAgICAgIGFyYzQuVUludDI1NihhbW91bnQpLAogICAgLy8gIyAgICAgICAgIGFwcF9pZD1BcHBsaWNhdGlvbihtYXJrZXRfaWQpLAogICAgLy8gIyAgICAgKQogICAgLy8gCiAgICAvLyAjICAgICBuZXdfbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KAogICAgLy8gIyAgICAgICAgIG1hcmtldF9pZAogICAgLy8gIyAgICAgKSAgIyBHZXQgdXBkYXRlZCBtYXJrZXQgd2l0aCBhY2NydWVkIGludGVyZXN0CiAgICAvLyAjICAgICBzY2FsZWRfYW1vdW50ID0gKAogICAgLy8gIyAgICAgICAgIGFtb3VudCAqIFNDQUxFCiAgICAvLyAjICAgICApIC8vIG5ld19tYXJrZXQuZGVwb3NpdF9pbmRleC5uYXRpdmUgICMgQ2FsY3VsYXRlIHdpdGggbmV3IGluZGV4CiAgICAvLyAKICAgIC8vICMgICAgIGFzc2VydCAoCiAgICAvLyAjICAgICAgICAgbmV3X21hcmtldC5tYXhfdG90YWxfZGVwb3NpdHMubmF0aXZlCiAgICAvLyAjICAgICAgICAgPj0gbmV3X21hcmtldC50b3RhbF9zY2FsZWRfZGVwb3NpdHMubmF0aXZlICsgc2NhbGVkX2Ftb3VudAogICAgLy8gIyAgICAgKSwgIkRlcG9zaXQgY2FwIGV4Y2VlZGVkIgogICAgLy8gCiAgICAvLyAjICAgICAjIE9ubHkgaW5jcmVtZW50IG1hcmtldCB0b3RhbCBkZXBvc2l0cywgbm90IHVzZXIgZGVwb3NpdHMgc2luY2UgcG9zaXRpb24gaXMgbm90IHRyYWNrZWQKICAgIC8vICMgICAgIHNlbGYuX2luY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKG1hcmtldF9pZCwgc2NhbGVkX2Ftb3VudCkKICAgIC8vIAogICAgLy8gIyAgICAgYXJjNC5hYmlfY2FsbCgKICAgIC8vICMgICAgICAgICBOVG9rZW4ubWludCwKICAgIC8vICMgICAgICAgICBhcmM0LkFkZHJlc3MoVHhuLnNlbmRlciksCiAgICAvLyAjICAgICAgICAgYXJjNC5VSW50MjU2KGFtb3VudCksCiAgICAvLyAjICAgICAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG5ld19tYXJrZXQubnRva2VuX2lkLm5hdGl2ZSksCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vICMgICAgIGFyYzQuZW1pdCgKICAgIC8vICMgICAgICAgICBNaW50RXZlbnQoCiAgICAvLyAjICAgICAgICAgICAgIGFyYzQuQWRkcmVzcyhUeG4uc2VuZGVyKSwgYXJjNC5VSW50MjU2KGFtb3VudCksIGFyYzQuVUludDY0KG1hcmtldF9pZCkKICAgIC8vICMgICAgICAgICApCiAgICAvLyAjICAgICApCiAgICAvLyAKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHN5bmNfdXNlcl9tYXJrZXRfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICBzZWxmLCB1c2VyX2lkOiBhcmM0LkFkZHJlc3MsIG1hcmtldF9pZDogYXJjNC5VSW50NjQKICAgIC8vICkgLT4gTm9uZToKICAgIC8vICAgICBlbnN1cmVfYnVkZ2V0KDE0MDAsIE9wVXBGZWVTb3VyY2UuR3JvdXBDcmVkaXQpCiAgICAvLyAgICAgc2VsZi5fdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgICAgICB1c2VyX2lkLm5hdGl2ZSwgbWFya2V0X2lkLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdXBkYXRlX3VzZXJfZ2xvYmFsX3ZhbHVlc19mb3JfcHJpY2VfY2hhbmdlKAogICAgLy8gICAgIHNlbGYsIHVzZXJfaWQ6IEFjY291bnQsIG1hcmtldF9pZDogVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAKICAgIC8vICAgICB1c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgbWFya2V0X2lkKS5jb3B5KCkKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9kZXBvc2l0cyA9PSAwIGFuZCB1c2VyLnNjYWxlZF9ib3Jyb3dzID09IDA6CiAgICAvLyAgICAgICAgIHJldHVybgogICAgLy8gCiAgICAvLyAgICAgbWFya2V0ID0gc2VsZi5fYWNjcnVlX2ludGVyZXN0KG1hcmtldF9pZCkKICAgIC8vIAogICAgLy8gICAgIGlmIHVzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgICAgIGRlcG9zaXRfYW1vdW50ID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlICogbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgIyBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgaWYgdXNlciBkb2Vzbid0IGhhdmUgYSBwcmV2aW91cyBwcmljZQogICAgLy8gICAgICAgICBwcmljZV9mb3Jfb2xkID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgICAgIGVsc2UgbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIG9sZF9kZXBvc2l0X3ZhbHVlID0gKGRlcG9zaXRfYW1vdW50ICogcHJpY2VfZm9yX29sZCkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgbmV3X2RlcG9zaXRfdmFsdWUgPSAoZGVwb3NpdF9hbW91bnQgKiBtYXJrZXQucHJpY2UubmF0aXZlKSAvLyBTQ0FMRQogICAgLy8gICAgICAgICBzZWxmLl91cGRhdGVfZ2xvYmFsX2NvbGxhdGVyYWwoCiAgICAvLyAgICAgICAgICAgICB1c2VyX2lkLCBtYXJrZXRfaWQsIG9sZF9kZXBvc2l0X3ZhbHVlLCBuZXdfZGVwb3NpdF92YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICBpZiB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+IDA6CiAgICAvLyAgICAgICAgIGJvcnJvd19hbW91bnQgPSAoCiAgICAvLyAgICAgICAgICAgICB1c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAqIG1hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgICAgICkgLy8gU0NBTEUKICAgIC8vICAgICAgICAgIyBVc2UgY3VycmVudCBtYXJrZXQgcHJpY2UgaWYgdXNlciBkb2Vzbid0IGhhdmUgYSBwcmV2aW91cyBwcmljZQogICAgLy8gICAgICAgICBwcmljZV9mb3Jfb2xkID0gKAogICAgLy8gICAgICAgICAgICAgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZQogICAgLy8gICAgICAgICAgICAgaWYgdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSA+IDAKICAgIC8vICAgICAgICAgICAgIGVsc2UgbWFya2V0LnByaWNlLm5hdGl2ZQogICAgLy8gICAgICAgICApCiAgICAvLyAgICAgICAgIG9sZF9ib3Jyb3dfdmFsdWUgPSAoYm9ycm93X2Ftb3VudCAqIHByaWNlX2Zvcl9vbGQpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIG5ld19ib3Jyb3dfdmFsdWUgPSAoYm9ycm93X2Ftb3VudCAqIG1hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICAvLyAgICAgICAgIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICAgICAgICAgIHVzZXJfaWQsIG1hcmtldF9pZCwgb2xkX2JvcnJvd192YWx1ZSwgbmV3X2JvcnJvd192YWx1ZQogICAgLy8gICAgICAgICApCiAgICAvLyAKICAgIC8vICAgICB1c2VyX2tleSA9IHNlbGYuX2dldF91c2VyX2tleSh1c2VyX2lkLCBtYXJrZXRfaWQpCiAgICAvLyAgICAgdXNlci5sYXN0X3ByaWNlID0gbWFya2V0LnByaWNlCiAgICAvLyAgICAgc2VsZi51c2Vyc1t1c2VyX2tleV0gPSB1c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBnZXRfZ2xvYmFsX3VzZXIoc2VsZiwgdXNlcl9pZDogYXJjNC5BZGRyZXNzKSAtPiBHbG9iYWxVc2VyRGF0YToKICAgIC8vICAgICByZXR1cm4gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQubmF0aXZlKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9nZXRfZ2xvYmFsX3VzZXIoc2VsZiwgdXNlcl9pZDogQWNjb3VudCkgLT4gR2xvYmFsVXNlckRhdGE6CiAgICAvLyAgICAgaWYgdXNlcl9pZCBpbiBzZWxmLmdsb2JhbF91c2VyczoKICAgIC8vICAgICAgICAgcmV0dXJuIHNlbGYuZ2xvYmFsX3VzZXJzW3VzZXJfaWRdCiAgICAvLyAgICAgZWxzZToKICAgIC8vICAgICAgICAgYm94X3N0b3JhZ2VfYXBwX2lkID0gQm94KGFyYzQuVUludDY0LCBrZXk9Qk9YX0tFWV9TVE9SQUdFX0FQUF9JRCkKICAgIC8vICAgICAgICAgYXBwID0gQXBwbGljYXRpb24oYm94X3N0b3JhZ2VfYXBwX2lkLnZhbHVlLm5hdGl2ZSkKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIsIHR4biA9IGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgICAgICAgICBMZW5kaW5nUG9vbFN0b3JhZ2UuZ2V0X2dsb2JhbF91c2VyX2RlZmF1bHQsIGFwcF9pZD1hcHAKICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICByZXR1cm4gZ2xvYmFsX3VzZXIKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgdXNlcl9pZDogQWNjb3VudCwKICAgIC8vICAgICBtYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBvbGRfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyAgICAgbmV3X3ZhbHVlOiBCaWdVSW50LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICAvLyAKICAgIC8vICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlID0gYXJjNC5VSW50MjU2KAogICAgLy8gICAgICAgICBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZSAtIG9sZF92YWx1ZSArIG5ld192YWx1ZQogICAgLy8gICAgICkKICAgIC8vICAgICBnbG9iYWxfdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXSA9IGdsb2JhbF91c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF91cGRhdGVfZ2xvYmFsX2JvcnJvd3MoCiAgICAvLyAgICAgc2VsZiwKICAgIC8vICAgICB1c2VyX2lkOiBBY2NvdW50LAogICAgLy8gICAgIG1hcmtldF9pZDogVUludDY0LAogICAgLy8gICAgIG9sZF92YWx1ZTogQmlnVUludCwKICAgIC8vICAgICBuZXdfdmFsdWU6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgZ2xvYmFsX3VzZXIgPSBzZWxmLl9nZXRfZ2xvYmFsX3VzZXIodXNlcl9pZCkKICAgIC8vIAogICAgLy8gICAgIGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZSA9IGFyYzQuVUludDI1NigKICAgIC8vICAgICAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSAtIG9sZF92YWx1ZSArIG5ld192YWx1ZQogICAgLy8gICAgICkKICAgIC8vICAgICBnbG9iYWxfdXNlci5sYXN0X3VwZGF0ZV90aW1lID0gYXJjNC5VSW50NjQoR2xvYmFsLmxhdGVzdF90aW1lc3RhbXApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLmdsb2JhbF91c2Vyc1t1c2VyX2lkXSA9IGdsb2JhbF91c2VyLmNvcHkoKQogICAgLy8gCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBsaXF1aWRhdGVfY3Jvc3NfbWFya2V0KAogICAgLy8gICAgIHNlbGYsCiAgICAvLyAgICAgZGVidF9tYXJrZXRfaWQ6IGFyYzQuVUludDY0LAogICAgLy8gICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkOiBhcmM0LlVJbnQ2NCwKICAgIC8vICAgICB1c2VyOiBhcmM0LkFkZHJlc3MsCiAgICAvLyAgICAgZGVidF9hbW91bnQ6IGFyYzQuVUludDI1NiwKICAgIC8vICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogYXJjNC5VSW50MjU2LAogICAgLy8gKSAtPiBOb25lOgogICAgLy8gICAgIGVuc3VyZV9idWRnZXQoNDkwMCwgT3BVcEZlZVNvdXJjZS5Hcm91cENyZWRpdCkKICAgIC8vICAgICBhc3NlcnQgbm90IHNlbGYuX2lzX3BhdXNlZCgpLCAiUHJvdG9jb2wgaXMgcGF1c2VkIgogICAgLy8gCiAgICAvLyAgICAgIyBTeW5jIGdsb2JhbCB1c2VyIHZhbHVlcyBmb3IgYm90aCBtYXJrZXRzIHRvIGluY2x1ZGUgYWNjcnVlZCBpbnRlcmVzdAogICAgLy8gICAgIHNlbGYuX3VwZGF0ZV91c2VyX2dsb2JhbF92YWx1ZXNfZm9yX3ByaWNlX2NoYW5nZSgKICAgIC8vICAgICAgICAgdXNlci5uYXRpdmUsIGRlYnRfbWFya2V0X2lkLm5hdGl2ZQogICAgLy8gICAgICkKICAgIC8vICAgICBzZWxmLl91cGRhdGVfdXNlcl9nbG9iYWxfdmFsdWVzX2Zvcl9wcmljZV9jaGFuZ2UoCiAgICAvLyAgICAgICAgIHVzZXIubmF0aXZlLCBjb2xsYXRlcmFsX21hcmtldF9pZC5uYXRpdmUKICAgIC8vICAgICApCiAgICAvLyAKICAgIC8vICAgICBzZWxmLl9saXF1aWRhdGVfY3Jvc3NfbWFya2V0KAogICAgLy8gICAgICAgICBkZWJ0X21hcmtldF9pZC5uYXRpdmUsCiAgICAvLyAgICAgICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkLm5hdGl2ZSwKICAgIC8vICAgICAgICAgVHhuLnNlbmRlciwKICAgIC8vICAgICAgICAgdXNlci5uYXRpdmUsCiAgICAvLyAgICAgICAgIGRlYnRfYW1vdW50Lm5hdGl2ZSwKICAgIC8vICAgICAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQubmF0aXZlLAogICAgLy8gICAgICkKICAgIC8vIAogICAgLy8gQHN1YnJvdXRpbmUKICAgIC8vIGRlZiBfbGlxdWlkYXRlX2Nyb3NzX21hcmtldCgKICAgIC8vICAgICBzZWxmLAogICAgLy8gICAgIGRlYnRfbWFya2V0X2lkOiBVSW50NjQsCiAgICAvLyAgICAgY29sbGF0ZXJhbF9tYXJrZXRfaWQ6IFVJbnQ2NCwKICAgIC8vICAgICBsaXF1aWRhdG9yX2lkOiBBY2NvdW50LAogICAgLy8gICAgIHVzZXJfaWQ6IEFjY291bnQsCiAgICAvLyAgICAgZGVidF9hbW91bnQ6IEJpZ1VJbnQsCiAgICAvLyAgICAgbWluX2NvbGxhdGVyYWxfcmVjZWl2ZWQ6IEJpZ1VJbnQsCiAgICAvLyApIC0+IE5vbmU6CiAgICAvLyAgICAgIiIiCiAgICAvLyAgICAgTGlxdWlkYXRlIGEgdXNlcidzIHVuZGVyY29sbGF0ZXJhbGl6ZWQgcG9zaXRpb24gYWNyb3NzIGRpZmZlcmVudCBtYXJrZXRzLgogICAgLy8gCiAgICAvLyAgICAgVGhpcyBtZXRob2QgYWxsb3dzIGEgbGlxdWlkYXRvciB0byByZXBheSBhIHBvcnRpb24gb2YgYSB1c2VyJ3MgZGVidCBpbiBvbmUgbWFya2V0CiAgICAvLyAgICAgYW5kIHJlY2VpdmUgY29sbGF0ZXJhbCBmcm9tIGFub3RoZXIgbWFya2V0IGFzIGNvbXBlbnNhdGlvbi4gVGhlIGxpcXVpZGF0aW9uIGluY2x1ZGVzCiAgICAvLyAgICAgYSBib251cyB0byBpbmNlbnRpdml6ZSBsaXF1aWRhdG9ycyBhbmQgaGVscHMgbWFpbnRhaW4gcHJvdG9jb2wgaGVhbHRoIGJ5IHJlbW92aW5nCiAgICAvLyAgICAgdW5kZXJjb2xsYXRlcmFsaXplZCBwb3NpdGlvbnMuCiAgICAvLyAKICAgIC8vICAgICBBcmdzOgogICAgLy8gICAgICAgICBkZWJ0X21hcmtldF9pZDogVGhlIG1hcmtldCBJRCB3aGVyZSB0aGUgZGVidCB0byBiZSByZXBhaWQgZXhpc3RzCiAgICAvLyAgICAgICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkOiBUaGUgbWFya2V0IElEIHdoZXJlIGNvbGxhdGVyYWwgd2lsbCBiZSBzZWl6ZWQgZnJvbQogICAgLy8gICAgICAgICBsaXF1aWRhdG9yX2lkOiBUaGUgYWNjb3VudCBwZXJmb3JtaW5nIHRoZSBsaXF1aWRhdGlvbgogICAgLy8gICAgICAgICB1c2VyX2lkOiBUaGUgYWNjb3VudCBiZWluZyBsaXF1aWRhdGVkCiAgICAvLyAgICAgICAgIGRlYnRfYW1vdW50OiBUaGUgYW1vdW50IG9mIGRlYnQgdG8gcmVwYXkgKG11c3QgaW5jbHVkZSBhY2NydWVkIGludGVyZXN0KQogICAgLy8gICAgICAgICBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZDogTWluaW11bSBjb2xsYXRlcmFsIGFtb3VudCB0aGUgbGlxdWlkYXRvciBleHBlY3RzIHRvIHJlY2VpdmUKICAgIC8vIAogICAgLy8gICAgIFJhaXNlczoKICAgIC8vICAgICAgICAgQXNzZXJ0aW9uRXJyb3I6IElmIGFueSB2YWxpZGF0aW9uIGZhaWxzLCBpbmNsdWRpbmc6CiAgICAvLyAgICAgICAgICAgICAtIFVzaW5nIHN0b2tlbiBtYXJrZXQgYXMgY29sbGF0ZXJhbCAoYm9ycm93LW9ubHkgbWFya2V0KQogICAgLy8gICAgICAgICAgICAgLSBBdHRlbXB0aW5nIHNlbGYtbGlxdWlkYXRpb24KICAgIC8vICAgICAgICAgICAgIC0gTWFya2V0IGRvZXNuJ3QgZXhpc3Qgb3IgaXMgcGF1c2VkCiAgICAvLyAgICAgICAgICAgICAtIFBvc2l0aW9uIGlzIG5vdCBsaXF1aWRhdGFibGUgKGhlYWx0aCBmYWN0b3IgPj0gMS4wKQogICAgLy8gICAgICAgICAgICAgLSBMaXF1aWRhdGlvbiBhbW91bnQgZXhjZWVkcyBtYXhpbXVtIGFsbG93ZWQgb3IgdG90YWwgZGVidAogICAgLy8gICAgICAgICAgICAgLSBJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCB0byBzZWl6ZQogICAgLy8gICAgICAgICAgICAgLSBDb2xsYXRlcmFsIHJlY2VpdmVkIGJlbG93IG1pbmltdW0gdGhyZXNob2xkCiAgICAvLyAKICAgIC8vICAgICBOb3RlczoKICAgIC8vICAgICAgICAgLSBVc2VzIHRoZSBjb2xsYXRlcmFsIG1hcmtldCdzIGxpcXVpZGF0aW9uIHRocmVzaG9sZCBmb3IgaGVhbHRoIGNhbGN1bGF0aW9uCiAgICAvLyAgICAgICAgIC0gTGlxdWlkYXRpb24gYm9udXMgaXMgYXBwbGllZCB0byBpbmNlbnRpdml6ZSBsaXF1aWRhdG9ycwogICAgLy8gICAgICAgICAtIEFjY3J1ZWQgaW50ZXJlc3Qgb24gYm90aCBkZWJ0IGFuZCBjb2xsYXRlcmFsIHBvc2l0aW9ucyBpcyBpbmNsdWRlZAogICAgLy8gICAgICAgICAtIEhhbmRsZXMgZGlmZmVyZW50IHRva2VuIHR5cGVzIChBUkMyMDAgdnMgU1Rva2VuKSBhcHByb3ByaWF0ZWx5CiAgICAvLyAgICAgICAgIC0gVXBkYXRlcyBnbG9iYWwgYm9ycm93IGFuZCBjb2xsYXRlcmFsIHZhbHVlcyBmb3IgdGhlIHVzZXIKICAgIC8vICAgICAiIiIKICAgIC8vIAogICAgLy8gICAgICMgREYtQVVELTA5OiBWYWxpZGF0ZSB0cmFuc2FjdGlvbiBjYXAgZm9yIGxpcXVpZGF0ZSBvcGVyYXRpb24KICAgIC8vICAgICBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwID0gc2VsZi5fZ2V0X21hcmtldF90cmFuc2FjdGlvbl9jYXAoCiAgICAvLyAgICAgICAgIGRlYnRfbWFya2V0X2lkCiAgICAvLyAgICAgKS5saXF1aWRhdGUubmF0aXZlCiAgICAvLyAgICAgaWYgbWFya2V0X3RyYW5zYWN0aW9uX2NhcCA+IDA6CiAgICAvLyAgICAgICAgIGFzc2VydCBkZWJ0X2Ftb3VudCA8PSBtYXJrZXRfdHJhbnNhY3Rpb25fY2FwLCAiTGlxdWlkYXRlIGNhcCBleGNlZWRlZCIKICAgIC8vIAogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gICAgICMgUkVNIHByZXZlbnQgdXNpbmcgc3Rva2VuIG1hcmtldCBhcyBjb2xsYXRlcmFsIGluIGxpcXVpZGF0aW9uIGJlY2F1c2Ugc3Rva2VuCiAgICAvLyAgICAgIyBSRU0gbWFya2V0IGNvbGxhdGVyYWwgZG9lcyBub3QgZXhpc3QKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICBhc3NlcnQgKAogICAgLy8gICAgICAgICBjb2xsYXRlcmFsX21hcmtldF9pZCAhPSBzZWxmLnN0b2tlbl9hcHBfaWQKICAgIC8vICAgICApLCAiQ2Fubm90IHVzZSBzdG9rZW4gbWFya2V0IGFzIGNvbGxhdGVyYWwgKGJvcnJvdy1vbmx5IG1hcmtldCkiCiAgICAvLyAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAKICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICAjIFJFTSBwcmV2ZW50IHNlbGYgbGlxdWlkYXRpb24KICAgIC8vICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICAgICBhc3NlcnQgdXNlcl9pZCAhPSBsaXF1aWRhdG9yX2lkLCAiQ2Fubm90IGxpcXVpZGF0ZSBzZWxmIgogICAgLy8gICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gCiAgICAvLyAgICAgYXNzZXJ0IGRlYnRfbWFya2V0X2lkIGluIHNlbGYubWFya2V0cywgIkRlYnQgbWFya2V0IGRvZXMgbm90IGV4aXN0IgogICAgLy8gICAgIGFzc2VydCBjb2xsYXRlcmFsX21hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJDb2xsYXRlcmFsIG1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIHN3YXAKICAgIGNvbmNhdAogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MDcKICAgIC8vIGFzc2VydCBjb2xsYXRlcmFsX21hcmtldF9pZCBpbiBzZWxmLm1hcmtldHMsICJDb2xsYXRlcmFsIG1hcmtldCBkb2VzIG5vdCBleGlzdCIKICAgIGFzc2VydCAvLyBDb2xsYXRlcmFsIG1hcmtldCBkb2VzIG5vdCBleGlzdAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTA4CiAgICAvLyBhc3NlcnQgZGVidF9hbW91bnQgPiAwLCAiRGVidCBhbW91bnQgbXVzdCBiZSA+IDAiCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ5dGUgMHgKICAgIGI+CiAgICBhc3NlcnQgLy8gRGVidCBhbW91bnQgbXVzdCBiZSA+IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUxMAogICAgLy8gZGVidF9tYXJrZXQgPSBzZWxmLl9nZXRfbWFya2V0KGRlYnRfbWFya2V0X2lkKQogICAgZnJhbWVfZGlnIC02CiAgICBjYWxsc3ViIF9nZXRfbWFya2V0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MTEKICAgIC8vIGNvbGxhdGVyYWxfbWFya2V0ID0gc2VsZi5fZ2V0X21hcmtldChjb2xsYXRlcmFsX21hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtNQogICAgY2FsbHN1YiBfZ2V0X21hcmtldAogICAgc3dhcAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTEzCiAgICAvLyBkZWJ0X3VzZXIgPSBzZWxmLl9nZXRfdXNlcih1c2VyX2lkLCBkZWJ0X21hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC02CiAgICBjYWxsc3ViIF9nZXRfdXNlcgogICAgZHVwCiAgICBjb3ZlciAzCiAgICBmcmFtZV9idXJ5IDIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUxNAogICAgLy8gY29sbGF0ZXJhbF91c2VyID0gc2VsZi5fZ2V0X3VzZXIodXNlcl9pZCwgY29sbGF0ZXJhbF9tYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtNQogICAgY2FsbHN1YiBfZ2V0X3VzZXIKICAgIGZyYW1lX2J1cnkgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTE2CiAgICAvLyBhc3NlcnQgbm90IGRlYnRfbWFya2V0LnBhdXNlZCwgIkRlYnQgbWFya2V0IGlzIHBhdXNlZCIKICAgIGludCAwCiAgICBnZXRiaXQKICAgIGJ5dGUgMHgwMAogICAgaW50IDAKICAgIHVuY292ZXIgMgogICAgc2V0Yml0CiAgICBieXRlIDB4MDAKICAgID09CiAgICBhc3NlcnQgLy8gRGVidCBtYXJrZXQgaXMgcGF1c2VkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MTcKICAgIC8vIGFzc2VydCBub3QgY29sbGF0ZXJhbF9tYXJrZXQucGF1c2VkLCAiQ29sbGF0ZXJhbCBtYXJrZXQgaXMgcGF1c2VkIgogICAgZHVwCiAgICBpbnQgMAogICAgZ2V0Yml0CiAgICBieXRlIDB4MDAKICAgIGludCAwCiAgICB1bmNvdmVyIDIKICAgIHNldGJpdAogICAgYnl0ZSAweDAwCiAgICA9PQogICAgYXNzZXJ0IC8vIENvbGxhdGVyYWwgbWFya2V0IGlzIHBhdXNlZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTE5CiAgICAvLyBuZXdfZGVidF9tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QoZGVidF9tYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTYKICAgIGNhbGxzdWIgX2FjY3J1ZV9pbnRlcmVzdAogICAgY292ZXIgMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTIwCiAgICAvLyBuZXdfY29sbGF0ZXJhbF9tYXJrZXQgPSBzZWxmLl9hY2NydWVfaW50ZXJlc3QoY29sbGF0ZXJhbF9tYXJrZXRfaWQpCiAgICBmcmFtZV9kaWcgLTUKICAgIGNhbGxzdWIgX2FjY3J1ZV9pbnRlcmVzdAogICAgZHVwCiAgICBjb3ZlciA0CiAgICBmcmFtZV9idXJ5IDMKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUyMi0yNTI1CiAgICAvLyAjIENhbGN1bGF0ZSBlYXJuZWQgaW50ZXJlc3Qgb24gY29sbGF0ZXJhbCBwb3NpdGlvbgogICAgLy8gY29sbGF0ZXJhbF9pbnRlcmVzdCA9IHNlbGYuX2NhbGN1bGF0ZV91c2VyX2ludGVyZXN0KAogICAgLy8gICAgIHVzZXJfaWQsIGNvbGxhdGVyYWxfbWFya2V0X2lkCiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTMKICAgIGZyYW1lX2RpZyAtNQogICAgY2FsbHN1YiBfY2FsY3VsYXRlX3VzZXJfaW50ZXJlc3QKICAgIGNvdmVyIDQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjUyNy0yNTI4CiAgICAvLyAjIENhbGN1bGF0ZSB1c2VyJ3MgY3VycmVudCBkZWJ0IGludGVyZXN0CiAgICAvLyBkZWJ0X2ludGVyZXN0ID0gc2VsZi5fY2FsY3VsYXRlX3VzZXJfZGVidF9pbnRlcmVzdCh1c2VyX2lkLCBkZWJ0X21hcmtldF9pZCkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC02CiAgICBjYWxsc3ViIF9jYWxjdWxhdGVfdXNlcl9kZWJ0X2ludGVyZXN0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MzAtMjUzMQogICAgLy8gIyBDYWxjdWxhdGUgdG90YWwgZGVidCBpbmNsdWRpbmcgaW50ZXJlc3QKICAgIC8vIHRvdGFsX2RlYnQgPSBkZWJ0X3VzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICsgZGVidF9pbnRlcmVzdAogICAgdW5jb3ZlciAyCiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDcKICAgIGR1cAogICAgZGlnIDIKICAgIGIrCiAgICBzd2FwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1MzMKICAgIC8vIGdsb2JhbF91c2VyID0gc2VsZi5fZ2V0X2dsb2JhbF91c2VyKHVzZXJfaWQpCiAgICBmcmFtZV9kaWcgLTMKICAgIGNhbGxzdWIgX2dldF9nbG9iYWxfdXNlcgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTM1CiAgICAvLyBnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlID4gMAogICAgZHVwCiAgICBleHRyYWN0IDMyIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBieXRlIDB4CiAgICBiPgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTM0LTI1MzYKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfYm9ycm93X3ZhbHVlLm5hdGl2ZSA+IDAKICAgIC8vICksICJVc2VyIGhhcyBubyBkZWJ0IHRvIGxpcXVpZGF0ZSIKICAgIGFzc2VydCAvLyBVc2VyIGhhcyBubyBkZWJ0IHRvIGxpcXVpZGF0ZQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTM4LTI1NDcKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIyBSRU0gdXNlcyBtaW4gb2YgdGhlIHR3byBtYXJrZXRzJyBsaXF1aWRhdGlvbiB0aHJlc2hvbGRzCiAgICAvLyAjIFJFTSBjb252ZW50aW9uYWxseSB3ZSB1c2UgdGhlIGNvbGxhdGVyYWwgbWFya2V0J3MgbGlxdWlkYXRpb24gdGhyZXNob2xkCiAgICAvLyAjIGxpcXVpZGF0aW9uX3RocmVzaG9sZCA9IHNlbGYuX21pbjY0KAogICAgLy8gIyAgICAgZGVidF9tYXJrZXQubGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZSwKICAgIC8vICMgICAgIGNvbGxhdGVyYWxfbWFya2V0LmxpcXVpZGF0aW9uX3RocmVzaG9sZC5uYXRpdmUsCiAgICAvLyAjICkKICAgIC8vICMgUkVNIHVzaW5nIGNhbGF0ZXJhbCBtYXJrZXQncyBsaXF1aWRhdGlvbiB0aHJlc2hvbGQgZm9yIGhlYWx0aCBjYWxjdWxhdGlvbgogICAgLy8gIyBSRU0gaXQgaXMgdGhlIG5vcm0gZm9yIGxpcXVpZGF0aW9uIHRocmVzaG9sZAogICAgLy8gbGlxdWlkYXRpb25fdGhyZXNob2xkID0gY29sbGF0ZXJhbF9tYXJrZXQubGlxdWlkYXRpb25fdGhyZXNob2xkLm5hdGl2ZQogICAgdW5jb3ZlciA1CiAgICBleHRyYWN0IDgxIDggLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBidG9pCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NTEKICAgIC8vIGdsb2JhbF91c2VyLnRvdGFsX2NvbGxhdGVyYWxfdmFsdWUubmF0aXZlCiAgICB1bmNvdmVyIDIKICAgIGV4dHJhY3QgMCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU1MgogICAgLy8gKiBCaWdVSW50KGxpcXVpZGF0aW9uX3RocmVzaG9sZCkKICAgIGl0b2IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU1MS0yNTUyCiAgICAvLyBnbG9iYWxfdXNlci50b3RhbF9jb2xsYXRlcmFsX3ZhbHVlLm5hdGl2ZQogICAgLy8gKiBCaWdVSW50KGxpcXVpZGF0aW9uX3RocmVzaG9sZCkKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NTMKICAgIC8vICogQmlnVUludCgxMDAwMCkKICAgIGJ5dGUgMHgyNzEwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NTEtMjU1MwogICAgLy8gZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICogQmlnVUludChsaXF1aWRhdGlvbl90aHJlc2hvbGQpCiAgICAvLyAqIEJpZ1VJbnQoMTAwMDApCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTU0CiAgICAvLyApIC8vIChnbG9iYWxfdXNlci50b3RhbF9ib3Jyb3dfdmFsdWUubmF0aXZlICogQmlnVUludCgxMDAwMCkpCiAgICBzd2FwCiAgICBieXRlIDB4MjcxMAogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU1MC0yNTU0CiAgICAvLyBoZWFsdGggPSAoCiAgICAvLyAgICAgZ2xvYmFsX3VzZXIudG90YWxfY29sbGF0ZXJhbF92YWx1ZS5uYXRpdmUKICAgIC8vICAgICAqIEJpZ1VJbnQobGlxdWlkYXRpb25fdGhyZXNob2xkKQogICAgLy8gICAgICogQmlnVUludCgxMDAwMCkKICAgIC8vICkgLy8gKGdsb2JhbF91c2VyLnRvdGFsX2JvcnJvd192YWx1ZS5uYXRpdmUgKiBCaWdVSW50KDEwMDAwKSkKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NTUKICAgIC8vIGFzc2VydCBoZWFsdGggPCAxMDAwMCwgIlBvc2l0aW9uIGlzIG5vdCBsaXF1aWRhdGFibGUiCiAgICBieXRlIDB4MjcxMAogICAgYjwKICAgIGFzc2VydCAvLyBQb3NpdGlvbiBpcyBub3QgbGlxdWlkYXRhYmxlCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1NTkKICAgIC8vIGRlYnRfdmFsdWUgKiBCaWdVSW50KG5ld19kZWJ0X21hcmtldC5jbG9zZV9mYWN0b3IubmF0aXZlKQogICAgZGlnIDMKICAgIGludCAzMjEKICAgIGludCA4CiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ0b2kKICAgIGl0b2IKICAgIGRpZyAyCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTYwCiAgICAvLyApIC8vIEJpZ1VJbnQoMTAwMDApCiAgICBieXRlIDB4MjcxMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTU4LTI1NjAKICAgIC8vIG1heF9saXF1aWRhdGFibGUgPSAoCiAgICAvLyAgICAgZGVidF92YWx1ZSAqIEJpZ1VJbnQobmV3X2RlYnRfbWFya2V0LmNsb3NlX2ZhY3Rvci5uYXRpdmUpCiAgICAvLyApIC8vIEJpZ1VJbnQoMTAwMDApCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTYyCiAgICAvLyBkZWJ0X2Ftb3VudCA8PSBtYXhfbGlxdWlkYXRhYmxlCiAgICBmcmFtZV9kaWcgLTIKICAgIGI+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTYxLTI1NjMKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgZGVidF9hbW91bnQgPD0gbWF4X2xpcXVpZGF0YWJsZQogICAgLy8gKSwgIkFtb3VudCBleGNlZWRzIG1heGltdW0gbGlxdWlkYXRhYmxlIGFtb3VudCIKICAgIGFzc2VydCAvLyBBbW91bnQgZXhjZWVkcyBtYXhpbXVtIGxpcXVpZGF0YWJsZSBhbW91bnQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU2NS0yNTY2CiAgICAvLyAjIFZhbGlkYXRlIGxpcXVpZGF0aW9uIGFtb3VudCBkb2Vzbid0IGV4Y2VlZCB0b3RhbCBkZWJ0CiAgICAvLyBhc3NlcnQgZGVidF9hbW91bnQgPD0gdG90YWxfZGVidCwgIkxpcXVpZGF0aW9uIGFtb3VudCBleGNlZWRzIHRvdGFsIGRlYnQiCiAgICBmcmFtZV9kaWcgLTIKICAgIHVuY292ZXIgMgogICAgYjw9CiAgICBhc3NlcnQgLy8gTGlxdWlkYXRpb24gYW1vdW50IGV4Y2VlZHMgdG90YWwgZGVidAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTcwCiAgICAvLyBkZWJ0X2Ftb3VudCA+PSBkZWJ0X2ludGVyZXN0CiAgICBmcmFtZV9kaWcgLTIKICAgIGRpZyAyCiAgICBiPj0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU2OC0yNTcxCiAgICAvLyAjIFJlcXVpcmUgbWluaW11bSBsaXF1aWRhdGlvbiBvZiBhdCBsZWFzdCB0aGUgZGVidCBpbnRlcmVzdAogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBkZWJ0X2Ftb3VudCA+PSBkZWJ0X2ludGVyZXN0CiAgICAvLyApLCAiTGlxdWlkYXRpb24gYW1vdW50IG11c3QgYmUgYXQgbGVhc3QgdGhlIGFjY3J1ZWQgaW50ZXJlc3QiCiAgICBhc3NlcnQgLy8gTGlxdWlkYXRpb24gYW1vdW50IG11c3QgYmUgYXQgbGVhc3QgdGhlIGFjY3J1ZWQgaW50ZXJlc3QKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU3My0yNTc0CiAgICAvLyAjIENhbGN1bGF0ZSBob3cgbXVjaCBnb2VzIHRvd2FyZCBwcmluY2lwYWwgcmVwYXltZW50CiAgICAvLyBwcmluY2lwYWxfcmVwYXltZW50ID0gZGVidF9hbW91bnQgLSBkZWJ0X2ludGVyZXN0CiAgICBmcmFtZV9kaWcgLTIKICAgIHVuY292ZXIgMgogICAgYi0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU3OAogICAgLy8gcHJpbmNpcGFsX3JlcGF5bWVudCAqIFNDQUxFCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU3OQogICAgLy8gKSAvLyBuZXdfZGVidF9tYXJrZXQuYm9ycm93X2luZGV4Lm5hdGl2ZQogICAgZGlnIDIKICAgIGV4dHJhY3QgMjA5IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDgKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU3Ni0yNTc5CiAgICAvLyAjIENhbGN1bGF0ZSBzY2FsZWQgYW1vdW50IGZvciBwcmluY2lwYWwgcmVwYXltZW50IG9ubHkKICAgIC8vIHNjYWxlZF9yZXBheV9hbW91bnQgPSAoCiAgICAvLyAgICAgcHJpbmNpcGFsX3JlcGF5bWVudCAqIFNDQUxFCiAgICAvLyApIC8vIG5ld19kZWJ0X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICBiLwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU4MQogICAgLy8gZGVidF91c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSA+PSBzY2FsZWRfcmVwYXlfYW1vdW50CiAgICBiPj0KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU4MC0yNTgyCiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIGRlYnRfdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgPj0gc2NhbGVkX3JlcGF5X2Ftb3VudAogICAgLy8gKSwgIlByaW5jaXBhbCByZXBheW1lbnQgZXhjZWVkcyBkZWJ0IgogICAgYXNzZXJ0IC8vIFByaW5jaXBhbCByZXBheW1lbnQgZXhjZWVkcyBkZWJ0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1ODQKICAgIC8vIGRlYnRfdXNkX3ZhbHVlID0gKGRlYnRfYW1vdW50ICogbmV3X2RlYnRfbWFya2V0LnByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIGludCAyODEKICAgIGludCAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgOQogICAgZnJhbWVfZGlnIC0yCiAgICBiKgogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1ODcKICAgIC8vIGRlYnRfdXNkX3ZhbHVlICogQmlnVUludChuZXdfY29sbGF0ZXJhbF9tYXJrZXQubGlxdWlkYXRpb25fYm9udXMubmF0aXZlKQogICAgZGlnIDEKICAgIGV4dHJhY3QgNjUgOCAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ0b2kKICAgIGl0b2IKICAgIGRpZyAxCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTg4CiAgICAvLyApIC8vIEJpZ1VJbnQoMTAwMDApCiAgICBieXRlIDB4MjcxMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTg2LTI1ODgKICAgIC8vIGJvbnVzX3VzZF92YWx1ZSA9ICgKICAgIC8vICAgICBkZWJ0X3VzZF92YWx1ZSAqIEJpZ1VJbnQobmV3X2NvbGxhdGVyYWxfbWFya2V0LmxpcXVpZGF0aW9uX2JvbnVzLm5hdGl2ZSkKICAgIC8vICkgLy8gQmlnVUludCgxMDAwMCkKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI1ODkKICAgIC8vIGNvbGxhdGVyYWxfdXNkX3ZhbHVlID0gZGVidF91c2RfdmFsdWUgKyBib251c191c2RfdmFsdWUKICAgIGIrCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTkyCiAgICAvLyBjb2xsYXRlcmFsX3VzZF92YWx1ZSAqIFNDQUxFCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYioKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU5MwogICAgLy8gKSAvLyBuZXdfY29sbGF0ZXJhbF9tYXJrZXQucHJpY2UubmF0aXZlCiAgICBkaWcgMQogICAgaW50IDI4MQogICAgaW50IDMyCiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTkxLTI1OTMKICAgIC8vIGNvbGxhdGVyYWxfYW1vdW50ID0gKAogICAgLy8gICAgIGNvbGxhdGVyYWxfdXNkX3ZhbHVlICogU0NBTEUKICAgIC8vICkgLy8gbmV3X2NvbGxhdGVyYWxfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU5NS0yNTk2CiAgICAvLyAjIEFkZCBlYXJuZWQgaW50ZXJlc3QgdG8gY29sbGF0ZXJhbCBhbW91bnQgZm9yIGxpcXVpZGF0b3IKICAgIC8vIHRvdGFsX2NvbGxhdGVyYWxfYW1vdW50ID0gY29sbGF0ZXJhbF9hbW91bnQgKyBjb2xsYXRlcmFsX2ludGVyZXN0CiAgICB1bmNvdmVyIDIKICAgIGIrCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMTQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjU5OQogICAgLy8gdG90YWxfY29sbGF0ZXJhbF9hbW91bnQgKiBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MDAKICAgIC8vICkgLy8gbmV3X2NvbGxhdGVyYWxfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICBzd2FwCiAgICBleHRyYWN0IDE3NyAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNTk4LTI2MDAKICAgIC8vIHNjYWxlZF9jb2xsYXRlcmFsX2Ftb3VudCA9ICgKICAgIC8vICAgICB0b3RhbF9jb2xsYXRlcmFsX2Ftb3VudCAqIFNDQUxFCiAgICAvLyApIC8vIG5ld19jb2xsYXRlcmFsX21hcmtldC5kZXBvc2l0X2luZGV4Lm5hdGl2ZQogICAgYi8KICAgIGZyYW1lX2J1cnkgNQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjAyLTI2MDMKICAgIC8vICMgREYtQVVELTA5OiBWYWxpZGF0ZSB1c2VyIGNhcCBmb3IgY29sbGF0ZXJhbCBvcGVyYXRpb24KICAgIC8vIHVzZXJfY2FwID0gc2VsZi5fZ2V0X3VzZXJfY2FwKGxpcXVpZGF0b3JfaWQpCiAgICBmcmFtZV9kaWcgLTQKICAgIGNhbGxzdWIgX2dldF91c2VyX2NhcAogICAgZHVwCiAgICBmcmFtZV9idXJ5IDE1CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MDQKICAgIC8vIGlmIHVzZXJfY2FwLmRhaWx5X3Jlc2V0X3RpbWUgPT0gMDoKICAgIGV4dHJhY3QgMTkyIDggLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgNAogICAgYnl0ZSAweDAwMDAwMDAwMDAwMDAwMDAKICAgIGI9PQogICAgYnogX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfZWxzZV9ib2R5QDQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjYwNQogICAgLy8gdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wICsgODY0MDApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpbnQgODY0MDAKICAgICsKICAgIGl0b2IKICAgIGZyYW1lX2RpZyAxNQogICAgc3dhcAogICAgcmVwbGFjZTIgMTkyCiAgICBmcmFtZV9idXJ5IDE1CiAgICBiIF9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X2FmdGVyX2lmX2Vsc2VANwoKX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfZWxzZV9ib2R5QDQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MDYKICAgIC8vIGVsaWYgdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA8IEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wOgogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgaXRvYgogICAgZnJhbWVfZGlnIDQKICAgIGI+CiAgICBmcmFtZV9kaWcgMTUKICAgIGZyYW1lX2J1cnkgMTYKICAgIGJ6IF9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X2FmdGVyX2lmX2Vsc2VANgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjA3CiAgICAvLyB1c2VyX2NhcC50b3RhbF93aXRoZHJhd2FscyA9IGFyYzQuVUludDI1NigwKQogICAgZnJhbWVfZGlnIDE1CiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAogICAgcmVwbGFjZTIgOTYKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjYwOAogICAgLy8gdXNlcl9jYXAudG90YWxfbGlxdWlkYXRpb25zID0gYXJjNC5VSW50MjU2KDApCiAgICBieXRlIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAogICAgcmVwbGFjZTIgNjQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjYwOQogICAgLy8gdXNlcl9jYXAuZGFpbHlfcmVzZXRfdGltZSA9IGFyYzQuVUludDY0KEdsb2JhbC5sYXRlc3RfdGltZXN0YW1wICsgODY0MDApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpbnQgODY0MDAKICAgICsKICAgIGl0b2IKICAgIHJlcGxhY2UyIDE5MgogICAgZnJhbWVfYnVyeSAxNgoKX2xpcXVpZGF0ZV9jcm9zc19tYXJrZXRfYWZ0ZXJfaWZfZWxzZUA2OgogICAgZnJhbWVfZGlnIDE2CiAgICBmcmFtZV9idXJ5IDE1CgpfbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9hZnRlcl9pZl9lbHNlQDc6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MTAKICAgIC8vIGlmIHVzZXJfY2FwLmRhaWx5X2xpcXVpZGF0aW9ucy5uYXRpdmUgPiAwOgogICAgZnJhbWVfZGlnIDE1CiAgICBleHRyYWN0IDEyOCAzMiAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSAxMgogICAgYnl0ZSAweAogICAgYj4KICAgIGJ6IF9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X2FmdGVyX2lmX2Vsc2VAOQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjEyCiAgICAvLyB1c2VyX2NhcC50b3RhbF9saXF1aWRhdGlvbnMubmF0aXZlICsgY29sbGF0ZXJhbF91c2RfdmFsdWUKICAgIGZyYW1lX2RpZyAxNQogICAgZHVwCiAgICBleHRyYWN0IDY0IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjExLTI2MTMKICAgIC8vIG5ld190b3RhbF9saXF1aWRhdGlvbnMgPSAoCiAgICAvLyAgICAgdXNlcl9jYXAudG90YWxfbGlxdWlkYXRpb25zLm5hdGl2ZSArIGNvbGxhdGVyYWxfdXNkX3ZhbHVlCiAgICAvLyApCiAgICBmcmFtZV9kaWcgMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjEyCiAgICAvLyB1c2VyX2NhcC50b3RhbF9saXF1aWRhdGlvbnMubmF0aXZlICsgY29sbGF0ZXJhbF91c2RfdmFsdWUKICAgIGIrCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MTUKICAgIC8vIG5ld190b3RhbF9saXF1aWRhdGlvbnMgPD0gdXNlcl9jYXAuZGFpbHlfbGlxdWlkYXRpb25zLm5hdGl2ZQogICAgZHVwCiAgICBmcmFtZV9kaWcgMTIKICAgIGI8PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjE0LTI2MTYKICAgIC8vIGFzc2VydCAoCiAgICAvLyAgICAgbmV3X3RvdGFsX2xpcXVpZGF0aW9ucyA8PSB1c2VyX2NhcC5kYWlseV9saXF1aWRhdGlvbnMubmF0aXZlCiAgICAvLyApLCAiVXNlciBjb2xsYXRlcmFsIGNhcCBleGNlZWRlZCIKICAgIGFzc2VydCAvLyBVc2VyIGNvbGxhdGVyYWwgY2FwIGV4Y2VlZGVkCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MTcKICAgIC8vIHVzZXJfY2FwLnRvdGFsX2xpcXVpZGF0aW9ucyA9IGFyYzQuVUludDI1NihuZXdfdG90YWxfbGlxdWlkYXRpb25zKQogICAgZHVwCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgYnwKICAgIHJlcGxhY2UyIDY0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MTgKICAgIC8vIHNlbGYuX3NldF91c2VyX2NhcChsaXF1aWRhdG9yX2lkLCB1c2VyX2NhcCkKICAgIGZyYW1lX2RpZyAtNAogICAgc3dhcAogICAgY2FsbHN1YiBfc2V0X3VzZXJfY2FwCiAgICBwb3AKCl9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X2FmdGVyX2lmX2Vsc2VAOToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjYyMQogICAgLy8gY29sbGF0ZXJhbF91c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUgPj0gc2NhbGVkX2NvbGxhdGVyYWxfYW1vdW50CiAgICBmcmFtZV9kaWcgMQogICAgZXh0cmFjdCAwIDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEzCiAgICBmcmFtZV9kaWcgNQogICAgYj49CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MjAtMjYyMgogICAgLy8gYXNzZXJ0ICgKICAgIC8vICAgICBjb2xsYXRlcmFsX3VzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSA+PSBzY2FsZWRfY29sbGF0ZXJhbF9hbW91bnQKICAgIC8vICksICJJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCB0byBzZWl6ZSIKICAgIGFzc2VydCAvLyBJbnN1ZmZpY2llbnQgY29sbGF0ZXJhbCB0byBzZWl6ZQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjI4CiAgICAvLyB0b3RhbF9jb2xsYXRlcmFsX2Ftb3VudCA+PSBtaW5fY29sbGF0ZXJhbF9yZWNlaXZlZAogICAgZnJhbWVfZGlnIDE0CiAgICBmcmFtZV9kaWcgLTEKICAgIGI+PQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjI0LTI2MjkKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIyBSRU0gY29sbGF0ZXJhbCBhbW91bnQgc2xpcHBhZ2UgcHJvdGVjdGlvbgogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyBhc3NlcnQgKAogICAgLy8gICAgIHRvdGFsX2NvbGxhdGVyYWxfYW1vdW50ID49IG1pbl9jb2xsYXRlcmFsX3JlY2VpdmVkCiAgICAvLyApLCAiSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgcmVjZWl2ZWQiCiAgICBhc3NlcnQgLy8gSW5zdWZmaWNpZW50IGNvbGxhdGVyYWwgcmVjZWl2ZWQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjYzMC0yNjM5CiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICMKICAgIC8vICMgQk9SUk9XIEhBTkRMSU5HCiAgICAvLyAjCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICMgUkVNIGxpcXVpZGF0b3IgcmVwYXlzIGRlYnQKICAgIC8vICMgUkVNIHRyYW5zZmVyIGRlYnQgZnJvbSBsaXF1aWRhdG9yIHRvIHRoZSBwcm90b2NvbAogICAgLy8gIyBSRU0gZGlmZmVyZW50IGZvciBzdG9rZW4gYW5kIHJlZ3VsYXIgbWFya2V0CiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIGlmIGRlYnRfbWFya2V0X2lkID09IHNlbGYuc3Rva2VuX2FwcF9pZDoKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMTgKICAgIC8vIHNlbGYuc3Rva2VuX2FwcF9pZCA9IFVJbnQ2NCgpICAjIHN0YWJsZSBtYXJrZXQKICAgIGJ5dGUgInN0b2tlbl9hcHBfaWQiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2MzAtMjYzOQogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjCiAgICAvLyAjIEJPUlJPVyBIQU5ETElORwogICAgLy8gIwogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjIFJFTSBsaXF1aWRhdG9yIHJlcGF5cyBkZWJ0CiAgICAvLyAjIFJFTSB0cmFuc2ZlciBkZWJ0IGZyb20gbGlxdWlkYXRvciB0byB0aGUgcHJvdG9jb2wKICAgIC8vICMgUkVNIGRpZmZlcmVudCBmb3Igc3Rva2VuIGFuZCByZWd1bGFyIG1hcmtldAogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyBpZiBkZWJ0X21hcmtldF9pZCA9PSBzZWxmLnN0b2tlbl9hcHBfaWQ6CiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIHNlbGYuc3Rva2VuX2FwcF9pZCBleGlzdHMKICAgIGZyYW1lX2RpZyAtNgogICAgPT0KICAgIGJ6IF9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X2Vsc2VfYm9keUAxMgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjQwLTI2NDUKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgU1Rva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3MobGlxdWlkYXRvcl9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGRlYnRfYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24oZGVidF9tYXJrZXRfaWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjQzCiAgICAvLyBhcmM0LlVJbnQyNTYoZGVidF9hbW91bnQpLAogICAgZnJhbWVfZGlnIC0yCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgZnJhbWVfZGlnIC0yCiAgICBifAogICAgZnJhbWVfZGlnIC02CiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY0MC0yNjQ1CiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIFNUb2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKGxpcXVpZGF0b3JfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1NihkZWJ0X2Ftb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKGRlYnRfbWFya2V0X2lkKSwKICAgIC8vICkKICAgIG1ldGhvZCAiYnVybl9mcm9tKGFkZHJlc3MsdWludDI1Nil2b2lkIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGZyYW1lX2RpZyAtNAogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBpbnQgYXBwbAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50IDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICBpdHhuX3N1Ym1pdAogICAgYiBfbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9hZnRlcl9pZl9lbHNlQDE0CgpfbGlxdWlkYXRlX2Nyb3NzX21hcmtldF9lbHNlX2JvZHlAMTI6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NDctMjY1MwogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXJGcm9tLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyhsaXF1aWRhdG9yX2lkKSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KGRlYnRfYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24oZGVidF9tYXJrZXRfaWQpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjUwCiAgICAvLyBhcmM0LkFkZHJlc3MoR2xvYmFsLmN1cnJlbnRfYXBwbGljYXRpb25fYWRkcmVzcyksCiAgICBnbG9iYWwgQ3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjUxCiAgICAvLyBhcmM0LlVJbnQyNTYoZGVidF9hbW91bnQpLAogICAgZnJhbWVfZGlnIC0yCiAgICBsZW4KICAgIGludCAzMgogICAgPD0KICAgIGFzc2VydCAvLyBvdmVyZmxvdwogICAgaW50IDMyCiAgICBiemVybwogICAgZnJhbWVfZGlnIC0yCiAgICBifAogICAgZnJhbWVfZGlnIC02CiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uSUQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY0Ny0yNjUzCiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIEFSQzIwMFRva2VuSW50ZXJmYWNlLmFyYzIwMF90cmFuc2ZlckZyb20sCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKGxpcXVpZGF0b3JfaWQpLAogICAgLy8gICAgIGFyYzQuQWRkcmVzcyhHbG9iYWwuY3VycmVudF9hcHBsaWNhdGlvbl9hZGRyZXNzKSwKICAgIC8vICAgICBhcmM0LlVJbnQyNTYoZGVidF9hbW91bnQpLAogICAgLy8gICAgIGFwcF9pZD1BcHBsaWNhdGlvbihkZWJ0X21hcmtldF9pZCksCiAgICAvLyApCiAgICBtZXRob2QgImFyYzIwMF90cmFuc2ZlckZyb20oYWRkcmVzcyxhZGRyZXNzLHVpbnQyNTYpYm9vbCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTQKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBzd2FwCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICBpdHhuIExhc3RMb2cKICAgIGV4dHJhY3QgMCA0CiAgICBieXRlIDB4MTUxZjdjNzUKICAgID09CiAgICBhc3NlcnQgLy8gQVJDNCBwcmVmaXggaXMgdmFsaWQKCl9saXF1aWRhdGVfY3Jvc3NfbWFya2V0X2FmdGVyX2lmX2Vsc2VAMTQ6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NTYtMjY1OAogICAgLy8gc2VsZi5fZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzKAogICAgLy8gICAgIGRlYnRfbWFya2V0X2lkLCB1c2VyX2lkLCBzY2FsZWRfcmVwYXlfYW1vdW50CiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTYKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIDYKICAgIGR1cAogICAgY292ZXIgMwogICAgY2FsbHN1YiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9ib3Jyb3dzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NTkKICAgIC8vIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2JvcnJvd3MoZGVidF9tYXJrZXRfaWQsIHNjYWxlZF9yZXBheV9hbW91bnQpCiAgICBmcmFtZV9kaWcgLTYKICAgIGRpZyAxCiAgICBjYWxsc3ViIF9kZWNyZW1lbnRfbWFya2V0X3RvdGFsX3NjYWxlZF9ib3Jyb3dzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NjEtMjY3MwogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjCiAgICAvLyAjIENPTExBVEVSQUwgSEFORExJTkcKICAgIC8vICMKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIyBidXJuIHRoZSBjb2xsYXRlcmFsIHRva2VuCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIGFyYzQuYWJpX2NhbGwoCiAgICAvLyAgICAgTlRva2VuLmJ1cm5fZnJvbSwKICAgIC8vICAgICBhcmM0LkFkZHJlc3ModXNlcl9pZCksCiAgICAvLyAgICAgYXJjNC5VSW50MjU2KHRvdGFsX2NvbGxhdGVyYWxfYW1vdW50KSwKICAgIC8vICAgICBhcHBfaWQ9QXBwbGljYXRpb24obmV3X2NvbGxhdGVyYWxfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgLy8gKQogICAgaXR4bl9iZWdpbgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjcxCiAgICAvLyBhcmM0LlVJbnQyNTYodG90YWxfY29sbGF0ZXJhbF9hbW91bnQpLAogICAgZnJhbWVfZGlnIDE0CiAgICBkdXAKICAgIGxlbgogICAgaW50IDMyCiAgICA8PQogICAgYXNzZXJ0IC8vIG92ZXJmbG93CiAgICBpbnQgMzIKICAgIGJ6ZXJvCiAgICBifAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjcyCiAgICAvLyBhcHBfaWQ9QXBwbGljYXRpb24obmV3X2NvbGxhdGVyYWxfbWFya2V0Lm50b2tlbl9pZC5uYXRpdmUpLAogICAgZnJhbWVfZGlnIDMKICAgIGludCAzMTMKICAgIGludCA4CiAgICBleHRyYWN0MyAvLyBvbiBlcnJvcjogSW5kZXggYWNjZXNzIGlzIG91dCBvZiBib3VuZHMKICAgIGJ0b2kKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25JRAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjYxLTI2NzMKICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgLy8gIwogICAgLy8gIyBDT0xMQVRFUkFMIEhBTkRMSU5HCiAgICAvLyAjCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vICMgYnVybiB0aGUgY29sbGF0ZXJhbCB0b2tlbgogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyBhcmM0LmFiaV9jYWxsKAogICAgLy8gICAgIE5Ub2tlbi5idXJuX2Zyb20sCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKHVzZXJfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1Nih0b3RhbF9jb2xsYXRlcmFsX2Ftb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKG5ld19jb2xsYXRlcmFsX21hcmtldC5udG9rZW5faWQubmF0aXZlKSwKICAgIC8vICkKICAgIG1ldGhvZCAiYnVybl9mcm9tKGFkZHJlc3MsdWludDI1Nil2b2lkIgogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGZyYW1lX2RpZyAtMwogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGR1cAogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbkFyZ3MKICAgIGludCBhcHBsCiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnQgMAogICAgaXR4bl9maWVsZCBGZWUKICAgIGl0eG5fc3VibWl0CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2NzYtMjY3OAogICAgLy8gc2VsZi5fZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cygKICAgIC8vICAgICBjb2xsYXRlcmFsX21hcmtldF9pZCwgdXNlcl9pZCwgc2NhbGVkX2NvbGxhdGVyYWxfYW1vdW50CiAgICAvLyApCiAgICBmcmFtZV9kaWcgLTUKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIDUKICAgIGR1cAogICAgY292ZXIgMwogICAgY2FsbHN1YiBfZGVjcmVtZW50X21hcmtldF91c2VyX3NjYWxlZF9kZXBvc2l0cwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjc5LTI2ODEKICAgIC8vIHNlbGYuX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzKAogICAgLy8gICAgIGNvbGxhdGVyYWxfbWFya2V0X2lkLCBzY2FsZWRfY29sbGF0ZXJhbF9hbW91bnQKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtNQogICAgZGlnIDEKICAgIGNhbGxzdWIgX2RlY3JlbWVudF9tYXJrZXRfdG90YWxfc2NhbGVkX2RlcG9zaXRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI2ODMtMjY4OAogICAgLy8gYXJjNC5hYmlfY2FsbCgKICAgIC8vICAgICBBUkMyMDBUb2tlbkludGVyZmFjZS5hcmMyMDBfdHJhbnNmZXIsCiAgICAvLyAgICAgYXJjNC5BZGRyZXNzKGxpcXVpZGF0b3JfaWQpLAogICAgLy8gICAgIGFyYzQuVUludDI1Nih0b3RhbF9jb2xsYXRlcmFsX2Ftb3VudCksCiAgICAvLyAgICAgYXBwX2lkPUFwcGxpY2F0aW9uKGNvbGxhdGVyYWxfbWFya2V0X2lkKSwKICAgIC8vICkKICAgIGl0eG5fYmVnaW4KICAgIGZyYW1lX2RpZyAtNQogICAgaXR4bl9maWVsZCBBcHBsaWNhdGlvbklECiAgICBtZXRob2QgImFyYzIwMF90cmFuc2ZlcihhZGRyZXNzLHVpbnQyNTYpYm9vbCIKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBmcmFtZV9kaWcgLTQKICAgIGl0eG5fZmllbGQgQXBwbGljYXRpb25BcmdzCiAgICBzd2FwCiAgICBpdHhuX2ZpZWxkIEFwcGxpY2F0aW9uQXJncwogICAgaW50IGFwcGwKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIGludCAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgaXR4bl9zdWJtaXQKICAgIGl0eG4gTGFzdExvZwogICAgZXh0cmFjdCAwIDQKICAgIGJ5dGUgMHgxNTFmN2M3NQogICAgPT0KICAgIGFzc2VydCAvLyBBUkM0IHByZWZpeCBpcyB2YWxpZAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjkxCiAgICAvLyBkZWJ0X3VzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogZGVidF91c2VyLmJvcnJvd19pbmRleC5uYXRpdmUgLy8gU0NBTEUKICAgIGZyYW1lX2RpZyAyCiAgICBkdXAKICAgIGV4dHJhY3QgOTYgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBmcmFtZV9kaWcgNwogICAgZHVwCiAgICB1bmNvdmVyIDIKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY5MC0yNjkyCiAgICAvLyBvbGRfYm9ycm93X2Ftb3VudCA9ICgKICAgIC8vICAgICBkZWJ0X3VzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlICogZGVidF91c2VyLmJvcnJvd19pbmRleC5uYXRpdmUgLy8gU0NBTEUKICAgIC8vICkKICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY5NAogICAgLy8gKGRlYnRfdXNlci5zY2FsZWRfYm9ycm93cy5uYXRpdmUgLSBzY2FsZWRfcmVwYXlfYW1vdW50KQogICAgdW5jb3ZlciA0CiAgICBiLQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjk0LTI2OTUKICAgIC8vIChkZWJ0X3VzZXIuc2NhbGVkX2JvcnJvd3MubmF0aXZlIC0gc2NhbGVkX3JlcGF5X2Ftb3VudCkKICAgIC8vICogbmV3X2RlYnRfbWFya2V0LmJvcnJvd19pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyA4CiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNjk2CiAgICAvLyAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY5NC0yNjk2CiAgICAvLyAoZGVidF91c2VyLnNjYWxlZF9ib3Jyb3dzLm5hdGl2ZSAtIHNjYWxlZF9yZXBheV9hbW91bnQpCiAgICAvLyAqIG5ld19kZWJ0X21hcmtldC5ib3Jyb3dfaW5kZXgubmF0aXZlCiAgICAvLyAvLyBTQ0FMRQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY5OAogICAgLy8gb2xkX2JvcnJvd192YWx1ZSA9IChvbGRfYm9ycm93X2Ftb3VudCAqIGRlYnRfdXNlci5sYXN0X3ByaWNlLm5hdGl2ZSkgLy8gU0NBTEUKICAgIHVuY292ZXIgMgogICAgZXh0cmFjdCAxMzYgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICB1bmNvdmVyIDIKICAgIGIqCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjY5OQogICAgLy8gbmV3X2JvcnJvd192YWx1ZSA9IChuZXdfYm9ycm93X2Ftb3VudCAqIG5ld19kZWJ0X21hcmtldC5wcmljZS5uYXRpdmUpIC8vIFNDQUxFCiAgICBzd2FwCiAgICBmcmFtZV9kaWcgOQogICAgYioKICAgIGJ5dGUgMHgwZGUwYjZiM2E3NjQwMDAwCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzAwLTI3MDIKICAgIC8vIHNlbGYuX3VwZGF0ZV9nbG9iYWxfYm9ycm93cygKICAgIC8vICAgICB1c2VyX2lkLCBkZWJ0X21hcmtldF9pZCwgb2xkX2JvcnJvd192YWx1ZSwgbmV3X2JvcnJvd192YWx1ZQogICAgLy8gKQogICAgZnJhbWVfZGlnIC0zCiAgICBmcmFtZV9kaWcgLTYKICAgIHVuY292ZXIgMwogICAgdW5jb3ZlciAzCiAgICBjYWxsc3ViIF91cGRhdGVfZ2xvYmFsX2JvcnJvd3MKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjcwNgogICAgLy8gKiBjb2xsYXRlcmFsX3VzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIGZyYW1lX2RpZyAxCiAgICBkdXAKICAgIGV4dHJhY3QgNjQgMzIgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3MDUtMjcwNgogICAgLy8gY29sbGF0ZXJhbF91c2VyLnNjYWxlZF9kZXBvc2l0cy5uYXRpdmUKICAgIC8vICogY29sbGF0ZXJhbF91c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICBmcmFtZV9kaWcgMTMKICAgIGR1cAogICAgdW5jb3ZlciAyCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzA3CiAgICAvLyAvLyBTQ0FMRQogICAgYnl0ZSAweDBkZTBiNmIzYTc2NDAwMDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjcwNS0yNzA3CiAgICAvLyBjb2xsYXRlcmFsX3VzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gKiBjb2xsYXRlcmFsX3VzZXIuZGVwb3NpdF9pbmRleC5uYXRpdmUKICAgIC8vIC8vIFNDQUxFCiAgICBiLwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzA0LTI3MDgKICAgIC8vIG9sZF9kZXBvc2l0X2Ftb3VudCA9ICgKICAgIC8vICAgICBjb2xsYXRlcmFsX3VzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZQogICAgLy8gICAgICogY29sbGF0ZXJhbF91c2VyLmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAgICAgLy8gU0NBTEUKICAgIC8vICkKICAgIHN3YXAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjcxMAogICAgLy8gKGNvbGxhdGVyYWxfdXNlci5zY2FsZWRfZGVwb3NpdHMubmF0aXZlIC0gc2NhbGVkX2NvbGxhdGVyYWxfYW1vdW50KQogICAgdW5jb3ZlciAzCiAgICBiLQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzEwLTI3MTEKICAgIC8vIChjb2xsYXRlcmFsX3VzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIHNjYWxlZF9jb2xsYXRlcmFsX2Ftb3VudCkKICAgIC8vICogbmV3X2NvbGxhdGVyYWxfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICBmcmFtZV9kaWcgMTEKICAgIGIqCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3MTIKICAgIC8vIC8vIFNDQUxFCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzEwLTI3MTIKICAgIC8vIChjb2xsYXRlcmFsX3VzZXIuc2NhbGVkX2RlcG9zaXRzLm5hdGl2ZSAtIHNjYWxlZF9jb2xsYXRlcmFsX2Ftb3VudCkKICAgIC8vICogbmV3X2NvbGxhdGVyYWxfbWFya2V0LmRlcG9zaXRfaW5kZXgubmF0aXZlCiAgICAvLyAvLyBTQ0FMRQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjcxNQogICAgLy8gb2xkX2RlcG9zaXRfYW1vdW50ICogY29sbGF0ZXJhbF91c2VyLmxhc3RfcHJpY2UubmF0aXZlCiAgICB1bmNvdmVyIDIKICAgIGV4dHJhY3QgMTM2IDMyIC8vIG9uIGVycm9yOiBJbmRleCBhY2Nlc3MgaXMgb3V0IG9mIGJvdW5kcwogICAgdW5jb3ZlciAyCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzE2CiAgICAvLyApIC8vIFNDQUxFCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzE0LTI3MTYKICAgIC8vIG9sZF9kZXBvc2l0X3ZhbHVlID0gKAogICAgLy8gICAgIG9sZF9kZXBvc2l0X2Ftb3VudCAqIGNvbGxhdGVyYWxfdXNlci5sYXN0X3ByaWNlLm5hdGl2ZQogICAgLy8gKSAvLyBTQ0FMRQogICAgYi8KICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MjcxOAogICAgLy8gbmV3X2RlcG9zaXRfYW1vdW50ICogbmV3X2NvbGxhdGVyYWxfbWFya2V0LnByaWNlLm5hdGl2ZQogICAgc3dhcAogICAgZnJhbWVfZGlnIDEwCiAgICBiKgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzE5CiAgICAvLyApIC8vIFNDQUxFCiAgICBieXRlIDB4MGRlMGI2YjNhNzY0MDAwMAogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToyNzE3LTI3MTkKICAgIC8vIG5ld19kZXBvc2l0X3ZhbHVlID0gKAogICAgLy8gICAgIG5ld19kZXBvc2l0X2Ftb3VudCAqIG5ld19jb2xsYXRlcmFsX21hcmtldC5wcmljZS5uYXRpdmUKICAgIC8vICkgLy8gU0NBTEUKICAgIGIvCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjI3MjEtMjcyMwogICAgLy8gc2VsZi5fdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsKAogICAgLy8gICAgIHVzZXJfaWQsIGNvbGxhdGVyYWxfbWFya2V0X2lkLCBvbGRfZGVwb3NpdF92YWx1ZSwgbmV3X2RlcG9zaXRfdmFsdWUKICAgIC8vICkKICAgIGZyYW1lX2RpZyAtMwogICAgZnJhbWVfZGlnIC01CiAgICB1bmNvdmVyIDMKICAgIHVuY292ZXIgMwogICAgY2FsbHN1YiBfdXBkYXRlX2dsb2JhbF9jb2xsYXRlcmFsCiAgICByZXRzdWIKCgovLyBjb250cmFjdC5VcGdyYWRlYWJsZS5zZXRfdmVyc2lvbihjb250cmFjdF92ZXJzaW9uOiBieXRlcywgZGVwbG95bWVudF92ZXJzaW9uOiBieXRlcykgLT4gdm9pZDoKc2V0X3ZlcnNpb246CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE0NC0xNDcKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIHNldF92ZXJzaW9uKAogICAgLy8gICAgIHNlbGYsIGNvbnRyYWN0X3ZlcnNpb246IGFyYzQuVUludDY0LCBkZXBsb3ltZW50X3ZlcnNpb246IGFyYzQuVUludDY0CiAgICAvLyApIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ4CiAgICAvLyBhcmM0LmVtaXQoVmVyc2lvblVwZGF0ZWQoY29udHJhY3RfdmVyc2lvbiwgZGVwbG95bWVudF92ZXJzaW9uKSkKICAgIGZyYW1lX2RpZyAtMgogICAgZnJhbWVfZGlnIC0xCiAgICBjb25jYXQKICAgIG1ldGhvZCAiVmVyc2lvblVwZGF0ZWQodWludDY0LHVpbnQ2NCkiCiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNDkKICAgIC8vIHNlbGYuY29udHJhY3RfdmVyc2lvbiA9IGNvbnRyYWN0X3ZlcnNpb24ubmF0aXZlCiAgICBmcmFtZV9kaWcgLTIKICAgIGJ0b2kKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAwCiAgICAvLyBzZWxmLmNvbnRyYWN0X3ZlcnNpb24gPSBVSW50NjQoKQogICAgYnl0ZSAiY29udHJhY3RfdmVyc2lvbiIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTQ5CiAgICAvLyBzZWxmLmNvbnRyYWN0X3ZlcnNpb24gPSBjb250cmFjdF92ZXJzaW9uLm5hdGl2ZQogICAgc3dhcAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUwCiAgICAvLyBzZWxmLmRlcGxveW1lbnRfdmVyc2lvbiA9IGRlcGxveW1lbnRfdmVyc2lvbi5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMQogICAgYnRvaQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDEKICAgIC8vIHNlbGYuZGVwbG95bWVudF92ZXJzaW9uID0gVUludDY0KCkKICAgIGJ5dGUgImRlcGxveW1lbnRfdmVyc2lvbiIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTUwCiAgICAvLyBzZWxmLmRlcGxveW1lbnRfdmVyc2lvbiA9IGRlcGxveW1lbnRfdmVyc2lvbi5uYXRpdmUKICAgIHN3YXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5VcGdyYWRlYWJsZS5ncmFudF91cGdyYWRlcih1cGdyYWRlcjogYnl0ZXMpIC0+IHZvaWQ6CmdyYW50X3VwZ3JhZGVyOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNjgtMTY5CiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBncmFudF91cGdyYWRlcihzZWxmLCB1cGdyYWRlcjogYXJjNC5BZGRyZXNzKSAtPiBOb25lOgogICAgcHJvdG8gMSAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE3MAogICAgLy8gYXNzZXJ0IFR4bi5zZW5kZXIgPT0gR2xvYmFsLmNyZWF0b3JfYWRkcmVzcywgIm11c3QgYmUgY3JlYXRvciIKICAgIHR4biBTZW5kZXIKICAgIGdsb2JhbCBDcmVhdG9yQWRkcmVzcwogICAgPT0KICAgIGFzc2VydCAvLyBtdXN0IGJlIGNyZWF0b3IKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcxCiAgICAvLyBhcmM0LmVtaXQoVXBncmFkZXJHcmFudGVkKGFyYzQuQWRkcmVzcyhzZWxmLnVwZ3JhZGVyKSwgdXBncmFkZXIpKQogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzCiAgICAvLyBzZWxmLnVwZ3JhZGVyID0gQWNjb3VudCgpCiAgICBieXRlICJ1cGdyYWRlciIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTcxCiAgICAvLyBhcmM0LmVtaXQoVXBncmFkZXJHcmFudGVkKGFyYzQuQWRkcmVzcyhzZWxmLnVwZ3JhZGVyKSwgdXBncmFkZXIpKQogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnVwZ3JhZGVyIGV4aXN0cwogICAgZnJhbWVfZGlnIC0xCiAgICBjb25jYXQKICAgIG1ldGhvZCAiVXBncmFkZXJHcmFudGVkKGFkZHJlc3MsYWRkcmVzcykiCiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxMDMKICAgIC8vIHNlbGYudXBncmFkZXIgPSBBY2NvdW50KCkKICAgIGJ5dGUgInVwZ3JhZGVyIgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weToxNzIKICAgIC8vIHNlbGYudXBncmFkZXIgPSB1cGdyYWRlci5uYXRpdmUKICAgIGZyYW1lX2RpZyAtMQogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkFjY2Vzc0NvbnRyb2wuc2V0X3JvbGUocm9sZTogYnl0ZXMsIGFsbG93OiBieXRlcykgLT4gdm9pZDoKc2V0X3JvbGU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjUyLTUzCiAgICAvLyBAYXJjNC5hYmltZXRob2QKICAgIC8vIGRlZiBzZXRfcm9sZShzZWxmLCByb2xlOiBCeXRlczMyLCBhbGxvdzogYXJjNC5Cb29sKSAtPiBOb25lOgogICAgcHJvdG8gMiAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjU0CiAgICAvLyBzZWxmLl9zZXRfcm9sZShyb2xlLmJ5dGVzLCBhbGxvdy5uYXRpdmUpCiAgICBmcmFtZV9kaWcgLTEKICAgIGludCAwCiAgICBnZXRiaXQKICAgIGZyYW1lX2RpZyAtMgogICAgc3dhcAogICAgY2FsbHN1YiBfc2V0X3JvbGUKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkFjY2Vzc0NvbnRyb2wuX3NldF9yb2xlKHJvbGU6IGJ5dGVzLCBhbGxvdzogdWludDY0KSAtPiB2b2lkOgpfc2V0X3JvbGU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjU2LTU3CiAgICAvLyBAc3Vicm91dGluZQogICAgLy8gZGVmIF9zZXRfcm9sZShzZWxmLCByb2xlOiBCeXRlcywgYWxsb3c6IGJvb2wpIC0+IE5vbmU6CiAgICBwcm90byAyIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NTAKICAgIC8vIHNlbGYuYWRkcmVzc19yb2xlcyA9IEJveE1hcChCeXRlczMyLCBib29sKQogICAgYnl0ZSAiYWRkcmVzc19yb2xlcyIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NTgKICAgIC8vIHNlbGYuYWRkcmVzc19yb2xlc1tCeXRlczMyLmZyb21fYnl0ZXMocm9sZSldID0gYWxsb3cKICAgIGZyYW1lX2RpZyAtMgogICAgY29uY2F0CiAgICBmcmFtZV9kaWcgLTEKICAgIGl0b2IKICAgIGJveF9wdXQKICAgIHJldHN1YgoKCi8vIGNvbnRyYWN0LkFjY2Vzc0NvbnRyb2wuaGFzX3JvbGUocm9sZTogYnl0ZXMpIC0+IGJ5dGVzOgpoYXNfcm9sZToKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6NjAtNjEKICAgIC8vIEBhcmM0LmFiaW1ldGhvZAogICAgLy8gZGVmIGhhc19yb2xlKHNlbGYsIHJvbGU6IEJ5dGVzMzIpIC0+IGFyYzQuQm9vbDoKICAgIHByb3RvIDEgMQogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTo2MgogICAgLy8gcmV0dXJuIGFyYzQuQm9vbChzZWxmLl9oYXNfcm9sZShyb2xlLmJ5dGVzKSkKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBfaGFzX3JvbGUKICAgIGJ5dGUgMHgwMAogICAgaW50IDAKICAgIHVuY292ZXIgMgogICAgc2V0Yml0CiAgICByZXRzdWIKCgovLyBjb250cmFjdC5VcGdyYWRlYWJsZS5vbl91cGRhdGUoKSAtPiB2b2lkOgpvbl91cGRhdGU6CiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1Mi0xNTMKICAgIC8vIEBhcmM0LmJhcmVtZXRob2QoYWxsb3dfYWN0aW9ucz1bIlVwZGF0ZUFwcGxpY2F0aW9uIl0pCiAgICAvLyBkZWYgb25fdXBkYXRlKHNlbGYpIC0+IE5vbmU6CiAgICBwcm90byAwIDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU0LTE1NwogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjIFdBUk5JTkc6IFRoaXMgYXBwIGNhbiBiZSB1cGRhdGVkIGJ5IHRoZSBjcmVhdG9yCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYudXBncmFkZXIsICJtdXN0IGJlIHVwZ3JhZGVyIgogICAgdHhuIFNlbmRlcgogICAgaW50IDAKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTAzCiAgICAvLyBzZWxmLnVwZ3JhZGVyID0gQWNjb3VudCgpCiAgICBieXRlICJ1cGdyYWRlciIKICAgIC8vIHNyYy9zcmMvY29udHJhY3QucHk6MTU0LTE1NwogICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAvLyAjIFdBUk5JTkc6IFRoaXMgYXBwIGNhbiBiZSB1cGRhdGVkIGJ5IHRoZSBjcmVhdG9yCiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIC8vIGFzc2VydCBUeG4uc2VuZGVyID09IHNlbGYudXBncmFkZXIsICJtdXN0IGJlIHVwZ3JhZGVyIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBzZWxmLnVwZ3JhZGVyIGV4aXN0cwogICAgPT0KICAgIGFzc2VydCAvLyBtdXN0IGJlIHVwZ3JhZGVyCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1OAogICAgLy8gYXNzZXJ0IHNlbGYudXBkYXRhYmxlID09IFVJbnQ2NCgxKSwgIm5vdCBhcHByb3ZlZCIKICAgIGludCAwCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjEwMgogICAgLy8gc2VsZi51cGRhdGFibGUgPSBib29sKDEpCiAgICBieXRlICJ1cGRhdGFibGUiCiAgICAvLyBzcmMvc3JjL2NvbnRyYWN0LnB5OjE1OAogICAgLy8gYXNzZXJ0IHNlbGYudXBkYXRhYmxlID09IFVJbnQ2NCgxKSwgIm5vdCBhcHByb3ZlZCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgc2VsZi51cGRhdGFibGUgZXhpc3RzCiAgICBpbnQgMQogICAgPT0KICAgIGFzc2VydCAvLyBub3QgYXBwcm92ZWQKICAgIHJldHN1Ygo=",
    "clear": "I3ByYWdtYSB2ZXJzaW9uIDEwCgpjb250cmFjdC5Eb3JrRmlMZW5kaW5nUG9vbC5jbGVhcl9zdGF0ZV9wcm9ncmFtOgogICAgLy8gc3JjL3NyYy9jb250cmFjdC5weTozMjI0CiAgICAvLyBjbGFzcyBEb3JrRmlMZW5kaW5nUG9vbChMZW5kaW5nUG9vbCwgVXBncmFkZWFibGUsIEFjY2Vzc0NvbnRyb2wpOgogICAgaW50IDEKICAgIHJldHVybgo="
  },
  "state": {
    "global": {
      "num_byte_slices": 2,
      "num_uints": 6
    },
    "local": {
      "num_byte_slices": 0,
      "num_uints": 0
    }
  },
  "schema": {
    "global": {
      "declared": {
        "contract_version": {
          "type": "uint64",
          "key": "contract_version"
        },
        "deployment_version": {
          "type": "uint64",
          "key": "deployment_version"
        },
        "owner": {
          "type": "bytes",
          "key": "owner"
        },
        "paused": {
          "type": "uint64",
          "key": "paused"
        },
        "seconds_per_year": {
          "type": "uint64",
          "key": "seconds_per_year"
        },
        "stoken_app_id": {
          "type": "uint64",
          "key": "stoken_app_id"
        },
        "updatable": {
          "type": "uint64",
          "key": "updatable"
        },
        "upgrader": {
          "type": "bytes",
          "key": "upgrader"
        }
      },
      "reserved": {}
    },
    "local": {
      "declared": {},
      "reserved": {}
    }
  },
  "contract": {
    "name": "DorkFiLendingPool",
    "methods": [
      {
        "name": "post_update",
        "args": [],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_role_key",
        "args": [
          {
            "type": "address",
            "name": "account"
          },
          {
            "type": "byte[3]",
            "name": "role"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "byte[32]"
        }
      },
      {
        "name": "set_market_price",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "price"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "set_market",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)",
            "name": "market_data"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "attach_price_feed",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "uint64",
            "name": "provider_app_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "detach_price_feed",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_owner",
        "args": [],
        "readonly": true,
        "returns": {
          "type": "address"
        }
      },
      {
        "name": "transfer_ownership",
        "args": [
          {
            "type": "address",
            "name": "new_owner"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "set_storage_app_id",
        "args": [
          {
            "type": "uint64",
            "name": "storage_app_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "is_paused",
        "args": [],
        "readonly": false,
        "returns": {
          "type": "bool"
        }
      },
      {
        "name": "pause",
        "args": [
          {
            "type": "uint64",
            "name": "pause"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "set_stoken_app_id",
        "args": [
          {
            "type": "uint64",
            "name": "stoken_app_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_user",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          },
          {
            "type": "uint64",
            "name": "market_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "(uint256,uint256,uint256,uint256,uint64,uint256)"
        }
      },
      {
        "name": "create_market",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "uint64",
            "name": "collateral_factor"
          },
          {
            "type": "uint64",
            "name": "liquidation_threshold"
          },
          {
            "type": "uint64",
            "name": "reserve_factor"
          },
          {
            "type": "uint64",
            "name": "borrow_rate"
          },
          {
            "type": "uint64",
            "name": "slope"
          },
          {
            "type": "uint256",
            "name": "max_total_deposits"
          },
          {
            "type": "uint256",
            "name": "max_total_borrows"
          },
          {
            "type": "uint64",
            "name": "liquidation_bonus"
          },
          {
            "type": "uint64",
            "name": "close_factor"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "uint64"
        }
      },
      {
        "name": "get_market",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": true,
        "returns": {
          "type": "(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)"
        }
      },
      {
        "name": "get_market_transaction_cap",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "(uint256,uint256,uint256,uint256)"
        }
      },
      {
        "name": "get_user_cap",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "(uint256,uint256,uint256,uint256,uint256,uint256,uint64)"
        }
      },
      {
        "name": "set_user_cap",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          },
          {
            "type": "(uint256,uint256,uint256,uint256,uint256,uint256,uint64)",
            "name": "user_cap"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "set_market_transaction_cap",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "(uint256,uint256,uint256,uint256)",
            "name": "transaction_cap"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_price_feed",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "(uint64,uint64,(uint256,uint64))"
        }
      },
      {
        "name": "fetch_price_feed",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "pause_market",
        "args": [
          {
            "type": "uint64",
            "name": "token_id"
          },
          {
            "type": "uint64",
            "name": "pause"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "sync_market",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "withdraw_reserves",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "deposit",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "withdraw",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "uint256"
        }
      },
      {
        "name": "borrow",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "repay",
        "args": [
          {
            "type": "uint64",
            "name": "market_id"
          },
          {
            "type": "uint256",
            "name": "amount"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "sync_user_market_for_price_change",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          },
          {
            "type": "uint64",
            "name": "market_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "get_global_user",
        "args": [
          {
            "type": "address",
            "name": "user_id"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "(uint256,uint256,uint64)"
        }
      },
      {
        "name": "liquidate_cross_market",
        "args": [
          {
            "type": "uint64",
            "name": "debt_market_id"
          },
          {
            "type": "uint64",
            "name": "collateral_market_id"
          },
          {
            "type": "address",
            "name": "user"
          },
          {
            "type": "uint256",
            "name": "debt_amount"
          },
          {
            "type": "uint256",
            "name": "min_collateral_received"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "set_version",
        "args": [
          {
            "type": "uint64",
            "name": "contract_version"
          },
          {
            "type": "uint64",
            "name": "deployment_version"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "grant_upgrader",
        "args": [
          {
            "type": "address",
            "name": "upgrader"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "approve_update",
        "args": [
          {
            "type": "bool",
            "name": "approval"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        },
        "desc": "Approve update."
      },
      {
        "name": "set_role",
        "args": [
          {
            "type": "byte[32]",
            "name": "role"
          },
          {
            "type": "bool",
            "name": "allow"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "void"
        }
      },
      {
        "name": "has_role",
        "args": [
          {
            "type": "byte[32]",
            "name": "role"
          }
        ],
        "readonly": false,
        "returns": {
          "type": "bool"
        }
      }
    ],
    "networks": {}
  },
  "bare_call_config": {
    "update_application": "CALL",
    "no_op": "CREATE"
  }
}

/**
 * Defines an onCompletionAction of 'no_op'
 */
export type OnCompleteNoOp =  { onCompleteAction?: 'no_op' | OnApplicationComplete.NoOpOC }
/**
 * Defines an onCompletionAction of 'opt_in'
 */
export type OnCompleteOptIn =  { onCompleteAction: 'opt_in' | OnApplicationComplete.OptInOC }
/**
 * Defines an onCompletionAction of 'close_out'
 */
export type OnCompleteCloseOut =  { onCompleteAction: 'close_out' | OnApplicationComplete.CloseOutOC }
/**
 * Defines an onCompletionAction of 'delete_application'
 */
export type OnCompleteDelApp =  { onCompleteAction: 'delete_application' | OnApplicationComplete.DeleteApplicationOC }
/**
 * Defines an onCompletionAction of 'update_application'
 */
export type OnCompleteUpdApp =  { onCompleteAction: 'update_application' | OnApplicationComplete.UpdateApplicationOC }
/**
 * A state record containing a single unsigned integer
 */
export type IntegerState = {
  /**
   * Gets the state value as a BigInt.
   */
  asBigInt(): bigint
  /**
   * Gets the state value as a number.
   */
  asNumber(): number
}
/**
 * A state record containing binary data
 */
export type BinaryState = {
  /**
   * Gets the state value as a Uint8Array
   */
  asByteArray(): Uint8Array
  /**
   * Gets the state value as a string
   */
  asString(): string
}

export type AppCreateCallTransactionResult = AppCallTransactionResult & Partial<AppCompilationResult> & AppReference
export type AppUpdateCallTransactionResult = AppCallTransactionResult & Partial<AppCompilationResult>

export type AppClientComposeCallCoreParams = Omit<AppClientCallCoreParams, 'sendParams'> & {
  sendParams?: Omit<SendTransactionParams, 'skipSending' | 'atc' | 'skipWaiting' | 'maxRoundsToWaitForConfirmation' | 'populateAppCallResources'>
}
export type AppClientComposeExecuteParams = Pick<SendTransactionParams, 'skipWaiting' | 'maxRoundsToWaitForConfirmation' | 'populateAppCallResources' | 'suppressLog'>

/**
 * Defines the types of available calls and state of the DorkFiLendingPool smart contract.
 */
export type DorkFiLendingPool = {
  /**
   * Maps method signatures / names to their argument and return types.
   */
  methods:
    & Record<'post_update()void' | 'post_update', {
      argsObj: {
      }
      argsTuple: []
      returns: void
    }>
    & Record<'get_role_key(address,byte[3])byte[32]' | 'get_role_key', {
      argsObj: {
        account: string
        role: Uint8Array
      }
      argsTuple: [account: string, role: Uint8Array]
      returns: Uint8Array
    }>
    & Record<'set_market_price(uint64,uint256)void' | 'set_market_price', {
      argsObj: {
        marketId: bigint | number
        price: bigint | number
      }
      argsTuple: [marketId: bigint | number, price: bigint | number]
      returns: void
    }>
    & Record<'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void' | 'set_market', {
      argsObj: {
        tokenId: bigint | number
        marketData: [boolean, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number]
      }
      argsTuple: [tokenId: bigint | number, marketData: [boolean, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number]]
      returns: void
    }>
    & Record<'attach_price_feed(uint64,uint64)void' | 'attach_price_feed', {
      argsObj: {
        tokenId: bigint | number
        providerAppId: bigint | number
      }
      argsTuple: [tokenId: bigint | number, providerAppId: bigint | number]
      returns: void
    }>
    & Record<'detach_price_feed(uint64)void' | 'detach_price_feed', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: void
    }>
    & Record<'get_owner()address' | 'get_owner', {
      argsObj: {
      }
      argsTuple: []
      returns: string
    }>
    & Record<'transfer_ownership(address)void' | 'transfer_ownership', {
      argsObj: {
        newOwner: string
      }
      argsTuple: [newOwner: string]
      returns: void
    }>
    & Record<'set_storage_app_id(uint64)void' | 'set_storage_app_id', {
      argsObj: {
        storageAppId: bigint | number
      }
      argsTuple: [storageAppId: bigint | number]
      returns: void
    }>
    & Record<'is_paused()bool' | 'is_paused', {
      argsObj: {
      }
      argsTuple: []
      returns: boolean
    }>
    & Record<'pause(uint64)void' | 'pause', {
      argsObj: {
        pause: bigint | number
      }
      argsTuple: [pause: bigint | number]
      returns: void
    }>
    & Record<'set_stoken_app_id(uint64)void' | 'set_stoken_app_id', {
      argsObj: {
        stokenAppId: bigint | number
      }
      argsTuple: [stokenAppId: bigint | number]
      returns: void
    }>
    & Record<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)' | 'get_user', {
      argsObj: {
        userId: string
        marketId: bigint | number
      }
      argsTuple: [userId: string, marketId: bigint | number]
      returns: UserData
    }>
    & Record<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64' | 'create_market', {
      argsObj: {
        tokenId: bigint | number
        collateralFactor: bigint | number
        liquidationThreshold: bigint | number
        reserveFactor: bigint | number
        borrowRate: bigint | number
        slope: bigint | number
        maxTotalDeposits: bigint | number
        maxTotalBorrows: bigint | number
        liquidationBonus: bigint | number
        closeFactor: bigint | number
      }
      argsTuple: [tokenId: bigint | number, collateralFactor: bigint | number, liquidationThreshold: bigint | number, reserveFactor: bigint | number, borrowRate: bigint | number, slope: bigint | number, maxTotalDeposits: bigint | number, maxTotalBorrows: bigint | number, liquidationBonus: bigint | number, closeFactor: bigint | number]
      returns: bigint
    }>
    & Record<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)' | 'get_market', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: MarketData
    }>
    & Record<'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)' | 'get_market_transaction_cap', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: MarketTransactionCap
    }>
    & Record<'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)' | 'get_user_cap', {
      argsObj: {
        userId: string
      }
      argsTuple: [userId: string]
      returns: UserCap
    }>
    & Record<'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void' | 'set_user_cap', {
      argsObj: {
        userId: string
        userCap: [bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number]
      }
      argsTuple: [userId: string, userCap: [bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number, bigint | number]]
      returns: void
    }>
    & Record<'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void' | 'set_market_transaction_cap', {
      argsObj: {
        tokenId: bigint | number
        transactionCap: [bigint | number, bigint | number, bigint | number, bigint | number]
      }
      argsTuple: [tokenId: bigint | number, transactionCap: [bigint | number, bigint | number, bigint | number, bigint | number]]
      returns: void
    }>
    & Record<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))' | 'get_price_feed', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: PriceFeed
    }>
    & Record<'fetch_price_feed(uint64)void' | 'fetch_price_feed', {
      argsObj: {
        tokenId: bigint | number
      }
      argsTuple: [tokenId: bigint | number]
      returns: void
    }>
    & Record<'pause_market(uint64,uint64)void' | 'pause_market', {
      argsObj: {
        tokenId: bigint | number
        pause: bigint | number
      }
      argsTuple: [tokenId: bigint | number, pause: bigint | number]
      returns: void
    }>
    & Record<'sync_market(uint64)void' | 'sync_market', {
      argsObj: {
        marketId: bigint | number
      }
      argsTuple: [marketId: bigint | number]
      returns: void
    }>
    & Record<'withdraw_reserves(uint64,uint256)void' | 'withdraw_reserves', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: void
    }>
    & Record<'deposit(uint64,uint256)void' | 'deposit', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: void
    }>
    & Record<'withdraw(uint64,uint256)uint256' | 'withdraw', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: bigint
    }>
    & Record<'borrow(uint64,uint256)void' | 'borrow', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: void
    }>
    & Record<'repay(uint64,uint256)void' | 'repay', {
      argsObj: {
        marketId: bigint | number
        amount: bigint | number
      }
      argsTuple: [marketId: bigint | number, amount: bigint | number]
      returns: void
    }>
    & Record<'sync_user_market_for_price_change(address,uint64)void' | 'sync_user_market_for_price_change', {
      argsObj: {
        userId: string
        marketId: bigint | number
      }
      argsTuple: [userId: string, marketId: bigint | number]
      returns: void
    }>
    & Record<'get_global_user(address)(uint256,uint256,uint64)' | 'get_global_user', {
      argsObj: {
        userId: string
      }
      argsTuple: [userId: string]
      returns: GlobalUserData
    }>
    & Record<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void' | 'liquidate_cross_market', {
      argsObj: {
        debtMarketId: bigint | number
        collateralMarketId: bigint | number
        user: string
        debtAmount: bigint | number
        minCollateralReceived: bigint | number
      }
      argsTuple: [debtMarketId: bigint | number, collateralMarketId: bigint | number, user: string, debtAmount: bigint | number, minCollateralReceived: bigint | number]
      returns: void
    }>
    & Record<'set_version(uint64,uint64)void' | 'set_version', {
      argsObj: {
        contractVersion: bigint | number
        deploymentVersion: bigint | number
      }
      argsTuple: [contractVersion: bigint | number, deploymentVersion: bigint | number]
      returns: void
    }>
    & Record<'grant_upgrader(address)void' | 'grant_upgrader', {
      argsObj: {
        upgrader: string
      }
      argsTuple: [upgrader: string]
      returns: void
    }>
    & Record<'approve_update(bool)void' | 'approve_update', {
      argsObj: {
        approval: boolean
      }
      argsTuple: [approval: boolean]
      returns: void
    }>
    & Record<'set_role(byte[32],bool)void' | 'set_role', {
      argsObj: {
        role: Uint8Array
        allow: boolean
      }
      argsTuple: [role: Uint8Array, allow: boolean]
      returns: void
    }>
    & Record<'has_role(byte[32])bool' | 'has_role', {
      argsObj: {
        role: Uint8Array
      }
      argsTuple: [role: Uint8Array]
      returns: boolean
    }>
  /**
   * Defines the shape of the global and local state of the application.
   */
  state: {
    global: {
      contractVersion?: IntegerState
      deploymentVersion?: IntegerState
      owner?: BinaryState
      paused?: IntegerState
      secondsPerYear?: IntegerState
      stokenAppId?: IntegerState
      updatable?: IntegerState
      upgrader?: BinaryState
    }
  }
}
/**
 * Defines the possible abi call signatures
 */
export type DorkFiLendingPoolSig = keyof DorkFiLendingPool['methods']
/**
 * Defines an object containing all relevant parameters for a single call to the contract. Where TSignature is undefined, a bare call is made
 */
export type TypedCallParams<TSignature extends DorkFiLendingPoolSig | undefined> = {
  method: TSignature
  methodArgs: TSignature extends undefined ? undefined : Array<ABIAppCallArg | undefined>
} & AppClientCallCoreParams & CoreAppCallArgs
/**
 * Defines the arguments required for a bare call
 */
export type BareCallArgs = Omit<RawAppCallArgs, keyof CoreAppCallArgs>
/**
 * Represents a MarketData result as a struct
 */
export type MarketData = {
  paused: boolean
  maxTotalDeposits: bigint
  maxTotalBorrows: bigint
  liquidationBonus: bigint
  collateralFactor: bigint
  liquidationThreshold: bigint
  reserveFactor: bigint
  borrowRate: bigint
  slope: bigint
  totalScaledDeposits: bigint
  totalScaledBorrows: bigint
  depositIndex: bigint
  borrowIndex: bigint
  lastUpdateTime: bigint
  reserves: bigint
  price: bigint
  ntokenId: bigint
  closeFactor: bigint
}
/**
 * Converts the tuple representation of a MarketData to the struct representation
 */
export function MarketData([paused, maxTotalDeposits, maxTotalBorrows, liquidationBonus, collateralFactor, liquidationThreshold, reserveFactor, borrowRate, slope, totalScaledDeposits, totalScaledBorrows, depositIndex, borrowIndex, lastUpdateTime, reserves, price, ntokenId, closeFactor]: [boolean, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint, bigint] ) {
  return {
    paused,
    maxTotalDeposits,
    maxTotalBorrows,
    liquidationBonus,
    collateralFactor,
    liquidationThreshold,
    reserveFactor,
    borrowRate,
    slope,
    totalScaledDeposits,
    totalScaledBorrows,
    depositIndex,
    borrowIndex,
    lastUpdateTime,
    reserves,
    price,
    ntokenId,
    closeFactor,
  }
}
/**
 * Represents a UserData result as a struct
 */
export type UserData = {
  scaledDeposits: bigint
  scaledBorrows: bigint
  depositIndex: bigint
  borrowIndex: bigint
  lastUpdateTime: bigint
  lastPrice: bigint
}
/**
 * Converts the tuple representation of a UserData to the struct representation
 */
export function UserData([scaledDeposits, scaledBorrows, depositIndex, borrowIndex, lastUpdateTime, lastPrice]: [bigint, bigint, bigint, bigint, bigint, bigint] ) {
  return {
    scaledDeposits,
    scaledBorrows,
    depositIndex,
    borrowIndex,
    lastUpdateTime,
    lastPrice,
  }
}
/**
 * Represents a MarketData result as a struct
 */
/**
 * Converts the tuple representation of a MarketData to the struct representation
 */
/**
 * Represents a MarketTransactionCap result as a struct
 */
export type MarketTransactionCap = {
  deposit: bigint
  withdraw: bigint
  borrow: bigint
  liquidate: bigint
}
/**
 * Converts the tuple representation of a MarketTransactionCap to the struct representation
 */
export function MarketTransactionCap([deposit, withdraw, borrow, liquidate]: [bigint, bigint, bigint, bigint] ) {
  return {
    deposit,
    withdraw,
    borrow,
    liquidate,
  }
}
/**
 * Represents a UserCap result as a struct
 */
export type UserCap = {
  totalDeposits: bigint
  totalBorrows: bigint
  totalLiquidations: bigint
  totalWithdrawals: bigint
  dailyLiquidations: bigint
  dailyWithdrawals: bigint
  dailyResetTime: bigint
}
/**
 * Converts the tuple representation of a UserCap to the struct representation
 */
export function UserCap([totalDeposits, totalBorrows, totalLiquidations, totalWithdrawals, dailyLiquidations, dailyWithdrawals, dailyResetTime]: [bigint, bigint, bigint, bigint, bigint, bigint, bigint] ) {
  return {
    totalDeposits,
    totalBorrows,
    totalLiquidations,
    totalWithdrawals,
    dailyLiquidations,
    dailyWithdrawals,
    dailyResetTime,
  }
}
/**
 * Represents a UserCap result as a struct
 */
/**
 * Converts the tuple representation of a UserCap to the struct representation
 */
/**
 * Represents a MarketTransactionCap result as a struct
 */
/**
 * Converts the tuple representation of a MarketTransactionCap to the struct representation
 */
/**
 * Represents a PriceFeed result as a struct
 */
export type PriceFeed = {
  marketId: bigint
  providerAppId: bigint
  priceWithTimestamp: [bigint, bigint]
}
/**
 * Converts the tuple representation of a PriceFeed to the struct representation
 */
export function PriceFeed([marketId, providerAppId, priceWithTimestamp]: [bigint, bigint, [bigint, bigint]] ) {
  return {
    marketId,
    providerAppId,
    priceWithTimestamp,
  }
}
/**
 * Represents a GlobalUserData result as a struct
 */
export type GlobalUserData = {
  totalCollateralValue: bigint
  totalBorrowValue: bigint
  lastUpdateTime: bigint
}
/**
 * Converts the tuple representation of a GlobalUserData to the struct representation
 */
export function GlobalUserData([totalCollateralValue, totalBorrowValue, lastUpdateTime]: [bigint, bigint, bigint] ) {
  return {
    totalCollateralValue,
    totalBorrowValue,
    lastUpdateTime,
  }
}
/**
 * Maps a method signature from the DorkFiLendingPool smart contract to the method's arguments in either tuple of struct form
 */
export type MethodArgs<TSignature extends DorkFiLendingPoolSig> = DorkFiLendingPool['methods'][TSignature]['argsObj' | 'argsTuple']
/**
 * Maps a method signature from the DorkFiLendingPool smart contract to the method's return type
 */
export type MethodReturn<TSignature extends DorkFiLendingPoolSig> = DorkFiLendingPool['methods'][TSignature]['returns']

/**
 * A factory for available 'create' calls
 */
export type DorkFiLendingPoolCreateCalls = (typeof DorkFiLendingPoolCallFactory)['create']
/**
 * Defines supported create methods for this smart contract
 */
export type DorkFiLendingPoolCreateCallParams =
  | (TypedCallParams<undefined> & (OnCompleteNoOp))
/**
 * A factory for available 'update' calls
 */
export type DorkFiLendingPoolUpdateCalls = (typeof DorkFiLendingPoolCallFactory)['update']
/**
 * Defines supported update methods for this smart contract
 */
export type DorkFiLendingPoolUpdateCallParams =
  | TypedCallParams<undefined>
/**
 * Defines arguments required for the deploy method.
 */
export type DorkFiLendingPoolDeployArgs = {
  deployTimeParams?: TealTemplateParams
  /**
   * A delegate which takes a create call factory and returns the create call params for this smart contract
   */
  createCall?: (callFactory: DorkFiLendingPoolCreateCalls) => DorkFiLendingPoolCreateCallParams
  /**
   * A delegate which takes a update call factory and returns the update call params for this smart contract
   */
  updateCall?: (callFactory: DorkFiLendingPoolUpdateCalls) => DorkFiLendingPoolUpdateCallParams
}


/**
 * Exposes methods for constructing all available smart contract calls
 */
export abstract class DorkFiLendingPoolCallFactory {
  /**
   * Gets available create call factories
   */
  static get create() {
    return {
      /**
       * Constructs a create call for the DorkFiLendingPool smart contract using a bare call
       *
       * @param params Any parameters for the call
       * @returns A TypedCallParams object for the call
       */
      bare(params: BareCallArgs & AppClientCallCoreParams & CoreAppCallArgs & AppClientCompilationParams & (OnCompleteNoOp) = {}) {
        return {
          method: undefined,
          methodArgs: undefined,
          ...params,
        }
      },
    }
  }

  /**
   * Gets available update call factories
   */
  static get update() {
    return {
      /**
       * Constructs an update call for the DorkFiLendingPool smart contract using a bare call
       *
       * @param params Any parameters for the call
       * @returns A TypedCallParams object for the call
       */
      bare(params: BareCallArgs & AppClientCallCoreParams & CoreAppCallArgs & AppClientCompilationParams = {}) {
        return {
          method: undefined,
          methodArgs: undefined,
          ...params,
        }
      },
    }
  }

  /**
   * Constructs a no op call for the post_update()void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static postUpdate(args: MethodArgs<'post_update()void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'post_update()void' as const,
      methodArgs: Array.isArray(args) ? args : [],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_role_key(address,byte[3])byte[32] ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getRoleKey(args: MethodArgs<'get_role_key(address,byte[3])byte[32]'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_role_key(address,byte[3])byte[32]' as const,
      methodArgs: Array.isArray(args) ? args : [args.account, args.role],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_market_price(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setMarketPrice(args: MethodArgs<'set_market_price(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_market_price(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.price],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setMarket(args: MethodArgs<'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.marketData],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the attach_price_feed(uint64,uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static attachPriceFeed(args: MethodArgs<'attach_price_feed(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'attach_price_feed(uint64,uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.providerAppId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the detach_price_feed(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static detachPriceFeed(args: MethodArgs<'detach_price_feed(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'detach_price_feed(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_owner()address ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getOwner(args: MethodArgs<'get_owner()address'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_owner()address' as const,
      methodArgs: Array.isArray(args) ? args : [],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the transfer_ownership(address)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static transferOwnership(args: MethodArgs<'transfer_ownership(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'transfer_ownership(address)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.newOwner],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_storage_app_id(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setStorageAppId(args: MethodArgs<'set_storage_app_id(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_storage_app_id(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.storageAppId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the is_paused()bool ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static isPaused(args: MethodArgs<'is_paused()bool'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'is_paused()bool' as const,
      methodArgs: Array.isArray(args) ? args : [],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the pause(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static pause(args: MethodArgs<'pause(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'pause(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.pause],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_stoken_app_id(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setStokenAppId(args: MethodArgs<'set_stoken_app_id(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_stoken_app_id(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.stokenAppId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getUser(args: MethodArgs<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId, args.marketId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64 ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static createMarket(args: MethodArgs<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.collateralFactor, args.liquidationThreshold, args.reserveFactor, args.borrowRate, args.slope, args.maxTotalDeposits, args.maxTotalBorrows, args.liquidationBonus, args.closeFactor],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getMarket(args: MethodArgs<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getMarketTransactionCap(args: MethodArgs<'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getUserCap(args: MethodArgs<'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setUserCap(args: MethodArgs<'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId, args.userCap],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setMarketTransactionCap(args: MethodArgs<'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.transactionCap],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_price_feed(uint64)(uint64,uint64,(uint256,uint64)) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getPriceFeed(args: MethodArgs<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the fetch_price_feed(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static fetchPriceFeed(args: MethodArgs<'fetch_price_feed(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'fetch_price_feed(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the pause_market(uint64,uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static pauseMarket(args: MethodArgs<'pause_market(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'pause_market(uint64,uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.tokenId, args.pause],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the sync_market(uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static syncMarket(args: MethodArgs<'sync_market(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'sync_market(uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the withdraw_reserves(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static withdrawReserves(args: MethodArgs<'withdraw_reserves(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'withdraw_reserves(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the deposit(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static deposit(args: MethodArgs<'deposit(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'deposit(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the withdraw(uint64,uint256)uint256 ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static withdraw(args: MethodArgs<'withdraw(uint64,uint256)uint256'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'withdraw(uint64,uint256)uint256' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the borrow(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static borrow(args: MethodArgs<'borrow(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'borrow(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the repay(uint64,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static repay(args: MethodArgs<'repay(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'repay(uint64,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.marketId, args.amount],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the sync_user_market_for_price_change(address,uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static syncUserMarketForPriceChange(args: MethodArgs<'sync_user_market_for_price_change(address,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'sync_user_market_for_price_change(address,uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId, args.marketId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the get_global_user(address)(uint256,uint256,uint64) ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static getGlobalUser(args: MethodArgs<'get_global_user(address)(uint256,uint256,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'get_global_user(address)(uint256,uint256,uint64)' as const,
      methodArgs: Array.isArray(args) ? args : [args.userId],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the liquidate_cross_market(uint64,uint64,address,uint256,uint256)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static liquidateCrossMarket(args: MethodArgs<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.debtMarketId, args.collateralMarketId, args.user, args.debtAmount, args.minCollateralReceived],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_version(uint64,uint64)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setVersion(args: MethodArgs<'set_version(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_version(uint64,uint64)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.contractVersion, args.deploymentVersion],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the grant_upgrader(address)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static grantUpgrader(args: MethodArgs<'grant_upgrader(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'grant_upgrader(address)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.upgrader],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the approve_update(bool)void ABI method
   *
   * Approve update.
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static approveUpdate(args: MethodArgs<'approve_update(bool)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'approve_update(bool)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.approval],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the set_role(byte[32],bool)void ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static setRole(args: MethodArgs<'set_role(byte[32],bool)void'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'set_role(byte[32],bool)void' as const,
      methodArgs: Array.isArray(args) ? args : [args.role, args.allow],
      ...params,
    }
  }
  /**
   * Constructs a no op call for the has_role(byte[32])bool ABI method
   *
   * @param args Any args for the contract call
   * @param params Any additional parameters for the call
   * @returns A TypedCallParams object for the call
   */
  static hasRole(args: MethodArgs<'has_role(byte[32])bool'>, params: AppClientCallCoreParams & CoreAppCallArgs) {
    return {
      method: 'has_role(byte[32])bool' as const,
      methodArgs: Array.isArray(args) ? args : [args.role],
      ...params,
    }
  }
}

/**
 * A client to make calls to the DorkFiLendingPool smart contract
 */
export class DorkFiLendingPoolClient {
  /**
   * The underlying `ApplicationClient` for when you want to have more flexibility
   */
  public readonly appClient: ApplicationClient

  private readonly sender: SendTransactionFrom | undefined

  /**
   * Creates a new instance of `DorkFiLendingPoolClient`
   *
   * @param appDetails appDetails The details to identify the app to deploy
   * @param algod An algod client instance
   */
  constructor(appDetails: AppDetails, private algod: Algodv2) {
    this.sender = appDetails.sender
    this.appClient = algokit.getAppClient({
      ...appDetails,
      app: APP_SPEC
    }, algod)
  }

  /**
   * Checks for decode errors on the AppCallTransactionResult and maps the return value to the specified generic type
   *
   * @param result The AppCallTransactionResult to be mapped
   * @param returnValueFormatter An optional delegate to format the return value if required
   * @returns The smart contract response with an updated return value
   */
  protected mapReturnValue<TReturn, TResult extends AppCallTransactionResult = AppCallTransactionResult>(result: AppCallTransactionResult, returnValueFormatter?: (value: any) => TReturn): AppCallTransactionResultOfType<TReturn> & TResult {
    if(result.return?.decodeError) {
      throw result.return.decodeError
    }
    const returnValue = result.return?.returnValue !== undefined && returnValueFormatter !== undefined
      ? returnValueFormatter(result.return.returnValue)
      : result.return?.returnValue as TReturn | undefined
      return { ...result, return: returnValue } as AppCallTransactionResultOfType<TReturn> & TResult
  }

  /**
   * Calls the ABI method with the matching signature using an onCompletion code of NO_OP
   *
   * @param typedCallParams An object containing the method signature, args, and any other relevant parameters
   * @param returnValueFormatter An optional delegate which when provided will be used to map non-undefined return values to the target type
   * @returns The result of the smart contract call
   */
  public async call<TSignature extends keyof DorkFiLendingPool['methods']>(typedCallParams: TypedCallParams<TSignature>, returnValueFormatter?: (value: any) => MethodReturn<TSignature>) {
    return this.mapReturnValue<MethodReturn<TSignature>>(await this.appClient.call(typedCallParams), returnValueFormatter)
  }

  /**
   * Idempotently deploys the DorkFiLendingPool smart contract.
   *
   * @param params The arguments for the contract calls and any additional parameters for the call
   * @returns The deployment result
   */
  public deploy(params: DorkFiLendingPoolDeployArgs & AppClientDeployCoreParams = {}): ReturnType<ApplicationClient['deploy']> {
    const createArgs = params.createCall?.(DorkFiLendingPoolCallFactory.create)
    const updateArgs = params.updateCall?.(DorkFiLendingPoolCallFactory.update)
    return this.appClient.deploy({
      ...params,
      updateArgs,
      createArgs,
      createOnCompleteAction: createArgs?.onCompleteAction,
    })
  }

  /**
   * Gets available create methods
   */
  public get create() {
    const $this = this
    return {
      /**
       * Creates a new instance of the DorkFiLendingPool smart contract using a bare call.
       *
       * @param args The arguments for the bare call
       * @returns The create result
       */
      async bare(args: BareCallArgs & AppClientCallCoreParams & AppClientCompilationParams & CoreAppCallArgs & (OnCompleteNoOp) = {}) {
        return $this.mapReturnValue<undefined, AppCreateCallTransactionResult>(await $this.appClient.create(args))
      },
    }
  }

  /**
   * Gets available update methods
   */
  public get update() {
    const $this = this
    return {
      /**
       * Updates an existing instance of the DorkFiLendingPool smart contract using a bare call.
       *
       * @param args The arguments for the bare call
       * @returns The update result
       */
      async bare(args: BareCallArgs & AppClientCallCoreParams & AppClientCompilationParams & CoreAppCallArgs = {}) {
        return $this.mapReturnValue<undefined, AppUpdateCallTransactionResult>(await $this.appClient.update(args))
      },
    }
  }

  /**
   * Makes a clear_state call to an existing instance of the DorkFiLendingPool smart contract.
   *
   * @param args The arguments for the bare call
   * @returns The clear_state result
   */
  public clearState(args: BareCallArgs & AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.appClient.clearState(args)
  }

  /**
   * Calls the post_update()void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public postUpdate(args: MethodArgs<'post_update()void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.postUpdate(args, params))
  }

  /**
   * Calls the get_role_key(address,byte[3])byte[32] ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getRoleKey(args: MethodArgs<'get_role_key(address,byte[3])byte[32]'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getRoleKey(args, params))
  }

  /**
   * Calls the set_market_price(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setMarketPrice(args: MethodArgs<'set_market_price(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setMarketPrice(args, params))
  }

  /**
   * Calls the set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setMarket(args: MethodArgs<'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setMarket(args, params))
  }

  /**
   * Calls the attach_price_feed(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public attachPriceFeed(args: MethodArgs<'attach_price_feed(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.attachPriceFeed(args, params))
  }

  /**
   * Calls the detach_price_feed(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public detachPriceFeed(args: MethodArgs<'detach_price_feed(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.detachPriceFeed(args, params))
  }

  /**
   * Calls the get_owner()address ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getOwner(args: MethodArgs<'get_owner()address'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getOwner(args, params))
  }

  /**
   * Calls the transfer_ownership(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public transferOwnership(args: MethodArgs<'transfer_ownership(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.transferOwnership(args, params))
  }

  /**
   * Calls the set_storage_app_id(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setStorageAppId(args: MethodArgs<'set_storage_app_id(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setStorageAppId(args, params))
  }

  /**
   * Calls the is_paused()bool ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public isPaused(args: MethodArgs<'is_paused()bool'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.isPaused(args, params))
  }

  /**
   * Calls the pause(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public pause(args: MethodArgs<'pause(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.pause(args, params))
  }

  /**
   * Calls the set_stoken_app_id(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setStokenAppId(args: MethodArgs<'set_stoken_app_id(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setStokenAppId(args, params))
  }

  /**
   * Calls the get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getUser(args: MethodArgs<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getUser(args, params), UserData)
  }

  /**
   * Calls the create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public createMarket(args: MethodArgs<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.createMarket(args, params))
  }

  /**
   * Calls the get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getMarket(args: MethodArgs<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getMarket(args, params), MarketData)
  }

  /**
   * Calls the get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getMarketTransactionCap(args: MethodArgs<'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getMarketTransactionCap(args, params), MarketTransactionCap)
  }

  /**
   * Calls the get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getUserCap(args: MethodArgs<'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getUserCap(args, params), UserCap)
  }

  /**
   * Calls the set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setUserCap(args: MethodArgs<'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setUserCap(args, params))
  }

  /**
   * Calls the set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setMarketTransactionCap(args: MethodArgs<'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setMarketTransactionCap(args, params))
  }

  /**
   * Calls the get_price_feed(uint64)(uint64,uint64,(uint256,uint64)) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getPriceFeed(args: MethodArgs<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getPriceFeed(args, params), PriceFeed)
  }

  /**
   * Calls the fetch_price_feed(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public fetchPriceFeed(args: MethodArgs<'fetch_price_feed(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.fetchPriceFeed(args, params))
  }

  /**
   * Calls the pause_market(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public pauseMarket(args: MethodArgs<'pause_market(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.pauseMarket(args, params))
  }

  /**
   * Calls the sync_market(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public syncMarket(args: MethodArgs<'sync_market(uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.syncMarket(args, params))
  }

  /**
   * Calls the withdraw_reserves(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public withdrawReserves(args: MethodArgs<'withdraw_reserves(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.withdrawReserves(args, params))
  }

  /**
   * Calls the deposit(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public deposit(args: MethodArgs<'deposit(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.deposit(args, params))
  }

  /**
   * Calls the withdraw(uint64,uint256)uint256 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public withdraw(args: MethodArgs<'withdraw(uint64,uint256)uint256'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.withdraw(args, params))
  }

  /**
   * Calls the borrow(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public borrow(args: MethodArgs<'borrow(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.borrow(args, params))
  }

  /**
   * Calls the repay(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public repay(args: MethodArgs<'repay(uint64,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.repay(args, params))
  }

  /**
   * Calls the sync_user_market_for_price_change(address,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public syncUserMarketForPriceChange(args: MethodArgs<'sync_user_market_for_price_change(address,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.syncUserMarketForPriceChange(args, params))
  }

  /**
   * Calls the get_global_user(address)(uint256,uint256,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public getGlobalUser(args: MethodArgs<'get_global_user(address)(uint256,uint256,uint64)'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.getGlobalUser(args, params), GlobalUserData)
  }

  /**
   * Calls the liquidate_cross_market(uint64,uint64,address,uint256,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public liquidateCrossMarket(args: MethodArgs<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.liquidateCrossMarket(args, params))
  }

  /**
   * Calls the set_version(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setVersion(args: MethodArgs<'set_version(uint64,uint64)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setVersion(args, params))
  }

  /**
   * Calls the grant_upgrader(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public grantUpgrader(args: MethodArgs<'grant_upgrader(address)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.grantUpgrader(args, params))
  }

  /**
   * Calls the approve_update(bool)void ABI method.
   *
   * Approve update.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public approveUpdate(args: MethodArgs<'approve_update(bool)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.approveUpdate(args, params))
  }

  /**
   * Calls the set_role(byte[32],bool)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public setRole(args: MethodArgs<'set_role(byte[32],bool)void'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.setRole(args, params))
  }

  /**
   * Calls the has_role(byte[32])bool ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The result of the call
   */
  public hasRole(args: MethodArgs<'has_role(byte[32])bool'>, params: AppClientCallCoreParams & CoreAppCallArgs = {}) {
    return this.call(DorkFiLendingPoolCallFactory.hasRole(args, params))
  }

  /**
   * Extracts a binary state value out of an AppState dictionary
   *
   * @param state The state dictionary containing the state value
   * @param key The key of the state value
   * @returns A BinaryState instance containing the state value, or undefined if the key was not found
   */
  private static getBinaryState(state: AppState, key: string): BinaryState | undefined {
    const value = state[key]
    if (!value) return undefined
    if (!('valueRaw' in value))
      throw new Error(`Failed to parse state value for ${key}; received an int when expected a byte array`)
    return {
      asString(): string {
        return value.value
      },
      asByteArray(): Uint8Array {
        return value.valueRaw
      }
    }
  }

  /**
   * Extracts a integer state value out of an AppState dictionary
   *
   * @param state The state dictionary containing the state value
   * @param key The key of the state value
   * @returns An IntegerState instance containing the state value, or undefined if the key was not found
   */
  private static getIntegerState(state: AppState, key: string): IntegerState | undefined {
    const value = state[key]
    if (!value) return undefined
    if ('valueRaw' in value)
      throw new Error(`Failed to parse state value for ${key}; received a byte array when expected a number`)
    return {
      asBigInt() {
        return typeof value.value === 'bigint' ? value.value : BigInt(value.value)
      },
      asNumber(): number {
        return typeof value.value === 'bigint' ? Number(value.value) : value.value
      },
    }
  }

  /**
   * Returns the smart contract's global state wrapped in a strongly typed accessor with options to format the stored value
   */
  public async getGlobalState(): Promise<DorkFiLendingPool['state']['global']> {
    const state = await this.appClient.getGlobalState()
    return {
      get contractVersion() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'contract_version')
      },
      get deploymentVersion() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'deployment_version')
      },
      get owner() {
        return DorkFiLendingPoolClient.getBinaryState(state, 'owner')
      },
      get paused() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'paused')
      },
      get secondsPerYear() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'seconds_per_year')
      },
      get stokenAppId() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'stoken_app_id')
      },
      get updatable() {
        return DorkFiLendingPoolClient.getIntegerState(state, 'updatable')
      },
      get upgrader() {
        return DorkFiLendingPoolClient.getBinaryState(state, 'upgrader')
      },
    }
  }

  public compose(): DorkFiLendingPoolComposer {
    const client = this
    const atc = new AtomicTransactionComposer()
    let promiseChain:Promise<unknown> = Promise.resolve()
    const resultMappers: Array<undefined | ((x: any) => any)> = []
    return {
      postUpdate(args: MethodArgs<'post_update()void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.postUpdate(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getRoleKey(args: MethodArgs<'get_role_key(address,byte[3])byte[32]'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getRoleKey(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setMarketPrice(args: MethodArgs<'set_market_price(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setMarketPrice(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setMarket(args: MethodArgs<'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      attachPriceFeed(args: MethodArgs<'attach_price_feed(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.attachPriceFeed(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      detachPriceFeed(args: MethodArgs<'detach_price_feed(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.detachPriceFeed(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getOwner(args: MethodArgs<'get_owner()address'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getOwner(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      transferOwnership(args: MethodArgs<'transfer_ownership(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.transferOwnership(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setStorageAppId(args: MethodArgs<'set_storage_app_id(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setStorageAppId(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      isPaused(args: MethodArgs<'is_paused()bool'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.isPaused(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      pause(args: MethodArgs<'pause(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.pause(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setStokenAppId(args: MethodArgs<'set_stoken_app_id(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setStokenAppId(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getUser(args: MethodArgs<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getUser(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(UserData)
        return this
      },
      createMarket(args: MethodArgs<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.createMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getMarket(args: MethodArgs<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(MarketData)
        return this
      },
      getMarketTransactionCap(args: MethodArgs<'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getMarketTransactionCap(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(MarketTransactionCap)
        return this
      },
      getUserCap(args: MethodArgs<'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getUserCap(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(UserCap)
        return this
      },
      setUserCap(args: MethodArgs<'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setUserCap(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setMarketTransactionCap(args: MethodArgs<'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setMarketTransactionCap(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getPriceFeed(args: MethodArgs<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getPriceFeed(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(PriceFeed)
        return this
      },
      fetchPriceFeed(args: MethodArgs<'fetch_price_feed(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.fetchPriceFeed(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      pauseMarket(args: MethodArgs<'pause_market(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.pauseMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      syncMarket(args: MethodArgs<'sync_market(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.syncMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      withdrawReserves(args: MethodArgs<'withdraw_reserves(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.withdrawReserves(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      deposit(args: MethodArgs<'deposit(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.deposit(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      withdraw(args: MethodArgs<'withdraw(uint64,uint256)uint256'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.withdraw(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      borrow(args: MethodArgs<'borrow(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.borrow(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      repay(args: MethodArgs<'repay(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.repay(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      syncUserMarketForPriceChange(args: MethodArgs<'sync_user_market_for_price_change(address,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.syncUserMarketForPriceChange(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      getGlobalUser(args: MethodArgs<'get_global_user(address)(uint256,uint256,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.getGlobalUser(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(GlobalUserData)
        return this
      },
      liquidateCrossMarket(args: MethodArgs<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.liquidateCrossMarket(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setVersion(args: MethodArgs<'set_version(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setVersion(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      grantUpgrader(args: MethodArgs<'grant_upgrader(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.grantUpgrader(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      approveUpdate(args: MethodArgs<'approve_update(bool)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.approveUpdate(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      setRole(args: MethodArgs<'set_role(byte[32],bool)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.setRole(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      hasRole(args: MethodArgs<'has_role(byte[32])bool'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.hasRole(args, {...params, sendParams: {...params?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      get update() {
        const $this = this
        return {
          bare(args?: BareCallArgs & AppClientComposeCallCoreParams & AppClientCompilationParams & CoreAppCallArgs) {
            promiseChain = promiseChain.then(() => client.update.bare({...args, sendParams: {...args?.sendParams, skipSending: true, atc}}))
            resultMappers.push(undefined)
            return $this
          },
        }
      },
      clearState(args?: BareCallArgs & AppClientComposeCallCoreParams & CoreAppCallArgs) {
        promiseChain = promiseChain.then(() => client.clearState({...args, sendParams: {...args?.sendParams, skipSending: true, atc}}))
        resultMappers.push(undefined)
        return this
      },
      addTransaction(txn: TransactionWithSigner | TransactionToSign | Transaction | Promise<SendTransactionResult>, defaultSender?: SendTransactionFrom) {
        promiseChain = promiseChain.then(async () => atc.addTransaction(await algokit.getTransactionWithSigner(txn, defaultSender ?? client.sender)))
        return this
      },
      async atc() {
        await promiseChain
        return atc
      },
      async simulate(options?: SimulateOptions) {
        await promiseChain
        const result = await atc.simulate(client.algod, new modelsv2.SimulateRequest({ txnGroups: [], ...options }))
        return {
          ...result,
          returns: result.methodResults?.map((val, i) => resultMappers[i] !== undefined ? resultMappers[i]!(val.returnValue) : val.returnValue)
        }
      },
      async execute(sendParams?: AppClientComposeExecuteParams) {
        await promiseChain
        const result = await algokit.sendAtomicTransactionComposer({ atc, sendParams }, client.algod)
        return {
          ...result,
          returns: result.returns?.map((val, i) => resultMappers[i] !== undefined ? resultMappers[i]!(val.returnValue) : val.returnValue)
        }
      }
    } as unknown as DorkFiLendingPoolComposer
  }
}
export type DorkFiLendingPoolComposer<TReturns extends [...any[]] = []> = {
  /**
   * Calls the post_update()void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  postUpdate(args: MethodArgs<'post_update()void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'post_update()void'>]>

  /**
   * Calls the get_role_key(address,byte[3])byte[32] ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getRoleKey(args: MethodArgs<'get_role_key(address,byte[3])byte[32]'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_role_key(address,byte[3])byte[32]'>]>

  /**
   * Calls the set_market_price(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setMarketPrice(args: MethodArgs<'set_market_price(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_market_price(uint64,uint256)void'>]>

  /**
   * Calls the set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setMarket(args: MethodArgs<'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_market(uint64,(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64))void'>]>

  /**
   * Calls the attach_price_feed(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  attachPriceFeed(args: MethodArgs<'attach_price_feed(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'attach_price_feed(uint64,uint64)void'>]>

  /**
   * Calls the detach_price_feed(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  detachPriceFeed(args: MethodArgs<'detach_price_feed(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'detach_price_feed(uint64)void'>]>

  /**
   * Calls the get_owner()address ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getOwner(args: MethodArgs<'get_owner()address'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_owner()address'>]>

  /**
   * Calls the transfer_ownership(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  transferOwnership(args: MethodArgs<'transfer_ownership(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'transfer_ownership(address)void'>]>

  /**
   * Calls the set_storage_app_id(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setStorageAppId(args: MethodArgs<'set_storage_app_id(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_storage_app_id(uint64)void'>]>

  /**
   * Calls the is_paused()bool ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  isPaused(args: MethodArgs<'is_paused()bool'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'is_paused()bool'>]>

  /**
   * Calls the pause(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  pause(args: MethodArgs<'pause(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'pause(uint64)void'>]>

  /**
   * Calls the set_stoken_app_id(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setStokenAppId(args: MethodArgs<'set_stoken_app_id(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_stoken_app_id(uint64)void'>]>

  /**
   * Calls the get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getUser(args: MethodArgs<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_user(address,uint64)(uint256,uint256,uint256,uint256,uint64,uint256)'>]>

  /**
   * Calls the create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  createMarket(args: MethodArgs<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'create_market(uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint64,uint64)uint64'>]>

  /**
   * Calls the get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getMarket(args: MethodArgs<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_market(uint64)(bool,uint256,uint256,uint64,uint64,uint64,uint64,uint64,uint64,uint256,uint256,uint256,uint256,uint64,uint256,uint256,uint64,uint64)'>]>

  /**
   * Calls the get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getMarketTransactionCap(args: MethodArgs<'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_market_transaction_cap(uint64)(uint256,uint256,uint256,uint256)'>]>

  /**
   * Calls the get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getUserCap(args: MethodArgs<'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_user_cap(address)(uint256,uint256,uint256,uint256,uint256,uint256,uint64)'>]>

  /**
   * Calls the set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setUserCap(args: MethodArgs<'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_user_cap(address,(uint256,uint256,uint256,uint256,uint256,uint256,uint64))void'>]>

  /**
   * Calls the set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setMarketTransactionCap(args: MethodArgs<'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_market_transaction_cap(uint64,(uint256,uint256,uint256,uint256))void'>]>

  /**
   * Calls the get_price_feed(uint64)(uint64,uint64,(uint256,uint64)) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getPriceFeed(args: MethodArgs<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_price_feed(uint64)(uint64,uint64,(uint256,uint64))'>]>

  /**
   * Calls the fetch_price_feed(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  fetchPriceFeed(args: MethodArgs<'fetch_price_feed(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'fetch_price_feed(uint64)void'>]>

  /**
   * Calls the pause_market(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  pauseMarket(args: MethodArgs<'pause_market(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'pause_market(uint64,uint64)void'>]>

  /**
   * Calls the sync_market(uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  syncMarket(args: MethodArgs<'sync_market(uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'sync_market(uint64)void'>]>

  /**
   * Calls the withdraw_reserves(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  withdrawReserves(args: MethodArgs<'withdraw_reserves(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'withdraw_reserves(uint64,uint256)void'>]>

  /**
   * Calls the deposit(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  deposit(args: MethodArgs<'deposit(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'deposit(uint64,uint256)void'>]>

  /**
   * Calls the withdraw(uint64,uint256)uint256 ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  withdraw(args: MethodArgs<'withdraw(uint64,uint256)uint256'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'withdraw(uint64,uint256)uint256'>]>

  /**
   * Calls the borrow(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  borrow(args: MethodArgs<'borrow(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'borrow(uint64,uint256)void'>]>

  /**
   * Calls the repay(uint64,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  repay(args: MethodArgs<'repay(uint64,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'repay(uint64,uint256)void'>]>

  /**
   * Calls the sync_user_market_for_price_change(address,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  syncUserMarketForPriceChange(args: MethodArgs<'sync_user_market_for_price_change(address,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'sync_user_market_for_price_change(address,uint64)void'>]>

  /**
   * Calls the get_global_user(address)(uint256,uint256,uint64) ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  getGlobalUser(args: MethodArgs<'get_global_user(address)(uint256,uint256,uint64)'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'get_global_user(address)(uint256,uint256,uint64)'>]>

  /**
   * Calls the liquidate_cross_market(uint64,uint64,address,uint256,uint256)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  liquidateCrossMarket(args: MethodArgs<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'liquidate_cross_market(uint64,uint64,address,uint256,uint256)void'>]>

  /**
   * Calls the set_version(uint64,uint64)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setVersion(args: MethodArgs<'set_version(uint64,uint64)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_version(uint64,uint64)void'>]>

  /**
   * Calls the grant_upgrader(address)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  grantUpgrader(args: MethodArgs<'grant_upgrader(address)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'grant_upgrader(address)void'>]>

  /**
   * Calls the approve_update(bool)void ABI method.
   *
   * Approve update.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  approveUpdate(args: MethodArgs<'approve_update(bool)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'approve_update(bool)void'>]>

  /**
   * Calls the set_role(byte[32],bool)void ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  setRole(args: MethodArgs<'set_role(byte[32],bool)void'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'set_role(byte[32],bool)void'>]>

  /**
   * Calls the has_role(byte[32])bool ABI method.
   *
   * @param args The arguments for the contract call
   * @param params Any additional parameters for the call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  hasRole(args: MethodArgs<'has_role(byte[32])bool'>, params?: AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, MethodReturn<'has_role(byte[32])bool'>]>

  /**
   * Gets available update methods
   */
  readonly update: {
    /**
     * Updates an existing instance of the DorkFiLendingPool smart contract using a bare call.
     *
     * @param args The arguments for the bare call
     * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
     */
    bare(args?: BareCallArgs & AppClientComposeCallCoreParams & AppClientCompilationParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, undefined]>
  }

  /**
   * Makes a clear_state call to an existing instance of the DorkFiLendingPool smart contract.
   *
   * @param args The arguments for the bare call
   * @returns The typed transaction composer so you can fluently chain multiple calls or call execute to execute all queued up transactions
   */
  clearState(args?: BareCallArgs & AppClientComposeCallCoreParams & CoreAppCallArgs): DorkFiLendingPoolComposer<[...TReturns, undefined]>

  /**
   * Adds a transaction to the composer
   *
   * @param txn One of: A TransactionWithSigner object (returned as is), a TransactionToSign object (signer is obtained from the signer property), a Transaction object (signer is extracted from the defaultSender parameter), an async SendTransactionResult returned by one of algokit utils helpers (signer is obtained from the defaultSender parameter)
   * @param defaultSender The default sender to be used to obtain a signer where the object provided to the transaction parameter does not include a signer.
   */
  addTransaction(txn: TransactionWithSigner | TransactionToSign | Transaction | Promise<SendTransactionResult>, defaultSender?: SendTransactionFrom): DorkFiLendingPoolComposer<TReturns>
  /**
   * Returns the underlying AtomicTransactionComposer instance
   */
  atc(): Promise<AtomicTransactionComposer>
  /**
   * Simulates the transaction group and returns the result
   */
  simulate(options?: SimulateOptions): Promise<DorkFiLendingPoolComposerSimulateResult<TReturns>>
  /**
   * Executes the transaction group and returns the results
   */
  execute(sendParams?: AppClientComposeExecuteParams): Promise<DorkFiLendingPoolComposerResults<TReturns>>
}
export type SimulateOptions = Omit<ConstructorParameters<typeof modelsv2.SimulateRequest>[0], 'txnGroups'>
export type DorkFiLendingPoolComposerSimulateResult<TReturns extends [...any[]]> = {
  returns: TReturns
  methodResults: ABIResult[]
  simulateResponse: modelsv2.SimulateResponse
}
export type DorkFiLendingPoolComposerResults<TReturns extends [...any[]]> = {
  returns: TReturns
  groupId: string
  txIds: string[]
  transactions: Transaction[]
}
